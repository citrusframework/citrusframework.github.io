<!DOCTYPE HTML>
<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <title>Citrus Framework</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="generator" content="Citrus 4.6.0">
  <meta name="description" content="Citrus Framework Website"/>
  <meta name="author" content="ConSol Software GmbH"/>
  <link type="application/atom+xml" rel="alternate" href="http://0.0.0.0:4000/feed.xml" title="Citrus Integration Tests" />
  <link rel="alternate" type="application/atom+xml" title="Recent commits to Citrus master branch" href="https://github.com/citrusframework/citrus/commits/master.atom">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic,900">
  <link rel="stylesheet" href="/css/screen.css">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <!--[if lt IE 9]>
  <script src="/js/html5shiv.min.js"></script>
  <script src="/js/respond.min.js"></script>
  <![endif]-->
</head>


<body class="wrap">
  <header role="banner">
  <nav class="mobile-nav show-on-mobiles">
    <ul>
  <li class="hide-on-mobiles">
    <img src="/img/brand-logo.png" alt="Citrus"><span class="brand">Citrus</span>
  </li>
  <li class="">
    <a href="/"><i class="fa fa-home"></i></a>
  </li>
  <li class="">
    <a href="/projects/">Projects</a>
  </li>
  <li class="">
    <a href="/endpoints/">Endpoints</a>
  </li>
  <li class="">
    <a href="/runtimes/">Runtimes</a>
  </li>
  <li class="">
    <a href="/docs/documentation/">Doc<span class="hide-on-mobiles">umentation</span><span class="show-on-mobiles">s</span></a>
  </li>
  <li class="current">
    <a href="/samples/">Samples</a>
  </li>
  <li class="">
    <a href="/news/">News<span class="hide-on-mobiles"> &amp; Blog</span></a>
  </li>
  <li class="">
    <a href="/help/"><span class="show-on-mobiles"><i class="fa fa-help"></i></span><span class="hide-on-mobiles">Help</span></a>
  </li>
  <li class="hide-on-mobiles">
    <a href="https://github.com/citrusframework/citrus" target="_blank"><i class="fa fa-github"></i>  GitHub</a>
  </li>
</ul>

  </nav>
  <div class="grid">
    <nav class="main-nav whole hide-on-mobiles">
      <ul>
  <li class="hide-on-mobiles">
    <img src="/img/brand-logo.png" alt="Citrus"><span class="brand">Citrus</span>
  </li>
  <li class="">
    <a href="/"><i class="fa fa-home"></i></a>
  </li>
  <li class="">
    <a href="/projects/">Projects</a>
  </li>
  <li class="">
    <a href="/endpoints/">Endpoints</a>
  </li>
  <li class="">
    <a href="/runtimes/">Runtimes</a>
  </li>
  <li class="">
    <a href="/docs/documentation/">Doc<span class="hide-on-mobiles">umentation</span><span class="show-on-mobiles">s</span></a>
  </li>
  <li class="current">
    <a href="/samples/">Samples</a>
  </li>
  <li class="">
    <a href="/news/">News<span class="hide-on-mobiles"> &amp; Blog</span></a>
  </li>
  <li class="">
    <a href="/help/"><span class="show-on-mobiles"><i class="fa fa-help"></i></span><span class="hide-on-mobiles">Help</span></a>
  </li>
  <li class="hide-on-mobiles">
    <a href="https://github.com/citrusframework/citrus" target="_blank"><i class="fa fa-github"></i>  GitHub</a>
  </li>
</ul>

    </nav>
  </div>
</header>


    <section class="samples">
    <div class="grid">

      <div class="samples-nav-mobile unit whole show-on-mobiles">
  <select onchange="if (this.value) window.location.href=this.value">
    <option value="">Navigate the samples…</option>
    <option value="/samples/">Overview</option>
    <option value="/samples/todo-app/">TodoList app</option>
    <option value="/samples/run/">Running</option>
    
    
    <option value="/samples/annotation-config/">sample-annotation-config</option>
    
    <option value="/samples/reporting/">sample-reporting</option>
    
    <option value="/samples/javaconfig/">sample-javaconfig</option>
    
    <option value="/samples/kubernetes/">sample-kubernetes</option>
    
    <option value="/samples/docker/">sample-docker</option>
    
    <option value="/samples/apache-camel/">sample-camel-context</option>
    
    <option value="/samples/jbang/">sample-jbang</option>
    
    <option value="/samples/cucumber/">sample-cucumber</option>
    
    <option value="/samples/quarkus/">sample-quarkus</option>
    
    <option value="/samples/selenium/">sample-selenium</option>
    
    <option value="/samples/http/">sample-http</option>
    
    <option value="/samples/sftp/">sample-sftp</option>
    
    <option value="/samples/soap-attachment/">sample-soap-attachment</option>
    
    <option value="/samples/http-basic-auth/">sample-http-basic-auth</option>
    
    <option value="/samples/ftp/">sample-ftp</option>
    
    <option value="/samples/dynamic-endpoints/">sample-dynamic-endpoints</option>
    
    <option value="/samples/scp/">sample-scp</option>
    
    <option value="/samples/https/">sample-https</option>
    
    <option value="/samples/soap-mtom/">sample-soap-mtom</option>
    
    <option value="/samples/jdbc/">sample-jdbc</option>
    
    <option value="/samples/jms/">sample-jms</option>
    
    <option value="/samples/mail/">sample-mail</option>
    
    <option value="/samples/openapi/">sample-swagger</option>
    
    <option value="/samples/wsdl/">sample-wsdl</option>
    
    <option value="/samples/kafka/">sample-kafka</option>
    
    <option value="/samples/soap/">sample-soap</option>
    
    <option value="/samples/rmi/">sample-rmi</option>
    
    <option value="/samples/soap-wsaddressing/">sample-soap-wsaddressing</option>
    
    <option value="/samples/soap-static-response/">sample-soap-static-response</option>
    
    <option value="/samples/http-static-response/">sample-http-static-response</option>
    
    <option value="/samples/http-loadtest/">sample-http-loadtest</option>
    
    <option value="/samples/soap-wssecurity/">sample-soap-wssecurity</option>
    
    <option value="/samples/soap-ssl/">sample-soap-ssl</option>
    
    <option value="/samples/behavior/">sample-behavior</option>
    
    <option value="/samples/dictionaries/">sample-dictionaries</option>
    
    <option value="/samples/gradle/">sample-gradle</option>
    
    <option value="/samples/message-store/">sample-message-store</option>
    
    <option value="/samples/junit/">sample-junit</option>
    
    <option value="/samples/testng/">sample-testng</option>
    
    <option value="/samples/dataprovider/">sample-dataprovider</option>
    
    <option value="/samples/junit5/">sample-junit5</option>
    
    <option value="/samples/xml/">sample-xml</option>
    
    <option value="/samples/hamcrest/">sample-hamcrest</option>
    
    <option value="/samples/json/">sample-json</option>
    
    <option value="/samples/oxm/">sample-oxm</option>
    
    <option value="/samples/xhtml/">sample-xhtml</option>
    
    <option value="/samples/databind/">sample-databind</option>
    
    <option value="/samples/http-form-data/">sample-http-form-data</option>
    
    <option value="/samples/sql/">sample-sql</option>
    
    <option value="/samples/binary/">sample-binary</option>
    
  </select>
</div>


      <div class="unit four-fifths">
        <article>
  <h2>
    
    <i class="fa fa-ftp" style="width: 1em;height: 1em;"></i>
    
    
    FTP sample
    <a href="/samples/ftp/" class="permalink" title="Permalink">∞</a>
  </h2>
  <div class="right">
    
    <a href="https://github.com/citrusframework/citrus-samples/blob/master/samples-ftp/sample-ftp" target="_blank">
      <i class="fa fa-pencil"></i> View source code
    </a>
    
    
  </div>
  <span class="post-category">
    <span class="label">
      samples
    </span>
  </span>
  <div class="post-content">
    <p>This sample shows hot to setup proper FTP communication as client and server in Citrus. The ftp-client component creates a new
directory on the server, stores a file and retrieves the same file in a single test.</p>

<p>FTP features are also described in detail in <a href="https://citrusframework.org/citrus/reference/html#ftp">reference guide</a></p>

<h2 id="objectives">Objectives</h2>

<p>We want to setup both FTP client and server components in our project in order to test a file transfer via FTP. The client authenticates to the server
using username password credentials. The ftp-server component will receive incoming requests for validation and provide the FTP user account workspace to the client.</p>

<p>First of all let us setup the necessary components in the Spring bean configuration:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">FtpClient</span> <span class="nf">ftpClient</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">CitrusEndpoints</span><span class="o">.</span><span class="na">ftp</span><span class="o">()</span>
            <span class="o">.</span><span class="na">client</span><span class="o">()</span>
            <span class="o">.</span><span class="na">autoReadFiles</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
            <span class="o">.</span><span class="na">port</span><span class="o">(</span><span class="mi">22222</span><span class="o">)</span>
            <span class="o">.</span><span class="na">username</span><span class="o">(</span><span class="s">"citrus"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">password</span><span class="o">(</span><span class="s">"admin"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">timeout</span><span class="o">(</span><span class="mi">10000L</span><span class="o">)</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>

<span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">FtpServer</span> <span class="nf">ftpListServer</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">CitrusEndpoints</span><span class="o">.</span><span class="na">ftp</span><span class="o">()</span>
            <span class="o">.</span><span class="na">server</span><span class="o">()</span>
            <span class="o">.</span><span class="na">port</span><span class="o">(</span><span class="mi">22222</span><span class="o">)</span>
            <span class="o">.</span><span class="na">autoLogin</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
            <span class="o">.</span><span class="na">autoStart</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
            <span class="o">.</span><span class="na">autoHandleCommands</span><span class="o">(</span><span class="n">Stream</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">FTPCmd</span><span class="o">.</span><span class="na">MKD</span><span class="o">.</span><span class="na">getCommand</span><span class="o">(),</span>
                                          <span class="n">FTPCmd</span><span class="o">.</span><span class="na">PORT</span><span class="o">.</span><span class="na">getCommand</span><span class="o">(),</span>
                                          <span class="n">FTPCmd</span><span class="o">.</span><span class="na">TYPE</span><span class="o">.</span><span class="na">getCommand</span><span class="o">()).</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">joining</span><span class="o">(</span><span class="s">","</span><span class="o">)))</span>
            <span class="o">.</span><span class="na">userManagerProperties</span><span class="o">(</span><span class="k">new</span> <span class="n">ClassPathResource</span><span class="o">(</span><span class="s">"citrus.ftp.user.properties"</span><span class="o">))</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The <em>ftpServer</em> is a small but fully qualified FTP server implementation in Citrus. The server receives <code class="highlighter-rouge">user-manager-properties</code> that define all available user accounts. The properties
look like this:</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Password is "admin"
</span><span class="py">ftpserver.user.citrus.userpassword</span><span class="p">=</span><span class="s">21232F297A57A5A743894A0E4A801FC3</span>
<span class="py">ftpserver.user.citrus.homedirectory</span><span class="p">=</span><span class="s">target/ftp/user/citrus</span>
<span class="py">ftpserver.user.citrus.enableflag</span><span class="p">=</span><span class="s">true</span>
<span class="py">ftpserver.user.citrus.writepermission</span><span class="p">=</span><span class="s">true</span>
<span class="py">ftpserver.user.citrus.maxloginnumber</span><span class="p">=</span><span class="s">0</span>
<span class="py">ftpserver.user.citrus.maxloginperip</span><span class="p">=</span><span class="s">0</span>
<span class="py">ftpserver.user.citrus.idletime</span><span class="p">=</span><span class="s">0</span>
<span class="py">ftpserver.user.citrus.uploadrate</span><span class="p">=</span><span class="s">0</span>
<span class="py">ftpserver.user.citrus.downloadrate</span><span class="p">=</span><span class="s">0</span>

<span class="py">ftpserver.user.anonymous.userpassword</span><span class="p">=</span>
<span class="py">ftpserver.user.anonymous.homedirectory</span><span class="p">=</span><span class="s">target/ftp/user/anonymous</span>
<span class="py">ftpserver.user.anonymous.enableflag</span><span class="p">=</span><span class="s">true</span>
<span class="py">ftpserver.user.anonymous.writepermission</span><span class="p">=</span><span class="s">false</span>
<span class="py">ftpserver.user.anonymous.maxloginnumber</span><span class="p">=</span><span class="s">20</span>
<span class="py">ftpserver.user.anonymous.maxloginperip</span><span class="p">=</span><span class="s">2</span>
<span class="py">ftpserver.user.anonymous.idletime</span><span class="p">=</span><span class="s">300</span>
<span class="py">ftpserver.user.anonymous.uploadrate</span><span class="p">=</span><span class="s">4800</span>
<span class="py">ftpserver.user.anonymous.downloadrate</span><span class="p">=</span><span class="s">4800</span>
</code></pre></div></div>

<p>The FTP server defines two accounts <code class="highlighter-rouge">citrus</code> and <code class="highlighter-rouge">anonymous</code>. Clients may authenticate to the server using these credentials. Based on the user account
we can set a user workspace home directory. The server will save incoming stored files to this directory and the server will read retrieved files from that
home directory.</p>

<p>In case you want to setup some files in that directory in order to provide it to clients, please copy those files to that home directory prior to the test.</p>

<p>The ftp-client connects to the server using the user credentials and is then able to store and retrieve files in a test.</p>

<p>In a sample test we first create a new subdirectory in that user home directory.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">echo</span><span class="o">(</span><span class="s">"Create new directory on server"</span><span class="o">);</span>

<span class="n">send</span><span class="o">(</span><span class="n">ftpClient</span><span class="o">)</span>
    <span class="o">.</span><span class="na">fork</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
    <span class="o">.</span><span class="na">message</span><span class="o">(</span><span class="n">FtpMessage</span><span class="o">.</span><span class="na">command</span><span class="o">(</span><span class="n">FTPCmd</span><span class="o">.</span><span class="na">MKD</span><span class="o">).</span><span class="na">arguments</span><span class="o">(</span><span class="s">"todo"</span><span class="o">));</span>

<span class="n">receive</span><span class="o">(</span><span class="n">ftpClient</span><span class="o">)</span>
    <span class="o">.</span><span class="na">message</span><span class="o">(</span><span class="n">FtpMessage</span><span class="o">.</span><span class="na">result</span><span class="o">(</span><span class="n">getMkdirsCommandResult</span><span class="o">(</span><span class="s">"todo"</span><span class="o">)));</span>
</code></pre></div></div>

<p>As you can see the client is passing a <code class="highlighter-rouge">MKD</code> signal to the server. The user login procedure is done automatically and the directory creation is also
dome automatically on the FTP server. This is because we added the <code class="highlighter-rouge">MKD</code> signal to the list of <code class="highlighter-rouge">auto-handle-commands</code>.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span>
<span class="kd">public</span> <span class="n">FtpServer</span> <span class="nf">ftpListServer</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">CitrusEndpoints</span><span class="o">.</span><span class="na">ftp</span><span class="o">()</span>
            <span class="o">.</span><span class="na">server</span><span class="o">()</span>
            <span class="o">[...]</span>
            <span class="o">.</span><span class="na">autoLogin</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
            <span class="o">.</span><span class="na">autoHandleCommands</span><span class="o">(</span><span class="n">Stream</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">FTPCmd</span><span class="o">.</span><span class="na">MKD</span><span class="o">.</span><span class="na">getCommand</span><span class="o">(),</span>
                                          <span class="n">FTPCmd</span><span class="o">.</span><span class="na">PORT</span><span class="o">.</span><span class="na">getCommand</span><span class="o">(),</span>
                                          <span class="n">FTPCmd</span><span class="o">.</span><span class="na">TYPE</span><span class="o">.</span><span class="na">getCommand</span><span class="o">()).</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">joining</span><span class="o">(</span><span class="s">","</span><span class="o">)))</span>
            <span class="o">[...]</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>This tells the FTP server to automatically handle the user login as well as the given commands. Now lets store a new file in that user directory.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">echo</span><span class="o">(</span><span class="s">"Store file to directory"</span><span class="o">);</span>

<span class="n">send</span><span class="o">(</span><span class="n">ftpClient</span><span class="o">)</span>
        <span class="o">.</span><span class="na">fork</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
        <span class="o">.</span><span class="na">message</span><span class="o">(</span><span class="n">FtpMessage</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"todo/entry.json"</span><span class="o">,</span> <span class="n">DataType</span><span class="o">.</span><span class="na">ASCII</span><span class="o">).</span><span class="na">arguments</span><span class="o">(</span><span class="s">""</span><span class="o">));</span>

<span class="n">receive</span><span class="o">(</span><span class="n">ftpServer</span><span class="o">)</span>
        <span class="o">.</span><span class="na">message</span><span class="o">(</span><span class="n">FtpMessage</span><span class="o">.</span><span class="na">command</span><span class="o">(</span><span class="n">FTPCmd</span><span class="o">.</span><span class="na">STOR</span><span class="o">).</span><span class="na">arguments</span><span class="o">(</span><span class="s">"todo/entry.json"</span><span class="o">));</span>

<span class="n">send</span><span class="o">(</span><span class="n">ftpServer</span><span class="o">)</span>
        <span class="o">.</span><span class="na">message</span><span class="o">(</span><span class="n">FtpMessage</span><span class="o">.</span><span class="na">success</span><span class="o">());</span>

<span class="n">receive</span><span class="o">(</span><span class="n">ftpClient</span><span class="o">)</span>
        <span class="o">.</span><span class="na">message</span><span class="o">(</span><span class="n">FtpMessage</span><span class="o">.</span><span class="na">result</span><span class="o">(</span><span class="n">getStoreFileCommandResult</span><span class="o">()));</span>
</code></pre></div></div>

<p>Now we have both client and server interaction in the same test case. This requires us to use <code class="highlighter-rouge">fork=true</code> option on all client
requests as we need to continue with the test in order to handle the server interaction, too. We can store a new file <code class="highlighter-rouge">todo/entry.json</code> which is transmitted
to the server using <code class="highlighter-rouge">ASCII</code> file mode.</p>

<p>The FTP server is receiving the <code class="highlighter-rouge">STOR</code>signal providing a success response in order to mark completion of the file transfer. After that the file should be created in
the user home directory in path <code class="highlighter-rouge">todo/entry.json</code>. You can validate the file content by reading it from that directory in another test action.</p>

<p>Now we should be also able to list the files in that directory:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">echo</span><span class="o">(</span><span class="s">"List files in directory"</span><span class="o">);</span>

<span class="n">send</span><span class="o">(</span><span class="n">ftpClient</span><span class="o">)</span>
        <span class="o">.</span><span class="na">fork</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
        <span class="o">.</span><span class="na">message</span><span class="o">(</span><span class="n">FtpMessage</span><span class="o">.</span><span class="na">list</span><span class="o">(</span><span class="s">"todo"</span><span class="o">).</span><span class="na">arguments</span><span class="o">(</span><span class="s">"todo"</span><span class="o">));</span>

<span class="n">receive</span><span class="o">(</span><span class="n">ftpServer</span><span class="o">)</span>
        <span class="o">.</span><span class="na">message</span><span class="o">(</span><span class="n">FtpMessage</span><span class="o">.</span><span class="na">command</span><span class="o">(</span><span class="n">FTPCmd</span><span class="o">.</span><span class="na">LIST</span><span class="o">).</span><span class="na">arguments</span><span class="o">(</span><span class="s">"todo"</span><span class="o">));</span>

<span class="n">send</span><span class="o">(</span><span class="n">ftpServer</span><span class="o">)</span>
        <span class="o">.</span><span class="na">message</span><span class="o">(</span><span class="n">FtpMessage</span><span class="o">.</span><span class="na">success</span><span class="o">());</span>

<span class="n">receive</span><span class="o">(</span><span class="n">ftpClient</span><span class="o">)</span>
        <span class="o">.</span><span class="na">message</span><span class="o">(</span><span class="n">FtpMessage</span><span class="o">.</span><span class="na">result</span><span class="o">(</span><span class="n">getListCommandResult</span><span class="o">(</span><span class="s">"entry.json"</span><span class="o">)));</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="n">ListCommandResult</span> <span class="nf">getListCommandResult</span><span class="o">(</span><span class="n">String</span> <span class="o">...</span> <span class="n">fileNames</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">ListCommandResult</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ListCommandResult</span><span class="o">();</span>
    <span class="n">result</span><span class="o">.</span><span class="na">setSuccess</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="n">result</span><span class="o">.</span><span class="na">setReplyCode</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">226</span><span class="o">));</span>
    <span class="n">result</span><span class="o">.</span><span class="na">setReplyString</span><span class="o">(</span><span class="s">"@contains('Closing data connection')@"</span><span class="o">);</span>

    <span class="n">ListCommandResult</span><span class="o">.</span><span class="na">Files</span> <span class="n">expectedFiles</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ListCommandResult</span><span class="o">.</span><span class="na">Files</span><span class="o">();</span>

    <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">fileName</span> <span class="o">:</span> <span class="n">fileNames</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">ListCommandResult</span><span class="o">.</span><span class="na">Files</span><span class="o">.</span><span class="na">File</span> <span class="n">entry</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ListCommandResult</span><span class="o">.</span><span class="na">Files</span><span class="o">.</span><span class="na">File</span><span class="o">();</span>
        <span class="n">entry</span><span class="o">.</span><span class="na">setPath</span><span class="o">(</span><span class="n">fileName</span><span class="o">);</span>
        <span class="n">expectedFiles</span><span class="o">.</span><span class="na">getFiles</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">entry</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="n">result</span><span class="o">.</span><span class="na">setFiles</span><span class="o">(</span><span class="n">expectedFiles</span><span class="o">);</span>

    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Now we can also retrieve the file from the server by calling the <code class="highlighter-rouge">RETR</code> operation.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">echo</span><span class="o">(</span><span class="s">"Retrieve file from server"</span><span class="o">);</span>

<span class="n">send</span><span class="o">(</span><span class="n">ftpClient</span><span class="o">)</span>
        <span class="o">.</span><span class="na">fork</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
        <span class="o">.</span><span class="na">message</span><span class="o">(</span><span class="n">FtpMessage</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"todo/todo.json"</span><span class="o">,</span> <span class="s">"target/todo/todo.json"</span><span class="o">,</span> <span class="n">DataType</span><span class="o">.</span><span class="na">ASCII</span><span class="o">));</span>

<span class="n">receive</span><span class="o">(</span><span class="n">ftpServer</span><span class="o">)</span>
        <span class="o">.</span><span class="na">message</span><span class="o">(</span><span class="n">FtpMessage</span><span class="o">.</span><span class="na">command</span><span class="o">(</span><span class="n">FTPCmd</span><span class="o">.</span><span class="na">RETR</span><span class="o">).</span><span class="na">arguments</span><span class="o">(</span><span class="s">"todo/todo.json"</span><span class="o">));</span>

<span class="n">send</span><span class="o">(</span><span class="n">ftpServer</span><span class="o">)</span>
        <span class="o">.</span><span class="na">message</span><span class="o">(</span><span class="n">FtpMessage</span><span class="o">.</span><span class="na">success</span><span class="o">());</span>

<span class="n">receive</span><span class="o">(</span><span class="n">ftpClient</span><span class="o">)</span>
        <span class="o">.</span><span class="na">message</span><span class="o">(</span><span class="n">FtpMessage</span><span class="o">.</span><span class="na">result</span><span class="o">(</span><span class="n">getRetrieveFileCommandResult</span><span class="o">(</span><span class="s">"target/todo/todo.json"</span><span class="o">,</span> <span class="k">new</span> <span class="n">ClassPathResource</span><span class="o">(</span><span class="s">"todo/entry.json"</span><span class="o">))));</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="n">GetCommandResult</span> <span class="nf">getRetrieveFileCommandResult</span><span class="o">(</span><span class="n">String</span> <span class="n">path</span><span class="o">,</span> <span class="n">Resource</span> <span class="n">content</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">GetCommandResult</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GetCommandResult</span><span class="o">();</span>
    <span class="n">result</span><span class="o">.</span><span class="na">setSuccess</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="n">result</span><span class="o">.</span><span class="na">setReplyCode</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">226</span><span class="o">));</span>
    <span class="n">result</span><span class="o">.</span><span class="na">setReplyString</span><span class="o">(</span><span class="s">"@contains('Transfer complete')@"</span><span class="o">);</span>

    <span class="n">GetCommandResult</span><span class="o">.</span><span class="na">File</span> <span class="n">entryResult</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GetCommandResult</span><span class="o">.</span><span class="na">File</span><span class="o">();</span>
    <span class="n">entryResult</span><span class="o">.</span><span class="na">setPath</span><span class="o">(</span><span class="n">path</span><span class="o">);</span>
    <span class="n">entryResult</span><span class="o">.</span><span class="na">setData</span><span class="o">(</span><span class="n">FileUtils</span><span class="o">.</span><span class="na">readToString</span><span class="o">(</span><span class="n">content</span><span class="o">));</span>
    <span class="n">result</span><span class="o">.</span><span class="na">setFile</span><span class="o">(</span><span class="n">entryResult</span><span class="o">);</span>

    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>This completes our test as we were able to interact with the FTP server using the client signals.</p>

<h2 id="run">Run</h2>

<p>You can execute some sample Citrus test cases in this sample in order to write the reports.
Open a separate command line terminal and navigate to the sample folder.</p>

<p>Execute all Citrus tests by calling</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> mvn integration-test
</code></pre></div></div>

<p>You should see Citrus performing several tests with lots of debugging output. 
And of course green tests at the very end of the build and some new reporting files in <code class="highlighter-rouge">target/citrus-reports</code> folder.</p>

<p>Of course you can also start the Citrus tests from your favorite IDE.
Just start the Citrus test using the TestNG IDE integration in IntelliJ, Eclipse or Netbeans.</p>


  </div>
</article>

      </div>

      <div class="unit one-fifth hide-on-mobiles">
  <aside>
    <h4>Samples</h4>
    <ul>
      <li class="">
        <a href="/samples/">Overview</a>
      </li>
      <li class="">
        <a href="/samples/todo-app">TodoList application</a>
      </li>
      <li class="">
        <a href="/samples/run">Running</a>
      </li>
    </ul>
    <h4>Configuration</h4>
    <ul style="margin-top: 5px;">
      
      

      
      
      <li class="">
        <a href="/samples/annotation-config/">sample-annotation-config</a>
      </li>
      
      
      <li class="">
        <a href="/samples/reporting/">sample-reporting</a>
      </li>
      
      
      <li class="">
        <a href="/samples/javaconfig/">sample-javaconfig</a>
      </li>
      
      
    </ul>

    <h4>Connectors</h4>
    <ul style="margin-top: 5px;">
      
      
      <li class="">
        <a href="/samples/kubernetes/">sample-kubernetes</a>
      </li>
      
      
      <li class="">
        <a href="/samples/docker/">sample-docker</a>
      </li>
      
      
    </ul>

    <h4>Demo</h4>
    <ul style="margin-top: 5px;">
      
      
      <li class="">
        <a href="/samples/apache-camel/">sample-camel-context</a>
      </li>
      
      
      <li class="">
        <a href="/samples/jbang/">sample-jbang</a>
      </li>
      
      
      <li class="">
        <a href="/samples/cucumber/">sample-cucumber</a>
      </li>
      
      
      <li class="">
        <a href="/samples/quarkus/">sample-quarkus</a>
      </li>
      
      
      <li class="">
        <a href="/samples/selenium/">sample-selenium</a>
      </li>
      
      
    </ul>

    <h4>Endpoints</h4>
    <ul style="margin-top: 5px;">
      
      
      <li class="">
        <a href="/samples/http/">sample-http</a>
      </li>
      
      
      <li class="">
        <a href="/samples/sftp/">sample-sftp</a>
      </li>
      
      
      <li class="">
        <a href="/samples/soap-attachment/">sample-soap-attachment</a>
      </li>
      
      
      <li class="">
        <a href="/samples/http-basic-auth/">sample-http-basic-auth</a>
      </li>
      
      
      <li class="current">
        <a href="/samples/ftp/">sample-ftp</a>
      </li>
      
      
      <li class="">
        <a href="/samples/dynamic-endpoints/">sample-dynamic-endpoints</a>
      </li>
      
      
      <li class="">
        <a href="/samples/scp/">sample-scp</a>
      </li>
      
      
      <li class="">
        <a href="/samples/https/">sample-https</a>
      </li>
      
      
      <li class="">
        <a href="/samples/soap-mtom/">sample-soap-mtom</a>
      </li>
      
      
      <li class="">
        <a href="/samples/jdbc/">sample-jdbc</a>
      </li>
      
      
      <li class="">
        <a href="/samples/jms/">sample-jms</a>
      </li>
      
      
      <li class="">
        <a href="/samples/mail/">sample-mail</a>
      </li>
      
      
      <li class="">
        <a href="/samples/openapi/">sample-swagger</a>
      </li>
      
      
      <li class="">
        <a href="/samples/wsdl/">sample-wsdl</a>
      </li>
      
      
      <li class="">
        <a href="/samples/kafka/">sample-kafka</a>
      </li>
      
      
      <li class="">
        <a href="/samples/soap/">sample-soap</a>
      </li>
      
      
      <li class="">
        <a href="/samples/rmi/">sample-rmi</a>
      </li>
      
      
      <li class="">
        <a href="/samples/soap-wsaddressing/">sample-soap-wsaddressing</a>
      </li>
      
      
      <li class="">
        <a href="/samples/soap-static-response/">sample-soap-static-response</a>
      </li>
      
      
      <li class="">
        <a href="/samples/http-static-response/">sample-http-static-response</a>
      </li>
      
      
      <li class="">
        <a href="/samples/http-loadtest/">sample-http-loadtest</a>
      </li>
      
      
      <li class="">
        <a href="/samples/soap-wssecurity/">sample-soap-wssecurity</a>
      </li>
      
      
      <li class="">
        <a href="/samples/soap-ssl/">sample-soap-ssl</a>
      </li>
      
      
    </ul>

    <h4>Miscellaneous</h4>
    <ul style="margin-top: 5px;">
      
      
      <li class="">
        <a href="/samples/behavior/">sample-behavior</a>
      </li>
      
      
      <li class="">
        <a href="/samples/dictionaries/">sample-dictionaries</a>
      </li>
      
      
      <li class="">
        <a href="/samples/gradle/">sample-gradle</a>
      </li>
      
      
      <li class="">
        <a href="/samples/message-store/">sample-message-store</a>
      </li>
      
      
    </ul>

    <h4>Runtimes</h4>
    <ul style="margin-top: 5px;">
      
      
      <li class="">
        <a href="/samples/junit/">sample-junit</a>
      </li>
      
      
      <li class="">
        <a href="/samples/testng/">sample-testng</a>
      </li>
      
      
      <li class="">
        <a href="/samples/dataprovider/">sample-dataprovider</a>
      </li>
      
      
      <li class="">
        <a href="/samples/junit5/">sample-junit5</a>
      </li>
      
      
    </ul>

    <h4>Validation</h4>
    <ul style="margin-top: 5px;">
      
      
      <li class="">
        <a href="/samples/xml/">sample-xml</a>
      </li>
      
      
      <li class="">
        <a href="/samples/hamcrest/">sample-hamcrest</a>
      </li>
      
      
      <li class="">
        <a href="/samples/json/">sample-json</a>
      </li>
      
      
      <li class="">
        <a href="/samples/oxm/">sample-oxm</a>
      </li>
      
      
      <li class="">
        <a href="/samples/xhtml/">sample-xhtml</a>
      </li>
      
      
      <li class="">
        <a href="/samples/databind/">sample-databind</a>
      </li>
      
      
      <li class="">
        <a href="/samples/http-form-data/">sample-http-form-data</a>
      </li>
      
      
      <li class="">
        <a href="/samples/sql/">sample-sql</a>
      </li>
      
      
      <li class="">
        <a href="/samples/binary/">sample-binary</a>
      </li>
      
    </ul>
  </aside>
</div>


      <div class="clear"></div>

    </div>
  </section>


  <footer role="contentinfo">
  <div class="grid">
    <div class="unit one-third center-on-mobiles">
      <p>Citrus is open source and licensed under <br><a href="https://www.apache.org/licenses/LICENSE-2.0.html">Apache License 2.0</a>.</p>
      <p>This website is licensed under <br><a href="https://github.com/citrusframework/citrus/blob/master/LICENSE">MIT License</a>.</p>
      <br>
      <p>© 2025 ConSol Software GmbH</p>
    </div>
    <div class="unit one-third align-center center-on-mobiles">
      <p>
        <img src="/img/bmi_logo_eng.png" alt="Federal Ministry for Economic Affairs and Energy">
      </p>
    </div>
    <div class="unit one-third align-right center-on-mobiles">
      <p>
        Hosted by<br>
        <a href="http://www.consol.de">
          <img src="/img/sponsor-logo.png" alt="ConSol">
        </a>
      </p>
      <p> </p>
      <br>
      <br>
      <p>
        <a href="http://www.consol.com/legal-notice/">Legal notice</a> | <a href="https://www.consol.com/data-privacy/">Data privacy</a>
      </p>
    </div>
  </div>
</footer>

  <script>
  var anchorForId = function (id) {
    var anchor = document.createElement("a");
    anchor.className = "header-link";
    anchor.href      = "#" + id;
    anchor.innerHTML = "<span class=\"sr-only\">Permalink</span><i class=\"fa fa-link\"></i>";
    anchor.title = "Permalink";
    return anchor;
  };

  var linkifyAnchors = function (level, containingElement) {
    var headers = containingElement.getElementsByTagName("h" + level);
    for (var h = 0; h < headers.length; h++) {
      var header = headers[h];

      if (typeof header.id !== "undefined" && header.id !== "") {
        header.appendChild(anchorForId(header.id));
      }
    }
  };

  document.onreadystatechange = function () {
    if (this.readyState === "complete") {
      var contentBlock = document.getElementsByClassName("docs")[0] || document.getElementsByClassName("samples")[0] || document.getElementsByClassName("news")[0];
      if (!contentBlock) {
        return;
      }
      for (var level = 1; level <= 6; level++) {
        linkifyAnchors(level, contentBlock);
      }
    }
  };
</script>


</body>
</html>
