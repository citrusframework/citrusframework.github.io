<!DOCTYPE HTML>
<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <title>Citrus Framework</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="generator" content="Citrus 4.2.0">
  <meta name="description" content="Citrus Framework Website"/>
  <meta name="author" content="ConSol Software GmbH"/>
  <link type="application/atom+xml" rel="alternate" href="http://0.0.0.0:4000/feed.xml" title="Citrus Integration Tests" />
  <link rel="alternate" type="application/atom+xml" title="Recent commits to Citrus master branch" href="https://github.com/citrusframework/citrus/commits/master.atom">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic,900">
  <link rel="stylesheet" href="/css/screen.css">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <!--[if lt IE 9]>
  <script src="/js/html5shiv.min.js"></script>
  <script src="/js/respond.min.js"></script>
  <![endif]-->
</head>


<body class="wrap">
  <header role="banner">
  <nav class="mobile-nav show-on-mobiles">
    <ul>
  <li>
    <img src="/img/brand-logo.png" alt="Citrus"><span class="brand hide-on-mobiles">Citrus</span>
  </li>
  <li class="">
    <a href="/">Home</a>
  </li>
  <li class="">
    <a href="/projects/">Projects</a>
  </li>
  <li class="">
    <a href="/docs/documentation/">Doc<span class="hide-on-mobiles">umentation</span><span class="show-on-mobiles">s</span></a>
  </li>
  <li class="">
    <a href="/samples/">Samples</a>
  </li>
  <li class="">
    <a href="/news/">News<span class="hide-on-mobiles"> &amp; Blog</span></a>
  </li>
  <li class="">
    <a href="/help/">Help</a>
  </li>
  <li>
    <a href="https://github.com/citrusframework/citrus" target="_blank"><span class="hide-on-mobiles">View on </span>GitHub</a>
  </li>
</ul>

  </nav>
  <div class="grid">
    <nav class="main-nav whole hide-on-mobiles">
      <ul>
  <li>
    <img src="/img/brand-logo.png" alt="Citrus"><span class="brand hide-on-mobiles">Citrus</span>
  </li>
  <li class="">
    <a href="/">Home</a>
  </li>
  <li class="">
    <a href="/projects/">Projects</a>
  </li>
  <li class="">
    <a href="/docs/documentation/">Doc<span class="hide-on-mobiles">umentation</span><span class="show-on-mobiles">s</span></a>
  </li>
  <li class="">
    <a href="/samples/">Samples</a>
  </li>
  <li class="">
    <a href="/news/">News<span class="hide-on-mobiles"> &amp; Blog</span></a>
  </li>
  <li class="">
    <a href="/help/">Help</a>
  </li>
  <li>
    <a href="https://github.com/citrusframework/citrus" target="_blank"><span class="hide-on-mobiles">View on </span>GitHub</a>
  </li>
</ul>

    </nav>
  </div>
</header>


    <section class="samples">
    <div class="grid">

      <div class="samples-nav-mobile unit whole show-on-mobiles">
  <select onchange="if (this.value) window.location.href=this.value">
    <option value="">Navigate the samples…</option>
    <option value="/samples/">Overview</option>
    <option value="/samples/todo-app/">Sample app</option>
    <option value="/samples/run/">Running</option>
    
    
    <option value="/samples/binary/">sample-binary</option>
    
    <option value="/samples/kafka/">sample-kafka</option>
    
    <option value="/samples/camel-context/">sample-camel-context</option>
    
    <option value="/samples/dynamic-endpoints/">sample-dynamic-endpoints</option>
    
    <option value="/samples/javaconfig/">sample-javaconfig</option>
    
    <option value="/samples/jms/">sample-jms</option>
    
    <option value="/samples/mail/">sample-mail</option>
    
    <option value="/samples/gradle/">sample-gradle</option>
    
    <option value="/samples/selenium/">sample-selenium</option>
    
    <option value="/samples/arquillian/">sample-javaee</option>
    
    <option value="/samples/kubernetes/">sample-kubernetes</option>
    
    <option value="/samples/hamcrest/">sample-hamcrest</option>
    
    <option value="/samples/docker/">sample-docker</option>
    
    <option value="/samples/reporting/">sample-reporting</option>
    
    <option value="/samples/annotation-config/">sample-annotation-config</option>
    
    <option value="/samples/message-store/">sample-message-store</option>
    
    <option value="/samples/behavior/">sample-behavior</option>
    
    <option value="/samples/dictionaries/">sample-dictionaries</option>
    
    <option value="/samples/rmi/">sample-rmi</option>
    
    <option value="/samples/quarkus/">sample-quarkus</option>
    
    <option value="/samples/cucumber-spring/">sample-cucumber-spring</option>
    
    <option value="/samples/cucumber/">sample-cucumber</option>
    
    <option value="/samples/jdbc/">sample-jdbc</option>
    
    <option value="/samples/sql/">sample-sql</option>
    
    <option value="/samples/ftp/">sample-ftp</option>
    
    <option value="/samples/sftp/">sample-sftp</option>
    
    <option value="/samples/scp/">sample-scp</option>
    
    <option value="/samples/http-form-data/">sample-http-form-data</option>
    
    <option value="/samples/http/">sample-http</option>
    
    <option value="/samples/http-basic-auth/">sample-http-basic-auth</option>
    
    <option value="/samples/http-loadtest/">sample-http-loadtest</option>
    
    <option value="/samples/https/">sample-https</option>
    
    <option value="/samples/swagger/">sample-swagger</option>
    
    <option value="/samples/databind/">sample-databind</option>
    
    <option value="/samples/json/">sample-json</option>
    
    <option value="/samples/junit5/">sample-junit5</option>
    
    <option value="/samples/junit/">sample-junit</option>
    
    <option value="/samples/soap-attachment/">sample-soap-attachment</option>
    
    <option value="/samples/soap/">sample-soap</option>
    
    <option value="/samples/soap-mtom/">sample-soap-mtom</option>
    
    <option value="/samples/wsdl/">sample-wsdl</option>
    
    <option value="/samples/soap-ssl/">sample-soap-ssl</option>
    
    <option value="/samples/soap-wssecurity/">sample-soap-wssecurity</option>
    
    <option value="/samples/http-static-response/">sample-http-static-response</option>
    
    <option value="/samples/soap-wsaddressing/">sample-soap-wsaddressing</option>
    
    <option value="/samples/soap-static-response/">sample-soap-static-response</option>
    
    <option value="/samples/dataprovider/">sample-dataprovider</option>
    
    <option value="/samples/testng/">sample-testng</option>
    
    <option value="/samples/xml/">sample-xml</option>
    
    <option value="/samples/xhtml/">sample-xhtml</option>
    
    <option value="/samples/oxm/">sample-oxm</option>
    
  </select>
</div>


      <div class="unit four-fifths">
        <article>
  <h2>
    Quarkus sample
    <a href="/samples/quarkus/" class="permalink" title="Permalink">∞</a>
  </h2>
  <div class="right">
    
    <a href="https://github.com/citrusframework/citrus-samples/blob/master/demo/sample-quarkus" target="_blank">
      <i class="fa fa-pencil"></i> View source code
    </a>
    
    
  </div>
  <span class="post-category">
    <span class="label">
      samples
    </span>
  </span>
  <div class="post-content">
    <p>This project uses Quarkus to implement a sample event-driven application and shows how to verify the event processing with an automated integration test written in <a href="https://citrusframework.org">Citrus</a>.
The Quarkus support in Citrus is described in more detail in <a href="https://citrusframework.org/citrus/reference/html#runtime-quarkus">reference guide</a></p>

<h2 id="objectives">Objectives</h2>

<p>The project uses the Quarkus test framework to set up a dev services environment with JUnit Jupiter where the application is running on the local machine.
The Quarkus dev services capabilities will automatically start Testcontainers during the test in order to simulate the surrounding infrastructure
(e.g. PostgreSQL database and the Kafka message broker).</p>

<p>If you want to learn more about Quarkus, please visit its website: <a href="https://quarkus.io/">https://quarkus.io/</a>.</p>

<h2 id="quarkus-sample-application">Quarkus sample application</h2>

<p>The Quarkus sample demo application is a food market event-driven application that listens for incoming events of type <code class="highlighter-rouge">booking</code> and <code class="highlighter-rouge">supply</code>.</p>

<p><img src="/img/assets/sample-quarkus/food-market-app-demo.png" alt="Food Market App"></p>

<p>Users are able to add booking events. Each of them references a product and gives an amount as well as an accepted price in a simple Json object structure.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w"> </span><span class="s2">"client"</span><span class="p">:</span><span class="w"> </span><span class="s2">"citrus-test"</span><span class="p">,</span><span class="w"> </span><span class="s2">"product"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Pineapple"</span><span class="p">,</span><span class="w"> </span><span class="s2">"amount"</span><span class="p">:</span><span class="w">  </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="s2">"price"</span><span class="p">:</span><span class="w">  </span><span class="mf">0.99</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>At the same time suppliers may add their individual supply events that again reference a product with an amount and a selling price.</p>

<p>The Quarkus application consumes both event types and as soon as bookings and supplies do match in all criteria the food market application will produce booking-completed and shipping events as a result.</p>

<p>All events are produced and consumed with Kafka event streams.
The domain model objects with their individual status are stored in a PostgreSQL database.</p>

<h2 id="adding-citrus-to-the-project">Adding Citrus to the project</h2>

<p>Looking at the Maven <code class="highlighter-rouge">pom.xml</code> you will see that Citrus is added as a test scoped dependency.
The most convenient way to add Citrus to your project is to import the <code class="highlighter-rouge">citrus-bom</code>.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependencyManagement&gt;</span>
    <span class="nt">&lt;dependencies&gt;</span>
      <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.citrusframework<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>citrus-bom<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>4.2.0<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
      <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>
  <span class="nt">&lt;/dependencyManagement&gt;</span>
</code></pre></div></div>

<p>Citrus is very modular. This means you can choose from a wide range of modules that add specific testing capabilities to the project (e.g. citrus-kafka, citrus-http, citrus-mail, …).
In this sample project we include the following modules as test scoped dependencies:</p>

<ul>
  <li>citrus-quarkus</li>
  <li>citrus-kafka</li>
  <li>citrus-http</li>
  <li>citrus-sql</li>
  <li>citrus-selenium</li>
  <li>citrus-validation-json</li>
  <li>citrus-validation-text</li>
</ul>

<p>The <code class="highlighter-rouge">citrus-quarkus</code> module provides the QuarkusTest resource implementation that enables Citrus on a Quarkus test.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.citrusframework<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>citrus-quarkus<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<p>The other modules add very specific Citrus capabilities such as validation of a Json message payload.</p>

<p>This completes the dependency setup.
Now we can move on to writing an automated integration test that verifies the Quarkus application.</p>

<h2 id="enable-citrus-with-quarkustest">Enable Citrus with <a href="https://github.com/QuarkusTest" class="user-mention">@QuarkusTest</a>
</h2>

<p>The test uses an arbitrary <code class="highlighter-rouge">@QuarkusTest</code> annotation with JUnit Jupiter.
This means that Quarkus takes care of starting the application under test.
It also starts some Testcontainers for the PostgreSQL database and the Kafka message broker.</p>

<p>You can enable the Citrus capabilities on the test by adding the <code class="highlighter-rouge">@CitrusSupport</code> annotation to the test class.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@QuarkusTest</span>
<span class="nd">@CitrusSupport</span>
<span class="kd">class</span> <span class="nc">FoodMarketApplicationTest</span> <span class="o">{</span>

    <span class="nd">@CitrusResource</span>
    <span class="n">TestCaseRunner</span> <span class="n">t</span><span class="o">;</span>

    <span class="nd">@Inject</span>
    <span class="n">ObjectMapper</span> <span class="n">mapper</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">shouldProcessEvents</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">createBooking</span><span class="o">();</span>
        
        <span class="n">createSupply</span><span class="o">();</span>
        
        <span class="n">verifyBookingCompletedEvent</span><span class="o">();</span>
        
        <span class="n">verifyShippingEvent</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The Citrus enabled test is able to inject additional resources such as the <code class="highlighter-rouge">TestCaseRunner</code>.
This runner is the entrance to all Citrus related test actions like send/receive messages or querying and verifying entities in the database.</p>

<p>The test will perform four main actions:</p>
<ul>
  <li>Create a booking event</li>
  <li>Create a matching supply event</li>
  <li>Verify the booking completed event</li>
  <li>Verify the shipping event</li>
</ul>

<p>In first version of the test all events will be sent/received via the Kafka message broker.</p>

<h2 id="stage-1-prototyping-the-test">Stage #1: Prototyping the test</h2>

<p>Citrus is able to send and receive messages via Kafka quite easily.
You can use a dynamic endpoint URL (e.g. <code class="highlighter-rouge">kafka:my-topic-name</code>) to exchange data.
The message content (header and body) is given with simple inline Json Strings in this first prototype.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@QuarkusTest</span>
<span class="nd">@CitrusSupport</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FoodMarketDemoTest</span> <span class="o">{</span>

    <span class="nd">@CitrusResource</span>
    <span class="n">TestCaseRunner</span> <span class="n">t</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">shouldMatchBookingAndSupply</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">createBooking</span><span class="o">();</span>

        <span class="n">createSupply</span><span class="o">();</span>

        <span class="n">verifyBookingCompletedEvent</span><span class="o">();</span>

        <span class="n">verifyShippingEvent</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">createBooking</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">t</span><span class="o">.</span><span class="na">when</span><span class="o">(</span><span class="n">send</span><span class="o">()</span>
                <span class="o">.</span><span class="na">endpoint</span><span class="o">(</span><span class="s">"kafka:bookings"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">message</span><span class="o">()</span>
                <span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="s">"""
                    {
                        "</span><span class="n">client</span><span class="s">": "</span><span class="n">citrus</span><span class="s">",
                        "</span><span class="n">product</span><span class="s">": {
                            "</span><span class="n">name</span><span class="s">": "</span><span class="n">Kiwi</span><span class="s">"
                        },
                        "</span><span class="n">amount</span><span class="s">": 10,
                        "</span><span class="n">price</span><span class="s">": 0.99,
                        "</span><span class="n">shippingAddress</span><span class="s">": "</span><span class="mo">001</span><span class="o">,</span> <span class="n">Foo</span> <span class="n">Blvd</span><span class="o">.</span><span class="s">"
                    }
                """</span><span class="o">)</span>
        <span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">//...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The injected Citrus <code class="highlighter-rouge">TestCaseRunner</code> <code class="highlighter-rouge">t</code> is able to use Gherkin Given-When-Then syntax and references the KafkaEndpoint <code class="highlighter-rouge">kafka:bookings</code> in the send operation.
The message body is a simple Json String that represents the booking.</p>

<p>The rest of the story is quite easy.
In the same way we can also send a <code class="highlighter-rouge">supply</code> event and then receive <code class="highlighter-rouge">completed</code> and <code class="highlighter-rouge">shipping</code> events in the test.</p>

<p>When receiving the <code class="highlighter-rouge">completed</code> and <code class="highlighter-rouge">shipping</code> events the test is able to use the Citrus Json validation power coming with the <code class="highlighter-rouge">citrus-validation-json</code> module.
Citrus will compare the received Json object with an expected template and make sure that all fields and properties do match as expected.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">FoodMarketApplicationTest</span> <span class="o">{</span>

    <span class="c1">// ...</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">verifyBookingCompletedEvent</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">t</span><span class="o">.</span><span class="na">then</span><span class="o">(</span><span class="n">receive</span><span class="o">()</span>
                <span class="o">.</span><span class="na">endpoint</span><span class="o">(</span><span class="s">"kafka:completed?timeout=10000&amp;consumerGroup=citrus-booking"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">message</span><span class="o">()</span>
                <span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="s">"""
                    {
                        "</span><span class="n">client</span><span class="s">": "</span><span class="n">citrus</span><span class="s">",
                        "</span><span class="n">product</span><span class="s">": "</span><span class="n">Kiwi</span><span class="s">",
                        "</span><span class="n">amount</span><span class="s">": 10,
                        "</span><span class="n">status</span><span class="s">": "</span><span class="n">COMPLETED</span><span class="s">"
                    }
                """</span><span class="o">)</span>
        <span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The Citrus Json validation will now compare the received event with the expected Json object and fail the test when there is a mismatch.</p>

<p><em>Citrus Json validation</em></p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w"> </span><span class="s2">"client"</span><span class="p">:</span><span class="w">  </span><span class="s2">"citrus"</span><span class="p">,</span><span class="w"> </span><span class="s2">"product"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Kiwi"</span><span class="p">,</span><span class="w"> </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"COMPLETED"</span><span class="w"> </span><span class="p">}</span><span class="w">

</span><span class="err">//</span><span class="w"> </span><span class="err">compared</span><span class="w"> </span><span class="err">to</span><span class="w">

</span><span class="p">{</span><span class="w"> </span><span class="s2">"client"</span><span class="p">:</span><span class="w">  </span><span class="s2">"citrus"</span><span class="p">,</span><span class="w"> </span><span class="s2">"product"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Kiwi"</span><span class="p">,</span><span class="w"> </span><span class="s2">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"COMPLETED"</span><span class="w"> </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>The Json validation is very powerful.
You can ignore properties (expected value set to <code class="highlighter-rouge">@ignore@</code>), use validation matchers, functions and test variables.
A mismatch in the order of elements or some difference in the formatting of the Json document is not failing the test.</p>

<p>In case there is a mismatch you will be provided with an error and the test fails accordingly.</p>

<h2 id="running-the-citrus-tests">Running the Citrus tests</h2>

<p>The Quarkus test framework uses JUnit Jupiter as a test driver.
This means you can run the tests just like any other JUnit test (e.g. from your Java IDE, with Maven).</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./mvnw <span class="nb">test</span>
</code></pre></div></div>

<p>The Citrus test capabilities are added on top of <code class="highlighter-rouge">@QuarkusTest</code> with the <code class="highlighter-rouge">@CitrusSupport</code> annotation.
So you will not need any other configuration to empower the tests with Citrus.</p>

<h2 id="stage-2-use-endpoint-builders-and-domain-model-objects">Stage #2: Use endpoint builders and domain model objects</h2>

<p>Using the dynamic endpoint <code class="highlighter-rouge">kafka:my-topic-name</code> may be a good and easy start for prototyping.
When it comes to writing more tests in your project you may want to leverage a central Kafka endpoint configuration and reuse it in multiple tests.</p>

<p>You can add a <code class="highlighter-rouge">@CitrusConfiguration</code> annotation that loads endpoints from one to many configuration classes.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@QuarkusTest</span>
<span class="nd">@CitrusSupport</span>
<span class="nd">@CitrusConfiguration</span><span class="o">(</span><span class="n">classes</span> <span class="o">=</span> <span class="o">{</span> <span class="n">CitrusEndpointConfig</span><span class="o">.</span><span class="na">class</span> <span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FoodMarketDemoTest</span> <span class="o">{</span>

    <span class="nd">@CitrusResource</span>
    <span class="n">TestCaseRunner</span> <span class="n">t</span><span class="o">;</span>

    <span class="nd">@CitrusEndpoint</span>
    <span class="n">KafkaEndpoint</span> <span class="n">supplies</span><span class="o">;</span>

    <span class="nd">@CitrusEndpoint</span>
    <span class="n">KafkaEndpoint</span> <span class="n">bookings</span><span class="o">;</span>

    <span class="nd">@CitrusEndpoint</span>
    <span class="n">KafkaEndpoint</span> <span class="n">completed</span><span class="o">;</span>

    <span class="nd">@CitrusEndpoint</span>
    <span class="n">KafkaEndpoint</span> <span class="n">shipping</span><span class="o">;</span>

    <span class="c1">// code the tests</span>
<span class="o">}</span>
</code></pre></div></div>

<p>In the loaded <code class="highlighter-rouge">CitrusEndpointConfig</code> class the Kafka endpoint instances get configured for all tests that load the configuration.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CitrusEndpointConfig</span> <span class="o">{</span>

    <span class="nd">@BindToRegistry</span>
    <span class="kd">public</span> <span class="n">KafkaEndpoint</span> <span class="nf">bookings</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">kafka</span><span class="o">()</span>
                <span class="o">.</span><span class="na">asynchronous</span><span class="o">()</span>
                <span class="o">.</span><span class="na">topic</span><span class="o">(</span><span class="s">"bookings"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@BindToRegistry</span>
    <span class="kd">public</span> <span class="n">KafkaEndpoint</span> <span class="nf">supplies</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">kafka</span><span class="o">()</span>
                <span class="o">.</span><span class="na">asynchronous</span><span class="o">()</span>
                <span class="o">.</span><span class="na">topic</span><span class="o">(</span><span class="s">"supplies"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@BindToRegistry</span>
    <span class="kd">public</span> <span class="n">KafkaEndpoint</span> <span class="nf">shipping</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">kafka</span><span class="o">()</span>
                <span class="o">.</span><span class="na">asynchronous</span><span class="o">()</span>
                <span class="o">.</span><span class="na">topic</span><span class="o">(</span><span class="s">"shipping"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">consumerGroup</span><span class="o">(</span><span class="s">"citrus-shipping"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">timeout</span><span class="o">(</span><span class="mi">10000L</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@BindToRegistry</span>
    <span class="kd">public</span> <span class="n">KafkaEndpoint</span> <span class="nf">completed</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">kafka</span><span class="o">()</span>
                <span class="o">.</span><span class="na">asynchronous</span><span class="o">()</span>
                <span class="o">.</span><span class="na">topic</span><span class="o">(</span><span class="s">"completed"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">consumerGroup</span><span class="o">(</span><span class="s">"citrus-completed"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">timeout</span><span class="o">(</span><span class="mi">10000L</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="c1">// more endpoints</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The configuration class uses the KafkaEndpoint builder and binds the components to the Citrus registry.
With that configuration you can inject the endpoint instances in your test with the <code class="highlighter-rouge">@CitrusEndpoint</code> annotation.</p>

<p>Now you can reference the endpoint in Citrus send/receive test actions.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Product</span> <span class="n">product</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Product</span><span class="o">(</span><span class="s">"Kiwi"</span><span class="o">);</span>
<span class="n">Booking</span> <span class="n">booking</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Booking</span><span class="o">(</span><span class="s">"citrus"</span><span class="o">,</span> <span class="n">product</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mf">0.99</span><span class="n">D</span><span class="o">,</span> <span class="n">TestHelper</span><span class="o">.</span><span class="na">createShippingAddress</span><span class="o">().</span><span class="na">getFullAddress</span><span class="o">());</span>

<span class="kd">private</span> <span class="kt">void</span> <span class="nf">createBooking</span><span class="o">(</span><span class="n">Booking</span> <span class="n">booking</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">t</span><span class="o">.</span><span class="na">when</span><span class="o">(</span><span class="n">send</span><span class="o">()</span>
        <span class="o">.</span><span class="na">endpoint</span><span class="o">(</span><span class="n">bookings</span><span class="o">)</span>
        <span class="o">.</span><span class="na">message</span><span class="o">()</span>
        <span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="n">marshal</span><span class="o">(</span><span class="n">booking</span><span class="o">))</span>
    <span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Another improvement for the test is to use the domain model object <code class="highlighter-rouge">Booking</code> as a message payload instead of using the inline Json String.</p>

<h2 id="stage-3-add-mail-verification">Stage #3: Add mail verification</h2>

<p>So far the test has been using Kafka endpoints exclusively.
Citrus provides a huge set of components to connect to different messaging transports and technologies.</p>

<p>As a next step the test verifies a mail message that is sent by the Quarkus application when a booking has been completed.</p>

<p>First of all the configuration adds a Citrus mail server.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@BindToRegistry</span>
<span class="kd">public</span> <span class="n">MailServer</span> <span class="nf">mailServer</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">mail</span><span class="o">().</span><span class="na">server</span><span class="o">()</span>
            <span class="o">.</span><span class="na">port</span><span class="o">(</span><span class="mi">2222</span><span class="o">)</span>
            <span class="o">.</span><span class="na">knownUsers</span><span class="o">(</span><span class="n">Collections</span><span class="o">.</span><span class="na">singletonList</span><span class="o">(</span><span class="s">"foodmarket@quarkus.io:foodmarket:secr3t"</span><span class="o">))</span>
            <span class="o">.</span><span class="na">autoAccept</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
            <span class="o">.</span><span class="na">autoStart</span><span class="o">(</span><span class="kc">true</span><span class="o">)</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The mail server accepts incoming mail requests on port <code class="highlighter-rouge">2222</code> and adds some known users.
The Quarkus application then uses the connection credentials in the <code class="highlighter-rouge">application.properties</code>.</p>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">quarkus.mailer.mock</span><span class="p">=</span><span class="s">false</span>
<span class="py">quarkus.mailer.own-host-name</span><span class="p">=</span><span class="s">localhost</span>
<span class="py">quarkus.mailer.from</span><span class="p">=</span><span class="s">foodmarket@quarkus.io</span>
<span class="py">quarkus.mailer.host</span><span class="p">=</span><span class="s">localhost</span>
<span class="py">quarkus.mailer.port</span><span class="p">=</span><span class="s">2222</span>

<span class="py">quarkus.mailer.username</span><span class="p">=</span><span class="s">foodmarket</span>
<span class="py">quarkus.mailer.password</span><span class="p">=</span><span class="s">secr3t</span>
<span class="py">quarkus.mailer.start-tls</span><span class="p">=</span><span class="s">OPTIONAL</span>
</code></pre></div></div>

<p>The test is able to reference this mail server to verify the mail sent by Quarkus.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">verifyBookingCompletedMail</span><span class="o">(</span><span class="n">Booking</span> <span class="n">booking</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">t</span><span class="o">.</span><span class="na">then</span><span class="o">(</span><span class="n">receive</span><span class="o">()</span>
            <span class="o">.</span><span class="na">endpoint</span><span class="o">(</span><span class="n">mailServer</span><span class="o">)</span>
            <span class="o">.</span><span class="na">message</span><span class="o">(</span><span class="n">MailMessage</span><span class="o">.</span><span class="na">request</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="s">"foodmarket@quarkus.io"</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"%s@quarkus.io"</span><span class="o">.</span><span class="na">formatted</span><span class="o">(</span><span class="n">booking</span><span class="o">.</span><span class="na">getClient</span><span class="o">()))</span>
                    <span class="o">.</span><span class="na">subject</span><span class="o">(</span><span class="s">"Booking completed!"</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="s">"Hey %s, your booking %s has been completed."</span>
                            <span class="o">.</span><span class="na">formatted</span><span class="o">(</span><span class="n">booking</span><span class="o">.</span><span class="na">getClient</span><span class="o">(),</span> <span class="n">booking</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getName</span><span class="o">()),</span> <span class="s">"text/plain"</span><span class="o">)));</span>

    <span class="n">t</span><span class="o">.</span><span class="na">then</span><span class="o">(</span><span class="n">send</span><span class="o">()</span>
            <span class="o">.</span><span class="na">endpoint</span><span class="o">(</span><span class="n">mailServer</span><span class="o">)</span>
            <span class="o">.</span><span class="na">message</span><span class="o">(</span><span class="n">MailMessage</span><span class="o">.</span><span class="na">response</span><span class="o">(</span><span class="mi">250</span><span class="o">)));</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The mail verification includes the validation of all mail related properties (e.g. from, to, subject, body) and the simulation of the mail server response (250 OK).
This is a good point to simulate a mail server error in order to verify the resilience and the error handling on the Quarkus application.</p>

<h2 id="stage-4-use-testbehaviors">Stage #4: Use TestBehaviors</h2>

<p>Citrus has the concept of TestBehaviors to reuse a set of test actions in multiple tests.
The mail verification steps may be added into a behavior so many tests can make use of it.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">VerifyBookingCompletedMail</span> <span class="kd">implements</span> <span class="n">TestBehavior</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Booking</span> <span class="n">booking</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">MailServer</span> <span class="n">mailServer</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">VerifyBookingCompletedMail</span><span class="o">(</span><span class="n">Booking</span> <span class="n">booking</span><span class="o">,</span> <span class="n">MailServer</span> <span class="n">mailServer</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">booking</span> <span class="o">=</span> <span class="n">booking</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">mailServer</span> <span class="o">=</span> <span class="n">mailServer</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">apply</span><span class="o">(</span><span class="n">TestActionRunner</span> <span class="n">t</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">t</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">receive</span><span class="o">()</span>
            <span class="o">.</span><span class="na">endpoint</span><span class="o">(</span><span class="n">mailServer</span><span class="o">)</span>
            <span class="o">.</span><span class="na">message</span><span class="o">(</span><span class="n">MailMessage</span><span class="o">.</span><span class="na">request</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="s">"foodmarket@quarkus.io"</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">to</span><span class="o">(</span><span class="s">"%s@quarkus.io"</span><span class="o">.</span><span class="na">formatted</span><span class="o">(</span><span class="n">booking</span><span class="o">.</span><span class="na">getClient</span><span class="o">()))</span>
                    <span class="o">.</span><span class="na">subject</span><span class="o">(</span><span class="s">"Booking completed!"</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="s">"Hey %s, your booking %s has been completed."</span>
                            <span class="o">.</span><span class="na">formatted</span><span class="o">(</span><span class="n">booking</span><span class="o">.</span><span class="na">getClient</span><span class="o">(),</span> <span class="n">booking</span><span class="o">.</span><span class="na">getProduct</span><span class="o">().</span><span class="na">getName</span><span class="o">()),</span> <span class="s">"text/plain"</span><span class="o">))</span>
        <span class="o">);</span>

        <span class="n">t</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">send</span><span class="o">()</span>
            <span class="o">.</span><span class="na">endpoint</span><span class="o">(</span><span class="n">mailServer</span><span class="o">)</span>
            <span class="o">.</span><span class="na">message</span><span class="o">(</span><span class="n">MailMessage</span><span class="o">.</span><span class="na">response</span><span class="o">())</span>
        <span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The test is able to apply the behavior quite easily.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">verifyBookingCompletedMail</span><span class="o">(</span><span class="n">Booking</span> <span class="n">booking</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">t</span><span class="o">.</span><span class="na">then</span><span class="o">(</span><span class="n">t</span><span class="o">.</span><span class="na">applyBehavior</span><span class="o">(</span><span class="k">new</span> <span class="n">VerifyBookingCompletedMail</span><span class="o">(</span><span class="n">booking</span><span class="o">,</span> <span class="n">mailServer</span><span class="o">)));</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="stage-5-use-the-http-rest-api">Stage #5: Use the Http REST API</h2>

<p>The Quarkus application under test also provides a Http REST API to manage bookings and supplies.</p>

<p>The Citrus test is able to call the REST API with a Http client.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@BindToRegistry</span>
<span class="kd">public</span> <span class="n">HttpClient</span> <span class="nf">foodMarketApiClient</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">http</span><span class="o">().</span><span class="na">client</span><span class="o">()</span>
            <span class="o">.</span><span class="na">requestUrl</span><span class="o">(</span><span class="s">"http://localhost:8081"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">createBooking</span><span class="o">(</span><span class="n">Booking</span> <span class="n">booking</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">t</span><span class="o">.</span><span class="na">when</span><span class="o">(</span><span class="n">http</span><span class="o">()</span>
            <span class="o">.</span><span class="na">client</span><span class="o">(</span><span class="n">foodMarketApiClient</span><span class="o">)</span>
            <span class="o">.</span><span class="na">send</span><span class="o">()</span>
            <span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="s">"/api/bookings"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">message</span><span class="o">()</span>
            <span class="o">.</span><span class="na">contentType</span><span class="o">(</span><span class="n">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON_VALUE</span><span class="o">)</span>
            <span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="n">marshal</span><span class="o">(</span><span class="n">booking</span><span class="o">))</span>
    <span class="o">);</span>

    <span class="n">t</span><span class="o">.</span><span class="na">then</span><span class="o">(</span><span class="n">http</span><span class="o">()</span>
            <span class="o">.</span><span class="na">client</span><span class="o">(</span><span class="n">foodMarketApiClient</span><span class="o">)</span>
            <span class="o">.</span><span class="na">receive</span><span class="o">()</span>
            <span class="o">.</span><span class="na">response</span><span class="o">(</span><span class="n">HttpStatus</span><span class="o">.</span><span class="na">CREATED</span><span class="o">)</span>
            <span class="o">.</span><span class="na">message</span><span class="o">()</span>
            <span class="o">.</span><span class="na">extract</span><span class="o">(</span><span class="n">json</span><span class="o">().</span><span class="na">expression</span><span class="o">(</span><span class="s">"$.id"</span><span class="o">,</span> <span class="s">"bookingId"</span><span class="o">))</span>
    <span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The test now sends a Http POST request to create the booking.
The client is able to verify the Http response <code class="highlighter-rouge">201 CREATED</code> and also save the generated booking id for later reference in the test.</p>

<h1 id="stage-6-verify-entities-in-the-database">Stage #6: Verify entities in the database</h1>

<p>The test may also verify the entities saved to the PostgreSQL database.
The <code class="highlighter-rouge">@QuarkusTest</code> dev services is able to inject the dataSource that connects to the PostgreSQL database Testcontainers that is startes as part of the test.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Inject</span>
<span class="n">DataSource</span> <span class="n">dataSource</span><span class="o">;</span>

<span class="kd">private</span> <span class="kt">void</span> <span class="nf">verifyBookingStatus</span><span class="o">(</span><span class="n">Booking</span><span class="o">.</span><span class="na">Status</span> <span class="n">status</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">t</span><span class="o">.</span><span class="na">then</span><span class="o">(</span><span class="n">sql</span><span class="o">()</span>
        <span class="o">.</span><span class="na">dataSource</span><span class="o">(</span><span class="n">dataSource</span><span class="o">)</span>
        <span class="o">.</span><span class="na">query</span><span class="o">()</span>
        <span class="o">.</span><span class="na">statement</span><span class="o">(</span><span class="s">"select status from booking where booking.id=${bookingId}"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="s">"status"</span><span class="o">,</span> <span class="n">status</span><span class="o">.</span><span class="na">name</span><span class="o">())</span>
    <span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The SQL verification uses the extracted <code class="highlighter-rouge">bookingId</code> test variable to identify the entity in the database.
The returned result set gets verified with the expected column values (e.g. <code class="highlighter-rouge">status=COMPLETED</code>)</p>

<h2 id="stage-7-use-openapi-specification">Stage #7: Use OpenAPI specification</h2>

<p>The Quarkus application also exposes its OpenAPI specification for the REST API.
The Citrus test is able to leverage this specification when sending/receiving Http messages.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kd">final</span> <span class="n">OpenApiSpecification</span> <span class="n">foodMarketSpec</span> <span class="o">=</span>
            <span class="n">OpenApiSpecification</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="s">"http://localhost:8081/q/openapi"</span><span class="o">);</span>

<span class="kd">private</span> <span class="kt">void</span> <span class="nf">createBooking</span><span class="o">(</span><span class="n">Booking</span> <span class="n">booking</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">t</span><span class="o">.</span><span class="na">when</span><span class="o">(</span><span class="n">openapi</span><span class="o">()</span>
        <span class="o">.</span><span class="na">specification</span><span class="o">(</span><span class="n">foodMarketSpec</span><span class="o">)</span>
        <span class="o">.</span><span class="na">client</span><span class="o">(</span><span class="n">foodMarketApiClient</span><span class="o">)</span>
        <span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="s">"addBooking"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">message</span><span class="o">()</span>
        <span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="n">marshal</span><span class="o">(</span><span class="n">booking</span><span class="o">))</span>
    <span class="o">);</span>

    <span class="n">t</span><span class="o">.</span><span class="na">then</span><span class="o">(</span><span class="n">openapi</span><span class="o">()</span>
        <span class="o">.</span><span class="na">specification</span><span class="o">(</span><span class="n">foodMarketSpec</span><span class="o">)</span>
        <span class="o">.</span><span class="na">client</span><span class="o">(</span><span class="n">foodMarketApiClient</span><span class="o">)</span>
        <span class="o">.</span><span class="na">receive</span><span class="o">(</span><span class="s">"addBooking"</span><span class="o">,</span> <span class="n">HttpStatus</span><span class="o">.</span><span class="na">CREATED</span><span class="o">)</span>
        <span class="o">.</span><span class="na">message</span><span class="o">()</span>
        <span class="o">.</span><span class="na">extract</span><span class="o">(</span><span class="n">json</span><span class="o">().</span><span class="na">expression</span><span class="o">(</span><span class="s">"$.id"</span><span class="o">,</span> <span class="s">"bookingId"</span><span class="o">))</span>
    <span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The test loads the OpenAPI specification from the Quarkus application with the URL <code class="highlighter-rouge">http://localhost:8081/q/openapi</code>.
The specification then is used with the Http send test action.</p>

<p>The action references an operation with the id <code class="highlighter-rouge">addBooking</code>.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">---</span>
<span class="na">openapi</span><span class="pi">:</span> <span class="s">3.0.3</span>
<span class="na">info</span><span class="pi">:</span>
  <span class="na">title</span><span class="pi">:</span> <span class="s">citrus-demo-quarkus API</span>
  <span class="na">version</span><span class="pi">:</span> <span class="s">1.0.0</span>
<span class="na">servers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">url</span><span class="pi">:</span> <span class="s">http://localhost:8080</span>
    <span class="na">description</span><span class="pi">:</span> <span class="s">Auto generated value</span>
  <span class="pi">-</span> <span class="na">url</span><span class="pi">:</span> <span class="s">http://0.0.0.0:8080</span>
    <span class="na">description</span><span class="pi">:</span> <span class="s">Auto generated value</span>
<span class="na">paths</span><span class="pi">:</span>
  <span class="s">/api/bookings</span><span class="pi">:</span>
    <span class="na">post</span><span class="pi">:</span>
      <span class="na">operationId</span><span class="pi">:</span> <span class="s">addBooking</span>
      <span class="na">requestBody</span><span class="pi">:</span>
        <span class="na">content</span><span class="pi">:</span>
          <span class="s">application/json</span><span class="pi">:</span>
            <span class="na">schema</span><span class="pi">:</span>
              <span class="s">$ref</span><span class="pi">:</span> <span class="s1">'</span><span class="s">#/components/schemas/Booking'</span>
      <span class="na">responses</span><span class="pi">:</span>
        <span class="s2">"</span><span class="s">200"</span><span class="pi">:</span>
          <span class="na">description</span><span class="pi">:</span> <span class="s">OK</span>
</code></pre></div></div>

<p>The Citrus test action now leverages information given in the specification such as resource path <code class="highlighter-rouge">/api/bookings</code> and the content type <code class="highlighter-rouge">application/json</code>.</p>

<h1 id="stage-8-ui-testing-with-selenium">Stage #8: UI testing with Selenium</h1>

<p>Citrus also integrates with Selenium UI testing.
This means that the test is able to open the browser and navigate to the Quarkus application home URL.
Then the test may simulate user interactions such as clicking on links and buttons on the page.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">void</span> <span class="nf">approveBooking</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">t</span><span class="o">.</span><span class="na">given</span><span class="o">(</span><span class="n">selenium</span><span class="o">()</span>
            <span class="o">.</span><span class="na">browser</span><span class="o">(</span><span class="n">browser</span><span class="o">)</span>
            <span class="o">.</span><span class="na">start</span><span class="o">());</span>

    <span class="n">t</span><span class="o">.</span><span class="na">given</span><span class="o">(</span><span class="n">doFinally</span><span class="o">().</span><span class="na">actions</span><span class="o">(</span>
            <span class="n">selenium</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">browser</span><span class="o">(</span><span class="n">browser</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">stop</span><span class="o">()));</span>

    <span class="n">t</span><span class="o">.</span><span class="na">when</span><span class="o">(</span><span class="n">selenium</span><span class="o">()</span>
            <span class="o">.</span><span class="na">browser</span><span class="o">(</span><span class="n">browser</span><span class="o">)</span>
            <span class="o">.</span><span class="na">navigate</span><span class="o">(</span><span class="s">"http://localhost:8081"</span><span class="o">));</span>

    <span class="n">t</span><span class="o">.</span><span class="na">then</span><span class="o">(</span><span class="n">delay</span><span class="o">().</span><span class="na">seconds</span><span class="o">(</span><span class="mi">3</span><span class="o">));</span>

    <span class="n">t</span><span class="o">.</span><span class="na">then</span><span class="o">(</span><span class="n">selenium</span><span class="o">()</span>
            <span class="o">.</span><span class="na">browser</span><span class="o">(</span><span class="n">browser</span><span class="o">)</span>
            <span class="o">.</span><span class="na">click</span><span class="o">()</span>
            <span class="o">.</span><span class="na">element</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="s">"${bookingId}"</span><span class="o">));</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="summary">Summary</h2>

<p>The sample application has shown how you can integrate Citrus within a Quarkus test.
The Quarkus test is able to use the Citrus capabilities because of the Citrus Quarkus extension that is provided since Citrus 4.0.</p>


  </div>
</article>

      </div>

      <div class="unit one-fifth hide-on-mobiles">
  <aside>
    <h4>Common</h4>
    <ul>
      <li class="">
        <a href="/samples/">Overview</a>
      </li>
      <li class="">
        <a href="/samples/todo-app">Sample application</a>
      </li>
      <li class="">
        <a href="/samples/run">Running</a>
      </li>
    </ul>
    <h4>Samples</h4>
    <ul style="margin-top: 5px;">
      
      

      
      
      <li class="">
        <a href="/samples/binary/">sample-binary</a>
      </li>
      
      
      <li class="">
        <a href="/samples/kafka/">sample-kafka</a>
      </li>
      
      
      <li class="">
        <a href="/samples/camel-context/">sample-camel-context</a>
      </li>
      
      
      <li class="">
        <a href="/samples/dynamic-endpoints/">sample-dynamic-endpoints</a>
      </li>
      
      
      <li class="">
        <a href="/samples/javaconfig/">sample-javaconfig</a>
      </li>
      
      
      <li class="">
        <a href="/samples/jms/">sample-jms</a>
      </li>
      
      
      <li class="">
        <a href="/samples/mail/">sample-mail</a>
      </li>
      
      
      <li class="">
        <a href="/samples/gradle/">sample-gradle</a>
      </li>
      
      
      <li class="">
        <a href="/samples/selenium/">sample-selenium</a>
      </li>
      
      
      <li class="">
        <a href="/samples/arquillian/">sample-javaee</a>
      </li>
      
      
      <li class="">
        <a href="/samples/kubernetes/">sample-kubernetes</a>
      </li>
      
      
      <li class="">
        <a href="/samples/hamcrest/">sample-hamcrest</a>
      </li>
      
      
      <li class="">
        <a href="/samples/docker/">sample-docker</a>
      </li>
      
      
      <li class="">
        <a href="/samples/reporting/">sample-reporting</a>
      </li>
      
      
      <li class="">
        <a href="/samples/annotation-config/">sample-annotation-config</a>
      </li>
      
      
      <li class="">
        <a href="/samples/message-store/">sample-message-store</a>
      </li>
      
      
      <li class="">
        <a href="/samples/behavior/">sample-behavior</a>
      </li>
      
      
      <li class="">
        <a href="/samples/dictionaries/">sample-dictionaries</a>
      </li>
      
      
      <li class="">
        <a href="/samples/rmi/">sample-rmi</a>
      </li>
      
      
    </ul>

    
    <h4>Demo  </h4>
    <ul style="margin-top: 5px;">
      
      
      <li class="current">
        <a href="/samples/quarkus/">sample-quarkus</a>
      </li>
      
      
    </ul>

    
    <h4>Samples  Cucumber</h4>
    <ul style="margin-top: 5px;">
      
      
      <li class="">
        <a href="/samples/cucumber-spring/">sample-cucumber-spring</a>
      </li>
      
      
      <li class="">
        <a href="/samples/cucumber/">sample-cucumber</a>
      </li>
      
      
    </ul>

    
    <h4>Samples  Db</h4>
    <ul style="margin-top: 5px;">
      
      
      <li class="">
        <a href="/samples/jdbc/">sample-jdbc</a>
      </li>
      
      
      <li class="">
        <a href="/samples/sql/">sample-sql</a>
      </li>
      
      
    </ul>

    
    <h4>Samples  Ftp</h4>
    <ul style="margin-top: 5px;">
      
      
      <li class="">
        <a href="/samples/ftp/">sample-ftp</a>
      </li>
      
      
      <li class="">
        <a href="/samples/sftp/">sample-sftp</a>
      </li>
      
      
      <li class="">
        <a href="/samples/scp/">sample-scp</a>
      </li>
      
      
    </ul>

    
    <h4>Samples  Http</h4>
    <ul style="margin-top: 5px;">
      
      
      <li class="">
        <a href="/samples/http-form-data/">sample-http-form-data</a>
      </li>
      
      
      <li class="">
        <a href="/samples/http/">sample-http</a>
      </li>
      
      
      <li class="">
        <a href="/samples/http-basic-auth/">sample-http-basic-auth</a>
      </li>
      
      
      <li class="">
        <a href="/samples/http-loadtest/">sample-http-loadtest</a>
      </li>
      
      
      <li class="">
        <a href="/samples/https/">sample-https</a>
      </li>
      
      
      <li class="">
        <a href="/samples/swagger/">sample-swagger</a>
      </li>
      
      
    </ul>

    
    <h4>Samples  Json</h4>
    <ul style="margin-top: 5px;">
      
      
      <li class="">
        <a href="/samples/databind/">sample-databind</a>
      </li>
      
      
      <li class="">
        <a href="/samples/json/">sample-json</a>
      </li>
      
      
    </ul>

    
    <h4>Samples  Junit</h4>
    <ul style="margin-top: 5px;">
      
      
      <li class="">
        <a href="/samples/junit5/">sample-junit5</a>
      </li>
      
      
      <li class="">
        <a href="/samples/junit/">sample-junit</a>
      </li>
      
      
    </ul>

    
    <h4>Samples  Soap</h4>
    <ul style="margin-top: 5px;">
      
      
      <li class="">
        <a href="/samples/soap-attachment/">sample-soap-attachment</a>
      </li>
      
      
      <li class="">
        <a href="/samples/soap/">sample-soap</a>
      </li>
      
      
      <li class="">
        <a href="/samples/soap-mtom/">sample-soap-mtom</a>
      </li>
      
      
      <li class="">
        <a href="/samples/wsdl/">sample-wsdl</a>
      </li>
      
      
      <li class="">
        <a href="/samples/soap-ssl/">sample-soap-ssl</a>
      </li>
      
      
      <li class="">
        <a href="/samples/soap-wssecurity/">sample-soap-wssecurity</a>
      </li>
      
      
      <li class="">
        <a href="/samples/http-static-response/">sample-http-static-response</a>
      </li>
      
      
      <li class="">
        <a href="/samples/soap-wsaddressing/">sample-soap-wsaddressing</a>
      </li>
      
      
      <li class="">
        <a href="/samples/soap-static-response/">sample-soap-static-response</a>
      </li>
      
      
    </ul>

    
    <h4>Samples  Testng</h4>
    <ul style="margin-top: 5px;">
      
      
      <li class="">
        <a href="/samples/dataprovider/">sample-dataprovider</a>
      </li>
      
      
      <li class="">
        <a href="/samples/testng/">sample-testng</a>
      </li>
      
      
    </ul>

    
    <h4>Samples  Xml</h4>
    <ul style="margin-top: 5px;">
      
      
      <li class="">
        <a href="/samples/xml/">sample-xml</a>
      </li>
      
      
      <li class="">
        <a href="/samples/xhtml/">sample-xhtml</a>
      </li>
      
      
      <li class="">
        <a href="/samples/oxm/">sample-oxm</a>
      </li>
      
    </ul>
  </aside>
</div>


      <div class="clear"></div>

    </div>
  </section>


  <footer role="contentinfo">
  <div class="grid">
    <div class="unit one-third center-on-mobiles">
      <p>Citrus is open source and licensed under <br><a href="https://www.apache.org/licenses/LICENSE-2.0.html">Apache License 2.0</a>.</p>
      <p>This website is licensed under <br><a href="https://github.com/citrusframework/citrus/blob/master/LICENSE">MIT License</a>.</p>
      <br>
      <p>© 2024 ConSol Software GmbH</p>
    </div>
    <div class="unit one-third align-center center-on-mobiles">
      <p>
        <img src="/img/bmi_logo_eng.png" alt="Federal Ministry for Economic Affairs and Energy">
      </p>
    </div>
    <div class="unit one-third align-right center-on-mobiles">
      <p>
        Hosted by<br>
        <a href="http://www.consol.de">
          <img src="/img/sponsor-logo.png" alt="ConSol">
        </a>
      </p>
      <p> </p>
      <br>
      <br>
      <p>
        <a href="http://www.consol.com/legal-notice/">Legal notice</a> | <a href="https://www.consol.com/data-privacy/">Data privacy</a>
      </p>
    </div>
  </div>
</footer>

  <script>
  var anchorForId = function (id) {
    var anchor = document.createElement("a");
    anchor.className = "header-link";
    anchor.href      = "#" + id;
    anchor.innerHTML = "<span class=\"sr-only\">Permalink</span><i class=\"fa fa-link\"></i>";
    anchor.title = "Permalink";
    return anchor;
  };

  var linkifyAnchors = function (level, containingElement) {
    var headers = containingElement.getElementsByTagName("h" + level);
    for (var h = 0; h < headers.length; h++) {
      var header = headers[h];

      if (typeof header.id !== "undefined" && header.id !== "") {
        header.appendChild(anchorForId(header.id));
      }
    }
  };

  document.onreadystatechange = function () {
    if (this.readyState === "complete") {
      var contentBlock = document.getElementsByClassName("docs")[0] || document.getElementsByClassName("samples")[0] || document.getElementsByClassName("news")[0];
      if (!contentBlock) {
        return;
      }
      for (var level = 1; level <= 6; level++) {
        linkifyAnchors(level, contentBlock);
      }
    }
  };
</script>


</body>
</html>
