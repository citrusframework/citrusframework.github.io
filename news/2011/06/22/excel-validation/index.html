<!DOCTYPE HTML>
<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <title>Citrus Framework</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="generator" content="Citrus 4.3.2">
  <meta name="description" content="Citrus Framework Website"/>
  <meta name="author" content="ConSol Software GmbH"/>
  <link type="application/atom+xml" rel="alternate" href="http://0.0.0.0:4000/feed.xml" title="Citrus Integration Tests" />
  <link rel="alternate" type="application/atom+xml" title="Recent commits to Citrus master branch" href="https://github.com/citrusframework/citrus/commits/master.atom">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic,900">
  <link rel="stylesheet" href="/css/screen.css">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <!--[if lt IE 9]>
  <script src="/js/html5shiv.min.js"></script>
  <script src="/js/respond.min.js"></script>
  <![endif]-->
</head>


<body class="wrap">
  <header role="banner">
  <nav class="mobile-nav show-on-mobiles">
    <ul>
  <li>
    <img src="/img/brand-logo.png" alt="Citrus"><span class="brand hide-on-mobiles">Citrus</span>
  </li>
  <li class="">
    <a href="/">Home</a>
  </li>
  <li class="">
    <a href="/projects/">Projects</a>
  </li>
  <li class="">
    <a href="/docs/documentation/">Doc<span class="hide-on-mobiles">umentation</span><span class="show-on-mobiles">s</span></a>
  </li>
  <li class="">
    <a href="/samples/">Samples</a>
  </li>
  <li class="current">
    <a href="/news/">News<span class="hide-on-mobiles"> &amp; Blog</span></a>
  </li>
  <li class="">
    <a href="/help/">Help</a>
  </li>
  <li>
    <a href="https://github.com/citrusframework/citrus" target="_blank"><span class="hide-on-mobiles">View on </span>GitHub</a>
  </li>
</ul>

  </nav>
  <div class="grid">
    <nav class="main-nav whole hide-on-mobiles">
      <ul>
  <li>
    <img src="/img/brand-logo.png" alt="Citrus"><span class="brand hide-on-mobiles">Citrus</span>
  </li>
  <li class="">
    <a href="/">Home</a>
  </li>
  <li class="">
    <a href="/projects/">Projects</a>
  </li>
  <li class="">
    <a href="/docs/documentation/">Doc<span class="hide-on-mobiles">umentation</span><span class="show-on-mobiles">s</span></a>
  </li>
  <li class="">
    <a href="/samples/">Samples</a>
  </li>
  <li class="current">
    <a href="/news/">News<span class="hide-on-mobiles"> &amp; Blog</span></a>
  </li>
  <li class="">
    <a href="/help/">Help</a>
  </li>
  <li>
    <a href="https://github.com/citrusframework/citrus" target="_blank"><span class="hide-on-mobiles">View on </span>GitHub</a>
  </li>
</ul>

    </nav>
  </div>
</header>


    <section class="news">
    <div class="grid">

      <div class="docs-nav-mobile unit whole show-on-mobiles">
  <select onchange="if (this.value) window.location.href=this.value">
    <option value="">Navigate the blog…</option>
    <option value="/news/">News</option>
    <option value="/docs/history/">Releases</option>
    <optgroup label="Posts">
      
      <option value="/news/2023/10/25/release-4.0.0/">Citrus 4.0.0</option>
      
      <option value="/news/2023/01/30/camel-k-yaks/">Testing Camel K with YAKS</option>
      
      <option value="/news/2021/08/30/introducing-yaks/">Cloud-native BDD testing with YAKS</option>
      
      <option value="/news/2021/08/25/new-camel-support/">Apache Camel support in Citrus 3</option>
      
      <option value="/news/2021/08/16/citrus-3.0/">YAY, Citrus 3.0 is here!</option>
      
      <option value="/news/2018/09/19/upcoming-changes/">Upcoming changes - What the future holds for Citrus</option>
      
      <option value="/news/2017/09/21/introducing-citrus-simulator/">Simulating 3rd party services with Spring Boot and Citrus</option>
      
      <option value="/news/2017/07/07/introducing-citrus-admin/">Introducing Citrus Admin Web UI</option>
      
      <option value="/news/2016/03/15/jcache-chat-citrus/">Testing WebSockets with a Citrus twist</option>
      
      <option value="/news/2015/08/19/arquillian-extension-part-2/">Arquillian &amp; Citrus in combination - Part 2</option>
      
      <option value="/news/2015/06/29/arquillian-extension-part-1/">Arquillian &amp; Citrus in combination - Part 1</option>
      
      <option value="/news/2015/06/03/camel-testing-part-3/">Apache Camel Integration Testing - Part 3</option>
      
      <option value="/news/2015/05/27/camel-testing-part-2/">Apache Camel Integration Testing - Part 2</option>
      
      <option value="/news/2014/11/21/camel-testing-part-1/">Apache Camel Integration Testing - Part 1</option>
      
      <option value="/news/2014/05/30/testing-webmethods-with-citrus-part-ii/">Testing webMethods with Citrus Part II</option>
      
      <option value="/news/2014/03/06/testing-webmethods-with-citrus-part-i/">Testing webMethods with Citrus Part I</option>
      
      <option value="/news/2011/06/22/excel-validation/">Validate Excel files in Citrus</option>
      
      <option value="/news/2011/06/17/testng-data-provider/">Use TestNG data providers in Citrus</option>
      
      <option value="/news/2010/12/14/integrate-your-own-validator/">Integrate your own validator into your Citrus project</option>
      
      <option value="/news/2010/08/13/testng-groups/">Citrus and TestNG groups</option>
      
      <option value="/news/2010/05/19/soap-mustunderstand/">Handle SOAP-ENV:mustUnderstand headers</option>
      
      <option value="/news/2010/01/18/custom-meta-info/">Customize meta information</option>
      
    </optgroup>
  </select>
</div>


      <div class="unit four-fifths">
        <article>
  <h2>
    Validate Excel files in Citrus
    <a href="/news/2011/06/22/excel-validation/" class="permalink" title="Permalink">∞</a>
  </h2>
  <span class="post-category">
    <span class="label">
      blog
    </span>
  </span>
  <div class="post-meta">
    <span class="post-date">
      22 Jun 2011
    </span>
    <a href="https://github.com/christophd" class="post-author">
      Christoph Deppisch
    </a>
  </div>
  <div class="post-content">
    <p>Lately I had to deal with Excel files as REST Http service response. I came up with a pretty clever validation mechanism in Citrus that I would like to share with you. You can apply the Excel validator to your Citrus project, too. It is not very complicated as you will see in this post.</p>

<p>First of all lets have a closer look at the response message we get from REST Http service.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml">HTTP/1.1 200 OK
Content-Language: de-DE
Content-Type: application/vnd.ms-excel;charset=windows-1252
Pragma: private
Cache-Control: private, must-revalidate
Content-Disposition: attachment; filename="ReportData.xls"
Transfer-Encoding: chunked
Server: Jetty(7.2.2.v20101205)

-- binary content --</code></pre></figure>

<p>The response message states a Content-Type header set to <em>application/vnd.ms-excel</em> which indicates the Excel content to the browser. Furthermore the Content-Disposition header informs the browser that he should open the save as dialog to the user rather than displaying the content. Finally the Excel file is added as binary content with charset <em>windows-1252</em>.</p>

<p>So now we would like to receive this message in our Citrus test also being able to validate the Excel file content as well as the important header entries. This is how we can do it:</p>

<p>First of all we introduce a custom message validator which handles the binary Excel message content. We intend to create an Excel workbook object that we can pass into the Citrus test. The tester is then able to write Groovy validation code accessing the Excel workbook object. Heres the code for the custom Excel message validator:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExcelMessageValidator</span> <span class="kd">extends</span> <span class="n">GroovyScriptMessageValidator</span> <span class="o">{</span>

    <span class="cm">/**
     * Default constructor using a customized groovy script template 
     * with POI workbook support.
     */</span>
    <span class="kd">public</span> <span class="nf">ExcelMessageValidator</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="k">new</span> <span class="n">ClassPathResource</span><span class="o">(</span><span class="s">"de/buk/aso/test/validation/excel-script-validation.groovy"</span><span class="o">));</span>
    <span class="o">}</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">supportsMessageType</span><span class="o">(</span><span class="n">String</span> <span class="n">messageType</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">messageType</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">"ms-excel"</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre></figure>

<p>The message validator is quite simple isn’t it. We extend GroovyScriptMessageValidator as we would like to write groovy validation code inside the test. The validator uses a custom script template (<em>excel-script-validation.groovy</em>) and supports message type <em>ms-excel</em>. Keep that in mind as we will use this later in our test case. For now we add this message validator to the Citrus Spring application context (<em>citrus-context.xml</em>).</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"excelMessageValidator"</span> <span class="na">class=</span><span class="s">"com.consol.citrus.validation.ExcelMessageValidator"</span><span class="nt">/&gt;</span></code></pre></figure>

<p>Not much has happened though in this validator’s Java code. The magic is done inside the Groovy script template <em>excel-script-validation.groovy</em> that we have added to the classpath in our project. Lets have a look at this file:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">java.io.ByteArrayInputStream</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span>
<span class="kn">import</span> <span class="nn">com.consol.citrus.*</span>
<span class="kn">import</span> <span class="nn">com.consol.citrus.message.*</span>
<span class="kn">import</span> <span class="nn">com.consol.citrus.variable.*</span>
<span class="kn">import</span> <span class="nn">com.consol.citrus.context.TestContext</span>
<span class="kn">import</span> <span class="nn">com.consol.citrus.exceptions.CitrusRuntimeException</span>
<span class="kn">import</span> <span class="nn">com.consol.citrus.validation.script.GroovyScriptMessageValidator.ValidationScriptExecutor</span>
<span class="kn">import</span> <span class="nn">org.apache.poi.hssf.usermodel.HSSFWorkbook</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExcelValidationScript</span> <span class="kd">implements</span> <span class="n">ValidationScriptExecutor</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">validate</span><span class="o">(</span><span class="n">Message</span> <span class="n">receivedMessage</span><span class="o">,</span> <span class="n">TestContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">headers</span> <span class="o">=</span> <span class="n">receivedMessage</span><span class="o">.</span><span class="na">copyHeaders</span><span class="o">()</span>
        <span class="n">String</span> <span class="n">payload</span> <span class="o">=</span> <span class="n">receivedMessage</span><span class="o">.</span><span class="na">getPayload</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
        
        <span class="n">HSSFWorkbook</span> <span class="n">workbook</span><span class="o">;</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="n">workbook</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HSSFWorkbook</span><span class="o">(</span><span class="k">new</span> <span class="n">ByteArrayInputStream</span><span class="o">(</span><span class="n">payload</span><span class="o">.</span><span class="na">getBytes</span><span class="o">()))</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">CitrusRuntimeException</span><span class="o">(</span><span class="s">"Failed to create excel workbook"</span><span class="o">,</span> <span class="n">e</span><span class="o">)</span>
        <span class="o">}</span>
        
        <span class="nd">@SCRIPTBODY</span><span class="err">@</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>Ah, now we are getting more precisely! We introduce a new HSSFWorkbook (see also <a href="http://poi.apache.org/">http://poi.apache.org/</a>) with the message payload that we have just received. Please do not mind the Java-like Groovy programming style - I want to keep things easy for Java programmers in this post. However we now have the workbook object ready for validation code in our test which automatically comes in where <em><a href="https://github.com/SCRIPTBODY" class="user-mention">@SCRIPTBODY</a>@</em> placeholder is located. So before we continue to look at the test example we shortly add apache poi jar dependency to our project Maven pom.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.apache.poi<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>poi<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>3.7<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre></figure>

<p>Finally let’s write the Citrus test with custom Excel file validation code in Groovy:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;testcase</span> <span class="na">name=</span><span class="s">"ExcelValidationITest"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;actions&gt;</span>
     <span class="nt">&lt;send</span> <span class="na">endpoint=</span><span class="s">"httpRestEndpoint"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;message&gt;&lt;data&gt;&lt;/data&gt;&lt;/message&gt;</span>
           <span class="nt">&lt;header&gt;</span>
              <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"citrus_endpoint_uri"</span> 
                  <span class="na">value=</span><span class="s">"http://localhost:8080/rest-api/report/excel"</span><span class="nt">/&gt;</span>
              <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"citrus_http_method"</span> <span class="na">value=</span><span class="s">"GET"</span><span class="nt">/&gt;</span>
              <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"Content-Type"</span> <span class="na">value=</span><span class="s">"text/html"</span><span class="nt">/&gt;</span>
              <span class="nt">&lt;element</span> <span class="na">name=</span><span class="s">"Accept"</span> <span class="na">value=</span><span class="s">"application/vnd.ms-excel"</span><span class="nt">/&gt;</span>
          <span class="nt">&lt;/header&gt;</span>
      <span class="nt">&lt;/send&gt;</span>
            
      <span class="nt">&lt;receive</span> <span class="na">endpoint=</span><span class="s">"httpRestEndpoint"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;message</span> <span class="na">type=</span><span class="s">"ms-excel"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;validate&gt;</span>
              <span class="nt">&lt;script</span> <span class="na">type=</span><span class="s">"groovy"</span><span class="nt">&gt;</span>
               // Header validation
               assert headers["citrus_http_status_code"].toString() == '200'
               assert headers["citrus_http_reason_phrase"] == 'OK'
               assert headers["Content-Type"].toString() == 
                    'application/vnd.ms-excel;charset=windows-1252'
               assert headers["Content-Disposition"] == 
                    'attachment; filename="ReportData.xls"'

               // Excel workbook validation
               assert workbook.getSheetAt(0).getSheetName() == "Report Data"
             <span class="nt">&lt;/script&gt;</span>
           <span class="nt">&lt;/validate&gt;</span>
         <span class="nt">&lt;/message&gt;</span>
     <span class="nt">&lt;/receive&gt;</span>
  <span class="nt">&lt;/actions&gt;</span>
<span class="nt">&lt;/testcase&gt;</span></code></pre></figure>

<p>We can access the Excel workbook object like a charm. Also the important message headers are checked for expected values. Do not forget to define the message type <em>ms-excel</em> in the receive action. This ensures that the validation mechanism in Citrus uses our custom Excel message validator for preparing the apache poi workbook object in advance.</p>

<p>That’s it! We are now able to validate Excel files in Citrus! The same thing can easily be done with other MS office formats (doc), too. If I have time the next days I will zip that project code and add it as download for you. Have fun with it!</p>

  </div>
</article>

      </div>

      <div class="unit one-fifth hide-on-mobiles">
  <aside>
    <h4>Overview</h4>
    <ul>
      <li class="">
        <a href="/news/">All Posts</a>
      </li>
      <li class="">
        <a href="/docs/history/">All Releases</a>
      </li>
    </ul>
    <h4>Posts</h4>
    <ul>
        
        <li class="">
          <a href="/news/2023/10/25/release-4.0.0/">» Citrus 4.0.0</a>
        </li>
        
        <li class="">
          <a href="/news/2023/01/30/camel-k-yaks/">» Camel K &amp; YAKS</a>
        </li>
        
        <li class="">
          <a href="/news/2021/08/30/introducing-yaks/">» YAKS BDD testing</a>
        </li>
        
        <li class="">
          <a href="/news/2021/08/25/new-camel-support/">» Citrus and Apache Camel</a>
        </li>
        
        <li class="">
          <a href="/news/2021/08/16/citrus-3.0/">» Citrus 3.0</a>
        </li>
        
        <li class="">
          <a href="/news/2018/09/19/upcoming-changes/">» Future of Citrus</a>
        </li>
        
        <li class="">
          <a href="/news/2017/09/21/introducing-citrus-simulator/">» Citrus Simulator</a>
        </li>
        
        <li class="">
          <a href="/news/2017/07/07/introducing-citrus-admin/">» Admin UI</a>
        </li>
        
        <li class="">
          <a href="/news/2016/03/15/jcache-chat-citrus/">» Testing WebSockets</a>
        </li>
        
        <li class="">
          <a href="/news/2015/08/19/arquillian-extension-part-2/">» Arquillian &amp; Citrus II</a>
        </li>
        
        <li class="">
          <a href="/news/2015/06/29/arquillian-extension-part-1/">» Arquillian &amp; Citrus I</a>
        </li>
        
        <li class="">
          <a href="/news/2015/06/03/camel-testing-part-3/">» Apache Camel III</a>
        </li>
        
        <li class="">
          <a href="/news/2015/05/27/camel-testing-part-2/">» Apache Camel II</a>
        </li>
        
        <li class="">
          <a href="/news/2014/11/21/camel-testing-part-1/">» Apache Camel I</a>
        </li>
        
        <li class="">
          <a href="/news/2014/05/30/testing-webmethods-with-citrus-part-ii/">» Testing webMethods II</a>
        </li>
        
        <li class="">
          <a href="/news/2014/03/06/testing-webmethods-with-citrus-part-i/">» Testing webMethods I</a>
        </li>
        
        <li class="current">
          <a href="/news/2011/06/22/excel-validation/">» Validate Excel files</a>
        </li>
        
        <li class="">
          <a href="/news/2011/06/17/testng-data-provider/">» TestNG data providers</a>
        </li>
        
        <li class="">
          <a href="/news/2010/12/14/integrate-your-own-validator/">» Integrate your own validator</a>
        </li>
        
        <li class="">
          <a href="/news/2010/08/13/testng-groups/">» TestNG groups</a>
        </li>
        
        <li class="">
          <a href="/news/2010/05/19/soap-mustunderstand/">» SOAP-ENV:mustUnderstand</a>
        </li>
        
        <li class="">
          <a href="/news/2010/01/18/custom-meta-info/">» Custom meta info</a>
        </li>
        
    </ul>
  </aside>
</div>


      <div class="clear"></div>

    </div>
  </section>


  <footer role="contentinfo">
  <div class="grid">
    <div class="unit one-third center-on-mobiles">
      <p>Citrus is open source and licensed under <br><a href="https://www.apache.org/licenses/LICENSE-2.0.html">Apache License 2.0</a>.</p>
      <p>This website is licensed under <br><a href="https://github.com/citrusframework/citrus/blob/master/LICENSE">MIT License</a>.</p>
      <br>
      <p>© 2024 ConSol Software GmbH</p>
    </div>
    <div class="unit one-third align-center center-on-mobiles">
      <p>
        <img src="/img/bmi_logo_eng.png" alt="Federal Ministry for Economic Affairs and Energy">
      </p>
    </div>
    <div class="unit one-third align-right center-on-mobiles">
      <p>
        Hosted by<br>
        <a href="http://www.consol.de">
          <img src="/img/sponsor-logo.png" alt="ConSol">
        </a>
      </p>
      <p> </p>
      <br>
      <br>
      <p>
        <a href="http://www.consol.com/legal-notice/">Legal notice</a> | <a href="https://www.consol.com/data-privacy/">Data privacy</a>
      </p>
    </div>
  </div>
</footer>

  <script>
  var anchorForId = function (id) {
    var anchor = document.createElement("a");
    anchor.className = "header-link";
    anchor.href      = "#" + id;
    anchor.innerHTML = "<span class=\"sr-only\">Permalink</span><i class=\"fa fa-link\"></i>";
    anchor.title = "Permalink";
    return anchor;
  };

  var linkifyAnchors = function (level, containingElement) {
    var headers = containingElement.getElementsByTagName("h" + level);
    for (var h = 0; h < headers.length; h++) {
      var header = headers[h];

      if (typeof header.id !== "undefined" && header.id !== "") {
        header.appendChild(anchorForId(header.id));
      }
    }
  };

  document.onreadystatechange = function () {
    if (this.readyState === "complete") {
      var contentBlock = document.getElementsByClassName("docs")[0] || document.getElementsByClassName("samples")[0] || document.getElementsByClassName("news")[0];
      if (!contentBlock) {
        return;
      }
      for (var level = 1; level <= 6; level++) {
        linkifyAnchors(level, contentBlock);
      }
    }
  };
</script>


</body>
</html>
