<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Citrus Framework - Reference Documentation</title><link xmlns="http://www.w3.org/TR/xhtml1/transitional" href="css/reference.css" rel="stylesheet" type="text/css"></link><meta name="generator" content="DocBook XSL Stylesheets V1.72.0"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="book" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="d0e1"></a>Citrus Framework - Reference Documentation</h1></div><div><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="authorgroup"><h2>Authors</h2><p></p><span class="author"><span xmlns="" class="firstname">Christoph</span> <span xmlns="" class="surname">Deppisch</span></span></div></div><div><p class="releaseinfo">1.2</p></div><div><p class="copyright">Copyright &copy; 2012 ConSol* Software GmbH</p></div></div><hr xmlns="http://www.w3.org/TR/xhtml1/transitional"></hr><img xmlns="http://www.w3.org/TR/xhtml1/transitional" src="images/citrus_logo.jpg" style="width:25%;float:right;"></img></div><div class="toc"><dl><dt><span class="preface"><a href="#preface">Preface</a></span></dt><dt><span class="chapter"><a href="#whatsnew">1. What's new?!</a></span></dt><dd><dl><dt><span class="section"><a href="#whatsnew-spring">1.1. Spring version update</a></span></dt><dt><span class="section"><a href="#whatsnew-groovy">1.2. New groovy features</a></span></dt><dt><span class="section"><a href="#whatsnew-sql">1.3. SQL multi-line result set validation</a></span></dt><dt><span class="section"><a href="#whatsnew-message-types">1.4. Extended message format support</a></span></dt><dt><span class="section"><a href="#whatsnew-xml">1.5. New XML features</a></span></dt><dt><span class="section"><a href="#whatsnew-soap">1.6. SOAP support improvements</a></span></dt><dt><span class="section"><a href="#whatsnew-http">1.7. Http and RESTful WebServices</a></span></dt><dt><span class="section"><a href="#whatsnew-html-report">1.8. HTML reporting</a></span></dt><dt><span class="section"><a href="#whatsnew-validation">1.9. Validation matchers</a></span></dt><dt><span class="section"><a href="#whatsnew-conditional">1.10. Conditional container</a></span></dt><dt><span class="section"><a href="#whatsnew-channel-selector">1.11. Support for message selectors on message channels</a></span></dt><dt><span class="section"><a href="#whatsnew-actions">1.12. New test actions</a></span></dt><dt><span class="section"><a href="#whatsnew-functions">1.13. New functions</a></span></dt><dt><span class="section"><a href="#whatsnew-bugfixes">1.14. Bugfixes</a></span></dt><dt><span class="section"><a href="#whatsnew-upgrading">1.15. Upgrading from version 1.1</a></span></dt></dl></dd><dt><span class="chapter"><a href="#introduction">2. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#introduction-overview">2.1. Overview</a></span></dt><dt><span class="section"><a href="#introduction-usage">2.2. Usage scenarios</a></span></dt></dl></dd><dt><span class="chapter"><a href="#setup">3. Setup</a></span></dt><dd><dl><dt><span class="section"><a href="#setup-using-maven">3.1. Using Maven</a></span></dt><dd><dl><dt><span class="section"><a href="#setup-maven-archetype">3.1.1. Use Citrus Maven archetype</a></span></dt><dt><span class="section"><a href="#setup-maven-integration">3.1.2. Add Citrus to existing Maven project</a></span></dt></dl></dd><dt><span class="section"><a href="#setup-using-ant">3.2. Using Ant</a></span></dt><dd><dl><dt><span class="section"><a href="#setup-prerequisits">3.2.1. Preconditions</a></span></dt><dt><span class="section"><a href="#setup-ant-download">3.2.2. Download</a></span></dt><dt><span class="section"><a href="#setup-ant-installation">3.2.3. Installation</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#testcase">4. Test case</a></span></dt><dd><dl><dt><span class="section"><a href="#testcase-defining">4.1. Defining a test case</a></span></dt><dd><dl><dt><span class="section"><a href="#testcase-description">4.1.1. Description</a></span></dt><dt><span class="section"><a href="#testcase-variables">4.1.2. Variables</a></span></dt><dt><span class="section"><a href="#testcase-global-variables">4.1.3. Global variables</a></span></dt><dt><span class="section"><a href="#testcase-actions">4.1.4. Actions</a></span></dt><dt><span class="section"><a href="#testcase-finally">4.1.5. Cleanup</a></span></dt></dl></dd><dt><span class="section"><a href="#testcase-metainfo">4.2. Meta information</a></span></dt></dl></dd><dt><span class="chapter"><a href="#run-config">5. Running tests</a></span></dt><dd><dl><dt><span class="section"><a href="#run-config-testng">5.1. Run with TestNG</a></span></dt><dt><span class="section"><a href="#run-config-junit">5.2. Run with JUnit</a></span></dt></dl></dd><dt><span class="chapter"><a href="#messaging">6. Messaging</a></span></dt><dd><dl><dt><span class="section"><a href="#message-sending">6.1. Sending messages</a></span></dt><dt><span class="section"><a href="#message-receiving">6.2. Receiving messages</a></span></dt><dd><dl><dt><span class="section"><a href="#message-payload-validation">6.2.1. Validate message content</a></span></dt><dt><span class="section"><a href="#message-dynamic-validation">6.2.2. Dynamic message values</a></span></dt><dt><span class="section"><a href="#message-validation-ignore">6.2.3. Ignore message elements</a></span></dt><dt><span class="section"><a href="#message-validation-elements">6.2.4. Explicit message element validation</a></span></dt><dt><span class="section"><a href="#message-header-validation">6.2.5. Validate the message header</a></span></dt><dt><span class="section"><a href="#message-content-extract">6.2.6. Saving message content to variables</a></span></dt><dt><span class="section"><a href="#message-selector">6.2.7. Message selectors</a></span></dt></dl></dd><dt><span class="section"><a href="#groovy-utils">6.3. Groovy utils for send and receive</a></span></dt><dd><dl><dt><span class="section"><a href="#groovy-markupbuilder">6.3.1. Groovy MarkupBuilder</a></span></dt><dt><span class="section"><a href="#groovy-xmlslurper">6.3.2. Groovy XmlSlurper</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#actions">7. Test actions</a></span></dt><dd><dl><dt><span class="section"><a href="#actions-database">7.1. Connecting to the database</a></span></dt><dd><dl><dt><span class="section"><a href="#actions-database-update">7.1.1. Updating the database</a></span></dt><dt><span class="section"><a href="#actions-database-query">7.1.2. Verifying data from the database</a></span></dt><dt><span class="section"><a href="#actions-database-groovy">7.1.3. Groovy SQL result set validation</a></span></dt><dt><span class="section"><a href="#actions-database-read-values">7.1.4. Read data from database</a></span></dt></dl></dd><dt><span class="section"><a href="#actions-sleep">7.2. Sleep</a></span></dt><dt><span class="section"><a href="#actions-java">7.3. Java</a></span></dt><dt><span class="section"><a href="#actions-timeout">7.4. Expect timeouts on a destination</a></span></dt><dt><span class="section"><a href="#actions-echo">7.5. Echo</a></span></dt><dt><span class="section"><a href="#actions-measure-time">7.6. Time measurement</a></span></dt><dt><span class="section"><a href="#actions-create-variables">7.7. Create variables</a></span></dt><dt><span class="section"><a href="#actions-trace">7.8. Trace variables</a></span></dt><dt><span class="section"><a href="#actions-transform">7.9. Transform</a></span></dt><dt><span class="section"><a href="#actions-groovy">7.10. Groovy support</a></span></dt><dt><span class="section"><a href="#actions-fail">7.11. Failing the test</a></span></dt><dt><span class="section"><a href="#actions-input">7.12. Input</a></span></dt><dt><span class="section"><a href="#actions-load">7.13. Load</a></span></dt><dt><span class="section"><a href="#actions-purge-jms">7.14. Purging JMS destinations</a></span></dt><dt><span class="section"><a href="#actions-purge-channels">7.15. Purging message channels</a></span></dt><dt><span class="section"><a href="#actions-assert">7.16. Assert failure</a></span></dt><dt><span class="section"><a href="#actions-catch">7.17. Catch exceptions</a></span></dt><dt><span class="section"><a href="#actions-generic-action">7.18. Including own actions</a></span></dt></dl></dd><dt><span class="chapter"><a href="#templates">8. Templates</a></span></dt><dt><span class="chapter"><a href="#containers">9. Containers</a></span></dt><dd><dl><dt><span class="section"><a href="#containers-sequential">9.1. Sequential</a></span></dt><dt><span class="section"><a href="#containers-conditional">9.2. Conditional</a></span></dt><dt><span class="section"><a href="#containers-parallel">9.3. Parallel</a></span></dt><dt><span class="section"><a href="#containers-iterate">9.4. Iterate</a></span></dt><dt><span class="section"><a href="#containers-repeat">9.5. Repeat until true</a></span></dt><dt><span class="section"><a href="#containers-repeat-onerror">9.6. Repeat on error until true</a></span></dt></dl></dd><dt><span class="chapter"><a href="#finally">10. Finally section</a></span></dt><dt><span class="chapter"><a href="#xpath">11. Using XPath</a></span></dt><dd><dl><dt><span class="section"><a href="#xpath-namespace">11.1. Handling XML namespaces</a></span></dt><dt><span class="section"><a href="#xpath-default-namespaces">11.2. Handling default namespaces</a></span></dt></dl></dd><dt><span class="chapter"><a href="#jms">12. Connecting with JMS</a></span></dt><dd><dl><dt><span class="section"><a href="#jms-sender">12.1. JMS message sender</a></span></dt><dt><span class="section"><a href="#jms-receiver">12.2. JMS message receiver</a></span></dt><dt><span class="section"><a href="#jms-sync-sender">12.3. JMS synchronous message sender</a></span></dt><dt><span class="section"><a href="#jms-sync-receiver">12.4. JMS synchronous message receiver</a></span></dt><dt><span class="section"><a href="#jms-topics">12.5. JMS Topics</a></span></dt><dt><span class="section"><a href="#jms-headers">12.6. JMS message headers</a></span></dt></dl></dd><dt><span class="chapter"><a href="#http">13. Http support</a></span></dt><dd><dl><dt><span class="section"><a href="#http-sender">13.1. Http message sender</a></span></dt><dt><span class="section"><a href="#http-server">13.2. Http server</a></span></dt><dd><dl><dt><span class="section"><a href="#http-message-handler-empty">13.2.1. Empty response producing message handler</a></span></dt><dt><span class="section"><a href="#http-message-handler-static">13.2.2. Static response producing message handler</a></span></dt><dt><span class="section"><a href="#http-message-handler-xpath">13.2.3. Xpath dispatching message handler</a></span></dt><dt><span class="section"><a href="#http-message-handler-jms">13.2.4. JMS connecting message handler</a></span></dt></dl></dd><dt><span class="section"><a href="#http-headers">13.3. Http headers</a></span></dt><dt><span class="section"><a href="#http-error-handling">13.4. Http error handling</a></span></dt><dt><span class="section"><a href="#htp-basic-auth">13.5. Basic authentication</a></span></dt></dl></dd><dt><span class="chapter"><a href="#soap-webservices">14. SOAP WebServices</a></span></dt><dd><dl><dt><span class="section"><a href="#soap-sender">14.1. SOAP message sender</a></span></dt><dt><span class="section"><a href="#soap-receiver">14.2. SOAP message receiver</a></span></dt><dt><span class="section"><a href="#soap-header">14.3. SOAP headers</a></span></dt><dt><span class="section"><a href="#soap-mime-headers">14.4. Http mime headers</a></span></dt><dt><span class="section"><a href="#soap-faults">14.5. SOAP faults</a></span></dt><dd><dl><dt><span class="section"><a href="#soap-fault-simulation">14.5.1. SOAP fault simulation</a></span></dt><dt><span class="section"><a href="#soap-fault-validation">14.5.2. SOAP fault validation</a></span></dt></dl></dd><dt><span class="section"><a href="#soap-attachments">14.6. SOAP attachment support</a></span></dt><dd><dl><dt><span class="section"><a href="#soap-attachment-send">14.6.1. Send SOAP attachments</a></span></dt><dt><span class="section"><a href="#soap-attachment-receiver">14.6.2. Receive and validate SOAP attachments</a></span></dt><dt><span class="section"><a href="#soap-ws-adressing">14.6.3. WS-Addressing support</a></span></dt></dl></dd><dt><span class="section"><a href="#soap-fork-mode">14.7. Handle synchronous SOAP responses</a></span></dt></dl></dd><dt><span class="chapter"><a href="#message-channel">15. Message channel support</a></span></dt><dd><dl><dt><span class="section"><a href="#message-channel-sender">15.1. Message channel sender</a></span></dt><dt><span class="section"><a href="#message-channel-receiver">15.2. Message channel receiver</a></span></dt><dt><span class="section"><a href="#sync-message-channel-sender">15.3. Synchronous message channel sender</a></span></dt><dt><span class="section"><a href="#sync-message-channel-receiver">15.4. Synchronous message channel receiver</a></span></dt><dt><span class="section"><a href="#message-channel-selector-support">15.5. Message selectors on channels</a></span></dt><dd><dl><dt><span class="section"><a href="#root-qname-message-selector">15.5.1. Root QName Message Selector</a></span></dt><dt><span class="section"><a href="#xpath-evaluating-message-selector">15.5.2. XPath Evaluating Message Selector</a></span></dt></dl></dd><dt><span class="section"><a href="#connecting-to-adapters">15.6. Connecting with Spring Integration Adapters</a></span></dt></dl></dd><dt><span class="chapter"><a href="#functions">16. Functions</a></span></dt><dd><dl><dt><span class="section"><a href="#functions-concat">16.1. citrus:concat()</a></span></dt><dt><span class="section"><a href="#functions-substring">16.2. citrus:substring()</a></span></dt><dt><span class="section"><a href="#functions-string-length">16.3. citrus:stringLength()</a></span></dt><dt><span class="section"><a href="#functions-translate">16.4. citrus:translate()</a></span></dt><dt><span class="section"><a href="#functions-substring-before">16.5. citrus:substringBefore()</a></span></dt><dt><span class="section"><a href="#functions-substring-after">16.6. citrus:substringAfter()</a></span></dt><dt><span class="section"><a href="#functions-round">16.7. citrus:round()</a></span></dt><dt><span class="section"><a href="#functions-floor">16.8. citrus:floor()</a></span></dt><dt><span class="section"><a href="#functions-ceiling">16.9. citrus:ceiling()</a></span></dt><dt><span class="section"><a href="#functions-random-number">16.10. citrus:randomNumber()</a></span></dt><dt><span class="section"><a href="#functions-random-string">16.11. citrus:randomString()</a></span></dt><dt><span class="section"><a href="#functions-random-enum-value">16.12. citrus:randomEnumValue()</a></span></dt><dt><span class="section"><a href="#functions-current-date">16.13. citrus:currentDate()</a></span></dt><dt><span class="section"><a href="#functions-upper-case">16.14. citrus:upperCase()</a></span></dt><dt><span class="section"><a href="#functions-lower-case">16.15. citrus:lowerCase()</a></span></dt><dt><span class="section"><a href="#functions-average">16.16. citrus:average()</a></span></dt><dt><span class="section"><a href="#functions-minimum">16.17. citrus:minimum()</a></span></dt><dt><span class="section"><a href="#functions-maximum">16.18. citrus:maximum()</a></span></dt><dt><span class="section"><a href="#functions-sum">16.19. citrus:sum()</a></span></dt><dt><span class="section"><a href="#functions-absolute">16.20. citrus:absolute()</a></span></dt><dt><span class="section"><a href="#functions-map-value">16.21. citrus:mapValue()</a></span></dt><dt><span class="section"><a href="#functions-random-uuid">16.22. citrus:randomUUID()</a></span></dt><dt><span class="section"><a href="#functions-encode-base64">16.23. citrus:encodeBase64()</a></span></dt><dt><span class="section"><a href="#functions-decode-base64">16.24. citrus:decodeBase64()</a></span></dt><dt><span class="section"><a href="#functions-escape-xml">16.25. citrus:escapeXml()</a></span></dt><dt><span class="section"><a href="#functions-cdata-section">16.26. citrus:cdataSection()</a></span></dt><dt><span class="section"><a href="#functions-digest-auth">16.27. citrus:digestAuthHeader()</a></span></dt><dt><span class="section"><a href="#functions-localhost-address">16.28. citrus:localHostAddress()</a></span></dt></dl></dd><dt><span class="chapter"><a href="#validation-matchers">17. Validation matchers</a></span></dt><dd><dl><dt><span class="section"><a href="#validation-matcher-xml">17.1. matchesXml()</a></span></dt><dt><span class="section"><a href="#validation-matcher-equals">17.2. equalsIgnoreCase()</a></span></dt><dt><span class="section"><a href="#validation-matcher-contains">17.3. contains()</a></span></dt><dt><span class="section"><a href="#validation-matcher-startswith">17.4. startsWith()</a></span></dt><dt><span class="section"><a href="#validation-matcher-endswith">17.5. endsWith()</a></span></dt><dt><span class="section"><a href="#validation-matcher-matches">17.6. matches()</a></span></dt><dt><span class="section"><a href="#validation-matcher-datepattern">17.7. matchesDatePattern()</a></span></dt><dt><span class="section"><a href="#validation-matcher-isnumber">17.8. isNumber()</a></span></dt><dt><span class="section"><a href="#validation-matcher-lowerthan">17.9. lowerThan()</a></span></dt><dt><span class="section"><a href="#validation-matcher-greaterthan">17.10. greaterThan()</a></span></dt></dl></dd><dt><span class="chapter"><a href="#testsuite">18. Actions before/after the test run</a></span></dt><dd><dl><dt><span class="section"><a href="#testsuite-before">18.1. Before suite</a></span></dt><dt><span class="section"><a href="#testsuite-after">18.2. After suite</a></span></dt><dt><span class="section"><a href="#testsuite-before-test">18.3. Before test</a></span></dt></dl></dd><dt><span class="chapter"><a href="#tibco">19. TIBCO support</a></span></dt><dd><dl><dt><span class="section"><a href="#tibco-hawk">19.1. Connecting with TIBCO Hawk</a></span></dt><dt><span class="section"><a href="#tibco-collaborator">19.2. Connecting with TIBCO Collaborator Workflow Server</a></span></dt></dl></dd><dt><span class="chapter"><a href="#schema-validation">20. XML schema validation</a></span></dt><dd><dl><dt><span class="section"><a href="#xsd-validation">20.1. XSD schema validation</a></span></dt><dt><span class="section"><a href="#schema-mapping-strategy">20.2. Schema mapping strategy</a></span></dt><dd><dl><dt><span class="section"><a href="#target-namespace-strategy">20.2.1. Target Namespace Mapping Strategy</a></span></dt><dt><span class="section"><a href="#root-qname-strategy">20.2.2. Root QName Mapping Strategy</a></span></dt><dt><span class="section"><a href="#schema-mapping-chain">20.2.3. Schema mapping strategy chain</a></span></dt></dl></dd><dt><span class="section"><a href="#schema-definition-overrule">20.3. Schema definition overruling</a></span></dt><dt><span class="section"><a href="#dtd-validation">20.4. DTD validation</a></span></dt></dl></dd><dt><span class="chapter"><a href="#meta-info">21. Customize meta information</a></span></dt><dt><span class="chapter"><a href="#debug-messages">22. Debugging received messages</a></span></dt><dt><span class="chapter"><a href="#reporting">23. Reporting and test results</a></span></dt><dd><dl><dt><span class="section"><a href="#reporting-logging">23.1. Console logging</a></span></dt><dt><span class="section"><a href="#reporting-junit">23.2. JUnit reports</a></span></dt><dt><span class="section"><a href="#reporting-html">23.3. HTML reports</a></span></dt></dl></dd><dt><span class="appendix"><a href="#samples">A. Citrus Samples</a></span></dt><dd><dl><dt><span class="section"><a href="#samples-flightbooking">A.1. The FlightBooking sample</a></span></dt><dd><dl><dt><span class="section"><a href="#samples-flightbooking-usecase">A.1.1. The use case</a></span></dt><dt><span class="section"><a href="#samples-flightbooking-configuration">A.1.2. Configure the simulated systems</a></span></dt><dt><span class="section"><a href="#samples-flightbooking-http">A.1.3. Configure the Http adapter</a></span></dt><dt><span class="section"><a href="#samples-flightbooking-testcase">A.1.4. The test case</a></span></dt></dl></dd></dl></dd></dl></div><div class="preface" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="preface"></a>Preface</h2></div></div></div><p>Integration testing can be very hard, especially when there is no sufficient tool support. Unit testing 
  is flavored with fantastic tools and APIs like JUnit, TestNG, and EasyMock which support you in writing automated tests. 
  A tester who is in charge of integration testing may lack of tool support for automated integration testing.
   
  In a typical Service-oriented Architecture (SOA) with enterprise applications the test team has to deal with different
  interfaces and various transport protocols. Without sufficient tool support the automated integration testing of message-based 
  interactions between interface partners is exhausting and sometimes barely possible.</p><p>The tester is forced to simulate several interface partners trying to simulate a chain of actions and messages. Simulating
  the behavior of interface partners in a automated test causes severe problems regarding maintainability and interoperability. 
  It is not unusual that a tester simulates external applications manually during the test, because of lacking tool support. The 
  manual test approach is very time consuming and error prone, because the process is not repeatable and the tester manually validates 
  the success.</p><p>The Citrus framework gives a complete test automation tool for integration testing of enterprise applications in a 
  Service.oriented Architecture. Every time a change was made in the application all automated Citrus tests ensure the stability of 
  interfaces and message communication. Regression testing and continuous integration testing is very easy. Citrus is designed to
  provide fully automated integration testing of whole end-to-end use cases with effective simulation of interface partners across
  various messaging transports and automated validation and functionality checks.</p><p>This documentation provides a reference guide to all features of the Citrus test framework. It gives a detailed picture 
  of effective integration testing with automated integration test environments. Since this document is considered to be under 
  construction, please do not hesitate to give any comments or requests to us using our user or support mailing lists.</p></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="whatsnew"></a>Chapter&nbsp;1.&nbsp;What's new?!</h2></div></div></div><p>With this release Citrus introduces some new features and changes that will be part of the following sections. You
  will get a short overview and particularly get the impression what new stuff you can add to your testing with this release.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="whatsnew-spring"></a>1.1.&nbsp;Spring version update</h2></div></div></div><p>We have some major version upgrades in our Spring dependencies. We are now using Spring 3.1.1, Spring Integration 2.1.2 and SpringWS 2.1.0. This upgrade 
    was overdue for some time and is definitely worth it. With these upgrades we had to apply some changes in our API, too. This is because we are using the Spring classes a lot
    in our code. See the upgrade guide in this chapter for all significant changes that might affect your project.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="whatsnew-groovy"></a>1.2.&nbsp;New groovy features</h2></div></div></div><p>Citrus extended the possibilities to work with script languages like Groovy. You can use Groovy's MarkupBuilder to create 
    XML message payloads. Your Groovy code goes right into the test case or comes from external file. With MarkupBuilder you
    do not need to care about XML message syntax and overhead. Just focus on the pure message content. You can read the details in 
    <a href="#groovy-markupbuilder" title="6.3.1.&nbsp;Groovy MarkupBuilder">Section&nbsp;6.3.1, &#8220;Groovy MarkupBuilder&#8221;</a>.</p><p>Further Groovy feature goes to the validation capabilities. Instead of working with XML DOM tree comparison and XPath expression validation you
    can use Groovy XMLSlurper. This is very useful for those of you who need to do complex message validation and do not like the XML/XPath syntax at all. With
    XMLSlurper you can access the XML DOM tree via named closure operations which feels great. This especially comes in handy for complex generic XML structures
    as you can search for elements, sort element list and use the powerful contains operation. This is all described in <a href="#groovy-xmlslurper" title="6.3.2.&nbsp;Groovy XmlSlurper">Section&nbsp;6.3.2, &#8220;Groovy XmlSlurper&#8221;</a>.</p><p>Some other Groovy support extension comes in SQL result set validation (<a href="#actions-database-groovy" title="7.1.3.&nbsp;Groovy SQL result set validation">Section&nbsp;7.1.3, &#8220;Groovy SQL result set validation&#8221;</a>). When reading data from the database someone is able to validation the
    resulting data row set with Groovy script. The script code easily accesses the rows and columns with Groovy's out-of-the-box list and map handling. This
    adds very powerful validation to multi-row data sets from the database.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="whatsnew-sql"></a>1.3.&nbsp;SQL multi-line result set validation</h2></div></div></div><p>In this new Citrus version the tester can validate SQL Query results that have multiple rows. In the past Citrus could only handle a single row in the
    result set. Now this new release brings light into the dark. See also the new Groovy SQL result set validation which fits brilliant for complex multi-row 
    SQL result set validation. The details can be found in <a href="#actions-database-query" title="7.1.2.&nbsp;Verifying data from the database">Section&nbsp;7.1.2, &#8220;Verifying data from the database&#8221;</a></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="whatsnew-message-types"></a>1.4.&nbsp;Extended message format support</h2></div></div></div><p>In previous versions Citrus was primary designed to handle XML message payloads. With this new release Citrus is also able to work with other message formats
    such as JSON, CSV, PLAINTEXT. This applies to sending messages as well as receiving and particularly validating message payloads. The tester can specify several message
    validators in Citrus for different message formats. According to the expected message format the proper validator is chosen to perform the message validation.</p><p>We have implemented a JSON message validator capable of ignoring specific JSON entries and handling JSONArrays. We also provide a plain text message validator which
    is very basic to be honest. The framework is ready to receive new validator implementations so you can add custom validators for your specific needs.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="whatsnew-xml"></a>1.5.&nbsp;New XML features</h2></div></div></div><p>XML namespace handling is tedious expecially if you have to deal with a lot of XPath expressions in your tests. Before you had need to specify a namespace
    context for the XPath expression every time you use them in your test - now you can have a central namespace context which declares namespaces you use in your project.
    These namespaces identified by some prefix are available throughout the test project which is much more maintainable and easy to use. See how it works in 
    <a href="#xpath-namespace" title="11.1.&nbsp;Handling XML namespaces">Section&nbsp;11.1, &#8220;Handling XML namespaces&#8221;</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="whatsnew-soap"></a>1.6.&nbsp;SOAP support improvements</h2></div></div></div><p>WsAddressing standard is now supported in Citrus (<a href="#soap-ws-adressing" title="14.6.3.&nbsp;WS-Addressing support">Section&nbsp;14.6.3, &#8220;WS-Addressing support&#8221;</a>). This means you can declare the specific WsAddressing message headers on message 
    sender level in order to send messages with WsAddressing feature. The header is constructed automatically for all SOAP messages that are sent over the message sender.</p><p>Dynamic SOAP endpoint uri resolver enables you to dynamically address SOAP endpoints during a test. Sometimes a message sender may dynamically have to change the SOAP
    url for each call (e.g. address different request uri parts). With a endpoint uri resolver set on the message sender you can handle this requirement very easy. The tip for 
    dynamic endpoint resolving was added to <a href="#soap-sender" title="14.1.&nbsp;SOAP message sender">Section&nbsp;14.1, &#8220;SOAP message sender&#8221;</a></p><p>We also simplified the synchronous SOAP HTTP communication within test cases. In previous versions you had to build complex parallel and sequential container constructs
    in order to continue with test execution while the SOAP message sender is waiting for the synchronous response to arrive. Now you can simply fork the message sending action and
    continue with further test actions while synchronous SOAP communication takes place. See the <a href="#soap-fork-mode" title="14.7.&nbsp;Handle synchronous SOAP responses">Section&nbsp;14.7, &#8220;Handle synchronous SOAP responses&#8221;</a> for details</p><p>Some really small change introduced with this release is the fact that Citrus now logs SOAP messages in their pure nature. This means that you can see the complete SOAP 
    envelope of messages in the Citrus log files. This is more than helpful when searching for errors inside your test case.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="whatsnew-http"></a>1.7.&nbsp;Http and RESTful WebServices</h2></div></div></div><p>We have changed Http communication components for full support of RESTful WebServices on client and server side. The Http client now uses Spring's REST support for
    Http requests (GET, PUT, DELETE, POST, etc.). The server side has changed, too. The Http server now provides RESTful WebServices and is compliant to the existing SOAP Jetty server
    implementation in Citrus. If you want to upgrade existing projects to this version you may have to adjust the Spring application context configuration to some extent.</p><p>For details have a look at the upgrade guide (<a href="#whatsnew-upgrading" title="1.15.&nbsp;Upgrading from version 1.1">Section&nbsp;1.15, &#8220;Upgrading from version 1.1&#8221;</a>) in this chapter or find detailed explanations to the new Http components in <a href="#http" title="Chapter&nbsp;13.&nbsp;Http support">Chapter&nbsp;13, <i xmlns:xlink="http://www.w3.org/1999/xlink">Http support</i></a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="whatsnew-html-report"></a>1.8.&nbsp;HTML reporting</h2></div></div></div><p>Citrus provides HTML reports after each test run with detailed information on the failed tests. You can immediately see which tests failed in execution and where the test
    stopped. <a href="#reporting-html" title="23.3.&nbsp;HTML reports">Section&nbsp;23.3, &#8220;HTML reports&#8221;</a> provides details on this new feature.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="whatsnew-validation"></a>1.9.&nbsp;Validation matchers</h2></div></div></div><p>The new validation matchers will put the message validation mechanisms to a new level. With validation matchers you are able to execute powerful assertions on each message content element.
    For instance you can use the isNumber validation matcher for checking that a message value is of numeric nature. We added several matcher implementations that are ready for usage in your test but you can
    also write your custom validation matchers. Have a look at <a href="#validation-matchers" title="Chapter&nbsp;17.&nbsp;Validation matchers">Chapter&nbsp;17, <i xmlns:xlink="http://www.w3.org/1999/xlink">Validation matchers</i></a> for details.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="whatsnew-conditional"></a>1.10.&nbsp;Conditional container</h2></div></div></div><p>The new conditional test action container enables you to execute test actions only in case a boolean expression evaluates to true. So the nested test actions inside the container may be not 
    executed at all in case a condition is not met. See <a href="#containers-conditional" title="9.2.&nbsp;Conditional">Section&nbsp;9.2, &#8220;Conditional&#8221;</a> for details.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="whatsnew-channel-selector"></a>1.11.&nbsp;Support for message selectors on message channels</h2></div></div></div><p>Spring Integration message channels do not support message selectors like JMS queues do for example. With Citrus 1.2 we implemented a solution for this issue with a special message channel
    implementation. So you can use the message selector feature also when using message channels. Go to <a href="#message-channel-selector-support" title="15.5.&nbsp;Message selectors on channels">Section&nbsp;15.5, &#8220;Message selectors on channels&#8221;</a> for details.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="whatsnew-actions"></a>1.12.&nbsp;New test actions</h2></div></div></div><p>We introduced some completely new test actions in this release for you. The new actions are listed below:</p><div class="itemizedlist"><ul type="disc"><li>Purge message channel action (<a href="#actions-purge-channels" title="7.15.&nbsp;Purging message channels">Section&nbsp;7.15, &#8220;Purging message channels&#8221;</a>)</li></ul></div><p>See <a href="#actions" title="Chapter&nbsp;7.&nbsp;Test actions">Chapter&nbsp;7, <i xmlns:xlink="http://www.w3.org/1999/xlink">Test actions</i></a> for detailed instructions how to use the new actions.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="whatsnew-functions"></a>1.13.&nbsp;New functions</h2></div></div></div><p>We introduced some new default Citrus functions that will ease the testers life. This includes commonly used functions like encoding/decoding base64 bindary data, escaping XML and generating 
    random Java UUID values. These are the new functions in this release:</p><div class="itemizedlist"><ul type="disc"><li>citrus:randomUUID()</li><li>citrus:cdataSection()</li><li>citrus:encodeBase64()</li><li>citrus:decodeBase64()</li><li>citrus:digestAuthHeader()</li><li>citrus:localHostAddress()</li></ul></div><p>See <a href="#functions" title="Chapter&nbsp;16.&nbsp;Functions">Chapter&nbsp;16, <i xmlns:xlink="http://www.w3.org/1999/xlink">Functions</i></a> for detail descriptions of each function.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="whatsnew-bugfixes"></a>1.14.&nbsp;Bugfixes</h2></div></div></div><p>As usual we have some bugs fixed during the daily work. So we are proud that we have found some issues and resolved them to make the framework a little bit better. For detailed
    bugfix listings refer to the complete changes log.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="whatsnew-upgrading"></a>1.15.&nbsp;Upgrading from version 1.1</h2></div></div></div><p>If you are coming from Citrus 1.1 final you may have to look at the following points.</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p><span class="emphasis"><em>Spring version update</em></span> We did some major version upgrades on our Spring dependencies. We are now using Spring 3.1.1, Spring Integration 2.1.2 and SpringWS 2.1.0.
            These new major releases bring some code changes in our Citrus API which might affect your code and configuration, too. So please update your configuration, it is definitely worth it!</p></li><li style="list-style-type: circle"><p><span class="emphasis"><em>Spring Integration headers:</em></span> With 2.0.x version Spring Integration has removed the internal header prefix ("springintegration_").
            So in some cases you might use those internal header names in your test cases in order to synchronize synchronous communication with internal message ids. Your test case 
            will fail as long as you use the old Spring internal header prefix in the test. Simply remove the header prefix wherever used and your test is up and running again.</p></li><li style="list-style-type: circle"><p><span class="emphasis"><em>Renamed packages and classes:</em></span> We try to keep rename operations to a minimum, as we know that this may cause some adjustments in your code that directly uses the Citrus
            classes. But sometimes names do change in order to reach consistency and avoid cyclic dependencies. So with this release some classes have moved some were renamed. This mostly applies
            to the validation classes as we have changed the model here in order to enable validation of message formats other than pure XML.</p></li><li style="list-style-type: circle"><p><span class="emphasis"><em>Message validator:</em></span> You need to specify at least one message validator in the citrus-context.xml. Before this was internally a static XML message validator, but now we offer
            different validators for several message formats like XML and JSON. Please see the Java API doc on MessageValidator interface for available implementations. If you just like to 
            keep it as it was before add this bean to the citrus-context.xml:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"xmlMessageValidator"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.validation.xml.DomXmlMessageValidator"</span>/&gt;</pre></li><li style="list-style-type: circle"><p><span class="emphasis"><em>Test suite:</em></span> We have eliminated/changed the Citrus test suite logic because it duplicates those test suites defined in TestNG or JUnit. In older versions the tester had to define a 
            Citrus test suite in Spring application context in order to execute test actions before/after the test run. Now these tasks before and after the test run are decoupled from a test suite.
            You define test suites exclusively in TestNG or JUnit. The test actions before/after the test run are seperately defined in citrus-context.xml so you have to change this configuration 
            in your Citrus project.</p><p>For example where you had a Citrus test suite before</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myTestSuite"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.TestSuite"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"tasksBefore"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">list</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"initDatabase"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.actions.ExecuteSQLAction"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"dataSource"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">ref</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testDataSource"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"statements"</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">list</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;CREATE TABLE PERSON (ID integer, NAME char(250))&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/list</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/list</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>you can now just use this Spring bean explicitly to define a sequence of actions before the test suite:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.container.SequenceBeforeSuite"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"actions"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">list</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"initDatabase"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.actions.ExecuteSQLAction"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"dataSource"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">ref</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testDataSource"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"statements"</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">list</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;CREATE TABLE PERSON (ID integer, NAME char(250))&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/list</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/list</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>See <a href="#testsuite" title="Chapter&nbsp;18.&nbsp;Actions before/after the test run">Chapter&nbsp;18, <i xmlns:xlink="http://www.w3.org/1999/xlink">Actions before/after the test run</i></a> for details on this configuration changes.</p></li><li style="list-style-type: circle"><p><span class="emphasis"><em>Http server:</em></span> If you are using the Citrus Http server implementation you need to update your Spring application context configuration. We improved the Http server side logic a lot in order to support
            full RESTful WebServices. In addition to that we wanted to have the configuration the same way as we do with SOAP Jetty server. Where you explicitly gave a message handler to the http-server configuration 
            component before like this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-http:server</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpStandaloneServer"</span> 
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">port</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"8073"</span> 
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">uri</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"/test"</span> 
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">deamon</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"false"</span> 
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message-handler</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jmsMessageHandler"</span>
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">auto-start</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>/&gt;
                        
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jmsMessageHandler"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.adapter.handler.JmsConnectingMessageHandler"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"destinationName"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"JMS.Citrus.Http.Request.Forward"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"replyDestinationName"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"JMS.Citrus.Http.Request.Ack"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"connectionFactory"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.apache.activemq.ActiveMQConnectionFactory"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"brokerURL"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"tcp://localhost:61616"</span> /&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"fallbackMessageHandlerDelegate"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.adapter.handler.EmptyResponseProducingMessageHandler"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"replyTimeout"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"2000"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>You now give a Spring servlet context file where all server related configuration is done. In this context you define Spring MVC components and especially the HttpMessageController 
            which is able to handle REST Http requests (GET, PUT, DELETE, POST, etc.). This gives us more flexibility and more powerful REST server configurations with Spring MVC. Next example gives
            a complete http-server configuration with related http servlet context file content. If you are familiar with Citrus SOAP Jetty server you will see the affinity in those configurations.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-http:server</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpServer"</span> 
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">port</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"8072"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">auto-start</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">context-config-location</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:com/consol/citrus/http/citrus-servlet-context.xml"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">resource-base</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"src/citrus/resources"</span>/&gt;
            
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">!-- REST controller for handling requests in citrus-servlet-context.xml --</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.http.controller.HttpMessageController"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"messageHandler"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jmsMessageHandler"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.adapter.handler.JmsConnectingMessageHandler"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"destinationName"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"JMS.Citrus.Http.Request.Forward"</span>/&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"replyDestinationName"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"JMS.Citrus.Http.Request.Ack"</span>/&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"connectionFactory"</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.apache.activemq.ActiveMQConnectionFactory"</span>&gt;
                  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"brokerURL"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"tcp://localhost:61616"</span> /&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"fallbackMessageHandlerDelegate"</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.adapter.handler.EmptyResponseProducingMessageHandler"</span>/&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"replyTimeout"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"2000"</span>/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre></li><li style="list-style-type: circle"><p><span class="emphasis"><em>JUnit vs. TestNG:</em></span> We support both famous unit testing frameworks JUnit and TestNG. With this release you are free to choose your prefered one. In this manner you need to add
            either a JUnit dependency or a TestNG dependency to your project on your own. We do not have static dependencies in our Maven POM to neither of those two. On our side these dependencies
            are declared optional so you feel free to add the one you like best to your Maven POM. Just add a JUnit or TestNG dependency to your Maven project or add the respective jar file to your 
            project if you use ANT instead.</p></li></ul></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="introduction"></a>Chapter&nbsp;2.&nbsp;Introduction</h2></div></div></div><p>Enterprise applications in a Service-oriented Architecture usually communicate with different 
  interface partners over loosely coupled message-based communication. The interaction of
  several interface partners needs to be tested in integration testing.</p><p>In integration tests we need to simulate the communication over various transports. How can we 
  test use case scenarios that include several interface partners interacting with each other? How can 
  somebody ensure that the software component is working correctly with the other software systems.
  How can somebody run positive and negative integration test cases in an automated reproducible way? 
  Citrus tries to answer these questions offering automated integration testing of message-based software 
  components.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="introduction-overview"></a>2.1.&nbsp;Overview</h2></div></div></div><p>Citrus aims to strongly support you in simulating interface partners across different messaging transports. 
    You can easily subscribe and publish to a wide range of protocols like HTTP, JMS, TCP/IP and SOAP. 
    The framework can send and receive messages in order to create a communication chain that simulates a whole use case scenario. 
    In each communication step Citrus is able to validate message contents. In addition to that the framework offers a 
    wide range of actions to take control of the process flow during a test (e.g. iterations, 
    system availability checks, database validation, parallelism, delaying, error simulation, scripting, and many more).</p><p>The basic goal in Citrus test cases is to describe a whole use case scenario including several interface partners 
    that exchange messages with each other. You can set up complex message and data flows with several test steps as a pure XML file.
    The test description can be executed multiple times as automated integration test where Citrus simulated all surrounding 
    interface partners that are not present in the test environment. With easy definition of expected message contents via XML 
    Citrus is able to validate the data flow and the end-to-end use case processing.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="introduction-usage"></a>2.2.&nbsp;Usage scenarios</h2></div></div></div><p>If you are in charge of an enterprise application in a service-oriented Architecture with message interfaces to other software 
    components you should use Citrus. In case your project interacts with other software systems over different messaging transports and 
    you need to simulate your interface partners for extended end-to-end testing you should use Citrus. In case you need to increase the 
    software stability dealing with change requests, bugfixing or regression testing you should use Citrus. In case you simply want to 
    increase your test coverage with automated integration tests, in order to feel comfortable regarding the next software release you 
    should definitely use Citrus.</p><p>
      </p><div class="mediaobject" align="center"><img src="images/usage_sample.jpg" align="middle"></div><p>
    </p><p>This test set up is typical for Citrus use cases. In a such a test scenario we have a system under test (SUT) with several message 
    interfaces to other applications. A client application invokes services on the SUT application. The SUT is linked to several backend 
    applications over various messaging transports (here SOAP, JMS, and Http). Interim message notifications and final responses are sent back 
    to the client application. This generates a bunch of messages that are exchanged throughout the applications involved.</p><p>In the automated integration test Citrus needs to send and receive those messages over different transports. Citrus takes care of all 
    interface partners (ClientApplication, Backend1, Backend2, Backend3) and simulates their behavior by sending proper response messages in 
    order to keep the message flow alive.</p><p>Each communication step comes with message validation and XML tree comparison against an expected message template. Besides 
    messaging actions Citrus is also able to perform arbitrary other test actions. The client can, for example, perform a database query
    between requests to ensure that the previous test step stored what was expected.</p><p>The Citrus test case runs fully automated as a Java application. Step by step the whole use case scenario is performed like in a 
    real production environment. The Java test is repeatable and is included into the software build process (e.g. using Maven) like a 
    normal unit test case would be. This gives clients automated integration testing to help ensure interface stability to external partners.</p><p>The following reference guide walks through all Citrus functionalities and shows how to set up a great integration test with Citrus.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="setup"></a>Chapter&nbsp;3.&nbsp;Setup</h2></div></div></div><p>This chapter will tell you how to get started with Citrus. It deals with the installation and set up of the framework, 
  so you are ready to start writing test cases after reading this chapter.</p><p>Usually you would use Citrus as a library in your project or as a standalone Java application. Following these two setup
  variations Citrus can be invoked either by using Ant or Maven. This chapter describes the Citrus project setup possibilities, 
  choose one of them that fits best to include Citrus into your project.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="setup-using-maven"></a>3.1.&nbsp;Using Maven</h2></div></div></div><p>Citrus uses <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://maven.apache.org/" target="_top">Maven</a> internally as a project build tool and provides extended
    support for Maven projects. Maven will ease up your life as it manages project dependencies and provides extended build lifecycles and 
    conventions for compiling, testing, packaging and installing your Java project. Therefore it is recommended to use the Citrus Maven 
    project setup. In case you already use Maven it is most suitable for you to include Citrus as a test-scoped dependency.</p><p>As Maven handles all project dependencies automatically you do not need to download any Citrus project artifacts in 
    advance. If you are new to Maven please refer to the official Maven documentation to find out how to set up a Maven project.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="setup-maven-archetype"></a>3.1.1.&nbsp;Use Citrus Maven archetype</h3></div></div></div><p>If you start from scratch or in case you would like to have Citrus operating in a separate Maven module you can use the Citrus 
        Maven archetype to create a new Maven project. The archetype will setup a basic Citrus project structure with basic settings and files.</p><pre class="programlisting">mvn archetype:generate -DarchetypeCatalog=http://citrusframework.org
        
Choose archetype:
1: http://citrusframework.org -&gt; citrus-archetype (Basic archetype for Citrus integration test project)
Choose a number: 1 

Define value for groupId: com.consol.citrus.samples
Define value for artifactId: citrus-sample
Define value for version: 1.0-SNAPSHOT
Define value for package: com.consol.citrus.samples</pre><p>We load the archetype information from "http://citrusframework.org" and choose the Citrus basic archetype. Now you have 
        to define several values for your project: the groupId, the artifactId, the package and the project version. After that we are done! Maven created a Citrus project structure
        for us which is ready for testing. You should see the following basic project folder structure.</p><pre class="programlisting">citrus-sample
  |   + src
  |   |   + main
  |   |    |   + java
  |   |    |   + resources
  |   |   + citrus
  |   |    |   + java
  |   |    |   + resources
  |   |    |   + tests
  pom.xml</pre><p>The Citrus project is absolutely ready for testing. With Maven we can build, package, install and test our project right away without any adjustments. 
        Try to execute the following commands:</p><pre class="programlisting">mvn integration-test 
mvn integration-test -Dtest=MyFirstCitrusTest </pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you need additional assistance in setting up a Citrus Maven project please visit our Maven setup tutorial
            on <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.citrusframework.org/tutorials.html" target="_top">http://www.citfrusframework.org</a>.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="setup-maven-integration"></a>3.1.2.&nbsp;Add Citrus to existing Maven project</h3></div></div></div><p>In case you already have a proper Maven project you can also integrate Citrus with it. Just add the Citrus project dependencies in your Maven pom.xml 
        as a dependency like follows.</p><div class="itemizedlist"><ul type="disc"><li><p>We add Citrus as test-scoped project dependency to the project POM (pom.xml)</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">dependency</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">groupId</span>&gt;com.consol.citrus&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/groupId</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">artifactId</span>&gt;citrus-core&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/artifactId</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">version</span>&gt;1.2&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/version</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scope</span>&gt;test&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scope</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/dependency</span>&gt;</pre></li><li><p>Add the citrus Maven plugin to your project</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">plugin</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">groupId</span>&gt;com.consol.citrus.mvn&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/groupId</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">artifactId</span>&gt;citrus-maven-plugin&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/artifactId</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">version</span>&gt;1.2&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/version</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">configuration</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">author</span>&gt;Donald Duck&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/author</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">targetPackage</span>&gt;com.consol.citrus&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/targetPackage</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/configuration</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/plugin</span>&gt;</pre></li></ul></div><p>Now that we have added Citrus to our Maven project we can start writing new test cases with the Citrus Maven
        plugin:</p><pre class="programlisting">mvn citrus:create-test</pre><p>Once you have written the Citrus test cases you can execute them automatically in your Maven software build lifecylce. 
        The tests will be included into your projects integration-test phase using the Maven surefire plugin. Here is a sample
        surefire configuration for Citrus.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">plugin</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">artifactId</span>&gt;maven-surefire-plugin&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/artifactId</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">version</span>&gt;2.4.3&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/version</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">configuration</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">skip</span>&gt;true&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/skip</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/configuration</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">executions</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">execution</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">id</span>&gt;citrus-tests&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/id</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">phase</span>&gt;integration-test&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/phase</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">goals</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">goal</span>&gt;test&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/goal</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/goals</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">configuration</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">skip</span>&gt;false&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/skip</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/configuration</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/execution</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/executions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/plugin</span>&gt;</pre><p>The Citrus source directories are defined as test sources like follows:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testSourceDirectory</span>&gt;src/citrus/java&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testSourceDirectory</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testResources</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testResource</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">directory</span>&gt;src/citrus/java&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/directory</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">includes</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">include</span>&gt;**&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/include</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/includes</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">excludes</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">exclude</span>&gt;*.java&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/exclude</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/excludes</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testResource</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testResource</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">directory</span>&gt;src/citrus/tests&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/directory</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">includes</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">include</span>&gt;**/*&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/include</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/includes</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">excludes</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/excludes</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testResource</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testResources</span>&gt;</pre><p>Now everything is set up and you can call the usual Maven <span class="emphasis"><em>install</em></span> goal (mvn clean install) 
        in order to build your project. The Citrus integration tests are executed automatically during the build process. 
        Besides that you can call the Maven integration-test phase explicitly to execute all Citrus tests or a specific test 
        by its name:</p><pre class="programlisting">mvn integration-test 
mvn integration-test -Dtest=MyFirstCitrusTest </pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you need additional assistance in setting up a Citrus Maven project please visit our Maven setup tutorial
            on <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.citrusframework.org/tutorials.html" target="_top">http://www.citfrusframework.org</a>.</p></td></tr></table></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="setup-using-ant"></a>3.2.&nbsp;Using Ant</h2></div></div></div><p>Ant is a very popular way to compile, test, package and execute Java projects. The Apache project has 
    effectively become a standard in managing Java projects. You can run Citrus test cases with Ant as Citrus is nothing but a
    Java application. This section describes the steps to setup a proper Citrus Ant project.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="setup-prerequisits"></a>3.2.1.&nbsp;Preconditions</h3></div></div></div><p>Before we start with the Citrus setup be sure to meet the following precondintions. The following software should
      be installed on your computer, in order to use the Citrus framework:</p><div class="itemizedlist"><ul type="disc"><li><p>Java 5.0 or higher</p><p>Installed JDK 5.0 or higher plus JAVA_HOME environment variable set up and pointing 
              to your Java installation directory</p></li><li><p>Java IDE (optional)</p><p>A Java IDE will help you to manage your Citrus project (e.g. creating 
              and executing test cases). You can use the any Java IDE (e.g. Eclipse or IntelliJ IDEA) but also
              any convenient XML Editor to write new test cases.</p></li><li><p>Ant 1.7.0 or higher</p><p>Ant (<a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://ant.apache.org/" target="_top">http://ant.apache.org/</a>) will run tests and 
              compile your Citrus code extensions if necessary.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="setup-ant-download"></a>3.2.2.&nbsp;Download</h3></div></div></div><p>First of all we need to download the latest Citrus release archive from the official website 
      <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.citrusframework.org" target="_top">http://www.citrusframework.org</a></p><p>Citrus comes to you as a zipped archive in one of the following packages:</p><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>citrus-x.x-with-dependencies</em></span></p></li><li><p><span class="emphasis"><em>citrus-x.x-src</em></span></p></li></ul></div><p>Usually you would choose the archive including all dependency libraries to start using Citrus. Besides that the package 
      includes the Citrus binaries as well as the reference documentation and some sample applications.</p><p>In case you want to get in touch with developing and debugging Citrus you can also go with the source archive 
      which gives you the complete Citrus Java code sources. The whole Citrus project is also accessible for you on 
      <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://github.com/christophd/citrus" target="_top">http://github.com/christophd/citrus</a>. This open git repository 
      on GitHub enables you to build Citrus from scratch with Maven and contribute code changes.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="setup-ant-installation"></a>3.2.3.&nbsp;Installation</h3></div></div></div><p>After downloading the Citrus archives we extract those into an appropriate location on the local 
      storage. We are seeking for the Citrus project artefacts coming as normal Java archives (e.g. citrus-core.jar, 
      citrus-ws.jar, etc.)</p><p>You have to include those Citrus Java archives as well as all dependency libraries to your Ant Java classpath. Usually
      you would copy all libraries into your project's lib directory and declare those libraries in the Ant build file. 
      See the following sample Ant build script which uses the Citrus project artefacts in combination with the Citrus Ant tasks 
      to setup and run the tests.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">project</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus-sample"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">basedir</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"."</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">default</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus.run.tests"</span>&gt;
  
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"src/citrus/resources/citrus.properties"</span>/&gt;
  
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">path</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus-classpath"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">fileset</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">dir</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"lib"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">include</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"*.jar"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/fileset</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/path</span>&gt;
  
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">typedef</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">resource</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrustasks"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">classpath</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"lib/citrus-ant-tasks-1.2-SNAPSHOT.jar"</span>/&gt;
  
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">target</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"compile.tests"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">javac</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">srcdir</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"src/citrus/java"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">classpathref</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus-classpath"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">javac</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">srcdir</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"src/citrus/tests"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">classpathref</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus-classpath"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/target</span>&gt;

  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">target</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"create.test"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">description</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Creates a new empty test case"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">input</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Enter test name:"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">addproperty</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"test.name"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">input</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Enter test description:"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">addproperty</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"test.description"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">input</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Enter author's name:"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">addproperty</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"test.author"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">defaultvalue</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${default.test.author}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">input</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Enter package:"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">addproperty</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"test.package"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">defaultvalue</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${default.test.package}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">input</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Enter framework:"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">addproperty</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"test.framework"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">defaultvalue</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testng"</span>/&gt;

    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">java</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">classname</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.util.TestCaseCreator"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">classpath</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">refid</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus-classpath"</span>/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">arg</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">line</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"-name ${test.name} -author ${test.author} -description ${test.description} 
                    -package ${test.package} -framework ${test.framework}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/java</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/target</span>&gt;
  
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">target</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus.run.tests"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">depends</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"compile.tests"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">description</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Runs all Citrus tests"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">package</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.*"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/target</span>&gt;
  
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">target</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus.run.single.test"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">depends</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"compile.tests"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">description</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Runs a single test by name"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">touch</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"test.history"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">loadproperties</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">srcfile</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"test.history"</span>/&gt;
    
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Last test executed: ${last.test.executed}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">input</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Enter test name or leave empty for last test executed:"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">addproperty</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testclass"</span> 
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">defaultvalue</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${last.test.executed}"</span>/&gt;
    
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">propertyfile</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"test.history"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">entry</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">key</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"last.test.executed"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"string"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${testclass}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/propertyfile</span>&gt;

    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">test</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${testclass}"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/target</span>&gt;
    
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/project</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you need detailed assistance for building Citrus with Ant do also visit our tutorials section on 
        <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.citrusframework.org" target="_top">http://www.citrusframework.org</a>. There you can find a 
        tutorial which describes the Citrus Java project set up with Ant from scratch.</p></td></tr></table></div></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="testcase"></a>Chapter&nbsp;4.&nbsp;Test case</h2></div></div></div><p>Now let us start writing test cases! A test case describes the steps for a certain use case. The test case holds
  a sequence of different test actions that are executed during the test. Typically in message-based applications sending 
  and receiving messages will be the main actions inside a test. But you will learn that Citrus is able to add much more 
  logic in a test case in order to accomplish very complex use case tests. Step by step we will introduce all possible actions 
  inside a test case and explain how to connect to other systems by sending and receiving messages over various transports.</p><div class="mediaobject" align="center"><img src="images/figure_004.jpg" align="middle"></div><p>The figure above describes a typical test action sequence in Citrus. A list of test actions that send and receive messages 
  with various MessageSender and MessageReceiver components. So how do we define those test logic? Citrus specifies test cases 
  through simple XML files. The whole test case description takes place in one single XML file. This chapter will introduce 
  the custom XML schema language that defines a test cases.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="testcase-defining"></a>4.1.&nbsp;Defining a test case</h2></div></div></div><p>Put simply, a test case is nothing but a simple Spring XML configuration file. 
    So using the Spring XML configuration syntax you are able to write fully compatible test cases for the Citrus framework.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">beans</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xsi</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;
    
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myFirstTest"</span> 
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.model.TestCase"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"actions"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">!-- actions of this test go here --</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/beans</span>&gt;</pre><p>Citrus can execute these test case as normal test cases - no problem, but this XML
    syntax is not usually the best way to describe a test case in Citrus, especially when test scenarios get more 
    complex and the test cases grow in size. Therefore Citrus provides a custom XML schema definition for 
    writing test cases.</p><p>The custom XML schema aims to reach the convenience of Domain specific languages (DSL). Let us have a look 
    at the Citrus test describing DSL by introducing a first very simple test case definition:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">spring:beans</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/testcase"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xsi</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:spring</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"
    http://www.springframework.org/schema/beans 
    http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.citrusframework.org/schema/testcase 
    http://www.citrusframework.org/schema/testcase/citrus-testcase.xsd"</span>&gt;
    
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myFirstTest"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">description</span>&gt;
            First example showing the basic test case definition elements!
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/description</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"text"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Hello Test Framework"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;${test}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/spring:beans</span>&gt;</pre><p>We do need the <code class="literal">&lt;spring:beans&gt;</code> root element as the XML file is read by the Spring IoC Container. 
    Inside this root element the Citrus specific namespace definitions take place. In the following we use the customized XML schema 
    language in Citrus to describe the test case.</p><p>The test case itself gets a mandatory name that must be unique throughout all test cases in a project. You will receive errors
    when using duplicate test names. The name must not contain any whitespaces but does support special characters like '-', '.', '_'. 
    For example, <code class="literal">TestFeature1</code> is valid but <code class="literal">TestFeature_1</code> is not.
    The &lt;testcase&gt; element holds several child elements. These basic test elements are described in the following sections.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="testcase-description"></a>4.1.1.&nbsp;Description</h3></div></div></div><p>The test case description points out the purpose and gives a short introduction to the intended use case scenario that 
        will be tested. The user should get a first impression what the test case is all about. You can use free text in order to describe the test. 
        But be aware of the XML validation rules of well formed XML (e.g. special character escaping, use of CDATA sections)</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="testcase-variables"></a>4.1.2.&nbsp;Variables</h3></div></div></div><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"text"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Hello Test Framework"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"customerId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"123456789"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;</pre><p>The test variables are valid for the whole test case. You can reference them several times using a variables expression 
        <code class="literal">"${variable-name}"</code>. It is good practice to provide all important entities as test variables. This
        makes the test easier to maintain and more flexible. All essential entities are present right at the beginning of the test, which
        may also give the opportunity to easily create test variants by simply changing the variable values.</p><p>The name of the variable is arbitrary. Feel free to specify any name you can think of. Of course you need to be careful with
        special characters and reserved XML entities like '&amp;', '&lt;', '&gt;'. If you are familiar with Java or any other programming 
        language simply think of the naming rules there and you will be fine with working on Citrus variables too. The value of a variable 
        can be any character sequence. But again be aware of special XML characters like "&lt;" that need to be escaped ("&amp;lt;") when 
        used in variable values.</p><p>The advantage of variables is obvious. Once declared the variables can be referenced many times in
        the test. This makes it very easy to vary different test cases by adjusting the variables for different means (e.g. use different 
        error codes in test cases).</p><p>You can also use a script to create variable values. This is extremely handy when you have very complex variable values.
        Just code a small Groovy script for instance in order to define the variable value. A small sample should give you the idea how that
        works:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"avg"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">script</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"groovy"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">a</span> = <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">4</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">b</span> = <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">6</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">return</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">(a</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">+</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">b)</span> / 2
                ]]&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/script</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variable</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sum"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">script</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"groovy"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">5</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">+</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">5</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">]]&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/script&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/value&gt;</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/variable&gt;</span>
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/variables&gt;</span></pre><p>We use the script code right inside the variable value definition. The value of the variable is the result of the last operation performed 
        within the script. For longer script code the use of <code class="literal">&lt;![CDATA[ ]]&gt;</code> sections is recommended.</p><p>Citrus uses the javax ScriptEngine mechanism in order to evaluate the script code. By default Groovy is supported in any Citrus project. 
        So you can add additional ScriptEngine implementations to your project and support other script types, too.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="testcase-global-variables"></a>4.1.3.&nbsp;Global variables</h3></div></div></div><p>The last section told us to use variables as they are very useful and extend the maintainability of test cases. Now that every 
        test case defines local variables which are valid inside the test you can also define global variables. The global variables are valid in all 
        tests by default. This is a good opportunity to declare constant values for all tests in global variables. The following demonstrates how to add 
        global variables to Citrus:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.variable.GlobalVariables"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"variables"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">map</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">entry</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">key</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"projectName"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Citrus Integration Testing"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">entry</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">key</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"userName"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"TestUser"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/map</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>Add this Spring bean to the <span class="emphasis"><em>'citrus-context.xml'</em></span> application context file in order to make the global 
        variables available in all tests. The bean just receives a map of key-value-pairs where the keys represent the variable names and 
        the values the respective values, of course.</p><p>Another possibility to set global variables is to load those from external property files. This may give you more powerful
        global variables with user specific properties and so on. See how to load properties as global variables in this example:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.variable.GlobalVariablesPropertyLoader"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"propertyFiles"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">list</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;classpath:global-variable.properties&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/list</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>Again we just place a Spring bean in the application context and everything is done. Citrus loads the properties as global 
        test variables.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You can use variables and functions in the external property files, too. It is possible to use previously defined global 
          variables in the values, like in this example:</p></td></tr></table></div><pre class="programlisting">user=Citrus
greeting=Hello ${user}!
date=citrus:currentDate('yyyy-MM-dd')</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="testcase-actions"></a>4.1.4.&nbsp;Actions</h3></div></div></div><p>A test case defines a sequence of actions that will take place during the test. 
        Actions are executed in the same order as they are defined in the test case definition.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">action</span>&gt;[...]&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/action</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">action</span>&gt;[...]&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/action</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">action</span>&gt;[...]&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/action</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">action</span>&gt;[...]&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/action</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;</pre><p>All actions have individual names and properties that define 
        the action behavior. Citrus offers a wide range of test actions from scratch, but you are also able to write your own 
        test actions in Java or Groovy and execute them during a test. <a href="#actions" title="Chapter&nbsp;7.&nbsp;Test actions">Chapter&nbsp;7, <i xmlns:xlink="http://www.w3.org/1999/xlink">Test actions</i></a> gives you a brief description of all available 
        actions that can be part of a test case execution.</p><p>The actions are combined in free sequence to each other so that the tester is able to declare a special action chain inside the test.
        These actions can be sending or receiving messages, delaying the test, validating the database and so on. Step-by-step the test proceeds through 
        the action chain. Usually the tester tries to fit the designed use case scenario with the action chain.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="testcase-finally"></a>4.1.5.&nbsp;Cleanup</h3></div></div></div><p>The <code class="literal">finally</code> element also contains a list of test actions. These actions will be executed at the very
        end of the test case even if errors did occur during the execution before. This is the right place to tidy up things that were previously 
        created by the test like cleaning up the database for instance. The <code class="literal">finally</code> section is described in more detail in <a href="#finally" title="Chapter&nbsp;10.&nbsp;Finally section">Chapter&nbsp;10, <i xmlns:xlink="http://www.w3.org/1999/xlink">Finally section</i></a>.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">finally</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">action</span>&gt;[...]&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/action</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">action</span>&gt;[...]&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/action</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">action</span>&gt;[...]&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/action</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">action</span>&gt;[...]&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/action</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/finally</span>&gt;</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="testcase-metainfo"></a>4.2.&nbsp;Meta information</h2></div></div></div><p>The user can provide some basic information about the test case. The meta-info element at the very beginning of the test case 
    holds information like the author of the test or the creation date. In detail the meta information is specified like this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"metaInfoTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">meta-info</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">author</span>&gt;Christoph Deppisch&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/author</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">creationdate</span>&gt;2008-01-11&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/creationdate</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">status</span>&gt;FINAL&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/status</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">last-updated-by</span>&gt;Christoph Deppisch&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/last-updated-by</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">last-updated-on</span>&gt;2008-01-11T10:00:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/last-updated-on</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/meta-info</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">description</span>&gt;
        ...
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/description</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        ...
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>The status allows following values: DRAFT, READY_FOR_REVIEW, DISABLED, FINAL.
    The meta-data information to a test is quite important to give the reader a first information about
    the test. It is also possible to generate test documentation using this meta-data information. The built-in Citrus 
    documentation generates HTML or Excel documents that list all tests with their metadata information and description.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Tests with the status DISABLED will not be executed during a test suite run. So someone can just start adding
        planned test cases that are not finished yet in status DRAFT. In case a test is not runnable yet because it is not finished,
        someone may disable a test temporarily to avoid causing failures during a test run. Using these different statuses one can 
        easily set up test plans and review the progress of test coverage by comparing the number of DRAFT tests to those in the FINAL state.</p></td></tr></table></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="run-config"></a>Chapter&nbsp;5.&nbsp;Running tests</h2></div></div></div><p>Citrus test cases consist of two parts. On the one hand the XML part, where you define what should happen
    in the test case. On the other hand the Java part, which is responsible for test execution. In the following sections 
    we concentrate on the Java part and the test execution mechanism.</p><p>If you create new test cases in Citrus - for instance via Maven plugin or ANT build script - Citrus 
    generates both parts in your test directory. For example: if you create a new test named 
    <span class="emphasis"><em>MyFirstCitrusTest</em></span> you will find these two files as a result:</p><p><code class="literal">src/citrus/tests/com/consol/citrus/MyFirstCitrusTest.xml</code></p><p><code class="literal">src/citrus/java/com/consol/citrus/MyFirstCitrusTest.java</code></p><p>With the creation of this test we have already made a very important decision. During creation, Citrus asks 
    you which execution framework should be used for this test. There are basically three options available: 
    <code class="literal">testng</code>, <code class="literal">junit3</code> and <code class="literal">junit4</code>.</p><p>So why is Citrus related to Unit tests although it is intended to be a framework for integration testing? 
    The answer to this question is quite simple: This is because Citrus wants to benefit from both JUnit and TestNG for 
    Java test execution. Both the JUnit and TestNG Java APIs offer various ways of execution and both are widely supported 
    by other tools and frameworks.</p><p>Users might already know one of these frameworks and the chances are good that they are familiar with at least one of them. 
    Everything you can do with JUnit and TestNG test cases you can do with Citrus tests. Include them into your Maven build 
    lifecycle. Execute tests from your IDE (Eclipse, IDEA or NetBeans). Include them into a continuous build tool (e.g. 
    Bamboo or Hudson). Generate test execution reports and test coverage reports. The possibilities with JUnit and TestNG are 
    amazing.</p><p>So let us have a closer look at the Citrus TestNG and JUnit integration.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="run-config-testng"></a>5.1.&nbsp;Run with TestNG</h2></div></div></div><p>TestNG stands for Next Generation Testing and has had a great influence in adding Java annotations to the unit
        test community. Citrus is able to generate TestNG Java classes that are executable as test cases. See the following standard
        template that Citrus will generate when having new test cases:</p><pre class="programlisting">
  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">package</span> com.consol.citrus.samples;

  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> org.testng.ITestContext;
  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> org.testng.annotations.Test;
  
  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> com.consol.citrus.testng.AbstractTestNGCitrusTest;
    
  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">/**
   * TODO: Description
   *
   * @author Unknown
   * @since 2010-06-05
   */</span>
  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">class</span> TestNGSampleTest <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">extends</span> AbstractTestNGCitrusTest {
      @Test
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> sampleTest(ITestContext testContext) {
          executeTest(testContext);
      }
  }
        </pre><p>If you are familiar with TestNG you will see that the Citrus-generated Java class is nothing but a normal TestNG test class.
        The good news is that we can still use the fantastic TestNG features in our test. You can think of parallel test execution, test groups, 
        setup and tear down operations and many more. Just to give an example we can simply add a test group to our test like this:</p><p><code class="literal">@Test(groups = {"long-running"})</code></p><p>For more information on TestNG please visit the official homepage, where you find complete reference documentation.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="run-config-junit"></a>5.2.&nbsp;Run with JUnit</h2></div></div></div><p>JUnit is a very popular unit test framework for Java applications widely accepted and widely supported by many tools and frameworks. 
        Citrus offers complete JUnit support for both major versions 3.x and 4.x. If you choose <span class="emphasis"><em>junit3</em></span> as execution framework 
        Citrus generates a Java file that looks like this:</p><pre class="programlisting">
  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">package</span> com.vodafone.uc.il.itest.service;

  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> com.consol.citrus.junit.AbstractJUnit38CitrusTest;
  
  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">/**
   * TODO: Description
   *
   * @author Unknown
   * @since 2010-06-05
   */</span>
  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">class</span> JUnit3SampleTest <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">extends</span> AbstractJUnit38CitrusTest {
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> testSampleTest() {
          executeTest();
      }
  }      
        </pre><p>For <span class="emphasis"><em>junit4</em></span> the respective file looks like this:</p><pre class="programlisting">
  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">package</span> com.vodafone.uc.il.itest.service;

  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> org.junit.Test;
  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> com.consol.citrus.junit.AbstractJUnit4CitrusTest;
  
  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">/**
   * TODO: Description
   *
   * @author Unknown
   * @since 2010-06-10
   */</span>
  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">class</span> SampleTest <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">extends</span> AbstractJUnit4CitrusTest {
      @Test
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> sampleTest() {
          executeTest();
      }
  }
        </pre><p>The different JUnit versions reveal slight differences, but the idea is the same. We are still
        able to extend the generated Java files with JUnit features. These Java files are responsible for 
        executing the Citrus test cases. For detailed information about JUnit and the fantastic ways to include
        those tests into your project please visit the official JUnit homepage.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>So now we know both TestNG and JUnit support in Citrus. Which framework should someone choose?
            To be honest, there is no easy answer to this question. The basic features are equivalent,
            but TestNG offers better possibilities for designing more complex test setup with test groups and 
            tasks before and after a group of tests. This is why TestNG is the default option in Citrus. But in 
            the end you have to decide on your own which framework fits best for your project.</p></td></tr></table></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="messaging"></a>Chapter&nbsp;6.&nbsp;Messaging</h2></div></div></div><p>In the previous chapter the basic test case structure was introduced with <span class="emphasis"><em>variables</em></span> and
  <span class="emphasis"><em>test actions</em></span>. The &lt;actions&gt; element contains a list of actions that take place during the test case. 
  Each test action is executed in sequential order. Citrus offers several built-in test actions that the user can choose from to construct a complex
  test workflow. The available test actions are discussed in the next sections.</p><p>As sending and receiving messages is essential in integration testing of message-based architectures we will handle these actions in first place.
  But first of all lets have a look at the common message interface in Citrus:</p><div class="mediaobject" align="center"><img src="images/figure_001.jpg" align="middle"></div><p>A message consists of a message header (name-value pairs) and a message payload. Later in this document we will see how 
  a test constructs several messages with payload and header values. But first of all let's concentrate on sending and receiving 
  messages to/from various transports. MesageSender and MessageReceiver components play a significant role in this respect. The next figure shows a 
  typical MessageSender component in Citrus:</p><div class="mediaobject" align="center"><img src="images/figure_002.jpg" align="middle"></div><p>The MessageSender publishes messages to a destination. This destination can be a JMS queue/topic, a SOAP WebService endpoint, a Http URL 
  and many more. The MessageSender just takes a previously defined message and sends it to the message destination.</p><p>Similar to that Citrus defines the MessageReceiver component to consume messages from destinations. This can be a simple subscription
  on message channels and queues/topics. In case of SOAP WebServices and Http GET/POST things are more complicated as we have to provide a 
  server component in combination with a MessageReceiver. We will handle this server related communication later in this document. For now
  a MessageReceiver component is defined like this:</p><div class="mediaobject" align="center"><img src="images/figure_003.jpg" align="middle"></div><p>In the next sections you learn how a test case uses those MessageSenders and MessageReceivers for publishing and consuming 
  messages.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="message-sending"></a>6.1.&nbsp;Sending messages</h2></div></div></div><p>The &lt;send&gt; action publishes messages to a destination. The transport that is used does - for now - not
    matter to the test case. The test case simply defines the message contents and uses a predefined message sender to actually 
    publish the constructed message. There are several message sender implementations in Citrus available representing different transport protocols like JMS, SOAP, 
    HTTP, TCP/IP and many more.</p><p>Again the type of transport is not specified in the test case directly, but in the message sender definitions. The separation of concerns (test case/message sender transport) 
    gives us a good flexibility of our test cases. The test case does not know anything about connection factories, queue names or endpoint urls. The transport underneath a 
    sending action can change easily without affecting the test case definition. We will see later in this document how to create different message senders for various transports 
    in Citrus. For now we concentrate on constructing the message content to be sent.</p><p>We assume that the message's payload will be plain XML format. Citrus supports XML payloads as default payload format. Citrus is not limited to XML message format 
    though; you can always add message converters and marshallers. But to be honest XML is a very popular message format in Enterprise Applications and messaging solutions. I do not 
    see the point why you should not use XML unless you deal with legacy interfaces or strongly need to avoid the XML message overhead. Anyway Citrus works best on XML payloads 
    and you will see a lot of example code in this document using XML. Finally let us have a look at a first example how a sending action is defined in the test.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sendMessageTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">description</span>&gt;
        Send message example
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/description</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"requestTag"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Rx123456789"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"correlationId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Cx1x123456789"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"getCustomerRequestMessageSender"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;RequestMessage&gt;</span>
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;MessageHeader&gt;</span>
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;CorrelationId&gt;${correlationId}&lt;/CorrelationId&gt;</span>
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;Timestamp&gt;2001-12-17T09:30:47.0Z&lt;/Timestamp&gt;</span>
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;RequestTag&gt;_&lt;/RequestTag&gt;</span>
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;VersionId&gt;2&lt;/VersionId&gt;</span>
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/MessageHeader&gt;</span>
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;MessageBody&gt;</span>
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;Customer&gt;</span>
                                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;Id&gt;1&lt;/Id&gt;</span>
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/Customer&gt;</span>
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/MessageBody&gt;</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/RequestMessage&gt;</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">]]&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/data&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"/MessageHeader/RequestTag"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${requestTag}"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Operation"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"GetCustomer"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"RequestTag"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${requestTag}"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>The test uses two variable definitions (<span class="emphasis"><em>requestTag</em></span> and <span class="emphasis"><em>correlationId</em></span>), 
    so first of all let us refresh in mind what variables do. Test variables are defined at the very beginning of the test case and 
    are valid throughout all actions that take place in the test. This means that actions can simply reference a variable by the 
    expression <code class="literal">${variable-name}</code>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Use variables wherever you can! At least the important entities of a test should be defined as variables at the 
        beginning. The test case improves maintainability and flexibility when using variables.</p></td></tr></table></div><p>Now lets have a closer look at the sending action. The 'with' attribute might catch someone's attention in first place. 
    So what does the 'with' attribute do? This attribute references a message sender definition by name. As previously mentioned the 
    message sender definition lies in a separate configuration file and contains the actual message transport configurations. In this example the 
    <span class="emphasis"><em>"getCustomerRequestMessageSender"</em></span> is used to send the message over JMS to a destination queue. 
    The test case is not aware of these transport details, because it does not have to. The advantages are obvious: On the one hand many test 
    cases may reuse a single message sender definition in order to send messages of type 'getCustomerRequest'. Secondly test cases are independent of
    message transport details. Connection factories, user credentials, endpoint urls are not present in the test cases but are configured in a central
    place - the actual message sender configuration.</p><p>In other words the attribute "with" in the &lt;send&gt; element specifies which message sender definition 
    to use for sending the message. Once again all available message senders are configured in a separate Spring configuration file. 
    We will come to this later. Be sure to always pick the right message sender type in order to publish your message to the right 
    destination endpoint.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>It is good practice to follow a naming convention when choosing names for message senders and receivers. The intended
        purpose of the message sender as well as the sending/receiving actor should be clear when choosing the name. For instance messageSender1,
        messageSender2 will not give you much hints to the purpose of the message sender.</p></td></tr></table></div><p>Now that the used message sender is clear, we finally can specify the message content to be sent. 
    The message content is declared with these elements:</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p><span class="emphasis"><em>message</em></span>: This element constructs the message to be sent. There are several child elements available:</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p><span class="emphasis"><em>data</em></span>: Inline CDATA definition of the message payload (instead of &lt;resource&gt; element)</p></li><li style="list-style-type: circle"><p><span class="emphasis"><em>resource</em></span>: External file resource holding the message payload (instead of &lt;data&gt; element)</p><p>The syntax would be: &lt;resource file="file:xmlData/NumberDeallocationRequest.xml" /&gt;</p><p>The file path prefix indicates the resource type, so the file location is resolved either as file system resource (file:) 
                    or classpath resource (classpath:).</p></li><li style="list-style-type: circle"><p><span class="emphasis"><em>element</em></span>: Explicitly overwrite values in the XML message payload using XPath. You can replace message content 
                    with dynamic values before sending. Each &lt;element&gt; entry provides a "path" and "value" attribute. The "path" 
                    gives a XPath expression evaluating to a XML node element or attribute in the message. The "value" can be a variable expression or any other 
                    static value. Citrus will replace the value before sending the message.</p></li></ul></div></li><li style="list-style-type: circle"><p><span class="emphasis"><em>header</em></span>: Defines a header for the message (e.g. JMS header information or SOAP header):</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p><span class="emphasis"><em>element</em></span>: Each header receives a "name" and "value". The "name" will be the 
                    name of the header entry and "value" its respective value. Again the usage of variable expressions as value is supported here, too.</p></li></ul></div></li></ul></div><p>The most important thing when dealing with sending actions is to prepare the message payload and header. You are able to construct the message payload either by 
    inline CDATA (&lt;data&gt;) or external file (&lt;resource&gt;). Before sending takes place you can explicitly replace some message values. You can think of overwriting
    specific message elements with variable values for instance. The example above uses the variable ${correlationId} directly in the XML payload definition. In addition to 
    that you can use XPath expressions for overwriting message contents before sending. The "/MessageHeader/RequestTag" XPath expression for instance overwrites 
    the respective request tag value in the message. The two approaches of overwriting message elements before sending can coexist simultaneously.</p><p>The message header is manipulated too. So Citrus uses name-value pairs like "Operation" and "RequestTag" in the example above to
    set the message's header entries.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>In case you don't like to define the message payload in a simple CDATA section, you also have the possibility to use explicit payload setting with XML schema 
      validation. In this case you need to use the <code class="literal">&lt;payload&gt;</code> instead of the <code class="literal">&lt;data&gt;</code> element. With this alternative you can 
      validate the payload with XML schema during designtime. With XML editors you also have XSD auto completion when constructing your payload. See following example for 
      usage explanation:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sendMessageTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloRequestSender"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">hlo:HelloRequest</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:hlo</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/samples/sayHello.xsd"</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">hlo:MessageId</span>&gt;${messageId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/hlo:MessageId</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">hlo:CorrelationId</span>&gt;${correlationId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/hlo:CorrelationId</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">hlo:User</span>&gt;${user}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/hlo:User</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">hlo:Text</span>&gt;Hello TestFramework&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/hlo:Text</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/hlo:HelloRequest</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
            ...
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>This alternative works for receiving message action, too. We will see this in the next section when dealing with message receipt within Citrus.</p></td></tr></table></div><p>This is how you send messages in Citrus. The test case is responsible for constructing the message content while predefined message senders are reused to publish 
    the messages. The variable support in message payload and message header enables you to add dynamic values.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="message-receiving"></a>6.2.&nbsp;Receiving messages</h2></div></div></div><p>Now after sending a message with Citrus we would like to receive a message inside the test. 
    Let us again have a look at a simple example showing how it works.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"getCustomerResponseReceiver"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">selector</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;operation = 'GetCustomer'&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/selector</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;RequestMessage&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;MessageHeader&gt;</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;CorrelationId&gt;${correlationId}&lt;/CorrelationId&gt;</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;Timestamp&gt;2001-12-17T09:30:47.0Z&lt;/Timestamp&gt;</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;RequestTag&gt;_&lt;/RequestTag&gt;</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;VersionId&gt;2&lt;/VersionId&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/MessageHeader&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;MessageBody&gt;</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;Customer&gt;</span>
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;Id&gt;1&lt;/Id&gt;</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/Customer&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/MessageBody&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/RequestMessage&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">]]&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/data&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//MessageHeader/RequestTag"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${requestTag}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Operation"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"GetCustomer"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"RequestTag"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${requestTag}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">extract</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Operation"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">variable</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${operation}"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//MessageBody/Customer/Id"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">variable</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${customerId}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/extract</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>Knowing the send action of the previous chapter we can identify some common mechanisms that apply for both 
    sending and receiving actions. This time the test uses a predefined message receiver in order to receive the message 
    over a certain transport. Again the test is not aware of the transport details (e.g. JMS connection factory, 
    queue names, etc.) but the message receiver does know this information.</p><p>While the action tries to receive a message the whole test execution will be delayed. This is
    important to ensure the step by step test workflow processing. The receiver will only wait a given amount of time for
    the message to arrive. A timeout exception fails the test in case the message does not arrive in time.</p><p>Once the message has arrived, the content can be validated in various ways. On the one hand you
    can specify a whole XML message template that you expect. In this case the received XML structure will
    be compared to the expected XML message element by element. On the other hand you can use explicit element validation where only a 
    small subset of message elements is included into validation.</p><p>Besides this message payload validation the framework can also validate the message header values where variable usage is 
    supported as usual during the whole validation process.</p><p>In general the validation component (validator) in Citrus works hand in hand with a message reveiving component as the following
    figure shows:</p><div class="mediaobject" align="center"><img src="images/figure_005.jpg" align="middle"></div><p>The message receiving component passes the message to the validator where the validation steps take place. Let us have a closer 
    look at the validation options and features step by step.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="message-payload-validation"></a>6.2.1.&nbsp;Validate message content</h3></div></div></div><p>Once Citrus has received a message the tester can validate the message contents in various ways. First of all the tester can compare 
        the whole message payload to a predefined control message template.</p><p>The receiving action offers following elements for control message templates:</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p><span class="emphasis"><em>&lt;data&gt;</em></span>: Defines an inline XML message template as nested CDATA</p></li><li style="list-style-type: circle"><p><span class="emphasis"><em>&lt;resource&gt;</em></span>: Defines an expected XML message template via external file resources</p></li></ul></div><p>Both ways inline CDATA XML or external file resource give us a control message template. Citrus uses this
        control template for extended XML tree comparison. All elements, namespaces, attributes and node values are validated in XML DOM tree comparison.
        Only in case received message and control message are equal to each other the message validation will succeed. In case differences occur Citrus gives
        detailed error messages and the test fails.</p><p>Now up to now the control message template is very static. Message comparison in this high extend has to be much more robust. This is why Citrus supports
        various ways to add dynamic message content and ignored elements to the XML tree validation. The tester can enrich the expected message template with test variables 
        or some elements can be completely ignored in validation.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="message-dynamic-validation"></a>6.2.2.&nbsp;Dynamic message values</h3></div></div></div><p>Some elements in our message payload might be of variable nature. Just think of identifiers that should not be static in our expected message template.
        Instead of repeating the ids several times hardcoded in our test we overwrite those elements with variable values. This can be done with XPath or inline variable
        declarations. Lets have a look at a example listing showing both ways to overwrite message tempalte content before validation:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;RequestMessage&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;MessageHeader&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;CorrelationId&gt;${correlationId}&lt;/CorrelationId&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;Timestamp&gt;2001-12-17T09:30:47.0Z&lt;/Timestamp&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;RequestTag&gt;_&lt;/RequestTag&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;VersionId&gt;2&lt;/VersionId&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/MessageHeader&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;MessageBody&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;Customer&gt;</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;Id&gt;1&lt;/Id&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/Customer&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/MessageBody&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/RequestMessage&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">]]&gt;</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/data&gt;</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//MessageHeader/RequestTag"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${requestTag}"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;</pre><p>The program linsting shows both ways of setting variable values inside a message template. First of all you can
        simply place variable expressions inside the message (see how ${correlationId} is used). Secondly you can also use 
        XPath expressions to explicitly overwrite message elements before validation.</p><p><code class="literal">&lt;element path="//MessageHeader/RequestTag" value="${requestTag}"/&gt;</code></p><p>The XPath expression evaluates to the message template, searches for the right element and replaces the element value. Of course 
        this works with attributes too.</p><p>Both ways via XPath or inline variable expressions are equally to each other. Choose one way that fits best for you. This is how we can add dynamic variable
        values to the control template in order to increase maintainability and robustness of message validation.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">Validation matchers put validation mechanisms to a new level offering dynamic assertion statements for validation. Have a look at the possibilities with 
        assertion statements in <a href="#validation-matchers" title="Chapter&nbsp;17.&nbsp;Validation matchers">Chapter&nbsp;17, <i xmlns:xlink="http://www.w3.org/1999/xlink">Validation matchers</i></a></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="message-validation-ignore"></a>6.2.3.&nbsp;Ignore message elements</h3></div></div></div><p>Some elements in the message payload might not apply for validation at all. Just think of communication timestamps an dynamic values inside a 
        message:</p><pre class="programlisting">[...]
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Timestamp</span>&gt;2001-12-17T09:30:47.0Z&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Timestamp</span>&gt;
[...]</pre><p>The timestamp value will dynamically change from test run to test run and is hardly predictable for the tester, so lets ignore it in validation.</p><pre class="programlisting"> &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;RequestMessage&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;MessageHeader&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;CorrelationId&gt;${correlationId}&lt;/CorrelationId&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;Timestamp&gt;@ignore@&lt;/Timestamp&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;RequestTag&gt;${requestTag}&lt;/RequestTag&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;VersionId&gt;2&lt;/VersionId&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/MessageHeader&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;MessageBody&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;Customer&gt;</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;Id&gt;1&lt;/Id&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/Customer&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/MessageBody&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/RequestMessage&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">]]&gt;</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/data&gt;</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;ignore</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//ResponseMessage/MessageHeader/Timestamp"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;</pre><p>If you do not like XPath you could also use another possibility to ignore message contents. The next example uses the special <span class="emphasis"><em>@ignore@</em></span> placeholder
        directly in the message content:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;RequestMessage&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;MessageHeader&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;CorrelationId&gt;${correlationId}&lt;/CorrelationId&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;Timestamp&gt;@ignore@&lt;/Timestamp&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;RequestTag&gt;${requestTag}&lt;/RequestTag&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;VersionId&gt;2&lt;/VersionId&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/MessageHeader&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;MessageBody&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;Customer&gt;</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;Id&gt;1&lt;/Id&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/Customer&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/MessageBody&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/RequestMessage&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">]]&gt;</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/data&gt;</span>
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/message&gt;</span></pre><p>The ignored message elements are automatically skipped when Citrus compares and validates message contents.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="message-validation-elements"></a>6.2.4.&nbsp;Explicit message element validation</h3></div></div></div><p>In the previous sections we have seen how to validate whole XML fragments with control message templates. In some cases 
        this approach might be too extensive. Imagine the tester only needs to validate a small subset of message elements. The definition 
        of control templates in combination with several ignore statements is not appropiate in this case. You would rather want
        to use explicit element validation.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//MessageHeader/RequestTag"</span> 
                 <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${requestTag}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//CorrelationId"</span> 
                 <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//MessageBody/Number"</span> 
                 <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"123456789"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;</pre><p>Instead of comparing the whole message some message elements are validated explicitly over XPath. Citrus evaluates the XPAth expression and 
        and compares its value to the control value. The basic message structure as well as other message elements are not included into validation.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If this type of element validation is choosen neither &lt;data&gt; nor &lt;resource&gt; template definitions are allowed.</p></td></tr></table></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Citrus offers an alternative dot-notated syntax in order to walk through XML trees. In case you are not 
            familiar with XPath or simply need a very easy way to find your element inside the XML tree you might use this way. Every 
            element hierarchy in the XML tree is represented with a simple dot - for example:</p><p><code class="literal">message.body.text</code></p><p>The expression will search the XML tree for the respective &lt;message&gt;&lt;body&gt;&lt;text&gt; element. Attributes 
            are supported too. In case the last element in the dot-notated expression is a XML attribute the framework will automatically 
            find it.</p><p>Of course this dot-notated syntax is very simple and might not be applicable for more complex tree walkings. 
            XPath is much more powerful - no doubt. However the dot-notated syntax might help those of you that are not familiar with XPath.
            So the dot-notation is supported wherever XPath expressions might apply.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="message-header-validation"></a>6.2.5.&nbsp;Validate the message header</h3></div></div></div><p>Now that we have validated the message payload in various ways in the previous sections we are also interested in validating the message header. Just
        add the following header validation to your receiving action.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Operation"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"GetCustomer"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"RequestTag"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${requestTag}"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;</pre><p>Message headers often occur as name-value pairs. So each header element that we specify in validation has to be present in the received message. In addition to that 
        the header value has to fit the control value. If one header is not found or the value does not fit Citrus will raise errors and the test case will fail.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">Sometimes message headers may not apply to the name-value pair pattern. For example SOAP headers can also contain XML fragments. Citrus supports these kind of
        headers too. Please see the SOAP chapter for more details on this.</td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="message-content-extract"></a>6.2.6.&nbsp;Saving message content to variables</h3></div></div></div><p>Imagine you receive a message in your test that contains a generated message id. You have no chance to predict the id
        because it was generated at runtime. In many cases you need to return this id in the respective response message to meet
        the requirements. So Citrus needs to offer a way to save dynamic message content for reuse in later test steps. The solution is simple: 
        we can extract those dynamic values to test variables.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">extract</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Operation"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">variable</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"operation"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//MessageBody/Customer/Id"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">variable</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"customerId"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/extract</span>&gt;</pre><p>As you can see Citrus is able to store both header and message payload content into test variables. It does not matter if you use new test variables 
        or existing ones as target. The extraction will automatically create a new variable in case it does not exist. Once the variable is announced to the test all following test 
        actions can access the variables as usual. So you could reuse the variable value in response messages or other test steps ahead.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="message-selector"></a>6.2.7.&nbsp;Message selectors</h3></div></div></div><p>The <span class="emphasis"><em>&lt;selector&gt;</em></span> element inside the receiving action defines key-value pairs in order to 
        filter the messages being received. The key value pairs apply to the message headers. This means that a receiver will 
        only accept messages that meet the key-value pairs in its header. Using this mechanism you can explicitly listen for 
        messages that belong to your test. This is very helpful to avoid receiving messages from other tests that are still available 
        on the message destination.</p><p>Lets say the tested software application keeps sending messages that belong to previous test cases. This could happen in retry 
        situations where the application's error handling automatically tries to solve a communication problem that occurred 
        during previous test cases. As a result a message destination (e.g. a JMS message queue) contains messages that are not valid any more for the currently 
        running test case. The test case might fail because the received message does not apply to the currently tested use case. The messages
        received are simply failing because the message content does not fit the expected one (e.g. correlation-ids, customer informations 
        etc.).</p><p>Now we have to find a way to avoid these problems. The test could filter the messages on a destination to only receive messages 
        that apply for the use case that is being tested. The Java Messaging System (JMS) came up with a message header selector that will 
        only accept messages that fit the expected header values.</p><p>Let us have a closer look at a message selector inside a receiving action:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">selector</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span>&gt; name="correlationId" value="Lx1x123456789"&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/element</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span>&gt; name="operation" value="getOrders"&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/element</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/selector</span>&gt;</pre><p>This example shows how selectors work. The selector will only accept messages that meet the correlation id and the operation 
        in the header values. All other messages on the message destination are ignored. The selector elements are automatically associated to 
        each other using the logical AND operator. This means that the message selector string would look like this: <span class="emphasis"><em>correlationId = 'Lx1x123456789' AND operation = 'getOrders'</em></span>.</p><p>Instead of using several elements in the selector you can also define a selector string directly which gives you more power in constructing the selection logic yourself. This way
        you can use <span class="emphasis"><em>AND</em></span> logical operators yourself.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">selector</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;
        correlationId = 'Cx1x123456789' AND messageId = '987654321'
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/selector</span>&gt;</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>In case you want to run tests in parallel message selectors become essential in your test cases. The different tests running 
            at the same time will steal messages from each other when you lack of message selection mechanisms.</p></td></tr></table></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>Previously only JMS message destinations offered support for message selectors! With Citrus version 1.2 we introduced message selector support for 
            Spring Integration message channels, too (see <a href="#message-channel-selector-support" title="15.5.&nbsp;Message selectors on channels">Section&nbsp;15.5, &#8220;Message selectors on channels&#8221;</a>).</p></td></tr></table></div></div><p>At this point you know the two most important test actions in Citrus. Sending and receiving actions will become the main components of your integration tests when dealing 
    with loosely coupled message based components in a SOA. It is very easy to create message flows, meaning a sequence of sending and receiving messages in your test case. 
    You can replicate use cases and test your message exchange with extended message validation possibilities.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="groovy-utils"></a>6.3.&nbsp;Groovy utils for send and receive</h2></div></div></div><p>Groovy offers some nice and easy to use features for working with XML structures. You can use those in Citrus within the send and receive test actions in order
    to construct message payloads via Groovy scripts.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="groovy-markupbuilder"></a>6.3.1.&nbsp;Groovy MarkupBuilder</h3></div></div></div><p>With the Groovy MarkupBuilder the tester may build XML message payloads in a simple way, without having to write the typical XML tag overhead. 
        For example we use the code listing from <a href="#message-sending" title="6.1.&nbsp;Sending messages">Section&nbsp;6.1, &#8220;Sending messages&#8221;</a>, but now we use a Groovy script instead of plain CDATA XML section. The Groovy MarkupBuilder 
        generates the XML message payload with exactly the same result:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"getCustomerRequestMessageSender"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">builder</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"groovy"</span>&gt;
              markupBuilder.RequestMessage{
                  MessageHeader{
                      CorrelationId('${correlationId}')
                      Timestamp('2001-12-17T09:30:47.0Z')
                      RequestTag('_')
                      VersionId('2')
                  }
                  MessageBody{
                      Customer{
                          Id('1')
                      }
                  }
              }
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/builder</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"/MessageHeader/RequestTag"</span> 
                      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${requestTag}"</span>/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Operation"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"GetCustomer"</span>/&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"RequestTag"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${requestTag}"</span>/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;</pre><p>The MarkupBuilder code is directly written into the well-known message element. As you can see from the example above, the MarkupBuilder syntax 
        is very easy and follows the simple rule: <span class="emphasis"><em>markupBuilder.ROOT-ELEMENT{ CHILD-ELEMENTS }</em></span>. However the tester has to follwow some simple rules and
        naming conventions when using the Citrus MarkupBuilder extension:</p><div class="itemizedlist"><ul type="disc"><li>The MarkupBuilder is accessed within the script over an object named <code class="literal">markupBuilder</code>. The name of the custom root element follows with all its child elements.</li><li>Child elements may be defined within curly brackets after the root-element (the same applies for further nested child elements)</li><li>Attributes and element values are defined within round brackets, after the element name</li><li>Attribute and element values have to stand within apostrophes (e.g. attribute-name: 'attribute-value')</li></ul></div><p>The Groovy MarkupBuilder script may also be used within receive actions as shown in the following listing:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloRequestSender"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">builder</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"groovy"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:com/consol/citrus/groovy/helloRequest.groovy"</span>/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;
  
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloResponseReceiver"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">timeout</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"5000"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">builder</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"groovy"</span>&gt;
              markupBuilder.HelloResponse(xmlns: 'http://www.consol.de/schemas/samples/sayHello.xsd'){
                  MessageId('${messageId}')
                  CorrelationId('${correlationId}')
                  User('HelloService')
                  Text('Hello ${user}')
              }
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/builder</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;
        </pre><p>As you can see it is also possible to define the script as external file resource. In addition to that namespace support is given as normal attribute definition 
        within the round brackets after the element name.</p><p>The MarkupBuilder implementation in Groovy opens great possibilities in defining message payloads in Citrus test cases. We do not need to write XML tag 
        overhead and we can construct complex message payloads with Groovy logic like iterations and conditions. For detailed MarkupBuilder descriptions please see the
        official Groovy documentation.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="groovy-xmlslurper"></a>6.3.2.&nbsp;Groovy XmlSlurper</h3></div></div></div><p>With the Groovy XmlSlurper you can easily validate XML message payloads without having to deal directly with XML. People who do not want to deal with XPath may 
        also like this validation alternative. The tester directly navigates through the message elements and uses simple code assertions in order to control the message content. 
        Here is an example how to validate messages with Groovy script:</p><pre class="programlisting">
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloResponseReceiver"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">timeout</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"5000"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">script</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"groovy"</span>&gt;
                assert root.children().size() == 4
                assert root.MessageId.text() == '${messageId}'
                assert root.CorrelationId.text() == '${correlationId}'
                assert root.User.text() == 'HelloService'
                assert root.Text.text() == 'Hello ' + context.getVariable("user")
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/script</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/validate</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Operation"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sayHello"</span>/&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"CorrelationId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;
        </pre><p>The Groovy XmlSlurper validation script goes right into the message-tag instead of a XML control template or XPath validation. The Groovy script 
        supports Java <code class="literal">assert</code> statements for message element validation. The element navigation starts with the root element 
        reffered to as <code class="literal">root</code>. Based on this root element you can also access child elements and attributes. Just use the element names seperated 
        by a simple dot. Very easy! If you need the list of child elements use the <code class="literal">children()</code> function on any element. With the 
        <code class="literal">text()</code> function you get access to the element's text-value. The <code class="literal">size()</code> is very useful for validating the number of child 
        elements which completes the basic validation statements.</p><p>As you can see from the example, we may use test variables within the validation script, too. Also not very surprising you may use external file resources
        as validaton scripts. The syntax looks like follows:</p><pre class="programlisting">
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloResponseReceiver"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">timeout</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"5000"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">script</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"groovy"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:validationScript.groovy"</span>/&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/validate</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Operation"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sayHello"</span>/&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"CorrelationId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;
        </pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">You can use the Groovy validation script in combination with other validation types like XML tree comparison and XPath validation.</td></tr></table></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">For further information on the Groovy XmlSlurper please see the official Groovy website and documentation</td></tr></table></div></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="actions"></a>Chapter&nbsp;7.&nbsp;Test actions</h2></div></div></div><p>This chapter gives a brief description to all test actions that a tester can incorporate into the test case. 
  Besides sending and receiving messages the tester may access these actions in order to build a more complex test scenario
  that fits the desired use case.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-database"></a>7.1.&nbsp;Connecting to the database</h2></div></div></div><p>In many cases it is necessary to access the database during a test. This enables a tester to also validate 
    the persistent data in a database. It might also be helpful to prepare the database with some test data before running a test. 
    You can do this using the two database actions that are descirbed in the following sections.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="actions-database-update"></a>7.1.1.&nbsp;Updating the database</h3></div></div></div><p>The &lt;sql&gt; action simply executes a group of SQL statements in order to change data in a database.
      Typically the action is used to prepare the database at the beginning of a test or to clean up the
      database at the end of a test. You can specify SQL statements like INSERT, UPDATE,
      DELETE, CREATE TABLE, ALTER TABLE and many more.</p><p>On the one hand you can specify the statements as inline SQL or stored in an external
      SQL resource file as shown in the next two examples.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sql</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">datasource</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"someDataSource"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">statement</span>&gt;DELETE FROM CUSTOMERS&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/statement</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">statement</span>&gt;DELETE FROM ORDERS&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/statement</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/sql</span>&gt;
    
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sql</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">datasource</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myDataSource"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">resource</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"file:tests/unit/resources/script.sql"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/sql</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;</pre><p>The first action uses inline SQL statements defined directly inside the test case. The next action uses an external 
      SQL resource file instead. The file resource can hold several SQL statements separated by new lines. All statements inside 
      the file are executed sequentially by the framework.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>You have to pay attention to some rules when dealing with external SQL resources.</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p>Each statement should begin in a new line</p></li><li style="list-style-type: circle"><p>It is not allowed to define statements with word wrapping</p></li><li style="list-style-type: circle"><p>Comments begin with two dashes "--"</p></li></ul></div></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The external file is referenced either as file system resource or class path resource,
        by using the "file:" or "classpath:" prefix.</p></td></tr></table></div><p>Both examples use the "datasource" attribute. This value defines the database data source to be used. The connection to
      a data source is mandatory, because the test case does not know about user credentials or database names. The 'datasource' attribute 
      references predefined data sources that are located in a separate Spring configuration file.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="actions-database-query"></a>7.1.2.&nbsp;Verifying data from the database</h3></div></div></div><p>The &lt;sql&gt; action is specially designed to execute SQL queries (SELECT * FROM). So the test is able to get data from a database. 
      The query results are validated against expected data as shown in the next example.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sql</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">datasource</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testDataSource"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">statement</span>&gt;select NAME from CUSTOMERS where ID='${customerId}'&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/statement</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">statement</span>&gt;select count(*) from ERRORS&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/statement</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">statement</span>&gt;select ID from ORDERS where DESC LIKE 'Def%'&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/statement</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">statement</span>&gt;select DESCRIPTION from ORDERS where ID='${id}'&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/statement</span>&gt;
    
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">column</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"ID"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"1"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">column</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"NAME"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Christoph"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">column</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"COUNT(*)"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${rowsCount}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">column</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"DESCRIPTION"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"null"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/sql</span>&gt;</pre><p>The action &lt;sql&gt; offers a wide range of validating functionality for database result sets. First
      of all you have to select the data via SQL statements. Here again you have the choice to use inline SQL
      statements or external file resource pattern.</p><p>The result sets are validated through &lt;validate&gt; elements. It is possible to do a detailed check on
      every selected column of the result set. Simply refer to the selected column name in order to validate its
      value. The usage of test variables is supported as well as database expressions like count(), avg(), min(),
      max().</p><p>You simply define the &lt;validate&gt; entry with the column name as the "column" attribute and any expected
      value expression as expected "value". The framework then will check the column to fit the expected value and raise 
      validation errors in case of mismatch.</p><p>Looking at the first SELECT statement in the example you will see that test variables are supported in the 
      SQL statements. The framework will replace the variable with its respective value before sending it to the database.</p><p>In the validation section variables can be used too. Look at the third validation entry, where the variable
      "${rowsCount}" is used. The last validation in this example shows, that <code class="literal">NULL</code> values are 
      also supported as expected values.</p><p>If a single validation happens to fail, the whole action will fail with respective validation errors.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>The validation with <code class="literal">"&lt;validate column="..." value="..."/&gt;"</code> 
        meets single row result sets as you specify a single column control value. In case you have multiple rows in a result 
        set you rather need to validate the columns with multiple control values like this:</p><pre class="programlisting">
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">column</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"someColumnName"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">values</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;Value in 1st row&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;Value in 2nd row&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;Value in 3rd row&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;Value in x row&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/values</span>&gt;               
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/validate</span>&gt;
        </pre></td></tr></table></div><p>Next example shows how to work with multiple row result sets:</p><pre class="programlisting">
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sql</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">datasource</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testDataSource"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">statement</span>&gt;select WEEKDAY as DAY, DESCRIPTION from WEEK&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/statement</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">column</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"DAY"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">values</span>&gt;
       	      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;Monday&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
       	      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;Tuesday&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;Wednesday&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;Thursday&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;Friday&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;@ignore@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;@ignore@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/values</span>&gt;            	
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/validate</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">column</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"DESCRIPTION"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">values</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;I hate Mondays!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;Tuesday is sports day&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;The mid of the week&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;Thursday we play chess&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;Friday, the weekend is near!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;@ignore@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;@ignore@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/values</span>&gt;            	
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/validate</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/sql</span>&gt;
      </pre><p>For the validation of multiple rows the <code class="literal">&lt;validate&gt;</code> element is able to host a list of control values for a column. 
      As you can see from the example above, you have to add a control value for each row in the result set. This also means that we have to take care 
      of the total number of rows. Fortunately we can use the ignore placeholder, in order to skip the validation of a specific row in the result set. 
      Functions and variables are supported as usual.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>It is important, that the control values are defined in the correct order, because they are compared one on one with the actual 
        result set coming from database query. You may need to add "order by" SQL expressions to get the right order of rows returned. If any of the values 
        fails in validation or the total number of rows is not equal, the whole action will fail with respective validation errors.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="actions-database-groovy"></a>7.1.3.&nbsp;Groovy SQL result set validation</h3></div></div></div><p>Groovy provides great support for accessing Java list objects and maps. As a Java SQL result set is nothing but a list of
      map representations, where each entry in the list defines a row in the result set and each map entry represents the columns and values. So
      with Groovy's list and map access we have great possibilities to validate a SQL result set - out of the box.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sql</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">datasource</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testDataSource"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">statement</span>&gt;select ID from CUSTOMERS where NAME='${customerName}'&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/statement</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">statement</span>&gt;select ORDERTYPE, STATUS from ORDERS where ID='${orderId}'&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/statement</span>&gt;
    
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate-script</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"groovy"</span>&gt;
        assert rows.size() == 2
        assert rows[0].ID == '1'
        assert rows[1].STATUS == 'in progress'
        assert rows[1] == [ORDERTYPE:'SampleOrder', STATUS:'in progress']               
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/validate-script</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/sql</span>&gt;</pre><p>As you can see Groovy provides fantastic access methods to the SQL result set. We can browse the result set with named column values and check the size 
      of the result set. We are also able to search for an entry, iterate over the result set and have other helpful operations. For a detailed description of the list and map 
      handling in Groovy my advice for you is to have a look at the official Groovy documentation.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>In general other script languages do also support this kind of list and map access. For now we just have implemented the Groovy script support,
      but the framework is ready to work with all other great script languages out there, too (e.g. Scala, Clojure, Fantom, etc.). So if you prefer to work with another language
      join and help us implement those features.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="actions-database-read-values"></a>7.1.4.&nbsp;Read data from database</h3></div></div></div><p>Now the validation of database entries is a very powerful feature but sometimes we simply do not know the
      persisted content values. The test may want to read database entries into test variables without validation. Citrus
      is able to do that with the following &lt;extract&gt; expressions:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sql</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">datasource</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testDataSource"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">statement</span>&gt;select ID from CUSTOMERS where NAME='${customerName}'&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/statement</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">statement</span>&gt;select STATUS from ORDERS where ID='${orderId}'&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/statement</span>&gt;
    
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">extract</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">column</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"ID"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">variable</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${customerId}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">extract</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">column</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"STATUS"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">variable</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${orderStatus}"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/sql</span>&gt;</pre><p>We can save the database column values directly to test variables. Of course you can combine the value extraction 
      with the normal column validation described earlier in this chapter. Please keep in mind that we can not use these operations
      on result sets with multiple rows. Citrus will always use the first row in a result set.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-sleep"></a>7.2.&nbsp;Sleep</h2></div></div></div><p>This action shows how to make the test framework sleep for a given amount of time. The attribute 'time' defines 
    the amount of time to wait in seconds. As shown in the next example decimal values are supported too. When no waiting time is
    specified the default time of 5.0 seconds applies.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sleepTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sleep</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">time</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"3.5"</span>/&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sleep</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>When should somebody use this action? To us this action was always very useful in case the test needed to wait until 
    an application had done some work. For example in some cases the application took some time to write some data into the database.
    We waited then a small amount of time in order to avoid unnessesary test failures, because the test framework simply validated 
    the database too early. Or as another example the test may wait a given time until retry mechanisms are triggered in the tested
    application and then proceed with the test actions.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-java"></a>7.3.&nbsp;Java</h2></div></div></div><p>The test framework is written in Java and runs inside a Java virtual machine. The functionality of calling other 
    Java objects and methods in this same Java VM through Java Reflection is self-evident. 
    With this action you can call any Java API available at runtime through the specified Java classpath.</p><p>The action syntax looks like follows:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">java</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.test.util.InvocationDummy"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">argument</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">""</span>&gt;Test Invocation&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/argument</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/constructor</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">method</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"invoke"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">argument</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"String[]"</span>&gt;1,2&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/argument</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/method</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/java</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">java</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.test.util.InvocationDummy"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">argument</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">""</span>&gt;Test Invocation&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/argument</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/constructor</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">method</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"invoke"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">argument</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"int"</span>&gt;4&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/argument</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">argument</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"String"</span>&gt;Test Invocation&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/argument</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">argument</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"boolean"</span>&gt;true&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/argument</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/method</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/java</span>&gt;
    
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">java</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.test.util.InvocationDummy"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">method</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"main"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">argument</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"String[]"</span>&gt;4,Test,true &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/argument</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/method</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/java</span>&gt;</pre><p>The Java class is specified by fully qualified class name. Constructor arguments are added using the &lt;constructor&gt; 
    element with a list of &lt;argument&gt; child elements. The type of the argument is defined within the respective 
    attribute "type". By default the type would be String.</p><p>The invoked method on the Java object is simply referenced by its name. Method arguments do not bring anything new 
    after knowing the constructor argument definition, do they?.</p><p>Method arguments support data type conversion too, even string arrays (useful when
    calling CLIs). In the third action in the example code you can see that colon separated strings are automatically 
    converted to string arrays.</p><p>Simple data types are defined by their name (int, boolean, float etc.). Be sure that the invoked method
    and class constructor fit your arguments and vice versa, otherwise you will cause errors at runtime.</p><p>Besides instantiating a fully new object instance for a class how about reusing a bean instance available in Spring bean container. Simply
    use the <span class="emphasis"><em>ref</em></span> attribute and refer to an existing bean in Spring application context.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">java</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">ref</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"invocationDummy"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">method</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"invoke"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">argument</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"int"</span>&gt;4&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/argument</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">argument</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"String"</span>&gt;Test Invocation&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/argument</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">argument</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"boolean"</span>&gt;true&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/argument</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/method</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/java</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"invocationDummy"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.test.util.InvocationDummy"</span>/&gt;
    </pre><p>The method is invoked on the Spring bean instance. This is very useful as you can inject other objects (e.g. via Autowiring) to the Spring bean 
    instance before method invocation in test takes place. This enables you to execute any Java logic inside a test case.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-timeout"></a>7.4.&nbsp;Expect timeouts on a destination</h2></div></div></div><p>In some cases it might be necessary to validate that a message is <span class="emphasis"><em>not</em></span> present on a destination. 
    This means that this action expects a timeout when receiving a message from an endpoint destination. For instance the tester 
    intends to ensure that no message is sent to a certain destination in a time period. In that case the timeout would 
    not be a test aborting error but the expected behavior. And in contrast to the normal behavior when a message is received 
    in the time period the test will fail with error.</p><p>In order to validate such a timeout situation the action &lt;expectTimout&gt; shall help. The usage
    is very simple as the following example shows:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"receiveJMSimeoutTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">expect-timeout</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message-receiver</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myMessageReceiver"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">wait</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"500"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>The action offers two attributes:</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p><span class="emphasis"><em>message-receiver</em></span>: Reference to a message receiver that will try to receive messages.</p></li><li style="list-style-type: circle"><p><span class="emphasis"><em>wait</em></span>: Time period to wait for messages to arrive</p></li></ul></div><p>TODO: describe receive selected!</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-echo"></a>7.5.&nbsp;Echo</h2></div></div></div><p>The &lt;echo&gt; action prints messages to the console/logger. This functionality is useful when
    debugging test runs. The property "message" defines the text that is printed. Tester might use it to print
    out debug messages and variables as shown the next code example:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"echoTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"date"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:currentDate()"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;Hello Test Framework&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;Current date is: ${date}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>Result on the console:</p><pre class="programlisting">Hello Test Framework
Current time is: 05.08.2008</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-measure-time"></a>7.6.&nbsp;Time measurement</h2></div></div></div><p>Time measurement during a test can be very helpful. The &lt;trace-time&gt; action creates and monitors 
    multiple timelines. The action offers the attribute "id" to identify a time line. The tester can of course 
    use more than one time line with different ids simultaneously.</p><p>Read the next example and you will understand the mix of different time lines:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"timeWatcherTest_new"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">trace-time</span>/&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">trace-time</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"time_line_id"</span>/&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sleep</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">time</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"3.5"</span>/&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">trace-time</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">" time_line_id "</span>/&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sleep</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">time</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"5.0"</span>/&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">trace-time</span>/&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">trace-time</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">" time_line_id "</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>The test output looks like follows:</p><pre class="programlisting">Starting TimeWatcher:
Starting TimeWatcher: time_line_id
TimeWatcher time_line_id after 3.5 seconds
TimeWatcher after 8.5 seconds
TimeWatcher time_line_id after 8.5 seconds</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">In case no time line id is specified the framework will measure the time for a default time line.</td></tr></table></div><p>To print out the current elapsed time for a time line you simply have to place the &lt;trace-time&gt; action into
    the action chain again and again, using the respective time line identifier. The elapsed time will be printed out to the console every time.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-create-variables"></a>7.7.&nbsp;Create variables</h2></div></div></div><p>As you know variables usually are defined at the beginning of the test case (<a href="#testcase-variables" title="4.1.2.&nbsp;Variables">Section&nbsp;4.1.2, &#8220;Variables&#8221;</a>). 
    It might also be helpful to reset existing variables as well as to define new variables during the test. The 
    action &lt;create-variables&gt; is able to declare new variables or overwrite existing ones.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"createVariablesTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myVariable"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"12345"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"id"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"54321"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;Current variable value: ${myVariable} &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">create-variables</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myVariable"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${id}"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"newVariable"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"'this is a test'"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/create-variables</span>&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;Current variable value: ${myVariable} &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
    
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
              New variable 'newVariable' has the value: ${newVariable}
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>The new variables are valid for the rest of the test. Actions reference them as usual through a variable expression.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-trace"></a>7.8.&nbsp;Trace variables</h2></div></div></div><p>You already know the &lt;echo&gt; action that prints messages to the console or logger. The
    &lt;trace-variables&gt; action is specially designed to trace all currently valid test variables to the console. 
    This was mainly used by us for debug reasons. The usage is quite simple:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"traceVariablesTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myVariable"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"12345"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"nextVariable"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"54321"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">trace-variables</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myVariable"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"nextVariable"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/trace-variables</span>&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">trace-variables</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>Simply add the &lt;trace-variables&gt; action to your action chain and all variables will be printed out to
    the console. You are able to define a special set of variables by using the &lt;variable&gt; child
    elements. See the output that was generated by the test example above:</p><pre class="programlisting">Current value of variable myVariable = 12345
Current value of variable nextVariable = 54321</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-transform"></a>7.9.&nbsp;Transform</h2></div></div></div><p>The <code class="literal">&lt;transform&gt;</code> action transforms XML fragments with XSLT in order to construct various XML representations. 
    The transformation result is stored into a test variable for further usage. The property <span class="emphasis"><em>xml-data</em></span> defines the XML source, 
    that is going to be transformed, while <span class="emphasis"><em>xslt-data</em></span> defines the XSLT transformation rules. The attribute 
    <span class="emphasis"><em>variable</em></span> specifies the target test variable which receives the transformation result. The tester might use the action to 
    transform XML messages as shown in the next code example:</p><pre class="programlisting">
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"transformTest"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">transform</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">variable</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"result"</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">xml-data</span>&gt;
                  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;TestRequest&gt;</span>
                          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;Message&gt;Hello</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">World!&lt;/Message&gt;</span>
                      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/TestRequest&gt;</span>
                  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">]]&gt;</span>
              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/xml-data&gt;</span>
              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;xslt-data&gt;</span>
                  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;![CDATA[</span>
                      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;xsl:stylesheet</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">version</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"1.0"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xsl</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/1999/XSL/Transform"</span>&gt;
                      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">xsl:template</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">match</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"/"</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">html</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">body</span>&gt;
                                  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">h2</span>&gt;Test Request&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/h2</span>&gt;
                                  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">p</span>&gt;Message: &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">xsl:value-of</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">select</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"TestRequest/Message"</span>/&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/p</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/body</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/html</span>&gt;
                      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/xsl:template</span>&gt;
                      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/xsl:stylesheet</span>&gt;
                  ]]&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/xslt-data</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/transform</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;${result}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;
    </pre><p>The transformation above results to:</p><pre class="programlisting">
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">html</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">body</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">h2</span>&gt;Test Request&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/h2</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">p</span>&gt;Message: Hello World!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/p</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/body</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/html</span>&gt;
    </pre><p>In the example we used CDATA sections to define the transformation source as well as the XSL transformation rules. As usual you can also use 
    external file resources here. The transform action with external file resources looks like follows:</p><pre class="programlisting">
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">transform</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">variable</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"result"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">xml-resource</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:transform-source.xml"</span>/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">xslt-resource</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:transform.xslt"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/transform</span>&gt;
    </pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-groovy"></a>7.10.&nbsp;Groovy support</h2></div></div></div><p>Groovy is an agile dynamic language for the Java Platform. Groovy ships with a lot of 
    very powerful features and fits perfectly with Java as it is based on Java and runs
    inside the JVM.</p><p>The Citrus Groovy support might be the entrance for you to write customized test actions. 
    You can easily execute Groovy code inside a test case, just like a normal test action. The 
    whole test context with all variables is available to the Groovy action. This means someone
    can change variable values or create new variables very easily.</p><p>Let's have a look at some examples in order to understand the possible Groovy code 
    interactions in Citrus:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"groovyTest"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"time"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:currentDate()"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">groovy</span>&gt;
        println 'Hello Citrus'
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/groovy</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">groovy</span>&gt;
        println 'The variable is: ${time}'
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/groovy</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">groovy</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">resource</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:com/consol/citrus/script/example.groovy"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>As you can see it is possible to write Groovy code directly into the test case. 
    Citrus will interpret and execute the Groovy code at runtime. As usual nested variable expressions 
    are replaced with respective values. In general this is done in advance before the Groovy code is 
    interpreted. For more complex Groovy code sections which grow in lines of code you can also reference 
    external file resources.</p><p>After this basic Groovy code usage inside a test case we might be interested accessing the whole
    TestContext. The TestContext Java object holds all test variables and function definitions for the 
    test case and can be referenced in Groovy code via simple naming convention. Just access the object 
    reference 'context' and you are able to manipulate the TestContext (e.g. setting a new variable which 
    is directly ready for use in following test actions).</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"groovyTest"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">groovy</span>&gt;
      context.setVariable("greetingText","Hello Citrus")
      println context.getVariable("greetingText")
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/groovy</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;New variable: ${greetingText}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The implicit TestContext access that was shown in the previous sample works with a default Groovy script
        template provided by Citrus. The Groovy code you write in the test case is automatically surrounded with a Groovy 
        script which takes care of handling the TestContext. The default template looks like follows:</p><pre class="programlisting"><span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> com.consol.citrus.*
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> com.consol.citrus.variable.*
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> com.consol.citrus.context.TestContext
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> com.consol.citrus.script.GroovyAction.ScriptExecutor

<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">class</span> GScript <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">implements</span> ScriptExecutor {
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> execute(TestContext context) {
        @SCRIPTBODY@
    }
}</pre><p>Your code is placed in substitution to the <code class="literal">@SCRIPTBODY@</code> placeholder. Now you might understand how
        Citrus handles the context automatically. You can also write your own script templates making more advanced usage of other Java
        APIs and Groovy code. Just add a script template path to the test action like this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">groovy</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">script-template</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:my-custom-template.groovy"</span>&gt;
  [...]
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/groovy</span>&gt;</pre><p>On the other hand you can disable the automatic script template wrapping in your action at all:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">groovy</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">use-script-template</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"false"</span>&gt;
  println 'Just use some Groovy code'
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/groovy</span>&gt;</pre></td></tr></table></div><p>The next example deals with advanced Groovy code and writing whole classes. We write a new Groovy class 
    which implements the ScriptExecutor interface offered by Citrus. This interface defines a special execute 
    method and provides access to the whole TestContext for advanced test variables access.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"groovyTest"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"time"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:currentDate()"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">groovy</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">import</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">com.consol.citrus.*</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">import</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">com.consol.citrus.variable.*</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">import</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">com.consol.citrus.context.TestContext</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">import</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">com.consol.citrus.script.GroovyAction.ScriptExecutor</span>
        
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">GScript</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">implements</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">ScriptExecutor</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">{</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">void</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">execute(TestContext</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">context)</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">{</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">println</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">context.getVariable("time")</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">}</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">}</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">]]&gt;</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/groovy&gt;</span>
  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/actions&gt;</span>
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/testcase&gt;</span></pre><p>Implementing the ScriptExecutor interface in a custom Groovy class is applicable for very special 
    test context manipulations as you are able to import and use other Java API classes in this code.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-fail"></a>7.11.&nbsp;Failing the test</h2></div></div></div><p>The fail action will generate an exception in order to terminate the test case with error. The test case will
    therefore not be successful in the reports.</p><p>The user can specify a custom error message for the exception in order to describe the error cause. Here is a 
    very simple example to clarify the syntax:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"failTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">fail</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Test will fail with custom message"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>Test results:</p><pre class="programlisting">Execution of test: failTest failed! Nested exception is: 
com.consol.citrus.exceptions.CitrusRuntimeException: 
Test will fail with custom message

[...]

CITRUS TEST RESULTS

failTest          : failed - Exception is: Test will fail with custom message

Found 1 test cases to execute
Skipped 0 test cases (0.0%)
Executed 1 test cases, containing 3 actions
Tests failed:        1 (100.0%)
Tests successfully:  0 (0.0%) </pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-input"></a>7.12.&nbsp;Input</h2></div></div></div><p>During the test case execution it is possible to read some user input from the command line. The test execution will 
    stop and wait for keyboard inputs over the standard input stream. The user has to type the input and end it with the return 
    key.</p><p>The user input is stored to the respective variable value.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"inputTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"userinput"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">""</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variable</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"userinput1"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">""</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variable</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"userinput2"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"y"</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variable</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"userinput3"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"yes"</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variable</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"userinput4"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">""</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variable</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">input</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;user input was: ${userinput}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">input</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Now press enter:"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">variable</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"userinput1"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;user input was: ${userinput1}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">input</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Do you want to continue?"</span> 
                  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">valid-answers</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"y/n"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">variable</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"userinput2"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;user input was: ${userinput2}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">input</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Do you want to continue?"</span> 
                  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">valid-answers</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"yes/no"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">variable</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"userinput3"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;user input was: ${userinput3}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">input</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">variable</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"userinput4"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;user input was: ${userinput4}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>The input action has following attributes:</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p><span class="emphasis"><em>message</em></span> -&gt; message displayed to the user</p></li><li style="list-style-type: circle"><p><span class="emphasis"><em>valid-answers</em></span> -&gt; optional slash separated string containing the possible answers</p></li><li style="list-style-type: circle"><p><span class="emphasis"><em>variable</em></span> -&gt; destination variable to store the user input (default = ${userinput})</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>When user input is restricted to a set of valid answers the input validation of course can fail due to mismatch. 
        In this case the user is again asked to provide the input until a valid answer is given.</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>User inputs may not fit to automatic testing in terms of continuous integration testing where no user is present to 
        type in the correct answer over the keyboard. In this case you can always skip the user input in advance by specifying
        a variable that matches the user input variable name. As the user input variable is then already present the user 
        input is missed out and the test proceeds automatically.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-load"></a>7.13.&nbsp;Load</h2></div></div></div><p>You are able to load properties from external property files and store them as test variables. The action will
    require a file resource either from class path or file system in order to read the property values.</p><p>Let us look at an example to get an idea about this action:</p><p>Content of load.properties:</p><pre class="programlisting">username=Mickey Mouse
greeting.text=Hello Test Framework</pre><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"loadPropertiesTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">load</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">properties</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"file:tests/resources/load.properties"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/load</span>&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">trace-variables</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>Output:</p><pre class="programlisting">Current value of variable username = Mickey Mouse
Current value of variable greeting.text = Hello Test Framework</pre><p>The action will load all available properties in the file load.properties and store them to the test case
    as local variables.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>Existing variables are overwritten!</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-purge-jms"></a>7.14.&nbsp;Purging JMS destinations</h2></div></div></div><p>Purging JMS destinations during the test run is quite essential. Different test cases can influence each other when sending
    messages to the same JMS destinations. A test case should only receive those messages that actually belong to it. Therefore it is a 
    good idea to purge all JMS queue destinations between the test cases. Obsolete messages that are stuck in a JMS queue for some 
    reason are then removed so that the following test case is not offended.</p><p>So we need to purge some JMS queues in our test case. This can be done with following action definition:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"purgeTest"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">purge-jms-queues</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">queue</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Some.JMS.QUEUE.Name"</span>/&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">queue</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Another.JMS.QUEUE.Name"</span>/&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">queue</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"My.JMS.QUEUE.Name"</span>/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/purge-jms-queues</span>&gt;
      
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">purge-jms-queues</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">connection-factory</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"connectionFactory"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">queue</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Some.JMS.QUEUE.Name"</span>/&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">queue</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Another.JMS.QUEUE.Name"</span>/&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">queue</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"My.JMS.QUEUE.Name"</span>/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/purge-jms-queues</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>Purging the JMS queues in every test case is quite exhausting because every test case needs to define a purging action at the 
    very beginning of the test. Fortunately the test suite definition offers tasks to run before, between and after the test cases which 
    should ease up this tasks a lot. The test suite offers a very simple way to purge the destinations between the tests. 
    See <a href="#testsuite-before-test" title="18.3.&nbsp;Before test">Section&nbsp;18.3, &#8220;Before test&#8221;</a> for more information about this.</p><p>When using the special tasks between a test case you might define a normal Spring bean definition that is referenced then. The 
    'com.consol.citrus.actions.PurgeJmsQueuesAction' action offers the property "queueNames" to hold all destination names 
    that are supposed to be purged. As you can see in the next example it is quite easy to specify a group of destinations in the Spring configuration.
    This purging bean is then added to the test suite in the tasks between section.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"purgeJmsQueues"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.actions.PurgeJmsQueuesAction"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"connectionFactory"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">ref</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jmsQueueConnectionFactory"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"queueNames"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">list</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;${jms.queue.hello.request.in}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;${jms.queue.hello.response.out}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;${jms.queue.echo.request}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;${jms.queue.echo.response}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;JMS.Queue.Dummy&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/list</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>So now we are able to purge JMS destinations with given destination names. But sometimes we do not want to rely on queue or topic names as 
    we retrieve destinations over JNDI for instance. We can deal with destinations coming from JNDI lookup like follows:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">jee:jndi-lookup</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jmsQueueHelloRequestIn"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">jndi-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jms/jmsQueueHelloRequestIn"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">jee:jndi-lookup</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jmsQueueHelloResponseOut"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">jndi-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jms/jmsQueueHelloResponseOut"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"purgeJmsQueues"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.actions.PurgeJmsQueuesAction"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"connectionFactory"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">ref</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jmsQueueConnectionFactory"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"queues"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">list</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ref</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">bean</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jmsQueueHelloRequestIn"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ref</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">bean</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jmsQueueHelloResponseOut"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/list</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>We just use the property <span class="emphasis"><em>'queues'</em></span> instead of <span class="emphasis"><em>'queueNames'</em></span> and Citrus will be able to receive 
    bean references that resolve to JMS destinations. We can purge these destination references in a test case, too. Just use the <span class="emphasis"><em>'ref'</em></span>
    attribute instead of already known <span class="emphasis"><em>'name'</em></span> attribute:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"purgeTest"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">purge-jms-queues</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">queue</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">ref</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jmsQueueHelloRequestIn"</span>/&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">queue</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">ref</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jmsQueueHelloResponseOut"</span>/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/purge-jms-queues</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-purge-channels"></a>7.15.&nbsp;Purging message channels</h2></div></div></div><p>Message channels define central messaging destinations in Citrus. These are namely in memory message queues holding 
    messages for test cases. These messages may become obsolete during a test run, especially when test cases fail and stop in 
    their message consumption. Purging these message channel destinations is essential in these scenarios in order to not influence
    upcoming test cases. Each test case should only receive those messages that actually refer to the test model. Therefore it is a 
    good idea to purge all message channel destinations between the test cases. Obsolete messages that get stuck in a message channel 
    destination for some reason are then removed so that upcoming test case are not broken.</p><p>Following action definition purges all messages from a list of message channels:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"purgeChannelTest"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">purge-channels</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">channel</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"someChannelName"</span>/&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">channel</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"anotherChannelName"</span>/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/purge-channels</span>&gt;
      
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">purge-channel</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message-selector</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"specialMessageSelector"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">channel</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">ref</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"someChannel"</span>/&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">channel</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">ref</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"anotherChannel"</span>/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/purge-channel</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>As you can see the test action supports channel names as well as channel referenes to bean instances. When using channel references
    you refer to the Spring bean id or name in your application context.</p><p>Message selectors enable you to selectively remove messages from the destination. All messages that
    pass the message selection logic get deleted the other messages will remain unchanged inside the channel destination. The 
    message selector is a Spring bean that implements a special message selector interface. A possible implementation could be a 
    selector deleting all messages that are older than five seconds:</p><pre class="programlisting"><span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> org.springframework.integration.Message;
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> org.springframework.integration.core.MessageSelector;

<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">class</span> TimeBasedMessageSelector <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">implements</span> MessageSelector {

    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">boolean</span> accept(Message&lt;?&gt; message) {
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">if</span> (System.currentTimeMillis() - message.getHeaders().getTimestamp() &gt; 5000) {
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">return</span> false;
        } <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">else</span> {
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">return</span> true;
        }
    }

}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The message selector returns <span class="emphasis"><em>false</em></span> for those messages that should be deleted from the channel!</p></td></tr></table></div><p>You simply define the message selector as a new Spring bean in the Citrus application context and reference it in your test action property.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"specialMessageSelector"</span> 
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.special.TimeBasedMessageSelector"</span>/&gt;</pre><p>Purging channels in each test case every time is quite exhausting because every test case needs to define a purging action at the 
    very beginning of the test. A more straight forward approach would be to introduce some purging action which is automatically executed before each test. 
    Fortunately the Citrus test suite offers a very simple way to do this. It is described in <a href="#testsuite-before-test" title="18.3.&nbsp;Before test">Section&nbsp;18.3, &#8220;Before test&#8221;</a>.</p><p>When using the special action sequence between test cases you must define a normal Spring bean definition first. The 
    'com.consol.citrus.actions.PurgeMessageChannelAction' bean offers the respective properties for setting channel destinations to be purged. 
    See the upcoming example to find out how the action is defined in the Spring configuration application context.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"purgeMessageChannels"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.actions.PurgeMessageChannelsAction"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"channelNames"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">list</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;fooChannel&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;barChannel&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/list</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>Use this Spring bean definition in the action sequence before each test and your test do not influence each other with obsolete messages still
    waiting on the message channels for consumption.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-assert"></a>7.16.&nbsp;Assert failure</h2></div></div></div><p>Citrus test actions fail with Java exceptions and error messages. This gives you the opportunity to expect an action to fail during test
    execution. You can simple assert a Java exception to be thrown during execution. See the example for an assert action definition in a test case:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"assertFailureTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">assert</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">exception</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.exceptions.CitrusRuntimeException"</span>
                   <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Unknown variable ${date}"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;Current date is: ${date}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/assert</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Note that the assert action requires an exception. In case no exception is thrown by the embedded test action the assertion
        and the test case will fail!</p></td></tr></table></div><p>The assert action always wraps a single test action, which is then monitored for failure. In case the nested test action fails with error you
    can validate the error in its type and error message (optional). The failure has to fit the expected one exactly otherwise the assertion fails itself.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>Important to notice is the fact that asserted exceptions do not cause failure of the test case. As you except the failure to happen the test continues
        with its work once the assertion is done successfully.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-catch"></a>7.17.&nbsp;Catch exceptions</h2></div></div></div><p>In the previous chapter we learned how to expect failures in Citrus with assert action. Now the assert action is designed for one single
    action to be monitored for failures. The <span class="emphasis"><em>'catch'</em></span> action in contrary will hold several nested test actions and catch 
    possible errors. The nested actions are error proof for the chosen exception type, but only for the chosen exception type other exception 
    types may cause the test to fail.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"catchExceptionTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">catch</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">exception</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.exceptions.CitrusRuntimeException"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;Current date is: ${date}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/catch</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>Note that there is no validation available in a catch block. So catching exceptions is just to make a test more stable towards
        errors that can occur. The caught exception does not cause any failure in the test. The test case may continue with execution as if there was not failure.
        Also notice that the catch action is also happy when no exception at all is caught. In contrary to the assert action which requires the failure the catch
        block is not failing in positive processing.</p></td></tr></table></div><p>Catching exceptions like this may only fit to very error prone action blocks where failures do not harm the test case success. Otherwise a failure 
    in a test action should always reflect to the whole test case to fail with errors.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-generic-action"></a>7.18.&nbsp;Including own actions</h2></div></div></div><p>The generic &lt;action&gt; element references Spring beans that implement the Java interface 
    <code class="literal">com.consol.citrus.TestAction</code>. This is a very fast way to add your own action 
    implementations to a test case. You can implement own actions in Java and include them into a test case.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"actionReferenceTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">action</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">reference</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"cleanUpDatabase"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">action</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">reference</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"mySpecialAction"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>In the example above the called actions are special database cleanup implementations. The actions are defined as Spring beans 
    in the Citrus configuration and get referenced by their bean name or id.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="templates"></a>Chapter&nbsp;8.&nbsp;Templates</h2></div></div></div><p>Templates group action sequences to a logical unit. You can think of templates as reusable components
    that are used in several tests. The maintenance is much more effective because the templates are referenced
    several times.</p><p>The template always has a unique name. Inside a test case we call the template by this unique name. 
    Have a look at a first example:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">template</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"doCreateVariables"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">create-variables</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"var"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"123456789"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/create-variables</span>&gt;
    
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">call-template</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"doTraceVariables"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/template</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">template</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"doTraceVariables"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;Current time is: ${time}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
    
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">trace-variables</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/template</span>&gt;</pre><p>The code example above describes two template definitions. Templates hold a sequence of test 
    actions or call other templates themselves as seen in the example above.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The &lt;call-template&gt; action calls other templates by their name. The called
      template not necessarily has to be located in the same test case XML file. The template might be defined in
      a separate XML file other than the test case itself:</p></td></tr></table></div><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"templateTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myTime"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:currentDate()"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">call-template</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"doCreateVariables"</span>/&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">call-template</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"doTraceVariables"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">parameter</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"time"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${myTime}"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/call-template</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>There is an open question when dealing with templates that are defined somewhere else outside the test case.
    How to handle variables? A templates may use different variable names then the test and vice versa. No doubt the 
    template will fail as soon as special variables with respective values are not present. Unknown variables 
    cause the template and the whole test to fail with errors.</p><p>So a first approach would be to harmonize variable usage across templates and test cases, so that templates
    and test cases do use the same variable naming. But this approach might lead to high calibration effort. Therefore 
    templates support parameters to solve this problem. When a template is called the calling actor is able to set some 
    parameters. Let us discuss an example for this issue.</p><p>The template "doDateCoversion" in the next sample uses the variable ${date}. The calling test case 
    can set this variable as a parameter without actually declaring the variable in the test itself:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">call-template</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"doDateCoversion"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">parameter</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"date"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${sampleDate}"</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/call-template</span>&gt;</pre><p>The variable <span class="emphasis"><em>sampleDate</em></span> is already present in the test case and gets translated into the 
    <span class="emphasis"><em>date</em></span> parameter. Following from that the template works fine although test and template do work on 
    different variable namings.</p><p>With template parameters you are able to solve the calibration effort when working with templates and variables. 
    It is always a good idea to check the used variables/parameters inside a template when calling it. There might be a 
    variable that is not declared yet inside your test. So you need to define this value as a parameter.</p><p>Template parameters may contain more complex values like XML fragments. The call-template action offers following 
    CDATA variation for defining complex parameter values:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">call-template</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"printXMLPayload"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">parameter</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"payload"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;HelloRequest</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/samples/sayHello.xsd"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Text</span>&gt;Hello South ${var}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Text</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/HelloRequest</span>&gt;
        ]]&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/parameter</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/call-template</span>&gt;</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>When a template works on variable values and parameters changes to these variables will automatically affect the variables 
        in the whole test. So if you change a variable's value inside a template and the variable is defined inside the test case the
        changes will affect the variable in a global context. We have to be careful with this when executing a template several
        times in a test, especially in combination with parallel containers (see <a href="#containers-parallel" title="9.3.&nbsp;Parallel">Section&nbsp;9.3, &#8220;Parallel&#8221;</a>).</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">parallel</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">call-template</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"print"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">parameter</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"param1"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"1"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">parameter</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"param2"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Hello Europe"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/call-template</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">call-template</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"print"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">parameter</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"param1"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"2"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">parameter</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"param2"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Hello Asia"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/call-template</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">call-template</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"print"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">parameter</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"param1"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"3"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">parameter</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"param2"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Hello Africa"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/call-template</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/parallel</span>&gt;</pre><p>In the listing above a template <span class="emphasis"><em>print</em></span> is called several times in a parallel container. The parameter values
        will be handled in a global context, so it is quite likely to happen that the template instances influence each other during execution.
        We might get such print messages:</p><pre class="programlisting">2. Hello Europe
2. Hello Africa
3. Hello Africa</pre><p>Index parameters do not fit and the message <span class="emphasis"><em>'Hello Asia'</em></span> is completely gone. This is because templates 
        overwrite parameters to each other as they are executed in parallel at the same time. To avoid this behavior we need to tell the template 
        that it should handle parameters as well as variables in a local context. This will enforce that each template instance is working on a 
        dedicated local context. See the <span class="emphasis"><em>global-context</em></span> attribute that is set to <span class="emphasis"><em>false</em></span> in this example:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">template</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"print"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">global-context</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"false"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;${param1}.${param2}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/template</span>&gt;</pre><p>After that template instances won't influence each other anymore. But notice that variable changes inside the template then do not affect 
        the test case neither.</p></td></tr></table></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="containers"></a>Chapter&nbsp;9.&nbsp;Containers</h2></div></div></div><p>Similar to templates a container element holds one to many test actions. In contrast to the
  template the container appears directly inside the test case action chain, meaning that the container 
  is not referenced by more than one test case.</p><p>Containers execute the embedded test actions in specific logic. This can be an execution in iteration
  for instance. Combine different containers with each other and you will be able to generate very powerful hierarchical
  structures in order to create a complex execution logic. In the following sections some predefined
  containers are described.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="containers-sequential"></a>9.1.&nbsp;Sequential</h2></div></div></div><p>The sequential container executes the embedded test actions in strict sequence. Readers now might search for 
    the difference to the normal action chain that is specified inside the test case. The actual power of sequential containers 
    does show only in combination with other containers like iterations and parallels. We will see this later when handling 
    these containers.</p><p>For now the sequential container seems not very sensational - one might say boring - because it simply groups a pair of test
    actions to sequential execution.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sequentialTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sequential</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">trace-time</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sleep</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;Hallo TestFramework&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">trace-time</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/sequential</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="containers-conditional"></a>9.2.&nbsp;Conditional</h2></div></div></div><p>Now we deal with conditional executions of test actions. Nested actions inside a conditional container are
    executed only in case a booleand expression evaluates to true. Otherwise the container execution is not performed at all.</p><p>See some example to find out how it works with the conditional expression string.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"conditionalTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">conditional</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">expression</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${value} = 5"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sleep</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">time</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"10"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/conditional</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>The nested sleep action is executed in case the variable ${value} is equal to the value '5'. This conditional execution of test actions
    is useful when dealing with different test environments such as different operating systems for instance.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="containers-parallel"></a>9.3.&nbsp;Parallel</h2></div></div></div><p>Parallel containers execute the embedded test actions concurrent to each other. Every
    action in this container will be executed in a separate Java Thread. Following example should
    clarify the usage:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"parallelTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">parallel</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sleep</span>/&gt;
            
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sequential</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sleep</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;1&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/sequential</span>&gt;
            
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;2&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
            
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;3&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
            
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">iterate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">condition</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"i lt= 5"</span> 
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">index</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"i"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;10&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/iterate</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/parallel</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>So the normal test action processing would be to execute one action after another. As the first 
    action is a sleep of five seconds, the whole test processing would stop and wait for 5 seconds. Things 
    are different inside the parallel container. Here the descending test actions will not wait but execute
    at the same time.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Note that containers can easily wrap other containers. The example shows a simple combination of
      sequential and parallel containers that will archive a complex execution logic. Actions inside the sequential
      container will execute one after another. But actions in parallel will be executed at the same time.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="containers-iterate"></a>9.4.&nbsp;Iterate</h2></div></div></div><p>Iterations are very powerful elements when describing complex logic. The container executes the embedded actions 
    several times. The container will continue with looping as long as the defined breaking condition string evaluates to 
    <code class="literal">true</code>. In case the condition evaluates to <code class="literal">false</code> the iteration will break an finish execution.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"iterateTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">iterate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">index</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"i"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">condition</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"i lt 5"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;index is: ${i}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/iterate</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>The attribute "index" automatically defines a new variable that holds the actual loop index 
    starting at "1". This index variable is available as a normal variable inside the iterate container. Therefore it is possible
    to print out the actual loop index in the echo action as shown in the above example.</p><p>The condition string is mandatory and describes the actual end of the loop. In iterate containers the loop
    will break in case the condition evaluates to <code class="literal">false</code>.</p><p>The condition string can be any Boolean expression and supports several operators:</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p>lt (lower than)</p></li><li style="list-style-type: circle"><p>lt= (lower than equals)</p></li><li style="list-style-type: circle"><p>gt (greater than)</p></li><li style="list-style-type: circle"><p>gt= (greater than equals)</p></li><li style="list-style-type: circle"><p>= (equals)</p></li><li style="list-style-type: circle"><p>and (logical combining of two Boolean values)</p></li><li style="list-style-type: circle"><p>or (logical combining of two Boolean values)</p></li><li style="list-style-type: circle"><p>() (brackets)</p></li></ul></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>It is very important to notice that the condition is evaluated before the very first iteration takes place. 
      The loop therefore can be executed 0-n times according to the condition value.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="containers-repeat"></a>9.5.&nbsp;Repeat until true</h2></div></div></div><p>Quite similar to the previously described iterate container this repeating container will execute its actions in
    a loop according to an ending condition. The condition describes a Boolean expression using
    the operators as described in the previous chapter.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>The loop continues its work until the provided condition evaluates to true. It is very important to notice that the
      repeat loop will execute the actions before evaluating the condition. This means the actions get executed
      1-n times.</p></td></tr></table></div><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"iterateTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">repeat-until-true</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">index</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"i"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">condition</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"(i = 3) or (i = 5)"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;index is: ${i}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/repeat-until-true</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="containers-repeat-onerror"></a>9.6.&nbsp;Repeat on error until true</h2></div></div></div><p>The next looping container is called repeat-on-error-until-true. This container repeats a group of actions 
    in case one embedded action failed with error. In case of an error inside the container the loop will try 
    to execute <code class="literal">all</code> embedded actions again in order to seek for overall success. The execution continues
    until all embedded actions were processed successfully <code class="literal">or</code> the ending condition evaluates to true and the
    error-loop will lead to final failure.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"iterateTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">repeat-onerror-until-true</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">index</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"i"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">condition</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"i = 5"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;index is: ${i}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">fail</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/repeat-onerror-until-true</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>In the code example the error-loop continues four times as the &lt;fail&gt; action definitely fails the test.
    During the fifth iteration The condition "i=5" evaluates to true and the loop breaks its processing leading to a
    final failure as the test actions were not successful.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The overall success of the test case depends on the error situation inside the repeat-onerror-until-true container. In case 
        the loop breaks because of failing actions and the loop will discontinue its work the whole test case is failing too. The error loop
        processing is successful in case all embedded actions were not raising any errors during an iteration.</p></td></tr></table></div><p>The repeat-on-error container also offers an automatic sleep mechanism. This auto-sleep property will force the container to
    wait a given amount of time before executing the next iteration. We used this mechanism a lot when validating database entries. Let's say
    we want to check the existence of an order entry in the database. Unfortunately the system under test is not very performant and may 
    need some time to store the new order. This amount of time is not predictable, especially when dealing with different hardware on our test 
    environments (local testing vs. server testing). Following from that our test case may fail unpredictable only because of runtime 
    conditions.</p><p>We can avoid unstable test cases that are based on these runtime conditions with the auto-sleep functionality.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">repeat-onerror-until-true</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">auto-sleep</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"1"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">condition</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"i = 5"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">index</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"i"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sql</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">datasource</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testDataSource"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">statement</span>&gt;
              SELECT COUNT(1) AS CNT_ORDERS 
              FROM ORDERS 
              WHERE CUSTOMER_ID='${customerId}'
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/statement</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">column</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"CNT_ORDERS"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"1"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/sql</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/repeat-onerror-until-true</span>&gt;</pre><p>We surrounded the database check with a repeat-onerror container having the auto-sleep property set to 1 second. The repeat container
    will try to check the database up to five times with an automatic sleep of 1 second before every iteration. This gives the system under test
    up to five seconds time to store the new entry to the database. The test case is very stable and just fits to the hardware environment. On slow
    test environments the test may need several iterations to successfully read the database entry. On very fast environments the test may succeed
    right on the first try.</p><p>So fast environments are not slowed down by static sleep operations and slower environments are still able to execute this test case
    with high stability.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="finally"></a>Chapter&nbsp;10.&nbsp;Finally section</h2></div></div></div><p>This chapter deals with a special section inside the test case that is executed even in case errors
    did occur during the test. Lets say you have started a Jetty web server instance at the beginning of the 
    test case and you need to shutdown the server when the test has finished its work. Or as a second example
    imagine that you have prepared some data inside the database at the beginning of your test and 
    you want to make sure that the data is cleaned up at the end of the test case.</p><p>In both situations we might run into some problems when the test failed. 
    We face the problem that the whole test case will terminate immediately in case of errors. Cleanup tasks 
    at the end of the test action chain may not be executed correctly.</p><p>Dirty states inside the database or still running server instances then might cause problems for 
    following test cases. To avoid this problems you should use the finally block of the test case. The &lt;finally&gt; 
    section contains actions that are executed even in case the test fails. Using this strategy the database 
    cleaning tasks mentioned before will find execution in every case (success or failure).</p><p>The following example shows how to use the finally section at the end of a test:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"finallyTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"orderId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"1"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"date"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:currentDate('dd.MM.yyyy')"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sql</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">datasource</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testDataSource"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">statement</span>&gt;
                INSERT INTO ORDERS VALUES (${orderId}, 1, 1, '${date}')
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/statement</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/sql</span>&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                ORDER creation time: ${date}
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">finally</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sql</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">datasource</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testDataSource"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">statement</span>&gt;
              DELETE FROM ORDERS WHERE ORDER_ID='${orderId}'
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/statement</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/sql</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/finally</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>In the example the first action creates an entry in the database using an <code class="literal">INSERT</code> statement. 
    To be sure that the entry in the database is deleted after the test, the finally section contains the respective 
    <code class="literal">DELETE</code> statement that is always executed regardless the test case state (successful or failed).</p></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="xpath"></a>Chapter&nbsp;11.&nbsp;Using XPath</h2></div></div></div><p>Some time ago in this document we have seen how XML elements are manipulated using XPath expressions 
    when sending and receiving messages. Now using XPath might raise some problems regarding namespaces that we
    want to deal with now.</p><p>XPath is a very powerful technology for walking XML trees. This W3C standard stands for advanced
    XML tree handling using a special syntax as query language. The test framework supports this XPath
    syntax in the following fields:</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p>&lt;message&gt;&lt;element path="[XPath-Expression]"&gt;&lt;/message&gt;</p></li><li style="list-style-type: circle"><p>&lt;extract&gt;&lt;message path="[XPath-Expression]"&gt;&lt;/extract&gt;</p></li><li style="list-style-type: circle"><p>&lt;ignore path="[XPath-Expression]"/&gt;</p></li><li style="list-style-type: circle"><p>&lt;validate path="[XPath-Expression]"/&gt;</p></li></ul></div><p>The next program listing indicates the power in using XPath with Citrus:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//User/Name"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"John"</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/validate</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//User/Address[@type='office']/Street"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Companystreet 21"</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/validate</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span> =<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//User/Name"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${userName}"</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/validate</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span> =<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//User/@isAdmin"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${isAdmin}"</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/validate</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span> =<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//*[.='search-for']"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"searched-for"</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/validate</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;</pre><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xpath-namespace"></a>11.1.&nbsp;Handling XML namespaces</h2></div></div></div><p>When it comes to XML namespaces you have to be careful with your XPath expressions. Lets have a look at an example
        message that uses XML namespaces:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns1:RequestMessage</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:ns1</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrus/default"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns1:MessageHeader</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns1:CorrelationId</span>&gt;_&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns1:CorrelationId</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns1:Timestamp</span>&gt;2001-12-17T09:30:47.0Z&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns1:Timestamp</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns1:RequestTag</span>&gt;_&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns1:RequestTag</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns1:VersionId</span>&gt;2&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns1:VersionId</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns1:MessageHeader</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns1:MessageBody</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns1:Customer</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns1:Id</span>&gt;1&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns1:Id</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns1:Customer</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns1:MessageBody</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns1:RequestMessage</span>&gt;</pre><p>Now we would like to validate some elements in this message using XPath</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//RequestMessage/MessageHeader/RequestTag"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${requestTag}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//RequestMessage/MessageHeader/CorrelationId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;</pre><p>The validation will fail although the XPath expression looks correct regarding the XML tree. Because the message 
        uses the namespace <code class="literal">xmlns:ns1="http://citrus/default"</code> with its prefix <code class="literal">ns1</code>
        our XPath expression is not able to find the elements. The correct XPath expression uses the namespace prefix as defined 
        in the message.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//ns1:RequestMessage/ns1:MessageHeader/ns1:RequestTag"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${requestTag}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//ns1:RequestMessage/ns1:MessageHeader/ns1:CorrelationId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;</pre><p>Now the expressions work fine and the validation is successful. But this is quite error prone. This is because the test is now 
        depending on the namespace prefix that is used by some application. As soon as the message is sent with a different namespace prefix (e.g.
        ns2) the validation will fail again.</p><p>You can avoid this effect when specifying your own namespace context and your own namespace prefix during validation.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//pfx:RequestMessage/pfx:MessageHeader/pfx:RequestTag"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${requestTag}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//pfx:RequestMessage/pfx:MessageHeader/pfx:CorrelationId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">namespace</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">prefix</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"pfx"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrus/default"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;</pre><p>Now the test in independent from any namespace prefix in the received message. The namespace context will resolve the namespaces and
        find the elements although the message might use different prefixes. The only thing that matters is that the namespace value 
        (http://citrus/default) matches.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Instead of this namespace context on validation level you can also have a global namespace context which is valid in all test cases.
            We just add a bean in the basic citrus-context configuration which defines global namespace mappings.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"namespaceContextBuilder"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.xml.namespace.NamespaceContextBuilder"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"namespaceMappings"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">props</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">prop</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">key</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"def"</span>&gt;http://www.consol.de/samples/sayHello&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/prop</span>&gt;            
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/props</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>Once defined the <span class="emphasis"><em>def</em></span> namespace prefix is valid in all test cases and all XPath expressions. This enables you to free
            your test cases from namespace prefix bindings that might be broken with time. You can use these global namespace mappings wherever XPath 
            expressions are valid inside a test case (validation, ignore, extract).</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xpath-default-namespaces"></a>11.2.&nbsp;Handling default namespaces</h2></div></div></div><p>In the previous section we have seen that XML namespaces can get tricky with XPath validation. Default namespaces can do 
        even more! So lets look at the example with default namespaces:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">RequestMessage</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrus/default"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">MessageHeader</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">CorrelationId</span>&gt;_&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/CorrelationId</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Timestamp</span>&gt;2001-12-17T09:30:47.0Z&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Timestamp</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">RequestTag</span>&gt;_&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/RequestTag</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">VersionId</span>&gt;2&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/VersionId</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/MessageHeader</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">MessageBody</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Customer</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Id</span>&gt;1&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Id</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Customer</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/MessageBody</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/RequestMessage</span>&gt;</pre><p>The message uses default namespaces. The following approach in XPath will fail due to namespace problems.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//RequestMessage/MessageHeader/RequestTag"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${requestTag}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//RequestMessage/MessageHeader/CorrelationId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;</pre><p>Even default namespaces need to be specified in the XPath expressions. Look at the following code listing that
        works fine with default namespaces:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//:RequestMessage/:MessageHeader/:RequestTag"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${requestTag}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//:RequestMessage/:MessageHeader/:CorrelationId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>It is recommended to use the namespace context as described in the previous chapter when validating. Only this approach
            ensures flexibility and stable test cases regarding namespace changes.</p></td></tr></table></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="jms"></a>Chapter&nbsp;12.&nbsp;Connecting with JMS</h2></div></div></div><p>Citrus provides support for sending and receiving JMS messages. We have to separate between synchronous and asynchronous
    communication. So in this chapter we explain how to setup JMS message senders and receivers for synchronous and asynchronous
    outbound and inbound communication</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Citrus provides a "citrus" configuration namespace and schema definition. Include this namespace into your Spring 
        configuration in order to use the Citrus configuration elements. The namespace URI and schema location are added to the 
        Spring configuration XML file as follows.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">beans</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans"</span>
       <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xsi</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:citrus</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/config"</span>
       <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"
       http://www.springframework.org/schema/beans 
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.citrusframework.org/schema/config 
       http://www.citrusframework.org/schema/config/citrus-config.xsd"</span>&gt;
       
    [...]
    
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/beans</span>&gt;</pre><p>After that you are able to use customized Citrus XML elements in order to define the Spring beans.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jms-sender"></a>12.1.&nbsp;JMS message sender</h2></div></div></div><p>First of all we deal with asynchronous message senders, which means that Citrus is publishing messages to a JMS destination
        (queue or topic). The test case itself does not know about JMS transport details like queue names or connection 
        credentials. This information is stored in the basic Spring configuration. So let us have a look at a simple JMS message sender 
        configuration in Citrus.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"connectionFactory"</span> 
         <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.apache.activemq.ActiveMQConnectionFactory"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"brokerURL"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"tcp://localhost:61616"</span> /&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:jms-message-sender</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"getOrdersRequestSender"</span> 
                           <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Citrus.JMS.Order.Queue.Out"</span>/&gt;</pre><p>The JMS connection factory is responsible for connecting to a JMS message broker. In this example we use the Apache ActiveMQ 
        connection factory implementation as we use a ActiveMQ message broker.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Spring makes it very easy to connect to other JMS broker implementations too (e.g. TIBCO Enterprise Messaging Service, 
            IBM Websphere MQ). Just substitute the implementing class in the connectionFactory bean.</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>All of the JMS senders and receivers that require a reference to a JMS connection factory will automatically look for a bean 
            named "connectionFactory" by default. That is why you don't see a "connection-factory" attribute in many of the examples. 
            However, you can use the "connection-factory" attribute in order to use other connection factory instances with different bean 
            names.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:jms-message-sender</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"getOrdersRequestSender"</span> 
                              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Citrus.JMS.Order.Queue.Out"</span>
                              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">connection-factory</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myConnectionFacotry"</span>/&gt;</pre><p>Alternatively you may want to directly specify a Spring jmsTemplate.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:jms-message-sender</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"getOrdersRequestSender"</span> 
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Citrus.JMS.Order.Queue.Out"</span>
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">jms-template</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myJmsTemplate"</span>/&gt;</pre></td></tr></table></div></div><p>The message sender is now ready for usage inside a test. Many sending actions and test cases reference the message sender. The 
    message sender will simply publish the message to the defined JMS destination. The communication is supposed to be asynchronous, which
    means that the sender will not wait for a synchronous response. The sender fires and forgets the message immediately.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jms-receiver"></a>12.2.&nbsp;JMS message receiver</h2></div></div></div><p>Now lets deal with receiving an async message over JMS. The message receiver definition is located again in the Spring 
        configuration files. We assume that a connection factory has been configured as shown in the previous section.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:jms-message-receiver</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"getOrdersResponseReceiver"</span> 
                                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Citrus.JMS.Order.Queue.In"</span>/&gt;</pre><p> The receiver acts as a message driven listener. This means that the message receiver connects to the given destination 
        and waits for messages to arrive.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Besides the destination-name attribute you can also provide a reference to a Destination implementation.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:jms-message-receiver</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"getOrdersResponseReceiver"</span> 
                                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"orderInboundQueue"</span>/&gt;</pre><p>This destination reference applies to all JMS aware message sender and receiver implementations.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jms-sync-sender"></a>12.3.&nbsp;JMS synchronous message sender</h2></div></div></div><p>When using synchronous message senders Citrus will define a reply-to-queue destination in the message header and wait 
        synchronously for the response on this destination.</p><div class="mediaobject" align="center"><img src="images/figure_006.jpg" align="middle"></div><p>In the Spring XML configuration the synchronous message senders are quite similar to the asynchronous brothers.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:jms-sync-message-sender</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"getCustomerRequestSender"</span> 
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Citrus.JMS.Customer.Queue.Out"</span>
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">reply-handler</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"getCustomerReplyHandler"</span>
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">reply-timeout</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"1000"</span>/&gt;
                            
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:jms-reply-message-handler</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"getCustomerReplyHandler"</span>/&gt;</pre><p>To build synchronous outbound communication we need both a synchronous message sender and a reply handler. Both are defined
        in the Spring configuration. The sender sends the message and waits for the response synchronously. Once the reply has arrived the 
        reply handler is invoked with the respective reply message. The second possibility would be a timeout while receiving the reply.</p><p>See the following figure which tries to explain the handshake between synchronous sender component and synchronous reply handler.
        The synchronous sender receives the reply message and provides it to the reply handler. Once the reply handler has received the reply message 
        it can be handed over to a validator component as usual for extended message validation.</p><div class="mediaobject" align="center"><img src="images/figure_007.jpg" align="middle"></div><p>The respective test case makes use of both synchronous message sender and reply handler in order to complete the synchronous 
        communication steps.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"syncMessagingTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"mySyncMessageSender"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
                    [...]
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myReplyMessageHandler"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
                    [...]
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The message sender creates a temporary JMS reply destination by default in order to receive the reply. The temporary 
            destination name is stored to the JMS replyTo message header. You can also define a static reply destination like follows.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:jms-sync-message-sender</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"getCustomerRequestSender"</span> 
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Citrus.JMS.Customer.Queue.Out"</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">reply-destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Citrus.JMS.Customer.Queue.Reply"</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">reply-handler</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"getCustomerReplyHandler"</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">reply-timeout</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"1000"</span>/&gt;</pre><p>Instead of using the <span class="emphasis"><em>reply-destination-name</em></span> feel free to use the destination reference
            <span class="emphasis"><em>reply-destination</em></span></p></td></tr></table></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>Be aware of permissions that are mandatory for creating temporary destinations. Citrus tries to create temporary queues
          on the JMS message broker. Following from that the Citrus JMS user has to have the permission to do so. 
          Be sure that the user has the sufficient rights when using temporary reply destinations.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jms-sync-receiver"></a>12.4.&nbsp;JMS synchronous message receiver</h2></div></div></div><p>What is missing is the situation that Citrus receives a JMS message where a temporary reply destination is set.
        When dealing with synchronous JMS communication the requestor will store a dynamic JMS queue destination into the JMS 
        header in order to receive the synchronous answer on this dynamic destination. So Citrus has to send the reply to the 
        temporary destination, which is dynamic of course. You can handle this with the synchronous message receiver in combination 
        with a reply sender.</p><div class="mediaobject" align="center"><img src="images/figure_008.jpg" align="middle"></div><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:jms-sync-message-receiver</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"getOrderRequestReceiver"</span> 
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Citrus.JMS.Order.Queue.In"</span>/&gt;
                                     
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:jms-reply-message-sender</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"getOrderReplySender"</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">reply-destination-holder</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"getOrderRequestReceiver"</span>/&gt;</pre><p>In first sight the synchronous message receiver has no difference to a normal receiver, but the difference comes in
        combination with a synchronous reply sender. The reply sender need to know the dynamic reply destination, so it desires a
        reference to a reply-destination-holder, which is our jms-sync-message-receiver.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jms-topics"></a>12.5.&nbsp;JMS Topics</h2></div></div></div><p>Up to now we dealt with JMS queue destinations in this chapter. Citrus is also able to connect to JMS topic destinations.
        In contrary to JMS queues which uses a point-to-point communication JMS topics use publish-subscribe mechanism in order to 
        spread messages over JMS. A JMS topic sender publishes messages to the topic, while the topic accepts multiple message subscriptions and 
        delivers the message to all subscribers.</p><p>The Citrus JMS components (sender/receiver) offer the attribute <span class="emphasis"><em>'pub-sub-domain'</em></span>. Once this attribute
        is set to <span class="emphasis"><em>true</em></span> Citrus will use JMS topics instead of queue destinations. See the following example where the
        publish-subscribe attribute is set to true in JMS message sender and receiver components.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:jms-message-sender</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloTopicRequestSender"</span> 
                             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Citrus.JMS.Topic.Hello.Request"</span>
                             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">pub-sub-domain</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:jms-message-receiver</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloTopicRequestReceiver"</span>
                             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">receive-timeout</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"5000"</span> 
                             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Citrus.JMS.Topic.Hello.Request"</span>
                             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">pub-sub-domain</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>/&gt;</pre><p>When using JMS topics you will be able to subscribe several test actions to the topic destiantion and receive a message
        multiple times as all subscribers will receive the message.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>It is very important to keep in mind that Citrus does not deal with durable subscribers, yet. This means that message that were
            sent in advance to the message subscription are not delivered to the message receiver. So racing conditions may cause problems when using
            JMS topic consumers in Citrus. Be sure to let Citrus subscribe to the topic before messages are sent. Otherwise you may loose some messages
            that were sent in advance to the subscription.</p></td></tr></table></div><p>The <span class="emphasis"><em>'pub-sub-domain'</em></span> attribute is also available for synchronous communication sender and receiver 
        components in Citrus. Just add this attribute in order to switch to JMS topics in a publish-subscribe domain.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jms-headers"></a>12.6.&nbsp;JMS message headers</h2></div></div></div><p>The JMS specification defines a set of special message header entries that can go into your JMS message. These JMS headers are stored differently in a JMS message
        header than other custom header entries do. Therefore these special header values should be set in a special syntax that we discuss in the next paragraphs.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jms_correlationId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jms_messageId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${messageId}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jms_redelivered"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${redelivered}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jms_timestamp"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${timestamp}"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;</pre><p>As you see all JMS specific message headers use the <span class="emphasis"><em>jms_</em></span> prefix. This prefix comes from Spring Integration message header mappers that 
        take care of setting those headers in the JMS message header properly.</p><p>Typing of message header entries may also be of interest in order to meet the JMS standards of typed message headers. For instance the following message header 
        is of type double and is therefore transfered via JMS as a double value.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"amount"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"19.75"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"double"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;</pre></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="http"></a>Chapter&nbsp;13.&nbsp;Http support</h2></div></div></div><p>Citrus is able to connect with Http services and simulate RESTful WebServices servers. In the next sections you will learn
    how to invoke Http services and how to handle REST Http requests in a test case. We deal with setting up a Http server in order to
    accept client requests and provide proper Http responses with GET, PUT, DELETE or POST request method.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Similar to the JMS specific configuration schema, Citrus provides a customized Http configuration schema that
        is used in Spring configuration files. Simply include the http-config namespace in the configuration XML files as follows.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">beans</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans"</span>
   <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xsi</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
   <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:citrus</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/config"</span>
   <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:citrus-http</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/http/config"</span>
   <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"
   http://www.springframework.org/schema/beans 
   http://www.springframework.org/schema/beans/spring-beans.xsd
   http://www.citrusframework.org/schema/config 
   http://www.citrusframework.org/schema/config/citrus-config.xsd
   http://www.citrusframework.org/schema/http/config 
   http://www.citrusframework.org/schema/http/config/citrus-http-config.xsd"</span>&gt;
       
    [...]
    
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/beans</span>&gt;</pre><p>Now you are ready to use the customized Http configuration elements with the 
        citrus-http namespace prefix.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="http-sender"></a>13.1.&nbsp;Http message sender</h2></div></div></div><p>Citrus is able to invoke a Http service as client waiting for the response message from server. After that the response message goes 
        through the validation process as usual. Let us see how a message sender for Http works:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-http:message-sender</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpMessageSender"</span> 
                               <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">request-url</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://localhost:8090/test"</span> 
                               <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">request-method</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"POST"</span>
                               <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">content-type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"application/xml"</span>
                               <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">reply-handler</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpResponseHandler"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-http:reply-message-handler</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpResponseHandler"</span>/&gt;</pre><p>As Http communication is always synchronous we need a reply message handler in combination with the Http message-sender. It is not
        very surprising that the sender also needs the <span class="emphasis"><em>request-url</em></span> and a <span class="emphasis"><em>request-method</em></span> as parameter. In addition
        to that we can specify the content-type of the request we are about to send. The message sender builds the Http request and sends it to the Http server. 
        The Http response is then provided to the reply handler as soon as it has arrived.</p><p>The request method is statically set to <span class="emphasis"><em>POST</em></span> in the example above. You can also set/overwrite the Http request method inside the 
        sending test action which gives more flexibility. Use something like this in your test:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpMessageSender"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;testRequestMessage&gt;</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;text&gt;Hello</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">HttpServer&lt;/text&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/testRequestMessage&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">]]&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/data&gt;</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/message&gt;</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;header&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_http_method"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"PUT"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Citrus uses Spring's REST template mechanism for sending Http requests. This means you have great customizing opportunities with a special REST 
        template configuration. You can think of basic Http authentication, read timeouts and special message factory implementations. Just use the custom REST template
        attribute in message sender like this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-http:message-sender</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpMessageSender"</span> 
                               <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">request-url</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://localhost:8090/test"</span> 
                               <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">request-method</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"POST"</span>
                               <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">content-type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"text/plain"</span>
                               <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">rest-template</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"customizedRestTemplate"</span>
                               <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">reply-handler</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpResponseHandler"</span>/&gt;
                               
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">!-- Customized rest template --</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"customizedRestTemplate"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.web.client.RestTemplate"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"messageConverters"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">util:list</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"converter"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.http.converter.StringHttpMessageConverter"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"supportedMediaTypes"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">util:list</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"types"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;text/plain&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/util:list</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/util:list</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"errorHandler"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">!-- Custom error handler --</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"requestFactory"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.http.client.HttpComponentsClientHttpRequestFactory"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"readTimeout"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"9000"</span> /&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
        </pre></td></tr></table></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>And another tip for you regarding dynamic endpoint URI in Http message sender. Similar to the endpoint resolving mechanism in SOAP sending action you can dynamically set
        the called endpoint URI on Http message sender. By default Citrus will check a specific header entry for dynamic endpoint URI which is simply defined for each message sending action
        inside the test. See the next short example and you will see that it is very simple.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_endpoint_uri"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://localhost:8080/customers/${customerId}"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;</pre><p>The specific send action above will send its message to the dynamic endpoint (http://localhost:8080/customers/${customerId}) which is set in the header <span class="emphasis"><em>citrus_endpoint_uri</em></span>. 
        As you can see the endpoint contains a variable entry so you can reuse the same Http message sender with different endpoint URI. This is essential when calling RESTful WebServices where the 
        URI contains parameters, identifiers and modifiers.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="http-server"></a>13.2.&nbsp;Http server</h2></div></div></div><p>Sending Http messages was quite easy and straight forward. Receiving Http messages is a little bit more complicated, because Citrus 
        has to provide server functionality listening on a local port for client connections. Once a client connection 
        is accepted the Http server must also provide a proper Http response to the client. Citrus ships with an embedded Http server, which is a preconfigured Jetty  
        server instance with Spring web application context support.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-http:server</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"simpleHttpServer"</span> 
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">port</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"8090"</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">auto-start</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">context-config-location</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:com/consol/citrus/http/citrus-servlet-context.xml"</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">resource-base</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"src/citrus/resources"</span>/&gt;
        </pre><p>The Http Jetty server will automatically start when the Spring application context is loaded (auto-start="true"). The basic connector is listening on
        port 8090 for requests. The server automatically uses Spring application context loading on startup. The servlet context file is specified via classpath and hold all custom
        configurations for the server. Here is a sample servlet context with some basic Spring MVC components and the central HttpMessageController which is responsible for handling
        incoming requests (GET, PUT, DELETE, POST, etc.).</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping"</span>/&gt;
  
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"messageConverters"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">util:list</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"converters"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.http.converter.StringHttpMessageConverter"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"supportedMediaTypes"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">util:list</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;text/xml&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/util:list</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/util:list</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
      
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.http.controller.HttpMessageController"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"messageHandler"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"emptyResponseProducingMessageHandler"</span> 
       <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.adapter.handler.EmptyResponseProducingMessageHandler"</span>/&gt;        
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>The beans above are responsible for proper Http server configuration. In general you do not need to adjust those beans, but we have the possibility to do so which gives 
        us a great customization and extension points. The important part is the message handler definition inside the HttpMessageController. Once a client request was accepted the 
        message handler is responsible for generating a proper response to the client.</p><div class="mediaobject" align="center"><img src="images/figure_009.jpg" align="middle"></div><p>Citrus provides several message handler implementations for different simulation strategies. With these message handler implementations you should be able to generate
        proper response messages for the client in a test case. Let's have a look at them in the following sections.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="http-message-handler-empty"></a>13.2.1.&nbsp;Empty response producing message handler</h3></div></div></div><p>This is the simplest message handler you can think of. It simply provides an empty success response using the Http
            response code 202. In the introducing example this message handler was used to provide response messages to the calling client.
            The handler does not need any configurations or properties as it simply responds with an empty Http response.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"emptyResponseProducingMessageHandler"</span> 
  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.adapter.handler.EmptyResponseProducingMessageHandler"</span>/&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="http-message-handler-static"></a>13.2.2.&nbsp;Static response producing message handler</h3></div></div></div><p>The next more complex message handler will always return a static response message</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> 
  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.adapter.handler.StaticResponseProducingMessageHandler"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"messagePayload"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;ns0:Response</span> 
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:ns0</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/samples/sample.xsd"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:MessageId</span>&gt;123456789&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:MessageId</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:CorrelationId</span>&gt;CORR123456789&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:CorrelationId</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:Text</span>&gt;Hello User&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:Text</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:Response</span>&gt;
        ]]&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"messageHeader"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">map</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">entry</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">key</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"{http://www.consol.de/schemas/samples}ns0:Operation"</span> 
                  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sayHelloResponse"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">entry</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">key</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"{http://www.consol.de/schemas/samples}ns0:Request"</span> 
                  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"HelloRequest"</span>/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/map</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>The handler is configured with a static message payload and static response header values. The response to the client
            is therefore always identical.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="http-message-handler-xpath"></a>13.2.3.&nbsp;Xpath dispatching message handler</h3></div></div></div><p>The idea behind the xpath-dispatching-message-handler is that the incoming requests are dispatched to several
            message handlers depending on the existence of a specific node inside the message payload. The XPath expression will evaluate to
            the parent of the deciding node and call the respective message handler. The message handler mapping is done by mapping the deciding node name to
            a bean name in a message handler Spring configuration context. The separate context is loaded in advance. Let's see an example.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"xpathDispatchingHandler"</span> 
  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.adapter.handler.XpathDispatchingMessageHandler"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"xpathMappingExpression"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//MessageBody/Operation/*"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"messageHandlerContext"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"message-handler-context.xml"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>The handler receives a XPath mapping expression as well as a Spring ApplicationContext file resource. The message handlers in this
            ApplicationContext are mapped to the different values via their names. For instance an incoming request with 
            <code class="literal">//MessageBody/Operation/GetOrders</code> would be handled by the message handler named "GetOrders". The available message handlers
            are configured in the separate message-handler-context (e.g. EmptyResponseProducingMessageHandler, StaticResponseProducingMessageHandler, ...). Here is an example.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"GetOrders"</span>
  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.adapter.handler.StaticResponseProducingMessageHandler"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"messagePayload"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Your orders"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"SaveOrder"</span>
  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.adapter.handler.StaticResponseProducingMessageHandler"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"messagePayload"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Order saved"</span>/&gt;    
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">It is possible to ommit the xpath expression in the xpath dispatching message handler bean definition. If no xpath is provided, Citrus will take the first element node in the request into account.</td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="http-message-handler-jms"></a>13.2.4.&nbsp;JMS connecting message handler</h3></div></div></div><p>The most powerful message handler is the JMS connecting message handler. Indeed this handler also provides the most 
            flexibility. This handler will forward incoming request to a JMS destination and waiting for a proper response on a reply destination. 
            A configured JMS message receiver can read this forwarded request internally over JMS and provide a proper response on the 
            reply destination.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jmsForwardingMessageHandler"</span> 
         <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.adapter.handler.JmsConnectingMessageHandler"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"destinationName"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"JMS.Queue.Requests.In"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"replyDestinationName"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"JMS.Queue.Response.Out"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"connectionFactory"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.apache.activemq.ActiveMQConnectionFactory"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"brokerURL"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"tcp://localhost:61616"</span> /&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"replyTimeout"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"2000"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>The samples section may help you get in touch with the http configuration and the JMS forwarding strategy 
                (<a href="#samples" title="Appendix&nbsp;A.&nbsp;Citrus Samples">Appendix&nbsp;A, <i xmlns:xlink="http://www.w3.org/1999/xlink">Citrus Samples</i></a>)</p></td></tr></table></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="http-headers"></a>13.3.&nbsp;Http headers</h2></div></div></div><p>When dealing with Http request/response communication we always deal with Http specific headers. The Http protocol defines a group of header attributes that both client 
        and server need to handle. You can set and validate these Http headers in Citrus quite easy. Let us have a look at a client operation in Citrus where some Http headers are 
        explicitly set before the request is sent.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpMessageSender"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;testRequestMessage&gt;</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;text&gt;Hello</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">HttpServer&lt;/text&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/testRequestMessage&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">]]&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/data&gt;</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/message&gt;</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;header&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"CustomHeaderId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${custom_header_id}"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Content-Type"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"text/xml"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Accept"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"text/xml,*/*"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;</pre><p>We are able to set custom headers (<span class="emphasis"><em>CustomHeaderId</em></span>) that go directly into the Http header section of the request. In addition to that testers can explicitly set Http reserved headers
        such as <span class="emphasis"><em>Content-Type</em></span>. Fortunately you do not have to set all headers on your own. Citrus will automatically set the required Http headers for the request. So we have the following Http request
        which is sent to the server:</p><pre class="programlisting">POST /test HTTP/1.1
Accept: text/xml, */*
Content-Type: text/xml
CustomHeaderId: 123456789
Accept-Charset: macroman
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8091
Content-Length: 175
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testRequestMessage</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">text</span>&gt;Hello HttpServer&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/text</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testRequestMessage</span>&gt;</pre><p>On server side testers are interested in validating the Http headers. Within Citrus receive action you simply define the expected header entries. The Http specific headers are automatically available for validation
        as you can see in this example:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpRequestReceiver"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;testRequestMessage&gt;</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;text&gt;Hello</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">HttpServer&lt;/text&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/testRequestMessage&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">]]&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/data&gt;</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/message&gt;</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;header&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"CustomHeaderId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${custom_header_id}"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Content-Type"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"text/xml"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Accept"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"text/xml,*/*"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>The test checks on custom headers and Http specific headers to meet the expected values.</p><p>Now that we have accepted the client request and validated the contents we are able to send back a proper Http response message. Same thing here with Http specific headers. The Http protcol defines several headers marking the success or failure of
        the server operation. In the test case you can set those headers for the response message with convention header names. See the following example to find out how that works for you.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpResponseSender"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;testResponseMessage&gt;</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;text&gt;Hello</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">Citrus</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">Client&lt;/text&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/testResponseMessage&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">]]&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/data&gt;</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/message&gt;</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;header&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"CustomHeaderId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${custom_header_id}"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Content-Type"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"text/xml"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_http_status_code"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"200"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_http_reason_phrase"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"OK"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;</pre><p>Once more we set the custom header entry (<span class="emphasis"><em>CustomHeaderId</em></span>) and a Http reserved header (<span class="emphasis"><em>Content-Type</em></span>) for the response message. On top of this we are able to set the response status for
        the Http response. We use the reserved header names <span class="emphasis"><em>citrus_http_status_code</em></span> in order to mark the success of the server operation. With this mechanism we can easily simulate different server behaviour such as Http 
        error response codes (e.g. 404 - Not found, 500 - Internal error). Let us have a closer look at the generated response message:</p><pre class="programlisting">HTTP/1.1 200 OK
Content-Type: text/xml;charset=UTF-8
Accept-Charset: macroman
Content-Length: 205
Server: Jetty(7.0.0.pre5)
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testResponseMessage</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">text</span>&gt;Hello Citrus Client&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/text</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testResponseMessage</span>&gt;</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>You do not have to set the reason phrase all the time. It is sufficient to only set the Http status code. Citrus will automatically add the proper reason phrase for well known Http status codes.</p></td></tr></table></div><p>The only thing that is missing right now is the validation of Http status codes when receiving the server response in a Citrus test case. It is very easy as you can use the Citrus reserved header names for validation, too.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpResponseReceiver"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;testResponseMessage&gt;</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;text&gt;Hello</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">Test</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">Framework&lt;/text&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/testResponseMessage&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">]]&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/data&gt;</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/message&gt;</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;header&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"CustomHeaderId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${custom_header_id}"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_http_status_code"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"200"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_http_version"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"HTTP/1.1"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_http_reason_phrase"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"OK"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>Up to now we have used some of the basic Citrus reserved Http header names (citrus_http_status_code, citrus_http_version, citrus_http_reason_phrase). In Http RESTful WebServices some more header names are essential ofr
        validation. These are request attributes like query parameters, context path and request URI. The Citrus server side REST message controller will automatically add all this information to the message header for you. So
        all you need to do is validate the header entries in your test.</p><p>The next example receives a Http GET method request on server side. Here the GET request does not have any message payload, so the validation just works on the information given in the message header. We assume
        the client to call <span class="emphasis"><em>http://localhost:8080/app/users?id=123456789</em></span>. As a tester we need to validate the request method, request URI, context path and the query parameters.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpRequestReceiver"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Host"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"localhost:8080"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Content-Type"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"text/html"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Accept"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"text/xml,*/*"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_http_method"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"GET"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_http_request_uri"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"/app/users"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_http_context_path"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"/app"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_http_query_params"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"id=123456789"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Be aware of the slight differences in request URI and context path. The context path gives you the web application context path within the servlet container for your web application. 
        The request URI always gives you the complete path that was called for this request.</p></td></tr></table></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>Another important thing to notice is the usage of multiple query parameters that are put together using '&amp;' characters (e.g. http://localhost:8080/app/users?id=123456789&amp;name=foo). As the Citrus test case
        is written in XML we have to escape the reserved '&amp;' with &amp;amp; entity (e.g. value="id=123456789&amp;amp;name=test").</p></td></tr></table></div><p>As you can see we are able to validate all parts of the initial request endpoint URI the client was calling. This completes the Http header processing within Citrus. 
        On both client and server side Citrus is able to set and validate Http specific header entries which is essential for simulating Http communication.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="http-error-handling"></a>13.4.&nbsp;Http error handling</h2></div></div></div><p>So far we have received response messages with Http status code <span class="emphasis"><em>200 OK</em></span>. How to deal with server errors like <span class="emphasis"><em>404 Not Found</em></span> or <span class="emphasis"><em>500 Internal server error</em></span>? The default Http message client
        error strategy is to propagate server error response messages to the reply message handler for validation. We simply check on Http status code and status text for error validation.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpMessageSender"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;testRequestMessage&gt;</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;text&gt;Hello</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">HttpServer&lt;/text&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/testRequestMessage&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">]]&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/data&gt;</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/message&gt;</span>
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/send&gt;</span>
        
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpResponseReceiver"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[]]</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_http_status_code"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"403"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_http_reason_phrase"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"FORBIDDEN"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>The message data can be empty depending on the server logic for these error situations. If we receive additional error information as message payload just add validation assertions as usual.</p><p>Instead of receiving such empty messages with checks on Http status header information we can change the error strategy in the message sender component in order to automatically raise exceptions 
        on response messages other than <span class="emphasis"><em>200 OK</em></span>. Therefore we go back to the Http message sender configuration for changing the error strategy.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-http:message-sender</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpMessageSender"</span>
                              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">request-url</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://localhost:8080/test"</span>
                              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">reply-handler</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpResponseReceiver"</span>
                              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">error-strategy</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"throwsException"</span>/&gt;
  
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-http:reply-message-handler</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpResponseReceiver"</span>/&gt;</pre><p>Now we expect an exception to be thrown because of the error response. Following from that we have to change our test case. 
        Instead of receiving the error message with receive action we assert the client exception and check on the Http status code and status text.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">assert</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">exception</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.web.client.HttpClientErrorException"</span> 
           <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"403 Forbidden"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpMessageSender"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;testRequestMessage&gt;</span>
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;text&gt;Hello</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">HttpServer&lt;/text&gt;</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/testRequestMessage&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">]]&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/data&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/message&gt;</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/send&gt;</span>
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/assert&gt;</span></pre><p>Both ways of handling Http error messages on client side are valid for expecting the server to raise Http error codes. Choose the prefered way according to your test project requirements.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="htp-basic-auth"></a>13.5.&nbsp;Basic authentication</h2></div></div></div><p>As client you may have to use basic authentication in order to access a resource on the server. In most cases this will be username/password authentication 
        where the credentials are transmtted in the request header section as base64 encoding. As Citrus uses Spring's REST support with the RestTemplate and ClientHttpRequestFactory the
        basic authentication is already covered. You simply have to set the user credentials on the HttpClient which is used inside the RestTemplate.</p><p>Citrus gives a even more comfortable way to configure the basic authentication credentials on the RestTemplate's ClientHttpRequestFactory. Just see the following
        example and learn how to do that.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-http:message-sender</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testHttpMessageSender"</span>
                              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">request-method</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"POST"</span>
                              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">request-url</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://localhost:8080/test"</span>
                              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">reply-handler</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testHttpReplyMessageHandler"</span>
                              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">request-factory</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"basicAuthFactory"</span>/&gt;
  
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-http:reply-message-handler</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testHttpReplyMessageHandler"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"basicAuthFactory"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.http.client.BasicAuthClientHttpRequestFactory"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"authScope"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.apache.http.auth.AuthScope"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor-arg</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"localhost"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor-arg</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"8072"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor-arg</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">""</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor-arg</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"basic"</span>/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"credentials"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.apache.http.auth.UsernamePasswordCredentials"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor-arg</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"someUsername"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor-arg</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"somePassword"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;      
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;  
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>Since Citrus has upgraded to Spring 3.1.x the Jakarta commons Http client is deprecated with Citrus version 1.2. The formerly used 
        UserCredentialsClientHttpRequestFactory is therefore also deprecated and will not continue with next versions. Please update your configuration if you are coming from 
        Citrus 1.1 or earlier versions.</p></td></tr></table></div><p>The above configuration results in Http client requests with authentication headers properly set for basic authentication. The client request factory takes care on adding the proper
        basic authentication header to each request that is sent with this Citrus message sender. Citrus uses preemtive authentication. The message sender only sends a single request to the server with
        all authentication information set in the message header. The request which determines the authentication scheme on the server is skipped. This is why you have to add some auth scope in the client 
        request factory so Citrus can setup an authentication cache within the Http context in order to have preemtive authentication.</p><p>See the following example request that is created by the Citrus message sender and have a look
        at the <span class="emphasis"><em>Authorization</em></span> header which gets automatically set for all requsts.</p><pre class="programlisting">POST /test HTTP/1.1
Accept: text/xml, */*
Content-Type: text/xml
Accept-Charset: iso-8859-1, us-ascii, utf-8
Authorization: Basic c29tZVVzZXJuYW1lOnNvbWVQYXNzd29yZA==
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8080
Content-Length: 175
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testRequestMessage</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">text</span>&gt;Hello HttpServer&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/text</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testRequestMessage</span>&gt;</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Of course you can also set the <span class="emphasis"><em>Authorization</em></span> header on your own for each request in your send action definition. 
        Be aware of using the correct basic authentication header syntax with base64 encoding for the username:password phrase.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Authorization"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Basic c29tZVVzZXJuYW1lOnNvbWVQYXNzd29yZA=="</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;</pre></td></tr></table></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="soap-webservices"></a>Chapter&nbsp;14.&nbsp;SOAP WebServices</h2></div></div></div><p>In case you need to connect to a SOAP WebService you can use the built-in WebServices support in Citrus. Similar
    to the Http support Citrus is able to send and receive SOAP messages during a test.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>In order to use the SOAP WebService support you need to include the specific XML configuration schema provided by Citrus.
        See following XML definition to find out how to include the citrus-ws namespace.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">beans</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans"</span>
       <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xsi</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:citrus</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/config"</span>
       <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:citrus-ws</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/ws/config"</span>
       <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"
       http://www.springframework.org/schema/beans 
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.citrusframework.org/schema/config 
       http://www.citrusframework.org/schema/config/citrus-config.xsd
       http://www.citrusframework.org/schema/ws/config 
       http://www.citrusframework.org/schema/ws/config/citrus-ws-config.xsd"</span>&gt;
       
    [...]
    
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/beans</span>&gt;</pre><p>Now you are ready to use the customized WebService configuration elements - all using the citrus-ws prefix - 
        in your Spring configuration.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="soap-sender"></a>14.1.&nbsp;SOAP message sender</h2></div></div></div><p>Citrus can call any SOAP WebService and validate its response message. Let us see how a message sender for SOAP 
        WebServices looks like in the Spring configuration:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-ws:message-sender</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapMessageSender"</span> 
                               <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">request-url</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://localhost:8090/test"</span> 
                               <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">reply-handler</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapResponseHandler"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-ws:reply-message-handler</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapResponseHandler"</span>/&gt;</pre><p>SOAP WebServices always use synchronous communication, so we need a reply message handler. The message sender 
        uses the <span class="emphasis"><em>request-url</em></span> and and calls the WebService. The sender
        will automatically build a SOAP request message including a SOAP header and the message payload as SOAP body. 
        As the WebService response arrives it is passed to the given reply handler.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>The SOAP WebService message sender uses a SoapMessageFactory implementation in order to create the SOAP messages. 
            Just add a bean to the Citrus Spring application context. Spring offers several reference implementations, choose on of them.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"messageFactory"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.ws.soap.saaj.SaajSoapMessageFactory"</span>/&gt;</pre><p>By default Citrus will search for a bean with id <span class="emphasis"><em>'messageFactory'</em></span>. In case you intend to use different identifiers 
            you need to tell the SOAP message sender which message factory to use:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-ws:message-sender</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapMessageSender"</span> 
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">request-url</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://localhost:8090/test"</span> 
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">reply-handler</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapResponseHandler"</span>
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message-factory</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"mySepcialMessageFactory"</span>/&gt;</pre></td></tr></table></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Up to now we have used a static endpoint request url for the SOAP message sender. Besides that we can use dynamic endpoint uri in
            configuration. We just use an endpoint resolver bean instead of the static request url like this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-ws:message-sender</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapMessageSender"</span> 
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint-resolver</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"dynamicEndpointResolver"</span> 
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">reply-handler</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapResponseHandler"</span>
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message-factory</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"mySepcialMessageFactory"</span>/&gt;
             
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"dynamicEndpointResolver"</span> 
       <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.adapter.common.endpoint.MessageHeaderEndpointUriResolver"</span>/&gt;</pre><p>The <span class="emphasis"><em>dynamicEndpointResolver</em></span> bean must implement the EndpointUriResolver interface in order to resolve
             dynamic endpoint uri values. Citrus offers a default implementation, the <span class="emphasis"><em>MessageHeaderEndpointUriResolver</em></span>, which
             uses a specific message header for setting dynamic endpoint uri. The message header needs to specify the header 
             <span class="emphasis"><em>citrus_endpoint_uri</em></span> with a valid request uri.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_endpoint_uri"</span> 
           <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://localhost:${port}/${context}"</span> /&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;</pre></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="soap-receiver"></a>14.2.&nbsp;SOAP message receiver</h2></div></div></div><p>Receiving SOAP messages requires a web server instance listening on a port. Citrus is using an embedded Jetty 
        server instance in combination with the Spring WebService project in order to accept SOAP request calls. See how the 
        Jetty server is configured in the Spring configuration.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-ws:jetty-server</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"simpleJettyServer"</span> 
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">port</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"8091"</span> 
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">auto-start</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">context-config-location</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:citrus-ws-servlet.xml"</span>
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">resource-base</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"src/citrus/resources"</span>/&gt;</pre><p>The Jetty server is able to start automatically during application startup. In the example above the server is
        listening for requests on port <code class="literal">8091</code>. This is the standard connector configuration for the Jetty server.
        For detailed customization the Citrus Jetty server configuration also supports explicit connector configurations 
        (@connector and @connectors attributes). For more information please see the Jetty Connector implementations.</p><p>Now let us have a closer look at the context-config-location attribute. This configuration defines the Spring
        application context file for endpoints, request mappings and other SpringWS specific information. Please see the 
        official SpringWS documentation for details on this Spring based configuration. You can also just copy the following 
        example application context which should work for you in general.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">beans</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans"</span> 
       <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xsi</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"
       http://www.springframework.org/schema/beans 
       http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;
    
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"loggingInterceptor"</span> 
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.ws.server.endpoint.interceptor.PayloadLoggingInterceptor"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">description</span>&gt;
          This interceptor logs the message payload.
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/description</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
    
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloServicePayloadMapping"</span> 
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.ws.server.endpoint.mapping.PayloadRootQNameEndpointMapping"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"mappings"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">props</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">prop</span> 
                  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">key</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"{http://www.consol.de/schemas/sayHello}HelloStandaloneRequest"</span>&gt;
                  helloServiceEndpoint
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/prop</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/props</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"interceptors"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">list</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ref</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">bean</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"loggingInterceptor"</span>/&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/list</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
    
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloServiceEndpoint"</span> 
       <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.ws.WebServiceEndpoint"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"messageHandler"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.adapter.handler.StaticResponseProducingMessageHandler"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"messagePayload"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;ns0:HelloStandaloneResponse</span> 
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:ns0</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/sayHello"</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:MessageId</span>&gt;123456789&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:MessageId</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:CorrelationId</span>&gt;CORR123456789&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:CorrelationId</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:User</span>&gt;WebServer&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:User</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:Text</span>&gt;Hello User&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:Text</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:HelloStandaloneResponse</span>&gt;
                ]]&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"messageHeader"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">map</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">entry</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">key</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"{http://www.consol.de/schemas/sayHello}ns0:Operation"</span> 
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sayHelloResponse"</span>/&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">entry</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">key</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"{http://www.consol.de/schemas/sayHello}ns0:Request"</span> 
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"HelloRequest"</span>/&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">entry</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">key</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_soap_action"</span> 
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sayHello"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/map</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/beans</span>&gt;</pre><p>The program listing above describes a normal SpringWS request mapping with endpoint configurations. The mapping is responsible to forward 
        incoming requests to the endpoint which will handle the request and provide a proper response message. First of all Spring's logging interceptor 
        is added to the context. Then we use a payload mapping (PayloadRootQNameEndpointMapping) in order to map all incoming <code class="literal">'HelloStandaloneRequest'</code> 
        SOAP messages to the <code class="literal">'helloServiceEndpoint'</code>. Endpoints are of essential nature in Citrus SOAP WebServices implementation.
        They are responsible for processing a request in order to provide a proper response message that is sent back to the calling client. 
        Citrus uses the endpoint in combination with a message handler implementation.</p><div class="mediaobject" align="center"><img src="images/figure_010.jpg" align="middle"></div><p>The enpoint works together with a message handler that is responsible for providing a response message for the client. The various 
        message handler implementations in Citrus were already discussed in <a href="#http" title="Chapter&nbsp;13.&nbsp;Http support">Chapter&nbsp;13, <i xmlns:xlink="http://www.w3.org/1999/xlink">Http support</i></a>.</p><p>In this example the <code class="literal">'helloServiceEndpoint'</code> uses the <code class="literal">'StaticResponseProducingMessageHandler'</code>
        which is always returning a static response message. In most cases static responses will not fit the test scenario and you will have to
        respond more dynamically. Following from that forwarding to a JMS message destination might fit your needs for more powerful response
        generation out of a test case. The setup looks like this:</p><div class="mediaobject" align="center"><img src="images/figure_011.jpg" align="middle"></div><p>Regardless of which message handler setup you are using in your test case the endpoint transforms the response into a proper SOAP 
        message. You can add as many request mappings and endpoints as you want to the server context configuration. So you are able to handle 
        different request types with one single Jetty server instance.</p><p>Have a look at the <a href="#http" title="Chapter&nbsp;13.&nbsp;Http support">Chapter&nbsp;13, <i xmlns:xlink="http://www.w3.org/1999/xlink">Http support</i></a> in order to find out how the other available message handler work.</p><p>That's it for connecting with SOAP WebServices! We saw how to send and receive SOAP messages with Jetty and 
        Spring WebServices. Have a look at the samples coming with your Citrus archive in order to learn more about the SOAP message handlers.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="soap-header"></a>14.3.&nbsp;SOAP headers</h2></div></div></div><p>SOAP defines several header variations that we discuss in the following sections. First of all we deal with the special 
        <span class="emphasis"><em>SOAP action</em></span> header. In case we need to set this SOAP action header we simply need to use 
        the special header key called <code class="literal">citrus_soap_action</code> in our test. This is because in general the sending test action in Citrus 
        is generic for all transport types, but the SOAP action header is specific for the SOAP transport. The special header key in combination with a 
        underlying WebService message sender constructs the SOAP action in the SOAP message as intended.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_soap_action"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sayHello"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;</pre><p>Secondly a SOAP message is able to contain customized SOAP headers. These are key-value pairs where the key is a 
        qualified name (QName) and the value a normal String value.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"{http://www.consol.de/sayHello}ns0:Operation"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sayHello"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"{http://www.consol.de/sayHello}ns0:Request"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"HelloRequest"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;</pre><p>Last not least a SOAP header can contain whole XML fragment values. The next example shows how to set these XML
        framgents as SOAP header:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt; 
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;ns0:User</span> 
              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:ns0</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/sayHello"</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:UserId</span>&gt;123456789&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:UserId</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:Handshake</span>&gt;S123456789&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:Handshake</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:User</span>&gt;
      ]]&gt;          
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;</pre><p>You can also use external file resources to set this SOAP header XML fragment as shown in this last example code:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">resource</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:request-soap-header.xml"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;</pre><p>This completes the SOAP header possibilities for sending SOAP messages with Citrus. Of course you can also use these variants in SOAP
        message header validation. You define expected SOAP headers, SOAP action and XML fragments and Citrus will match incoming request to that. Just
        use <span class="emphasis"><em>citrus_soap_action</em></span> header key in your receiving message action and you validate this SOAP header accordingly.</p><p>When validating SOAP header XML fragments you need to define the whole XML header fragment as expected header data like this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapMessageHandler"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;c:ResponseMessage</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:c</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrusframework.org/schema"</span>&gt;
                  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">c:resultCode</span>&gt;OK&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/c:resultCode</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/c:ResponseMessage</span>&gt;
        ]]&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;SOAP-ENV:Header</span> 
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:SOAP-ENV</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://schemas.xmlsoap.org/soap/envelope/"</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">c:customHeader</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:c</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrusframework.org/headerschema"</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">c:correlationId</span>&gt;${correlationId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/c:correlationId</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">c:applicationId</span>&gt;${applicationId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/c:applicationId</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">c:trackingId</span>&gt;${trackingId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/c:trackingId</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">c:serviceId</span>&gt;${serviceId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/c:serviceId</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">c:interfaceVersion</span>&gt;1.0&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/c:interfaceVersion</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">c:timestamp</span>&gt;@ignore@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/c:timestamp</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/c:customHeader</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SOAP-ENV:Header</span>&gt;
            ]]&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_soap_action"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"doResponse"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>As you see the SOAP XML header validation can combine header element and XML fragement validation. This is also likely
        to be used when dealing with WS-Security message headers.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="soap-mime-headers"></a>14.4.&nbsp;Http mime headers</h2></div></div></div><p>Besides the SOAP specific header elements the Http mime headers (e.g. Content-Type, Content-Length, Authorization) might be candidates for validation, too. 
      When using Http as transport layer the SOAP message may define those mime headers. The tester is able to send and validate these headers inside the test case, although these 
      Http headers are located outside of the SOAP envelope. Let us first of all speak about validating the Http mime headers. This feature is not enabled by default. We 
      have to set a special flag in our SOAP WebService endpoint.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"webServiceEndpoint"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.ws.WebServiceEndpoint"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"handleMimeHeaders"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>/&gt;
    [...]
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>With this configuration Citrus will handle all available mime headers passing those to the test case for normal header validation.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"webServiceRequestReceiver"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;ns0:SoapMessageRequest</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:ns0</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/sample.xsd"</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:Operation</span>&gt;Validate mime headers&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:Operation</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:SoapMessageRequest</span>&gt;
            ]]&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Content-Type"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"text/xml; charset=utf-8"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:receive</span>&gt;
      </pre><p>As you can see the validation is quite simple as soon as we have enabled the mime header handling in the WebService endpoint. The transport (http) headers go into the header
      list just like the normal SOAP header elements do. So you can validate the headers as usual.</p><p>So much for receiving and validating Http messsage headers with SOAP communication. Now we want to send special mime headers on client side. We overwrite or add mime 
      headers to our sending action. We mark some headers with following prefix <code class="literal">"citrus_http_"</code>. This tells the SOAP message sender to add these headers to the 
      Http header section outside the SOAP envelope. Keep in mind that header elements without this prefix go right into the SOAP header section by default.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"webServiceRequestSender"</span>&gt;
  [...]
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_http_operation"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"foo"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
  [...]
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:send</span>&gt;</pre><p>The listing above defines a Http mime header <span class="emphasis"><em>operation</em></span>. The header prefix <code class="literal">citrus_http_</code> is cut off before the header goes into the Http 
      header section. With this feature we can decide where exactly our header information is located in our resulting client message.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="soap-faults"></a>14.5.&nbsp;SOAP faults</h2></div></div></div><p>SOAP faults describe a failed communication in SOAP WebServices world. Citrus is able to send and receive SOAP fault messages. On server side 
        Citrus can simulate SOAP faults with fault-code, fault-reason-string and fault-detail. On client side Citrus is able to handle and validate SOAP faults 
        in response messages. The next section describes how to deal with SOAP faults in Citrus.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="soap-fault-simulation"></a>14.5.1.&nbsp;SOAP fault simulation</h3></div></div></div><p>As Citrus simulates WebService endpoints you also need to think about simulating SOAP faults. In case Citrus receives a SOAP 
            request you can respond with a proper SOAP fault if necessary.</p><p>Please keep in mind that we use the citrus-ws extension for sending SOAP faults in our test case, as shown in this very 
            simple example:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:send-fault</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"webServiceResponseSender"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:fault</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:fault-code</span>&gt;{http://www.citrusframework.org/faults}citrus:TEC-1000&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:fault-code</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:fault-string</span>&gt;Invalid request&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:fault-string</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:fault-detail</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;ns0:FaultDetail</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:ns0</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/sayHello.xsd"</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:MessageId</span>&gt;${messageId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:MessageId</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:CorrelationId</span>&gt;${correlationId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:CorrelationId</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:ErrorCode</span>&gt;TEC-1000&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:ErrorCode</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:Text</span>&gt;Invalid request&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:Text</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:FaultDetail</span>&gt;
            ]]&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:fault-detail</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:fault</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:header</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_soap_action"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sayHello"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:send-fault</span>&gt;</pre><p>The example generates a simple SOAP fault that is sent back to the calling client. The fault-detail is optional as well as the soap action
            declared in the special Citrus header <code class="literal">citrus_soap_action</code>. You can also set the fault-detail via external file resource. Just use
            <code class="literal">&lt;ws:fault-detail file="classpath:myFaultDetail.xml"/&gt;</code> instead of the inline CDATA definition.</p><p>The generated SOAP fault results in a SOAP message like follows:</p><pre class="programlisting">HTTP/1.1 500 Internal Server Error
Accept: text/xml, text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2
SOAPAction: "sayHello"
Content-Type: text/xml; charset=utf-8
Content-Length: 680
Server: Jetty(7.0.0.pre5)

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Envelope</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:SOAP-ENV</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://schemas.xmlsoap.org/soap/envelope/"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Header</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Body</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Fault</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">faultcode</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:citrus</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/faults"</span>&gt;citrus:TEC-1000&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/faultcode</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">faultstring</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xml:lang</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"en"</span>&gt;Invalid request&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/faultstring</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">detail</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:FaultDetail</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:ns0</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/sayHello.xsd"</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:MessageId</span>&gt;9277832563&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:MessageId</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:CorrelationId</span>&gt;4346806225&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:CorrelationId</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:ErrorCode</span>&gt;TEC-1000&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:ErrorCode</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:Text</span>&gt;Invalid request&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:Text</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:FaultDetail</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/detail</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SOAP-ENV:Fault</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SOAP-ENV:Body</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SOAP-ENV:Envelope</span>&gt;</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top">Notice that the send action uses a special XML namespace (ws:send). This ws namespace belongs to the Citrus WebService extension and
            adds SOAP specific features to the normal send action. When you use such ws extensions you need to define the additional namespace in your test case. 
            This is usually done in the root <span class="emphasis"><em>&lt;spring:beans&gt;</em></span> element where we simply declare the citrus-ws specific namespace like follows.
            
                <pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">spring:beans</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/testcase"</span> 
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:spring</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:ws</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/ws/testcase"</span> 
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans 
    http://www.springframework.org/schema/beans/spring-beans.xsd 
    http://www.citrusframework.org/schema/testcase 
    http://www.citrusframework.org/schema/testcase/citrus-testcase.xsd
    http://www.citrusframework.org/schema/ws/testcase 
    http://www.citrusframework.org/schema/ws/testcase/citrus-ws-testcase.xsd"</span>&gt;</pre></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="soap-fault-validation"></a>14.5.2.&nbsp;SOAP fault validation</h3></div></div></div><p>In case you receive SOAP messages from a WebService endpoint you may also want to validate special SOAP faults 
            in error situations. Citrus can validate SOAP faults with SOAP fault code and fault string values.</p><p>By default the sending action in Citrus may throw a specific exception when the SOAP response contains a SOAP fault element
            (SoapFaultClientException). A tester can assert this kind of exception in a test case in order to expect the SOAP error.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">assert</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.ws.soap.client.SoapFaultClientException"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"webServiceHelloRequestSender"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;ns0:SoapFaultForcingRequest</span> 
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:ns0</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/soap"</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:Message</span>&gt;This is invalid&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:Message</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:SoapFaultForcingRequest</span>&gt;
                ]]&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/assert</span>&gt;</pre><p>The SOAP message sending action is surrounded by a simple assert action. The asserted exception class is the 
            SoapFaultClientException. This means that the test expects the exception to be thrown during the communication. 
            Otherwise the test is failing.</p><p>This exception assertion can not offer direct SOAP fault code and fault string validation, because we do not have access
            to the SOAP fault elements. We can use a special assert implementation especially designed for SOAP faults in this case.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:assert</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">fault-code</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"{http://www.citrusframework.org/faults}TEC-1001"</span> 
           <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">fault-string</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Invalid request"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"webServiceHelloRequestSender"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;ns0:SoapFaultForcingRequest</span> 
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:ns0</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/soap"</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:Message</span>&gt;This is invalid&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:Message</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:SoapFaultForcingRequest</span>&gt;
                ]]&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:assert</span>&gt;</pre><p>The special assert action offers two attributes <span class="emphasis"><em>"fault-code"</em></span> and <span class="emphasis"><em>"fault-string"</em></span>, where 
            <span class="emphasis"><em>fault-code</em></span> is defined as a QName string and is mandatory for the validation. The fault assertion also supports test
            variable replacement as usual (e.g. fault-code="{http://www.citrusframework.org/faults}${myFaultCode}").</p><p>The time you use SOAP fault validation you need to tell Citrus how to validate the SOAP faults. Citrus needs an
            instance of SoapFaultValitator that we need to place into the <span class="emphasis"><em>'citrus-context.xml'</em></span> Spring application context. By default
            Citrus is searching for a bean with the id <span class="emphasis"><em>'soapFaultValidator'</em></span>.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapFaultValidator"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.ws.validation.SimpleSoapAttachmentValidator"</span>/&gt;</pre><p>Citrus offers reference implementations for SOAP fault validation such as <span class="emphasis"><em>com.consol.citrus.ws.validation.SimpleSoapAttachmentValidator</em></span>.
            Please see the API documentation for other available reference implementations. Of course you can define your own validator bean or several 
            validator beans. In the test case you can explicitly choose the validator to use:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:assert</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">fault-code</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"{http://www.citrusframework.org/faults}TEC-1001"</span> 
              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">fault-string</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Invalid request"</span>
              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">fault-validator</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"mySpecialSoapFaultValidator"</span>&gt;
   [...]
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:assert</span>&gt;</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>Another important thing to notice when asserting SOAP faults is the fact, that Citrus needs to have a SoapMessageFactory available in
                the Spring application context. If you deal with SOAP messaging in general you will already have such a bean in the context.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"messageFactory"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.ws.soap.saaj.SaajSoapMessageFactory"</span>/&gt;</pre><p>Choose one of Spring's reference implementations or some other implementation as SOAP message factory. Citrus will search for a bean 
                with id <span class="emphasis"><em>'messageFactory'</em></span> by default. In case you have other beans with different identifiers please choose the
                messageFactory in the test case assert action:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:assert</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">fault-code</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"{http://www.citrusframework.org/faults}TEC-1001"</span> 
              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">fault-string</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Invalid request"</span>
              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message-factory</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"mySpecialMessageFactory"</span>&gt;
   [...]
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:assert</span>&gt;</pre></td></tr></table></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top">Notice the ws specific namespace that belongs to the Citrus WebService extensions. As the ws:assert action uses SOAP specific features
            we need to refer to the citrus-ws namespace. You can find the namespace declaration in the root element in your test case. 
            
                <pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">spring:beans</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/testcase"</span> 
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:spring</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:ws</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/ws/testcase"</span> 
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans 
    http://www.springframework.org/schema/beans/spring-beans.xsd 
    http://www.citrusframework.org/schema/testcase 
    http://www.citrusframework.org/schema/testcase/citrus-testcase.xsd
    http://www.citrusframework.org/schema/ws/testcase 
    http://www.citrusframework.org/schema/ws/testcase/citrus-ws-testcase.xsd"</span>&gt;</pre></td></tr></table></div><p>Citrus is also able to validate SOAP fault details. See the following example for understanding how to do it:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:assert</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">fault-code</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"{http://www.citrusframework.org/faults}TEC-1001"</span> 
           <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">fault-string</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Invalid request"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:fault-detail</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;ns0:FaultDetail</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:ns0</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/soap"</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:ErrorCode</span>&gt;TEC-1000&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:ErrorCode</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:Text</span>&gt;Invalid request&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:Text</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:FaultDetail</span>&gt;
      ]]&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:fault-detail</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"webServiceHelloRequestSender"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;ns0:SoapFaultForcingRequest</span> 
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:ns0</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/soap"</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:Message</span>&gt;This is invalid&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:Message</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:SoapFaultForcingRequest</span>&gt;
                ]]&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:assert</span>&gt;</pre><p>The expected SOAP fault detail content is simply added to the ws:assert action. The SoapFaultValidator implementation is responsible
            for validation the SOAP fault detail offering a validation algorithm. It depends on the chosen validator implementation how the detail
            is compared to the expected template. Possible algorithms are pure String comparison and XML tree comparison as already known from the
            normal message payload validation. Please see the Citrus API documentation for available validator implementations and validation algorithms.</p><p>So far we used assert action wrapper in order to catch SOAP fault exceptions and validate the SOAP fault content. Now we have an alternative way
            of handling SOAP faults in Citrus. With exceptions the send action aborts and we do not have a receive action for the SOAP fault. This might be inadequate if
            we need to validate the SOAP message content (SOAPHeader and SOAPBody) coming with the SOAP fault. Therefore the web service message sender component offers
            several fault strategy options. In the following we discuss the propagation of SOAP fault as messages to the reply message handler as we would do with
            normal SOAP messages.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-ws:message-sender</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapMessageSender"</span> 
                               <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">request-url</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://localhost:8090/test"</span> 
                               <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">reply-handler</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapResponseHandler"</span>
                               <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">fault-strategy</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"propagateError"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-ws:reply-message-handler</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapResponseHandler"</span>/&gt;</pre><p>We have configured a fault strategy <span class="emphasis"><em>propagateError</em></span> so the message sender will not raise client exceptions but inform the reply message handler
            with SOAP fault message contents. By default the fault strategy raises client exceptions (fault-strategy=<span class="emphasis"><em>throwsException</em></span>).</p><p>So now that we do not raise exceptions we can leave out the assert action wrapper in our test. Instead we simply use a receive action and validate the SOAP fault 
            like this.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapMessageSender"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;ns0:SoapFaultForcingRequest</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:ns0</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/sample.xsd"</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:Message</span>&gt;This is invalid&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:Message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:SoapFaultForcingRequest</span>&gt;
            ]]&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapResponseHandler"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">timeout</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"5000"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;SOAP-ENV:Fault</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:SOAP-ENV</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://schemas.xmlsoap.org/soap/envelope/"</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">faultcode</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:CITRUS</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrus.org/soap"</span>&gt;CITRUS:${soapFaultCode}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/faultcode</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">faultstring</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xml:lang</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"en"</span>&gt;${soapFaultString}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/faultstring</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SOAP-ENV:Fault</span>&gt;
            ]]&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>So choose the prefered way of handling SOAP faults either by asserting client exceptions or propagating fault messages to reply message handler receive action.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="soap-attachments"></a>14.6.&nbsp;SOAP attachment support</h2></div></div></div><p>Citrus is able to add attachments to a SOAP request. In return you can also receive SOAP messages with attachments and validate their content. 
        The next chapters describe how to handle SOAP attachments in Citrus.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="soap-attachment-send"></a>14.6.1.&nbsp;Send SOAP attachments</h3></div></div></div><p>As client Citrus is able to add attachments to SOAP messages. I think it is best to look at an example in order to understand how it works.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"webServiceRequestSender"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;ns0:SoapMessageWithAttachment</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:ns0</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://consol.de/schemas/sample.xsd"</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:Operation</span>&gt;Read the attachment&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:Operation</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:SoapMessageWithAttachment</span>&gt;
            ]]&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:attachment</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">content-id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"MySoapAttachment"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">content-type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"text/plain"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:resource</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:com/consol/citrus/ws/soapAttachment.txt"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:attachment</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:send</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>In the previous chapters you may have already noticed the citrus-ws namespace that stands for the WebService extensions in Citrus. Please
                include the citrus-ws namespace in your testcase as described earlier in this chapter, in order to use the attachment support.</p></td></tr></table></div><p>We need to use the Citrus ws extension namespace in our test case wich offers a special send action that is aware of SOAP attachments. The attachment
            content usually consists of a content-id a content-type and the actual content as plain text or binary content. Inside the test case you can use external file
            resources or inline CDATA to specify the attachment content. As you are familiar with Citrus you may know this already from other actions.</p><p>Citrus will construct a SOAP message with the SOAP attachment. Currently only one attachment per message is supported, which will fullfill the needs
            of almost every application.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="soap-attachment-receiver"></a>14.6.2.&nbsp;Receive and validate SOAP attachments</h3></div></div></div><p>When Citrus calls SOAP WebServices as a client we may receive SOAP responses with attachments. The tester can validate
            received SOAP messages with attachment content quite easy. As usual let us have a look at an example first.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"webServiceRequestReceiver"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;ns0:SoapMessageWithAttachmentRequest</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:ns0</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://consol.de/schemas/sample.xsd"</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:Operation</span>&gt;Read the attachment&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:Operation</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:SoapMessageWithAttachmentRequest</span>&gt;
            ]]&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:attachment</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">content-id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"MySoapAttachment"</span> 
                      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">content-type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"text/plain"</span>
                      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">validator</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"mySoapAttachmentValidator"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:resource</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:com/consol/citrus/ws/soapAttachment.txt"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:attachment</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:receive</span>&gt;</pre><p>Again we use the Citrus ws extension namespace for a specific receive action that is aware of SOAP attachment validation. The tester can validate 
            the content-id, the content-type and the attachment content. Instead of using the external file resource you could also define an expected attachment template directly 
            in the test case as CDATA inline element.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The ws:attachment element specifies a validator instance. This validator determines how to validate the attachment content. SOAP attachments are not 
                limited to XML content. Plain text content and binary content is possible, too. So each SOAP attachment validating action can use a different SoapAttachmentValidator 
                instance which is responsible for validating and comparing received attachments to expected template attachments. In the Citrus configuration the validator
                is set as normal Spring bean with the respective identifier.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapAttachmentValidator"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.ws.validation.SimpleSoapAttachmentValidator"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"mySoapAttachmentValidator"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.company.ws.validation.MySoapAttachmentValidator"</span>/&gt;</pre><p>You can define several validator instanes in the Citrus configuration. The validator with the general id="soapAttachmentValidator" is the default validator 
                for all actions that do not explicitly set a validator instance. Citrus offers a set of validator implementations. The SimpleSoapAttachmentValidator will use a simple
                plain text comparison. Of course you are able to add individual validator implementations, too.</p></td></tr></table></div><p>As usual a special endpoint implementation receives the SOAP requests and delegates those requests to a MessageHandler implementation as described in chapter 
            <a href="#soap-receiver" title="14.2.&nbsp;SOAP message receiver">Section&nbsp;14.2, &#8220;SOAP message receiver&#8221;</a>. The SOAP attachment validation in its curent nature does require the JmsConnectingMessageHandler implementation where the Citrus 
            endpoint will forward incoming requests to a JMS queue. The SOAP attachment is converted to special JMS message headers and are ready for validation when received by
            the test case. See the following example to clear the boundaries.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"webServiceEndpoint"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.ws.WebServiceEndpoint"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"messageHandler"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.adapter.handler.JmsConnectingMessageHandler"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"destinationName"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"JMS.Soap.RequestQueue"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"connectionFactory"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.apache.activemq.ActiveMQConnectionFactory"</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"brokerURL"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"tcp://localhost:61616"</span> /&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"messageCallback"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.ws.message.SoapAttachmentAwareJmsMessageCallback"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"replyTimeout"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"5000"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>The endpoint in the example uses the JmsConnectingMessageHandler in combination with the SoapAttachmentAwareJmsMessageCallback, which takes care of SOAP
            attachments in incoming requests. This mechanism allows test cases to receive messages over JMS with SOAP attachments encoded in the JMS message header. Fortunately
            you do not need to worry about the JMS header encoding done in the SoapAttachmentAwareJmsMessageCallback, because the ws:attachment extension will do all magic for you.
            Just use a extended message receiving action as shown in the example at the beginning of this chapter and you are able to validate the SOAP attachment data.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="soap-ws-adressing"></a>14.6.3.&nbsp;WS-Addressing support</h3></div></div></div><p>WebServices offer lots of technologies and standards within the context of WebServices. Some people call them WS-* specifications. One of these specifications deals 
            with addressing WebServices. On client side you may add wsa header information to the request in order to give the server instructions how to deal with SOAP faults for instance.</p><p>In Citrus WebServiceMessageSender you can add those header information using the common configuration like this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-ws:message-sender</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapMessageSender"</span> 
                         <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">request-url</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://localhost:8090/test"</span> 
                         <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">reply-handler</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapResponseHandler"</span>
                         <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">addressing-headers</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"wsAddressing200408"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"wsAddressing200408"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.ws.addressing.WsAddressingHeaders"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"version"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"VERSION200408"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"action"</span> 
                 <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrus.sample/sayHello"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"to"</span> 
                 <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrus.sample/server"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"from"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.ws.soap.addressing.core.EndpointReference"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor-arg</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrus.sample/client"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"replyTo"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.ws.soap.addressing.core.EndpointReference"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor-arg</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrus.sample/client"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"faultTo"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.ws.soap.addressing.core.EndpointReference"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor-arg</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrus.sample/fault/resolver"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The WS-Addressing specification knows several versions. Supported version are VERSION10 (WS-Addressing 1.0 May 2006) and VERSION200408 
                (August 2004 edition of the WS-Addressing specification).</p></td></tr></table></div><p>The addressing headers find a place in the SOAP message header with respective namespaces and values. A possible SOAP request  with
            ws addressing headers looks like follows:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Envelope</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:SOAP-ENV</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://schemas.xmlsoap.org/soap/envelope/"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Header</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:wsa</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://schemas.xmlsoap.org/ws/2004/08/addressing"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">wsa:To</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">SOAP-ENV:mustUnderstand</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"1"</span>&gt;http://citrus.sample/server&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/wsa:To</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">wsa:From</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">wsa:Address</span>&gt;http://citrus.sample/client&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/wsa:Address</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/wsa:From</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">wsa:ReplyTo</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">wsa:Address</span>&gt;http://citrus.sample/client&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/wsa:Address</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/wsa:ReplyTo</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">wsa:FaultTo</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">wsa:Address</span>&gt;http://citrus.sample/fault/resolver&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/wsa:Address</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/wsa:FaultTo</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">wsa:Action</span>&gt;http://citrus.sample/sayHello&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/wsa:Action</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">wsa:MessageID</span>&gt;urn:uuid:4c4d8af2-b402-4bc0-a2e3-ad33b910e394&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/wsa:MessageID</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SOAP-ENV:Header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Body</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">cit:HelloRequest</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:cit</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrus/sample/sayHello"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">cit:Text</span>&gt;Hello Citrus!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/cit:Text</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/cit:HelloRequest</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SOAP-ENV:Body</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SOAP-ENV:Envelope</span>&gt;
            </pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>The message id property is automatically generated for each request. If you need to set a static message 
                id you can do so in citrus-context message sender configuration.</p></td></tr></table></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="soap-fork-mode"></a>14.7.&nbsp;Handle synchronous SOAP responses</h2></div></div></div><p>SOAP over HTTP uses synchronous communictaion by nature. This means that sending a SOAP message in Citrus over HTTP will automatically 
        block further test actions until the synchronous HTTP response from the server arrives. In test cases you may want to avoid this synchronous blocking
        for several reasons. A simple reason would be that you need to do further test actions in parallel to the synchronous HTTP SOAP communication (e.g. simulate another
        backend system in the test case).</p><p>You can separate the SOAP send action from the rest of the test case by using the <span class="emphasis"><em>"fork"</em></span> mode. The SOAP
        message sender will automatically open a new Java Thread for the synchronous communication and the test is able to continue with execution although the
        synchronous HTTP SOAP response has not arrived yet.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"webServiceRequestSender"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">fork</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;ns0:SoapMessageWithAttachmentRequest</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:ns0</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/sample.xsd"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:Operation</span>&gt;Read the attachment&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:Operation</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:SoapMessageWithAttachmentRequest</span>&gt;
      ]]&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:send</span>&gt;</pre><p>With the <span class="emphasis"><em>"fork"</em></span> mode enabled the test continues with execution while the sending action waits for the synchronous response in 
        a separate Java Thread. You could reach the same behaviour with a complex &lt;parallel&gt;/&lt;sequential&gt; container construct, but forking the send action is much more
        straight forward.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top">It is higly recommended to use a proper <span class="emphasis"><em>"timeout"</em></span> in the corresponding receive action for the synchronous SOAP response. As the sending 
        action is forked it is possible that the receive action in the test asks for the response before the message actually was sent by the server. The result would be a broken test case 
        whith a failing receive action, because of the missing response message. The <span class="emphasis"><em>"timeout"</em></span> solves this problem as the receive action will wait for this 
        time period and occasionally repeats to ask for the SOAP response message. The following sample receive action asks several times within the 10 second timeout period to receive the 
        SOAP response.
            <pre class="programlisting">
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"webServiceReplyHandler"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">timeout</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"10000"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;ns0:SoapMessageWithAttachmentResponse</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:ns0</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/sample.xsd"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:Operation</span>&gt;Read the attachment&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:Operation</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:Success</span>&gt;true&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:Success</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:SoapMessageWithAttachmentResponse</span>&gt;
      ]]&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:receive</span>&gt;
            </pre></td></tr></table></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="message-channel"></a>Chapter&nbsp;15.&nbsp;Message channel support</h2></div></div></div><p>Spring Integration (http://www.springsource.org/spring-integration) provides support for messaging solutions in
    Spring-based applications meeting the famous Enterprise Integration patterns and best practices. Citrus itself uses a lot 
    of Spring APIs, especially those from Spring Integration.</p><p>The conclusion is that Citrus supports the sending and receiving of messages to/from Spring Integration message 
    channel components.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Citrus message channel connecting components use the same "citrus" configuration namespace and schema definitions
        in Spring context files as already described in chapter <a href="#jms" title="Chapter&nbsp;12.&nbsp;Connecting with JMS">Chapter&nbsp;12, <i xmlns:xlink="http://www.w3.org/1999/xlink">Connecting with JMS</i></a>. You always have to include this configuration 
        namespace in order to use the Citrus configuration elements.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="message-channel-sender"></a>15.1.&nbsp;Message channel sender</h2></div></div></div><p>You can access message channels directly with a <span class="emphasis"><em>message-channel-sender</em></span> component. The message 
        channel sender configuration is quite simple and receives a target channel as reference:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:message-channel-sender</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"orderRequestSender"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">channel</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"orderChannel"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">si:channel</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"orderChannel"</span>/&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The Spring Integration configuration components use a specific namespace that has to be included into your
            Spring application context. You can use the following template which holds all necessary namespaces and schema 
            locations:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">beans</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xsi</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:citrus</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/config"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:si</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/integration"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans
            http://www.springframework.org/schema/beans/spring-beans.xsd
            http://www.citrusframework.org/schema/config 
            http://www.citrusframework.org/schema/config/citrus-config.xsd
            http://www.springframework.org/schema/integration
            http://www.springframework.org/schema/integration/spring-integration.xsd"</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/beans</span>&gt;</pre></td></tr></table></div><p>The Citrus message-channel-sender also supports a customized message channel template that will actually send 
        the messages. The customized template might give you access to special configuration possibilities. However it is optional, 
        so if no message channel template is defined in the configuration Citrus will create a default template.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:message-channel-sender</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"statusRequestSender"</span>
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">channel</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"orderChannel"</span> 
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message-channel-template</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myMessageChannelTemplate"</span>/&gt;</pre></div><p>The message sender is now ready to publish messages to the defined channel. The communication is supposed to be asynchronous, 
    so the sender is not able to process a reply message. We will deal with synchronous communication and reply messages later in this chapter.
    The message sender just publishes messages to the channel.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="message-channel-receiver"></a>15.2.&nbsp;Message channel receiver</h2></div></div></div><p>Citrus is able to receive messages from Spring Integration message channel destinations. Again the message-channel-receiver needs 
        nothing but a reference to a message channel in its simplest configuration.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:message-channel-receiver</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"ordersResponseReceiver"</span> 
                                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">channel</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"orderChannel"</span>
                                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">receive-timeout</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"5000"</span>/&gt;</pre><p>As usual the receiver connects to the message destination and waits for messages to arrive. The user can set a receive timeout which is 
        set to 5000 milliseconds by default. In case no message was received in this time frame the receiver raises timeout errors and the test 
        fails.</p><p>Similar to the previously described <span class="emphasis"><em>message-channel-sender</em></span> the <span class="emphasis"><em>message-channel-receiver</em></span> supports
        a message-channel-template that is used for receiving messages.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:message-channel-receiver</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"ordersResponseReceiver"</span> 
                                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">channel</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"orderChannel"</span>
                                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">receive-timeout</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"5000"</span>
                                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message-channel-template</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myMessageChannelTemplate"</span>/&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sync-message-channel-sender"></a>15.3.&nbsp;Synchronous message channel sender</h2></div></div></div><p>The synchronous message sender publishes messages and waits synchronously for the response to arrive on some reply 
        channel destination. The reply channel name is set in the message's header attributes so the counterpart in this communication can send its reply 
        to that channel. The basic configuration for a synchronous send-receive message channel sender looks like follows:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:sync-message-channel-sender</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"customerRequestSender"</span> 
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">channel</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"customerRequestChannel"</span>
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">reply-handler</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"customerReplyMessageHandler"</span>
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">reply-timeout</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"1000"</span>/&gt;
                            
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:message-channel-reply-handler</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"customerReplyMessageHandler"</span>/&gt;</pre><p>Synchronous message channel senders usually go with a reply message handler that handles the reply messages. Once the synchronous reply 
        message was consumed from the reply channel the reply-message-handler implementation is responsible for further processing (e.g. message validation).</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Reply channels are always of dynamic temporary nature. The temporary reply channels are only used once for a single communication handshake. 
            After that the reply channel is deleted again. Static reply channels are not supported because they would receive multiple reply messages at the same
            time and the reply message handlers need to filter (select) the message from that channel, which is not in scope yet.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sync-message-channel-receiver"></a>15.4.&nbsp;Synchronous message channel receiver</h2></div></div></div><p>In the last section we saw that synchronous communication is based on reply messages on temporary reply channels. We saw that
        Citrus is able to publish messages to channels and wait for reply messages to arrive on temporary reply channels. This section deals with the same
        synchronous communication over reply messages, but now Citrus has to send dynamic reply messages to temporary channels.</p><p>The scenario we are talking about is that Cittrus receives a message and we need to reply to a temporary reply channel that is stored 
        in the message header attributes.</p><p>We handle this synchronous communication with the synchronous message receiver in combination with a reply sender. The configuration looks like follows:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:sync-message-channel-receiver</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"orderRequestReceiver"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">channel</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"order"</span>/&gt;
                                     
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:message-channel-reply-sender</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"orderReplySender"</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">reply-channel-holder</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"orderRequestReceiver"</span>/&gt;</pre><p>The synchronous message channel receiver will store dynamic reply channel destinations and provide those
        dynamic channel names to a reply message sender. Those two components <span class="emphasis"><em>sync-message-channel-receiver</em></span> and 
        <span class="emphasis"><em>message-channel-reply-sender</em></span> are always working together in order to realize incoming synchronous
        request with reply messages sent by Citrus.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="message-channel-selector-support"></a>15.5.&nbsp;Message selectors on channels</h2></div></div></div><p>Unfortunately Spring Integration message channels do not support message selectors on header values as described in <a href="#message-selector" title="6.2.7.&nbsp;Message selectors">Section&nbsp;6.2.7, &#8220;Message selectors&#8221;</a>. With Citrus version 1.2
        we found a way to also add message selector support on message channels. We had to introduce a special queue message channel implementation. So first of all we use this new message channel
        implementation in our configuration.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:message-channel</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"orders"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">capacity</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"5"</span>/&gt;</pre><p>The Citrus message channel implementation extends the queue channel implementation from Spring Integration. So we can add a capacity attribute for this channel. That's it! 
        Now we use the message channel that supports message selection. In our test we define message selectors on header values as described in <a href="#message-selector" title="6.2.7.&nbsp;Message selectors">Section&nbsp;6.2.7, &#8220;Message selectors&#8221;</a> and
        you will see that it works.</p><p>In addition to that we have implemented other message filter possibilities on message channels that we discuss in the next sections.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="root-qname-message-selector"></a>15.5.1.&nbsp;Root QName Message Selector</h3></div></div></div><p>You can use the XML root QName of your message as selection criteria. Let's see how this works in a small example:</p><p>We have two different XML messages on a message channel waiting to be picked up by a consumer.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">HelloMessage</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrusframework.org/schema"</span>&gt;Hello Citrus&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/HelloMessage</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">GoodbyeMessage</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrusframework.org/schema"</span>&gt;Goodbye Citrus&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/GoodbyeMessage</span>&gt;</pre><p>We would like to pick up the <span class="emphasis"><em>GoodbyeMessage</em></span> in our test case. The <span class="emphasis"><em>HelloMessage</em></span> should be left on the message channel as we are not interested
            in it right now. We can define a root qname message selector in the receive action like this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"channelReceiver"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">selector</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"root-qname"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"GoodbyeMessage"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/selector</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">GoodbyeMessage</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrusframework.org/schema"</span>&gt;Goodbye Citrus&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/GoodbyeMessage</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>The Citrus receiver picks up the <span class="emphasis"><em>GoodbyeMessage</em></span> from the channel selected via the root qname of the XML message payload. Of course you can also combine message header
            selectors and root qname selectors as shown in this example below where a message header <span class="emphasis"><em>sequenceId</em></span> is added to the selection logic.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">selector</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"root-qname"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"GoodbyeMessage"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sequenceId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"1234"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/selector</span>&gt;</pre><p>As we deal with XML qname values, we can also use namespaces in our selector root qname selection.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">selector</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"root-qname"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"{http://citrusframework.org/schema}GoodbyeMessage"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/selector</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xpath-evaluating-message-selector"></a>15.5.2.&nbsp;XPath Evaluating Message Selector</h3></div></div></div><p>It is also possible to evaluate some XPath expression on the message payload in order to select a message from a message channel. The XPath expression outcome must
            match an expected value and only then the message is consumed form the channel.</p><p>The syntax for the XPath expression is to be defined as the element name like this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">selector</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"xpath://Order/status"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"pending"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/selector</span>&gt;</pre><p>The message selector looks for order messages with <span class="emphasis"><em>status="pending"</em></span> in the message payload. This means that following messages would get 
            accepted/declined by the message selector.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Order</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">status</span>&gt;pending&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/status</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Order</span>&gt; = ACCEPTED
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Order</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">status</span>&gt;finished&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/status</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Order</span>&gt; = NOT ACCEPTED</pre><p>Of course you can also use XML namespaces in your XPath expressions when selecting messages from channels.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">selector</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"xpath://ns1:Order/ns1:status"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"pending"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/selector</span>&gt;</pre><p>Namespace prefixes must match the incoming message - otherwise the XPath expression will not work as expected. In our example the message should look like this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns1:Order</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:ns1</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrus.org/schema"</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns1:status</span>&gt;pending&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns1:status</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns1:Order</span>&gt;</pre><p>Knowing the correct XML namespace prefix is not always easy. If you are not sure which namespace prefix to choose Citrus ships with a dynamic namespace replacement 
            for XPath expressions. The XPath expression looks like this and is most flexible:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">selector</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"xpath://{http://citrus.org/schema}:Order/{http://citrus.org/schema}:status"</span> 
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"pending"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/selector</span>&gt;</pre><p>This will match all incoming messages regardless the XML namespace prefix that is used.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="connecting-to-adapters"></a>15.6.&nbsp;Connecting with Spring Integration Adapters</h2></div></div></div><p>We have seen asynchronous and synchronous communication with Spring Integration message channels in this chapter. 
        With this message channel connection Citrus is able to use the various Spring Integration Adapter implementations, which is a fantastic
        way to extend Citrus for additional transports. The following chapter tries to give an example how to use Spring Integration with Citrus.</p><p>We want to use the Spring Integration file adapter that is able to read/write files from/to a storage directory. 
        Citrus can easily connect to this file adapter implementation with its message channel support. Citrus message sender and receiver speak to 
        message channels that are connected to the Spring Integration file adapter.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:message-channel-sender</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"fileSender"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">channel</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"fileOutboundChannel"</span>/&gt;
                   
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">file:outbound-channel-adapter</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"filesOut"</span> 
                  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">channel</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"fileOutboundChannel"</span> 
                  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">directory</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"file:${some.directory.property}"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">si:channel</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"fileOutboundChannel"</span>/&gt;</pre><p>The configuration above describes a Citrus message channel sender in combination with a Spring Integration outbound file adapter 
        that writes messages to a storage directory. With this combination you are able to write files to a directory in your Citrus test case.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The Spring Integration file adapter configuration components add a new namespace to our
            Spring application context. See this template which holds all necessary namespaces and schema locations:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">beans</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xsi</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:citrus</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/config"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:si</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/integration"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/integration/file"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans
            http://www.springframework.org/schema/beans/spring-beans.xsd
            http://www.citrusframework.org/schema/config 
            http://www.citrusframework.org/schema/config/citrus-config.xsd
            http://www.springframework.org/schema/integration
            http://www.springframework.org/schema/integration/spring-integration.xsd
            http://www.springframework.org/schema/integration/file
            http://www.springframework.org/schema/integration/file/spring-integration-file.xsd"</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/beans</span>&gt;</pre></td></tr></table></div><p>The next program listing shows a possible inbound file communication. So Spring's file inbound adapter will read files from a 
        storage directory and publish the file contents to a message channel. Citrus can then receive those files as messages in a test case
        and validate the file contents for instance.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">file:inbound-channel-adapter</span>  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"fileIn"</span> 
                 <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">channel</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"fileInputChannel"</span>
                 <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">directory</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"file:${some.directory.property}"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">si:poller</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">fixed-rate</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"100"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/file:inbound-channel-adapter</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">si:channel</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"fileInputChannel"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">si:queue</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">capacity</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"25"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">si:interceptors</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.integration.transformer.MessageTransformingChannelInterceptor"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor-arg</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.integration.file.transformer.FileToStringTransformer"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/constructor-arg</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/si:interceptors</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/si:channel</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:message-channel-receiver</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"fileReceiver"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">channel</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"fileInputChannel"</span>/&gt;</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>The file inbound adapter constructs Java file objects as the message payload by default. Citrus can only work on String 
            message payloads. So we need a file transformer that converts the file objects to String payloads representing the file's content.</p></td></tr></table></div><p>This file adapter example shows how easy Citrus can work hand in hand with Spring Integration adapter implementations. The message 
        channel support is a fantastic way to extend the transport and protocol support in Citrus by connecting with the very good Spring Integration 
        adapter implementations. Have a closer look at the Spring Integration project for more details and other adapter implementations that you 
        can use with Citrus integration testing.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="functions"></a>Chapter&nbsp;16.&nbsp;Functions</h2></div></div></div><p>The test framework will offer several functions that are useful throughout the test execution. The
    functions will always return a string value that is ready for use as variable value or directly inside a text
    message.</p><p>A set of functions is usually combined to a function library. The library has a prefix that will identify
    the functions inside the test case. The default test framework function library uses a default prefix (citrus).
    You can write your own function library using your own prefix in order to extend the test framework
    functionality whenever you want.</p><p>The library is built in the Spring configuration and contains a set of functions that are of
    public use.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testFrameworkFunctionLibrary"</span> 
         <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.functions.FunctionLibrary"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"name"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testFrameworkFunctionLibrary"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"prefix"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"members"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">map</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">entry</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">key</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"randomNumber"</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.functions.RandomNumberFunction"</span>/&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/entry</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">entry</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">key</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"randomString"</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.functions.RandomStringFunction"</span>/&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/entry</span>&gt;
          ...
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/map</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>In the next chapters the default functions offered by the framework will be described in detail.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-concat"></a>16.1.&nbsp;citrus:concat()</h2></div></div></div><p>The function will combine several string tokens to a single string value. This means that you can combine
        a static text value with a variable value for instance. A first example should clarify the usage:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"concatFunctionTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"date"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:currentDate(yyyy-MM-dd)"</span> /&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"text"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Hello Test Framework!"</span> /&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                citrus:concat('Today is: ', ${date}, ' right!?')
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                citrus:concat('Text is: ', ${text})
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>Please do not forget to mark static text with single quote signs. There is no limitation for string tokens to
        be combined.</p><p><code class="literal">citrus:concat('Text1', 'Text2', 'Text3', ${text}, 'Text5', &#8230; , 'TextN')</code></p><p>The function can be used wherever variables can be used. For instance when validating XML elements in
        the receive action.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//element/element"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:concat('Cx1x', ${generatedId})"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-substring"></a>16.2.&nbsp;citrus:substring()</h2></div></div></div><p>The function will have three parameters.</p><p>1. String to work on</p><p>2. Starting index</p><p>3. End index (optional)</p><p>Let us have a look at a simple example for this function:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        citrus:substring('Hello Test Framework', 6)
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        citrus:substring('Hello Test Framework', 0, 5)
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;</pre><p>Function output:</p><p><span class="emphasis"><em>Test Framework</em></span></p><p><span class="emphasis"><em>Hello</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-string-length"></a>16.3.&nbsp;citrus:stringLength()</h2></div></div></div><p>The function will calculate the number of characters in a string representation and return the number.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:stringLength('Hello Test Framework')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;</pre><p>Function output:</p><p><span class="emphasis"><em>20</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-translate"></a>16.4.&nbsp;citrus:translate()</h2></div></div></div><p>This function will replace regular expression matching values inside a string representation with a
        specified replacement string.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        citrus:translate('H.llo Test Fr.mework', '\.', 'a')
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;</pre><p>Note that the second parameter will be a regular expression. The third parameter will be a simple
        replacement string value.</p><p>Function output:</p><p><span class="emphasis"><em>Hello Test Framework</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-substring-before"></a>16.5.&nbsp;citrus:substringBefore()</h2></div></div></div><p>The function will search for the first occurrence of a specified string and will return the substring before
        that occurrence. Let us have a closer look in a simple example:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        citrus:substringBefore('Test/Framework', '/')
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;</pre><p>In the specific example the function will search for the &#8216;/&#8217; character and return the string before that index.</p><p>Function output:</p><p><span class="emphasis"><em>Test</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-substring-after"></a>16.6.&nbsp;citrus:substringAfter()</h2></div></div></div><p>The function will search for the first occurrence of a specified string and will return the substring after that
        occurrence. Let us clarify this with a simple example:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        citrus:substringAfter('Test/Framework', '/')
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;</pre><p>Similar to the substringBefore function the &#8216;/&#8217; character is found in the string. But now the remaining
        string is returned by the function meaning the substring after this character index.</p><p>Function output:</p><p><span class="emphasis"><em>Framework</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-round"></a>16.7.&nbsp;citrus:round()</h2></div></div></div><p>This is a simple mathematic function that will round decimal numbers representations to their nearest non decimal
        number.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:round('3.14')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;</pre><p>Function output:</p><p><span class="emphasis"><em>3</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-floor"></a>16.8.&nbsp;citrus:floor()</h2></div></div></div><p>This function will round down decimal number values.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:floor('3.14')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;</pre><p>Function output:</p><p><span class="emphasis"><em>3.0</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-ceiling"></a>16.9.&nbsp;citrus:ceiling()</h2></div></div></div><p>Similar to floor function, but now the function will round up the decimal number values.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:ceiling('3.14')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;</pre><p>Function output:</p><p><span class="emphasis"><em>4.0</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-random-number"></a>16.10.&nbsp;citrus:randomNumber()</h2></div></div></div><p>The random number function will provide you the opportunity to generate random number strings
        containing positive number letters. There is a singular Boolean parameter for that function describing
        whether the generated String should have leading zero letters or not. Default value for this padding flag
        will be true.</p><p>Next example will show the function usage:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"rndNumber1"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:randomNumber(10)"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"rndNumber2"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:randomNumber(10, true)"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"rndNumber3"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:randomNumber(10, false)"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;</pre><p>Function output:</p><p><span class="emphasis"><em>8954638765</em></span></p><p><span class="emphasis"><em>0006387650</em></span></p><p><span class="emphasis"><em>45638765</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-random-string"></a>16.11.&nbsp;citrus:randomString()</h2></div></div></div><p>This function will generate a random string representation with a defined length. A second parameter for
        this function will define the case of the generated letters (UPPERCASE, LOWERCASE, MIXED)</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"rndString0"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${citrus:randomString(10)}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"rndString1"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:randomString(10)"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"rndString2"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:randomString(10, UPPERCASE)"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"rndString3"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:randomString(10, LOWERCASE)"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"rndString4"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:randomString(10, MIXED)"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;</pre><p>Function output:</p><p><span class="emphasis"><em>Hr546dfA65</em></span></p><p><span class="emphasis"><em>Ag3876det5</em></span></p><p><span class="emphasis"><em>4SDF87TR</em></span></p><p><span class="emphasis"><em>4tkhi7uz</em></span></p><p><span class="emphasis"><em>Vt567JkA32</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-random-enum-value"></a>16.12.&nbsp;citrus:randomEnumValue()</h2></div></div></div><p>
              This function returns one of its supplied arguments. Furthermore you can specify a custom function
              with a preconfigured list of values (the enumeration). The funciton will randomly return an entry when called without arguments. 
              This promotes code reuse and facilitates refactoring.
        </p><p>
              In the next sample the function is used to set a httpStatusCode variable to one of the given HTTP status codes (200, 401, 500)
        </p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpStatusCode"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:randomEnumValue('200', '401', '500')"</span> /&gt;</pre><p>
            As mentioned before you can define a custom function for your very specific needs in order to easily manage a list of predefined values like this:
        </p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myCustomFunctionLibrary"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.functions.FunctionLibrary"</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"name"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myCustomFunctionLibrary"</span> /&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"prefix"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"custom:"</span> /&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"members"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">map</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">entry</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">key</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"randomHttpStatusCode"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.functions.core.RandomEnumValueFunction"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"values"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">list</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;200&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;500&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;401&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/list</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/entry</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/map</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>
            We have added a custom function library with a custom function definition. The custom function "randomHttpStatusCode" randomly 
            chooses an HTTP status code each time it is called. Inside the test you can use the function like this:
        </p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpStatusCode"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"custom:randomHttpStatusCode()"</span> /&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-current-date"></a>16.13.&nbsp;citrus:currentDate()</h2></div></div></div><p>This function will definitely help you when accessing the current date. Some examples will show the
        usage in detail:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:currentDate()&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:currentDate('yyyy-MM-dd')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:currentDate('yyyy-MM-dd HH:mm:ss')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:currentDate('yyyy-MM-dd'T'hh:mm:ss')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:currentDate('yyyy-MM-dd HH:mm:ss', '+1y')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:currentDate('yyyy-MM-dd HH:mm:ss', '+1M')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:currentDate('yyyy-MM-dd HH:mm:ss', '+1d')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:currentDate('yyyy-MM-dd HH:mm:ss', '+1h')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:currentDate('yyyy-MM-dd HH:mm:ss', '+1m')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:currentDate('yyyy-MM-dd HH:mm:ss', '+1s')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:currentDate('yyyy-MM-dd HH:mm:ss', '-1y')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;</pre><p>Note that the currentDate function provides two parameters. First parameter describes the date format
        string. The second will define a date offset string containing year, month, days, hours, minutes or seconds
        that will be added or subtracted to or from the actual date value.</p><p>Function output:</p><p><span class="emphasis"><em>01.09.2009</em></span></p><p><span class="emphasis"><em>2009-09-01</em></span></p><p><span class="emphasis"><em>2009-09-01 12:00:00</em></span></p><p><span class="emphasis"><em>2009-09-01T12:00:00</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-upper-case"></a>16.14.&nbsp;citrus:upperCase()</h2></div></div></div><p>This function converts any string to upper case letters.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:upperCase('Hello Test Framework')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;</pre><p>Function output:</p><p><span class="emphasis"><em>HELLO TEST FRAMEWORK</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-lower-case"></a>16.15.&nbsp;citrus:lowerCase()</h2></div></div></div><p>This function converts any string to lower case letters.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:lowerCase('Hello Test Framework')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;</pre><p>Function output:</p><p><span class="emphasis"><em>hello test framework</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-average"></a>16.16.&nbsp;citrus:average()</h2></div></div></div><p>The function will sum up all specified number values and divide the result through the number of values.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"avg"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:average('3', '4', '5')"</span>/&gt;</pre><p>avg = <span class="emphasis"><em>4.0</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-minimum"></a>16.17.&nbsp;citrus:minimum()</h2></div></div></div><p>This function returns the minimum value in a set of number values.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"min"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:minimum('3', '4', '5')"</span>/&gt;</pre><p>min = <span class="emphasis"><em>3.0</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-maximum"></a>16.18.&nbsp;citrus:maximum()</h2></div></div></div><p>This function returns the maximum value in a set of number values.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"max"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:maximum('3', '4', '5')"</span>/&gt;</pre><p>max = <span class="emphasis"><em>5.0</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-sum"></a>16.19.&nbsp;citrus:sum()</h2></div></div></div><p>The function will sum up all number values. The number values can also be negative.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sum"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:sum('3', '4', '5')"</span>/&gt;</pre><p>sum = <span class="emphasis"><em>12.0</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-absolute"></a>16.20.&nbsp;citrus:absolute()</h2></div></div></div><p>The function will return the absolute number value.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"abs"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:absolute('-3')"</span>/&gt;</pre><p>abs = <span class="emphasis"><em>3.0</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-map-value"></a>16.21.&nbsp;citrus:mapValue()</h2></div></div></div><p>
              This function implementation maps string keys to string values. This is very helpful when the used key is randomly chosen
              at runtime and the corresponding value ist not defined during the design time.
        </p><p>
              The following function library defines a custom function for mapping HTTP status codes to the corresponding messages:
        </p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myCustomFunctionLibrary"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.functions.FunctionLibrary"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"name"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myCustomFunctionLibrary"</span> /&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"prefix"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"custom:"</span> /&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"members"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">map</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">entry</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">key</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"getHttpStatusMessage"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.functions.core.MapValueFunction"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"values"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">map</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">entry</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">key</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"200"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"OK"</span> /&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">entry</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">key</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"401"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Unauthorized"</span> /&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">entry</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">key</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"500"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Internal Server Error"</span> /&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/map</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/entry</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/map</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>
            In this example the function sets the variable httpStatusMessage to the 'Internal Server Error' string dynamically at runtime.
            The test only knows the HTTP status code and does not care about spelling and message locales.
        </p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpStatusCodeMessage"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"custom:getHttpStatusMessage('500')"</span> /&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-random-uuid"></a>16.22.&nbsp;citrus:randomUUID()</h2></div></div></div><p>The function will generate a random Java UUID.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"uuid"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:randomUUID()"</span>/&gt;</pre><p>uuid = <span class="emphasis"><em>98fbd7b0-832e-4b85-b9d2-e0113ee88356</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-encode-base64"></a>16.23.&nbsp;citrus:encodeBase64()</h2></div></div></div><p>The function will encode a string to binary data using base64 hexadecimal encoding.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"encoded"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:encodeBase64('Hallo Testframework')"</span>/&gt;</pre><p>encoded = <span class="emphasis"><em>VGVzdCBGcmFtZXdvcms=</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-decode-base64"></a>16.24.&nbsp;citrus:decodeBase64()</h2></div></div></div><p>The function will decode binary data to a character sequence using base64 hexadecimal decoding.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"decoded"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:encodeBase64('VGVzdCBGcmFtZXdvcms=')"</span>/&gt;</pre><p>decoded = <span class="emphasis"><em>Hallo Testframework</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-escape-xml"></a>16.25.&nbsp;citrus:escapeXml()</h2></div></div></div><p>If you want to deal with escaped XML in your test case you may want to use this function. It automatically escapes all
        XML special characters.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">citrus:escapeXml('&lt;Message&gt;Hallo</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">Test</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">Framework&lt;/Message&gt;')</span>                        
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">]]&gt;</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/message&gt;</span>
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/echo&gt;</span></pre><p><span class="emphasis"><em>&amp;lt;Message&amp;gt;Hallo Test Framework&amp;lt;/Message&amp;gt;</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-cdata-section"></a>16.26.&nbsp;citrus:cdataSection()</h2></div></div></div><p>Usually we use CDATA sections to define message payload data inside a testcase. We might run into problems
        when the payload itself contains CDATA sections as nested CDATA sections are prohibited by XML nature. In this
        case the next function ships very usefull.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"cdata"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:cdataSection('payload')"</span>/&gt;</pre><p>cdata = <span class="emphasis"><em>&lt;![CDATA[payload]]&gt;</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-digest-auth"></a>16.27.&nbsp;citrus:digestAuthHeader()</h2></div></div></div><p>Digest authentication is a commonly used security algorithm, especially in Http communication and SOAP WebServices.
        Citrus offers a function to generate a digest authentication principle used in the Http header section of a message.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"digest"</span> 
  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:digestAuthHeader('username', 'password', 'authRealm', 'acegi', 
                            'POST', 'http://127.0.0.1:8080', 'citrus', 'md5')"</span>/&gt;</pre><p>A possible digest authentication header value looks like this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Digest</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">username</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">foo,realm=arealm,nonce=MTMzNT,</span>
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">uri</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">http:</span>//127.0.0.1:8080,response=51f98c,opaque=b29a30,algorithm=md5&gt;</pre><p>You can use these digest headers in messages sent by Citrus like this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_http_Authorization"</span> 
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"vflig:digestAuthHeader('${username}','${password}','${authRealm}',
                            '${nonceKey}','POST','${uri}','${opaque}','${algorithm}')"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;  
        </pre><p>This will set a Http Authorization header with the respective digest in the request message. So your test is ready for client digest authentication.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-localhost-address"></a>16.28.&nbsp;citrus:localHostAddress()</h2></div></div></div><p>Test cases may use the local host address for some reason (e.g. used as authentication principle). As the tests
        may run on different machines at the same time we can not use static host addresses. The provided function localHostAddress() reads
        the local host name dynamically at runtime.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"address"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:localHostAddress()"</span>/&gt;</pre><p>A possible value is either the host name as used in DNS entry or an IP address value:</p><p>address = <span class="emphasis"><em>&lt;192.168.2.100&gt;</em></span></p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="validation-matchers"></a>Chapter&nbsp;17.&nbsp;Validation matchers</h2></div></div></div><p>Message validation in Citrus is essential. The framework offers several validation mechanisms for different message types and formats. 
    With test variables we are able to check for simple value equality. We ensure that message entries are equal to predefined expected values. Validation 
    matchers add powerful assertion functionality on top of that. You just can use the predefined validation matcher functionalities in order to perform 
    more complex assertions like <span class="emphasis"><em>contains</em></span> or <span class="emphasis"><em>isNumber</em></span> in your validation statements.</p><p>The following sections describe the Citrus default validation matcher implementations that are ready for usage. The matcher implementations should cover the
    basic assertions on character sequences and numbers. Of course you can add custom validation matcher implementations in order to meet your very specific validation 
    assertions, too.</p><p>First of all let us have a look at a validation matcher statement in action so we understand how to use them in a test case.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;RequestMessage&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;MessageBody&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;Customer&gt;</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;Id&gt;@greaterThan(0)@&lt;/Id&gt;</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;Name&gt;@equalsIgnoreCase('foo')@&lt;/Name&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/Customer&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/MessageBody&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/RequestMessage&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">]]&gt;</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/data&gt;</span>
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/message&gt;</span></pre><p>The listing above describes a normal message validation block inside a receive test action. We use some inline message payload template as CDATA. As you know Citrus will compare the
    actual message payload to this expected template in DOM tree comparison. In addition to that you can simply include validation matcher statements. The message element <span class="emphasis"><em>Id</em></span> 
    is automatically validated to be a number greater than zero and the <span class="emphasis"><em>Name</em></span> character sequence is supposed to match 'foo' ignoring case spelling considerations.</p><p>Please note the special validation matcher syntax. The statements are surrounded with '@' markers and are identified by some unique name. The optional parameters passed to the matcher 
    implementation state the expected values to match.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>You can use validation matchers with all validation mechanisms - not only with XML validation. Plaintext, JSON, SQL result set validation are also supported.</p></td></tr></table></div><p>See now the following sections describing the default validation matchers in Citrus.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-matcher-xml"></a>17.1.&nbsp;matchesXml()</h2></div></div></div><p>The XML validation matcher implementation is the possibly most exciting one, as we can validate nested XML with full validation power (e.g. ignoring elements, variable support). The
        matcher checks a nested XML fragment to compare against expected XML. For instance we receive following XML message payload for validation:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">GetCustomerMessage</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">CustomerDetails</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Id</span>&gt;5&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Id</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Name</span>&gt;Christoph&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Name</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Configuration</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;config&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;premium&gt;true&lt;/premium&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;last-login&gt;2012-02-24T23:34:23&lt;/last-login&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;link&gt;http://www.citrusframework.org/customer/5&lt;/link&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/config&gt;</span>
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">]]&gt;&lt;/Configuration&gt;</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/CustomerDetails&gt;</span>
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/GetCustomerMessage&gt;</span></pre><p>As you can see the message payload contains some configuration as nested XML data in a CDATA section. We could validate this CDATA section as static character sequence comparison, true. But 
        the &lt;last-login&gt; timestamp changes its value continuously. This breaks the static validation for CDATA elements in XML. Fortunately the new XML validation matcher provides a solution for us:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;GetCustomerMessage&gt;</span>
                  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;CustomerDetails&gt;</span>
                      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;Id&gt;5&lt;/Id&gt;</span>
                      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;Name&gt;Christoph&lt;/Name&gt;</span>
                      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;Configuration&gt;citrus:cdataSection('@matchesXml('&lt;config&gt;</span>
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;premium&gt;${isPremium}&lt;/premium&gt;</span>
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;last-login&gt;@ignore@&lt;/last-login&gt;</span>
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;link&gt;http://www.citrusframework.org/customer/5&lt;/link&gt;</span>
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/config&gt;')@')&lt;/Configuration&gt;</span>
                  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/CustomerDetails&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/GetCustomerMessage&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">]]&gt;</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/data&gt;</span>
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/message&gt;</span></pre><p>With the validation matcher you are able to validate the nested XML with full validation power. Ignoring elements is possible and we can also use variables in our control XML.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">Nested CDATA elements within other CDATA sections are not allowed by XML standard. This is why we create the nested CDATA section on the fly with the function cdataSection().</td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-matcher-equals"></a>17.2.&nbsp;equalsIgnoreCase()</h2></div></div></div><p>This matcher implementation checks for equality without any case spelling considerations. The matcher expects a single parameter as the expected character sequence 
        to check for.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;@equalsIgnoreCase('foo')@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-matcher-contains"></a>17.3.&nbsp;contains()</h2></div></div></div><p>This matcher searches for a character sequence inside the actual value. If the character sequence is not found somewhere the matcher starts complaining.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;@contains('foo')@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;</pre><p>The validation matcher also exist in a case insensitive variant.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;@containsIgnoreCase('foo')@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-matcher-startswith"></a>17.4.&nbsp;startsWith()</h2></div></div></div><p>The matcher implementation asserts that the given value starts with a character sequence otherwise the matcher will arise some error.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;@startsWith('foo')@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-matcher-endswith"></a>17.5.&nbsp;endsWith()</h2></div></div></div><p>Ends with matcher validates a value to end with a given character sequence.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;@endsWith('foo')@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-matcher-matches"></a>17.6.&nbsp;matches()</h2></div></div></div><p>You can check a value to meet a regular expression with this validation matcher. This is for instance very useful for email address 
        validation.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;@matches('[a-z0-9]')@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-matcher-datepattern"></a>17.7.&nbsp;matchesDatePattern()</h2></div></div></div><p>Date values are always difficult to check for equality. Especially when you have millisecond timestamps to deal with. Therefore the date pattern validation 
        matcher should have some improvement for you. You simply validate the date format pattern instead of checking for total equality.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;@matchesDatePattern('yyyy-MM-dd')@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;</pre><p>The example listing uses a date format pattern that is expected. The actual date value is parsed according to this pattern and may cause errors in case the 
        value is no valid date matching the desired format.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-matcher-isnumber"></a>17.8.&nbsp;isNumber()</h2></div></div></div><p>Checking on values to be of numeric nature is essential. The actual value must be a numeric number otherwise the matcher raises errors. The matcher implementation
        does not evaluate any parameters.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;@isNumber()@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-matcher-lowerthan"></a>17.9.&nbsp;lowerThan()</h2></div></div></div><p>This matcher checks a number to be lower than a given threshold value.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;@lowerThan(5)@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-matcher-greaterthan"></a>17.10.&nbsp;greaterThan()</h2></div></div></div><p>The matcher implementation will check on numeric values to be greater than a minimum value.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;@greaterThan(5)@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;</pre></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="testsuite"></a>Chapter&nbsp;18.&nbsp;Actions before/after the test run</h2></div></div></div><p>A test framework should also provide the functionality to do some work before and after the test run. You could think of 
    preparing/deleting the data in a database or starting/stopping a server in this section before/after a test run. These tasks fit 
    best into the initialization and cleanup phases of Citrus. All you have to do is add some Spring bean definitions to the Citrus 
    application context.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="testsuite-before"></a>18.1.&nbsp;Before suite</h2></div></div></div><p>You can influence the behavior of a test run in the initialization phase actually before the tests are executed. 
        See the next code example to find out how it works with actions that take place before the first test is executed:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.container.SequenceBeforeSuite"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"actions"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">list</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">!-- list of actions before suite --</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/list</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.container.SequenceBeforeSuite"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"actions"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">list</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"initDatabase"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.actions.ExecuteSQLAction"</span>&gt;
                  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"dataSource"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">ref</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testDataSource"</span>/&gt;
                  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"statements"</span>&gt;
                      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">list</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;CREATE TABLE PERSON (ID integer, NAME char(250))&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
                      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/list</span>&gt;
                  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/list</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>We access the database and create a table PERSON which is obviously needed in our test cases. You can think of several actions here to prepare the database for instance.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Citrus offers special startup and shutdown actions that may start and stop server implementations automatically. This might 
            be helpful when dealing with Http servers or WebService containers like Jetty. You can also think of starting/stopping a 
            JMS broker before a test run.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="testsuite-after"></a>18.2.&nbsp;After suite</h2></div></div></div><p>A test run may require the test environment to be clean. Therefore it is a good idea to purge all JMS destinations
        or clean up the database after the test run in order to avoid errors in follow-up test runs. Just like we prepared some data in actions before suite we can clean up the test run 
        in actions after the tests are finished. The Spring bean syntax here is not significantly different to those in before suite section:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.container.SequenceAfterSuite"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"actions"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">list</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">!-- list of actions after suite --</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/list</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.container.SequenceAfterSuite"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"actions"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">list</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"initDatabase"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.actions.ExecuteSQLAction"</span>&gt;
                  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"dataSource"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">ref</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testDataSource"</span>/&gt;
                  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"statements"</span>&gt;
                      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">list</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;DELETE FROM TABLE PERSON&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
                      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/list</span>&gt;
                  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/list</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>We just remove all data from the database so we do not influence follow-up tests. Quite simple isn't it!?</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="testsuite-before-test"></a>18.3.&nbsp;Before test</h2></div></div></div><p>Before each test is executed it also might sound reasonable to purge all JMS queues for instance. In case a previous test fails some messages might be left in the JMS queues. 
        Also the database might be in dirty state. The follow-up test then will be confronted with these invalid messages and data. Purging all JMS destinations before a test is therefore a 
        good idea. Just like we prepared some data in actions before suite we can clean up the data before a test starts to execute.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.container.SequenceBeforeTest"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"actions"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">list</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">!-- list of actions before test --</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/list</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.container.SequenceBeforeTest"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"actions"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">list</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ref</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">bean</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"purgeJmsQueues"</span>/&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/list</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="tibco"></a>Chapter&nbsp;19.&nbsp;TIBCO support</h2></div></div></div><p>The Citrus framework was designed to also connect to several TIBCO software components. The outcome is a group of
    special test actions that enable the tester to connect to the TIBCO components and execute operations towards TIBCO.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tibco-hawk"></a>19.1.&nbsp;Connecting with TIBCO Hawk</h2></div></div></div><p>TIBCO uses the enterprise monitoring tool Hawk to manage and supervise all TIBCO applications. Citrus can access Hawk
        to affect the TIBCO service instances. You can start or stop BusinessWorks process archives and process starters for instance.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Use TIBCO Hawk in order to prepare the TIBCO environment according
            to the test that will be executed (unit or integration tests).</p></td></tr></table></div><p>The next example shows how the Hawk agent can be used in the test suite setup.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">parent</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"tibcoHawkAgent"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"methodName"</span> 
                 <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"ResumeProcessStarter"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"methodParameters"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">list</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"COM.TIBCO.hawk.talon.DataElement"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor-arg</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"ProcessDefinition"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor-arg</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Test/UnitTest/BusinessServiceTester.process"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/list</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>The example shows a method call to a Hawk agent. The method is declared through the methodName
        property. In the above example the Hawk agent will resume a particular process starter. The
        methodParameters property will cause the process starter to resume.</p><p>In general the HawkAgent has the following properties:</p><div class="itemizedlist"><ul type="disc"><li><p>microAgent -&gt; <code class="literal">COM.TIBCO.ADAPTER.bwengine.&lt;hawk.domain&gt;.&lt;hawk.service.instance&gt;.&lt;hawk.process.archive&gt;</code></p></li><li><p>hawkDomain</p></li><li><p>rvService (e.g. 57500)</p></li><li><p>rvNetwork</p></li><li><p>rvDaemon (e.g. tcp:57500)</p></li></ul></div><p>The microAgentID consists of the Hawk domain, the service instance and the process archive. With the
        right setting of the domain the service and the daemon you can now use all methods offered by the
        specific MicroAgent.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tibco-collaborator"></a>19.2.&nbsp;Connecting with TIBCO Collaborator Workflow Server</h2></div></div></div><p>Similar to the Hawk agent it is useful to start and stop certain workflow jobs in the TIBCO Collaborator
        Workflow Server, especially for clean up reasons. Left over workflows from previous test runs will then get
        terminated correctly.</p><p>The test framework offers a special action implementation, in order to clean up all available workflow jobs on
        the Workflow Collaborator Server.</p><p>The bean looks like follows:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"cleanIcJobs"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.actions.CleanIcJobsBean"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"userName"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${ic.username}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"password"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${ic.password}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"serverName"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${ic.servername}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"service"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${ic.tibrv.service}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"network"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${ic.tibrv.network}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"daemon"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${ic.tibrv.daemon}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"queueCount"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${ic.tibrv.queue.count}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"serverDiscoveryTimeout"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${ic.tibrv.server.discovery.timeout}"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>The properties of that bean do all refer to the connection credentials of the Workflow InConcert Server instance.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="schema-validation"></a>Chapter&nbsp;20.&nbsp;XML schema validation</h2></div></div></div><p>There are several possibilities to describe the structure of XML documents. The two most popular ways are DTD 
    (Document type definition) and XSD (XML Schema definition). Once a XML document has decided to be classified using a schema 
    definition the structure of the document has to fit the predefined rules inside the schema definition. XML document instances 
    are valid only in case they meet all these structure rules defined in the schema definition. 
    Currently Citrus can validate XML documents using the schema languages DTD and XSD.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xsd-validation"></a>20.1.&nbsp;XSD schema validation</h2></div></div></div><p>Citrus handles XML schema definitions in order to validate incoming XML documents. Consequential the message receiving 
        actions have to know the respective XML schema (*.xsd) file resources to do so. This is done through a central schema repository
        which holds all available XML schema files for a project.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"schemaRepository"</span> 
         <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.xml.XsdSchemaRepository"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"schemas"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">list</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.xml.xsd.SimpleXsdSchema"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"xsd"</span> 
                     <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:citrus/flightbooking/TravelAgencySchema.xsd"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.xml.xsd.SimpleXsdSchema"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"xsd"</span> 
                     <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:citrus/flightbooking/AirlineSchema.xsd"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/list</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>By convention the schema repository instance is defined in the Citrus Spring configuration with the id "schemaRepository".
        Spring is then able to inject this schema repository instance into every message receiving action. The receiving action receives 
        XML messages and will ask the repository for a matching schema definition file in order to validate the document structure.</p><p>The connection between XML messages and xsd schema files is done with a mapping strategy which we will discuss later in this chapter. By default
        Citrus picks the right schema using the target namespace that is defined inside a schema definition. The target namespace of the schema definition has to
        match the namespace of the root element in the received XML message. Using this central schema repository you do not have to wire XML messages and schema 
        files together every time within your test. This is done automatically within the schema repository. All you need to do is defin all schema definition files inside
        the schema repository.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>In case Citrus receives a classified XML message using namespaces Citrus will try to validate the structure of the message 
            by default. Consequently you will also get errors in case no matching schema definition file is found inside the schema 
            repository. So if you explicitly do not want to validate the XML schema for some reason you have to disable the validation
            explicitly in your test.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"getCustomerRequestReceiver"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">schema-validation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"false"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//ns2:RequestMessage/ns2:MessageHeader/ns2:RequestTag"</span> 
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${requestTag}"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//ns2:RequestMessage/ns2:MessageHeader/ns2:CorrelationId"</span> 
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">namespace</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">prefix</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"ns2"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrus/default"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Operation"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"GetCustomer"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"RequestTag"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${requestTag}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>This way might sound annoying for you but in our opinion it is very important to validate the structure of the received 
            XML messages, so disabling the schema validation should not be the standard for all tests. Disabling automatic schema validation
            should only apply to special situations.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="schema-mapping-strategy"></a>20.2.&nbsp;Schema mapping strategy</h2></div></div></div><p>The schema repository in Citrus holds one to many schema definition files and dynamically picks up the right one according to the validated message payload.
        The repository needs to have some strategy for deciding which schema definition to choose. See the following schema mapping strategies and decide which of them is suitable
        for you.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="target-namespace-strategy"></a>20.2.1.&nbsp;Target Namespace Mapping Strategy</h3></div></div></div><p>This is the default schema mapping strategy. Schema definitions usually define some target namespace which is valid for all elements and types inside the schema file.
            The target namespace is also used as root namespace in XML message payloads. According to this information Citrus can pick up the right schema definition file in the schema
            repository. You can set the schema mapping strategy as property in the configuration files:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"schemaRepository"</span> 
         <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.xml.XsdSchemaRepository"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"schemaMappingStrategy"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.xml.schema.TargetNamespaceSchemaMappingStrategy"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"schemas"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">list</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.xml.xsd.SimpleXsdSchema"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"xsd"</span> 
                     <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:citrus/samples/sayHello.xsd"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/list</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>The <span class="emphasis"><em>sayHello.xsd</em></span> schema file defines a target namespace (http://consol.de/schemas/sayHello.xsd):</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">xs:schema</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xs</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2001/XMLSchema"</span>
     <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://consol.de/schemas/sayHello.xsd"</span>
     <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">targetNamespace</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://consol.de/schemas/sayHello.xsd"</span>
     <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">elementFormDefault</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"qualified"</span>
     <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">attributeFormDefault</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"unqualified"</span>&gt;
     
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/xs:schema</span>&gt;</pre><p>Incoming request messages should also have the target namespace set in the root element and this is how Citrus matches
            the right schema file in the repository.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">HelloRequest</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://consol.de/schemas/sayHello.xsd"</span>&gt;
   &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">MessageId</span>&gt;123456789&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/MessageId</span>&gt;
   &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">CorrelationId</span>&gt;1000&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/CorrelationId</span>&gt;
   &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">User</span>&gt;Christoph&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/User</span>&gt;
   &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Text</span>&gt;Hello Citrus&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Text</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/HelloRequest</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="root-qname-strategy"></a>20.2.2.&nbsp;Root QName Mapping Strategy</h3></div></div></div><p>The next possibility for mapping incoming request messages to a schema definition is via the XML root element QName. Each XML message
            payload starts with a root element that usually declares the type of a XML message. According to this root element you can set up mappings in the schema repository.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"schemaRepository"</span> 
         <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.xml.XsdSchemaRepository"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"schemaMappingStrategy"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.xml.schema.RootQNameSchemaMappingStrategy"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"mappings"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">map</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">entry</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">key</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"HelloRequest"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloSchema"</span>/&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">entry</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">key</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"GoodbyeRequest"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"goodbyeSchema"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/map</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"schemas"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">list</span>&gt;
            &gt;ref bean="helloSchema"/&gt;
            &gt;ref bean="goodbyeSchema"/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/list</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloSchema"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.xml.xsd.SimpleXsdSchema"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"xsd"</span> 
         <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:citrus/samples/sayHello.xsd"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"goodbyeSchema"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.xml.xsd.SimpleXsdSchema"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"xsd"</span> 
         <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:citrus/samples/sayGoodbye.xsd"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>The programlisting above defines two root qname mappings - one for <span class="emphasis"><em>HelloRequest</em></span> and one for <span class="emphasis"><em>GoodbyeRequest</em></span> message types.
            An incoming message of type &lt;HelloRequest&gt; is then mapped to the respective schema and so on. With this dedicated mappings you are able to control which schema is used on
            a XML request, regardless of target namespace definitions.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="schema-mapping-chain"></a>20.2.3.&nbsp;Schema mapping strategy chain</h3></div></div></div><p>Let's discuss the possibility to combine several schema mapping strategies in a logical chain. You can define more than one mapping strategy that are
            evaluated in sequence. The first strategy to find a proper schema definition file in the repository wins.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"schemaRepository"</span> 
         <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.xml.XsdSchemaRepository"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"schemaMappingStrategy"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.xml.schema.SchemaMappingStrategyChain"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"strategies"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">list</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.xml.schema.RootQNameSchemaMappingStrategy"</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"mappings"</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">map</span>&gt;
                                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">entry</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">key</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"HelloRequest"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloSchema"</span>/&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/map</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.xml.schema.TargetNamespaceSchemaMappingStrategy"</span>/&gt;                
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/list</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"schemas"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">list</span>&gt;
            &gt;ref bean="helloSchema"/&gt;
            &gt;ref bean="goodbyeSchema"/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/list</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>So the schema mapping chain uses both <span class="emphasis"><em>RootQNameSchemaMappingStrategy</em></span> and <span class="emphasis"><em>TargetNamespaceSchemaMappingStrategy</em></span> in combination.
            In case the first root qname strategy fails to find a proper mapping the next target namespace strategy comes in and tries to find a proper schema.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="schema-definition-overrule"></a>20.3.&nbsp;Schema definition overruling</h2></div></div></div><p>Now it is time to talk about schema definition settings on test action level. We have learned before that Citrus tries to automatically find a matching schema definition
        in some schema repository. There comes a time where you as a tester just have to pick the right schema definition by yourself. You can overrule all schema mapping strategies in Citrus
        by directly setting the desired schema in your receiving message action.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"getCustomerRequestReceiver"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">schema</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloSchema"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//ns2:RequestMessage/ns2:MessageHeader/ns2:RequestTag"</span> 
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${requestTag}"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//ns2:RequestMessage/ns2:MessageHeader/ns2:CorrelationId"</span> 
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">namespace</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">prefix</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"ns2"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrus/default"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloSchema"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.xml.xsd.SimpleXsdSchema"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"xsd"</span> 
         <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:citrus/samples/sayHello.xsd"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>In the example above the tester explicitly sets a schema definition in the receive action (schema="helloSchema"). The attribute value refers to named schema bean 
        somewhere in the applciation context. This overrules all schema mapping strategies used in the central schema repository as the given schema is directly used for validation. This feature 
        is helpful when dealing with different schema versions at the same time where the schema repository can not help you anymore.</p><p>Another possibility would be to set a custom schema repository at this point. This means you can have more than one schema repository in your Citrus project 
        and you pick the right one by yourself in the receive action.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"getCustomerRequestReceiver"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">schema-repository</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"mySpecialSchemaRepository"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//ns2:RequestMessage/ns2:MessageHeader/ns2:RequestTag"</span> 
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${requestTag}"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//ns2:RequestMessage/ns2:MessageHeader/ns2:CorrelationId"</span> 
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">namespace</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">prefix</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"ns2"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrus/default"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>The <span class="emphasis"><em>schema-repository</em></span> attribute refers to a bean of type <span class="emphasis"><em>com.consol.citrus.xml.XsdSchemaRepository</em></span> somewhere in the applicaiton context.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>In case you have several schema repositories in your project do always define a default repository (name="schemaRepository"). This helps Citrus to always find at least
            one repository to consult with.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dtd-validation"></a>20.4.&nbsp;DTD validation</h2></div></div></div><p>XML DTD (Document type definition) is another way to validate the structure of a XML document. Many people say that DTD is
        deprecated and XML schema is the much more efficient way to describe the rules of a XML structure. We do not disagree with that, but
        we also know that legacy systems might still use DTD. So in order to avoid validation errors we have to deal with DTD validation
        as well.</p><p>First thing you can do about DTD validation is to specify an inline DTD in your expected message template.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"getTestMessageReceiver"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">schema-validation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"false"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;!DOCTYPE</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">root</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">[</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;!ELEMENT</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">root</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">(message)&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;!ELEMENT</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">(text)&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;!ELEMENT</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">text</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">(#PCDATA)&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">]&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;root&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;message&gt;</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;text&gt;Hello</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">TestFramework!&lt;/text&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/message&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/root&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">]]&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;data/&gt;</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/message&gt;</span>
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/receive&gt;</span></pre><p>The system under test may also send the message with a inline DTD definition. So validation will succeed.</p><p>In most cases the DTD is referenced as external .dtd file resource. You can do this in your expected message 
        template as well.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"getTestMessageReceiver"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">schema-validation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"false"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;!DOCTYPE</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">root</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">SYSTEM</span> 
                         <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">"com/consol/citrus/validation/example.dtd"&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;root&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;message&gt;</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;text&gt;Hello</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">TestFramework!&lt;/text&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/message&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/root&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">]]&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;data/&gt;</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/message&gt;</span>
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/receive&gt;</span></pre></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="meta-info"></a>Chapter&nbsp;21.&nbsp;Customize meta information</h2></div></div></div><p>Test cases in Citrus are usually provided with some meta information like the author&#8217;s name or the 
    date of creation. In Citrus you are able to extend this test case meta information with your own very specific
    criteria.</p><p>By default a test case comes shipped with meta information that looks like this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"PwdChange_OK_1_Test"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">meta-info</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">author</span>&gt;Christoph&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/author</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">creationdate</span>&gt;2010-01-18&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/creationdate</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">status</span>&gt;FINAL&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/status</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">last-updated-by</span>&gt;Christoph&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/last-updated-by</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">last-updated-on</span>&gt;2010-01-18T15:00:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/last-updated-on</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/meta-info</span>&gt;
 
    [...]
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>You can quite easily add data to this section in order to meet your individual testing strategy. 
    Let us have a simple example to show how it is done.</p><p>First of all we define a custom XSD schema describing the new elements:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">schema</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2001/XMLSchema"</span>  
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:tns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/samples/my-testcase-info"</span> 
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">targetNamespace</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/samples/my-testcase-info"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">elementFormDefault</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"qualified"</span>&gt;
 
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"requirement"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"string"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"pre-condition"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"string"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"result"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"string"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classification"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"string"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/schema</span>&gt;</pre><p>We have four simple elements (<span class="emphasis"><em>requirement</em></span>, <span class="emphasis"><em>pre-condition</em></span>, <span class="emphasis"><em>result</em></span> 
    and <span class="emphasis"><em>classification</em></span>) all typed as string. These new elements later go into the test case meta information section.</p><p>After we added the new XML schema file to the classpath of our project we need to announce the schema to Spring. As you might
    know already a Citrus test case is nothing else but a simple Spring configuration file with customized XML schema support. If we add new elements
    to a test case Spring needs to know the XML schema for parsing the test case configuration file. See the <span class="emphasis"><em>spring.schemas</em></span> file 
    usually placed in the META-INF/spring.schemas in your project.</p><p>The file content for our example will look like follows:</p><pre class="programlisting">http://www.citrusframework.org/samples/my-testcase-info/my-testcase-info.xsd=com/consol/citrus/schemas/my-testcase-info.xsd</pre><p>So now we are finally ready to use the new meta-info elements inside the test case:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">spring:beans</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/testcase"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:spring</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans"</span> 
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:custom</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/samples/my-testcase-info"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xsi</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans 
      http://www.springframework.org/schema/beans/spring-beans.xsd
      http://www.citrusframework.org/schema/testcase 
      http://www.citrusframework.org/schema/testcase/citrus-testcase.xsd 
      http://www.citrusframework.org/samples/my-testcase-info 
      http://www.citrusframework.org/samples/my-testcase-info/my-testcase-info.xsd"</span>&gt;
 
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"PwdChange_OK_1_Test"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">meta-info</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">author</span>&gt;Christoph&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/author</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">creationdate</span>&gt;2010-01-18&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/creationdate</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">status</span>&gt;FINAL&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/status</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">last-updated-by</span>&gt;Christoph&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/last-updated-by</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">last-updated-on</span>&gt;2010-01-18T15:00:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/last-updated-on</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">custom:requirement</span>&gt;REQ10001&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/custom:requirement</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">custom:pre-condition</span>&gt;Existing user, sufficient rights&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/custom:pre-condition</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">custom:result</span>&gt;Password reset in database&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/custom:result</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">custom:classification</span>&gt;PasswordChange&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/custom:classification</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/meta-info</span>&gt;
 
        [...]
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/spring:beans</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">We use a separate namespace declaration with a custom namespace prefix &#8220;custom&#8221; in order to declare the new XML schema to our test case.
    Of course you can pick a namespace url and prefix that fits best for your project.</td></tr></table></div><p>As you see it is quite easy to add custom meta information to your Citrus test case. The customized elements may be precious for automatic reporting. 
    XSL transformations for instance are able to read those meta information elements in order to generate automatic test reports and documentation.</p><p>You can also declare our new XML schema in the Eclipse preferences section as user specific XML catalog entry. Then even the schema code completion 
    in your Eclipse XML editor will be available for our customized meta-info elements.</p></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="debug-messages"></a>Chapter&nbsp;22.&nbsp;Debugging received messages</h2></div></div></div><p>Citrus will receive a lot of messages during a test run. The user may want to persist these messages to the 
    filesystem for further investigations.</p><p>Citrus offers an easy way to debug all received messages to the file system. You need to enable a specific aspect in the
    Citrus Spring configuration.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.aop.StoreMessageInterceptorAspect"</span>/&gt;</pre><p>Just add this bean to the Spring configuration and Citrus will debug received messages to the file system by generating files
    containing the message header and message body content.</p><p>For example:</p><p><code class="literal">logs/debug/messages/message1.header</code></p><p><code class="literal">logs/debug/messages/message1.body</code></p><p><code class="literal">logs/debug/messages/message2.header</code></p><p><code class="literal">logs/debug/messages/message2.body</code></p><p>The framework uses a simple counter that is increased whenever a message is written to the file system. Citrus separates 
    message header and message body into extra files with respective extension (".header" and ".body"). By default the debug directory is 
    <code class="literal">logs/debug/messages/</code> relative to the project root directory. But you can set your own debug directory in the 
    configuration.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.aop.StoreMessageInterceptorAspect"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"debugDirectory"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"debugging/messages"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>As the file counter is always reset to 0 after a test run the message files may be overwritten. So you eventually need to 
        save the generated message debug files before running another group of test cases.</p></td></tr></table></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="reporting"></a>Chapter&nbsp;23.&nbsp;Reporting and test results</h2></div></div></div><p>The framework generates different reports and results after a test run for you. These report and result pages will
    help you to get an overview of the test cases that were executed and which one were failing.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="reporting-logging"></a>23.1.&nbsp;Console logging</h2></div></div></div><p>During the test run the framework will provide a huge amount of information that is printed out to
        the console. This includes current test progress, validation results and error information. This
        enables the user to quickly supervise the test run progress. Failures in tests will be printed to the
        console just the time the error occurred. The detailed stack trace information and the detailed
        error messages are helpful to get the idea what went wrong.</p><p>As the console output might be limited to a defined buffer limit, the user may not be able to
        follow the output to the very beginning of the test run. Therefore the framework additionally
        prints all information to a log file according to the logging configuration.</p><p>The logging mechanism uses the SLF4J logging framework. SLF4J is independent of logging framework implementations on the 
        market. So in case you use Log4J logging framework the specified log file path as well as logging levels can be freely configured 
        in the respective log4j.xml file in your project. At the end of a test run the combined test results get printed to both console 
        and log file. The overall test results look like following example:</p><pre class="programlisting">
CITRUS TEST RESULTS

  [...]
  HelloService_Ok_1             : SUCCESS
  HelloService_Ok_2             : SUCCESS
  EchoService_Ok_1              : SUCCESS
  EchoService_Ok_2              : SUCCESS
  EchoService_TempError_1       : SUCCESS
  EchoService_AutomacticRetry_1 : SUCCESS
  [...]
  
  Found 175 test cases to execute
  Skipped 0 test cases (0.0%)
  Executed 175 test cases
  Tests failed:         0 (0.0%)
  Tests successfully: 175 (100.0%)</pre><p>Failed tests will be marked as failed in the result list. The framework will give a short description
        of the error cause while the detailed stack trace information can be found in the log messages
        that were made during the test run.</p><pre class="programlisting">HelloService_Ok_3 : failed - Exception is Action timed out</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="reporting-junit"></a>23.2.&nbsp;JUnit reports</h2></div></div></div><p>As tests are executed as TestNG test cases, the framework will also generate JUnit compliant XML and HTML 
        reports. JUnit test reports are very popular and find support in many build management and development tools. 
        In general the Citrus test reports give you an overall picture of all tests and tell you which of them were failing.</p><p>Build management tools like Hudson, Bamboo or CruiseControl can easily import and display the generated JUnit 
        XML results. Please have a look at the TestNG and JUnit documentation for more information about this topic as well 
        as the build management tools (Hudson, Bamboo, CruiseControl, etc.) to find out how to integrate the tests results.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="reporting-html"></a>23.3.&nbsp;HTML reports</h2></div></div></div><p>Citrus creates HTML reports after each test run. The report provides detailed information on the test run with a summary of all
        test results. You can find the report after a test run in the <code class="literal">target/test-output/citrus-reports</code> directory.</p><p>The report consists of two parts. The test summary on top shows the total number executed tests. The main part lists all test cases 
        with detailed information. With this report you immediately identify all tests that were failing. Each test case is marked in color 
        according to its result outcome.</p><p>The failed tests give detailed error information with error messages and Java StackTrace information. In addition to that the report 
        tries to find the test action inside the XML test part that failed in execution. With the failing code snippet you can see where the test stopped.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>JavaScript should be active in your web browser. This is to enable the detailed information which comes to you in form of tooltips
            like test author or description. If you want to access the tooltips JavaScript should be enabled in your browser.</p></td></tr></table></div></div></div><div class="appendix" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="samples"></a>Appendix&nbsp;A.&nbsp;Citrus Samples</h2></div></div></div><p>This part will show you some sample applications that are tested using Citrus integration tests. 
        See below a list of all samples.</p><div class="itemizedlist"><ul type="disc"><li><p><a href="#samples-flightbooking" title="A.1.&nbsp;The FlightBooking sample">Section&nbsp;A.1, &#8220;The FlightBooking sample&#8221;</a></p></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="samples-flightbooking"></a>A.1.&nbsp;The FlightBooking sample</h2></div></div></div><p>A simple project example should give you the idea how Citrus works. The system under test is a flight booking service that 
    handles travel requests from a travel agency. A travel request consists of a complete travel route including several flights. The 
    FlightBookingService application will split the complete travel booking into separate flight bookings that are sent to the respective
    airlines in charge. The booking and customer data is persisted in a database.</p><p>The airlines will confirm or deny the flight bookings. The FlightBookingService application consolidates all incoming flight 
    confirmations and combines them to a complete travel confirmation or denial that is sent back to the travel agency. Next picture
    tries to put the architecture into graphics:</p><p>
      </p><div class="mediaobject" align="center"><img src="images/samples/flightbooking/architecture_overview.jpg" align="middle"></div><p>
    </p><p>In our example two different airlines are connected to the FlightBookingService application: the SmartAriline over JMS and
    the RoyalAirline over Http.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="samples-flightbooking-usecase"></a>A.1.1.&nbsp;The use case</h3></div></div></div><p>The use case that we would like to test is quite simple. The test should handle a simple travel booking and expect a positive
        processing to the end. The test case neither simulates business errors nor technical problems. Next picture shows the use case
        as a sequence diagram.</p><p>
          </p><div class="mediaobject" align="center"><img src="images/samples/flightbooking/sequence_diagram.jpg" align="middle"></div><p>
        </p><p>The travel agency puts a travel booking request towards the system. The travel booking contains two seperate flights. The
        flight requests are published to the airlines (SmartAirline and RoyalAirline). Both airlines confirm the flight bookings with a positive
        answer. The consolidated travel booking response is then sent back to the travel agency.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="samples-flightbooking-configuration"></a>A.1.2.&nbsp;Configure the simulated systems</h3></div></div></div><p>Citrus simulates all surrounding applications in their behavior during the test. The simulated applications are:
        TravelAgency, SmartAirline and RoyalAirline. The simulated systems have to be configured in the Citrus configuration first.
        The configuration is done in Spring XML configuration files, as Citrus uses Spring to glue all its services together.</p><p>First of all we have a look at the TravelAgency configuration. The TravelAgency is using JMS to connect to our tested system, so
        we need to configure this JMS connection in Citrus.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"connectionFactory"</span> 
         <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.apache.activemq.ActiveMQConnectionFactory"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"brokerURL"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"tcp://localhost:61616"</span> /&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:jms-message-sender</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"travelAgencyBookingRequestSender"</span> 
                      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${travel.agency.request.queue}"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:jms-message-receiver</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"travelAgencyBookingResponseReceiver"</span> 
                      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${travel.agency.response.queue}"</span>/&gt;</pre><p>This is all Citrus needs to send and receive messages over JMS in order to simulate the TravelAgency. By default all JMS message
        senders and receivers need a connection factory. Therefore Citrus is searching for a bean named "connectionFactory". In the example
        we connect to a ActiveMQ message broker. A connection to other JMS brokers like TIBCO EMS or IBM Websphere MQ is possible too by
        simply changing the connection factory implementation.</p><p>The identifiers of the message senders and receivers are very important. We should think of suitable ids that give the
        reader a first hint what the sender/receiver is used for. As we want to simulate the TravelAgency in combination with sending
        booking requests our id is "travelAgencyBookingRequestSender" for example.</p><p>The sender and receivers do also need a JMS destination. Here the destination names are provided by property expressions.
        The Spring IoC container resolves the properties for us. All we need to do is publish the property file to the Spring container
        like this.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"propertyLoader"</span> 
   <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"locations"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">list</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;citrus.properties&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/list</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"ignoreUnresolvablePlaceholders"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>The citrus.properties file is located in our project's resources folder and defines the actual queue names besides
        other properties of course:</p><pre class="programlisting">#JMS queues
travel.agency.request.queue=Travel.Agency.Request.Queue
travel.agency.response.queue=Travel.Agency.Response.Queue
smart.airline.request.queue=Smart.Airline.Request.Queue
smart.airline.response.queue=Smart.Airline.Response.Queue
royal.airline.request.queue=Royal.Airline.Request.Queue</pre><p>What else do we need in our Spring configuration? There are some basic beans that are commonly defined in a Citrus
        application but I do not want to bore you with these details. So if you want to have a look at the "citrus-context.xml" 
        file in the resources folder and see how things are defined there.</p><p>We continue with the first airline to be configured the SmartAirline. The SmartAirline is also using JMS to communicate
        with the FlightBookingService. So there is nothing new for us, we simply define additional JMS message senders and receivers.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:jms-message-receiver</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"smartAirlineBookingRequestReceiver"</span> 
                      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${smart.airline.request.queue}"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:jms-message-sender</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"smartAirlineBookingResponseSender"</span> 
                      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${smart.airline.response.queue}"</span>/&gt;</pre><p>We do not define a new JMS connection factory because TravelAgency and SmartAirline are using the same message broker instance.
        In case you need to handle multiple connection factories simply define the connection factory with the attribute "connection-factory".</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:jms-message-receiver</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"smartAirlineBookingRequestReceiver"</span> 
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${smart.airline.request.queue}"</span>
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">connection-factory</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"smartAirlineConnectionFactory"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:jms-message-sender</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"smartAirlineBookingResponseSender"</span> 
                          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${smart.airline.response.queue}"</span>
                          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">connection-factory</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"smartAirlineConnectionFactory"</span>/&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="samples-flightbooking-http"></a>A.1.3.&nbsp;Configure the Http adapter</h3></div></div></div><p>The RoyalAirline is connected to our system using Http request/response communication. This means we have to simulate a Http server
        in the test that accepts client requests and provides proper responses. Citrus offers a Http server implementation that will listen on a
        port for client requests. The adapter forwards incoming request to the test engine over JMS and receives a proper response that is 
        forwarded as a Http response to the client. The next picture shows this mechanism in detail.</p><p>
          </p><div class="mediaobject" align="center"><img src="images/samples/flightbooking/http_adapter.jpg" align="middle"></div><p>
        </p><p>The RoyalAirline adapter receives client requsts over Http and sends them over JMS to a message receiver as we alredy know it. The
        test engine validates the received request and provides a proper response back to the adapter. The adapter will transform the response 
        to Http again and publishes it to the calling client. Citrus offers these kind of adapters for Http and SOAP communication. By writing 
        your own adapters like this you will be able to extend Citrus so it works with protocols that are not supported yet.</p><p>Let us define the Http adapter in the Spring configuration:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-http:server</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"royalAirlineHttpServer"</span> 
                       <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">port</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"8091"</span> 
                       <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">uri</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"/flightbooking"</span> 
                       <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message-handler</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jmsForwardingMessageHandler"</span>/&gt;
        
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jmsForwardingMessageHandler"</span> 
         <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.adapter.handler.JmsConnectingMessageHandler"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"destinationName"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${royal.airline.request.queue}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"connectionFactory"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">ref</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"connectionFactory"</span> /&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"replyTimeout"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"2000"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;        
                    
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:jms-sync-message-receiver</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"royalAirlineBookingRequestReceiver"</span> 
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${royal.airline.request.queue}"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:jms-reply-message-sender</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"royalAirlineBookingResponseSender"</span> 
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">reply-destination-holder</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"royalAirlineBookingRequestReceiver"</span>/&gt;</pre><p>We need to configure a Http server instance with a port, a request URI and a message handler. We define the
        JMS forwarding message handler to handle request as described. In Addition to the message handler we also need synchrpnous JMS
        message sender and receiver instances. That's it! We are able to receive Http request in order to simulate the RoyalAirline
        application. What is missing now? The test case definition itself.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="samples-flightbooking-testcase"></a>A.1.4.&nbsp;The test case</h3></div></div></div><p>The test case definition is also a Spring configuration file. Citrus offers a customized XML syntax to define a test case.
        This XML test defining language is supposed to be easy to understand and more specific to the domain we are dealing with. Next listing
        shows the whole test case definition. Keep in mind that a test case defines every step in the use case. So we define sending and 
        receiving actions of the use case as described in the sequence diagram we saw earlier.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">spring:beans</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/testcase"</span> 
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:spring</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans"</span> 
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xsi</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span> 
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans 
             http://www.springframework.org/schema/beans/spring-beans.xsd 
             http://www.citrusframework.org/schema/testcase 
             http://www.citrusframework.org/schema/testcase/citrus-testcase.xsd"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"FlightBookingTest"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">meta-info</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">author</span>&gt;Christoph Deppisch&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/author</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">creationdate</span>&gt;2009-04-15&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/creationdate</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">status</span>&gt;FINAL&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/status</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">last-updated-by</span>&gt;Christoph Deppisch&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/last-updated-by</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">last-updated-on</span>&gt;2009-04-15T00:00:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/last-updated-on</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/meta-info</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">description</span>&gt;
            Test flight booking service.
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/description</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"correlationId"</span> 
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:concat('Lx1x', 'citrus:randomNumber(10)')"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"customerId"</span> 
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:concat('Mx1x', citrus:randomNumber(10))"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"travelAgencyBookingRequestSender"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
                      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;TravelBookingRequestMessage</span> 
                          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.com/schemas/TravelAgency"</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">correlationId</span>&gt;${correlationId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/correlationId</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">customer</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">id</span>&gt;${customerId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/id</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">firstname</span>&gt;John&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/firstname</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">lastname</span>&gt;Doe&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/lastname</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/customer</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flights</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flight</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flightId</span>&gt;SM 1269&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flightId</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">airline</span>&gt;SmartAirline&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/airline</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">fromAirport</span>&gt;MUC&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/fromAirport</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">toAirport</span>&gt;FRA&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/toAirport</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">date</span>&gt;2009-04-15&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/date</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scheduledDeparture</span>&gt;11:55:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scheduledDeparture</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scheduledArrival</span>&gt;13:00:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scheduledArrival</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flight</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flight</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flightId</span>&gt;RA 1780&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flightId</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">airline</span>&gt;RoyalAirline&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/airline</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">fromAirport</span>&gt;FRA&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/fromAirport</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">toAirport</span>&gt;HAM&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/toAirport</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">date</span>&gt;2009-04-15&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/date</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scheduledDeparture</span>&gt;16:00:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scheduledDeparture</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scheduledArrival</span>&gt;17:10:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scheduledArrival</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flight</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flights</span>&gt;                                
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/TravelBookingRequestMessage</span>&gt;
                      ]]&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"correlationId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;
            
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"smartAirlineBookingRequestReceiver"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
                      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;FlightBookingRequestMessage</span> 
                          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.com/schemas/AirlineSchema"</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">correlationId</span>&gt;${correlationId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/correlationId</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bookingId</span>&gt;???&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bookingId</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">customer</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">id</span>&gt;${customerId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/id</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">firstname</span>&gt;John&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/firstname</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">lastname</span>&gt;Doe&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/lastname</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/customer</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flight</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flightId</span>&gt;SM 1269&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flightId</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">airline</span>&gt;SmartAirline&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/airline</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">fromAirport</span>&gt;MUC&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/fromAirport</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">toAirport</span>&gt;FRA&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/toAirport</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">date</span>&gt;2009-04-15&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/date</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scheduledDeparture</span>&gt;11:55:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scheduledDeparture</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scheduledArrival</span>&gt;13:00:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scheduledArrival</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flight</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/FlightBookingRequestMessage</span>&gt;
                      ]]&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ignore</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//:FlightBookingRequestMessage/:bookingId"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"correlationId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">extract</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//:FlightBookingRequestMessage/:bookingId"</span> 
                                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">variable</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${smartAirlineBookingId}"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/extract</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;
            
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"smartAirlineBookingResponseSender"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
                      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;FlightBookingConfirmationMessage</span> 
                          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.com/schemas/AirlineSchema"</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">correlationId</span>&gt;${correlationId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/correlationId</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bookingId</span>&gt;${smartAirlineBookingId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bookingId</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">success</span>&gt;true&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/success</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flight</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flightId</span>&gt;SM 1269&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flightId</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">airline</span>&gt;SmartAirline&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/airline</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">fromAirport</span>&gt;MUC&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/fromAirport</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">toAirport</span>&gt;FRA&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/toAirport</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">date</span>&gt;2009-04-15&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/date</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scheduledDeparture</span>&gt;11:55:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scheduledDeparture</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scheduledArrival</span>&gt;13:00:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scheduledArrival</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flight</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/FlightBookingConfirmationMessage</span>&gt;
                      ]]&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"correlationId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;
            
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"royalAirlineBookingRequestReceiver"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
                      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;FlightBookingRequestMessage</span> 
                          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.com/schemas/FlightBooking/AirlineSchema"</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">correlationId</span>&gt;${correlationId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/correlationId</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bookingId</span>&gt;???&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bookingId</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">customer</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">id</span>&gt;${customerId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/id</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">firstname</span>&gt;John&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/firstname</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">lastname</span>&gt;Doe&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/lastname</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/customer</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flight</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flightId</span>&gt;RA 1780&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flightId</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">airline</span>&gt;RoyalAirline&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/airline</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">fromAirport</span>&gt;FRA&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/fromAirport</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">toAirport</span>&gt;HAM&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/toAirport</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">date</span>&gt;2009-04-15&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/date</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scheduledDeparture</span>&gt;16:00:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scheduledDeparture</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scheduledArrival</span>&gt;17:10:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scheduledArrival</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flight</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/FlightBookingRequestMessage</span>&gt;
                      ]]&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ignore</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//:FlightBookingRequestMessage/:bookingId"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"correlationId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">extract</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//:FlightBookingRequestMessage/:bookingId"</span> 
                                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">variable</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${royalAirlineBookingId}"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/extract</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;
            
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"royalAirlineBookingResponseSender"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
                      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;FlightBookingConfirmationMessage</span> 
                          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.com/schemas/AirlineSchema"</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">correlationId</span>&gt;${correlationId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/correlationId</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bookingId</span>&gt;${royalAirlineBookingId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bookingId</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">success</span>&gt;true&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/success</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flight</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flightId</span>&gt;RA 1780&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flightId</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">airline</span>&gt;RoyalAirline&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/airline</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">fromAirport</span>&gt;FRA&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/fromAirport</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">toAirport</span>&gt;HAM&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/toAirport</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">date</span>&gt;2009-04-15&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/date</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scheduledDeparture</span>&gt;16:00:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scheduledDeparture</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scheduledArrival</span>&gt;17:10:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scheduledArrival</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flight</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/FlightBookingConfirmationMessage</span>&gt;
                      ]]&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"correlationid"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;
            
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">with</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"travelAgencyBookingResponseReceiver"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
                      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;TravelBookingResponseMessage</span> 
                          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.com/schemas/TravelAgency"</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">correlationId</span>&gt;${correlationId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/correlationId</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">success</span>&gt;true&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/success</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flights</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flight</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flightId</span>&gt;SM 1269&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flightId</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">airline</span>&gt;SmartAirline&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/airline</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">fromAirport</span>&gt;MUC&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/fromAirport</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">toAirport</span>&gt;FRA&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/toAirport</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">date</span>&gt;2009-04-15&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/date</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scheduledDeparture</span>&gt;11:55:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scheduledDeparture</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scheduledArrival</span>&gt;13:00:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scheduledArrival</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flight</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flight</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flightId</span>&gt;RA 1780&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flightId</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">airline</span>&gt;RoyalAirline&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/airline</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">fromAirport</span>&gt;FRA&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/fromAirport</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">toAirport</span>&gt;HAM&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/toAirport</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">date</span>&gt;2009-04-15&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/date</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scheduledDeparture</span>&gt;16:00:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scheduledDeparture</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scheduledArrival</span>&gt;17:10:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scheduledArrival</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flight</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flights</span>&gt;                                
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/TravelBookingResponseMessage</span>&gt;
                      ]]&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"correlationId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;
            
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/spring:beans</span>&gt;</pre><p>Similar to a sequence diagram the test case describes every step of the use case. At the very beginning the test case gets
        name and its meta information. Following with the variable values that are used all over the test. Here it is the correlationId 
        and the customerId that are used as test variables. Inside message templates header values the variables are referenced several
        times in the test</p><p><code class="literal">&lt;correlationId&gt;${correlationId}&lt;/correlationId&gt;</code></p><p><code class="literal">&lt;id&gt;${customerId}&lt;/id&gt;</code></p><p>The sending/receiving actions use a previously defined message sender/receiver. This is the link between test case and basic 
        Spring configuration we have done before.</p><p><code class="literal">&lt;send with="travelAgencyBookingRequestSender"&gt;</code></p><p>The sending action chooses a message sender to actually send the message using a message transport (JMS, Http, SOAP, etc.).
        After sending this first "TravelBookingRequestMessage" request the test case expects the first "FlightBookingRequestMessage" 
        message on the SmartAirline JMS destination. In case this message is not arriving in time the test will fail with errors.
        In positive case our FlightBookingService works well and the message arrives in time. The received message is validated against
        a defined expected message template. Only in case all content validation steps are successful the test continues with the action
        chain. And so the test case proceeeds and works through the use case until every message is sent respectively received and 
        validated. The use case is done automatically without human interaction. Citrus simulates all surrounding applications and 
        provides detailed validation possibilities of messages.</p></div></div></div></div></body></html>