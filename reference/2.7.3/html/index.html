<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<meta name="author" content="Christoph Deppisch, Martin Maher">
<title>Citrus</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:initial}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px 0}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:.4em .75em 0 .75em;line-height:1;vertical-align:top}
.colist>table tr>td:first-of-type img{max-width:initial}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
<style>

    h1, h2, h3, h4, h5, h6, #toctitle {
        color: #3b73af;
    }

    div#toctitle {
        content: url("images/citrus-logo-tiny.png");
    }

    #content h1>a.link, h2>a.link, h3>a.link, #toctitle>a.link, .sidebarblock>.content>.title>a.link, h4>a.link, h5>a.link, h6>a.link {
      color: #3b73af;
      text-decoration: none;
    }

    #content h1>a.link:hover, h2>a.link:hover, h3>a.link:hover, #toctitle>a.link:hover, .sidebarblock>.content>.title>a.link:hover, h4>a.link:hover, h5>a.link:hover, h6>a.link:hover {
      color: #3b73af;
    }

</style>
</head>
<body id="citrus" class="book toc2 toc-left">
<div id="header">
<h1>Citrus</h1>
<div class="details">
<span id="author" class="author">Christoph Deppisch</span><br>
<span id="author2" class="author">Martin Maher</span><br>
<span id="revnumber">version 2.7.3,</span>
<span id="revdate">2018-01-15</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">citrus</div>
<ul class="sectlevel1">
<li><a href="#preface">1. Preface</a></li>
<li><a href="#changes-new">2. What&#8217;s new in Citrus 2.7?!</a>
<ul class="sectlevel2">
<li><a href="#changes-plaintext-ignore">2.1. Ignore sections in plain text</a></li>
<li><a href="#changes-json-schema-validation">2.2. Json schema validation</a></li>
<li><a href="#changes-junit5">2.3. JUnit5 support</a></li>
<li><a href="#changes-db-transactions">2.4. Database transaction handling</a></li>
<li><a href="#changes-environment-settings">2.5. Environment settings</a></li>
<li><a href="#changes-http-cookies">2.6. Http cookie support</a></li>
<li><a href="#changes-file-encoding">2.7. File resource encoding</a></li>
<li><a href="#changes-java-8">2.8. Java 8</a></li>
<li><a href="#changes-kubernetes">2.9. Kubernetes support</a></li>
<li><a href="#changes-selenium">2.10. Selenium support</a></li>
<li><a href="#changes-before-after-suite">2.11. Environment based before/after suite</a></li>
<li><a href="#wsaddressing-header-customization">2.12. WsAddressing header customization</a></li>
<li><a href="#changes-jsonpath-data-dictionary">2.13. JsonPath data dictionary</a></li>
<li><a href="#changes-java-dsl-test-behavior">2.14. Java DSL test behavior</a></li>
<li><a href="#changes-auto-select-message-type">2.15. Auto select message type</a></li>
<li><a href="#changes-default-cucumber-steps">2.16. Default Cucumber steps</a></li>
<li><a href="#changes-refactoring">2.17. Refactoring</a></li>
<li><a href="#changes-bugfixes">2.18. Bugfixes</a></li>
</ul>
</li>
<li><a href="#introduction">3. Introduction</a>
<ul class="sectlevel2">
<li><a href="#overview">3.1. Overview</a></li>
<li><a href="#usage-scenarios">3.2. Usage scenarios</a></li>
</ul>
</li>
<li><a href="#setup">4. Setup</a>
<ul class="sectlevel2">
<li><a href="#using-maven">4.1. Using Maven</a>
<ul class="sectlevel3">
<li><a href="#maven-archetypes">4.1.1. Maven archetype</a></li>
<li><a href="#existing-maven-projects">4.1.2. Existing Maven projects</a></li>
</ul>
</li>
<li><a href="#using-gradle">4.2. Using Gradle</a>
<ul class="sectlevel3">
<li><a href="#gradle-configuration">4.2.1. Configuration</a></li>
<li><a href="#gradle-run">4.2.2. Run with Gradle</a></li>
</ul>
</li>
<li><a href="#using-ant">4.3. Using Ant</a>
<ul class="sectlevel3">
<li><a href="#preconditions">4.3.1. Preconditions</a></li>
<li><a href="#download">4.3.2. Download</a></li>
<li><a href="#installation">4.3.3. Installation</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#test-cases">5. Test cases</a>
<ul class="sectlevel2">
<li><a href="#writing-test-cases-in-xml">5.1. Writing test cases in XML</a></li>
<li><a href="#writing-test-cases-in-java">5.2. Writing test cases in Java</a></li>
<li><a href="#java-dsl-test-designer">5.3. Java DSL test designer</a></li>
<li><a href="#java-dsl-test-runner">5.4. Java DSL test runner</a></li>
<li><a href="#test-resource-injection">5.5. Designer/Runner injection</a></li>
<li><a href="#test-context-injection">5.6. Test context injection</a></li>
<li><a href="#java-dsl-test-behaviors">5.7. Java DSL test behaviors</a></li>
<li><a href="#description">5.8. Description</a></li>
<li><a href="#test-actions">5.9. Test Actions</a></li>
<li><a href="#finally-test-section">5.10. Finally test section</a></li>
<li><a href="#test-meta-information">5.11. Test meta information</a></li>
</ul>
</li>
<li><a href="#test-variables">6. Test variables</a>
<ul class="sectlevel2">
<li><a href="#global-variables">6.1. Global variables</a></li>
<li><a href="#create-variables-with-cdata">6.2. Create variables with CDATA</a></li>
<li><a href="#create-variables-with-groovy">6.3. Create variables with Groovy</a></li>
<li><a href="#escaping-variables-expression">6.4. Escaping variables expression</a></li>
</ul>
</li>
<li><a href="#running-tests">7. Running tests</a>
<ul class="sectlevel2">
<li><a href="#run-with-testng">7.1. Run with TestNG</a></li>
<li><a href="#using-testng-dataproviders">7.2. Using TestNG DataProviders</a></li>
<li><a href="#run-with-junit5">7.3. Run with JUnit5</a></li>
<li><a href="#run-with-junit4">7.4. Run with JUnit4</a></li>
<li><a href="#run-xml-tests">7.5. Running XML tests</a></li>
</ul>
</li>
<li><a href="#configuration">8. Configuration</a>
<ul class="sectlevel2">
<li><a href="#application-environment-settings">8.1. Application environment settings</a></li>
<li><a href="#application-property-file">8.2. Application property file</a></li>
<li><a href="#spring-xml-application-context">8.3. Spring XML application context</a></li>
<li><a href="#spring-java-config">8.4. Spring Java config</a></li>
</ul>
</li>
<li><a href="#endpoints">9. Endpoints</a>
<ul class="sectlevel2">
<li><a href="#send-messages-with-endpoints">9.1. Send messages with endpoints</a></li>
<li><a href="#receive-messages-with-endpoints">9.2. Receive messages with endpoints</a></li>
<li><a href="#local-message-store">9.3. Local message store</a></li>
</ul>
</li>
<li><a href="#message-validation">10. Message validation</a>
<ul class="sectlevel2">
<li><a href="#xml-message-validation">10.1. XML message validation</a>
<ul class="sectlevel3">
<li><a href="#xml-payload-validation">10.1.1. XML payload validation</a></li>
<li><a href="#xml-header-validation">10.1.2. XML header validation</a></li>
</ul>
</li>
<li><a href="#xml-ignore">10.2. Ignore XML elements</a>
<ul class="sectlevel3">
<li><a href="#customize-xml-parser-and-serializer">10.2.1. Customize XML parser and serializer</a></li>
<li><a href="#groovy-xml-validation">10.2.2. Groovy XML validation</a></li>
</ul>
</li>
<li><a href="#json-message-validation">10.3. JSON message validation</a></li>
<li><a href="#schema-validation">10.4. Schema validation</a>
<ul class="sectlevel3">
<li><a href="#managing-schemas">10.4.1. Managing schemas</a></li>
<li><a href="#schema-definition-overruling">10.4.2. Schema definition overruling</a></li>
<li><a href="#xml-schema-validation">10.4.3. XML schema validation</a></li>
<li><a href="#json-schema-validation">10.4.4. JSON schema validation</a></li>
<li><a href="#json-schema-repositories">10.4.5. JSON schema repositories</a></li>
<li><a href="#json-schema-filtering-and-validation-strategy">10.4.6. JSON schema filtering and validation strategy</a></li>
</ul>
</li>
<li><a href="#xhtml-message-validation">10.5. XHTML message validation</a></li>
<li><a href="#plain-text-message-validation">10.6. Plain text message validation</a>
<ul class="sectlevel3">
<li><a href="#plain-text-validation-whitespaces">10.6.1. Whitespace characters</a></li>
<li><a href="#plain-text-validation-ignore">10.6.2. Ignoring text parts</a></li>
<li><a href="#plain-text-validation-variables">10.6.3. Creating variables</a></li>
</ul>
</li>
<li><a href="#binary-message-validation">10.7. Binary message validation</a></li>
<li><a href="#gzip-message-validation">10.8. Gzip message validation</a></li>
<li><a href="#java-dsl-validation-callbacks">10.9. Java DSL validation callbacks</a></li>
<li><a href="#customize-message-validators">10.10. Customize message validators</a></li>
</ul>
</li>
<li><a href="#xpath">11. Using XPath</a>
<ul class="sectlevel2">
<li><a href="#manipulate-with-xpath">11.1. Manipulate with XPath</a></li>
<li><a href="#xpath-validation">11.2. Validate with XPath</a></li>
<li><a href="#extract-variables-with-xpath">11.3. Extract variables with XPath</a></li>
<li><a href="#xml-namespaces-in-xpath">11.4. XML namespaces in XPath</a></li>
<li><a href="#default-namespaces-in-xpath">11.5. Default namespaces in XPath</a></li>
</ul>
</li>
<li><a href="#jsonpath">12. Using JSONPath</a>
<ul class="sectlevel2">
<li><a href="#manipulate-with-jsonpath">12.1. Manipulate with JSONPath</a></li>
<li><a href="#validate-with-jsonpath">12.2. Validate with JSONPath</a></li>
<li><a href="#extract-variables-with-jsonpath">12.3. Extract variables with JSONPath</a></li>
<li><a href="#ignore-with-jsonpath">12.4. Ignore with JSONPath</a></li>
</ul>
</li>
<li><a href="#actions">13. Test actions</a>
<ul class="sectlevel2">
<li><a href="#actions-send">13.1. Sending messages</a></li>
<li><a href="#actions-receive">13.2. Receive messages</a>
<ul class="sectlevel3">
<li><a href="#validate-message-payloads">13.2.1. Validate message payloads</a></li>
<li><a href="#validate-message-headers">13.2.2. Validate message headers</a></li>
<li><a href="#message-selectors">13.2.3. Message selectors</a></li>
<li><a href="#groovy-markupbuilder">13.2.4. Groovy MarkupBuilder</a></li>
</ul>
</li>
<li><a href="#actions-sql">13.3. Database actions</a>
<ul class="sectlevel3">
<li><a href="#sql-update-insert-delete">13.3.1. SQL update, insert, delete</a></li>
<li><a href="#sql-query">13.3.2. SQL query</a></li>
<li><a href="#sql-transaction-management">13.3.3. Transaction management</a></li>
<li><a href="#groovy-sql-result-set-validation">13.3.4. Groovy SQL result set validation</a></li>
<li><a href="#save-result-set-values">13.3.5. Save result set values</a></li>
</ul>
</li>
<li><a href="#actions-sleep">13.4. Sleep</a></li>
<li><a href="#actions-java">13.5. Java</a></li>
<li><a href="#actions-receive-timeout">13.6. Receive timeout</a></li>
<li><a href="#actions-echo">13.7. Echo</a></li>
<li><a href="#actions-stop-time">13.8. Stop time</a></li>
<li><a href="#actions-create-variables">13.9. Create variables</a></li>
<li><a href="#actions-trace-variables">13.10. Trace variables</a></li>
<li><a href="#actions-transform">13.11. Transform</a></li>
<li><a href="#actions-groovy">13.12. Groovy script execution</a></li>
<li><a href="#actions-fail">13.13. Failing the test</a></li>
<li><a href="#actions-input">13.14. Input</a></li>
<li><a href="#actions-load">13.15. Load</a></li>
<li><a href="#actions-wait">13.16. Wait</a></li>
<li><a href="#actions-purging-jms-destinations">13.17. Purging JMS destinations</a></li>
<li><a href="#actions-purging-message-channels">13.18. Purging message channels</a></li>
<li><a href="#actions-purging-endpoints">13.19. Purging endpoints</a></li>
<li><a href="#actions-assert-failure">13.20. Assert failure</a></li>
<li><a href="#actions-catch-exceptions">13.21. Catch exceptions</a></li>
<li><a href="#actions-ant-build">13.22. Apache Ant build</a></li>
<li><a href="#actions-start-stop">13.23. Start/Stop server</a></li>
<li><a href="#actions-stop-timer">13.24. Stop Timer</a></li>
<li><a href="#actions-custom">13.25. Custom test actions</a></li>
</ul>
</li>
<li><a href="#templates">14. Templates</a></li>
<li><a href="#test-behavior">15. Test behaviors</a>
<ul class="sectlevel2">
<li><a href="#behavior-types">15.1. Behavior types</a></li>
</ul>
</li>
<li><a href="#containers">16. Containers</a>
<ul class="sectlevel2">
<li><a href="#containers-sequential">16.1. Sequential</a></li>
<li><a href="#containers-conditional">16.2. Conditional</a></li>
<li><a href="#containers-parallel">16.3. Parallel</a></li>
<li><a href="#containers-iterate">16.4. Iterate</a></li>
<li><a href="#containers-repeat-until-true">16.5. Repeat until true</a></li>
<li><a href="#containers-repeat-on-error-until-true">16.6. Repeat on error until true</a></li>
<li><a href="#containers-timer">16.7. Timer</a></li>
<li><a href="#containers-custom">16.8. Custom containers</a></li>
</ul>
</li>
<li><a href="#jms">17. JMS support</a>
<ul class="sectlevel2">
<li><a href="#jms-endpoints">17.1. JMS endpoints</a></li>
<li><a href="#jms-synchronous-endpoints">17.2. JMS synchronous endpoints</a></li>
<li><a href="#jms-topics">17.3. JMS topics</a></li>
<li><a href="#jms-message-headers">17.4. JMS message headers</a></li>
<li><a href="#dynamic-destination-names">17.5. Dynamic destination names</a></li>
<li><a href="#soap-over-jms">17.6. SOAP over JMS</a></li>
</ul>
</li>
<li><a href="#http-rest">18. HTTP REST support</a>
<ul class="sectlevel2">
<li><a href="#http-rest-client">18.1. HTTP REST client</a></li>
<li><a href="#http-client-interceptors">18.2. HTTP client interceptors</a></li>
<li><a href="#http-rest-server">18.3. HTTP REST server</a></li>
<li><a href="#http-headers">18.4. HTTP headers</a></li>
<li><a href="#http-server-interceptors">18.5. HTTP server interceptors</a></li>
<li><a href="#http-form-urlencoded-data">18.6. HTTP form urlencoded data</a></li>
<li><a href="#http-error-handling">18.7. HTTP error handling</a></li>
<li><a href="#http-client-basic-authentication">18.8. HTTP client basic authentication</a></li>
<li><a href="#http-server-basic-authentication">18.9. HTTP server basic authentication</a></li>
<li><a href="#http-cookies">18.10. HTTP cookies</a></li>
<li><a href="#http-gzip-compression">18.11. HTTP Gzip compression</a></li>
<li><a href="#http-servlet-filters">18.12. HTTP servlet filters</a></li>
<li><a href="#http-servlet-context-customization">18.13. HTTP servlet context customization</a></li>
</ul>
</li>
<li><a href="#websocket">19. WebSocket support</a>
<ul class="sectlevel2">
<li><a href="#websocket-client">19.1. WebSocket client</a></li>
<li><a href="#websocket-server-endpoints">19.2. WebSocket server endpoints</a></li>
<li><a href="#websocket-headers">19.3. WebSocket headers</a></li>
</ul>
</li>
<li><a href="#soap-webservices">20. SOAP WebServices</a>
<ul class="sectlevel2">
<li><a href="#soap-client">20.1. SOAP client</a></li>
<li><a href="#soap-client-interceptors">20.2. SOAP client interceptors</a></li>
<li><a href="#soap-server">20.3. SOAP server</a></li>
<li><a href="#soap-send-and-receive">20.4. SOAP send and receive</a></li>
<li><a href="#soap-headers">20.5. SOAP headers</a></li>
<li><a href="#soap-http-mime-headers">20.6. SOAP HTTP mime headers</a></li>
<li><a href="#soap-envelope-handling">20.7. SOAP Envelope handling</a></li>
<li><a href="#soap-server-interceptors">20.8. SOAP server interceptors</a></li>
<li><a href="#soap-1-2">20.9. SOAP 1.2</a></li>
<li><a href="#soap-faults">20.10. SOAP faults</a></li>
<li><a href="#send-soap-faults">20.11. Send SOAP faults</a></li>
<li><a href="#receive-soap-faults">20.12. Receive SOAP faults</a></li>
<li><a href="#multiple-soap-fault-details">20.13. Multiple SOAP fault details</a></li>
<li><a href="#send-http-error-codes-with-soap">20.14. Send HTTP error codes with SOAP</a></li>
<li><a href="#soap-attachment">20.15. SOAP attachment support</a></li>
<li><a href="#send-soap-attachments">20.16. Send SOAP attachments</a></li>
<li><a href="#receive-soap-attachments">20.17. Receive SOAP attachments</a></li>
<li><a href="#soap-mtom">20.18. SOAP MTOM support</a></li>
<li><a href="#soap-client-basic-authentication">20.19. SOAP client basic authentication</a></li>
<li><a href="#soap-server-basic-authentication">20.20. SOAP server basic authentication</a></li>
<li><a href="#ws-addressing">20.21. WS-Addressing support</a></li>
<li><a href="#soap-client-fork-mode">20.22. SOAP client fork mode</a></li>
<li><a href="#soap-servlet-context-customization">20.23. SOAP servlet context customization</a></li>
</ul>
</li>
<li><a href="#ftp">21. FTP support</a>
<ul class="sectlevel2">
<li><a href="#ftp-client">21.1. FTP client</a></li>
<li><a href="#ftp-server">21.2. FTP server</a></li>
</ul>
</li>
<li><a href="#message-channels">22. Message channel support</a>
<ul class="sectlevel2">
<li><a href="#channel-endpoint">22.1. Channel endpoint</a></li>
<li><a href="#synchronous-channel-endpoints">22.2. Synchronous channel endpoints</a></li>
<li><a href="#message-channel-selector">22.3. Message selectors on channels</a></li>
<li><a href="#root-qname-message-selector">22.4. Root QName Message Selector</a></li>
<li><a href="#xpath-evaluating-message-selector">22.5. XPath Evaluating Message Selector</a></li>
</ul>
</li>
<li><a href="#file">23. File support</a>
<ul class="sectlevel2">
<li><a href="#write-files">23.1. Write files</a></li>
<li><a href="#read-files">23.2. Read files</a></li>
</ul>
</li>
<li><a href="#apache-camel">24. Apache Camel support</a>
<ul class="sectlevel2">
<li><a href="#camel-endpoint">24.1. Camel endpoint</a></li>
<li><a href="#synchronous-camel-endpoint">24.2. Synchronous Camel endpoint</a></li>
<li><a href="#camel-exchange-headers">24.3. Camel exchange headers</a></li>
<li><a href="#camel-exception-handling">24.4. Camel exception handling</a></li>
<li><a href="#camel-context-handling">24.5. Camel context handling</a></li>
<li><a href="#camel-route-actions">24.6. Camel route actions</a></li>
<li><a href="#camel-controlbus-actions">24.7. Camel controlbus actions</a></li>
</ul>
</li>
<li><a href="#vert-x-event-bus">25. Vert.x event bus support</a>
<ul class="sectlevel2">
<li><a href="#vert-x-endpoint">25.1. Vert.x endpoint</a></li>
<li><a href="#synchronous-vert-x-endpoint">25.2. Synchronous Vert.x endpoint</a></li>
<li><a href="#vert-x-instance-factory">25.3. Vert.x instance factory</a></li>
</ul>
</li>
<li><a href="#mail">26. Mail support</a>
<ul class="sectlevel2">
<li><a href="#mail-client">26.1. Mail client</a></li>
<li><a href="#mail-server">26.2. Mail server</a></li>
</ul>
</li>
<li><a href="#arquillian">27. Arquillian support</a>
<ul class="sectlevel2">
<li><a href="#citrus-arquillian-extension">27.1. Citrus Arquillian extension</a></li>
<li><a href="#client-side-testing">27.2. Client side testing</a></li>
<li><a href="#container-side-testing">27.3. Container side testing</a></li>
<li><a href="#test-runners">27.4. Test runners</a></li>
</ul>
</li>
<li><a href="#docker">28. Docker support</a>
<ul class="sectlevel2">
<li><a href="#docker-client">28.1. Docker client</a></li>
<li><a href="#docker-commands">28.2. Docker commands</a></li>
</ul>
</li>
<li><a href="#kubernetes">29. Kubernetes support</a>
<ul class="sectlevel2">
<li><a href="#kubernetes-client">29.1. Kubernetes client</a></li>
<li><a href="#kubernetes-commands-in-xml">29.2. Kubernetes commands in XML</a></li>
<li><a href="#kubernetes-commands-in-java">29.3. Kubernetes commands in Java</a></li>
<li><a href="#info-command">29.4. Info command</a></li>
<li><a href="#list-resources">29.5. List resources</a></li>
<li><a href="#list-nodes-and-namespaces">29.6. List nodes and namespaces</a></li>
<li><a href="#get-resources">29.7. Get resources</a></li>
<li><a href="#create-resources">29.8. Create resources</a></li>
<li><a href="#delete-resources">29.9. Delete resources</a></li>
<li><a href="#watch-resources">29.10. Watch resources</a></li>
<li><a href="#kubernetes-messaging">29.11. Kubernetes messaging</a></li>
</ul>
</li>
<li><a href="#ssh">30. SSH support</a>
<ul class="sectlevel2">
<li><a href="#ssh-client">30.1. SSH Client</a></li>
<li><a href="#ssh-server">30.2. SSH Server</a></li>
</ul>
</li>
<li><a href="#rmi">31. RMI support</a>
<ul class="sectlevel2">
<li><a href="#rmi-client">31.1. RMI client</a></li>
<li><a href="#rmi-server">31.2. RMI server</a></li>
</ul>
</li>
<li><a href="#jmx">32. JMX support</a>
<ul class="sectlevel2">
<li><a href="#jmx-client">32.1. JMX client</a></li>
<li><a href="#jmx-server">32.2. JMX server</a></li>
</ul>
</li>
<li><a href="#cucumber">33. Cucumber BDD support</a>
<ul class="sectlevel2">
<li><a href="#cucumber-integration">33.1. Cucumber integration</a></li>
<li><a href="#cucumber-xml-steps">33.2. Cucumber XML steps</a></li>
<li><a href="#cucumber-spring">33.3. Cucumber Spring support</a></li>
<li><a href="#citrus-step-definitions">33.4. Citrus step definitions</a></li>
<li><a href="#variable-steps">33.5. Variable steps</a></li>
<li><a href="#messaging-steps">33.6. Messaging steps</a></li>
<li><a href="#named-messages">33.7. Named messages</a></li>
<li><a href="#message-creator-steps">33.8. Message creator steps</a></li>
<li><a href="#echo-steps">33.9. Echo steps</a></li>
<li><a href="#sleep-steps">33.10. Sleep steps</a></li>
<li><a href="#http-steps">33.11. Http steps</a></li>
<li><a href="#docker-steps">33.12. Docker steps</a></li>
<li><a href="#selenium-steps">33.13. Selenium steps</a></li>
</ul>
</li>
<li><a href="#zookeeper">34. Zookeeper support</a>
<ul class="sectlevel2">
<li><a href="#zookeeper-client">34.1. Zookeeper client</a></li>
<li><a href="#zookeeper-commands">34.2. Zookeeper commands</a></li>
</ul>
</li>
<li><a href="#spring-restdocs">35. Spring Restdocs support</a>
<ul class="sectlevel2">
<li><a href="#spring-restdocs-using-http">35.1. Spring Restdocs using Http</a></li>
<li><a href="#spring-restdocs-using-soap">35.2. Spring Restdocs using SOAP</a></li>
<li><a href="#spring-restdocs-in-java-dsl">35.3. Spring Restdocs in Java DSL</a></li>
</ul>
</li>
<li><a href="#selenium">36. Selenium support</a>
<ul class="sectlevel2">
<li><a href="#selenium-browser">36.1. Selenium browser</a></li>
<li><a href="#selenium-actions">36.2. Selenium actions</a></li>
<li><a href="#start-stop-browser">36.3. Start/stop browser</a></li>
<li><a href="#find">36.4. Find</a></li>
<li><a href="#click">36.5. Click</a></li>
<li><a href="#hover">36.6. Hover</a></li>
<li><a href="#form-input-actions">36.7. Form input actions</a></li>
<li><a href="#page-actions">36.8. Page actions</a></li>
<li><a href="#page-validation">36.9. Page validation</a></li>
<li><a href="#wait">36.10. Wait</a></li>
<li><a href="#navigate">36.11. Navigate</a></li>
<li><a href="#window-actions">36.12. Window actions</a></li>
<li><a href="#alert">36.13. Alert</a></li>
<li><a href="#make-screenshot">36.14. Make screenshot</a></li>
<li><a href="#clear-browser-cache">36.15. Clear browser cache</a></li>
</ul>
</li>
<li><a href="#dynamic-endpoint-components">37. Dynamic endpoint components</a></li>
<li><a href="#endpoint-adapter">38. Endpoint adapter</a>
<ul class="sectlevel2">
<li><a href="#empty-response-endpoint-adapter">38.1. Empty response endpoint adapter</a></li>
<li><a href="#static-response-endpoint-adapter">38.2. Static response endpoint adapter</a></li>
<li><a href="#request-dispatching-endpoint-adapter">38.3. Request dispatching endpoint adapter</a></li>
<li><a href="#channel-endpoint-adapter">38.4. Channel endpoint adapter</a></li>
<li><a href="#jms-endpoint-adapter">38.5. JMS endpoint adapter</a></li>
</ul>
</li>
<li><a href="#functions">39. Functions</a>
<ul class="sectlevel2">
<li><a href="#functions-concat">39.1. concat()</a></li>
<li><a href="#functions-substring">39.2. substring()</a></li>
<li><a href="#functions-stringlength">39.3. stringLength()</a></li>
<li><a href="#functions-translate">39.4. translate()</a></li>
<li><a href="#functions-substring-before">39.5. substringBefore()</a></li>
<li><a href="#functions-substring-after">39.6. substringAfter()</a></li>
<li><a href="#functions-round">39.7. round()</a></li>
<li><a href="#functions-floor">39.8. floor()</a></li>
<li><a href="#functions-ceiling">39.9. ceiling()</a></li>
<li><a href="#functions-random-number">39.10. randomNumber()</a></li>
<li><a href="#functions-random-string">39.11. randomString()</a></li>
<li><a href="#functions-random-enum-value">39.12. randomEnumValue()</a></li>
<li><a href="#functions-current-date">39.13. currentDate()</a></li>
<li><a href="#functions-uppercase">39.14. upperCase()</a></li>
<li><a href="#functions-lowercase">39.15. lowerCase()</a></li>
<li><a href="#functions-average">39.16. average()</a></li>
<li><a href="#functions-minimum">39.17. minimum()</a></li>
<li><a href="#functions-maximum">39.18. maximum()</a></li>
<li><a href="#functions-sum">39.19. sum()</a></li>
<li><a href="#functions-absolute">39.20. absolute()</a></li>
<li><a href="#functions-map-value">39.21. mapValue()</a></li>
<li><a href="#functions-random-uuid">39.22. randomUUID()</a></li>
<li><a href="#functions-encode-base64">39.23. encodeBase64()</a></li>
<li><a href="#functions-decode-base64">39.24. decodeBase64()</a></li>
<li><a href="#functions-escape-xml">39.25. escapeXml()</a></li>
<li><a href="#functions-cdata-section">39.26. cdataSection()</a></li>
<li><a href="#functions-digest-auth-header">39.27. digestAuthHeader()</a></li>
<li><a href="#functions-localhost-address">39.28. localHostAddress()</a></li>
<li><a href="#functions-change-date">39.29. changeDate()</a></li>
<li><a href="#functions-read-file">39.30. readFile()</a></li>
<li><a href="#functions-message">39.31. message()</a></li>
<li><a href="#functions-xpath">39.32. xpath()</a></li>
<li><a href="#functions-jsonpath">39.33. jsonPath()</a></li>
</ul>
</li>
<li><a href="#validation-matcher">40. Validation matcher</a>
<ul class="sectlevel2">
<li><a href="#matcher-ignore">40.1. ignore()</a></li>
<li><a href="#matcher-matches-xml">40.2. matchesXml()</a></li>
<li><a href="#matcher-equals-ignore-case">40.3. equalsIgnoreCase()</a></li>
<li><a href="#matcher-contains">40.4. contains()</a></li>
<li><a href="#matcher-startswith">40.5. startsWith()</a></li>
<li><a href="#matcher-endswith">40.6. endsWith()</a></li>
<li><a href="#matcher-matches">40.7. matches()</a></li>
<li><a href="#matcher-matches-date-pattern">40.8. matchesDatePattern()</a></li>
<li><a href="#matcher-isnumber">40.9. isNumber()</a></li>
<li><a href="#matcher-lowerthan">40.10. lowerThan()</a></li>
<li><a href="#matcher-greaterthan">40.11. greaterThan()</a></li>
<li><a href="#matcher-isweekday">40.12. isWeekday()</a></li>
<li><a href="#matcher-variable">40.13. variable()</a></li>
<li><a href="#matcher-daterange">40.14. dateRange()</a></li>
<li><a href="#matcher-assert-that">40.15. assertThat()</a></li>
</ul>
</li>
<li><a href="#data-dictionaries">41. Data dictionaries</a>
<ul class="sectlevel2">
<li><a href="#xml-data-dictionaries">41.1. XML data dictionaries</a></li>
<li><a href="#json-data-dictionaries">41.2. JSON data dictionaries</a></li>
<li><a href="#dictionary-scopes">41.3. Dictionary scopes</a></li>
<li><a href="#path-mapping-strategies">41.4. Path mapping strategies</a></li>
</ul>
</li>
<li><a href="#test-actors">42. Test actors</a>
<ul class="sectlevel2">
<li><a href="#define-test-actors">42.1. Define test actors</a></li>
<li><a href="#link-test-actors">42.2. Link test actors</a></li>
<li><a href="#disable-test-actors">42.3. Disable test actors</a></li>
</ul>
</li>
<li><a href="#test-suite-actions">43. Test suite actions</a>
<ul class="sectlevel2">
<li><a href="#before-suite">43.1. Before suite</a></li>
<li><a href="#after-suite">43.2. After suite</a></li>
<li><a href="#before-test">43.3. Before test</a></li>
<li><a href="#after-test">43.4. After test</a></li>
</ul>
</li>
<li><a href="#finally-section">44. Finally section</a></li>
<li><a href="#customize-meta-information">45. Customize meta information</a></li>
<li><a href="#tracing-incoming-outgoing-messages">46. Tracing incoming/outgoing messages</a></li>
<li><a href="#reporting-and-test-results">47. Reporting and test results</a>
<ul class="sectlevel2">
<li><a href="#console-logging">47.1. Console logging</a></li>
<li><a href="#junit-reports">47.2. JUnit reports</a></li>
<li><a href="#html-reports">47.3. HTML reports</a></li>
</ul>
</li>
<li><a href="#samples">48. Samples</a>
<ul class="sectlevel2">
<li><a href="#samples-flightbooking">48.1. The FlightBooking sample</a>
<ul class="sectlevel3">
<li><a href="#flightbooking-use-case">48.1.1. The use case</a></li>
<li><a href="#flightbooking-simulated-systems">48.1.2. Configure the simulated systems</a></li>
<li><a href="#flightbooking-http-adapter">48.1.3. Configure the Http adapter</a></li>
<li><a href="#flightbooking-test-case">48.1.4. The test case</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#appendix">49. Appendix</a>
<ul class="sectlevel2">
<li><a href="#changes-2-6">Changes in Citrus 2.6</a>
<ul class="sectlevel3">
<li><a href="#changes-gzip-compression">Gzip compression</a></li>
<li><a href="#changes-custom-servlet-filters">Custom servlet filters</a></li>
<li><a href="#changes-escape-test-variable-syntax">Escape test variable syntax</a></li>
<li><a href="#changes-configurable-xml-serializer">Configurable XML serializer</a></li>
<li><a href="#changes-local-message-store">Local message store</a></li>
<li><a href="#changes-wait-message-condition">Wait message condition</a></li>
<li><a href="#changes-xpath-and-jsonpath-function">Xpath and JsonPath Function</a></li>
<li><a href="#changes-static-response-adapter-variables">Static response adapter variables support</a></li>
<li><a href="#changes-cucumber-bdd">Cucumber BDD support</a></li>
<li><a href="#changes-zookeeper">Zookeeper support</a></li>
<li><a href="#changes-spring-restdocs">Spring Restdocs support</a></li>
<li><a href="#changes-hamcrest-matcher-conditions">Hamcrest matcher conditions</a></li>
<li><a href="#changes-soap-java-dsl">SOAP Java DSL</a></li>
<li><a href="#changes-refactoring">Refactoring</a></li>
</ul>
</li>
<li><a href="#changes-2-5">Changes in Citrus 2.5</a>
<ul class="sectlevel3">
<li><a href="#changes-hamcrest-matcher">Hamcrest matcher support</a></li>
<li><a href="#changes-binary-base64-message-validator">Binary base64 message validator</a></li>
<li><a href="#changes-rmi">RMI support</a></li>
<li><a href="#changes-jmx">JMX support</a></li>
<li><a href="#changes-resource-injection">Resource injection</a></li>
<li><a href="#changes-http-x-www-form-urlencoded-message-validator">Http x-www-form-urlencoded message validator</a></li>
<li><a href="#changes-date-range-validation-matcher">Date range validation matcher</a></li>
<li><a href="#changes-read-file-resource-function">Read file resource function</a></li>
<li><a href="#changes-timer-container">Timer container</a></li>
<li><a href="#changes-upgrade-to-vertx-3-2-0">Upgrade to Vert.x 3.2.0</a></li>
</ul>
</li>
<li><a href="#changes-2-4">Changes in Citrus 2.4</a>
<ul class="sectlevel3">
<li><a href="#changes-docker">Docker support</a></li>
<li><a href="#changes-http-rest-actions">Http REST actions</a></li>
<li><a href="#changes-wait-test-action">Wait test action</a></li>
<li><a href="#changes-camel-actions">Camel actions</a></li>
<li><a href="#changes-purge-endpoints-action">Purge endpoints action</a></li>
<li><a href="#changes-release-to-maven-central">Release to Maven Central</a></li>
</ul>
</li>
<li><a href="#changes-2-3">Changes in Citrus 2.3</a>
<ul class="sectlevel3">
<li><a href="#changes-test-runner-and-test-designer">Test runner and test designer</a></li>
<li><a href="#changes-websocket">WebSocket support</a></li>
<li><a href="#changes-jsonpath">JSONPath support</a></li>
<li><a href="#changes-customize-message-validators">Customize message validators</a></li>
<li><a href="#changes-library-upgrades">Library upgrades</a></li>
<li><a href="#changes-upgrade-from-citrus-2-2">Upgrade from Citrus 2.2</a></li>
<li><a href="#changes-bugfixes">Bugfixes</a></li>
</ul>
</li>
<li><a href="#changes-2-2">Changes in Citrus 2.2</a>
<ul class="sectlevel3">
<li><a href="#changes-arquillian">Arquillian support</a></li>
<li><a href="#changes-junit">JUnit support</a></li>
<li><a href="#changes-start-stop-server-action">Start/Stop server action</a></li>
<li><a href="#changes-citrus-ant-tasks">Citrus Ant tasks</a></li>
<li><a href="#changes-bugfixes">Bugfixes</a></li>
</ul>
</li>
<li><a href="#changes-2-1">Changes in Citrus 2.1</a>
<ul class="sectlevel3">
<li><a href="#changes-soap-mtom">SOAP MTOM support</a></li>
<li><a href="#changes-soap-envelope-handling">SOAP envelope handling</a></li>
<li><a href="#changes-soap-1-2-message-factory">SOAP 1.2 message factory</a></li>
<li><a href="#changes-testng-data-provider-handling">TestNG data provider handling</a></li>
<li><a href="#changes-mail-message-namespace">Mail message namespace</a></li>
<li><a href="#changes-ssh-message-namespace">Ssh message namespace</a></li>
</ul>
</li>
<li><a href="#changes-2-0">Changes in Citrus 2.0</a>
<ul class="sectlevel3">
<li><a href="#changes-refactoring">Refactoring</a></li>
<li><a href="#changes-spring-framework-4-x">Spring framework 4.x</a></li>
<li><a href="#changes-ftp">FTP support</a></li>
<li><a href="#changes-functions-with-test-context-access">Functions with test context access</a></li>
<li><a href="#changes-validation-matcher-with-test-context-access">Validation matcher with test context access</a></li>
<li><a href="#changes-message-listener-with-test-context-access">Message listener with test context access</a></li>
<li><a href="#changes-soap-over-jms">SOAP over JMS</a></li>
<li><a href="#changes-multiple-soap-attachments">Multiple SOAP attachments</a></li>
<li><a href="#changes-multiple-soap-xml-header-fragments">Multiple SOAP XML header fragments</a></li>
<li><a href="#changes-create-variable-validation-matcher">Create variable validation matcher</a></li>
<li><a href="#changes-new-configuration-components">New configuration components</a></li>
<li><a href="#changes-before-after-suite-components">Before/after suite components</a></li>
<li><a href="#changes-citrus-jms-module">Citrus JMS module</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><strong>Copyright © 2018 ConSol Software GmbH</strong><br>
<strong>Version: 2.7.3</strong></p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/citrus-logo-small.png" alt="citrus-logo"></span></p>
</div>
<!-- toc disabled -->
</div>
</div>
<div class="sect1">
<h2 id="preface"><a class="anchor" href="#preface"></a><a class="link" href="#preface">1. Preface</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Integration testing can be very hard, especially when there is no sufficient tool support. Unit testing is flavored with
fantastic tools and APIs like JUnit, TestNG, EasyMock, Mockito and so on. These tools support you in writing automated tests.
A tester who is in charge of integration testing may lack of tool support for automated testing especially when it comes to
simulate messaging interfaces.</p>
</div>
<div class="paragraph">
<p>In a typical enterprise application scenario the test team has to deal with different messaging interfaces and various
transport protocols. Without sufficient tool support the automated integration testing of message-based interactions between
interface partners is exhausting and sometimes barely possible.</p>
</div>
<div class="paragraph">
<p>The tester is forced to simulate several interface partners in an end-to-end integration test. The first thing that comes
to our mind is manual testing. No doubt manual testing is fast. In long term perspective manual testing is time consuming
and causes severe problems regarding maintainability as they are error prone and not repeatable.</p>
</div>
<div class="paragraph">
<p>The Citrus framework gives a complete test automation tool for integration testing of enterprise applications. You can test
your message interfaces to other applications as client and server. Every time a code change applies all automated Citrus
tests ensure the stability of interfaces and message communication.</p>
</div>
<div class="paragraph">
<p>Regression testing and continuous integration is very easy as Citrus fits into your build lifecycle as usual Java unit test.
You can use Citrus with JUnit or TestNG in order to integrate with your application build.</p>
</div>
<div class="paragraph">
<p>With powerful validation capabilities for various message formats like XML, CSV or JSON Citrus is designed to provide fully
automated integration tests for end-to-end use cases. Citrus effectively composes complex messaging use cases with response
generation, error simulation, database interaction and more.</p>
</div>
<div class="paragraph">
<p>This documentation provides a reference guide to all features of the Citrus test framework. It gives a detailed picture of
effective integration testing with automated integration test environments. Since this document is considered to be under
construction, please do not hesitate to give any comments or requests to us using our user or support mailing lists.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="changes-new"><a class="anchor" href="#changes-new"></a><a class="link" href="#changes-new">2. What&#8217;s new in Citrus 2.7?!</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Citrus 2.7 is using Java 8! The Citrus sources are compiled with Java 8 which means that from now on you need at least
Java 8 runtime to work with Citrus. With this Java 8 base Citrus
is proud to welcome two new crew members for supporting Selenium and Kubernetes in tests. Not enough we have the following
features included in the box.</p>
</div>
<div class="sect2">
<h3 id="changes-plaintext-ignore"><a class="anchor" href="#changes-plaintext-ignore"></a><a class="link" href="#changes-plaintext-ignore">2.1. Ignore sections in plain text</a></h3>
<div class="paragraph">
<p>Plain text message validation is usually based on a complete String equals comparison. With latest release we added the possibility to ignore some sections with
well known <code>@ignore@</code> keyword placeholder. The message validator will automatically ignore words or character sections based on that. Read more about this in chapter
<a href="#plain-text-message-validation">plain text message validation</a>.</p>
</div>
<div class="paragraph">
<p>Also possible is the extraction of sections as new test variables when using the <code>@variable()@</code> matcher in the plain text message content.</p>
</div>
</div>
<div class="sect2">
<h3 id="changes-json-schema-validation"><a class="anchor" href="#changes-json-schema-validation"></a><a class="link" href="#changes-json-schema-validation">2.2. Json schema validation</a></h3>
<div class="paragraph">
<p>When dealing with Json message content the latest release allows adding of schema validation. The Json structure is validated with proper schema as of Open API (Swagger) schema rules.
As usual the available schema files are defined in a schema repository in the project configuration. Read more about this in chapter <a href="#json-schema-validation">json schema validation</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="changes-junit5"><a class="anchor" href="#changes-junit5"></a><a class="link" href="#changes-junit5">2.3. JUnit5 support</a></h3>
<div class="paragraph">
<p>With this release you are able to integrate Citrus with JUnit5 the new generation of the famous unit testing framework. We provide a Citrus JUnit5 extension that can do the trick.
Read more about this in chapter <a href="#run-with-junit5">run with JUnit5</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="changes-db-transactions"><a class="anchor" href="#changes-db-transactions"></a><a class="link" href="#changes-db-transactions">2.4. Database transaction handling</a></h3>
<div class="paragraph">
<p>When Citrus accesses data storage in form of SQL statements executed on some datasource the transaction handling has not been set in the past. Each SQL
statement has been committed immediately. Especially when executing multiple SQL statement via script this could lead to inconsistencies. With the new release you
can make use of Spring&#8217;s transaction handling when executing SQL statements with Citrus. You can set a transaction handler with isolation levels and default transaction timeout settings.
This enables you to use transaction blocks for multiple statements with one single commit or rollback. Read more about this in chapter <a href="#sql-transaction-management">actions accessing the database</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="changes-environment-settings"><a class="anchor" href="#changes-environment-settings"></a><a class="link" href="#changes-environment-settings">2.5. Environment settings</a></h3>
<div class="paragraph">
<p>We added a mechanism to overwrite general settings in Citrus via system properties and environment variables. This makes Citrus ready for runtime environments such as Docker and Kubernetes where
you can use environment variables to change Citrus behavior. The available settings and variable names can be seen in chapter <a href="#configuration">configuration</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="changes-http-cookies"><a class="anchor" href="#changes-http-cookies"></a><a class="link" href="#changes-http-cookies">2.6. Http cookie support</a></h3>
<div class="paragraph">
<p>Setting Http cookie related Http headers has been possible in previous versions. We improved that cookie handling in Http request and response messages with a dedicated DSL for adding and verifying cookie information
in Http headers. The Citrus http-server is able to advice the client to set a new cookie with respective <strong>Set-Cookie</strong> headers in response messages. The http-client is able to verify the cookie attributes such as name, value, max-age and so on.
In addition to that the client is able to send the cookie name value pair in further requests as a reference via "<strong>Cookie</strong>" message headers. The complete new cookie handling is described in section <a href="#http-cookies">Http cookie handling</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="changes-file-encoding"><a class="anchor" href="#changes-file-encoding"></a><a class="link" href="#changes-file-encoding">2.7. File resource encoding</a></h3>
<div class="paragraph">
<p>The Citrus test case is able to load file resources in various situations e.g. when defining expected message contents. The file resource encoding and charset used a system-wide default setting which has been settable via system property (<strong>citrus.file.encoding</strong>).
In addition to that we have added the opportunity to overwrite this system-wide setting in each resource read operation. This means that everywhere where it is possible to load a file resource you can explicitly set a file encoding and charset for this read operation.
This enables you to use more than one system-wide file encoding setting when reading data from external file resources in Citrus.</p>
</div>
</div>
<div class="sect2">
<h3 id="changes-java-8"><a class="anchor" href="#changes-java-8"></a><a class="link" href="#changes-java-8">2.8. Java 8</a></h3>
<div class="paragraph">
<p>Citrus is now using Java 8. This is mainly because we need to move on in using latest versions of Spring Framework,
Apache Camel and so on. If you are still stuck on Java 7 you can not update to 2.7 as the Citrus sources are compiled with
Java 8. Please contact us in case you really can not update to Java 8 in your project. We can think of a minor bugfix version
with Citrus 2.6 base that still supports Java 7 runtime. On the bright side we can now use the full power of Lambda expressions
and other Java 8 features in Citrus code base.</p>
</div>
</div>
<div class="sect2">
<h3 id="changes-kubernetes"><a class="anchor" href="#changes-kubernetes"></a><a class="link" href="#changes-kubernetes">2.9. Kubernetes support</a></h3>
<div class="paragraph">
<p>Citrus is now able to interact with <a href="http://kubernetes.io/">Kubernetes</a> remote API in order to manage pods, services and other
resources on the Kubernetes platform. The Kubernetes client is based on the <a href="https://github.com/fabric8io/kubernetes-client">Fabric8 Java client</a>
that interacts with the Kubernetes API via REST services. So you can access Kubernetes resources within Citrus in order to
change or validate the resource state for containerized testing.
This is very useful when dealing with container application environments as part of the integration tests. Please stay tuned
for blog posts and tutorial samples on how Citrus can help you test Microservices with Docker and Kubernetes. The basic usage is
described in section <a href="#kubernetes">kubernetes</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="changes-selenium"><a class="anchor" href="#changes-selenium"></a><a class="link" href="#changes-selenium">2.10. Selenium support</a></h3>
<div class="paragraph">
<p>User interface and browser testing has not been a focus within Citrus integration testing until now that we can integrate
with the famous <a href="http://www.seleniumhq.org/">Selenium</a> UI testing library. Thanks to the great contributions made by the
community - especially by <a href="https://github.com/vdsrd">vdsrd@github</a> - we can use Selenium based actions and features directly
in a Citrus test case. The Citrus Java and XML DSL both provide comfortable access to the Selenium API in order to
simulate user interaction within a browser. The mix of user based actions and Citrus messaging transport simulation gives
complete new ways of handling complex integration scenarios. Read more about this in chapter <a href="#selenium">Selenium</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="changes-before-after-suite"><a class="anchor" href="#changes-before-after-suite"></a><a class="link" href="#changes-before-after-suite">2.11. Environment based before/after suite</a></h3>
<div class="paragraph">
<p>You can enable/disable before and after suite actions based on optional environment or system properties. Users can give
property names or property values that are checked before execution.
Only in case the environment property checks do pass the actions are executed before/after the test suite run.</p>
</div>
</div>
<div class="sect2">
<h3 id="wsaddressing-header-customization"><a class="anchor" href="#wsaddressing-header-customization"></a><a class="link" href="#wsaddressing-header-customization">2.12. WsAddressing header customization</a></h3>
<div class="paragraph">
<p>We have improved the header customization options when using SOAP WSAddressing feature. You can now overwrite the default
WSAddressing headers per test action in addition to defining the headers on
client endpoint component level.</p>
</div>
</div>
<div class="sect2">
<h3 id="changes-jsonpath-data-dictionary"><a class="anchor" href="#changes-jsonpath-data-dictionary"></a><a class="link" href="#changes-jsonpath-data-dictionary">2.13. JsonPath data dictionary</a></h3>
<div class="paragraph">
<p>Json data dictionary was based on a simple dot notated syntax. Now you can also use more complex JsonPath expressions in
order to overwrite elements in Json messages based on the data dictionary settings in Citrus. Read more about that in chapter
<a href="#data-dictionaries">data-dictionary</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="changes-java-dsl-test-behavior"><a class="anchor" href="#changes-java-dsl-test-behavior"></a><a class="link" href="#changes-java-dsl-test-behavior">2.14. Java DSL test behavior</a></h3>
<div class="paragraph">
<p>Test behaviors in Java DSL represent templates in XML DSL. The behavior encapsulates a set of test actions to a group that
can be applied to multiple Java DSL tests. This enables you to combine common test actions in Java DSL with more comfortable
reuse of test action definitions. See chapter <a href="#test-behavior">test-behavior</a> how to use that.</p>
</div>
</div>
<div class="sect2">
<h3 id="changes-auto-select-message-type"><a class="anchor" href="#changes-auto-select-message-type"></a><a class="link" href="#changes-auto-select-message-type">2.15. Auto select message type</a></h3>
<div class="paragraph">
<p>Default message type for validation tasks in Citrus has been <em>XML</em>. Based on this message type the respective message validator
implementation applies for <em>XML</em>, <em>JSON</em>, <em>plain text</em> and so on. You can now change this default message type by setting a
system property (<code>citrus.default.message.type</code>). Also Citrus improved the auto select algorithm when the default message type
is obviously not applicable. When a message arrives in Citrus the receiving action tries to find out which message validator
fits best according to the message payload. XML message content is automatically identified by <code>&lt;&gt;</code> characters. JSON message
payloads are identified by <code>{}</code> or <code>[]</code> characters for objects and array representations. This way Citrus tries to find the best
matching message validator for the incoming message. Before that Citrus has always been using the default message type <em>XML</em>.</p>
</div>
<div class="paragraph">
<p>Read about different message validators in <a href="#message-validation">message-validation</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="changes-default-cucumber-steps"><a class="anchor" href="#changes-default-cucumber-steps"></a><a class="link" href="#changes-default-cucumber-steps">2.16. Default Cucumber steps</a></h3>
<div class="paragraph">
<p>The Citrus Cucumber extension now defines default step definitions for Http, Docker and Selenium. These default steps are ready
for usage in any Cucumber Citrus feature specification. You can load the default steps as additional glue packages in your
Cucumber options. After that you are ready to go for using the default steps directly in feature specification files. With the
extensions you can perform Docker and Selenium commands very easy. Also you can describe the Http REST client-server communication
in BDD style. Read more about this in <a href="#cucumber">cucumber</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="changes-refactoring"><a class="anchor" href="#changes-refactoring"></a><a class="link" href="#changes-refactoring">2.17. Refactoring</a></h3>
<div class="paragraph">
<p>Deprecated APIs and classes that coexisted a long time are now removed. If your project is using on of these deprecated
classes you may run into compile time errors.
Please have a look at the Citrus API JavaDocs and documentation in order to find out how to use the new APIs and classes
that replaced the old deprecated stuff.</p>
</div>
</div>
<div class="sect2">
<h3 id="changes-bugfixes"><a class="anchor" href="#changes-bugfixes"></a><a class="link" href="#changes-bugfixes">2.18. Bugfixes</a></h3>
<div class="paragraph">
<p>Bugs are part of our software developers world and fixing them is part of your daily business, too. Finding and solving issues
makes Citrus better every day. For a detailed listing of all bugfixes please refer to the complete
<a href="http://www.citrusframework.org/changes-report.html">changes log</a> of each release.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a><a class="link" href="#introduction">3. Introduction</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Nowadays enterprise applications usually communicate with different partners over loosely coupled messaging interfaces.
The interaction and the interface contract needs to be tested in integration testing.</p>
</div>
<div class="paragraph">
<p>In a typical integration test scenario we need to simulate the communication partners over various transports. How can we
test use case scenarios that include several interface partners interacting with each other? How can somebody ensure that
the software components work correctly regarding the interface contract? How can somebody run integration test cases in an
automated reproducible way? Citrus tries to answer these questions!</p>
</div>
<div class="sect2">
<h3 id="overview"><a class="anchor" href="#overview"></a><a class="link" href="#overview">3.1. Overview</a></h3>
<div class="paragraph">
<p>Citrus aims to strongly support you in simulating interface partners across different messaging transports. You can easily
produce and consume messages with a wide range of protocols like HTTP, JMS, TCP/IP, FTP, SMTP and more. The framework is able
to both act as a client and server. In each communication step Citrus is able to validate message contents towards syntax and semantics.</p>
</div>
<div class="paragraph">
<p>In addition to that the Citrus offers a wide range of test actions to take control of the process flow during a test
(e.g. iterations, system availability checks, database connectivity, parallelism, delaying, error simulation, scripting and many more).</p>
</div>
<div class="paragraph">
<p>The basic goal in Citrus test cases is to describe a whole use case scenario including several interface partners that
exchange many messages with each other. The composition of complex message flows in a single test case with several test
steps is one of the major features in Citrus.</p>
</div>
<div class="paragraph">
<p>The test case description is either done in XML or Java and can be executed multiple times as automated integration test.
With JUnit and TestNG integration Citrus can easily be integrated into your build lifecycle process. During a test Citrus
simulates all surrounding interface partners (client or server) without any coding effort. With easy definition of expected
message content (header and payload) for XML, CSV, SOAP, JSON or plaintext messages Citrus is able to validate the incoming
data towards syntax and semantics.</p>
</div>
</div>
<div class="sect2">
<h3 id="usage-scenarios"><a class="anchor" href="#usage-scenarios"></a><a class="link" href="#usage-scenarios">3.2. Usage scenarios</a></h3>
<div class="paragraph">
<p>If you are in charge of an enterprise application in a message based solution with message interfaces to other software
components you should use Citrus. In case your project interacts with other software over different messaging transports
and in case you need to simulate these interface partners on client or server side you should use Citrus. In case you need
to continuously check the software stability not only on a unit testing basis but also in an end-to-end integration scenario
you should use Citrus. Bug fixing, release or regression testing is very easy with Citrus. In case you are struggling with
code stability and feel uncomfortable regarding your next software release you should definitely use Citrus.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/usage_sample.jpg" alt="usage_sample.jpg"></span></p>
</div>
<div class="paragraph">
<p>This test set up is typical for a Citrus use case. In such a test scenario we have a system under test (SUT) with several
message interfaces to other applications like you would have with an enterprise service bus for instance. A client application
invokes services on the SUT application. The SUT is linked to several backend applications over various messaging transports
(here SOAP, JMS, and Http). Interim message notifications and final responses are sent back to the client application.
This generates a bunch of messages that are exchanged throughout the applications involved.</p>
</div>
<div class="paragraph">
<p>In the automated integration test Citrus needs to send and receive those messages over different transports. Citrus takes
care of all interface partners (ClientApplication, Backend1, Backend2, Backend3) and simulates their behavior by sending
proper response messages in order to keep the message flow alive.</p>
</div>
<div class="paragraph">
<p>Each communication step comes with message validation and comparison against an expected message template (e.g. XML or JSON data).
Besides messaging actions Citrus is also able to perform arbitrary other test actions. Citrus is able to perform a database
query between requests as an example.</p>
</div>
<div class="paragraph">
<p>The Citrus test case runs fully automated as a Java application. In fact a Citrus test case is nothing but a JUnit or
TestNG test case. Step by step the whole use case scenario is performed like in a real production environment. The Citrus
test is repeatable and is included into the software build process (e.g. using Maven or ANT) like a normal unit test case would do.
This gives you fully automated integration tests to ensure interface stability.</p>
</div>
<div class="paragraph">
<p>The following reference guide walks through all Citrus capabilities and shows how to set up a great integration test with Citrus.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="setup"><a class="anchor" href="#setup"></a><a class="link" href="#setup">4. Setup</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter discusses how to get started with Citrus. It deals with the installation and set up of the framework, so you
are ready to start writing test cases after reading this chapter.</p>
</div>
<div class="paragraph">
<p>Usually you would use Citrus as a dependency library in your project. In Maven you would just add Citrus as a test-scoped
dependency in your POM. When using ANT you can also run Citrus as normal Java application from your build.xml. As Citrus
tests are nothing but normal unit tests you could also use JUnit or TestNG ant tasks to execute the Citrus test cases.</p>
</div>
<div class="paragraph">
<p>This chapter describes the Citrus project setup possibilities, choose one of them that fits best to include Citrus into your project.</p>
</div>
<div class="sect2">
<h3 id="using-maven"><a class="anchor" href="#using-maven"></a><a class="link" href="#using-maven">4.1. Using Maven</a></h3>
<div class="paragraph">
<p>Citrus uses <a href="http://maven.apache.org/">Maven</a> internally as a project build tool and provides extended support for Maven projects.
Maven will ease up your life as it manages project dependencies and provides extended build life cycles and conventions for
compiling, testing, packaging and installing your Java project. Therefore it is recommended to use the Citrus Maven project setup.
In case you already use Maven it is most suitable for you to include Citrus as a test-scoped dependency.</p>
</div>
<div class="paragraph">
<p>As Maven handles all project dependencies automatically you do not need to download any Citrus project artifacts in advance.
If you are new to Maven please refer to the official Maven documentation to find out how to set up a Maven project.</p>
</div>
<div class="sect3">
<h4 id="maven-archetypes"><a class="anchor" href="#maven-archetypes"></a><a class="link" href="#maven-archetypes">4.1.1. Maven archetype</a></h4>
<div class="paragraph">
<p>If you start from scratch or in case you would like to have Citrus operating in a separate Maven module you can use the
Citrus Maven archetype to create a new Maven project. The archetype will setup a basic Citrus project structure with basic
settings and files.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">mvn archetype:generate -Dfilter=com.consol.citrus.mvn:citrus

1: remote -<span class="error">&gt;</span> com.consol.citrus.mvn:citrus-quickstart (Citrus quickstart project)
2: remote -<span class="error">&gt;</span> com.consol.citrus.mvn:citrus-quickstart-jms (Citrus quickstart project with JMS consumer and producer)
3: remote -<span class="error">&gt;</span> com.consol.citrus.mvn:citrus-quickstart-soap (Citrus quickstart project with SOAP client and producer)
Choose a number: 1

Define value for groupId: com.consol.citrus.samples
Define value for artifactId: citrus-sample
Define value for version: 1.0-SNAPSHOT
Define value for package: com.consol.citrus.samples</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the sample above we used the Citrus archetype available in Maven central repository.
As the list of default archetypes available in Maven central is very long, it has been filtered for official Citrus archetypes.</p>
</div>
<div class="paragraph">
<p>After choosing the Citrus quickstart archetype you have to define several values for your project: the groupId, the artifactId,
the package and the project version. After that we are done! Maven created a Citrus project structure for us which is
ready for testing. You should see the following basic project folder structure.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">citrus-sample
  |   + src
  |   |   + main
  |   |    |   + java
  |   |    |   + resources
  |   |   + citrus
  |   |    |   + java
  |   |    |   + resources
  |   |    |   + tests
  pom.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Citrus project is absolutely ready for testing. With Maven we can build, package, install and test our project right
away without any adjustments. Try to execute the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">mvn integration-test
mvn integration-test -Dtest=MyFirstCitrusTest</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you need additional assistance in setting up a Citrus Maven project please visit our Maven setup tutorial on
<a href="http://www.citfrusframework.org">http://www.citrusframework.org/tutorials.html</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="existing-maven-projects"><a class="anchor" href="#existing-maven-projects"></a><a class="link" href="#existing-maven-projects">4.1.2. Existing Maven projects</a></h4>
<div class="paragraph">
<p>In case you already have a proper Maven project you can also integrate Citrus with it. Just add the Citrus project dependencies
in your Maven pom.xml as a dependency like follows.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>We add Citrus as test-scoped project dependency to the project POM (pom.xml)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;dependency&gt;
  &lt;groupId&gt;com.consol.citrus&lt;/groupId&gt;
  &lt;artifactId&gt;citrus-core&lt;/artifactId&gt;
  &lt;version&gt;2.7.3&lt;/version&gt;
  &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>In case you would like to use the Citrus Java DSL also add this dependency to the project</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;dependency&gt;
  &lt;groupId&gt;com.consol.citrus&lt;/groupId&gt;
  &lt;artifactId&gt;citrus-java-dsl&lt;/artifactId&gt;
  &lt;version&gt;2.7.3&lt;/version&gt;
  &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Add the citrus Maven plugin to your project</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;plugin&gt;
  &lt;groupId&gt;com.consol.citrus.mvn&lt;/groupId&gt;
  &lt;artifactId&gt;citrus-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;2.7.3&lt;/version&gt;
  &lt;configuration&gt;
    &lt;author&gt;Donald Duck&lt;/author&gt;
    &lt;targetPackage&gt;com.consol.citrus&lt;/targetPackage&gt;
  &lt;/configuration&gt;
&lt;/plugin&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Now that we have added Citrus to our Maven project we can start writing new test cases with the Citrus Maven plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">mvn citrus:create-test</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you have written the Citrus test cases you can execute them automatically in your Maven software build lifecycle.
The tests will be included into your projects integration-test phase using the Maven failsafe plugin. Here is a sample failsafe configuration for Citrus.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>maven-failsafe-plugin<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>2.20<span class="tag">&lt;/version&gt;</span>
  <span class="tag">&lt;executions&gt;</span>
    <span class="tag">&lt;execution&gt;</span>
      <span class="tag">&lt;id&gt;</span>integration-tests<span class="tag">&lt;/id&gt;</span>
      <span class="tag">&lt;goals&gt;</span>
        <span class="tag">&lt;goal&gt;</span>integration-test<span class="tag">&lt;/goal&gt;</span>
        <span class="tag">&lt;goal&gt;</span>verify<span class="tag">&lt;/goal&gt;</span>
      <span class="tag">&lt;/goals&gt;</span>
    <span class="tag">&lt;/execution&gt;</span>
  <span class="tag">&lt;/executions&gt;</span>
 <span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Citrus test sources go to the default Maven test sources directory <code>src/test/java</code> and <code>src/test/resources</code>:</p>
</div>
<div class="paragraph">
<p>Now everything is set up and you can call the usual Maven <strong>install</strong> goal (mvn clean install) in order to build your project.
The Citrus integration tests are executed automatically during the build process. Besides that you can call the Maven integration-test phase explicitly to execute all Citrus tests or a specific test by its name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">mvn integration-test
mvn integration-test -Dtest=MyFirstCitrusIT</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The Maven failsafe plugin by default executed tests with specific name pattern. This is because integration tests should not execute in Maven unit test phase, too. Therefore integration tests should follow
the failsafe name pattern with each test name beginning or ending with <strong>'IT'</strong>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you need additional assistance in setting up a Citrus Maven project please visit our Maven setup tutorial on <a href="http://www.citfrusframework.org">http://www.citrusframework.org/tutorials.html</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-gradle"><a class="anchor" href="#using-gradle"></a><a class="link" href="#using-gradle">4.2. Using Gradle</a></h3>
<div class="paragraph">
<p>As Citrus tests are nothing but normal JUnit or TestNG tests the integration to Gradle as build tool is as easy as adding the source files to a folder in your project. With the Gradle task execution for
integration tests you are able to execute the Citrus tests like you would do with normal unit tests.</p>
</div>
<div class="sect3">
<h4 id="gradle-configuration"><a class="anchor" href="#gradle-configuration"></a><a class="link" href="#gradle-configuration">4.2.1. Configuration</a></h4>
<div class="paragraph">
<p>The Gradle build configuration is done in the <strong>build.gradle</strong> and <strong>settings.gradle</strong> files. Here we define the project name
and the project version.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">rootProject.name = <span class="string"><span class="delimiter">'</span><span class="content">citrus-sample-gradle</span><span class="delimiter">'</span></span>
group <span class="string"><span class="delimiter">'</span><span class="content">com.consol.citrus.samples</span><span class="delimiter">'</span></span>
version <span class="string"><span class="delimiter">'</span><span class="content">2.7.3</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now as Citrus libraries are available on Maven central repository we add these repositories so Gradle knows how to download the required
Citrus artifacts.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">repositories {
    mavenCentral()
    maven {
        url <span class="string"><span class="delimiter">'</span><span class="content">http://labs.consol.de/maven/snapshots-repository/</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus stable release versions are available on Maven central. If you want to use the very latest next version as snapshot preview you need
to add the ConSol Labs snapshot repository which is optional. Now lets move on with adding the Citrus libraries to the project.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    testCompile <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">com.consol.citrus</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">citrus-core</span><span class="delimiter">'</span></span>, <span class="key">version</span>: <span class="string"><span class="delimiter">'</span><span class="content">2.7.3</span><span class="delimiter">'</span></span>
    testCompile <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">com.consol.citrus</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">citrus-java-dsl</span><span class="delimiter">'</span></span>, <span class="key">version</span>: <span class="string"><span class="delimiter">'</span><span class="content">2.7.3</span><span class="delimiter">'</span></span>
    testCompile <span class="key">group</span>: <span class="string"><span class="delimiter">'</span><span class="content">org.testng</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">testng</span><span class="delimiter">'</span></span>, <span class="key">version</span>: <span class="string"><span class="delimiter">'</span><span class="content">6.11</span><span class="delimiter">'</span></span>
    [...]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This enables the Citrus support for the project so we can use the Citrus classes and APIs. We decided to use TestNG unit test library.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">test {
    useTestNG()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course JUnit is also supported. This is all for build configuration settings. We can move on to writing some Citrus integration tests. You can
find those tests in <strong>src/test/java</strong> directory.</p>
</div>
</div>
<div class="sect3">
<h4 id="gradle-run"><a class="anchor" href="#gradle-run"></a><a class="link" href="#gradle-run">4.2.2. Run with Gradle</a></h4>
<div class="paragraph">
<p>You can use the Gradle wrapper for compile, package and test the sample with Gradle build command line.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"> gradlew clean build</code></pre>
</div>
</div>
<div class="paragraph">
<p>This executes all Citrus test cases during the build and you will see Citrus performing some integration test logging output.
After the tests are finished build is successful and you are ready to go for writing some tests on your own.</p>
</div>
<div class="paragraph">
<p>If you just want to execute all tests you can call</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">gradlew clean check</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course you can also start the Citrus tests from your favorite IDE. Just start the Citrus test using the Gradle integration in IntelliJ, Eclipse or Netbeans.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-ant"><a class="anchor" href="#using-ant"></a><a class="link" href="#using-ant">4.3. Using Ant</a></h3>
<div class="paragraph">
<p>Ant is a very popular way to compile, test, package and execute Java projects. The Apache project has effectively become a
standard in building Java projects. You can run Citrus test cases with Ant as Citrus is nothing but a Java application. This section describes the steps to setup a proper Citrus Ant project.</p>
</div>
<div class="sect3">
<h4 id="preconditions"><a class="anchor" href="#preconditions"></a><a class="link" href="#preconditions">4.3.1. Preconditions</a></h4>
<div class="paragraph">
<p>Before we start with the Citrus setup be sure to meet the following preconditions. The following software should be installed on your computer, in order to use the Citrus framework:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java 8 or higher</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Installed JDK plus JAVA_HOME environment variable set up and pointing to your Java installation directory</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Java IDE (optional)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A Java IDE will help you to manage your Citrus project (e.g. creating and executing test cases).
You can use the any Java IDE (e.g. Eclipse or IntelliJ IDEA) but also any convenient XML Editor to write new test cases.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ant 1.8 or higher</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ant (<a href="http://ant.apache.org/">http://ant.apache.org/</a>) will run tests and compile your Citrus code extensions if necessary.</p>
</div>
</div>
<div class="sect3">
<h4 id="download"><a class="anchor" href="#download"></a><a class="link" href="#download">4.3.2. Download</a></h4>
<div class="paragraph">
<p>First of all we need to download the latest Citrus release archive from the official website <a href="http://www.citrusframework.org">http://www.citrusframework.org</a></p>
</div>
<div class="paragraph">
<p>Citrus comes to you as a zipped archive in one of the following packages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>citrus-x.x-release</strong></p>
</li>
<li>
<p><strong>citrus-x.x-src</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The release package includes the Citrus binaries as well as the reference documentation and some sample applications.</p>
</div>
<div class="paragraph">
<p>In case you want to get in touch with developing and debugging Citrus you can also go with the source archive which gives
you the complete Citrus Java code sources. The whole Citrus project is also accessible for you on <a href="http://github.com/christophd/citrus">http://github.com/christophd/citrus</a>.
This open git repository on GitHub enables you to build Citrus from scratch with Maven and contribute code changes.</p>
</div>
</div>
<div class="sect3">
<h4 id="installation"><a class="anchor" href="#installation"></a><a class="link" href="#installation">4.3.3. Installation</a></h4>
<div class="paragraph">
<p>After downloading the Citrus archives we extract those into an appropriate location on the local storage. We are seeking for the
Citrus project artifacts coming as normal Java archives (e.g. citrus-core.jar, citrus-ws.jar, etc.)</p>
</div>
<div class="paragraph">
<p>You have to include those Citrus Java archives as well as all dependency libraries to your Apache Ant Java classpath. Usually you
would copy all libraries into your project&#8217;s lib directory and declare those libraries in the Ant build file. As this approach can be
very time consuming I recommend to use a dependency management API such as Apache Ivy which gives you automatic dependency resolution like that from Maven.
In particular this comes in handy with all the 3rd party dependencies that would be resolved automatically.</p>
</div>
<div class="paragraph">
<p>No matter what approach you are using to set up the Apache Ant classpath see the following sample Ant build script which uses the
Citrus project artifacts in combination with the TestNG Ant tasks to run the tests.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;project</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus-sample</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">basedir</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">.</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus.run.tests</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns:artifact</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">antlib:org.apache.maven.artifact.ant</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

  <span class="tag">&lt;property</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">src/it/resources/citrus.properties</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

  <span class="tag">&lt;path</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">maven-ant-tasks.classpath</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lib/maven-ant-tasks-2.1.3.jar</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
  <span class="tag">&lt;typedef</span> <span class="attribute-name">resource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org/apache/maven/artifact/ant/antlib.xml</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">antlib:org.apache.maven.artifact.ant</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">classpathref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">maven-ant-tasks.classpath</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>

  <span class="tag">&lt;artifact:pom</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus-pom</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pom.xml</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
  <span class="tag">&lt;artifact:dependencies</span> <span class="attribute-name">filesetId</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus-dependencies</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">pomRefId</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus-pom</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>

  <span class="tag">&lt;path</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus-classpath</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;pathelement</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">src/it/java</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;pathelement</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">src/it/resources</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;pathelement</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">src/it/tests</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;fileset</span> <span class="attribute-name">refid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus-dependencies</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/path&gt;</span>

  <span class="tag">&lt;taskdef</span> <span class="attribute-name">resource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testngtasks</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">classpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">lib/testng-6.8.8.jar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

  <span class="tag">&lt;target</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">compile.tests</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;javac</span> <span class="attribute-name">srcdir</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">src/it/java</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">classpathref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus-classpath</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;javac</span> <span class="attribute-name">srcdir</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">src/it/tests</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">classpathref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus-classpath</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/target&gt;</span>

  <span class="tag">&lt;target</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">create.test</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">description</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Creates a new empty test case</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;input</span> <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Enter test name:</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">addproperty</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">test.name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;input</span> <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Enter test description:</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">addproperty</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">test.description</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;input</span> <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Enter author's name:</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">addproperty</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">test.author</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">defaultvalue</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${default.test.author}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;input</span> <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Enter package:</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">addproperty</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">test.package</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">defaultvalue</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${default.test.package}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;input</span> <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Enter framework:</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">addproperty</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">test.framework</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">defaultvalue</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testng</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;java</span> <span class="attribute-name">classname</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.util.TestCaseCreator</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;classpath</span> <span class="attribute-name">refid</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus-classpath</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;arg</span> <span class="attribute-name">line</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">-name ${test.name} -author ${test.author} -description ${test.description} -package ${test.package} -framework ${test.framework}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/java&gt;</span>
  <span class="tag">&lt;/target&gt;</span>

  <span class="tag">&lt;target</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus.run.tests</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">depends</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">compile.tests</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">description</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Runs all Citrus tests</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;testng</span> <span class="attribute-name">classpathref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus-classpath</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;classfileset</span> <span class="attribute-name">dir</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">src/it/java</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">includes</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">**/*.class</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/testng&gt;</span>
  <span class="tag">&lt;/target&gt;</span>

  <span class="tag">&lt;target</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus.run.single.test</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">depends</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">compile.tests</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">description</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Runs a single test by name</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;touch</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">test.history</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;loadproperties</span> <span class="attribute-name">srcfile</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">test.history</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;echo</span> <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Last test executed: ${last.test.executed}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;input</span> <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Enter test name or leave empty for last test executed:</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">addproperty</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testclass</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">defaultvalue</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${last.test.executed}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;propertyfile</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">test.history</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">last.test.executed</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">string</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${testclass}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/propertyfile&gt;</span>

    <span class="tag">&lt;testng</span> <span class="attribute-name">classpathref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus-classpath</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;classfileset</span> <span class="attribute-name">dir</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">src/it/java</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">includes</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">**/${testclass}.class</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/testng&gt;</span>
  <span class="tag">&lt;/target&gt;</span>

<span class="tag">&lt;/project&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you need detailed assistance for building Citrus with Ant do also visit our tutorials section on <a href="http://www.citrusframework.org">http://www.citrusframework.org</a>.
There you can find a tutorial which describes the Citrus Java project set up with Ant from scratch.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="test-cases"><a class="anchor" href="#test-cases"></a><a class="link" href="#test-cases">5. Test cases</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now let us start writing test cases! A test case in Citrus describes all steps for a certain use case in one single file. The Citrus test holds a sequence of test actions. Each action represents a very special purpose such as sending or receiving a message. Typically with message-based enterprise applications the sending and receiving of messages represent the main actions inside a test.</p>
</div>
<div class="paragraph">
<p>However you will learn that Citrus is more than just a simple SOAP client for instance. Each test case can hold complex actions such as connecting to the database, transforming data, adding loops and conditional steps. With the default Citrus action set you can accomplish very complex use case integration tests. Later in this guide we will briefly discuss all available test actions and learn how to use various message transports within the test. For now we will concentrate on the basic test case structure.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/figure_004.jpg" alt="figure_004.jpg"></span></p>
</div>
<div class="paragraph">
<p>The figure above describes a typical test action sequence in Citrus. A list of sending and receiving test actions composing a typical test case here. Each action references a predefined Citrus endpoint component that we are going to talk about later on.</p>
</div>
<div class="paragraph">
<p>So how do we define those test cases? In general Citrus specifies test cases as Java classes. With TestNG or JUnit you can execute the Citrus tests within your Java runtime as you would do within unit testing. You can code the Citrus test in a single Java class doing assertions and using Spring&#8217;s dependency injection mechanisms.</p>
</div>
<div class="paragraph">
<p>If you are not familiar to writing Java code you can also write Citrus tests as XML files. Whatever test language you choose for Citrus the whole test case description takes place in one single file (Java or XML). This chapter will introduce the custom XML schema language as well as the Java domain specific language so you will be able to write Citrus test cases no matter what knowledge base you belong to.</p>
</div>
<div class="sect2">
<h3 id="writing-test-cases-in-xml"><a class="anchor" href="#writing-test-cases-in-xml"></a><a class="link" href="#writing-test-cases-in-xml">5.1. Writing test cases in XML</a></h3>
<div class="paragraph">
<p>Put simply, a Citrus test case is nothing but a simple Spring XML configuration file. The Spring framework has become a state of the art development framework for enterprise Java applications. As you work with Citrus you will also learn how to use the Spring Ioc (Inversion of control) container and the concepts of dependency injection. So let us have a look at the pure Spring XML configuration syntax first. You are free to write fully compatible test cases for the Citrus framework just using this syntax.</p>
</div>
<div class="listingblock">
<div class="title">Spring bean definition syntax</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span>
    <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
    <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyFirstTest</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.TestCase</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">variableDefinitions</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="comment">&lt;!-- variables of this test go here --&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">actions</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="comment">&lt;!-- actions of this test go here --&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus can execute these Spring bean definitions as normal test cases - no problem, but the pure Spring XML syntax is very verbose and probably not the best way to describe a test case in Citrus. In particular you have to know a lot of Citrus internals such as Java class names and property names. In addition to that as test scenarios get more complex the test cases grow in size. So we need a more effective and comfortable way of writing tests. Therefore Citrus provides a custom XML schema definition for writing test cases which is much more adequate for our testing purpose.</p>
</div>
<div class="paragraph">
<p>The custom XML schema aims to reach the convenience of domain specific languages (DSL). Let us have a look at the Citrus test describing XML language by introducing a first very simple test case definition:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;spring:beans</span>
    <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/testcase</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:spring</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
    <span class="content">http://www.springframework.org/schema/beans</span>
    <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
    <span class="content">http://www.citrusframework.org/schema/testcase</span>
    <span class="content">http://www.citrusframework.org/schema/testcase/citrus-testcase.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MyFirstTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;description&gt;</span>
            First example showing the basic test case definition elements!
        <span class="tag">&lt;/description&gt;</span>
        <span class="tag">&lt;variables&gt;</span>
            <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Test Framework</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/variables&gt;</span>
        <span class="tag">&lt;actions&gt;</span>
            <span class="tag">&lt;echo&gt;</span>
                <span class="tag">&lt;message&gt;</span>${text}<span class="tag">&lt;/message&gt;</span>
            <span class="tag">&lt;/echo&gt;</span>
        <span class="tag">&lt;/actions&gt;</span>
    <span class="tag">&lt;/testcase&gt;</span>
<span class="tag">&lt;/spring:beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We do need the <strong><em>`&lt;spring:beans&gt;`</em></strong> root element as the XML file is read by the Spring IoC container. Inside this root element the Citrus specific namespace definitions take place.</p>
</div>
<div class="paragraph">
<p>The test case itself gets a mandatory name that must be unique throughout all test cases in a project. You will receive errors when using duplicate test names. The test name has to follow the common Java naming conventions and rules for Java classes. This means names must not contain any whitespace characters but characters like '-', '.', '<em>' are supported. For example, <strong>_TestFeature_1</em></strong> is valid but <strong><em>Test Feature 1</em></strong> is not as it contains whitespace characters like spaces.</p>
</div>
<div class="paragraph">
<p>Now that we have an XML definition that describes the steps of our test we need a Java executable for the test. The Java executable is needed for the framework in order to run the test. See the following sample Java class that represents a simple Citrus Java test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.testng.annotations.Test</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.annotations.CitrusTest</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.testng.AbstractTestNGCitrusTest</span>;

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyFirstTest</span> <span class="directive">extends</span> AbstractTestNGCitrusTest {

    <span class="annotation">@CitrusXmlTest</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">MyFirstTest</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> myFirstTest() {
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The sample above is a Java class that represents a valid Citrus Java executable. The Java class has no programming logic as we use a XML test case here. The Java class can also be generated using the Citrus Maven plugin. The Java class extends from basic superclass <strong>AbstractTestNGCitrusTest</strong> and therefore uses TestNG as unit test framework. Citrus also supports JUnit as unit test framework. Read more about this in <a href="#run-with-testng">run-with-testng</a>and <a href="#run-with-junit">run-with-junit</a>.</p>
</div>
<div class="paragraph">
<p>Up to now it is important to understand that Citrus always needs a Java executable test class. In case we use the XML test representation the Java part is generic, can be generated and contains no programming logic. The XML test defines all steps and is our primary test case definition.</p>
</div>
</div>
<div class="sect2">
<h3 id="writing-test-cases-in-java"><a class="anchor" href="#writing-test-cases-in-java"></a><a class="link" href="#writing-test-cases-in-java">5.2. Writing test cases in Java</a></h3>
<div class="paragraph">
<p>Before we go into more details on the attributes and actions that take place within a test case we just have a look at how to write test cases with pure Java code. Citrus works with Java and uses the well known JUnit and TestNG framework benefits that you may be used to as a tester. Many users may prefer to write Java code instead of the verbose XML syntax. Therefore you have another possibility for writing Citrus tests in pure Java.</p>
</div>
<div class="paragraph">
<p>When using the Citrus Java DSL we need to include a special Maven dependency module to our project that provides the needed API.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>com.consol.citrus<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>citrus-java-dsl<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>2.7.3<span class="tag">&lt;/version&gt;</span>
  <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus in general differences between two ways of test cases in Java. These are <strong>test-designers</strong> and <strong>test-runners</strong> that we deal with each in the next two sections.</p>
</div>
</div>
<div class="sect2">
<h3 id="java-dsl-test-designer"><a class="anchor" href="#java-dsl-test-designer"></a><a class="link" href="#java-dsl-test-designer">5.3. Java DSL test designer</a></h3>
<div class="paragraph">
<p>The first way of defining a Citrus test in Java is the <strong>test-designer</strong> . The Java DSL for a test designer works similar to the XML approach. The whole test case is built with all test actions first. Then the whole test case is executed as a whole Citrus test. This is how to define a Citrus test with designer Java DSL methods:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.testng.annotations.Test</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.annotations.CitrusTest</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.dsl.testng.TestNGCitrusTestDesigner</span>;

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyFirstTestDesigner</span> <span class="directive">extends</span> TestNGCitrusTestDesigner {
    <span class="annotation">@CitrusTest</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">MyFirstTest</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> myFirstTest() {
        description(<span class="string"><span class="delimiter">&quot;</span><span class="content">First example showing the basic test case definition elements!</span><span class="delimiter">&quot;</span></span>);

        variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Test Framework</span><span class="delimiter">&quot;</span></span>);

        echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">${text}</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus provides a base Java class <strong>com.consol.citrus.dsl.testng.TestNGCitrusTestDesigner</strong> that provides all capabilities for you in form of builder pattern methods. Just use the @CitrusTest annotation on top of the test method. Citrus will use the method name as the test name by default. As you can see in the example above you can also customize the test name within the @CitrusTest annotation. The test method builds all test actions using the test builder pattern. The defined test actions will then be called later on during test runtime.</p>
</div>
<div class="paragraph">
<p>The design time runtime difference in <strong>test-designer</strong> is really important to be understood. You can mix the Citrus Java DSL execution with other Java code with certain limitations. We will explain this later on when introducing the <strong>test-runner</strong> .</p>
</div>
<div class="paragraph">
<p>This is the basic test Java class pattern used in Citrus. You as a tester with development background can easily extend this pattern for customized logic. Again if you are coming without coding experience do not worry this Java code is optional. You can do exactly the same with the XML syntax only as shown before. The test designer Java DSL is much more powerful though as you can use the full Java programming language with class inheritance and method delegation.</p>
</div>
<div class="paragraph">
<p>We have mentioned that the <strong>test-designer</strong> will build the complete test case in design time with all actions first before execution of the whole test case takes place at runtime of the test. This approach has the advantage that Citrus knows all test actions in a test before execution. On the other hand you are limited in mixing Java DSL method calls and normal Java code. The following example should clarify things a little bit.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.testng.annotations.Test</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.annotations.CitrusTest</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.dsl.testng.TestNGCitrusTestDesigner</span>;

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">LoggingTestDesigner</span> <span class="directive">extends</span> TestNGCitrusTestDesigner {
    <span class="directive">private</span> LoggingService loggingService = <span class="keyword">new</span> LoggingService();

    <span class="annotation">@CitrusTest</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">LoggingTest</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> loggingTest() {
        echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Before loggingService call</span><span class="delimiter">&quot;</span></span>);

        loggingService.log(<span class="string"><span class="delimiter">&quot;</span><span class="content">Now called custom logging service</span><span class="delimiter">&quot;</span></span>);

        echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">After loggingService call</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example test case above we use an instance of a custom <strong>LoggingService</strong> and call some operation <strong>log()</strong> in the middle of our Java DSL test. Now developers might expect the logging service call to be done in the middle of the Java Citrus test case but if we have a look at the logging output of the test we get a total different result:</p>
</div>
<div class="listingblock">
<div class="title">Expected output</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">INFO            Citrus| STARTING TEST LoggingTest
INFO        EchoAction| Before loggingService call
INFO    LoggingService| Now called custom logging service
INFO        EchoAction| After loggingService call
INFO            Citrus| TEST SUCCESS LoggingTest</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Actual output</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">INFO    LoggingService| Now called custom logging service
INFO            Citrus| STARTING TEST LoggingTest
INFO        EchoAction| Before loggingService call
INFO        EchoAction| After loggingService call
INFO            Citrus| TEST SUCCESS LoggingTest</code></pre>
</div>
</div>
<div class="paragraph">
<p>So if we analyse the actual logging output we see that the logging service was called even before the Citrus test case did start its action. This is the result of <strong>test-designer</strong> building up the whole test case first. The designer collects all test actions first in internal memory cache and the executes the whole test case. So the custom service call on the <strong>LoggingService</strong> is not part of the Citrus Java DSL test and therefore is executed immediately at design time.</p>
</div>
<div class="paragraph">
<p>We can fix this with the following <strong>test-designer</strong> code:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.testng.annotations.Test</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.annotations.CitrusTest</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.dsl.testng.TestNGCitrusTestDesigner</span>;

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">LoggingTestDesigner</span> <span class="directive">extends</span> TestNGCitrusTestDesigner {
    <span class="directive">private</span> LoggingService loggingService = <span class="keyword">new</span> LoggingService();

    <span class="annotation">@CitrusTest</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">LoggingTest</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> loggingTest() {
        echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Before loggingService call</span><span class="delimiter">&quot;</span></span>);

        action(<span class="keyword">new</span> AbstractTestAction() {
            doExecute(TestContext context) {
                loggingService.log(<span class="string"><span class="delimiter">&quot;</span><span class="content">Now called custom logging service</span><span class="delimiter">&quot;</span></span>);
            }
        });

        echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">After loggingService call</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we placed the <strong>loggingService</strong> call inside a custom TestAction implementation and therefore this piece of code is part of the Citrus Java DSL and following from that part of the Citrus test execution. Now with that fix we get the expected logging output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">INFO            Citrus| STARTING TEST LoggingTest
INFO        EchoAction| Before loggingService call
INFO    LoggingService| Now called custom logging service
INFO        EchoAction| After loggingService call
INFO            Citrus| TEST SUCCESS LoggingTest</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now this is not easy to understand and people did struggle with this separation of designtime and runtime of a Citrus Java DSL test. This is why we have implemented a new Java DSL base class called <strong>test-runner</strong> that we deal with in the next section. Before we continue we have to mention that the <strong>test-designer</strong> approach does also work for JUnit. Although we have only seen TestNG sample code in this section everything is working exactly the same way with JUnit framework. Just use the base class <strong>com.consol.citrus.dsl.junit.JUnit4CitrusTestDesigner</strong> instead.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Neither <strong>TestNGCitrusTestDesigner</strong> nor <strong>JUnit4CitrusTestDesigner</strong> implementation is thread safe for parallel test execution. This is simply because the base class is holding state to the current test designer instance in order to delegate method calls to this instance. Therefore parallel test method execution is not available. Fortunately we have added a threadsafe base class implementation that uses resource injection. Read more about this in <a href="#test-resource-injection">test-resource-injection</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="java-dsl-test-runner"><a class="anchor" href="#java-dsl-test-runner"></a><a class="link" href="#java-dsl-test-runner">5.4. Java DSL test runner</a></h3>
<div class="paragraph">
<p>The new test runner concept solves the issues that may come along when working with the test designer. We have already seen a simple example where the test designer requires strict separation of designtime and runtime. The test runner implementation executes each test action immediately. This changes the prerequisites in such that the test action Java DSL method calls can be mixed with usual Java code statements. The the example that we have seen before in a test runner implementation:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.testng.annotations.Test</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.annotations.CitrusTest</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.dsl.testng.TestNGCitrusTestRunner</span>;

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">LoggingTestRunner</span> <span class="directive">extends</span> TestNGCitrusTestRunner {
    <span class="directive">private</span> LoggingService loggingService = <span class="keyword">new</span> LoggingService();

    <span class="annotation">@CitrusTest</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">LoggingTest</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> loggingTest() {
        echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Before loggingService call</span><span class="delimiter">&quot;</span></span>);

        loggingService.log(<span class="string"><span class="delimiter">&quot;</span><span class="content">Now called custom logging service</span><span class="delimiter">&quot;</span></span>);

        echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">After loggingService call</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the new test runner implementation as base class we are able to mix Java DSL method calls and normal Java code statement in our test in an unlimited way. This example above will also create the expected logging output as all Java DSL method calls are executed immediately.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">INFO            Citrus| STARTING TEST LoggingTest
INFO        EchoAction| Before loggingService call
INFO    LoggingService| Now called custom logging service
INFO        EchoAction| After loggingService call
INFO            Citrus| TEST SUCCESS LoggingTest</code></pre>
</div>
</div>
<div class="paragraph">
<p>In contrary to the test designer the test runner implementation will not build the complete test case before execution. Each test action is executed immediately as it is called with Java DSL builder methods. This creates a more natural way of coding test cases as you are also able to use iterations, try catch blocks, finally sections and so on.</p>
</div>
<div class="paragraph">
<p>In the examples here TestNG was used as unit framework. Of course the exact same approach can also apply to JUnit framework. Just use the base class <strong>com.consol.citrus.dsl.junit.JUnit4CitrusTestRunner</strong> instead. Feel free to choose the base class for <strong>test-designer</strong> or <strong>test-runner</strong> as you like. You can also mix those two approaches in your project. Citrus is able to handle both ways of Java DSL code in a project.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The <strong>TestNGCitrusTestRunner</strong> and <strong>JUnit4CitrusTestRunner</strong> implementation is not thread safe for parallel test execution. This is simply because the base class is holding state to the current test runner instance in order to delegate method calls to this instance. Therefore parallel test method execution is not available. Fortunately we have added a threadsafe base class implementation that uses resource injection. Read more about this in <a href="#test-resource-injection">test-resource-injection</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="test-resource-injection"><a class="anchor" href="#test-resource-injection"></a><a class="link" href="#test-resource-injection">5.5. Designer/Runner injection</a></h3>
<div class="paragraph">
<p>In the previous sections we have seen the different approaches for test designer and runner implementations. Up to now the decision which implementation to use was made by extending one of the base classes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>com.consol.citrus.dsl.testng.TestNGCitrusTestRunner</p>
</li>
<li>
<p>com.consol.citrus.dsl.testng.TestNGCitrusTestDesigner</p>
</li>
<li>
<p>com.consol.citrus.dsl.junit.JUnit4CitrusTestRunner</p>
</li>
<li>
<p>com.consol.citrus.dsl.junit.JUnit4CitrusTestDesigner</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These four classes represent the different designer and runner implementations for TestNG or JUnit. Now Citrus also provides a resource injection mechanism for both designer and runner implementations. The classes using this feature are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>com.consol.citrus.dsl.testng.TestNGCitrusTest</p>
</li>
<li>
<p>com.consol.citrus.dsl.junit.JUnit4CitrusTest</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So what is the deal with that? It is simple when looking at a first example using resource injection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">InjectionTest</span> <span class="directive">extends</span> JUnit4CitrusTest {

    <span class="annotation">@CitrusTest</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">JUnit4DesignerTest</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> designerTest(<span class="annotation">@CitrusResource</span> TestDesigner designer) {
        designer.echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Now working on designer instance</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@CitrusTest</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">JUnit4RunnerTest</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> runnerTest(<span class="annotation">@CitrusResource</span> TestRunner runner) {
        runner.echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Now working on runner instance</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The designer or runner instance is injected as Citrus resource to the test method as parameter. This way we can mix designer and runner in a single test. But this is not the real motivation for the resource injection. The clear advantage of this approach with injected designer and runner instances is support for multi threading. In case you want to execute the Citrus tests in parallel using multiple threads you need to use this approach. This is because the usual designer and runner base classes are not thread safe. This <strong>JUnit4CitrusTest</strong> base class is because the resources injected are not kept as state in the base class.</p>
</div>
<div class="paragraph">
<p>This is our first Citrus resource injection use case. The framework is able to inject other resources, too. Find out more about this in the next sections.</p>
</div>
</div>
<div class="sect2">
<h3 id="test-context-injection"><a class="anchor" href="#test-context-injection"></a><a class="link" href="#test-context-injection">5.6. Test context injection</a></h3>
<div class="paragraph">
<p>When running a test case in Citrus we make use of basic framework components and capabilities. One of these capabilities is to use test variables, functions and validation matchers. Up to this point we have not learned about these things. They will be described in the upcoming chapters and sections in more detail. Right now I want to talk about resource injection in Citrus.</p>
</div>
<div class="paragraph">
<p>All these feature mentioned above are bound to some important Citrus component: the Citrus test context. The test context holds all variables and is able to resolve functions and matchers. In general you as a tester will not need explicit access to this component as the framework is working with it behind the scenes. In case you need some access for advanced operations with the framework Citrus provides a resource injection. Lets have a look at this so things are getting more clear.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ResourceInjectionIT</span> <span class="directive">extends</span> JUnit4CitrusTestDesigner {

    <span class="annotation">@Test</span>
    <span class="annotation">@CitrusTest</span>
    <span class="directive">public</span> <span class="type">void</span> resourceInjectionIT(<span class="annotation">@CitrusResource</span> TestContext context) {
        context.setVariable(<span class="string"><span class="delimiter">&quot;</span><span class="content">myVariable</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">some value</span><span class="delimiter">&quot;</span></span>);
        echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">${myVariable}</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see we have added a method parameter of type <strong>com.consol.citrus.context.TestContext</strong> to the test method. The annotation <strong>@CitrusResource</strong> tells Citrus to inject this parameter with the according instance of the object for this test. Now we have easy access to the context and all its capabilities such as variable management.</p>
</div>
<div class="paragraph">
<p>Of course the same approach works with TestNG, too. As TestNG also provides resource injection mechanisms we have to make sure that the different resource injection approaches do not interfere with each other. So we tell TestNG to not inject this parameter by declaring it as <strong>@Optional</strong> for TestNG. In addition to that we need to introduce the parameter to TestNG with the <strong>@Parameters</strong> annotation. Otherwise TestNG would complain about not knowing this parameter. The final test method with Citrus resource injection looks like follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ResourceInjectionIT</span> <span class="directive">extends</span> TestNGCitrusTestDesigner {

    <span class="annotation">@Test</span> <span class="annotation">@Parameters</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">context</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@CitrusTest</span>
    <span class="directive">public</span> <span class="type">void</span> resourceInjectionIT(<span class="annotation">@Optional</span> <span class="annotation">@CitrusResource</span> TestContext context) {
        context.setVariable(<span class="string"><span class="delimiter">&quot;</span><span class="content">myVariable</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">some value</span><span class="delimiter">&quot;</span></span>);
        echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">${myVariable}</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some more annotations needed but the result is the same. We have access to the Citrus test context. Of course you can combine the resource injection for different Citrus components. Just add more some <strong>@CitrusResource</strong> annotated method parameters to the test method.</p>
</div>
</div>
<div class="sect2">
<h3 id="java-dsl-test-behaviors"><a class="anchor" href="#java-dsl-test-behaviors"></a><a class="link" href="#java-dsl-test-behaviors">5.7. Java DSL test behaviors</a></h3>
<div class="paragraph">
<p>When using the Java DSL the concept of behaviors is a good way to reuse test action blocks. By putting test actions to a test behavior we can instantiate and apply the behavior to different test cases multiple times. The mechanism is explained best when having a simple sample:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">FooBehavior</span> <span class="directive">extends</span> AbstractTestBehavior {
    <span class="directive">public</span> <span class="type">void</span> apply() {
        variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>);

        echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">fooBehavior</span><span class="delimiter">&quot;</span></span>);
    }
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">BarBehavior</span> <span class="directive">extends</span> AbstractTestBehavior {
    <span class="directive">public</span> <span class="type">void</span> apply() {
        variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>);

        echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">barBehavior</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The listing above shows two test behaviors that add very specific test actions and test variables to the test case. As you can see the test behavior is able to use the same Java DSL action methods as a normal test case would do. Inside the apply method block we define the behaviors test logic. Now once this is done we can use the behaviors in a test case like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> behaviorTest() {
    description(<span class="string"><span class="delimiter">&quot;</span><span class="content">This is a behavior Test</span><span class="delimiter">&quot;</span></span>);
    author(<span class="string"><span class="delimiter">&quot;</span><span class="content">Christoph</span><span class="delimiter">&quot;</span></span>);
    status(TestCaseMetaInfo.Status.FINAL);

    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">var</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>);

    applyBehavior(<span class="keyword">new</span> FooBehavior());

    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Successfully applied bar behavior</span><span class="delimiter">&quot;</span></span>);

    applyBehavior(<span class="keyword">new</span> BarBehavior());

    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Successfully applied bar behavior</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The behavior is applied to the test case by calling the <strong>applyBehavior</strong> method. As a result the behavior is called adding its logic at this point of the test execution. The same behavior can now be called in multiple test cases so we have a reusable set of test actions.</p>
</div>
</div>
<div class="sect2">
<h3 id="description"><a class="anchor" href="#description"></a><a class="link" href="#description">5.8. Description</a></h3>
<div class="paragraph">
<p>In the test examples that we have seen so far you may have noticed that a tester can give a detailed test description. The test case description clarifies the testing purpose and perspectives. The description should give a short introduction to the intended use case scenario that will be tested. The user should get a first impression what the test case is all about as well as special information to understand the test scenario. You can use free text in your test description no limit to the number of characters. But be aware of the XML validation rules of well formed XML when using the XML test syntax (e.g. special character escaping, use of CDATA sections may be required)</p>
</div>
</div>
<div class="sect2">
<h3 id="test-actions"><a class="anchor" href="#test-actions"></a><a class="link" href="#test-actions">5.9. Test Actions</a></h3>
<div class="paragraph">
<p>Now we get close to the main part of writing an integration test. A Citrus test case defines a sequence of actions that will take place during the test. Actions by default are executed sequentially in the same order as they are defined in the test case definition.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;actions&gt;</span>
    <span class="tag">&lt;action&gt;</span>[...]<span class="tag">&lt;/action&gt;</span>
    <span class="tag">&lt;action&gt;</span>[...]<span class="tag">&lt;/action&gt;</span>
<span class="tag">&lt;/actions&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>All actions have individual names and properties that define the respective behavior. Citrus offers a wide range of test actions from scratch, but you are also able to write your own test actions in Java or Groovy and execute them during a test. <a href="#actions">actions</a> gives you a brief description of all available actions that can be part of a test case execution.</p>
</div>
<div class="paragraph">
<p>The actions are combined in free sequence to each other so that the tester is able to declare a special action chain inside the test. These actions can be sending or receiving messages, delaying the test, validating the database and so on. Step-by-step the test proceeds through the action chain. In case one single action fails by reason the whole test case is red and declared not successful.</p>
</div>
</div>
<div class="sect2">
<h3 id="finally-test-section"><a class="anchor" href="#finally-test-section"></a><a class="link" href="#finally-test-section">5.10. Finally test section</a></h3>
<div class="paragraph">
<p>Java developers might be familiar with the concept of doing something in the finally code section. The <strong><em>finally</em></strong> section contains a list of test actions that will be executed guaranteed at the very end of the test case even if errors did occur during the execution before. This is the right place to tidy up things that were previously created by the test like cleaning up the database for instance. The <strong><em>finally</em></strong> section is described in more detail in <a href="#finally-section">finally-section</a>. However here is the basic syntax inside a test.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;finally&gt;</span>
    <span class="tag">&lt;echo&gt;</span>
        <span class="tag">&lt;message&gt;</span>Do finally - regardless of what has happened before<span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;/echo&gt;</span>
<span class="tag">&lt;/finally&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> sampleTest() {
    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Test Framework</span><span class="delimiter">&quot;</span></span>);

    doFinally(
        echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Do finally - regardless of any error before</span><span class="delimiter">&quot;</span></span>)
    );
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> sampleTest() {
    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Test Framework</span><span class="delimiter">&quot;</span></span>);

    doFinally()
        .actions(
            echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Do finally - regardless of any error before</span><span class="delimiter">&quot;</span></span>)
        );
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="test-meta-information"><a class="anchor" href="#test-meta-information"></a><a class="link" href="#test-meta-information">5.11. Test meta information</a></h3>
<div class="paragraph">
<p>The user can provide some additional information about the test case. The meta-info section at the very beginning of the test case holds information like author, status or creation date. In detail the meta information is specified like this:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">metaInfoTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;meta-info&gt;</span>
        <span class="tag">&lt;author&gt;</span>Christoph Deppisch<span class="tag">&lt;/author&gt;</span>
        <span class="tag">&lt;creationdate&gt;</span>2008-01-11<span class="tag">&lt;/creationdate&gt;</span>
        <span class="tag">&lt;status&gt;</span>FINAL<span class="tag">&lt;/status&gt;</span>
        <span class="tag">&lt;last-updated-by&gt;</span>Christoph Deppisch<span class="tag">&lt;/last-updated-by&gt;</span>
        <span class="tag">&lt;last-updated-on&gt;</span>2008-01-11T10:00:00<span class="tag">&lt;/last-updated-on&gt;</span>
    <span class="tag">&lt;/meta-info&gt;</span>
    <span class="tag">&lt;description&gt;</span>
        ...
    <span class="tag">&lt;/description&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        ...
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> sampleTest() {
    description(<span class="string"><span class="delimiter">&quot;</span><span class="content">This is a Test</span><span class="delimiter">&quot;</span></span>);
    author(<span class="string"><span class="delimiter">&quot;</span><span class="content">Christoph</span><span class="delimiter">&quot;</span></span>);
    status(Status.FINAL);

    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Citrus!</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The status allows following values: DRAFT, READY_FOR_REVIEW, DISABLED, FINAL. The meta-data information to a test is quite important to give the reader a first information about the test. It is also possible to generate test documentation using this meta-data information. The built-in Citrus documentation generates HTML or Excel documents that list all tests with their metadata information and description.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Tests with the status DISABLED will not be executed during a test suite run. So someone can just start adding planned test cases that are not finished yet in status DRAFT. In case a test is not runnable yet because it is not finished, someone may disable a test temporarily to avoid causing failures during a test run. Using these different statuses one can easily set up test plans and review the progress of test coverage by comparing the number of DRAFT tests to those in the FINAL state.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now you know the possibilities how to write Citrus test cases in XML or Java. Please choose whatever code language type you want (Java, XML, Spring bean syntax) in order to write Citrus test cases. Developers may choose Java, testers without coding experience may run best with the XML syntax. We are constantly working on even more test writing language support such as Groovy, Scala, Xtext, and so on. In general you can mix the different language types just as you like within your Citrus project which gives you the best of flexibility.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="test-variables"><a class="anchor" href="#test-variables"></a><a class="link" href="#test-variables">6. Test variables</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The usage of test variables is a core concept when writing good maintainable tests. The key identifiers of a test case should be exposed as test variables at the very beginning of a test. This way hard coded identifiers and multiple redundant values inside the test can be avoided from scratch. As a tester you define all test variables at the very beginning of your test.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;variables&gt;</span>
    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Test Framework</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customerId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">123456789</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/variables&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">variable(&quot;text&quot;, &quot;Hello Test Framework&quot;);
variable(&quot;customerId&quot;, &quot;123456789&quot;);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The concept of test variables is essential when writing complex tests with lots of identifiers and semantic data. Test variables are valid for the whole test case. You can reference them several times using a common variable expression <strong><em>"${variable-name}"</em></strong> . It is good practice to provide all important entities as test variables. This makes the test easier to maintain and more flexible. All essential entities and identifiers are present right at the beginning of the test, which may also give the opportunity to easily create test variants by simply changing the variable values for other test scenarios.</p>
</div>
<div class="paragraph">
<p>The name of the variable is arbitrary. Feel free to specify any name you can think of. Of course you need to be careful with special characters and reserved XML entities like '&amp;', '&lt;', '&gt;'. If you are familiar with Java or any other programming language simply think of the naming rules there and you will be fine with working on Citrus variables, too. The value of a variable can be any character sequence. But again be aware of special XML characters like "&lt;" that need to be escaped ("&lt;") when used in variable values.</p>
</div>
<div class="paragraph">
<p>The advantage of variables is obvious. Once declared the variables can be referenced many times in the test. This makes it very easy to vary different test cases by adjusting the variables for different means (e.g. use different error codes in test cases).</p>
</div>
<div class="sect2">
<h3 id="global-variables"><a class="anchor" href="#global-variables"></a><a class="link" href="#global-variables">6.1. Global variables</a></h3>
<div class="paragraph">
<p>The last section told us to use variables as they are very useful and extend the maintainability of test cases. Now that every test case defines local variables you can also define global variables. The global variables are valid in all tests by default. This is a good opportunity to declare constant values for all tests. As these variables are global we need to add those to the basic Spring application context file. The following example demonstrates how to add global variables in Citrus:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:global-variables&gt;</span>
    <span class="tag">&lt;citrus:variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">projectName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Citrus Integration Testing</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TestUser</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/citrus:global-variables&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We add the Spring bean component to the application context file. The component receives a list of name-value variable elements. You can reference the global variables in your test cases as usual.</p>
</div>
<div class="paragraph">
<p>Another possibility to set global variables is to load those from external property files. This may give you more powerful global variables with user specific properties for instance. See how to load property files as global variables in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:global-variables&gt;</span>
    <span class="tag">&lt;citrus:file</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:global-variable.properties</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/citrus:global-variables&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We have just added a file path reference to the global variables component. Citrus loads the property file content as global test variables. You can mix property file and name-value pair variable definitions in the global variables component.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The global variables can have variable expressions and Citrus functions. It is possible to use previously defined global variables as values of new variables, like in this example:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">user=Citrus
greeting=Hello ${user}!
date=citrus:currentDate('yyyy-MM-dd')</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="create-variables-with-cdata"><a class="anchor" href="#create-variables-with-cdata"></a><a class="link" href="#create-variables-with-cdata">6.2. Create variables with CDATA</a></h3>
<div class="paragraph">
<p>When using th XML test case DSL we can not have XML variable values out of the box. This would interfere with the XML DSL elements defined in the Citrus testcase XSD schema. You can use CDATA sections within the variable value element in order to do this though.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;variables&gt;</span>
    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">persons</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;value&gt;</span>
            <span class="tag">&lt;data&gt;</span>
                <span class="inline-delimiter">&lt;![CDATA[</span>
                  &lt;persons&gt;
                    &lt;person&gt;
                      &lt;name&gt;Theodor&lt;/name&gt;
                      &lt;age&gt;10&lt;/age&gt;
                    &lt;/person&gt;
                    &lt;person&gt;
                      &lt;name&gt;Alvin&lt;/name&gt;
                      &lt;age&gt;9&lt;/age&gt;
                    &lt;/person&gt;
                  &lt;/persons&gt;
                <span class="inline-delimiter">]]&gt;</span>
            <span class="tag">&lt;/data&gt;</span>
        <span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;/variable&gt;</span>
<span class="tag">&lt;/variables&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That is how you can use XML variable values in the XML DSL. In the Java DSL we do not have these problems.</p>
</div>
</div>
<div class="sect2">
<h3 id="create-variables-with-groovy"><a class="anchor" href="#create-variables-with-groovy"></a><a class="link" href="#create-variables-with-groovy">6.3. Create variables with Groovy</a></h3>
<div class="paragraph">
<p>You can also use a script to create variable values. This is extremely handy when you have very complex variable values. Just code a small Groovy script for instance in order to define the variable value. A small sample should give you the idea how that works:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;variables&gt;</span>
    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">avg</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;value&gt;</span>
            <span class="tag">&lt;script</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="inline">                &lt;![CDATA[
                    a = <span class="integer">4</span>
                    b = <span class="integer">6</span>
                    <span class="keyword">return</span> (a + b) / <span class="integer">2</span>
                ]]&gt;</span>
            <span class="tag">&lt;/script&gt;</span>
        <span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;/variable&gt;</span>
    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sum</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;value&gt;</span>
            <span class="tag">&lt;script</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="inline">                &lt;![CDATA[
                    <span class="integer">5</span> + <span class="integer">5</span>
                ]]&gt;</span>
            <span class="tag">&lt;/script&gt;</span>
        <span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;/variable&gt;</span>
<span class="tag">&lt;/variables&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We use the script code right inside the variable value definition. The value of the variable is the result of the last operation performed within the script. For longer script code the use of <strong><em>`&lt;![CDATA[ ]]&gt;`</em></strong> sections is recommended.</p>
</div>
<div class="paragraph">
<p>Citrus uses the javax ScriptEngine mechanism in order to evaluate the script code. By default Groovy is supported in any Citrus project. So you can add additional ScriptEngine implementations to your project and support other script types, too.</p>
</div>
</div>
<div class="sect2">
<h3 id="escaping-variables-expression"><a class="anchor" href="#escaping-variables-expression"></a><a class="link" href="#escaping-variables-expression">6.4. Escaping variables expression</a></h3>
<div class="paragraph">
<p>The test variables expression syntax <strong><em>"${variable-name}"</em></strong> is preserved to evaluate to a test variable within the current test context. However the same syntax may be part of a message content
as is. So you need to somehow escape the syntax from beeing interpreted as test variable syntax. You can do this by using the variable expression escaping <strong>//</strong> character sequence wrapping the actual variable name like this</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>This is a escaped variable expression ${//escaped//} and should not lead to unknown variable exceptions within Citrus.</code></pre>
</div>
</div>
<div class="paragraph">
<p>The escaped expression <strong>${//escaped//}</strong> above will result in the string <strong>${escaped}</strong> where <em>escaped</em> is not treated as a test variable name but as a normal string in the message payload. This way you are able to have the same variable syntax in a
message content without interfering with the Citrus variable expression syntax. As a result Citrus will not complain about not finding the test variable <strong>escaped</strong> in the current context. The variable syntax escaping characters <strong>//</strong> are automatically
removed when the expression is processed by Citrus. So we will get the following result after processing.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>This is a escaped variable expression ${escaped} and should not lead to unknown variable exceptions within Citrus.</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-tests"><a class="anchor" href="#running-tests"></a><a class="link" href="#running-tests">7. Running tests</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Citrus test cases are nothing but Java classes that get executed within a Java runtime environment. Each Citrus test therefore relates to a Java class representing a JUnit or TestNG unit test. As optional add on a Citrus test can have a XML test declaration file. This is for those of you that do not want to code in Java. In this case the XML part holds all actions to tell Citrus what should happen in the test case. The Java part will then just be responsible for test execution and is not likely to be changed at all. In the following sections we concentrate on the Java part and the test execution mechanism.</p>
</div>
<div class="paragraph">
<p>If you create new test cases in Citrus - for instance via Maven plugin or ANT build script - Citrus generates both parts in your test directory. For example: if you create a new test named <strong>MyFirstCitrusTest</strong> you will find these two files as a result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>src/it/tests/com/consol/citrus/MyFirstCitrusTest.xml
src/it/java/com/consol/citrus/MyFirstCitrusTest.java</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you prefer to just write Java code you can throw away the XML part immediately and continue working with the Java part only. In case you are familiar with writing Java code you may just skip the test template generation via Maven or ANT and preferably just create new Citrus Java test classes on your own.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With the creation of this test we have already made a very important decision. During creation, Citrus asks you which execution framework should be used for this test. There are basically three options available: <strong><em>testng</em></strong> and <strong><em>junit</em></strong> .</p>
</div>
<div class="paragraph">
<p>So why is Citrus related to Unit tests although it is intended to be a framework for integration testing? The answer to this question is quite simple: This is because Citrus wants to benefit from both JUnit and TestNG for Java test execution. Both the JUnit and TestNG Java APIs offer various ways of execution and both frameworks are widely supported by other tools (e.g. continuous build, build lifecycle, development IDE).</p>
</div>
<div class="paragraph">
<p>Users might already know one of these frameworks and the chances are good that they are familiar with at least one of them. Everything you can do with JUnit and TestNG test cases you can do with Citrus tests also. Include them into your Maven build lifecycle. Execute tests from your IDE (Eclipse, IDEA or NetBeans). Include them into a continuous build tool (e.g. Jenkins). Generate test execution reports and test coverage reports with Sonar, Cobertura and so on. The possibilities with JUnit and TestNG are amazing.</p>
</div>
<div class="paragraph">
<p>So let us have a closer look at the Citrus TestNG and JUnit integration.</p>
</div>
<div class="sect2">
<h3 id="run-with-testng"><a class="anchor" href="#run-with-testng"></a><a class="link" href="#run-with-testng">7.1. Run with TestNG</a></h3>
<div class="paragraph">
<p>TestNG stands for next generation testing and has had a great influence in adding Java annotations to the unit test community. Citrus is able to generate TestNG Java classes that are executable as test cases. See the following standard template that Citrus will generate when having new test cases:</p>
</div>
<div class="listingblock">
<div class="title">TestNG Citrus XML test</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.consol.citrus.samples</span>;

<span class="keyword">import</span> <span class="include">org.testng.annotations.Test</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.annotations.CitrusXmlTest</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.testng.AbstractTestNGCitrusTest</span>;

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SampleIT</span> <span class="directive">extends</span> AbstractTestNGCitrusTest {
    <span class="annotation">@CitrusXmlTest</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">SampleIT</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> sampleTest() {}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are familiar with TestNG you will see that the generated Java class is nothing but a normal TestNG test class. We just extend a basic Citrus TestNG class which enables the Citrus test execution features for us. Besides that we have a usual TestNG <strong>@Test</strong> annotation placed on our class so all methods inside the class will be executed as separate test case.</p>
</div>
<div class="paragraph">
<p>The good news is that we can still use the fantastic TestNG features in our test class. You can think of parallel test execution, test groups, setup and tear down operations and so on. Just to give an example we can simply add a test group to our test like this:</p>
</div>
<div class="paragraph">
<p><code>@Test(groups = {"long-running"})</code></p>
</div>
<div class="paragraph">
<p>For more information on TestNG please visit the official homepage, where you find a complete reference documentation.</p>
</div>
<div class="paragraph">
<p>You might have noticed that the example above loads test cases from XML. This is why we are using the <strong>@CitrusXmlTest</strong> annotation. Again this approach is for people that want to write no Java code. The test logic is then provided in the XML test definition. We discuss XML tests in Citrus in more detail in <a href="#run-xml-tests">run-xml-tests</a>. Next lets have a look at a TestNG Java DSL test.</p>
</div>
<div class="paragraph">
<p>When writing tests in pure Java we have pretty much the exact same logic that applies to executing Citrus test cases. The Citrus test extends from a TestNG base class and uses the normal <strong>@Test</strong> annotations on method or class level. Here is a short sample TestNG Java class for this:</p>
</div>
<div class="listingblock">
<div class="title">TestNG Citrus Java DSL designer test</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.testng.annotations.Test</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.annotations.CitrusTest</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.dsl.testng.TestNGCitrusTestDesigner</span>;

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyFirstTestDesigner</span> <span class="directive">extends</span> TestNGCitrusTestDesigner {
    <span class="annotation">@CitrusTest</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">MyFirstIT</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> myFirstTest() {
        description(<span class="string"><span class="delimiter">&quot;</span><span class="content">First example showing the basic test case definition elements!</span><span class="delimiter">&quot;</span></span>);

        variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Test Framework</span><span class="delimiter">&quot;</span></span>);

        echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">${test}</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You see the class is quite similar to the XML test variation. Now we extend a Citrus test designer class which enables the Java DSL features in addition to the TestNG test execution for us. The basic <strong>@Test</strong> annotation for TestNG has not changed. We still have a usual TestNG class with the possibility of several methods each representing a separate unit test.</p>
</div>
<div class="paragraph">
<p>Now what has changed is the <strong>@CitrusTest</strong> annotation. Now the Citrus test logic is placed directly as the method body with using the Java domain specific language features. The XML Citrus test part is not necessary anymore. If you are wondering about the designer super class and the Java DSL methods for adding the test logic to your test please be patient we will learn more about the Java DSL features in this reference guide later on.</p>
</div>
<div class="paragraph">
<p>Up to now we just concentrate on the TestNG integration that is quite easy isn&#8217;t it.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-testng-dataproviders"><a class="anchor" href="#using-testng-dataproviders"></a><a class="link" href="#using-testng-dataproviders">7.2. Using TestNG DataProviders</a></h3>
<div class="paragraph">
<p>TestNG as a framework comes with lots of great features such as data providers. Data providers execute a test case several times. Each test execution gets a specific parameter value. With Citrus you can use those data provider parameters inside the test as variables. See the next listing on how to use TestNG data providers in Citrus:</p>
</div>
<div class="listingblock">
<div class="title">TestNG Citrus data provider test</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">DataProviderIT</span> <span class="directive">extends</span> AbstractTestNGCitrusTest {

  <span class="annotation">@CitrusXmlTest</span>
  <span class="annotation">@CitrusParameters</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@Test</span>(dataProvider = <span class="string"><span class="delimiter">&quot;</span><span class="content">messageDataProvider</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">public</span> <span class="type">void</span> DataProviderIT(ITestContext testContext) {
  }

  <span class="annotation">@DataProvider</span>
  <span class="directive">public</span> <span class="predefined-type">Object</span><span class="type">[]</span><span class="type">[]</span> messageDataProvider() {
  <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">Object</span><span class="type">[]</span><span class="type">[]</span> {
      { <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World!</span><span class="delimiter">&quot;</span></span> },
      { <span class="string"><span class="delimiter">&quot;</span><span class="content">Hallo Welt!</span><span class="delimiter">&quot;</span></span> },
      { <span class="string"><span class="delimiter">&quot;</span><span class="content">Hi Citrus!</span><span class="delimiter">&quot;</span></span> },
    };
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Above test case method is annotated with TestNG data provider called <strong>messageDataProvider</strong> . In the same class you can write the data provider that returns a list of parameter values. TestNG will execute the test case several times according to the provided parameter list. Each execution is shipped with the respective parameter value. According to the <strong>@CitrusParameter</strong> annotation the test will have a test variable called <strong>message</strong> that is accessible as usual.</p>
</div>
</div>
<div class="sect2">
<h3 id="run-with-junit5"><a class="anchor" href="#run-with-junit5"></a><a class="link" href="#run-with-junit5">7.3. Run with JUnit5</a></h3>
<div class="paragraph">
<p>JUnit5 is the new major version of the famous unit testing framework. The JUnit platform provides extension points for other frameworks to integrate with the unit testing execution. Citrus uses these extensions
in order to enable Citrus related dependency injection and parameter resolving.</p>
</div>
<div class="paragraph">
<p>You can use the Citrus JUnit5 extension on your unit test as follows:</p>
</div>
<div class="listingblock">
<div class="title">JUnit5 Citrus XML test</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.consol.citrus.samples</span>;

<span class="keyword">import</span> <span class="include">com.consol.citrus.annotations.CitrusXmlTest</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.junit.jupiter.CitrusBaseExtension</span>;
<span class="keyword">import</span> <span class="include">org.junit.jupiter.api.Test</span>;
<span class="keyword">import</span> <span class="include">org.junit.jupiter.api.extension.ExtendWith</span>;

<span class="comment">/**
 * @author Christoph Deppisch
 */</span>
<span class="annotation">@ExtendWith</span>(CitrusBaseExtension.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SampleXmlIT</span> {
    <span class="annotation">@Test</span>
    <span class="annotation">@CitrusXmlTest</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">SampleXmlIT</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> test() {}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The class above is using the JUnit5 <code>@Test</code> annotation as a normal unit test would do. In addition to that we extend with the <code>CitrusBaseExtension</code>. This enables us to use the
<code>@CitrusXmlTest</code> annotation on the test method which automatically loads the XML test case file for execution.</p>
</div>
<div class="paragraph">
<p>In case you want to use the Citrus Java DSL for writing the test logic you can use the following setup:</p>
</div>
<div class="listingblock">
<div class="title">JUnit5 Citrus Java DSL designer test</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.consol.citrus.samples</span>;

<span class="keyword">import</span> <span class="include">com.consol.citrus.annotations.CitrusResource</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.annotations.CitrusTest</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.dsl.design.TestDesigner</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.dsl.junit.jupiter.CitrusExtension</span>;
<span class="keyword">import</span> <span class="include">org.junit.jupiter.api.Test</span>;
<span class="keyword">import</span> <span class="include">org.junit.jupiter.api.extension.ExtendWith</span>;

<span class="comment">/**
 * @author Christoph Deppisch
 */</span>
<span class="annotation">@ExtendWith</span>(CitrusExtension.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SampleIT</span> {
    <span class="annotation">@Test</span>
    <span class="annotation">@CitrusTest</span>
    <span class="directive">public</span> <span class="type">void</span> test(<span class="annotation">@CitrusResource</span> TestDesigner designer) {
        designer.variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">time</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate()</span><span class="delimiter">&quot;</span></span>);
        designer.echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Citrus!</span><span class="delimiter">&quot;</span></span>);
        designer.echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">CurrentTime is: ${time}</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Java DSL test case is using the <code>CitrusExtension</code> to extend the JUnit5 test with Citrus functionality. After doing that we can use <code>@CitrusResource</code> annotated method parameters that inject the test designer.
The designer is the entrance to the Java fluent API provided by Citrus. Of course you can also inject the test runner fluent API.</p>
</div>
<div class="listingblock">
<div class="title">JUnit5 Citrus Java DSL runner test</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.consol.citrus.samples</span>;

<span class="keyword">import</span> <span class="include">com.consol.citrus.annotations.CitrusResource</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.annotations.CitrusTest</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.dsl.runner.TestRunner</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.dsl.junit.jupiter.CitrusExtension</span>;
<span class="keyword">import</span> <span class="include">org.junit.jupiter.api.Test</span>;
<span class="keyword">import</span> <span class="include">org.junit.jupiter.api.extension.ExtendWith</span>;

<span class="comment">/**
 * @author Christoph Deppisch
 */</span>
<span class="annotation">@ExtendWith</span>(CitrusExtension.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SampleIT</span> {
    <span class="annotation">@Test</span>
    <span class="annotation">@CitrusTest</span>
    <span class="directive">public</span> <span class="type">void</span> test(<span class="annotation">@CitrusResource</span> TestRunner runner) {
        runner.variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">time</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate()</span><span class="delimiter">&quot;</span></span>);
        runner.echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Citrus!</span><span class="delimiter">&quot;</span></span>);
        runner.echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">CurrentTime is: ${time}</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use <code>@TestContext</code> parameter injection in order to get access to the current test context used by Citrus. Also you can inject Citrus endpoints
via <code>@CitrusEndpoint</code> annotated field injection in your test class. This enabled you to inject endpoint components that are defined in the Citrus Spring application context configuration.</p>
</div>
<div class="listingblock">
<div class="title">JUnit5 Citrus Java DSL runner test</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.consol.citrus.samples</span>;

<span class="keyword">import</span> <span class="include">com.consol.citrus.annotations</span>.*;
<span class="keyword">import</span> <span class="include">com.consol.citrus.dsl.runner.TestRunner</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.dsl.junit.jupiter.CitrusExtension</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.http.client.HttpClient</span>;
<span class="keyword">import</span> <span class="include">org.junit.jupiter.api.Test</span>;
<span class="keyword">import</span> <span class="include">org.junit.jupiter.api.extension.ExtendWith</span>;
<span class="keyword">import</span> <span class="include">org.springframework.http.HttpStatus</span>;

<span class="comment">/**
 * @author Christoph Deppisch
 */</span>
<span class="annotation">@ExtendWith</span>(CitrusExtension.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SampleIT</span> {

    <span class="annotation">@CitrusEndpoint</span>
    <span class="directive">private</span> HttpClient httpClient;

    <span class="annotation">@Test</span>
    <span class="annotation">@CitrusTest</span>
    <span class="directive">public</span> <span class="type">void</span> test(<span class="annotation">@CitrusResource</span> TestRunner runner) {
        runner.http(action -&gt; action.client(httpClient)
                                .send()
                                .get(<span class="string"><span class="delimiter">&quot;</span><span class="content">/hello</span><span class="delimiter">&quot;</span></span>));

        runner.http(action -&gt; action.client(httpClient)
                                .receive()
                                .response(HttpStatus.OK));
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="run-with-junit4"><a class="anchor" href="#run-with-junit4"></a><a class="link" href="#run-with-junit4">7.4. Run with JUnit4</a></h3>
<div class="paragraph">
<p>JUnit is a very popular unit test framework for Java applications widely accepted and widely supported by many tools. In general Citrus supports both JUnit and TestNG as test execution frameworks. Although the TestNG customization features are slightly more powerful than those offered by JUnit you as a Citrus user should be able to use the framework of your choice. The complete support for executing test cases with package scans and multiple annotated methods is given for both frameworks. If you choose <strong>junit</strong> as execution framework Citrus generates a Java file that looks like this:</p>
</div>
<div class="listingblock">
<div class="title">JUnit4 Citrus XML test</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.consol.citrus.samples</span>;

<span class="keyword">import</span> <span class="include">org.junit.Test</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.annotations.CitrusXmlTest</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.junit.AbstractJUnit4CitrusTest</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">SampleIT</span> <span class="directive">extends</span> AbstractJUnit4CitrusTest {
    <span class="annotation">@Test</span>
    <span class="annotation">@CitrusXmlTest</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">SampleIT</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> sampleTest() {}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>JUnit and TestNG as frameworks reveal slight differences, but the idea is the same. We extend a base JUnit Citrus test class and have one to many test methods that load the XML Citrus test cases for execution. As you can see the test class can hold several annotated test methods that get executed as JUnit tests. The fine thing here is that we are still able to use all JUnit features such as before/after test actions or enable/disable tests.</p>
</div>
<div class="paragraph">
<p>The Java JUnit classes are simply responsible for loading and executing the Citrus test cases. Citrus takes care on loading the XML test as a file system resource and to set up the Spring application context. The test is executed and success/failure state is reported exactly like a usual JUnit unit test would do. This also means that you can execute this Citrus JUnit class like every other JUnit test, especially out of any Java IDE, with Maven, with ANT and so on. This means that you can easily include the Citrus test execution into you software building lifecycle and continuous build.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
So now we know both TestNG and JUnit support in Citrus. Which framework should someone choose? To be honest, there is no easy answer to this question. The basic features are equivalent, but TestNG offers better possibilities for designing more complex test setup with test groups and tasks before and after a group of tests. This is why TestNG is the default option in Citrus. But in the end you have to decide on your own which framework fits best for your project.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The first example seen here is using <strong>@CitrusXmlTest</strong> annotation in order to load a XML file as test. The Java part is then just an empty envelope for executing the test with JUnit. This approach is for those of you that are not familiar with Java at all. You can find more information on loading XML files as Citrus tests in <a href="#run-xml-tests">run-xml-tests</a>. Secondly of course we also have the possibility to use the Citrus Java DSL with JUnit. See the following example on how this looks like:</p>
</div>
<div class="listingblock">
<div class="title">JUnit4 Citrus Java DSL test</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.consol.citrus.samples</span>;

<span class="keyword">import</span> <span class="include">com.consol.citrus.annotations.CitrusTest</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.dsl.JUnit4CitrusTestDesigner</span>;
<span class="keyword">import</span> <span class="include">org.junit.Test</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">SampleIT</span> <span class="directive">extends</span> JUnit4CitrusTestDesigner {

    <span class="annotation">@Test</span>
    <span class="annotation">@CitrusTest</span>
    <span class="directive">public</span> <span class="type">void</span> EchoSampleIT() {
        variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">time</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate()</span><span class="delimiter">&quot;</span></span>);
        echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Citrus!</span><span class="delimiter">&quot;</span></span>);
        echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">CurrentTime is: ${time}</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@Test</span>
    <span class="annotation">@CitrusTest</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">EchoIT</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> echoTest() {
        echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Citrus!</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Java DSL test case looks quite familiar as we also use the JUnit4 <strong>@Test</strong> annotation in order to mark our test for unit test execution. In addition to that we add a <strong>@CitrusTest</strong> annotation and extend from a basic JUnit4 Citrus test designer which enables the Java domain specific language features. The Citrus test logic goes directly to the method block. There is no need for a XML test file anymore.</p>
</div>
<div class="paragraph">
<p>As you can see the <strong>@CitrusTest</strong> annotation supports multiple test methods in one single class. Each test is prepared and executed separately just as you know it from JUnit. You can define an explicit Citrus test name that is used in Citrus test reports. If no explicit test name is given the test method name will be used as a test name.</p>
</div>
<div class="paragraph">
<p>If you need to know more details about the test designer and on how to use the Citrus Java DSL just continue with this reference guide. We will describe the capabilities in detail later on.</p>
</div>
</div>
<div class="sect2">
<h3 id="run-xml-tests"><a class="anchor" href="#run-xml-tests"></a><a class="link" href="#run-xml-tests">7.5. Running XML tests</a></h3>
<div class="paragraph">
<p>Now we also use the <code>@CitrusXmlTest</code> annotation in the Java class. This annotation makes Citrus search for a XML file that represents the Citrus test within your classpath. Later on we will also discuss another Citrus annotation (<code>@CitrusTest</code>) which stands for defining the Citrus test just with Java domain specific language features. For now we continue to deal with the XML Citrus test execution.</p>
</div>
<div class="paragraph">
<p>The default naming convention requires a XML file with the tests name in the same package that the Java class is placed in. In the basic example above this means that Citrus searches for a XML test file in <strong>com/consol/citrus/samples/SampleIT.xml</strong> . You tell Citrus to search for another XML file by using the @CitrusXmlTest annotation properties. Following annotation properties are valid:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
name
</td>
<td class="hdlist2">
<p>List of test case names to execute. Names also define XML file names to look for (<strong>.xml</strong> file extension is not needed here).</p>
</td>
</tr>
<tr>
<td class="hdlist1">
packageName
</td>
<td class="hdlist2">
<p>Custom package location for the XML files to load</p>
</td>
</tr>
<tr>
<td class="hdlist1">
packageScan
</td>
<td class="hdlist2">
<p>List of packages that are automatically scanned for XML test files to execute. For each XML file found separate test is executed. Note that this performs a Java Classpath package scan so all XML files in package are assumed to be valid Citrus XML test cases. In order to minimize the amount of accidentally loaded XML files the scan will only load XML files with <code>**/*Test.xml</code> and <code>**/*IT.xml</code> file name pattern.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also mix the various CitrusXmlTest annotation patterns in a single Java class. So we are able to have several test cases in one single Java class. Each annotated method represents one or more Citrus XML test cases. Se the following example to see what this is about.</p>
</div>
<div class="listingblock">
<div class="title">TestNG Citrus XML test</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SampleIT</span> <span class="directive">extends</span> AbstractTestNGCitrusTest {
    <span class="annotation">@CitrusXmlTest</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">SampleIT</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> sampleTest() {}

    <span class="annotation">@CitrusXmlTest</span>(name = { <span class="string"><span class="delimiter">&quot;</span><span class="content">SampleIT</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">AnotherIT</span><span class="delimiter">&quot;</span></span> })
    <span class="directive">public</span> <span class="type">void</span> multipleTests() {}

    <span class="annotation">@CitrusXmlTest</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">OtherIT</span><span class="delimiter">&quot;</span></span>, packageName = <span class="string"><span class="delimiter">&quot;</span><span class="content">com.other.testpackage</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> otherPackageTest() {}

    <span class="annotation">@CitrusXmlTest</span>(packageScan =  { <span class="string"><span class="delimiter">&quot;</span><span class="content">com.some.testpackage</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">com.other.testpackage</span><span class="delimiter">&quot;</span></span> })
    <span class="directive">public</span> <span class="type">void</span> packageScanTest() {}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You are free to combine these test annotations as you like in your class. As the whole Java class is annotated with the TestNG <strong>@Test</strong> annotation each method gets executed automatically. Citrus will also take care on executing each XML test case as a separate unit test. So the test reports will have the exact number of executed tests and the JUnit/TestNG test reports do have the exact test outline for further usage (e.g. in continuous build reports).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When test execution takes place each test method annotation is evaluated in sequence. XML test cases that match several times, for instance by explicit name reference and a package scan will be executed several times respectively.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The best thing about using the <strong>@CitrusXmlTest</strong> annotation is that you can continue to use the fabulous TestNG capabilities (e.g. test groups, invocation count, thread pools, data providers, and so on).</p>
</div>
<div class="paragraph">
<p>So now we have seen how to execute a Citrus XML test with TestNG.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration"><a class="anchor" href="#configuration"></a><a class="link" href="#configuration">8. Configuration</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>You have several options in customizing the Citrus project configuration. Citrus uses default settings that can be overwritten to some extend. As a framework Citrus internally works with the Spring IoC container. So Citrus will start a Spring application context and register several components as Spring beans. You can customize the behavior of these beans and you can add custom settings by setting system properties.</p>
</div>
<div class="sect2">
<h3 id="application-environment-settings"><a class="anchor" href="#application-environment-settings"></a><a class="link" href="#application-environment-settings">8.1. Application environment settings</a></h3>
<div class="paragraph">
<p>Citrus as an application reads general settings from system properties and environment variables. The mechanism used is based on the property placeholder resource management. Application settings are
read on startup by evaluating system properties first. After that environment variables get consulted for default values. If non of these is set the default value in Citrus sources is used.</p>
</div>
<div class="paragraph">
<p>This settings mechanism is well suited for both usual Java runtime environment and containerized runtime environments such as Docker or Kubernetes. Following from that you can overwrite general Citrus application settings by
just providing a system property or environment variable on your local environment. The following settings do support this kind of environment configuration.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. System properties</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">System properties</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">citrus.application.properties</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File location for application property file that holds other settings. These properties get loaded as system properties on startup. (default="citrus-application.properties")</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">citrus.spring.application.context</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File location for Spring XML configurations (default="classpath*:citrus-context.xml")</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">citrus.spring.java.config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class name for Spring Java config (default=null)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">citrus.file.encoding</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default file encoding used in Citrus when reading and writing file content (default=Charset.defaultCharset())</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">citrus.default.message.type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default message type for validating payloads (default="XML")</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">citrus.test.name.variable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default test name variable that is automatically created for each test (default="citrus.test.name")</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">citrus.test.package.variable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default test package variable that is automatically created for each test (default="citrus.test.package")</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">citrus.default.src.directory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default test source directory (default="src/test/")</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">citrus.xml.file.name.pattern</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File name patterns used for XML test file package scan (default="/**/*Test.xml,/**/*IT.xml")</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">citrus.java.file.name.pattern</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File name patterns used for Java test sources package scan (default="/**/*Test.java,/**/*IT.java")</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Same properties are settable via environment variables.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. Environment variables</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Environment variable</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CITRUS_APPLICATION_PROPERTIES</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File location for application property file that holds other settings. These properties get loaded as system properties on startup. (default="citrus-application.properties")</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CITRUS_SPRING_APPLICATION_CONTEXT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File location for Spring XML configurations (default="classpath*:citrus-context.xml")</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CITRUS_SPRING_JAVA_CONFIG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class name for Spring Java config (default=null)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CITRUS_FILE_ENCODING</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default file encoding used in Citrus when reading and writing file content (default=Charset.defaultCharset())</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CITRUS_DEFAULT_MESSAGE_TYPE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default message type for validating payloads (default="XML")</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CITRUS_TEST_NAME_VARIABLE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default test name variable that is automatically created for each test (default="citrus.test.name")</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CITRUS_TEST_PACKAGE_VARIABLE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default test package variable that is automatically created for each test (default="citrus.test.package")</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CITRUS_DEFAULT_SRC_DIRECTORY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default test source directory (default="src/test/")</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CITRUS_XML_FILE_NAME_PATTERN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File name patterns used for XML test file package scan (default="/**/*Test.xml,/**/*IT.xml")</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CITRUS_JAVA_FILE_NAME_PATTERN</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File name patterns used for Java test sources package scan (default="/**/*Test.java,/**/*IT.java")</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="application-property-file"><a class="anchor" href="#application-property-file"></a><a class="link" href="#application-property-file">8.2. Application property file</a></h3>
<div class="paragraph">
<p>As mentioned in the previous section Citrus as a framework references some basic settings from system environment properties or variables. You can overwrite these settings in a central property file which is loaded at the very beginning of the Citrus runtime.
The properties in that file are automatically loaded as Java system properties. Just add a property file named <strong>citrus-application.properties</strong> to your project classpath. This property file contains customized settings such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">citrus.spring.application.context=classpath*:citrus-custom-context.xml
citrus.spring.java.config=com.consol.citrus.config.MyCustomConfig
citrus.file.encoding=UTF-8
citrus.default.message.type=XML
citrus.xml.file.name.pattern=/**/*Test.xml,/**/*IT.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus automatically loads these application properties at startup. All properties are also settable with Java system properties. The location of the <strong>citrus-application.properties</strong> file is customizable with the system property <strong>citrus.application.properties</strong> or environment variable <strong>CITRUS_APPLICATION_PROPERTIES</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">System</span>.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus.application.properties</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">custom/path/to/citrus-application.properties</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="spring-xml-application-context"><a class="anchor" href="#spring-xml-application-context"></a><a class="link" href="#spring-xml-application-context">8.3. Spring XML application context</a></h3>
<div class="paragraph">
<p>Citrus starts a Spring application context and adds some default Spring bean components. By default Citrus will load some internal Spring Java config classes defining those bean components. At some point you might add some custom beans to that basic application context. This is why Citrus will search for custom Spring application context files in your project. These are automatically loaded.</p>
</div>
<div class="paragraph">
<p>By default Citrus looks for custom XML Spring application context files in this location: <strong>classpath</strong>:citrus-context.xml* . So you can add a file named <strong>citrus-context.xml</strong> to your project classpath and Citrus will load all Spring beans automatically.</p>
</div>
<div class="paragraph">
<p>The location of this file can be customized by setting a System property <strong>citrus.spring.application.context</strong> . So you can customize the XML Spring application context file location. The System property is settable with Maven surefire and failsafe plugin for instance or via Java before the Citrus framework gets loaded.</p>
</div>
<div class="paragraph">
<p>See the following sample XML configuration which is a normal Spring bean XML configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:citrus</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/config</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/context</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
    <span class="content">http://www.citrusframework.org/schema/config http://www.citrusframework.org/schema/config/citrus-config.xsd</span>
    <span class="content">http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

  <span class="tag">&lt;citrus:schema-repository</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">schemaRepository</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you can add some Spring beans and you can use the Citrus XML components such as <strong>schema-repository</strong> for adding custom beans and components to your Citrus project. Citrus provides several namespaces for custom Spring XML components. These are described in more detail in the respective chapters and sections in this reference guide.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can also use import statements in this Spring application context in order to load other configuration files. So you are free to modularize your configuration in several files that get loaded by Citrus.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="spring-java-config"><a class="anchor" href="#spring-java-config"></a><a class="link" href="#spring-java-config">8.4. Spring Java config</a></h3>
<div class="paragraph">
<p>Using XML Spring application context configuration is the default behavior of Citrus. However some people might prefer pure Java code configuration. You can do that by adding a System property <strong>citrus.spring.java.config</strong> with a custom Spring Java config class as value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">System</span>.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus.spring.java.config</span><span class="delimiter">&quot;</span></span>, MyCustomConfig.class.getName())</code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus will load the Spring bean configurations in <strong>MyCustomConfig.class</strong> as Java config then. See the following example for custom Spring Java configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.consol.citrus.TestCase</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.report</span>.*;
<span class="keyword">import</span> <span class="include">org.slf4j.Logger</span>;
<span class="keyword">import</span> <span class="include">org.slf4j.LoggerFactory</span>;
<span class="keyword">import</span> <span class="include">org.springframework.context.annotation.Bean</span>;
<span class="keyword">import</span> <span class="include">org.springframework.context.annotation.Configuration</span>;

<span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyCustomConfig</span> {

    <span class="annotation">@Bean</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">customTestListener</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> TestListener customTestListener() {
        <span class="keyword">return</span> <span class="keyword">new</span> PlusMinusTestReporter();
    }

    <span class="directive">private</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">PlusMinusTestReporter</span> <span class="directive">extends</span> AbstractTestListener <span class="directive">implements</span> TestReporter {

        <span class="comment">/** Logger */</span>
        <span class="directive">private</span> <span class="predefined-type">Logger</span> log = LoggerFactory.getLogger(CustomBeanConfig.class);

        <span class="directive">private</span> <span class="predefined-type">StringBuilder</span> testReport = <span class="keyword">new</span> <span class="predefined-type">StringBuilder</span>();

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> onTestSuccess(TestCase test) {
            testReport.append(<span class="string"><span class="delimiter">&quot;</span><span class="content">+</span><span class="delimiter">&quot;</span></span>);
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> onTestFailure(TestCase test, <span class="predefined-type">Throwable</span> cause) {
            testReport.append(<span class="string"><span class="delimiter">&quot;</span><span class="content">-</span><span class="delimiter">&quot;</span></span>);
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> generateTestResults() {
            log.info(testReport.toString());
        }

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> clearTestResults() {
            testReport = <span class="keyword">new</span> <span class="predefined-type">StringBuilder</span>();
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also mix XML and Java configuration so Citrus will load both configuration to the Spring bean application context on startup.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="endpoints"><a class="anchor" href="#endpoints"></a><a class="link" href="#endpoints">9. Endpoints</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In one of the previous chapters we have discussed the basic test case structure as we introduced <strong>variables</strong> and <strong>test actions</strong> . The &lt;actions&gt; section contains a list of test actions that take place during the test case. Each test action is executed in sequential order by default. Citrus offers several built-in test actions that the user can choose from to construct a complex testing workflow without having to code everything from scratch. In particular Citrus aims to provide all the test actions that you need as predefined components ready for you to use. The goal is to minimize the coding effort for you so you can concentrate on the test logic itself.</p>
</div>
<div class="paragraph">
<p>Exactly the same approach is used in Citrus to provide ready-to-use endpoint component for connecting to different message transports. There are several ways in an enterprise application to exchange messages with some other application. We have synchronous interfaces like Http and SOAP WebServices. We have asynchronous messaging with JMS or file transfer FTP interfaces.</p>
</div>
<div class="paragraph">
<p>Citrus provides endpoint components as client and server to connect with these typical message transports. So you as a tester must not care about how to send a message to a JMS queue. The Citrus endpoints are configured in the Spring application context and receive endpoint specific properties like endpoint uri or ports or message timeouts as configuration.</p>
</div>
<div class="paragraph">
<p>The next figure shows a typical message sending endpoint component in Citrus:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/figure_002.jpg" alt="figure_002.jpg"></span></p>
</div>
<div class="paragraph">
<p>The endpoint producer publishes messages to a destination. This destination can be a JMS queue/topic, a SOAP WebService endpoint, a Http URL, a FTP folder destination and so on. The producer just takes a previously defined message definition (header and payload) and sends it to the message destination.</p>
</div>
<div class="paragraph">
<p>Similar to that Citrus defines the several endpoint consumer components to consume messages from destinations. This can be a simple subscription on message channels and JMS queues/topics. In case of SOAP WebServices and Http GET/POST things are more complicated as we have to provide a server component that clients can connect to. We will handle server related communication in more detail later on. For now the endpoint consumer component in its most simple way is defined like this:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/figure_003.jpg" alt="figure_003.jpg"></span></p>
</div>
<div class="paragraph">
<p>This is all you need to know about Citrus endpoints. We have mentioned that the endpoints are defined in the Spring application context. Let&#8217;s have a simple example that shows the basic idea:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-jms:endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">destination-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Citrus.HelloService.Request.Queue</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">connection-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myConnectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a simple JMS endpoint component in Citrus. The endpoint XML bean definition follows a custom XML namespace and defines endpoint specific properties like the JMS destination name and the JMS connection factory. The endpoint id is a significant property as the test cases will reference this endpoint when sending and receiving messages by its identifier.</p>
</div>
<div class="paragraph">
<p>In the next sections you will learn how a test case uses those endpoint components for producing and consuming messages.</p>
</div>
<div class="sect2">
<h3 id="send-messages-with-endpoints"><a class="anchor" href="#send-messages-with-endpoints"></a><a class="link" href="#send-messages-with-endpoints">9.1. Send messages with endpoints</a></h3>
<div class="paragraph">
<p>The &lt;send&gt; action in a test case publishes messages to a destination. The actual message transport connection is defined with the endpoint component. The test case simply defines the message contents and references a predefined message endpoint component by its identifier. Endpoint specific configurations are centralized in the Spring bean application context while multiple test cases can reference the endpoint to actually publish the constructed message to a destination. There are several message endpoint implementations in Citrus available representing different transport protocols like JMS, SOAP, HTTP, TCP/IP and many more.</p>
</div>
<div class="paragraph">
<p>Again the type of transport to use is not specified inside the test case but in the message endpoint definition. The separation of concerns (test case/message sender transport) gives us a good flexibility of our test cases. The test case does not know anything about connection factories, queue names or endpoint uri, connection timeouts and so on. The transport internals underneath a sending test action can change easily without affecting the test case definition. We will see later in this document how to create different message endpoints for various transports in Citrus. For now we concentrate on constructing the message content to be sent.</p>
</div>
<div class="paragraph">
<p>We assume that the message&#8217;s payload will be plain XML format. Citrus uses XML as the default data format for message payload data. But Citrus is not limited to XML message format though; you can always define other message data formats such as JSON, plain text, CSV. As XML is still a very popular message format in enterprise applications and message-based solution architectures we have this as a default format. Anyway Citrus works best on XML payloads and you will see a lot of example code in this document using XML. Finally let us have a look at a first example how a sending action is defined in the test.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SendMessageTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;description&gt;</span>Basic send message example<span class="tag">&lt;/description&gt;</span>

    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;message&gt;</span>
                <span class="tag">&lt;payload&gt;</span>
                    <span class="tag">&lt;TestMessage&gt;</span>
                        <span class="tag">&lt;Text&gt;</span>Hello!<span class="tag">&lt;/Text&gt;</span>
                    <span class="tag">&lt;/TestMessage&gt;</span>
                <span class="tag">&lt;/payload&gt;</span>
            <span class="tag">&lt;/message&gt;</span>
            <span class="tag">&lt;header&gt;</span>
                <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/header&gt;</span>
        <span class="tag">&lt;/send&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now lets have a closer look at the sending action. The <strong>'endpoint'</strong> attribute might catch your attention first. This attribute references the message endpoint in Citrus configuration by its identifier. As previously mentioned the message endpoint definition lives in a separate configuration file and contains the actual message transport settings. In this example the <strong>"helloServiceEndpoint"</strong> is referenced which is a JMS endpoint for sending out messages to a JMS queue for instance.</p>
</div>
<div class="paragraph">
<p>The test case is not aware of any transport details, because it does not have to. The advantages are obvious: On the one hand multiple test cases can reference the message endpoint definition for better reuse. Secondly test cases are independent of message transport details. So connection factories, user credentials, endpoint uri values and so on are not present in the test case.</p>
</div>
<div class="paragraph">
<p>In other words the <strong>"endpoint"</strong> attribute of the <code>&lt;send&gt;</code> element specifies which message endpoint definition to use and therefore where the message should go to. Once again all available message endpoints are configured in a separate Citrus configuration file. Be sure to always pick the right message endpoint type in order to publish your message to the right destination.</p>
</div>
<div class="paragraph">
<p>If you do not like the XML language you can also use pure Java code to define the same test. In Java you would also make use of the message endpoint definition and reference this instance. The same test as shown above in Java DSL looks like this:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.testng.ITestContext</span>;
<span class="keyword">import</span> <span class="include">org.testng.annotations.Test</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.annotations.CitrusTest</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.dsl.testng.TestNGCitrusTestDesigner</span>;

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SendMessageTestDesigner</span> <span class="directive">extends</span> TestNGCitrusTestDesigner {

    <span class="annotation">@CitrusTest</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">SendMessageTest</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> sendMessageTest() {
        description(<span class="string"><span class="delimiter">&quot;</span><span class="content">Basic send message example</span><span class="delimiter">&quot;</span></span>);

        send(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
            .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;TestMessage&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Text&gt;Hello!&lt;/Text&gt;</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/TestMessage&gt;</span><span class="delimiter">&quot;</span></span>)
            .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of using the XML tags for send we use methods from <strong>TestNGCitrusTestDesigner</strong> class. The same message endpoint is referenced within the send message action. The payload is constructed as plain Java character sequence which is a bit verbose. We will see later on how we can improve this. For now it is important to understand the combination of send test action and a message endpoint.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
It is good practice to follow naming conventions when defining names for message endpoints. The intended purpose of the message endpoint as well as the sending/receiving actor should be clear when choosing the name. For instance messageEndpoint1, messageEndpoint2 will not give you much hints to the purpose of the message endpoint.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is basically how to send messages in Citrus. The test case is responsible for constructing the message content while the predefined message endpoint holds transport specific settings. Test cases reference endpoint components to publish messages to the outside world. This is just the start of action. Citrus supports a whole package of other ways how to define and manipulate the message contents. Read more about message sending actions in <a href="#actions-send">actions-send</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="receive-messages-with-endpoints"><a class="anchor" href="#receive-messages-with-endpoints"></a><a class="link" href="#receive-messages-with-endpoints">9.2. Receive messages with endpoints</a></h3>
<div class="paragraph">
<p>Now we have a look at the message receiving part inside the test. A simple example shows how it works.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;TestMessage&gt;</span>
                <span class="tag">&lt;Text&gt;</span>Hello!<span class="tag">&lt;/Text&gt;</span>
            <span class="tag">&lt;/TestMessage&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;header&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we recap the send action of the previous chapter we can identify some common mechanisms that apply for both sending and receiving actions. The test action also uses the <strong>endpoint</strong> attribute for referencing a predefined message endpoint. This time we want to receive a message from the endpoint. Again the test is not aware of the transport details such as JMS connections, endpoint uri, and so on. The message endpoint component encapsulates this information.</p>
</div>
<div class="paragraph">
<p>Before we go into detail on validating the received message we have a quick look at the Java DSL variation for the receive action. The same receive action as above looks like this in Java DSL.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
        .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;TestMessage&gt;</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Text&gt;Hello!&lt;/Text&gt;</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/TestMessage&gt;</span><span class="delimiter">&quot;</span></span>)
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The receive action waits for a message to arrive. The whole test execution is stopped while waiting for the message. This is important to ensure the step by step test workflow processing. Of course you can specify message timeouts so the receiver will only wait a given amount of time before raising a timeout error. Following from that timeout exception the test case fails as the message did not arrive in time. Citrus defines default timeout settings for all message receiving tasks.</p>
</div>
<div class="paragraph">
<p>At this point you know the two most important test actions in Citrus. Sending and receiving actions will become the main components of your integration tests when dealing with loosely coupled message based components in a enterprise application environment. It is very easy to create complex message flows, meaning a sequence of sending and receiving actions in your test case. You can replicate use cases and test your message exchange with extended message validation capabilities. See <a href="#actions-receive">actions-receive</a> for a more detailed description on how to validate incoming messages and how to expect message contents in a test case.</p>
</div>
</div>
<div class="sect2">
<h3 id="local-message-store"><a class="anchor" href="#local-message-store"></a><a class="link" href="#local-message-store">9.3. Local message store</a></h3>
<div class="paragraph">
<p>All messages that are sent and received during a test case are stored in a local memory storage. This is because we might want to access the message content later on in a test case. We can do so by using message store functions for loading messages that have been exchanged earlier in the test. When
storing a message in the local storage Citrus uses a message name as identifier key. This message name is later on used to access the message. You can define the message name in any send or receive action:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloMessage</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;TestMessage&gt;</span>
                <span class="tag">&lt;Text&gt;</span>Hello!<span class="tag">&lt;/Text&gt;</span>
            <span class="tag">&lt;/TestMessage&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;header&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
        .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloMessage</span><span class="delimiter">&quot;</span></span>)
        .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;TestMessage&gt;</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Text&gt;Hello!&lt;/Text&gt;</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/TestMessage&gt;</span><span class="delimiter">&quot;</span></span>)
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The receive operation above set the message name to <strong>helloMessage</strong>. The message received is automatically stored in the local storage with that name. You can access
the message content for instance by using a function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;echo&gt;</span>
    <span class="tag">&lt;message&gt;</span>citrus:message(helloMessage.payload())<span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The function loads the <strong>helloMessage</strong> and prints the payload information with the <strong>echo</strong> test action. In combination with Xpath or JsonPath functions this mechanism is a good
way to access the exchanged message contents later in a test case.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The storage is for both sent and received messages in a test case. The storage is per test case and contains all sent and received messages.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When no explicit message name is given the local storage will construct a default message name. The default name is built from the action (send or receive) plus the endpoint used
to exchange the message. For instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>send(helloEndpoint)
receive(helloEndpoint)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The names above would be generated by a send and receive operation on the endpoint named <strong>helloEndpoint</strong>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The message store is not able to handle multiple message of the same name in one test case. So messages with identical names will overwrite existing messages in the local storage.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now we have seen the basic endpoint concept in Citrus. The endpoint components represent the connections to the test boundary systems. This is how we can connect to the system under test for message exchange. And this is our main goal with this integration test framework. We want to provide easy access to common message transports on client and server side so that we can test the communication interfaces on a real message transport exchange.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="message-validation"><a class="anchor" href="#message-validation"></a><a class="link" href="#message-validation">10. Message validation</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>When Citrus receives a message from external applications it is time to verify the message content. This message validation includes syntax rules as well as semantic values that need to be compared to an expected behavior. Citrus provides powerful message validation capabilities. Each incoming message is validated with syntax and semantics. The tester is able to define expected message headers and payloads. Citrus message validator implementations will compare the messages and report differences as test failure. With the upcoming sections we have a closer look at message validation of XML messages with XPath and XML schema validation and further message formats like JSON and plaintext.</p>
</div>
<div class="sect2">
<h3 id="xml-message-validation"><a class="anchor" href="#xml-message-validation"></a><a class="link" href="#xml-message-validation">10.1. XML message validation</a></h3>
<div class="paragraph">
<p>XML is a very common message format especially in the SOAP WebServices and JMS messaging world. Citrus provides XML message validator implementations that are able to compare XML message structures. The validator will notice differences in the XML message structure and supports XML namespaces, attributes and XML schema validation. The default XML message validator implementation is active by default and can be overwritten with a custom implementation using the bean id <strong>defaultXmlMessageValidator</strong> .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultXmlMessageValidator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.validation.xml.DomXmlMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The default XML message validator is very powerful when it comes to compare XML structures. The validator supports namespaces with different prefixes and attributes als well as namespace qualified attributes. See the following sections for a detailed description of all capabilities.</p>
</div>
<div class="sect3">
<h4 id="xml-payload-validation"><a class="anchor" href="#xml-payload-validation"></a><a class="link" href="#xml-payload-validation">10.1.1. XML payload validation</a></h4>
<div class="paragraph">
<p>Once Citrus has received a message the tester can validate the message contents in various ways. First of all the tester can compare the whole message payload to a predefined control message template.</p>
</div>
<div class="paragraph">
<p>The receiving action offers following elements for control message templates:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">&lt;payload&gt;</dt>
<dd>
<p>Defines the message payload as nested XML message template. The whole message payload is defined inside the test case.</p>
</dd>
<dt class="hdlist1">&lt;data&gt;</dt>
<dd>
<p>Defines an inline XML message template as nested CDATA. Slightly different to the payload variation as we define the whole message payload inside the test case as CDATA section.</p>
</dd>
<dt class="hdlist1">&lt;resource&gt;</dt>
<dd>
<p>Defines an expected XML message template via external file resources. This time the payload is loaded at runtime from the external file.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Both ways inline payload definition or external file resource give us a control message template that the test case expects to arrive. Citrus uses this control template for extended message comparison. All elements, namespaces, attributes and node values are validated in this comparison. When using XML message payloads Citrus will navigate through the whole XML structure validating each element and its content. Same with JSON payloads.</p>
</div>
<div class="paragraph">
<p>Only in case received message and control message are equal to each other as expected the message validation will pass. In case differences occur Citrus gives detailed error messages and the test case fails.</p>
</div>
<div class="paragraph">
<p>The control message template is not necessarily very static. Citrus supports various ways to add dynamic message content on the one side and on the other side Citrus can ignore some elements that are not part of message comparison (e.g. when generated content or timestamps are part of the message content). The tester can enrich the expected message template with test variables or ignore expressions so we get a more robust validation mechanism. We will talk about this in the next sections to come.</p>
</div>
<div class="paragraph">
<p>When using the Citrus Java DSL you will face a verbose message payload definition. This is because Java does not support multiline character sequence values as Strings. We have to use verbose String concatenation when constructing XML message payload contents for instance. In addition to that reserved characters like quotes must be escaped and line breaks must be explicitly added. All these impediments let me suggest to use external file resources in Java DSL when dealing with large complex message payload data. Here is an example:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> receiveMessageTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceServer</span><span class="delimiter">&quot;</span></span>)
        .payload(<span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">com/consol/citrus/message/data/TestRequest.xml</span><span class="delimiter">&quot;</span></span>))
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>)
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">MessageId</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="xml-header-validation"><a class="anchor" href="#xml-header-validation"></a><a class="link" href="#xml-header-validation">10.1.2. XML header validation</a></h4>
<div class="paragraph">
<p>Now that we have validated the message payload in various ways we are now interested in validating the message header. This is simple as you have to define the header name and the control value that you expect. Just add the following header validation to your receiving action.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;header&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GetCustomer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RequestTag</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${requestTag}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/header&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> receiveMessageTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceServer</span><span class="delimiter">&quot;</span></span>)
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>)
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">MessageId</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Message headers are represented as name-value pairs. Each expected header element identified by its name has to be present in the received message. In addition to that the header value is compared to the given control value. If a header entry is not found by its name or the value does not fit accordingly Citrus will raise validation errors and the test case will fail.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Sometimes message headers may not apply to the name-value pair pattern. For example SOAP headers can also contain XML fragments. Citrus supports these kind of headers too. Please see the SOAP chapter for more details.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="xml-ignore"><a class="anchor" href="#xml-ignore"></a><a class="link" href="#xml-ignore">10.2. Ignore XML elements</a></h3>
<div class="paragraph">
<p>Some elements in the message payload might not apply for validation at all. Just think of communication timestamps an dynamic values inside a message:</p>
</div>
<div class="paragraph">
<p>The timestamp value in our next example will dynamically change from test run to test run and is hardly predictable for the tester, so lets ignore it in validation.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;message&gt;</span>
    <span class="tag">&lt;payload&gt;</span>
        <span class="tag">&lt;TestMessage&gt;</span>
            <span class="tag">&lt;MessageId&gt;</span>${messageId}<span class="tag">&lt;/MessageId&gt;</span>
            <span class="tag">&lt;Timestamp&gt;</span>2001-12-17T09:30:47.0Z<span class="tag">&lt;/Timestamp&gt;</span>
            <span class="tag">&lt;VersionId&gt;</span>@ignore@<span class="tag">&lt;/VersionId&gt;</span>
        <span class="tag">&lt;/TestMessage&gt;</span>
    <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;ignore</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/TestMessage/Timestamp</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/message&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Although we have given a static timestamp value in the payload data the element is ignored during validation as the ignore XPath expression matches the element. In addition to that we also ignored the version id element in this example. This time with an inline <strong>@ignore@</strong> expression. This is for those of you that do not like XPath. As a result the ignored message elements are automatically skipped when Citrus compares and validates message contents and do not break the test case.</p>
</div>
<div class="paragraph">
<p>When using the Java DSL the <strong>@ignore@</strong> placeholder as well as XPath expressions can be used seamlessly. Here is an example of that:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> receiveMessageTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceServer</span><span class="delimiter">&quot;</span></span>)
        .payload(<span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">com/consol/citrus/message/data/TestRequest.xml</span><span class="delimiter">&quot;</span></span>))
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>)
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">MessageId</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span>)
        .ignore(<span class="string"><span class="delimiter">&quot;</span><span class="content">/TestMessage/Timestamp</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course you can use the inline <strong>@ignore@</strong> placeholder in an external file resource, too.</p>
</div>
<div class="sect3">
<h4 id="customize-xml-parser-and-serializer"><a class="anchor" href="#customize-xml-parser-and-serializer"></a><a class="link" href="#customize-xml-parser-and-serializer">10.2.1. Customize XML parser and serializer</a></h4>
<div class="paragraph">
<p>When working with XML data format parsing and serializing is a common task. XML structures are parsed to a DOM (Document Object Model) representation in order
to process elements, attributes and text nodes. Also DOM node objects get serialized to a String message payload representation. The XML parser and serializer is customizable
to a certain level. By default Citrus uses the <a href="https://www.w3.org/TR/2004/REC-DOM-Level-3-LS-20040407/">DOM Level 3 Load and Save</a> implementation with following settings:</p>
</div>
<div class="hdlist">
<div class="title">Parser settings</div>
<table>
<tr>
<td class="hdlist1">
cdata-sections
</td>
<td class="hdlist2">
<p><strong>true</strong></p>
</td>
</tr>
<tr>
<td class="hdlist1">
split-cdata-sections
</td>
<td class="hdlist2">
<p><strong>false</strong></p>
</td>
</tr>
<tr>
<td class="hdlist1">
validate-if-schema
</td>
<td class="hdlist2">
<p><strong>true</strong></p>
</td>
</tr>
<tr>
<td class="hdlist1">
element-content-whitespace
</td>
<td class="hdlist2">
<p><strong>false</strong></p>
</td>
</tr>
</table>
</div>
<div class="hdlist">
<div class="title">Serializer settings</div>
<table>
<tr>
<td class="hdlist1">
format-pretty-print
</td>
<td class="hdlist2">
<p><strong>true</strong></p>
</td>
</tr>
<tr>
<td class="hdlist1">
split-cdata-sections
</td>
<td class="hdlist2">
<p><strong>false</strong></p>
</td>
</tr>
<tr>
<td class="hdlist1">
element-content-whitespace
</td>
<td class="hdlist2">
<p><strong>true</strong></p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The parameters are also described in <a href="https://www.w3.org/TR/DOM-Level-3-Core/core.html#DOMConfiguration">W3C DOM configuration</a> documentation. We can customize the default settings by adding
a <em>XmlConfigurer</em> Spring bean to the Citrus application context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xmlConfigurer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.xml.XmlConfigurer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">parseSettings</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;map&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">validate-if-schema</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.Boolean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/map&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serializeSettings</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;map&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">comments</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.Boolean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">format-pretty-print</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.Boolean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/map&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This configuration is of global nature. All XML processing operations will be affected with this configuration.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="groovy-xml-validation"><a class="anchor" href="#groovy-xml-validation"></a><a class="link" href="#groovy-xml-validation">10.2.2. Groovy XML validation</a></h4>
<div class="paragraph">
<p>With the Groovy XmlSlurper you can easily validate XML message payloads without having to deal directly with XML. People who do not want to deal with XPath may also like this validation alternative. The tester directly navigates through the message elements and uses simple code assertions in order to control the message content. Here is an example how to validate messages with Groovy script:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5000</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;validate&gt;</span>
            <span class="tag">&lt;script</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="inline">                assert root.children().size() == <span class="integer">4</span>
                assert root.MessageId.text() == <span class="string"><span class="delimiter">'</span><span class="content">${messageId}</span><span class="delimiter">'</span></span>
                assert root.CorrelationId.text() == <span class="string"><span class="delimiter">'</span><span class="content">${correlationId}</span><span class="delimiter">'</span></span>
                assert root.User.text() == <span class="string"><span class="delimiter">'</span><span class="content">HelloService</span><span class="delimiter">'</span></span>
                assert root.Text.text() == <span class="string"><span class="delimiter">'</span><span class="content">Hello </span><span class="delimiter">'</span></span> + context.getVariable(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>)</span>
            <span class="tag">&lt;/script&gt;</span>
        <span class="tag">&lt;/validate&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;header&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CorrelationId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${correlationId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> receiveMessageTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceClient</span><span class="delimiter">&quot;</span></span>)
        .validateScript(<span class="string"><span class="delimiter">&quot;</span><span class="content">assert root.MessageId.text() == '${messageId}';</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">assert root.CorrelationId.text() == '${correlationId}';</span><span class="delimiter">&quot;</span></span>)
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation, </span><span class="delimiter">&quot;</span></span>sayHello<span class="string"><span class="delimiter">&quot;</span><span class="content">)
        .header(</span><span class="delimiter">&quot;</span></span>CorrelationId<span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span><span class="error">$</span>{correlationId}<span class="string"><span class="delimiter">&quot;</span><span class="content">)
        .timeout(5000L);
}</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Groovy XmlSlurper validation script goes right into the message-tag instead of a XML control template or XPath validation. The Groovy script supports Java <strong><em>assert</em></strong> statements for message element validation. Citrus automatically injects the root element <strong><em>root</em></strong> to the validation script. This is the Groovy XmlSlurper object and the start of element navigation. Based on this root element you can access child elements and attributes with a dot notated syntax. Just use the element names separated by a simple dot. Very easy! If you need the list of child elements use the <strong><em>children()</em></strong> function on any element. With the <strong><em>text()</em></strong> function you get access to the element&#8217;s text-value. The <strong><em>size()</em></strong> is very useful for validating the number of child elements which completes the basic validation statements.</p>
</div>
<div class="paragraph">
<p>As you can see from the example, we may use test variables within the validation script, too. Citrus has also injected the actual test context to the validation script. The test context object holds all test variables. So you can also access variables with <strong><em>context.getVariable("user")</em></strong> for instance. On the test context you can also set new variable values with <strong><em>context.setVariable("user", "newUserName")</em></strong> .</p>
</div>
<div class="paragraph">
<p>There is even more object injection for the validation script. With the automatically added object <strong><em>receivedMessage</em></strong> You have access to the Citrus message object for this receive action. This enables you to do whatever you want with the message payload or header.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5000</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;validate&gt;</span>
            <span class="tag">&lt;script</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="inline">                assert receivedMessage.getPayload(String.<span class="reserved">class</span>).contains(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Citrus!</span><span class="delimiter">&quot;</span></span>)
                assert receivedMessage.getHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>) == <span class="string"><span class="delimiter">'</span><span class="content">sayHello</span><span class="delimiter">'</span></span>

                context.setVariable(<span class="string"><span class="delimiter">&quot;</span><span class="content">request_payload</span><span class="delimiter">&quot;</span></span>, receivedMessage.getPayload(String.<span class="reserved">class</span>))</span>
            <span class="tag">&lt;/script&gt;</span>
        <span class="tag">&lt;/validate&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The listing above shows some power of the validation script. We can access the message payload, we can access the message header. With test context access we can also save the whole message payload as a new test variable for later usage in the test.</p>
</div>
<div class="paragraph">
<p>In general Groovy code inside the XML test case definition or as part of the Java DSL code is not very comfortable to maintain. You do not have code syntax assist or code completion. This is why we can also use external file resources for the validation scripts. The syntax looks like follows:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5000</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;validate&gt;</span>
            <span class="tag">&lt;script</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:validationScript.groovy</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="inline">        &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">validate&gt;
    &lt;</span><span class="delimiter">/</span><span class="modifier">m</span></span>essage&gt;
    <span class="tag">&lt;header&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CorrelationId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${correlationId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/header&gt;</span>
&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">receive&gt;</span></span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> receiveMessageTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceClient</span><span class="delimiter">&quot;</span></span>)
        .validateScript(<span class="keyword">new</span> FileSystemResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">validationScript.groovy</span><span class="delimiter">&quot;</span></span>))
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation, </span><span class="delimiter">&quot;</span></span>sayHello<span class="string"><span class="delimiter">&quot;</span><span class="content">)
        .header(</span><span class="delimiter">&quot;</span></span>CorrelationId<span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span><span class="error">$</span>{correlationId}<span class="string"><span class="delimiter">&quot;</span><span class="content">)
        .timeout(5000L);
}</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We referenced some external file resource <strong><em>validationScript.groovy</em></strong> . This file content is loaded at runtime and is used as script body. Now that we have a normal groovy file we can use the code completion and syntax highlighting of our favorite Groovy editor.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can use the Groovy validation script in combination with other validation types like XML tree comparison and XPath validation.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For further information on the Groovy XmlSlurper please see the official Groovy website and documentation
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="json-message-validation"><a class="anchor" href="#json-message-validation"></a><a class="link" href="#json-message-validation">10.3. JSON message validation</a></h3>
<div class="paragraph">
<p>Message formats such as JSON have become very popular, in particular when speaking of RESTful WebServices and JavaScript using JSON as the message format to go for. Citrus is able to expect and validate JSON messages as we will see in the next sections.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
By default Citrus will use XML message formats when sending and receiving messages. This also reflects to the message validation logic Citrus uses for incoming messages. So by default Citrus will try to parse the incoming message as XML DOM element tree. In case we would like to enable JSON message validation we have to tell Citrus that we expect a JSON message right now.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And this is quite easy. Citrus has a JSON message validator implementation active by default and immediately as we mark an incoming message as JSON data this message validator will jump in.</p>
</div>
<div class="paragraph">
<p>Citrus provides several default message validator implementations for JOSN message format:</p>
</div>
<div class="dlist">
<div class="title">JsonMessageValidators</div>
<dl>
<dt class="hdlist1">com.consol.citrus.validation.json.JsonTextMessageValidator</dt>
<dd>
<p>Basic JSON message validator implementation compares JSON objects (expected and received). The order of JSON entries can differ as specified in JSON protocol. Tester defines an expected control JSON object with test variables and ignored entries. JSONArray as well as nested JSONObjects are supported, too.</p>
</dd>
<dt class="hdlist1">com.consol.citrus.validation.script.GroovyJsonMessageValidator</dt>
<dd>
<p>Extended groovy message validator provides specific JSON slurper support. With JSON slurper the tester can validate the JSON message payload with closures for instance.</p>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The JSON validator offers two different modes to operate. By default <strong>strict</strong> mode is enabled and the validator will also check the exact amount of object fields to match in received and control message. No additional fields in received JSON data structure will be accepted then. In <strong>soft</strong> mode the validator allows additional fields in received JSON data structure so the control JSON object can be a partial subset in which case only the control fields are validated. Additional fields in the received JSON data structure are ignored then.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The JSON validation mode (strict or soft) is settable via system property <code>citrus.json.message.validation.strict=false</code>. This will set soft mode to all JSON text messag validators.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also overwrite this default message validators for JSON by placing a bean into the Spring Application context. The bean uses a default name as identifier. Then your custom bean will overwrite the default validator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultJsonMessageValidator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.validation.json.JsonTextMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultGroovyJsonMessageValidator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.validation.script.GroovyJsonMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is how you can customize the message validators used for JSON message data.</p>
</div>
<div class="paragraph">
<p>We have mentioned before that Citrus is working with XML by default. This is why we have to tell Citrus that the message that we are receiving uses the JSON message format. We have to tell the test case receiving action that we expect a different format other than XML.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">json</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;data&gt;</span>
          {
            &quot;type&quot; : &quot;read&quot;,
            &quot;mbean&quot; : &quot;java.lang:type=Memory&quot;,
            &quot;attribute&quot; : &quot;HeapMemoryUsage&quot;,
            &quot;path&quot; : &quot;@equalsIgnoreCase('USED')@&quot;,
            &quot;value&quot; : &quot;${heapUsage}&quot;,
            &quot;timestamp&quot; : &quot;@ignore@&quot;
          }
        <span class="tag">&lt;/data&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The message receiving action in our test case specifies a message format type <strong>type="json"</strong> . This tells Citrus to look for some message validator implementation capable of validating JSON messages. As we have added the proper message validator to the Spring application context Citrus will pick the right validator and JSON message validation is performed on this message. As you can see you we can use the usual test variables and the ignore element syntax here, too. Citrus is able to handle different JSON element orders when comparing received and expected JSON object. We can also use JSON arrays and nested objects. The default JSON message validator implementation in Citrus is very powerful in comparing JSON objects.</p>
</div>
<div class="paragraph">
<p>Instead of defining an expected message payload template we can also use Groovy validation scripts. Lets have a look at the Groovy JSON message validator example. As usual the default Groovy JSON message validator is active by default. But the special Groovy message validator implementation will only jump in when we used a validation script in our receive message definition. Let&#8217;s have an example for that.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">json</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;validate&gt;</span>
            <span class="tag">&lt;script</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="inline">                &lt;![CDATA[
                  assert json.type == <span class="string"><span class="delimiter">'</span><span class="content">read</span><span class="delimiter">'</span></span>
                  assert json.mbean == <span class="string"><span class="delimiter">'</span><span class="content">java.lang:type=Memory</span><span class="delimiter">'</span></span>
                  assert json.attribute == <span class="string"><span class="delimiter">'</span><span class="content">HeapMemoryUsage</span><span class="delimiter">'</span></span>
                  assert json.value == <span class="string"><span class="delimiter">'</span><span class="content">${heapUsage}</span><span class="delimiter">'</span></span>
                ]]&gt;</span>
            <span class="tag">&lt;/script&gt;</span>
        <span class="tag">&lt;/validate&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Again we tell Citrus that we expect a message of <strong>type="json"</strong> . Now we used a validation script that is written in Groovy. Citrus will automatically activate the special message validator that executes our Groovy script. The script validation is more powerful as we can use the full power of the Groovy language. The validation script automatically has access to the incoming JSON message object <strong>json</strong> . We can use the Groovy JSON dot notated syntax in order to navigate through the JSON structure. The Groovy JSON slurper object <strong>json</strong> is automatically passed to the validation script. This way you can access the JSON object elements in your code doing some assertions.</p>
</div>
<div class="paragraph">
<p>There is even more object injection for the validation script. With the automatically added object <strong><em>receivedMessage</em></strong> You have access to the Citrus message object for this receive action. This enables you to do whatever you want with the message payload or header.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">json</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;validate&gt;</span>
            <span class="tag">&lt;script</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="inline">                assert receivedMessage.getPayload(String.<span class="reserved">class</span>).contains(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Citrus!</span><span class="delimiter">&quot;</span></span>)
                assert receivedMessage.getHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>) == <span class="string"><span class="delimiter">'</span><span class="content">sayHello</span><span class="delimiter">'</span></span>

                context.setVariable(<span class="string"><span class="delimiter">&quot;</span><span class="content">request_payload</span><span class="delimiter">&quot;</span></span>, receivedMessage.getPayload(String.<span class="reserved">class</span>))</span>
            <span class="tag">&lt;/script&gt;</span>
        <span class="tag">&lt;/validate&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The listing above shows some power of the validation script. We can access the message payload, we can access the message header. With test context access we can also save the whole message payload as a new test variable for later usage in the test.</p>
</div>
<div class="paragraph">
<p>In general Groovy code inside the XML test case definition or as part of the Java DSL code is not very comfortable to maintain. You do not have code syntax assist or code completion. This is why we can also use external file resources for the validation scripts. The syntax looks like follows:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5000</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;validate&gt;</span>
            <span class="tag">&lt;script</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:validationScript.groovy</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="inline">        &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">validate&gt;
    &lt;</span><span class="delimiter">/</span><span class="modifier">m</span></span>essage&gt;
&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">receive&gt;</span></span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> receiveMessageTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceClient</span><span class="delimiter">&quot;</span></span>)
        .validateScript(<span class="keyword">new</span> FileSystemResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">validationScript.groovy</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We referenced some external file resource <strong><em>validationScript.groovy</em></strong> . This file content is loaded at runtime and is used as script body. Now that we have a normal groovy file we can use the code completion and syntax highlighting of our favorite Groovy editor.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Using several message validator implementations at the same time in the Spring application context is also no problem. Citrus automatically searches for all available message validators applicable for the given message format and executes these validators in sequence. So several message validators can coexist in a Citrus project.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When we have multiple message validators that apply to the message format Citrus will execute all of them in sequence. In case you need to explicitly choose a message validator implementation you can do so in the receive action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">json</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">validator</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groovyJsonMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;validate&gt;</span>
            <span class="tag">&lt;script</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="inline">                &lt;![CDATA[
                  assert json.type == <span class="string"><span class="delimiter">'</span><span class="content">read</span><span class="delimiter">'</span></span>
                  assert json.mbean == <span class="string"><span class="delimiter">'</span><span class="content">java.lang:type=Memory</span><span class="delimiter">'</span></span>
                  assert json.attribute == <span class="string"><span class="delimiter">'</span><span class="content">HeapMemoryUsage</span><span class="delimiter">'</span></span>
                  assert json.value == <span class="string"><span class="delimiter">'</span><span class="content">${heapUsage}</span><span class="delimiter">'</span></span>
                ]]&gt;</span>
            <span class="tag">&lt;/script&gt;</span>
        <span class="tag">&lt;/validate&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example we use the <strong>groovyJsonMessageValidator</strong> explicitly in the receive test action. The message validator implementation was added as Spring bean with id <strong>groovyJsonMessageValidator</strong> to the Spring application context before. Now Citrus will only execute the explicit message validator. Other implementations that might also apply are skipped.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
By default Citrus will consolidate all available message validators for a message format in sequence. You can explicitly pick a special message validator in the receive message action as shown in the example above. In this case all other validators will not take part in this special message validation. But be careful: When picking a message validator explicitly you are of course limited to this message validator capabilities. Validation features of other validators are not valid in this case (e.g. message header validation, XPath validation, etc.)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>So much for receiving JSON message data in Citrus. Of course sending JSON messages in Citrus is also very easy. Just use JSON message payloads in your sending message action.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;data&gt;</span>
          {
            &quot;type&quot; : &quot;read&quot;,
            &quot;mbean&quot; : &quot;java.lang:type=Memory&quot;,
            &quot;attribute&quot; : &quot;HeapMemoryUsage&quot;,
            &quot;path&quot; : &quot;used&quot;
          }
        <span class="tag">&lt;/data&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="schema-validation"><a class="anchor" href="#schema-validation"></a><a class="link" href="#schema-validation">10.4. Schema validation</a></h3>
<div class="paragraph">
<p>When structured data is transmitted from one system to another, it&#8217;s important that the sender and the receiver
understand each other. To ensure this, a contract is required introducing the rules of communication for both parties.
This is mostly done by using schemas. Citrus brings the schema based validation of messages directly to your integration
test environment. This includes the management, mapping and filtering of schemas in context to your current test case
by just defining some rules in XML configuration or Java DSL. Let&#8217;s start with this chapter by introducing some basic
concepts of the schema validation.</p>
</div>
<div class="sect3">
<h4 id="managing-schemas"><a class="anchor" href="#managing-schemas"></a><a class="link" href="#managing-schemas">10.4.1. Managing schemas</a></h4>
<div class="paragraph">
<p>Most complex applications have a lot of schemas that are relevant for different use cases. To organize these schemas
in your test cases, Citrus brings you some structuring capabilities.</p>
</div>
<div class="sect4">
<h5 id="schema-definitions"><a class="anchor" href="#schema-definitions"></a><a class="link" href="#schema-definitions">10.4.1.1. Schema definitions</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:schema</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bookstore</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/xml/BookStore.wsdl</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This xml snippet allows you to define a schema identified by its id, located at the given classpath.
Please keep in mind, that the id of the schema has to be unique within the context.</p>
</div>
</div>
<div class="sect4">
<h5 id="schema-references"><a class="anchor" href="#schema-references"></a><a class="link" href="#schema-references">10.4.1.2. Schema references</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:schema</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testSchema</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/xml/test.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

...
<span class="tag">&lt;citrus:reference</span> <span class="attribute-name">schema</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testSchema</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus allows you to reuse your schema definition within your context by referencing them. For a valid reference,
the id of the schema and the value of the schema Attribute within the reference Element have to match.</p>
</div>
</div>
<div class="sect4">
<h5 id="schema-location-definitions"><a class="anchor" href="#schema-location-definitions"></a><a class="link" href="#schema-location-definitions">10.4.1.3. Schema location definitions</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:location</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:citrus/flightbooking/*.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Setting all schemas one by one can be verbose and uncomfortable, especially when dealing with
lots of schema files. Therefore, Citrus offers you schema location patterns which will import all matching schema files
within the given location.</p>
</div>
</div>
<div class="sect4">
<h5 id="schema-repositories"><a class="anchor" href="#schema-repositories"></a><a class="link" href="#schema-repositories">10.4.1.4. Schema repositories</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:schema</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testSchema</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/xml/test.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;citrus:schema-repository</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xmlSchemaRepository</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;citrus:schemas&gt;</span>
    <span class="tag">&lt;citrus:schema</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bookstore</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/xml/BookStore.wsdl</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:reference</span> <span class="attribute-name">schema</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testSchema</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:location</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/validation/*</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/citrus:schemas&gt;</span>
<span class="tag">&lt;/citrus:schema-repository&gt;</span>

<span class="tag">&lt;citrus:schema-repository</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">json</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jsonSchemaRepository</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:schemas&gt;</span>
        <span class="tag">&lt;citrus:schema</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">product</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/validation/ProductsSchema.json</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/citrus:schemas&gt;</span>
<span class="tag">&lt;/citrus:schema-repository&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus introduces a central schema repository component which holds a set of schema files for a project disjoint
by their type (xml, json, etc.) and identified by its unique id. The default type of a schema repository is <code>type=xml</code>.</p>
</div>
<div class="paragraph">
<p>As you can see the schema repository is a simple XML component defined inside the Spring application context.
The repository can hold nested schema definitions, references and location definitions for all types of schema
repositories.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
In case you have several schema repositories in your project do always define a default repository
(name="schemaRepository"). This helps Citrus to always find at least one repository to interact with.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="schema-definition-overruling"><a class="anchor" href="#schema-definition-overruling"></a><a class="link" href="#schema-definition-overruling">10.4.2. Schema definition overruling</a></h4>
<div class="paragraph">
<p>Depending on the type of message you want to validate, there are different attempts to find the correct schema for the
given message.  There comes a time where you as a tester have to pick the right schema definition by yourself.
You can overrule all schema mapping strategies in Citrus by directly setting the desired schema in your receiving
message action.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">schema</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSchema</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;validate&gt;</span>
        <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//ns1:TestMessage/ns1:MessageHeader/ns1:MessageId</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//ns1:TestMessage/ns1:MessageHeader/ns1:CorrelationId</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${correlationId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;namespace</span> <span class="attribute-name">prefix</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ns1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrus.com/namespace</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/validate&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span>

<span class="tag">&lt;citrus:schema</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSchema</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:citrus/samples/sayHello.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above the tester explicitly sets a schema definition in the receive action (schema="helloSchema").
The attribute value refers to named schema bean somewhere in the application context. This overrules all schema mapping
strategies used in the central schema repository as the given schema is directly used for validation. This feature is
helpful when dealing with different schema versions at the same time where the schema repository can not help you
anymore.</p>
</div>
<div class="paragraph">
<p>Another possibility would be to set a custom schema repository at this point. This means you can have more than one
schema repository in your Citrus project and you pick the right one by yourself in the receive action.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">schema-repository</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mySpecialSchemaRepository</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;validate&gt;</span>
        <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//ns1:TestMessage/ns1:MessageHeader/ns1:MessageId</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//ns1:TestMessage/ns1:MessageHeader/ns1:CorrelationId</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${correlationId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;namespace</span> <span class="attribute-name">prefix</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ns1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrus.com/namespace</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/validate&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>schema-repository</strong> attribute refers to a Citrus schema repository component which is defined somewhere in the
Spring application context.</p>
</div>
</div>
<div class="sect3">
<h4 id="xml-schema-validation"><a class="anchor" href="#xml-schema-validation"></a><a class="link" href="#xml-schema-validation">10.4.3. XML schema validation</a></h4>
<div class="paragraph">
<p>There are several possibilities to describe the structure of XML documents. The two most popular ways are DTD
(Document type definition) and XSD (XML Schema definition). Once a XML document has decided to be classified using a
schema definition the structure of the document has to fit the predefined rules inside the schema definition.
XML document instances are valid only in case they meet all these structure rules defined in the schema definition.
Currently Citrus can validate XML documents using the schema languages DTD and XSD.</p>
</div>
<div class="sect4">
<h5 id="xsd-schema-repositories"><a class="anchor" href="#xsd-schema-repositories"></a><a class="link" href="#xsd-schema-repositories">10.4.3.1. XSD schema repositories</a></h5>
<div class="paragraph">
<p>Citrus tries to validate all incoming XML messages against a schema definition in order to ensure that all rules are
fulfilled. As a consequence the message receiving actions in Citrus do have to know the XML schema definition file
resources that belong to our test context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:schema-repository</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">schemaRepository</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:schemas&gt;</span>
        <span class="tag">&lt;citrus:schema</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">travelAgencySchema</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:citrus/flightbooking/TravelAgencySchema.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;citrus:schema</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">royalArilineSchema</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:citrus/flightbooking/RoyalAirlineSchema.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;citrus:reference</span> <span class="attribute-name">schema</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">smartArilineSchema</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/citrus:schemas&gt;</span>
<span class="tag">&lt;/citrus:schema-repository&gt;</span>

<span class="tag">&lt;citrus:schema</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">smartArilineSchema</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:citrus/flightbooking/SmartAirlineSchema.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By convention there is a default schema repository component defined in the Citrus Spring application context with
the id <strong>schemaRepository</strong>. Spring application context is then able to inject the schema repository into all message
receiving test actions at runtime. The receiving test action consolidates the repository for a matching schema
definition file in order to validate the incoming XML document structure.</p>
</div>
<div class="paragraph">
<p>The connection between incoming XML messages and xsd schema files in the repository is done by a mapping strategy which
we will discuss later in this chapter. By default Citrus picks the right schema based on the target namespace that is
defined inside the schema definition. The target namespace of the schema definition has to match the namespace of the
root element in the received XML message. With this mapping strategy you will not have to wire XML messages and schema
files manually all is done automatically by the Citrus schema repository at runtime. All you need to do is to register
all available schema definition files regardless of which target namespace or nature inside the Citrus schema
repository.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
XML schema validation is mandatory in Citrus. This means that Citrus always tries to find a matching schema
definition inside the schema repository in order to perform syntax validation on incoming schema qualified XML messages.
A classified XML message is defined by its namespace definitions. Consequently you will get validation errors in case
no matching schema definition file is found inside the schema repository. So if you explicitly do not want to validate
the XML schema for some reason you have to disable the validation explicitly in your test with
<strong>schema-validation="false"</strong>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">schema-validation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;validate&gt;</span>
        <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//ns1:TestMessage/ns1:MessageHeader/ns1:MessageId</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//ns1:TestMessage/ns1:MessageHeader/ns1:CorrelationId</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${correlationId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;namespace</span> <span class="attribute-name">prefix</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ns1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrus.com/namespace</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/validate&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;header&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MessageId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This mandatory schema validation might sound annoying to you but in our opinion it is very important to validate the
structure of the received XML messages, so disabling the schema validation should not be the standard for all tests.
Disabling automatic schema validation should only apply to very special situations. So please try to put all available
schema definitions to the schema repository and you will be fine.</p>
</div>
</div>
<div class="sect4">
<h5 id="wsdl-schemas"><a class="anchor" href="#wsdl-schemas"></a><a class="link" href="#wsdl-schemas">10.4.3.2. WSDL schemas</a></h5>
<div class="paragraph">
<p>In SOAP WebServices world the WSDL (WebService Schema Definition Language) defines the structure an nature of the XML
messages exchanged across the interface. Often the WSDL files do hold the XML schema definitions as nested elements.
In Citrus you can directly set the WSDL file as location of a schema definition like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:schema</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">arilineWsdl</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:citrus/flightbooking/AirlineSchema.wsdl</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus is able to find the nested schema definitions inside the WSDL file in order to build a valid schema file for the
schema repository. So incoming XML messages that refer to the WSDL file can be validated for syntax rules.</p>
</div>
</div>
<div class="sect4">
<h5 id="schema-collections"><a class="anchor" href="#schema-collections"></a><a class="link" href="#schema-collections">10.4.3.3. Schema collections</a></h5>
<div class="paragraph">
<p>Sometimes a XML schema definition is separated into multiple files. This is a problem for the Citrus schema repository
as the schema mapping strategy then is not able to pick the right file for validation, in particular when working with
target namespace values as key for the schema mapping strategy. As a solution for this problem you have to put all
schemas with the same target namespace value into a schema collection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:schema-collection</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flightbookingSchemaCollection</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;citrus:schemas&gt;</span>
    <span class="tag">&lt;citrus:schema</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:citrus/flightbooking/BaseTypes.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:schema</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:citrus/flightbooking/AirlineSchema.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/citrus:schemas&gt;</span>
<span class="tag">&lt;/citrus:schema-collection&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Both schema definitions <strong>BaseTypes.xsd</strong> and <strong>AirlineSchema.xsd</strong> share the same target namespace and therefore need to
be combined in schema collection component. The schema collection can be referenced in any schema repository as normal
schema definition.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:schema-repository</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">schemaRepository</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;citrus:schemas&gt;</span>
    <span class="tag">&lt;citrus:reference</span> <span class="attribute-name">schema</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">flightbookingSchemaCollection</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/citrus:schemas&gt;</span>
<span class="tag">&lt;/citrus:schema-repository&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="schema-mapping-strategy"><a class="anchor" href="#schema-mapping-strategy"></a><a class="link" href="#schema-mapping-strategy">10.4.3.4. Schema mapping strategy</a></h5>
<div class="paragraph">
<p>The schema repository in Citrus holds one to many schema definition files and dynamically picks up the right one
according to the validated message payload. The repository needs to have some strategy for deciding which schema
definition to choose. See the following schema mapping strategies and decide which of them is suitable for you.</p>
</div>
</div>
<div class="sect4">
<h5 id="target-namespace-mapping-strategy"><a class="anchor" href="#target-namespace-mapping-strategy"></a><a class="link" href="#target-namespace-mapping-strategy">10.4.3.5. Target Namespace Mapping Strategy</a></h5>
<div class="paragraph">
<p>This is the default schema mapping strategy. Schema definitions usually define some target namespace which is valid
for all elements and types inside the schema file. The target namespace is also used as root namespace in XML message
payloads. According to this information Citrus can pick up the right schema definition file in the schema repository.
You can set the schema mapping strategy as property in the configuration files:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:schema-repository</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">schemaRepository</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">schema-mapping-strategy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">schemaMappingStrategy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;citrus:schemas&gt;</span>
    <span class="tag">&lt;citrus:schema</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSchema</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:citrus/samples/sayHello.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/citrus:schemas&gt;</span>
<span class="tag">&lt;/citrus:schema-repository&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">schemaMappingStrategy</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.xml.schema.TargetNamespaceSchemaMappingStrategy</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>sayHello.xsd</strong> schema file defines a target namespace
(<a href="http://consol.de/schemas/sayHello.xsd)">http://consol.de/schemas/sayHello.xsd)</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;xs:schema</span> <span class="attribute-name">xmlns:xs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://consol.de/schemas/sayHello.xsd</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">targetNamespace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://consol.de/schemas/sayHello.xsd</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">elementFormDefault</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">qualified</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">attributeFormDefault</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">unqualified</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

<span class="tag">&lt;/xs:schema&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Incoming request messages should also have the target namespace set in the root element and this is how Citrus matches
the right schema file in the repository.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;HelloRequest</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://consol.de/schemas/sayHello.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   <span class="tag">&lt;MessageId&gt;</span>123456789<span class="tag">&lt;/MessageId&gt;</span>
   <span class="tag">&lt;CorrelationId&gt;</span>1000<span class="tag">&lt;/CorrelationId&gt;</span>
   <span class="tag">&lt;User&gt;</span>Christoph<span class="tag">&lt;/User&gt;</span>
   <span class="tag">&lt;Text&gt;</span>Hello Citrus<span class="tag">&lt;/Text&gt;</span>
<span class="tag">&lt;/HelloRequest&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="root-qname-mapping-strategy"><a class="anchor" href="#root-qname-mapping-strategy"></a><a class="link" href="#root-qname-mapping-strategy">10.4.3.6. Root QName Mapping Strategy</a></h5>
<div class="paragraph">
<p>The next possibility for mapping incoming request messages to a schema definition is via the XML root element QName.
Each XML message payload starts with a root element that usually declares the type of a XML message. According to this
root element you can set up mappings in the schema repository.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:schema-repository</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">schemaRepository</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">schema-mapping-strategy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">schemaMappingStrategy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;citrus:schemas&gt;</span>
    <span class="tag">&lt;citrus:reference</span> <span class="attribute-name">schema</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSchema</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:reference</span> <span class="attribute-name">schema</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">goodbyeSchema</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/citrus:schemas&gt;</span>
<span class="tag">&lt;/citrus:schema-repository&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">schemaMappingStrategy</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.xml.schema.RootQNameSchemaMappingStrategy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mappings</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;map&gt;</span>
      <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HelloRequest</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSchema</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GoodbyeRequest</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">goodbyeSchema</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/map&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;citrus:schema</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSchema</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:citrus/samples/sayHello.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;citrus:schema</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">goodbyeSchema</span><span class="delimiter">&quot;</span></span>
     <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:citrus/samples/sayGoodbye.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The listing above defines two root qname mappings - one for <strong>HelloRequest</strong> and one for <strong>GoodbyeRequest</strong> message types.
An incoming message of type &lt;HelloRequest&gt; is then mapped to the respective schema and so on. With this dedicated
mappings you are able to control which schema is used on a XML request, regardless of target namespace definitions.</p>
</div>
</div>
<div class="sect4">
<h5 id="schema-mapping-strategy-chain"><a class="anchor" href="#schema-mapping-strategy-chain"></a><a class="link" href="#schema-mapping-strategy-chain">10.4.3.7. Schema mapping strategy chain</a></h5>
<div class="paragraph">
<p>Let&#8217;s discuss the possibility to combine several schema mapping strategies in a logical chain. You can define more than
one mapping strategy that are evaluated in sequence. The first strategy to find a proper schema definition file in the
repository wins.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:schema-repository</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">schemaRepository</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">schema-mapping-strategy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">schemaMappingStrategy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;citrus:schemas&gt;</span>
    <span class="tag">&lt;citrus:reference</span> <span class="attribute-name">schema</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSchema</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:reference</span> <span class="attribute-name">schema</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">goodbyeSchema</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/citrus:schemas&gt;</span>
<span class="tag">&lt;/citrus:schema-repository&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">schemaMappingStrategy</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.xml.schema.SchemaMappingStrategyChain</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">strategies</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;list&gt;</span>
      <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.xml.schema.RootQNameSchemaMappingStrategy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mappings</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;map&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HelloRequest</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSchema</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;/map&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
      <span class="tag">&lt;/bean&gt;</span>
      <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.xml.schema.TargetNamespaceSchemaMappingStrategy</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/list&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So the schema mapping chain uses both <strong>RootQNameSchemaMappingStrategy</strong> and <strong>TargetNamespaceSchemaMappingStrategy</strong> in
combination. In case the first root qname strategy fails to find a proper mapping the next target namespace strategy
comes in and tries to find a proper schema.</p>
</div>
</div>
<div class="sect4">
<h5 id="dtd-validation"><a class="anchor" href="#dtd-validation"></a><a class="link" href="#dtd-validation">10.4.3.8. DTD validation</a></h5>
<div class="paragraph">
<p>XML DTD (document type definition) is another way to validate the structure of a XML document. Many people say that
DTD is deprecated and XML schema is the much more efficient way to describe the rules of a XML structure. We do not
disagree with that, but we also know that legacy systems might still use DTD. So in order to avoid validation errors
we have to deal with DTD validation as well.</p>
</div>
<div class="paragraph">
<p>First thing you can do about DTD validation is to specify an inline DTD in your expected message template.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">schema-validation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;data&gt;</span>
        <span class="inline-delimiter">&lt;![CDATA[</span>
            &lt;!DOCTYPE root [
                &lt;!ELEMENT root (message)&gt;
                &lt;!ELEMENT message (text)&gt;
                &lt;!ELEMENT text (#PCDATA)&gt;
                ]&gt;
            &lt;root&gt;
                &lt;message&gt;
                    &lt;text&gt;Hello TestFramework!&lt;/text&gt;
                &lt;/message&gt;
            &lt;/root&gt;
        <span class="inline-delimiter">]]&gt;</span>
        <span class="tag">&lt;data</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The system under test may also send the message with a inline DTD definition. So validation will succeed.</p>
</div>
<div class="paragraph">
<p>In most cases the DTD is referenced as external .dtd file resource. You can do this in your expected message template
as well.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">schema-validation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;data&gt;</span>
        <span class="inline-delimiter">&lt;![CDATA[</span>
            &lt;!DOCTYPE root SYSTEM
                         &quot;com/consol/citrus/validation/example.dtd&quot;&gt;
            &lt;root&gt;
                &lt;message&gt;
                    &lt;text&gt;Hello TestFramework!&lt;/text&gt;
                &lt;/message&gt;
            &lt;/root&gt;
        <span class="inline-delimiter">]]&gt;</span>
        <span class="tag">&lt;data</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="json-schema-validation"><a class="anchor" href="#json-schema-validation"></a><a class="link" href="#json-schema-validation">10.4.4. JSON schema validation</a></h4>
<div class="paragraph">
<p>The JSON schema validation in Citrus is based on the drafts provided by <a href="http://json-schema.org/">json-schema.org</a>.
Because JSON schema is a fast evolving project, only JSON schema V3 and V4 are currently supported.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
In contrast to the XML validation, the JSON validation is an optional feature. You have to activate it
withing every receive-message action by setting <code>schema-validation="true"</code>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http:receive-request</span> <span class="attribute-name">server</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">echoHttpServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;http:POST&gt;</span>
      <span class="tag">&lt;http:body</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">json</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">schema</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bookStore</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">schema-validation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;http:data&gt;</span>
          {
            &quot;isbn&quot; : &quot;0345391802&quot;,
            &quot;title&quot;: &quot;The Hitchhiker's Guide to the Galaxy&quot;,
            &quot;author&quot;: &quot;Douglas Adams&quot;
          }
        <span class="tag">&lt;/http:data&gt;</span>
      <span class="tag">&lt;/http:body&gt;</span>
    <span class="tag">&lt;/http:POST&gt;</span>
<span class="tag">&lt;/http:receive-request&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This behavior is currently required, to provide downwards compatibility to previous Citrus versions, because a
mandatory validation would cause all previous JSON based test cases to fail, due to the missing JSON schemas for the
messages within the test. That would have forced you to update all your JSON tests with the proper schema files.
This led us the decision to add the JSON validation as an optional feature initially. Nevertheless we encourage you to
add JSON schema validation to your test cases as soon as possible, because we think that message validation is a
important part of integration testing.</p>
</div>
</div>
<div class="sect3">
<h4 id="json-schema-repositories"><a class="anchor" href="#json-schema-repositories"></a><a class="link" href="#json-schema-repositories">10.4.5. JSON schema repositories</a></h4>
<div class="paragraph">
<p>Because Citrus supports different types of schema repositories, it is necessary to declare a JSON schema repository
as <code>type="json"</code>. This allows Citrus to collect all JSON schema files for the message validation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:schema-repository</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">json</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jsonSchemaRepository</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:schemas&gt;</span>
        <span class="tag">&lt;citrus:schema</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">product</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/validation/ProductsSchema.json</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/citrus:schemas&gt;</span>
<span class="tag">&lt;/citrus:schema-repository&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="json-schema-filtering-and-validation-strategy"><a class="anchor" href="#json-schema-filtering-and-validation-strategy"></a><a class="link" href="#json-schema-filtering-and-validation-strategy">10.4.6. JSON schema filtering and validation strategy</a></h4>
<div class="paragraph">
<p>In reference to the current JSON schema definition, it is not possible to create a direct reference between a JSON
message and a set of schemas, as it would be possible with XML namespaces. Because of that, Citrus follows a rule set
for choosing the relevant schemas based on the configuration withing the test case in relation to the given context.
The following table assumes that the JSON schema validation is activated for the test action.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Scenario</th>
<th class="tableblock halign-left valign-top">Validation rules</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">No JSON schema repositories are defined in the context.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No JSON schema validation applies.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">There is at least one JSON schema repository defined in the context.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The message of the test action must be valid regarding at least one of the available schemas within the context.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A schema overruling is configured in the test case.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The configured schema must exist and the message must be valid regarding to the specified schema.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A schema repository overruling is configured in the test case.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The configured schema repository must exist and the message must be valid regarding at least one of the schemas within
the specified schema repository.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="xhtml-message-validation"><a class="anchor" href="#xhtml-message-validation"></a><a class="link" href="#xhtml-message-validation">10.5. XHTML message validation</a></h3>
<div class="paragraph">
<p>When Citrus receives plain Html messages we likely want to use the powerful XML validation capabilities such as XML tree comparison or XPath support. Unfortunately Html messages do not follow the XML well formed rules very strictly. This implies that XML message validation will fail because of non well formed Html code.</p>
</div>
<div class="paragraph">
<p>XHTML closes this gap by automatically fixing the most common Html XML incompatible rule violations such as missing end tags (e.g. &lt;br&gt;).</p>
</div>
<div class="paragraph">
<p>Let&#8217;s try this with a simple example. Very first thing for us to do is to add a new library dependency to the project. Citrus is using the <strong>jtidy</strong> library in order to prepare the HTML and XHTML messages for validation. As this 3rd party dependency is optional in Citrus we have to add it now to our project dependency list. Just add the <strong>jtidy</strong> dependency to your Maven project POM.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>net.sf.jtidy<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>jtidy<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>r938<span class="tag">&lt;/version&gt;</span>
  <span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Please refer to the <strong>jtidy</strong> project documentation for the latest versions. Now everything is ready. As usual the Citrus message validator for XHTML is active in background by default. You can overwrite this default implementation by placing a Spring bean with id <strong>defaultXhtmlMessageValidator</strong> to the Citrus application context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultXhtmlMessageValidator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.validation.xhtml.XhtmlMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can tell the test case receiving action that we want to use the XHTML message validation in our test case.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xhtml</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;data&gt;</span>
          <span class="inline-delimiter">&lt;![CDATA[</span>
            &lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot; &quot;org/w3c/xhtml/xhtml1-strict.dtd&quot;&gt;
            &lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
            &lt;head&gt;
              &lt;title&gt;Citrus Hello World&lt;/title&gt;
            &lt;/head&gt;
            &lt;body&gt;
              &lt;h1&gt;Hello World!&lt;/h1&gt;
              &lt;br/&gt;
              &lt;p&gt;This is a test!&lt;/p&gt;
            &lt;/body&gt;
          <span class="inline-delimiter">]]&gt;</span>
        <span class="tag">&lt;/data&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The message receiving action in our test case has to specify a message format type <strong>type="xhtml"</strong> . As you can see the Html message payload get XHTML specific DOCTYPE processing instruction. The <strong>xhtml1-strict.dtd</strong> is mandatory in the XHTML message validation. For better convenience all XHTML dtd files are packaged within Citrus so you can use this as a relative path.</p>
</div>
<div class="paragraph">
<p>The incoming Html message is automatically converted into proper XHTML code with well formed XML. So now the XHTML message validator can use the XML message validation mechanism of Citrus for comparing received and expected data. As usual you can use test variables, ignore element expressions and XPath expressions.</p>
</div>
</div>
<div class="sect2">
<h3 id="plain-text-message-validation"><a class="anchor" href="#plain-text-message-validation"></a><a class="link" href="#plain-text-message-validation">10.6. Plain text message validation</a></h3>
<div class="paragraph">
<p>Plain text message validation is the easiest validation in Citrus that you can think of. This validation just performs an exact Java String match of received and expected message payloads.</p>
</div>
<div class="paragraph">
<p>As usual a default message validator for plaintext messages is active by default. Citrus will pick this message validator for all messages of <strong>type="plaintext"</strong> . The default message validator implementation can be overwritten by placing a Spring bean with id <strong>defaultPlaintextMessageValidator</strong> to the Spring application context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultPlaintextMessageValidator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.validation.text.PlainTextMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the test case receiving action we tell Citrus to use plain text message validation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plaintext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;data&gt;</span>Hello World!<span class="tag">&lt;/data&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With the message format type <strong>type="plaintext"</strong> set Citrus performs String equals on the message payloads (received and expected). Only exact match will pass the test.</p>
</div>
<div class="paragraph">
<p>By the way sending plain text messages in Citrus is also very easy. Just use the plain text message payload data in your sending message action.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;data&gt;</span>Hello World!<span class="tag">&lt;/data&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course test variables are supported in the plain text payloads. The variables are replace by the referenced values before sending or receiving the message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plaintext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;data&gt;</span>${hello} ${world}!<span class="tag">&lt;/data&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="plain-text-validation-whitespaces"><a class="anchor" href="#plain-text-validation-whitespaces"></a><a class="link" href="#plain-text-validation-whitespaces">10.6.1. Whitespace characters</a></h4>
<div class="paragraph">
<p>Plaintext message payloads may only differ in system-dependent line separator characters (<strong>CR</strong>, <em>LF</em>, <em>CRLF</em>). By default the plain text message validation fails because of that differences even if only whitespace
characters are different.</p>
</div>
<div class="paragraph">
<p>You can disable this default validation behavior and ignore new line types with following system property or environment variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>citrus.plaintext.validation.ignore.newline.type=true
CITRUS_PLAINTEXT_VALIDATION_IGNORE_NEWLINE_TYPE=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case you need to ignore all whitespaces during plain text validation such as multiple new line characters or tabs you need to set this system property or environment variable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>citrus.plaintext.validation.ignore.whitespace=true
CITRUS_PLAINTEXT_VALIDATION_IGNORE_WHITESPACE=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>This property will not only ignore new line types but also normalize the whitespaces. As a result all empty lines, tabs and double whitespace characters are filtered before comparison.</p>
</div>
<div class="paragraph">
<p>Of course you can also set the properties directly on the plain text message validator bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultPlaintextMessageValidator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.validation.text.PlainTextMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ignoreNewLineType</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ignoreWhitespace</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="plain-text-validation-ignore"><a class="anchor" href="#plain-text-validation-ignore"></a><a class="link" href="#plain-text-validation-ignore">10.6.2. Ignoring text parts</a></h4>
<div class="paragraph">
<p>By default the plaint text validator performs a String equals operation. Test variables are automatically replaced before that comparison takes place but what about ignore statements?
The plain text message validator is able to ignore words and character sequences based on their position in the text value. Given a source plain text value:</p>
</div>
<div class="listingblock">
<div class="title">Source text</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">Your current id is &quot;1234567890&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now in the plain text validation we need to ignore the actual id value due to some reason. Maybe the id is generated on a foreign system and we simply do not know the actual value at runtime.
In this case we can use the common <code>@ignore@</code> statement in the control message payload as follows:</p>
</div>
<div class="listingblock">
<div class="title">Control text</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">Your current id is &quot;@ignore@&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus and the plain text message validator will ignore the marked part of the text during validation. This mechanism is based on the fact that the <code>@ignore@</code> statement is placed at the exact same
position as the actual id value. So this mechanism requires you to know the exact structure of the plaintext value including all whitespace characters. When Citrus finds the <code>@ignore@</code> keyword in the control value
the placeholder is replaced with the actual character sequence that is located at the exact same position in the source message payload that is validated.</p>
</div>
<div class="paragraph">
<p>The character sequence is defined as sequence of Java word characters. This word sequence is ending with a non-word character defined in Java (<code>\\W</code> which is a character that is not in <code>[a-zA-Z_0-9]</code>).</p>
</div>
<div class="paragraph">
<p>Instead of ignoring a single word you can also specify the amount of characters that should be ignored. This is when you have Java non-word characters that you need to ignore. Let&#8217;s have an example for that, too:</p>
</div>
<div class="listingblock">
<div class="title">Source text</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">Your current id is &quot;#12345-67890&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Given that text the simple <code>@ignore@</code> statement will fail because of the non-word characters <strong>'#'</strong> and <strong>'-'</strong> that are located in the id value. This time we ignore the whole id sequence with:</p>
</div>
<div class="listingblock">
<div class="title">Control text</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">Your current id is &quot;@ignore(12)@&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will ignore exactly <strong>12</strong> characters starting from the exact position of the <code>@ignore@</code> keyword. So knowing that the id is exactly <strong>12</strong> characters long we can ignore that part.</p>
</div>
</div>
<div class="sect3">
<h4 id="plain-text-validation-variables"><a class="anchor" href="#plain-text-validation-variables"></a><a class="link" href="#plain-text-validation-variables">10.6.3. Creating variables</a></h4>
<div class="paragraph">
<p>Instead of just ignoring certain text parts we can also extract those parts into test variables. The actual character sequence is ignored during validation and in addition to that the actual
value is stored to a new test variable. Given the following text payload:</p>
</div>
<div class="listingblock">
<div class="title">Source text</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">Your current id is &quot;1234567890&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the expected control text:</p>
</div>
<div class="listingblock">
<div class="title">Control text</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">Your current id is &quot;@variable('id')@&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The validation will automatically ignore the id part in the text and create a new test variable with name <code>id</code> that holds the actual value. The name of the variable to create is given in the
<code>@variable()@</code> statement. This enables us to extract dynamic text parts that we are not able to validate. After that we can access the dynamic text part using the normal test variable syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">The id was ${id}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also notice that the <code>@variable()@</code> keyword expression has to be placed at the exact same position in the text as the actual value. The variable extractor will read the variable value from the source message payload
starting from that position. The ending of the variable value is defined by a non-word Java character. Dashes <strong>'-'</strong> and dots <strong>'.'</strong> are automatically included in these values, too. So this will also work for you:</p>
</div>
<div class="listingblock">
<div class="title">Source text</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">Today is &quot;2017-12-24&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the expected control text:</p>
</div>
<div class="listingblock">
<div class="title">Control text</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">Today is &quot;@variable('date')@&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This results in a new variable called <code>date</code> with value <code>2017-12-24</code>. Also the European date representation works fine here as dots and dashes are automatically included:</p>
</div>
<div class="listingblock">
<div class="title">Source text</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">Today is &quot;24.12.2017&quot;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="binary-message-validation"><a class="anchor" href="#binary-message-validation"></a><a class="link" href="#binary-message-validation">10.7. Binary message validation</a></h3>
<div class="paragraph">
<p>Binary message validation is not very easy to do especially when it comes to compare data with a given control message. As a tester you want to validate the binary content. In Citrus the way to compare binary message content is to use base64 String encoding. The binary data is encoded as base64 character sequence and there fore is comparable with an expected content.</p>
</div>
<div class="paragraph">
<p>The received message content does not have to be base64 encoded. Citrus is doing this conversion automatically before validation takes place. The binary data can be anything e.g. images, pdf or gzip content.</p>
</div>
<div class="paragraph">
<p>The default message validator for binary messages is active by default. Citrus will pick this message validator for all messages of <strong>type="binary_base64"</strong> . The default message validator implementation can be overwritten by placing a Spring bean with id <strong>defaultBinaryBase64MessageValidator</strong> to the Spring application context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultBinaryBase64MessageValidator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.validation.text.BinaryBase64MessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the test case receiving action we tell Citrus to use binary base64 message validation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">binary_base64</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;data&gt;</span>citrus:encodeBase64('Hello World!')<span class="tag">&lt;/data&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With the message format type <strong>type="binary_base64"</strong> Citrus performs the base64 character sequence validation. Incoming message content is automatically encoded as base64 String and compared to the expected data. This way we can make sure that the binary content is as expected.</p>
</div>
<div class="paragraph">
<p>By the way sending binary messages in Citrus is also very easy. Just use the <strong>type="binary"</strong> message type in the send operation. Citrus now converts the message payload to a binary stream as payload.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">binary</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;data&gt;</span>Hello World!<span class="tag">&lt;/data&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Base64 encoding is also supported in outbound messages. Just use the <strong>encodeBase64</strong> function in Citrus. The result is a base64 encoded String as message payload.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;data&gt;</span>citrus:encodeBase64('Hello World!')<span class="tag">&lt;/data&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="gzip-message-validation"><a class="anchor" href="#gzip-message-validation"></a><a class="link" href="#gzip-message-validation">10.8. Gzip message validation</a></h3>
<div class="paragraph">
<p>Gzip is a famous message compression library. When dealing with large message content the compression might be a good way to optimize the message transportation.
Citrus is able to handle gzipped message payloads on send and receive operations. When sending compressed data we just have to use the message type <strong>gzip</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">gzip</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;data&gt;</span>Hello World!<span class="tag">&lt;/data&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Just use the <strong>type="gzip"</strong> message type in the send operation. Citrus now converts the message payload to a gzip binary stream as payload.</p>
</div>
<div class="paragraph">
<p>When validating gzip binary message content the messages are compared with a given control message in binary base64 String representation. The gzip binary data is
automatically unzipped and encoded as base64 character sequence in order to compare with an expected content.</p>
</div>
<div class="paragraph">
<p>The received message content is using gzip format but the actual message content does not have to be base64 encoded. Citrus is doing this conversion automatically
before validation takes place. The binary data can be anything e.g. images, pdf or plaintext content.</p>
</div>
<div class="paragraph">
<p>The default message validator for gzip messages is active by default. Citrus will pick this message validator for all messages of <strong>type="gzip_base64"</strong> . The default message validator implementation
can be overwritten by placing a Spring bean with id <strong>defaultGzipBinaryBase64MessageValidator</strong> to the Spring application context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultGzipBinaryBase64MessageValidator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.validation.text.GzipBinaryBase64MessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the test case receiving action we tell Citrus to use gzip message validation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">gzip_base64</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;data&gt;</span>citrus:encodeBase64('Hello World!')<span class="tag">&lt;/data&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With the message format type <strong>type="gzip_base64"</strong> Citrus performs the gzip base64 character sequence validation. Incoming message content is automatically unzipped and encoded as base64 String and
compared to the expected data. This way we can make sure that the binary content is as expected.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are using http client and server components the gzip compression support is built in with the underlying Spring and http commons libraries. So in http communication
you just have to set the header <strong>Accept-Encoding=gzip</strong> or <strong>Content-Encoding=gzip</strong>. The message data is then automatically zipped/unzipped before Citrus gets the message data
for validation. Read more about this http specific gzip compression in <a href="#http-rest">chapter http</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="java-dsl-validation-callbacks"><a class="anchor" href="#java-dsl-validation-callbacks"></a><a class="link" href="#java-dsl-validation-callbacks">10.9. Java DSL validation callbacks</a></h3>
<div class="paragraph">
<p>The Java DSL offers some additional validation tricks and possibilities when dealing with messages that are sent and received over Citrus. One of them is the validation callback functionality. With this feature you can marshal/unmarshal message payloads and code validation steps on Java objects.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> receiveMessageTest() {
    receive(bookResponseEndpoint)
        .validationCallback(<span class="keyword">new</span> XmlMarshallingValidationCallback&lt;AddBookResponseMessage&gt;() {
            <span class="annotation">@Override</span>
            <span class="directive">public</span> <span class="type">void</span> validate(AddBookResponseMessage response, MessageHeaders headers) {
                Assert.isTrue(response.isSuccess());
            }
        });
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default the validation callback needs some XML unmarshaller implementation for transforming the XML payload to a Java object. Citrus will automatically search for the unmarshaller bean in your Spring application context if nothing specific is set. Of course you can also set the unmarshaller instance explicitly.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="directive">private</span> Unmarshaller unmarshaller;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> receiveMessageTest() {
    receive(bookResponseEndpoint)
        .validationCallback(<span class="keyword">new</span> MarshallingValidationCallback&lt;AddBookResponseMessage&gt;(unmarshaller) {
            <span class="annotation">@Override</span>
            <span class="directive">public</span> <span class="type">void</span> validate(AddBookResponseMessage response, MessageHeaders headers) {
                Assert.isTrue(response.isSuccess());
            }
        });
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Obviously working on Java objects is much more comfortable than using the XML String concatenation. This is why you can also use this feature when sending messages.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="directive">private</span> Marshaller marshaller;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> sendMessageTest() {
    send(bookRequestEndpoint)
        .payload(createAddBookRequestMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">978-citrus:randomNumber(10)</span><span class="delimiter">&quot;</span></span>), marshaller)
        .header(SoapMessageHeaders.SOAP_ACTION, <span class="string"><span class="delimiter">&quot;</span><span class="content">addBook</span><span class="delimiter">&quot;</span></span>);
}

<span class="directive">private</span> AddBookRequestMessage createAddBookRequestMessage(<span class="predefined-type">String</span> isbn) {
    AddBookRequestMessage requestMessage = <span class="keyword">new</span> AddBookRequestMessage();
    <span class="predefined-type">Book</span> book = <span class="keyword">new</span> <span class="predefined-type">Book</span>();
    book.setAuthor(<span class="string"><span class="delimiter">&quot;</span><span class="content">Foo</span><span class="delimiter">&quot;</span></span>);
    book.setTitle(<span class="string"><span class="delimiter">&quot;</span><span class="content">FooTitle</span><span class="delimiter">&quot;</span></span>);
    book.setIsbn(isbn);
    book.setYear(<span class="integer">2008</span>);
    book.setRegistrationDate(<span class="predefined-type">Calendar</span>.getInstance());
    requestMessage.setBook(book);
    <span class="keyword">return</span> requestMessage;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above creates a <strong>AddBookRequestMessage</strong> object and puts this as payload to a send action. In combination with a marshaller instance Citrus is able to create a proper XML message payload then.</p>
</div>
</div>
<div class="sect2">
<h3 id="customize-message-validators"><a class="anchor" href="#customize-message-validators"></a><a class="link" href="#customize-message-validators">10.10. Customize message validators</a></h3>
<div class="paragraph">
<p>In the previous sections we have already seen some examples on how to overwrite default message validator implementations in Citrus. By default all message validators can be overwritten by placing a Spring bean of the same id to the Spring application context. The default implementations of Citrus are:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
defaultXmlMessageValidator
</td>
<td class="hdlist2">
<p>com.consol.citrus.validation.xml.DomXmlMessageValidator</p>
</td>
</tr>
<tr>
<td class="hdlist1">
defaultXpathMessageValidator
</td>
<td class="hdlist2">
<p>com.consol.citrus.validation.xml.XpathMessageValidator</p>
</td>
</tr>
<tr>
<td class="hdlist1">
defaultJsonMessageValidator
</td>
<td class="hdlist2">
<p>com.consol.citrus.validation.json.JsonTextMessageValidator</p>
</td>
</tr>
<tr>
<td class="hdlist1">
defaultJsonPathMessageValidator
</td>
<td class="hdlist2">
<p>com.consol.citrus.validation.json.JsonPathMessageValidator</p>
</td>
</tr>
<tr>
<td class="hdlist1">
defaultPlaintextMessageValidator
</td>
<td class="hdlist2">
<p>com.consol.citrus.validation.text.PlainTextMessageValidator</p>
</td>
</tr>
<tr>
<td class="hdlist1">
defaultMessageHeaderValidator
</td>
<td class="hdlist2">
<p>com.consol.citrus.validation.DefaultMessageHeaderValidator</p>
</td>
</tr>
<tr>
<td class="hdlist1">
defaultBinaryBase64MessageValidator
</td>
<td class="hdlist2">
<p>com.consol.citrus.validation.text.BinaryBase64MessageValidator</p>
</td>
</tr>
<tr>
<td class="hdlist1">
defaultGzipBinaryBase64MessageValidator
</td>
<td class="hdlist2">
<p>com.consol.citrus.validation.text.GzipBinaryBase64MessageValidator</p>
</td>
</tr>
<tr>
<td class="hdlist1">
defaultXhtmlMessageValidator
</td>
<td class="hdlist2">
<p>com.consol.citrus.validation.xhtml.XhtmlMessageValidator</p>
</td>
</tr>
<tr>
<td class="hdlist1">
defaultGroovyXmlMessageValidator
</td>
<td class="hdlist2">
<p>com.consol.citrus.validation.script.GroovyXmlMessageValidator</p>
</td>
</tr>
<tr>
<td class="hdlist1">
defaultGroovyTextMessageValidator
</td>
<td class="hdlist2">
<p>com.consol.citrus.validation.script.GroovyScriptMessageValidator</p>
</td>
</tr>
<tr>
<td class="hdlist1">
defaultGroovyJsonMessageValidator
</td>
<td class="hdlist2">
<p>com.consol.citrus.validation.script.GroovyJsonMessageValidator</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Overwriting a single message validator with a custom implementation is then very easy. Just add your custom Spring bean to the application context using one of these default bean identifiers. In case you want to change the message validator gang by adding or removing a message validator implementation completely you can place a message validator component in the Spring application context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:message-validators&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultXmlMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultXpathMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultGroovyXmlMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultPlaintextMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultMessageHeaderValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultBinaryBase64MessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultGzipBinaryBase64MessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.validation.custom.CustomMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultJsonMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultJsonPathMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultGroovyJsonMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultGroovyTextMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultXhtmlMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/citrus:message-validators&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The listing above adds a custom message validator implementation to the sequence of message validators in Citrus. We reference default message validators and add a implementation of type <strong>com.consol.citrus.validation.custom.CustomMessageValidator</strong> . The custom implementation class has to implement the basic interface <strong>com.consol.citrus.validation.MessageValidator</strong> . Now Citrus will try to match the custom implementation to incoming message types and occasionally execute the message validator logic. This is how you can add and change the basic message validator registry in Citrus. You can add custom implementations for new message formats very easy.</p>
</div>
<div class="paragraph">
<p>The same approach applies in case you want to remove a message validator implementation by banning it completely. Just delete the entry in the message validator registry component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:message-validators&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultJsonMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultJsonPathMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultGroovyJsonMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultGroovyTextMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultMessageHeaderValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/citrus:message-validators&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Citrus message validator component deleted all default implementations except of those dealing with JSON message format. Now Citrus is only able to validate JSON messages. Be careful as the complete Citrus project will be affected by this change.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="xpath"><a class="anchor" href="#xpath"></a><a class="link" href="#xpath">11. Using XPath</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Some time ago in this document we have already seen how XML message payloads are constructed when sending and receiving messages. Now using XPath is a very powerful way of accessing elements in complex XML structures. The XPath expression language is very handy when it comes to save element values as test variables or when validating special elements in a XML message structure.</p>
</div>
<div class="paragraph">
<p>XPath is a very powerful technology for walking XML trees. This W3C standard stands for advanced XML tree handling using a special syntax as query language. Citrus supports the XPath syntax in the following fields:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
message
</td>
<td class="hdlist2">
<p>&lt;message&gt;&lt;element path="[XPath-Expression]"&gt;&lt;/message&gt;</p>
</td>
</tr>
<tr>
<td class="hdlist1">
validate
</td>
<td class="hdlist2">
<p>&lt;validate&gt;&lt;xpath expression="[XPath-Expression]"/&gt;&lt;/validate&gt;</p>
</td>
</tr>
<tr>
<td class="hdlist1">
extract
</td>
<td class="hdlist2">
<p>&lt;extract&gt;&lt;message path="[XPath-Expression]"&gt;&lt;/extract&gt;</p>
</td>
</tr>
<tr>
<td class="hdlist1">
ignore
</td>
<td class="hdlist2">
<p>&lt;ignore path="[XPath-Expression]"/&gt;</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The next program listing indicates the power in using XPath with Citrus:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;message&gt;</span>
  <span class="tag">&lt;validate&gt;</span>
    <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//User/Name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">John</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//User/Address[@type='office']/Street</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Companystreet 21</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//User/Name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${userName}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//User/@isAdmin</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${isAdmin}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//User/@isAdmin</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">result-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">boolean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//*[.='search-for']</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">searched-for</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">count(//orderStatus[.='success'])</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">result-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">number</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/validate&gt;</span>
<span class="tag">&lt;/message&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we describe the XPath usage in Citrus step by step.</p>
</div>
<div class="sect2">
<h3 id="manipulate-with-xpath"><a class="anchor" href="#manipulate-with-xpath"></a><a class="link" href="#manipulate-with-xpath">11.1. Manipulate with XPath</a></h3>
<div class="paragraph">
<p>Some elements in XML message payloads might be of dynamic nature. Just think of generated identifiers or timestamps. Also we do not want to repeat the same static identifier several times in our test cases. This is the time where test variables and dynamic message element overwrite come in handy. The idea is simple. We want to overwrite a specific message element in our payload with a dynamic value. This can be done with XPath or inline variable declarations. Lets have a look at an example listing showing both ways:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;message&gt;</span>
  <span class="tag">&lt;payload&gt;</span>
    <span class="tag">&lt;TestMessage&gt;</span>
      <span class="tag">&lt;MessageId&gt;</span>${messageId}<span class="tag">&lt;/MessageId&gt;</span>
      <span class="tag">&lt;CreatedBy&gt;</span>_<span class="tag">&lt;/CreatedBy&gt;</span>
      <span class="tag">&lt;VersionId&gt;</span>${version}<span class="tag">&lt;/VersionId&gt;</span>
    <span class="tag">&lt;/TestMessage&gt;</span>
  <span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;element</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/TestMessage/CreatedBy</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${user}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/message&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The program listing above shows ways of setting variable values inside a message template. First of all you can simply place variable expressions inside the message (see how ${messageId} is used). In addition to that you can also use XPath expressions to explicitly overwrite message elements before validation.</p>
</div>
<div class="paragraph">
<p><code>&lt;element path=&quot;/TestMessage/CreatedBy&quot; value=&quot;${user}&quot;/&gt;</code></p>
</div>
<div class="paragraph">
<p>The XPath expression evaluates and searches for the right element in the message payload. The previously defined variable <strong>${user}</strong> replaces the element value. Of course this works with XML attributes too.</p>
</div>
<div class="paragraph">
<p>Both ways via XPath or inline variable expressions are equal to each other. With respect to the complexity of XML namespaces and XPath you may find the inline variable expression more comfortable to use. Anyway feel free to choose the way that fits best for you. This is how we can add dynamic variable values to the control template in order to increase maintainability and robustness of message validation.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Validation matchers put validation mechanisms to a new level offering dynamic assertion statements for validation. Have a look at the possibilities with assertion statements in <a href="#validation-matcher">validation-matcher</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="xpath-validation"><a class="anchor" href="#xpath-validation"></a><a class="link" href="#xpath-validation">11.2. Validate with XPath</a></h3>
<div class="paragraph">
<p>We have already seen how to validate whole XML structures with control message templates. All elements are validated and compared one after another. In some cases this approach might be too extensive. Imagine the tester only needs to validate a small subset of message elements. The definition of control templates in combination with several ignore statements is not appropriate in this case. You would rather want to use explicit element validation.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;message&gt;</span>
  <span class="tag">&lt;validate&gt;</span>
    <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/TestRequest/MessageId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/TestRequest/VersionId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/validate&gt;</span>
<span class="tag">&lt;/message&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> receiveMessageTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceServer</span><span class="delimiter">&quot;</span></span>)
        .validate(<span class="string"><span class="delimiter">&quot;</span><span class="content">/TestRequest/MessageId</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span>)
        .validate(<span class="string"><span class="delimiter">&quot;</span><span class="content">//VersionId</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>)
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of comparing the whole message some message elements are validated explicitly via XPath. Citrus evaluates the XPath expression on the received message and compares the result value to the control value. The basic message structure as well as all other message elements are not included into this explicit validation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If this type of element validation is chosen neither &lt;payload&gt; nor &lt;data&gt; nor &lt;resource&gt; template definitions are allowed in Citrus XML test cases.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Citrus offers an alternative dot-notated syntax in order to walk through XML trees. In case you are not familiar with XPath or simply need a very easy way to find your element inside the XML tree you might use this way. Every element hierarchy in the XML tree is represented with a simple dot - for example:
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>TestRequest.VersionId</code></p>
</div>
<div class="paragraph">
<p>The expression will search the XML tree for the respective &lt;TestRequest&gt;&lt;VersionId&gt; element. Attributes are supported too. In case the last element in the dot-notated expression is a XML attribute the framework will automatically find it.</p>
</div>
<div class="paragraph">
<p>Of course this dot-notated syntax is very simple and might not be applicable for more complex tree navigation. XPath is much more powerful - no doubt. However the dot-notated syntax might help those of you that are not familiar with XPath. So the dot-notation is supported wherever XPath expressions might apply.</p>
</div>
<div class="paragraph">
<p>The Xpath expressions can evaluate to different result types. By default Citrus is operating on <strong>NODE</strong> and <strong>STRING</strong> result types so that you can validate some element value. But you can also use different result types such as <strong>NODESET</strong> and <strong>BOOLEAN</strong> . See this example how that works:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;message&gt;</span>
  <span class="tag">&lt;validate&gt;</span>
    <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/TestRequest/Error</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">result-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">boolean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/TestRequest/Status[.='success']</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">result-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">number</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/TestRequest/OrderType</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">[single, multi, multi]</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">result-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">node-set</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/validate&gt;</span>
<span class="tag">&lt;/message&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> receiveMessageTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceServer</span><span class="delimiter">&quot;</span></span>)
        .validate(<span class="string"><span class="delimiter">&quot;</span><span class="content">boolean:/TestRequest/Error</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">false</span>)
        .validate(<span class="string"><span class="delimiter">&quot;</span><span class="content">number:/TestRequest/Status[.='success']</span><span class="delimiter">&quot;</span></span>, <span class="integer">3</span>)
        .validate(<span class="string"><span class="delimiter">&quot;</span><span class="content">node-set:/TestRequest/OrderType</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">[single, multi, multi]</span><span class="delimiter">&quot;</span></span>)
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above we use different expression result types. First we want to make sure nor <strong>/TestRequest/Error</strong> element is present. This can be done with a boolean result type and <strong>false</strong> value. Second we want to validate the number of found elements for the expression <strong>/TestRequest/Status[.='success']</strong> . The XPath expression evaluates to a node list that results in its list size to be checked. And last not least we evaluate to a <strong>node-set</strong> result type where all values in the node list will be translated to a comma delimited string value.</p>
</div>
<div class="paragraph">
<p>Now lets have a look at some more powerful validation expressions using matcher implementations. Up to now we have seen that XPath expression results are comparable with <strong>equalTo</strong> operations. We would like to add some more powerful validation such as <strong>greaterThan</strong>, <strong>lessThan</strong>, <strong>hasSize</strong> and much more. Therefore we have introduced Hamcrest validation matcher support in Citrus. Hamcrest is a very powerful matcher library that provides a fantastic set of matcher implementations. Lets see how we can add these in our test case:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;message&gt;</span>
  <span class="tag">&lt;validate&gt;</span>
    <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/TestRequest/Error</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">@assertThat(anyOf(empty(), nullValue()))@</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/TestRequest/Status[.='success']</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">@assertThat(greaterThan(0.0))@</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">result-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">number</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/TestRequest/Status[.='failed']</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">@assertThat(lowerThan(1))@</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">result-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">integer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/TestRequest/OrderType</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">@assertThat(hasSize(3))@</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">result-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">node-set</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/validate&gt;</span>
<span class="tag">&lt;/message&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> receiveMessageTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceServer</span><span class="delimiter">&quot;</span></span>)
        .validate(<span class="string"><span class="delimiter">&quot;</span><span class="content">/TestRequest/Error</span><span class="delimiter">&quot;</span></span>, anyOf(empty(), nullValue()))
        .validate(<span class="string"><span class="delimiter">&quot;</span><span class="content">number:/TestRequest/Status[.='success']</span><span class="delimiter">&quot;</span></span>, greaterThan(<span class="float">0.0</span>))
        .validate(<span class="string"><span class="delimiter">&quot;</span><span class="content">integer:/TestRequest/Status[.='failed']</span><span class="delimiter">&quot;</span></span>, lowerThan(<span class="integer">1</span>))
        .validate(<span class="string"><span class="delimiter">&quot;</span><span class="content">node-set:/TestRequest/OrderType</span><span class="delimiter">&quot;</span></span>, hasSize(<span class="integer">3</span>))
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
XPath uses decimal number type <strong>Double</strong> by default when evaluating expressions with <strong>number</strong> result type. This means we have to use Double typed expected values, too. Citrus also provides the result type <strong>integer</strong> that automatically converts the XPath expression result to a <strong>Integer</strong> type.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When using the XML DSL we have to use the <strong>assertThat</strong> validation matcher syntax for defining the Hamcrest matcher. You can combine matcher implementation as seen in the <strong>anyOf(empty(), nullValue())</strong> expression. When using the Java DSL you can just add the matcher as expected result object. Citrus evaluates the matchers and makes sure everything is as expected. This is a very powerful validation mechanism as it also works with node-sets containing multiple values as list.</p>
</div>
<div class="paragraph">
<p>This is how you can add very powerful message element validation in XML using XPath expressions.</p>
</div>
</div>
<div class="sect2">
<h3 id="extract-variables-with-xpath"><a class="anchor" href="#extract-variables-with-xpath"></a><a class="link" href="#extract-variables-with-xpath">11.3. Extract variables with XPath</a></h3>
<div class="paragraph">
<p>Imagine you receive a message in your test with some generated message identifier values. You have no chance to predict the identifier value because it was generated at runtime by a foreign application. You can ignore the value in order to protect your validation. But in many cases you might need to return this identifier in the respective response message or somewhat later on in the test. So we have to save the dynamic message content for reuse in later test steps. The solution is simple and very powerful. We can extract dynamic values from received messages and save those to test variables. Add this code to your message receiving action.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;extract&gt;</span>
  <span class="tag">&lt;header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">variable</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">operation</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;message</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/TestRequest/VersionId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">variable</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">versionId</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/extract&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> receiveMessageTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceServer</span><span class="delimiter">&quot;</span></span>)
        .extractFromHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">operation</span><span class="delimiter">&quot;</span></span>)
        .extractFromPayload(<span class="string"><span class="delimiter">&quot;</span><span class="content">//TestRequest/VersionId</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">versionId</span><span class="delimiter">&quot;</span></span>);

    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Extracted operation from header is: ${operation}</span><span class="delimiter">&quot;</span></span>);
    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Extracted version from payload is: ${versionId}</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see Citrus is able to extract both header and message payload content into test variables. It does not matter if you use new test variables or existing variables as target. The extraction will automatically create a new variable in case it does not exist. The time the variable was created all following test actions can access the test variables as usual. So you can reference the variable values in response messages or other test steps ahead.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
We can also use expression result types in order to manipulate the test variable outcome. In case we use a <strong>boolean</strong> result type the existence of elements can be saved to variable values. The result type <strong>node-set</strong> translates a node list result to a comma separated string of all values in this node list. Simply use the expression result type attributes as shown in previous sections.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="xml-namespaces-in-xpath"><a class="anchor" href="#xml-namespaces-in-xpath"></a><a class="link" href="#xml-namespaces-in-xpath">11.4. XML namespaces in XPath</a></h3>
<div class="paragraph">
<p>When it comes to XML namespaces you have to be careful with your XPath expressions. Lets have a look at an example message that uses XML namespaces:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ns1:TestMessage</span> <span class="attribute-name">xmlns:ns1</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrus.com/namespace</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;ns1:TestHeader&gt;</span>
        <span class="tag">&lt;ns1:CorrelationId&gt;</span>_<span class="tag">&lt;/ns1:CorrelationId&gt;</span>
        <span class="tag">&lt;ns1:Timestamp&gt;</span>2001-12-17T09:30:47.0Z<span class="tag">&lt;/ns1:Timestamp&gt;</span>
        <span class="tag">&lt;ns1:VersionId&gt;</span>2<span class="tag">&lt;/ns1:VersionId&gt;</span>
    <span class="tag">&lt;/ns1:TestHeader&gt;</span>
    <span class="tag">&lt;ns1:TestBody&gt;</span>
        <span class="tag">&lt;ns1:Customer&gt;</span>
            <span class="tag">&lt;ns1:Id&gt;</span>1<span class="tag">&lt;/ns1:Id&gt;</span>
        <span class="tag">&lt;/ns1:Customer&gt;</span>
    <span class="tag">&lt;/ns1:TestBody&gt;</span>
<span class="tag">&lt;/ns1:TestMessage&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we would like to validate some elements in this message using XPath</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;message&gt;</span>
  <span class="tag">&lt;validate&gt;</span>
    <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//TestMessage/TestHeader/VersionId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//TestMessage/TestHeader/CorrelationId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${correlationId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/validate&gt;</span>
<span class="tag">&lt;/message&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The validation will fail although the XPath expression looks correct regarding the XML tree. Because the message uses the namespace with its prefix <strong><em>ns1</em></strong> our XPath expression is not able to find the elements. The correct XPath expression uses the namespace prefix as defined in the message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;message&gt;</span>
  <span class="tag">&lt;validate&gt;</span>
    <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//ns1:TestMessage/ns1:TestHeader/ns1:VersionId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//ns1:TestMessage/ns1:TestHeader/ns1:CorrelationId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${correlationId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/message&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the expressions work fine and the validation is successful. But this is quite error prone. This is because the test is now depending on the namespace prefix that is used by some application. As soon as the message is sent with a different namespace prefix (e.g. ns2) the validation will fail again.</p>
</div>
<div class="paragraph">
<p>You can avoid this effect when specifying your own namespace context and your own namespace prefix during validation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;message&gt;</span>
  <span class="tag">&lt;validate&gt;</span>
    <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//pfx:TestMessage/pfx:TestHeader/pfx:VersionId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//pfx:TestMessage/pfx:TestHeader/pfx:CorrelationId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${correlationId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;namespace</span> <span class="attribute-name">prefix</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pfx</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrus.com/namespace</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/validate&gt;</span>
<span class="tag">&lt;/message&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the test in independent from any namespace prefix in the received message. The namespace context will resolve the namespaces and find the elements although the message might use different prefixes. The only thing that matters is that the namespace value (<a href="http://citrus.com/namespace">http://citrus.com/namespace</a>) matches.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Instead of this namespace context on validation level you can also have a global namespace context which is valid in all test cases. We just add a bean in the basic Spring application context configuration which defines global namespace mappings.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;namespace-context&gt;</span>
    <span class="tag">&lt;namespace</span> <span class="attribute-name">prefix</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">def</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.consol.de/samples/sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/namespace-context&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once defined the <strong>def</strong> namespace prefix is valid in all test cases and all XPath expressions. This enables you to free your test cases from namespace prefix bindings that might be broken with time. You can use these global namespace mappings wherever XPath expressions are valid inside a test case (validation, ignore, extract).</p>
</div>
</div>
<div class="sect2">
<h3 id="default-namespaces-in-xpath"><a class="anchor" href="#default-namespaces-in-xpath"></a><a class="link" href="#default-namespaces-in-xpath">11.5. Default namespaces in XPath</a></h3>
<div class="paragraph">
<p>In the previous section we have seen that XML namespaces can get tricky with XPath validation. Default namespaces can do even more! So lets look at the example with default namespaces:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;TestMessage</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrus.com/namespace</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;TestHeader&gt;</span>
        <span class="tag">&lt;CorrelationId&gt;</span>_<span class="tag">&lt;/CorrelationId&gt;</span>
        <span class="tag">&lt;Timestamp&gt;</span>2001-12-17T09:30:47.0Z<span class="tag">&lt;/Timestamp&gt;</span>
        <span class="tag">&lt;VersionId&gt;</span>2<span class="tag">&lt;/VersionId&gt;</span>
    <span class="tag">&lt;/TestHeader&gt;</span>
    <span class="tag">&lt;TestBody&gt;</span>
        <span class="tag">&lt;Customer&gt;</span>
            <span class="tag">&lt;Id&gt;</span>1<span class="tag">&lt;/Id&gt;</span>
        <span class="tag">&lt;/Customer&gt;</span>
    <span class="tag">&lt;/TestBody&gt;</span>
<span class="tag">&lt;/TestMessage&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The message uses default namespaces. The following approach in XPath will fail due to namespace problems.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;message&gt;</span>
  <span class="tag">&lt;validate&gt;</span>
    <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//TestMessage/TestHeader/VersionId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//TestMessage/TestHeader/CorrelationId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${correlationId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/validate&gt;</span>
<span class="tag">&lt;/message&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Even default namespaces need to be specified in the XPath expressions. Look at the following code listing that works fine with default namespaces:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;message&gt;</span>
  <span class="tag">&lt;validate&gt;</span>
    <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//:TestMessage/:TestHeader/:VersionId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;xpath</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//:TestMessage/:TestHeader/:CorrelationId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${correlationId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/validate&gt;</span>
<span class="tag">&lt;/message&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
It is recommended to use the namespace context as described in the previous chapter when validating. Only this approach ensures flexibility and stable test cases regarding namespace changes.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jsonpath"><a class="anchor" href="#jsonpath"></a><a class="link" href="#jsonpath">12. Using JSONPath</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>JSONPath is the JSON equivalent to XPath in the XML message world. With JSONPath expressions you can query and manipulate entries of a JSON message structure. The JSONPath expressions evaluate against a JSON message where the JSON object structure is represented in a dot notated syntax.</p>
</div>
<div class="paragraph">
<p>You will see that JSONPath is a very powerful technology when it comes to find object entries in a complex JSON hierarchy structure. Also JSONPath can help to do message manipulations before a message is sent out for instance. Citrus supports JSONPath expressions in various scenarios:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
message
</td>
<td class="hdlist2">
<p>&lt;message&gt;&lt;element path="[JSONPath-Expression]"&gt;&lt;/message&gt;</p>
</td>
</tr>
<tr>
<td class="hdlist1">
validate
</td>
<td class="hdlist2">
<p>&lt;validate&gt;&lt;json-path expression="[JSONPath-Expression]"/&gt;&lt;/validate&gt;</p>
</td>
</tr>
<tr>
<td class="hdlist1">
extract
</td>
<td class="hdlist2">
<p>&lt;extract&gt;&lt;message path="[JSONPath-Expression]"&gt;&lt;/extract&gt;</p>
</td>
</tr>
<tr>
<td class="hdlist1">
ignore
</td>
<td class="hdlist2">
<p>&lt;ignore path="[JSONPath-Expression]"/&gt;</p>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="manipulate-with-jsonpath"><a class="anchor" href="#manipulate-with-jsonpath"></a><a class="link" href="#manipulate-with-jsonpath">12.1. Manipulate with JSONPath</a></h3>
<div class="paragraph">
<p>First thing we want to do with JSONPath is to manipulate a message content before it is actually sent out. This is very useful when working with message file resources that are reused across multiple test cases. Each test case can manipulate the message content individually with JSONPath before sending. Lets have a look at this simple sample:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">json</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;resource</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file:path/to/user.json</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
  <span class="tag">&lt;element</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$.user.name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Admin</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
  <span class="tag">&lt;element</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$.user.admin</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
  <span class="tag">&lt;element</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$..status</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">closed</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/message&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We use a basic message content file that is called <strong>user.json</strong> . The content of the file is following JSON data structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">{ &quot;user&quot;:
  {
    &quot;id&quot;: citrus:randomNumber(10),
    &quot;name&quot;: &quot;Unknown&quot;,
    &quot;admin&quot;: &quot;?&quot;,
    &quot;projects&quot;:
      [{
        &quot;name&quot;: &quot;Project1&quot;,
        &quot;status&quot;: &quot;open&quot;
      },
      {
        &quot;name&quot;: &quot;Project2&quot;,
        &quot;status&quot;: &quot;open&quot;
      },
      {
        &quot;name&quot;: &quot;Project3&quot;,
        &quot;status&quot;: &quot;closed&quot;
      }]
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus loads the file content and used it as message payload. Before the message is sent out the JSONPath expressions have the chance to manipulate the message content. All JSONPath expressions are evaluated and the give values overwrite existing values accordingly. The resulting message looks like follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">{ &quot;user&quot;:
  {
    &quot;id&quot;: citrus:randomNumber(10),
    &quot;name&quot;: &quot;Admin&quot;,
    &quot;admin&quot;: &quot;true&quot;,
    &quot;projects&quot;:
      [{
        &quot;name&quot;: &quot;Project1&quot;,
        &quot;status&quot;: &quot;closed&quot;
      },
      {
        &quot;name&quot;: &quot;Project2&quot;,
        &quot;status&quot;: &quot;closed&quot;
      },
      {
        &quot;name&quot;: &quot;Project3&quot;,
        &quot;status&quot;: &quot;closed&quot;
      }]
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The JSONPath expressions have set the user name to <strong>Admin</strong> . The <strong>admin</strong> boolean property was set to <strong>true</strong> and all project status values were set to <strong>closed</strong> . Now the message is ready to be sent out. In case a JSONPath expression should fail to find a matching element within the message structure the test case will fail.</p>
</div>
<div class="paragraph">
<p>With this JSONPath mechanism ou are able to manipulate message content before it is sent or received within Citrus. This makes life very easy when using message resource files that are reused across multiple test cases.</p>
</div>
</div>
<div class="sect2">
<h3 id="validate-with-jsonpath"><a class="anchor" href="#validate-with-jsonpath"></a><a class="link" href="#validate-with-jsonpath">12.2. Validate with JSONPath</a></h3>
<div class="paragraph">
<p>Lets continue to use JSONPath expressions when validating a receive message in Citrus:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">json</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;validate&gt;</span>
    <span class="tag">&lt;json-path</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$.user.name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Penny</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;json-path</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$['user']['name']</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${userName}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;json-path</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$.user.aliases</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">[</span><span class="delimiter">&quot;</span></span><span class="attribute-name">penny</span><span class="error">&quot;</span><span class="error">,</span><span class="error">&quot;</span><span class="attribute-name">jenny</span><span class="error">&quot;</span><span class="error">,</span><span class="error">&quot;</span><span class="attribute-name">nanny</span><span class="error">&quot;</span><span class="error">]</span><span class="error">&quot;</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;json-path</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$.user[?(@.admin)].password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">@startsWith('$%00')@</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;json-path</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$.user.address[?(@.type='office')]</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{</span><span class="delimiter">&quot;</span></span><span class="attribute-name">city</span><span class="error">&quot;</span><span class="attribute-name">:</span><span class="error">&quot;</span><span class="attribute-name">Munich</span><span class="error">&quot;</span><span class="error">,</span><span class="error">&quot;</span><span class="attribute-name">street</span><span class="error">&quot;</span><span class="attribute-name">:</span><span class="error">&quot;</span><span class="attribute-name">Company</span> <span class="attribute-name">Street</span><span class="error">&quot;</span><span class="error">,</span><span class="error">&quot;</span><span class="attribute-name">type</span><span class="error">&quot;</span><span class="attribute-name">:</span><span class="error">&quot;</span><span class="attribute-name">office</span><span class="error">&quot;</span><span class="error">}</span><span class="error">&quot;</span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/validate&gt;</span>
<span class="tag">&lt;/message&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">receive(someEndpoint)
    .messageType(MessageType.JSON)
    .validate(&quot;$.user.name&quot;, &quot;Penny&quot;)
    .validate(&quot;$['user']['name']&quot;, &quot;${userName}&quot;)
    .validate(&quot;$.user.aliases&quot;, &quot;[&quot;penny&quot;,&quot;jenny&quot;,&quot;nanny&quot;]&quot;)
    .validate(&quot;$.user[?(@.admin)].password&quot;, &quot;@startsWith('$%00')@&quot;)
    .validate(&quot;$.user.address[?(@.type='office')]&quot;, &quot;{&quot;city&quot;:&quot;Munich&quot;,&quot;street&quot;:&quot;Company Street&quot;,&quot;type&quot;:&quot;office&quot;}&quot;);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above JSONPath expressions will be evaluated when Citrus validates the received message. The expression result is compared to the expected value where expectations can be static values as well as test variables and validation matcher expressions. In case a JSONPath expression should not be able to find any elements the test case will also fail.</p>
</div>
<div class="paragraph">
<p>JSON is a pretty simple yet powerful message format. Simply put, a JSON message just knows JSONObject, JSONArray and JSONValue items. The handling of JSONObject and JSONValue items in JSONPath expressions is straight forward. We just use a dot notated syntax for walking through the JSONObject hierarchy. The handling of JSONArray items is also not very difficult either. Citrus will try the best to convert JSONArray items to String representation values for comparison.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
JSONPath expressions will only work on JSON message formats. This is why we have to tell Citrus the correct message format. By default Citrus is working with XML message data and therefore the XML validation mechanisms do apply by default. With the message type attribute set to <strong>json</strong> we make sure that Citrus enables JSON specific features on the message validation such as JSONPath support.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now lets get a bit more complex with validation matchers and JSON object functions. Citrus tries to give you the most comfortable validation capabilities when comparing JSON object values and JSON arrays. One first thing you can use is object functions like <strong>keySet()</strong> or <strong>size()</strong> . This functionality is not covered by JSONPath out of the box but added by Citrus. See the following example on how to use it:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">json</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;validate&gt;</span>
    <span class="tag">&lt;json-path</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$.user.keySet()</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">[id,name,admin,projects]</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;json-path</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$.user.aliases.size()</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/validate&gt;</span>
<span class="tag">&lt;/message&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">receive(someEndpoint)
    .messageType(MessageType.JSON)
    .validate(&quot;$.user.keySet()&quot;, &quot;[id,name,admin,projects]&quot;)
    .validate(&quot;$.user.aliases.size()&quot;, &quot;3&quot;);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The object functions do return special JSON object related properties such as the set of <strong>keys</strong> for an object or the size of an JSON array.</p>
</div>
<div class="paragraph">
<p>Now lets get even more comfortable validation capabilities with matchers. Citrus supports Hamcrest matchers which gives us a very powerful way of validating JSON object elements and arrays. See the following examples that demonstrate how this works:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">json</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;validate&gt;</span>
    <span class="tag">&lt;json-path</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$.user.keySet()</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">@assertThat(contains(id,name,admin,projects))@</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;json-path</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$.user.aliases.size()</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">@assertThat(allOf(greaterThan(0), lessThan(5)))@</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/validate&gt;</span>
<span class="tag">&lt;/message&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">receive(someEndpoint)
    .messageType(MessageType.JSON)
    .validate(&quot;$.user.keySet()&quot;, contains(&quot;id&quot;,&quot;name&quot;,&quot;admin&quot;,&quot;projects&quot;))
    .validate(&quot;$.user.aliases.size()&quot;, allOf(greaterThan(0), lessThan(5)));</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using the XML DSL we have to use the <strong>assertThat</strong> validation matcher syntax for defining the Hamcrest matchers. You can combine matcher implementation as seen in the <strong>allOf(greaterThan(0), lessThan(5))</strong> expression. When using the Java DSL you can just add the matcher as expected result object. Citrus evaluates the matchers and makes sure everything is as expected. This is a very powerful validation mechanism as it combines the Hamcrest matcher capabilities with JSON message validation.</p>
</div>
</div>
<div class="sect2">
<h3 id="extract-variables-with-jsonpath"><a class="anchor" href="#extract-variables-with-jsonpath"></a><a class="link" href="#extract-variables-with-jsonpath">12.3. Extract variables with JSONPath</a></h3>
<div class="paragraph">
<p>Citrus is able to save message content to test variables at test runtime. When an incoming message is passing the message validation the user can extract some values of that received message to new test variables for later use in the test. This is especially handsome when having to send back some dynamic values. So lets save some values using JSONPath:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">json</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;data&gt;</span>
    { &quot;user&quot;:
      {
        &quot;name&quot;: &quot;Admin&quot;,
        &quot;password&quot;: &quot;secret&quot;,
        &quot;admin&quot;: &quot;true&quot;,
        &quot;aliases&quot;: [&quot;penny&quot;,&quot;chef&quot;,&quot;master&quot;]
      }
    }
  <span class="tag">&lt;/data&gt;</span>
  <span class="tag">&lt;extract&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$.user.name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">variable</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userName</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$.user.aliases</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">variable</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userAliases</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$.user[?(@.admin)].password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">variable</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">adminPassword</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/extract&gt;</span>
<span class="tag">&lt;/message&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With this example we have extracted three new test variables via JSONPath expression evaluation. The three test variables will be available to all upcoming test actions. The variable values are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">userName=Admin
userAliases=[&quot;penny&quot;,&quot;chef&quot;,&quot;master&quot;]
adminPassword=secret</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see we can also extract complex JSONObject items or JSONArray items. The test variable value is a String representation of the complex object.</p>
</div>
</div>
<div class="sect2">
<h3 id="ignore-with-jsonpath"><a class="anchor" href="#ignore-with-jsonpath"></a><a class="link" href="#ignore-with-jsonpath">12.4. Ignore with JSONPath</a></h3>
<div class="paragraph">
<p>The next usage scenario for JSONPath expressions in Citrus is the ignoring of elements during message validation. As you already know Citrus provides powerful validation mechanisms for XML and JSON message format. The framework is able to compare received and expected message contents with powerful validator implementations. Now it this time we want to use a JSONPath expression for ignoring a very specific entry in the JSON object structure.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">json</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;data&gt;</span>
  {
      &quot;users&quot;:
      [{
        &quot;name&quot;: &quot;Jane&quot;,
        &quot;token&quot;: &quot;?&quot;,
        &quot;lastLogin&quot;: 0
      },
      {
        &quot;name&quot;: &quot;Penny&quot;,
        &quot;token&quot;: &quot;?&quot;,
        &quot;lastLogin&quot;: 0
      },
      {
        &quot;name&quot;: &quot;Mary&quot;,
        &quot;token&quot;: &quot;?&quot;,
        &quot;lastLogin&quot;: 0
      }]
  }
  <span class="tag">&lt;/data&gt;</span>
  <span class="tag">&lt;ignore</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$.users[*].token</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
  <span class="tag">&lt;ignore</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$..lastLogin</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/message&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This time we add JSONPath expressions as ignore statements. This means that we explicitly leave out the evaluated elements from validation. Obviously this mechanism is a good thing to do when dynamic message data simply is not deterministic such as timestamps and dynamic identifiers. In the example above we explicitly skip the <strong>token</strong> entry and all <strong>lastLogin</strong> values that are obviously timestamp values in milliseconds.</p>
</div>
<div class="paragraph">
<p>The JSONPath evaluation is very powerful when it comes to select a set of JSON objects and elements. This is how we can ignore several elements with one single JSONPath expression which is very powerful.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="actions"><a class="anchor" href="#actions"></a><a class="link" href="#actions">13. Test actions</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter gives a brief description to all test actions that a tester can incorporate into the test case. Besides sending
and receiving messages the tester may access these actions in order to build a more complex test scenario that fits the desired use case.</p>
</div>
<div class="sect2">
<h3 id="actions-send"><a class="anchor" href="#actions-send"></a><a class="link" href="#actions-send">13.1. Sending messages</a></h3>
<div class="paragraph">
<p>In a integration test scenario we want to trigger processes and call interface services on the system under test. In order to do this we need to be able to send messages to various message transports. Therefore the send message test action in Citrus is one of the most important test actions. First of all let us have a look at the Citrus message definition in Citrus:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/figure_001.jpg" alt="figure_001.jpg"></span></p>
</div>
<div class="paragraph">
<p>A message consists of a message header (name-value pairs) and a message payload. Later in this section we will see different ways of constructing a message with payload and header values. But first of all let&#8217;s concentrate on a simple sending message action inside a test case.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SendMessageTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;description&gt;</span>Basic send message example<span class="tag">&lt;/description&gt;</span>

    <span class="tag">&lt;variables&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Citrus!</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Mx1x123456789</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/variables&gt;</span>

    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;message</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloMessage</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;payload&gt;</span>
                    <span class="tag">&lt;TestMessage&gt;</span>
                        <span class="tag">&lt;Text&gt;</span>${text}<span class="tag">&lt;/Text&gt;</span>
                    <span class="tag">&lt;/TestMessage&gt;</span>
                <span class="tag">&lt;/payload&gt;</span>
            <span class="tag">&lt;/message&gt;</span>
            <span class="tag">&lt;header&gt;</span>
                <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MessageId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/header&gt;</span>
        <span class="tag">&lt;/send&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The message name is optional and defines the message identifier in the local message store. This message name is very useful when accessing the message content later on during the test case. The local message store is handled per test case and contains all exchanged messages.
The sample uses both header and payload as message parts to send. In both parts you can use variable definitions (see <strong>${text}</strong> and <strong>${messageId}</strong>). So first of all let us recap what variables do. Test variables are defined at the very beginning of the test case and are valid throughout all actions that take place in the test. This means that actions can simply reference a variable by the expression <strong><em>${variable-name}</em></strong> .</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Use variables wherever you can! At least the important entities of a test should be defined as variables at the beginning. The test case improves maintainability and flexibility when using variables.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now lets have a closer look at the sending action. The <strong>'endpoint'</strong> attribute might catch your attention first. This attribute references a message endpoint in Citrus configuration by name. As previously mentioned the message endpoint definition lives in a separate configuration file and contains the actual message transport settings. In this example the <strong>"helloServiceEndpoint"</strong> is referenced which is a message endpoint for sending out messages via JMS or HTTP for instance.</p>
</div>
<div class="paragraph">
<p>The test case is not aware of any transport details, because it does not have to. The advantages are obvious: On the one hand multiple test cases can reference the message endpoint definition for better reuse. Secondly test cases are independent of message transport details. So connection factories, user credentials, endpoint uri values and so on are not present in the test case.</p>
</div>
<div class="paragraph">
<p>In other words the <strong>"endpoint"</strong> attribute of the <code>&lt;send&gt;</code> element specifies which message endpoint definition to use and therefore where the message should go to. Once again all available message endpoints are configured in a separate Citrus configuration file. We will come to this later on. Be sure to always pick the right message endpoint type in order to publish your message to the right destination.</p>
</div>
<div class="paragraph">
<p>If you do not like the XML language you can also use pure Java code to define the same test. In Java you would also make use of the message endpoint definition and reference this instance. The same test as shown above in Java DSL looks like this:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.testng.ITestContext</span>;
<span class="keyword">import</span> <span class="include">org.testng.annotations.Test</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.annotations.CitrusTest</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.dsl.testng.TestNGCitrusTestDesigner</span>;

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SendMessageTestDesigner</span> <span class="directive">extends</span> TestNGCitrusTestDesigner {

    <span class="annotation">@CitrusTest</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">SendMessageTest</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> sendMessageTest() {
        description(<span class="string"><span class="delimiter">&quot;</span><span class="content">Basic send message example</span><span class="delimiter">&quot;</span></span>);

        variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Citrus!</span><span class="delimiter">&quot;</span></span>);
        variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">messageId</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Mx1x123456789</span><span class="delimiter">&quot;</span></span>);

        send(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
                .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloMessage</span><span class="delimiter">&quot;</span></span>)
                .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;TestMessage&gt;</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Text&gt;${text}&lt;/Text&gt;</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/TestMessage&gt;</span><span class="delimiter">&quot;</span></span>)
                .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>)
                .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">RequestTag</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.testng.ITestContext</span>;
<span class="keyword">import</span> <span class="include">org.testng.annotations.Test</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.annotations.CitrusTest</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.dsl.testng.TestNGCitrusTestRunner</span>;

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">SendMessageTestRunner</span> <span class="directive">extends</span> TestNGCitrusTestRunner {

    <span class="annotation">@CitrusTest</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">SendMessageTest</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> sendMessageTest() {
        variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Citrus!</span><span class="delimiter">&quot;</span></span>);
        variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">messageId</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Mx1x123456789</span><span class="delimiter">&quot;</span></span>);

        send(action -&gt; action.endpoint(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
                .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloMessage</span><span class="delimiter">&quot;</span></span>)
                .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;TestMessage&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Text&gt;${text}&lt;/Text&gt;</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/TestMessage&gt;</span><span class="delimiter">&quot;</span></span>)
                .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>)
                .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">RequestTag</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span>));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of using the XML tags for send we use methods from <strong>TestNGCitrusTestDesigner</strong> class. The same message endpoint is referenced within the send message action.</p>
</div>
<div class="paragraph">
<p>Now that the message sender pattern is clear we can concentrate on how to specify the message content to be sent. There are several possibilities for you to define message content in Citrus:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
message
</td>
<td class="hdlist2">
<p>This element constructs the message to be sent. There are several child elements available:</p>
</td>
</tr>
<tr>
<td class="hdlist1">
payload
</td>
<td class="hdlist2">
<p>Nested XML payload as direct child node.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
data
</td>
<td class="hdlist2">
<p>Inline CDATA definition of the message payload</p>
</td>
</tr>
<tr>
<td class="hdlist1">
resource
</td>
<td class="hdlist2">
<p>External file resource holding the message payload The syntax would be: <code>&lt;resource file=&quot;classpath:com/consol/citrus/messages/TestRequest.xml&quot; /&gt;</code> The file path prefix indicates the resource type, so the file location is resolved either as file system resource (file:) or classpath resource (classpath:).</p>
</td>
</tr>
<tr>
<td class="hdlist1">
element
</td>
<td class="hdlist2">
<p>Explicitly overwrite values in the XML message payload using XPath. You can replace message content with dynamic values before sending. Each &lt;element&gt; entry provides a "path" and "value" attribute. The "path" gives a XPath expression evaluating to a XML node element or attribute in the message. The "value" can be a variable expression or any other static value. Citrus will replace the value before sending the message.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
header
</td>
<td class="hdlist2">
<p>Defines a header for the message (e.g. JMS header information or SOAP header):</p>
</td>
</tr>
<tr>
<td class="hdlist1">
element
</td>
<td class="hdlist2">
<p>Each header receives a "name" and "value". The "name" will be the name of the header entry and "value" its respective value. Again the usage of variable expressions as value is supported here, too.</p>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="comment">&lt;!-- message payload as XML --&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;data&gt;</span>
            <span class="inline-delimiter">&lt;![CDATA[</span>
                &lt;!-- message payload as XML --&gt;
            <span class="inline-delimiter">]]&gt;</span>
        <span class="tag">&lt;/data&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;resource</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/messages/TestRequest.xml</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The most important thing when dealing with sending actions is to prepare the message payload and header. You are able to construct the message payload either by nested XML child nodes (payload), as inline CDATA (&lt;data&gt;) or external file (&lt;resource&gt;).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Sometimes the nested XML message payload elements may cause XSD schema validation rule violations. This is because of variable values not fitting the XSD schema rules for example. In this scenario you could also use simple CDATA sections as payload data. In this case you need to use the <strong><em>`&lt;data&gt;`</em></strong> element in contrast to the <strong><em>`&lt;payload&gt;`</em></strong> element that we have used in our examples so far.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With this alternative you can skip the XML schema validation from your IDE at design time. Unfortunately you will loose the XSD auto completion features many XML editors offer when constructing your payload.</p>
</div>
<div class="paragraph">
<p>The The same possibilities apply to the Citrus Java DSL.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    send(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
        .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;TestMessage&gt;</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Text&gt;Hello!&lt;/Text&gt;</span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/TestMessage&gt;</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    send(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
        .payload(<span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">com/consol/citrus/messages/TestRequest.xml</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    send(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
        .payloadModel(<span class="keyword">new</span> TestRequest(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Citrus!</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    send(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
        .message(<span class="keyword">new</span> DefaultMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World!</span><span class="delimiter">&quot;</span></span>)));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Besides defining message payloads as normal Strings and via external file resource (classpath and file system) you can also use model objects as payload data in Java DSL. This model object payload requires a proper message marshaller that should be available as Spring bean inside the application context. By default Citrus is searching for a bean of type <strong>org.springframework.oxm.Marshaller</strong> .</p>
</div>
<div class="paragraph">
<p>In case you have multiple message marshallers in the application context you have to tell Citrus which one to use in this particular send message action.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    send(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
        .payloadModel(<span class="keyword">new</span> TestRequest(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Citrus!</span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">myMessageMarshallerBean</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now Citrus will marshal the message payload with the message marshaller bean named <strong>myMessageMarshallerBean</strong> . This way you can have multiple message marshaller implementations active in your project (XML, JSON, and so on).</p>
</div>
<div class="paragraph">
<p>Last not least the message can be defined as Citrus message object. Here you can choose one of the different message implementations used in Citrus for SOAP, Http or JMS messages. Or you just use the default message implementation or maybe a custom implementation.</p>
</div>
<div class="paragraph">
<p>Before sending takes place you can explicitly overwrite some message values in payload. You can think of overwriting specific message elements with variable values. Also you can overwrite values using XPath (<a href="#xpath">xpath</a>) or JSONPath (<a href="json-path">json-path</a>) expressions.</p>
</div>
<div class="paragraph">
<p>The message header is part of our duty of defining proper messages, too. So Citrus uses name-value pairs like "Operation" and "MessageId" in the next example to set message header entries. Depending on what message endpoint is used and which message transport underneath the header values will be shipped in different ways. In JMS the headers go to the header section of the message, in Http we set mime headers accordingly, in SOAP we can access the SOAP header elements and so on. Citrus aims to do the hard work for you. So Citrus knows how to set headers on different message transports.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;TestMessage&gt;</span>
                <span class="tag">&lt;Text&gt;</span>Hello!<span class="tag">&lt;/Text&gt;</span>
            <span class="tag">&lt;/TestMessage&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;header&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The message headers to send are defined by a simple name and value pair. Of course you can use test variables in header values as well. Let&#8217;s see how this looks like in Java DSL:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
        .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;TestMessage&gt;</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Text&gt;Hello!&lt;/Text&gt;</span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/TestMessage&gt;</span><span class="delimiter">&quot;</span></span>)
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    receive(action -&gt; action.endpoint(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
        .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;TestMessage&gt;</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Text&gt;Hello!&lt;/Text&gt;</span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/TestMessage&gt;</span><span class="delimiter">&quot;</span></span>)
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is basically how to send messages in Citrus. The test case is responsible for constructing the message content while the predefined message endpoint holds transport specific settings. Test cases reference endpoint components to publish messages to the outside world. The variable support in message payload and message header enables you to add dynamic values before sending out the message.</p>
</div>
</div>
<div class="sect2">
<h3 id="actions-receive"><a class="anchor" href="#actions-receive"></a><a class="link" href="#actions-receive">13.2. Receive messages</a></h3>
<div class="paragraph">
<p>Just like sending messages the receiving part is a very important action in an integration test. Honestly the receive action is even more important in Citrus as we also want to validate the incoming message contents. We are writing a test so we also need assertions and checks that everything works as expected.</p>
</div>
<div class="paragraph">
<p>As already mentioned before a message consists of a message header (name-value pairs) and a message payload. Later in this document we will see how to validate incoming messages with payload and header values. We start with a very simple example:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloRequest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;TestMessage&gt;</span>
                <span class="tag">&lt;Text&gt;</span>${text}<span class="tag">&lt;/Text&gt;</span>
            <span class="tag">&lt;/TestMessage&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;header&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MessageId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Overall the receive message action looks quite similar to the send message action. Concepts are identical as we define the message content with payload and header values. The message name is optional and defines the message identifier in the local message store.
This message name is very useful when accessing the message content later on during the test case. The local message store is handled per test case and contains all exchanged messages.</p>
</div>
<div class="paragraph">
<p>We can use test variables in both message payload an headers. Now let us have a look at the Java DSL representation of this simple example:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
        .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloRequest</span><span class="delimiter">&quot;</span></span>)
        .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;TestMessage&gt;</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Text&gt;${text}&lt;/Text&gt;</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/TestMessage&gt;</span><span class="delimiter">&quot;</span></span>)
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>)
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">MessageId</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    receive(action -&gt; action.endpoint(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
                .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloRequest</span><span class="delimiter">&quot;</span></span>)
                .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;TestMessage&gt;</span><span class="delimiter">&quot;</span></span> +
                      <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Text&gt;${text}&lt;/Text&gt;</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/TestMessage&gt;</span><span class="delimiter">&quot;</span></span>)
                .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>)
                .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">MessageId</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The receive action waits for a message to arrive. The whole test execution is stopped while waiting for the message. This is important to ensure the step by step test workflow processing. Of course you can specify message timeouts so the receiver will only wait a given amount of time before raising a timeout error. Following from that timeout exception the test case fails as the message did not arrive in time. Citrus defines default timeout settings for all message receiving tasks.</p>
</div>
<div class="paragraph">
<p>In a good case scenario the message arrives in time and the content can be validated as a next step. This validation can be done in various ways. On the one hand you can specify a whole XML message that you expect as control template. In this case the received message structure is compared to the expected message content element by element. On the other hand you can use explicit element validation where only a small subset of message elements is included into validation.</p>
</div>
<div class="paragraph">
<p>Besides the message payload Citrus will also perform validation on the received message header values. Test variable usage is supported as usual during the whole validation process for payload and header checks.</p>
</div>
<div class="paragraph">
<p>In general the validation component (validator) in Citrus works hand in hand with a message receiving component as the following figure shows:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/figure_005.jpg" alt="figure_005.jpg"></span></p>
</div>
<div class="paragraph">
<p>The message receiving component passes the message to the validator where the individual validation steps are performed. Let us have a closer look at the validation options and features step by step.</p>
</div>
<div class="sect3">
<h4 id="validate-message-payloads"><a class="anchor" href="#validate-message-payloads"></a><a class="link" href="#validate-message-payloads">13.2.1. Validate message payloads</a></h4>
<div class="paragraph">
<p>The most detailed validation of incoming messages is to define some expected message payload. The Citrus message validator will then perform a detailed message payload comparison. The incoming message has to match exactly to the expected message payload. The different message validator implementations in Citrus provide deep comparison of message structures such as XML, JSON and so on.</p>
</div>
<div class="paragraph">
<p>So by defining an expected message payload we validate the incoming message in syntax and semantics. In case a difference is identified by the message validator the validation and the test case fails with respective exceptions. This is how you can define message payloads in receive action:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;message&gt;</span>
  <span class="tag">&lt;payload&gt;</span>
    <span class="comment">&lt;!-- message payload as XML --&gt;</span>
  <span class="tag">&lt;/payload&gt;</span>
<span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;message&gt;</span>
  <span class="tag">&lt;data&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
        &lt;!-- message payload as XML --&gt;
      <span class="inline-delimiter">]]&gt;</span>
  <span class="tag">&lt;/data&gt;</span>
<span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;message&gt;</span>
  <span class="tag">&lt;resource</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/messages/TestRequest.xml</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The three examples above represent three different ways of defining the message payload in a receive message action. On the one hand we can use inline message payloads as nested XML or CDATA sections in the test. On the other hand we can load the message content from external file resource.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Sometimes the nested XML message payload elements may cause XSD schema validation rule violations. This is because of variable values not fitting the XSD schema rules for example. In this scenario you could also use simple CDATA sections as payload data. In this case you need to use the <strong><em>`&lt;data&gt;`</em></strong> element in contrast to the <strong><em>`&lt;payload&gt;`</em></strong> element that we have used in our examples so far.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With this alternative you can skip the XML schema validation from your IDE at design time. Unfortunately you will loose the XSD auto completion features many XML editors offer when constructing your payload.</p>
</div>
<div class="paragraph">
<p>In Java DSL we also have multiple options for specifying the message payloads:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
        .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;TestMessage&gt;</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Text&gt;Hello!&lt;/Text&gt;</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/TestMessage&gt;</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
        .payload(<span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">com/consol/citrus/messages/TestRequest.xml</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
        .payloadModel(<span class="keyword">new</span> TestRequest(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Citrus!</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
        .message(<span class="keyword">new</span> DefaultMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World!</span><span class="delimiter">&quot;</span></span>)));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The examples above represent the basic variations of how to define message payloads in Citrus Java DSL. The payload can be a simple String or a Spring file resource (classpath or file system). In addition to that we can use a model object. When using model objects as payloads we need a proper message marshaller implementation in the Spring application context. By default this is a marshaller bean of type <strong>org.springframework.oxm.Marshaller</strong> that has to be present in the Spring application context. You can add such a bean for XML and JSON message marshalling for instance.</p>
</div>
<div class="paragraph">
<p>In case you have multiple message marshallers in the application context you have to tell Citrus which one to use in this particular send message action.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
        .payloadModel(<span class="keyword">new</span> TestRequest(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Citrus!</span><span class="delimiter">&quot;</span></span>), <span class="string"><span class="delimiter">&quot;</span><span class="content">myMessageMarshallerBean</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now Citrus will marshal the message payload with the message marshaller bean named <strong>myMessageMarshallerBean</strong> . This way you can have multiple message marshaller implementations active in your project (XML, JSON, and so on).</p>
</div>
<div class="paragraph">
<p>Last not least the message can be defined as Citrus message object. Here you can choose one of the different message implementations used in Citrus for SOAP, Http or JMS messages. Or you just use the default message implementation or maybe a custom implementation.</p>
</div>
<div class="paragraph">
<p>In general the expected message content can be manipulated using XPath (<a href="#xpath">xpath</a>) or JSONPath (<a href="#json-path">json-path</a>). In addition to that you can ignore some elements that are skipped in comparison. We will describe this later on in this section. Now lets continue with message header validation.</p>
</div>
</div>
<div class="sect3">
<h4 id="validate-message-headers"><a class="anchor" href="#validate-message-headers"></a><a class="link" href="#validate-message-headers">13.2.2. Validate message headers</a></h4>
<div class="paragraph">
<p>Message headers are used widely in enterprise messaging solution: The message headers are part of the message semantics and need to be validated, too. Citrus can validate message header by name and value.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
        <span class="tag">&lt;TestMessage&gt;</span>
            <span class="tag">&lt;Text&gt;</span>Hello!<span class="tag">&lt;/Text&gt;</span>
        <span class="tag">&lt;/TestMessage&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;header&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The expected message headers are defined by a name and value pair. Citrus will check that the expected message header is present and will check the value. In case the message header is not found or the value does not match Citrus will raise an exception and the test fails. You can use validation matchers (<a href="#validation-matcher">validation-matcher</a>) for a more powerful validation of header values, too.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s see how this looks like in Java DSL:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
        .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;TestMessage&gt;</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Text&gt;Hello!&lt;/Text&gt;</span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/TestMessage&gt;</span><span class="delimiter">&quot;</span></span>)
        .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> messagingTest() {
    receive(action -&gt; action.endpoint(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
                .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;TestMessage&gt;</span><span class="delimiter">&quot;</span></span> +
                      <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Text&gt;Hello!&lt;/Text&gt;</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/TestMessage&gt;</span><span class="delimiter">&quot;</span></span>)
                .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Header definition in Java DSL is straight forward as we just define name and value as usual. This completes the message validation when receiving a message in Citrus. The message validator implementations may add additional validation capabilities such as XML schema validation or XPath and JSONPath validation. Please refer to the respective chapters in this guide to learn more about that.</p>
</div>
</div>
<div class="sect3">
<h4 id="message-selectors"><a class="anchor" href="#message-selectors"></a><a class="link" href="#message-selectors">13.2.3. Message selectors</a></h4>
<div class="paragraph">
<p>The <code>&lt;selector&gt;</code> element inside the receiving action defines key-value pairs in order to filter the messages being received. The filter applies to the message headers. This means that a receiver will only accept messages matching a header element value. In messaging applications the header information often holds message ids, correlation ids, operation names and so on. With this information given you can explicitly listen for messages that belong to your test case. This is very helpful to avoid receiving messages that are still available on the message destination.</p>
</div>
<div class="paragraph">
<p>Lets say the tested software application keeps sending messages that belong to previous test cases. This could happen in retry situations where the application error handling automatically tries to solve a communication problem that occurred during previous test cases. As a result a message destination (e.g. a JMS message queue) contains messages that are not valid any more for the currently running test case. The test case might fail because the received message does not apply to the actual use case. So we will definitely run into validation errors as the expected message control values do not match.</p>
</div>
<div class="paragraph">
<p>Now we have to find a way to avoid these problems. The test could filter the messages on a destination to only receive messages that apply for the use case that is being tested. The Java Messaging System (JMS) came up with a message header selector that will only accept messages that fit the expected header values.</p>
</div>
<div class="paragraph">
<p>Let us have a closer look at a message selector inside a receiving action:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;selector&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">correlationId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Cx1x123456789</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">operation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">getOrders</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/selector&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> receiveMessageTest() {
    receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">testServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
        .selector(<span class="string"><span class="delimiter">&quot;</span><span class="content">correlationId='Cx1x123456789' AND operation='getOrders'</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> receiveMessageTest() {
    receive(action -&gt; action.endpoint(<span class="string"><span class="delimiter">&quot;</span><span class="content">testServiceEndpoint</span><span class="delimiter">&quot;</span></span>)
                .selector(<span class="string"><span class="delimiter">&quot;</span><span class="content">correlationId='Cx1x123456789' AND operation='getOrders'</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This example shows how message selectors work. The selector will only accept messages that meet the correlation id and the operation in the header values. All other messages on the message destination are ignored. The selector elements are automatically associated to each other using the logical AND operator. This means that the message selector string would look like this: <strong>correlationId = 'Cx1x123456789' AND operation = 'getOrders'</strong> .</p>
</div>
<div class="paragraph">
<p>Instead of using several elements in the selector you can also define a selector string directly which gives you more power in constructing the selection logic yourself. This way you can use <strong>AND</strong> logical operators yourself.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;selector&gt;</span>
    <span class="tag">&lt;value&gt;</span>
        correlationId = 'Cx1x123456789' AND operation = 'getOrders'
    <span class="tag">&lt;/value&gt;</span>
<span class="tag">&lt;/selector&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
In case you want to run tests in parallel message selectors become essential in your test cases. The different tests running at the same time will steal messages from each other when you lack of message selection mechanisms.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Previously only JMS message destinations offered support for message selectors! With Citrus version 1.2 we introduced message selector support for Spring Integration message channels, too (see <a href="#message-channel-selector-support">message-channel-selector-support</a>).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="groovy-markupbuilder"><a class="anchor" href="#groovy-markupbuilder"></a><a class="link" href="#groovy-markupbuilder">13.2.4. Groovy MarkupBuilder</a></h4>
<div class="paragraph">
<p>With the Groovy MarkupBuilder you can build XML message payloads in a simple way, without having to write the typical XML overhead. For example we use a Groovy script to construct the XML message to be sent out. Instead of a plain CDATA XML section or the nested payload XML data we write a Groovy script snippet. The Groovy MarkupBuilder generates the XML message payload with exactly the same result:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;message&gt;</span>
    <span class="tag">&lt;builder</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        markupBuilder.TestMessage {
                MessageId('${messageId}')
                Timestamp('?')
                VersionId('2')
                Text('Hello Citrus!')
            }
        }
    <span class="tag">&lt;/builder&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/TestMessage/Timestamp</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${createDate}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;header&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MessageId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We use the <strong>builder</strong> element with type <strong>groovy</strong> and the MarkupBuilder code is directly written to this element. As you can see from the example above, you can mix XPath and Groovy markup builder code. The MarkupBuilder syntax is very easy and follows the simple rule: <strong>markupBuilder.ROOT-ELEMENT{ CHILD-ELEMENTS }</strong> . However the tester has to follow some simple rules and naming conventions when using the Citrus MarkupBuilder extension:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The MarkupBuilder is accessed within the script over an object named markupBuilder. The name of the custom root element follows with all its child elements.</p>
</li>
<li>
<p>Child elements may be defined within curly brackets after the root-element (the same applies for further nested child elements)</p>
</li>
<li>
<p>Attributes and element values are defined within round brackets, after the element name</p>
</li>
<li>
<p>Attribute and element values have to stand within apostrophes (e.g. attribute-name: 'attribute-value')</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Groovy MarkupBuilder script may also be used within receive actions as shown in the following listing:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;builder</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/groovy/helloRequest.groovy</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span>

<span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5000</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;builder</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            markupBuilder.TestResponse(xmlns: 'http://www.consol.de/schemas/samples/sayHello.xsd'){
                MessageId('${messageId}')
                CorrelationId('${correlationId}')
                User('HelloService')
                Text('Hello ${user}')
            }
        <span class="tag">&lt;/builder&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see it is also possible to define the script as external file resource. In addition to that namespace support is given as normal attribute definition within the round brackets after the element name.</p>
</div>
<div class="paragraph">
<p>The MarkupBuilder implementation in Groovy offers great possibilities in defining message payloads. We do not need to write XML tag overhead and we can construct complex message payloads with Groovy logic like iterations and conditional elements. For detailed MarkupBuilder descriptions please see the official Groovy documentation.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="actions-sql"><a class="anchor" href="#actions-sql"></a><a class="link" href="#actions-sql">13.3. Database actions</a></h3>
<div class="paragraph">
<p>In many cases it is necessary to access the database during a test. This enables a tester to also validate the persistent
data in a database. It might also be helpful to prepare the database with some test data before running a test. You can do this
using the two database actions that are described in the following sections.</p>
</div>
<div class="paragraph">
<p>In general Citrus handles SELECT statements differently to other statements like INSERT, UPDATE and DELETE. When executing a SQL query with
SELECT you are able to add validation steps on the result sets returned from the database. This is not allowed when executing update statements like
INSERT, UPDATE, DELETE.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Do not mix statements of type <strong><em>SELECT</em></strong> with others in a single sql test action. This will lead to errors because validation steps are not valid
for statements other than SELECT. Please use separate test actions for update statements.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="sql-update-insert-delete"><a class="anchor" href="#sql-update-insert-delete"></a><a class="link" href="#sql-update-insert-delete">13.3.1. SQL update, insert, delete</a></h4>
<div class="paragraph">
<p>The &lt;sql&gt; action simply executes a group of SQL statements in order to change data in a database. Typically the action is used to prepare the database at the beginning of a test or to clean up the database at the end of a test. You can specify SQL statements like INSERT, UPDATE, DELETE, CREATE TABLE, ALTER TABLE and many more.</p>
</div>
<div class="paragraph">
<p>On the one hand you can specify the statements as inline SQL or stored in an external SQL resource file as shown in the next two examples.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;actions&gt;</span>
    <span class="tag">&lt;sql</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;statement&gt;</span>DELETE FROM CUSTOMERS<span class="tag">&lt;/statement&gt;</span>
        <span class="tag">&lt;statement&gt;</span>DELETE FROM ORDERS<span class="tag">&lt;/statement&gt;</span>
    <span class="tag">&lt;/sql&gt;</span>

    <span class="tag">&lt;sql</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;resource</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file:tests/unit/resources/script.sql</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/sql&gt;</span>
<span class="tag">&lt;/actions&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">myDataSource</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">DataSource</span> dataSource;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> sqlTest() {
    sql(dataSource)
        .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">DELETE FROM CUSTOMERS</span><span class="delimiter">&quot;</span></span>)
        .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">DELETE FROM ORDERS</span><span class="delimiter">&quot;</span></span>);

    sql(dataSource)
        .sqlResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">file:tests/unit/resources/script.sql</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">myDataSource</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">DataSource</span> dataSource;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> sqlTest() {
    sql(action -&gt; action.dataSource(dataSource)
        .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">DELETE FROM CUSTOMERS</span><span class="delimiter">&quot;</span></span>)
        .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">DELETE FROM ORDERS</span><span class="delimiter">&quot;</span></span>));

    sql(action -&gt; action.dataSource(dataSource)
        .sqlResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">file:tests/unit/resources/script.sql</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first action uses inline SQL statements defined directly inside the test case. The next action uses an external SQL resource file instead. The file resource can hold several SQL statements separated by new lines. All statements inside the file are executed sequentially by the framework.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You have to pay attention to some rules when dealing with external SQL resources.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Each statement should begin in a new line</p>
</li>
<li>
<p>It is not allowed to define statements with word wrapping</p>
</li>
<li>
<p>Comments begin with two dashes "–"</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The external file is referenced either as file system resource or class path resource, by using the "file:" or "classpath:" prefix.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Both examples use the "datasource" attribute. This value defines the database data source to be used. The connection to a data source is mandatory, because the test case does not know about user credentials or database names. The 'datasource' attribute references predefined data sources that are located in a separate Spring configuration file.</p>
</div>
</div>
<div class="sect3">
<h4 id="sql-query"><a class="anchor" href="#sql-query"></a><a class="link" href="#sql-query">13.3.2. SQL query</a></h4>
<div class="paragraph">
<p>The &lt;sql&gt; query action is specially designed to execute SQL queries (SELECT * FROM). So the test is able to read data from a database. The query results are validated against expected data as shown in the next example.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;sql</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;statement&gt;</span>select NAME from CUSTOMERS where ID='${customerId}'<span class="tag">&lt;/statement&gt;</span>
    <span class="tag">&lt;statement&gt;</span>select count(*) from ERRORS<span class="tag">&lt;/statement&gt;</span>
    <span class="tag">&lt;statement&gt;</span>select ID from ORDERS where DESC LIKE 'Def%'<span class="tag">&lt;/statement&gt;</span>
    <span class="tag">&lt;statement&gt;</span>select DESCRIPTION from ORDERS where ID='${id}'<span class="tag">&lt;/statement&gt;</span>

    <span class="tag">&lt;validate</span> <span class="attribute-name">column</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ID</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;validate</span> <span class="attribute-name">column</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">NAME</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Christoph</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;validate</span> <span class="attribute-name">column</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">COUNT(*)</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${rowsCount}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;validate</span> <span class="attribute-name">column</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DESCRIPTION</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">null</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/sql&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">testDataSource</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">DataSource</span> dataSource;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> databaseQueryTest() {
    query(dataSource)
          .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">select NAME from CUSTOMERS where CUSTOMER_ID='${customerId}'</span><span class="delimiter">&quot;</span></span>)
          .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">select COUNT(1) as overall_cnt from ERRORS</span><span class="delimiter">&quot;</span></span>)
          .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">select ORDER_ID from ORDERS where DESCRIPTION LIKE 'Migrate%'</span><span class="delimiter">&quot;</span></span>)
          .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">select DESCRIPTION from ORDERS where ORDER_ID = 2</span><span class="delimiter">&quot;</span></span>)
          .validate(<span class="string"><span class="delimiter">&quot;</span><span class="content">ORDER_ID</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>)
          .validate(<span class="string"><span class="delimiter">&quot;</span><span class="content">NAME</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Christoph</span><span class="delimiter">&quot;</span></span>)
          .validate(<span class="string"><span class="delimiter">&quot;</span><span class="content">OVERALL_CNT</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${rowsCount}</span><span class="delimiter">&quot;</span></span>)
          .validate(<span class="string"><span class="delimiter">&quot;</span><span class="content">DESCRIPTION</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">NULL</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">testDataSource</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">DataSource</span> dataSource;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> databaseQueryTest() {
    query(action -&gt; action.dataSource(dataSource)
            .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">select NAME from CUSTOMERS where CUSTOMER_ID='${customerId}'</span><span class="delimiter">&quot;</span></span>)
            .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">select COUNT(1) as overall_cnt from ERRORS</span><span class="delimiter">&quot;</span></span>)
            .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">select ORDER_ID from ORDERS where DESCRIPTION LIKE 'Migrate%'</span><span class="delimiter">&quot;</span></span>)
            .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">select DESCRIPTION from ORDERS where ORDER_ID = 2</span><span class="delimiter">&quot;</span></span>)
            .validate(<span class="string"><span class="delimiter">&quot;</span><span class="content">ORDER_ID</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>)
            .validate(<span class="string"><span class="delimiter">&quot;</span><span class="content">NAME</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Christoph</span><span class="delimiter">&quot;</span></span>)
            .validate(<span class="string"><span class="delimiter">&quot;</span><span class="content">OVERALL_CNT</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${rowsCount}</span><span class="delimiter">&quot;</span></span>)
            .validate(<span class="string"><span class="delimiter">&quot;</span><span class="content">DESCRIPTION</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">NULL</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The action offers a wide range of validating functionality for database result sets. First of all you have to select the data via SQL statements. Here again you have the choice to use inline SQL statements or external file resource pattern.</p>
</div>
<div class="paragraph">
<p>The result sets are validated through &lt;validate&gt; elements. It is possible to do a detailed check on every selected column of the result set. Simply refer to the selected column name in order to validate its value. The usage of test variables is supported as well as database expressions like count(), avg(), min(), max().</p>
</div>
<div class="paragraph">
<p>You simply define the &lt;validate&gt; entry with the column name as the "column" attribute and any expected value expression as expected "value". The framework then will check the column to fit the expected value and raise validation errors in case of mismatch.</p>
</div>
<div class="paragraph">
<p>Looking at the first SELECT statement in the example you will see that test variables are supported in the SQL statements. The framework will replace the variable with its respective value before sending it to the database.</p>
</div>
<div class="paragraph">
<p>In the validation section variables can be used too. Look at the third validation entry, where the variable "${rowsCount}" is used. The last validation in this example shows, that <strong><em>NULL</em></strong> values are also supported as expected values.</p>
</div>
<div class="paragraph">
<p>If a single validation happens to fail, the whole action will fail with respective validation errors.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The validation with <strong><em>"&lt;validate column="&#8230;&#8203;" value="&#8230;&#8203;"/&gt;"</em></strong> meets single row result sets as you specify a single column control value. In case you have multiple rows in a result set you rather need to validate the columns with multiple control values like this:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;validate</span> <span class="attribute-name">column</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someColumnName</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;values&gt;</span>
          <span class="tag">&lt;value&gt;</span>Value in 1st row<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;value&gt;</span>Value in 2nd row<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;value&gt;</span>Value in 3rd row<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;value&gt;</span>Value in x row<span class="tag">&lt;/value&gt;</span>
      <span class="tag">&lt;/values&gt;</span>
  <span class="tag">&lt;/validate&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Within Java you can pass a variable argument list to the validate method like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">query(dataSource)
    .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">select NAME from WEEKDAYS where NAME LIKE 'S%'</span><span class="delimiter">&quot;</span></span>)
    .validate(<span class="string"><span class="delimiter">&quot;</span><span class="content">NAME</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Saturday</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Sunday</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next example shows how to work with multiple row result sets and multiple values to expect within one column:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;sql</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;statement&gt;</span>select WEEKDAY as DAY, DESCRIPTION from WEEK<span class="tag">&lt;/statement&gt;</span>
      <span class="tag">&lt;validate</span> <span class="attribute-name">column</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DAY</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;values&gt;</span>
              <span class="tag">&lt;value&gt;</span>Monday<span class="tag">&lt;/value&gt;</span>
              <span class="tag">&lt;value&gt;</span>Tuesday<span class="tag">&lt;/value&gt;</span>
              <span class="tag">&lt;value&gt;</span>Wednesday<span class="tag">&lt;/value&gt;</span>
              <span class="tag">&lt;value&gt;</span>Thursday<span class="tag">&lt;/value&gt;</span>
              <span class="tag">&lt;value&gt;</span>Friday<span class="tag">&lt;/value&gt;</span>
              <span class="tag">&lt;value&gt;</span>@ignore@<span class="tag">&lt;/value&gt;</span>
              <span class="tag">&lt;value&gt;</span>@ignore@<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;/values&gt;</span>
      <span class="tag">&lt;/validate&gt;</span>
      <span class="tag">&lt;validate</span> <span class="attribute-name">column</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DESCRIPTION</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;values&gt;</span>
              <span class="tag">&lt;value&gt;</span>I hate Mondays!<span class="tag">&lt;/value&gt;</span>
              <span class="tag">&lt;value&gt;</span>Tuesday is sports day<span class="tag">&lt;/value&gt;</span>
              <span class="tag">&lt;value&gt;</span>The mid of the week<span class="tag">&lt;/value&gt;</span>
              <span class="tag">&lt;value&gt;</span>Thursday we play chess<span class="tag">&lt;/value&gt;</span>
              <span class="tag">&lt;value&gt;</span>Friday, the weekend is near!<span class="tag">&lt;/value&gt;</span>
              <span class="tag">&lt;value&gt;</span>@ignore@<span class="tag">&lt;/value&gt;</span>
              <span class="tag">&lt;value&gt;</span>@ignore@<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;/values&gt;</span>
      <span class="tag">&lt;/validate&gt;</span>
  <span class="tag">&lt;/sql&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For the validation of multiple rows the <strong><em>`&lt;validate&gt;`</em></strong> element is able to host a list of control values for a column. As you can see from the example above, you have to add a control value for each row in the result set. This also means that we have to take care of the total number of rows. Fortunately we can use the ignore placeholder, in order to skip the validation of a specific row in the result set. Functions and variables are supported as usual.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
It is important, that the control values are defined in the correct order, because they are compared one on one with the actual result set coming from database query. You may need to add "order by" SQL expressions to get the right order of rows returned. If any of the values fails in validation or the total number of rows is not equal, the whole action will fail with respective validation errors.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sql-transaction-management"><a class="anchor" href="#sql-transaction-management"></a><a class="link" href="#sql-transaction-management">13.3.3. Transaction management</a></h4>
<div class="paragraph">
<p>By default no transactions are used when Citrus executes SQL statements on a datasource. You can enable transaction management by selecting a transaction manager.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;actions&gt;</span>
    <span class="tag">&lt;sql</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someDataSource</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">transaction-manager</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someTransactionManager</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">transaction-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">15000</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">transaction-isolation-level</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ISOLATION_READ_COMMITTED</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;statement&gt;</span>DELETE FROM CUSTOMERS<span class="tag">&lt;/statement&gt;</span>
        <span class="tag">&lt;statement&gt;</span>DELETE FROM ORDERS<span class="tag">&lt;/statement&gt;</span>
    <span class="tag">&lt;/sql&gt;</span>
<span class="tag">&lt;/actions&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">myDataSource</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">DataSource</span> dataSource;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> sqlTest() {
    sql(dataSource)
        .transactionManager(transactionManager)
        .transactionTimeout(<span class="integer">15000</span>)
        .transactionIsolationLevel(<span class="string"><span class="delimiter">&quot;</span><span class="content">ISOLATION_READ_COMMITTED</span><span class="delimiter">&quot;</span></span>)
        .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">DELETE FROM CUSTOMERS</span><span class="delimiter">&quot;</span></span>)
        .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">DELETE FROM ORDERS</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>transaction-manager</em> attribute references a Spring bean of type "<em>org.springframework.transaction.PlatformTransactionManager</em>". You can add this transaction manager to the Spring bean configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someTransactionManager</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jdbc.datasource.DataSourceTransactionManager</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The transaction isolation level as well as the transaction timeout get set on the transaction definition used during SQL statement execution. The isolation level should evaluate to one of the constants given in "<em>org.springframework.transaction.TransactionDefinition</em>". Valid isolation level are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ISOLATION_DEFAULT</p>
</li>
<li>
<p>ISOLATION_READ_UNCOMMITTED</p>
</li>
<li>
<p>ISOLATION_READ_COMMITTED</p>
</li>
<li>
<p>ISOLATION_REPEATABLE_READ</p>
</li>
<li>
<p>ISOLATION_SERIALIZABLE</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="groovy-sql-result-set-validation"><a class="anchor" href="#groovy-sql-result-set-validation"></a><a class="link" href="#groovy-sql-result-set-validation">13.3.4. Groovy SQL result set validation</a></h4>
<div class="paragraph">
<p>Groovy provides great support for accessing Java list objects and maps. As a Java SQL result set is nothing but a list of map representations, where each entry in the list defines a row in the result set and each map entry represents the columns and values. So with Groovy&#8217;s list and map access we have great possibilities to validate a SQL result set - out of the box.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;sql</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;statement&gt;</span>select ID from CUSTOMERS where NAME='${customerName}'<span class="tag">&lt;/statement&gt;</span>
    <span class="tag">&lt;statement&gt;</span>select ORDERTYPE, STATUS from ORDERS where ID='${orderId}'<span class="tag">&lt;/statement&gt;</span>

    <span class="tag">&lt;validate-script</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        assert rows.size() == 2
        assert rows[0].ID == '1'
        assert rows[1].STATUS == 'in progress'
        assert rows[1] == [ORDERTYPE:'SampleOrder', STATUS:'in progress']
    <span class="tag">&lt;/validate-script&gt;</span>
<span class="tag">&lt;/sql&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">query(dataSource)
    .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">select ORDERTYPE, STATUS from ORDERS where ID='${orderId}'</span><span class="delimiter">&quot;</span></span>)
    .validateScript(<span class="string"><span class="delimiter">&quot;</span><span class="content">assert rows.size == 2;</span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">assert rows[0].ID == '1';</span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">assert rows[0].STATUS == 'in progress';</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">query(action -&gt; action.dataSource(dataSource)
    .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">select ORDERTYPE, STATUS from ORDERS where ID='${orderId}'</span><span class="delimiter">&quot;</span></span>)
    .validateScript(<span class="string"><span class="delimiter">&quot;</span><span class="content">assert rows.size == 2;</span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">assert rows[0].ID == '1';</span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">assert rows[0].STATUS == 'in progress';</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">groovy</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see Groovy provides fantastic access methods to the SQL result set. We can browse the result set with named column values and check the size of the result set. We are also able to search for an entry, iterate over the result set and have other helpful operations. For a detailed description of the list and map handling in Groovy my advice for you is to have a look at the official Groovy documentation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In general other script languages do also support this kind of list and map access. For now we just have implemented the Groovy script support, but the framework is ready to work with all other great script languages out there, too (e.g. Scala, Clojure, Fantom, etc.). So if you prefer to work with another language join and help us implement those features.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="save-result-set-values"><a class="anchor" href="#save-result-set-values"></a><a class="link" href="#save-result-set-values">13.3.5. Save result set values</a></h4>
<div class="paragraph">
<p>Now the validation of database entries is a very powerful feature but sometimes we simply do not know the persisted content values. The test may want to read database entries into test variables without validation. Citrus is able to do that with the following &lt;extract&gt; expressions:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;sql</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;statement&gt;</span>select ID from CUSTOMERS where NAME='${customerName}'<span class="tag">&lt;/statement&gt;</span>
    <span class="tag">&lt;statement&gt;</span>select STATUS from ORDERS where ID='${orderId}'<span class="tag">&lt;/statement&gt;</span>

    <span class="tag">&lt;extract</span> <span class="attribute-name">column</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ID</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">variable</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${customerId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;extract</span> <span class="attribute-name">column</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">STATUS</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">variable</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${orderStatus}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/sql&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">query(dataSource)
    .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">select STATUS from ORDERS where ID='${orderId}'</span><span class="delimiter">&quot;</span></span>)
    .extract(<span class="string"><span class="delimiter">&quot;</span><span class="content">STATUS</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">orderStatus</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">query(action -&gt; action.dataSource(dataSource)
    .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">select STATUS from ORDERS where ID='${orderId}'</span><span class="delimiter">&quot;</span></span>)
    .extract(<span class="string"><span class="delimiter">&quot;</span><span class="content">STATUS</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">orderStatus</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can save the database column values directly to test variables. Of course you can combine the value extraction with the normal column validation described earlier in this chapter. Please keep in mind that we can not use these operations on result sets with multiple rows. Citrus will always use the first row in a result set.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="actions-sleep"><a class="anchor" href="#actions-sleep"></a><a class="link" href="#actions-sleep">13.4. Sleep</a></h3>
<div class="paragraph">
<p>This action shows how to make the test framework sleep for a given amount of time. The attribute 'time' defines the amount of time to wait in seconds. As shown in the next example decimal values are supported too. When no waiting time is specified the default time of 50000 milliseconds applies.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sleepTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;sleep</span> <span class="attribute-name">seconds</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.5</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

        <span class="tag">&lt;sleep</span> <span class="attribute-name">milliseconds</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">500</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

        <span class="tag">&lt;sleep</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> sleepTest() {
    sleep(<span class="integer">500</span>); <span class="comment">// sleep 500 milliseconds</span>

    sleep(); <span class="comment">// sleep default time</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When should somebody use this action? To us this action was always very useful in case the test needed to wait until an application had done some work. For example in some cases the application took some time to write some data into the database. We waited then a small amount of time in order to avoid unnecessary test failures, because the test framework simply validated the database too early. Or as another example the test may wait a given time until retry mechanisms are triggered in the tested application and then proceed with the test actions.</p>
</div>
</div>
<div class="sect2">
<h3 id="actions-java"><a class="anchor" href="#actions-java"></a><a class="link" href="#actions-java">13.5. Java</a></h3>
<div class="paragraph">
<p>The test framework is written in Java and runs inside a Java virtual machine. The functionality of calling other Java objects and methods in this same Java VM through Java Reflection is self-evident. With this action you can call any Java API available at runtime through the specified Java classpath.</p>
</div>
<div class="paragraph">
<p>The action syntax looks like follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;java</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.test.util.InvocationDummy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;constructor&gt;</span>
        <span class="tag">&lt;argument</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Test Invocation<span class="tag">&lt;/argument&gt;</span>
    <span class="tag">&lt;/constructor&gt;</span>
    <span class="tag">&lt;method</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">invoke</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;argument</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">String[]</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>1,2<span class="tag">&lt;/argument&gt;</span>
    <span class="tag">&lt;/method&gt;</span>
<span class="tag">&lt;/java&gt;</span>

<span class="tag">&lt;java</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.test.util.InvocationDummy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;constructor&gt;</span>
        <span class="tag">&lt;argument</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Test Invocation<span class="tag">&lt;/argument&gt;</span>
    <span class="tag">&lt;/constructor&gt;</span>
    <span class="tag">&lt;method</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">invoke</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;argument</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">int</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>4<span class="tag">&lt;/argument&gt;</span>
        <span class="tag">&lt;argument</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">String</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Test Invocation<span class="tag">&lt;/argument&gt;</span>
        <span class="tag">&lt;argument</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">boolean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>true<span class="tag">&lt;/argument&gt;</span>
    <span class="tag">&lt;/method&gt;</span>
<span class="tag">&lt;/java&gt;</span>

<span class="tag">&lt;java</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.test.util.InvocationDummy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;method</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;argument</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">String[]</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>4,Test,true <span class="tag">&lt;/argument&gt;</span>
    <span class="tag">&lt;/method&gt;</span>
<span class="tag">&lt;/java&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Java class is specified by fully qualified class name. Constructor arguments are added using the &lt;constructor&gt; element with a list of &lt;argument&gt; child elements. The type of the argument is defined within the respective attribute "type". By default the type would be String.</p>
</div>
<div class="paragraph">
<p>The invoked method on the Java object is simply referenced by its name. Method arguments do not bring anything new after knowing the constructor argument definition, do they?.</p>
</div>
<div class="paragraph">
<p>Method arguments support data type conversion too, even string arrays (useful when calling CLIs). In the third action in the example code you can see that colon separated strings are automatically converted to string arrays.</p>
</div>
<div class="paragraph">
<p>Simple data types are defined by their name (int, boolean, float etc.). Be sure that the invoked method and class constructor fit your arguments and vice versa, otherwise you will cause errors at runtime.</p>
</div>
<div class="paragraph">
<p>Besides instantiating a fully new object instance for a class how about reusing a bean instance available in Spring bean container. Simply use the <strong>ref</strong> attribute and refer to an existing bean in Spring application context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;java</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">invocationDummy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;method</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">invoke</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;argument</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">int</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>4<span class="tag">&lt;/argument&gt;</span>
        <span class="tag">&lt;argument</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">String</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Test Invocation<span class="tag">&lt;/argument&gt;</span>
        <span class="tag">&lt;argument</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">boolean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>true<span class="tag">&lt;/argument&gt;</span>
    <span class="tag">&lt;/method&gt;</span>
<span class="tag">&lt;/java&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">invocationDummy</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.test.util.InvocationDummy</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The method is invoked on the Spring bean instance. This is very useful as you can inject other objects (e.g. via Autowiring) to the Spring bean instance before method invocation in test takes place. This enables you to execute any Java logic inside a test case.</p>
</div>
</div>
<div class="sect2">
<h3 id="actions-receive-timeout"><a class="anchor" href="#actions-receive-timeout"></a><a class="link" href="#actions-receive-timeout">13.6. Receive timeout</a></h3>
<div class="paragraph">
<p>In some cases it might be necessary to validate that a message is <strong>not</strong> present on a destination. This means that this action expects a timeout when receiving a message from an endpoint destination. For instance the tester intends to ensure that no message is sent to a certain destination in a time period. In that case the timeout would not be a test aborting error but the expected behavior. And in contrast to the normal behavior when a message is received in the time period the test will fail with error.</p>
</div>
<div class="paragraph">
<p>In order to validate such a timeout situation the action &lt;expectTimout&gt; shall help. The usage is very simple as the following example shows:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">receiveJMSTimeoutTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;expect-timeout</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myEndpoint</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">wait</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">500</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">myEndpoint</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> Endpoint myEndpoint;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> receiveTimeoutTest() {
    receiveTimeout(myEndpoint)
        .timeout(<span class="integer">500</span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">myEndpoint</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> Endpoint myEndpoint;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> receiveTimeoutTest() {
    receiveTimeout(action -&gt; action.endpoint(myEndpoint)
                    .timeout(<span class="integer">500</span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The action offers two attributes:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
endpoint
</td>
<td class="hdlist2">
<p>Reference to a message endpoint that will try to receive messages.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
wait/timeout
</td>
<td class="hdlist2">
<p>Time period to wait for messages to arrive</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Sometimes you may want to add some selector on the timeout receiving action. This way you can very selective check on a message to not be present on a message destination. This is possible with defining a message selector on the test action as follows.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;expect-timeout</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myEndpoint</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">wait</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">500</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;select&gt;</span>MessageId='123456789'<span class="tag">&lt;select</span><span class="tag">/&gt;</span>
<span class="tag">&lt;expect-timeout</span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> receiveTimeoutTest() {
    receiveTimeout(myEndpoint)
        .selector(<span class="string"><span class="delimiter">&quot;</span><span class="content">MessageId = '123456789'</span><span class="delimiter">&quot;</span></span>)
        .timeout(<span class="integer">500</span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> receiveTimeoutTest() {
    receiveTimeout(action -&gt; action.endpoint(myEndpoint)
                    .selector(<span class="string"><span class="delimiter">&quot;</span><span class="content">MessageId = '123456789'</span><span class="delimiter">&quot;</span></span>)
                    .timeout(<span class="integer">500</span>));
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="actions-echo"><a class="anchor" href="#actions-echo"></a><a class="link" href="#actions-echo">13.7. Echo</a></h3>
<div class="paragraph">
<p>The &lt;echo&gt; action prints messages to the console/logger. This functionality is useful when debugging test runs. The property "message" defines the text that is printed. Tester might use it to print out debug messages and variables as shown the next code example:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">echoTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;variables&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate()</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/variables&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;echo&gt;</span>
            <span class="tag">&lt;message&gt;</span>Hello Test Framework<span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/echo&gt;</span>

        <span class="tag">&lt;echo&gt;</span>
            <span class="tag">&lt;message&gt;</span>Current date is: ${date}<span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/echo&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> echoTest() {
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate()</span><span class="delimiter">&quot;</span></span>);

    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Test Framework</span><span class="delimiter">&quot;</span></span>);
    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Current date is: ${date}</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Result on the console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Hello Test Framework
Current time is: 05.08.2008</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="actions-stop-time"><a class="anchor" href="#actions-stop-time"></a><a class="link" href="#actions-stop-time">13.8. Stop time</a></h3>
<div class="paragraph">
<p>Time measurement during a test can be very helpful. The &lt;trace-time&gt; action creates and monitors multiple time lines. The action offers the attribute <em>id</em> to identify a time line.
The tester can of course use more than one time line with different ids simultaneously.</p>
</div>
<div class="paragraph">
<p>Read the next example and you will understand the mix of different time lines:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">StopTimeTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;actions&gt;</span>
    <span class="tag">&lt;trace-time</span><span class="tag">/&gt;</span>

    <span class="tag">&lt;trace-time</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">time_line_id</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;sleep</span> <span class="attribute-name">seconds</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.5</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;trace-time</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span> <span class="content">time_line_id </span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;sleep</span> <span class="attribute-name">milliseconds</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;trace-time</span><span class="tag">/&gt;</span>

    <span class="tag">&lt;trace-time</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span> <span class="content">time_line_id </span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> stopTimeTest() {
    stopTime();
    stopTime(<span class="string"><span class="delimiter">&quot;</span><span class="content">time_line_id</span><span class="delimiter">&quot;</span></span>);
    sleep(<span class="float">3.5</span>); <span class="comment">// do something</span>
    stopTime(<span class="string"><span class="delimiter">&quot;</span><span class="content">time_line_id</span><span class="delimiter">&quot;</span></span>);
    sleep(<span class="integer">5000</span>); <span class="comment">// do something</span>
    stopTime();
    stopTime(<span class="string"><span class="delimiter">&quot;</span><span class="content">time_line_id</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The test output looks like follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Starting TimeWatcher:
Starting TimeWatcher: time_line_id
TimeWatcher time_line_id after 3500 milliseconds
TimeWatcher after 8500 seconds
TimeWatcher time_line_id after 8500 milliseconds</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Time line ids should not exist as test variables before the action is called for the first time. This would break the time line initialization.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In case no time line id is specified the framework will measure the time for a default time line. To print out the current elapsed time for a time line you simply have to place the
`&lt;trace-time&gt; action into the action chain again and again, using the respective time line identifier. The elapsed time will be printed out to the console every time.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Each time line is stored as test variable in the test case. By default you will have the following test variables set for each time line:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
CITRUS_TIMELINE
</td>
<td class="hdlist2">
<p>first timestamp of time line</p>
</td>
</tr>
<tr>
<td class="hdlist1">
CITRUS_TIMELINE_VALUE
</td>
<td class="hdlist2">
<p>latest time measurement value (time passed since first timestamp in milliseconds)</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>According to your time line id you will get different test variable names. Also you can customize the time value suffix (default: <strong>_VALUE</strong>):</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;trace-time</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">custom_watcher</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">suffix</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">_1st</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;sleep</span><span class="tag">/&gt;</span>
<span class="tag">&lt;trace-time</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">custom_watcher</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">suffix</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">_2nd</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
stopTime(<span class="string"><span class="delimiter">&quot;</span><span class="content">custom_watcher</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">_1st</span><span class="delimiter">&quot;</span></span>);
sleep();
stopTime(<span class="string"><span class="delimiter">&quot;</span><span class="content">custom_watcher</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">_2nd</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will get following test variables set:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
custom_watcher
</td>
<td class="hdlist2">
<p>first timestamp of time line</p>
</td>
</tr>
<tr>
<td class="hdlist1">
custom_watcher_1st
</td>
<td class="hdlist2">
<p>time passed since start</p>
</td>
</tr>
<tr>
<td class="hdlist1">
custom_watcher_2nd
</td>
<td class="hdlist2">
<p>time passed since start</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Of course using the same suffix multiple times will overwrite the timestamps in test variables.</p>
</div>
</div>
<div class="sect2">
<h3 id="actions-create-variables"><a class="anchor" href="#actions-create-variables"></a><a class="link" href="#actions-create-variables">13.9. Create variables</a></h3>
<div class="paragraph">
<p>As you know variables usually are defined at the beginning of the test case (<a href="#test-variables">test-variables</a>). It might also be helpful to reset existing variables as well as to define new variables during the test. The action &lt;create-variables&gt; is able to declare new variables or overwrite existing ones.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">createVariablesTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;variables&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myVariable</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">12345</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">54321</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/variables&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;echo&gt;</span>
            <span class="tag">&lt;message&gt;</span>Current variable value: ${myVariable}<span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/echo&gt;</span>

        <span class="tag">&lt;create-variables&gt;</span>
            <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myVariable</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${id}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">newVariable</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">'this is a test'</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/create-variables&gt;</span>

        <span class="tag">&lt;echo&gt;</span>
            <span class="tag">&lt;message&gt;</span>Current variable value: ${myVariable} <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/echo&gt;</span>

        <span class="tag">&lt;echo&gt;</span>
            <span class="tag">&lt;message&gt;</span>
              New variable 'newVariable' has the value: ${newVariable}
            <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/echo&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> createVariableTest() {
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">myVariable</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">12345</span><span class="delimiter">&quot;</span></span>);
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">54321</span><span class="delimiter">&quot;</span></span>);

    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Current variable value: ${myVariable}</span><span class="delimiter">&quot;</span></span>);

    createVariable(<span class="string"><span class="delimiter">&quot;</span><span class="content">myVariable</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${id}</span><span class="delimiter">&quot;</span></span>);
    createVariable(<span class="string"><span class="delimiter">&quot;</span><span class="content">newVariable</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">this is a test</span><span class="delimiter">&quot;</span></span>);

    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Current variable value: ${myVariable}</span><span class="delimiter">&quot;</span></span>);

    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">New variable 'newVariable' has the value: ${newVariable}</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please note the difference between the <strong>variable()</strong> method and the <strong>createVariable()</strong> method. The first initializes the test case with the test variables. So all variables defined with this method are valid from the very beginning of the test. In contrary to that the <strong>createVariable()</strong> is executed within the test action chain. The newly created variables are then valid for the rest of the test. Trailing actions can reference the variables as usual with the variable expression.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="actions-trace-variables"><a class="anchor" href="#actions-trace-variables"></a><a class="link" href="#actions-trace-variables">13.10. Trace variables</a></h3>
<div class="paragraph">
<p>You already know the &lt;echo&gt; action that prints messages to the console or logger. The &lt;trace-variables&gt; action is specially designed to trace all currently valid test variables to the console. This was mainly used by us for debug reasons. The usage is quite simple:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">traceVariablesTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;variables&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myVariable</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">12345</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nextVariable</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">54321</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/variables&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;trace-variables&gt;</span>
            <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myVariable</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nextVariable</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/trace-variables&gt;</span>

        <span class="tag">&lt;trace-variables</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> traceTest() {
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">myVariable</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">12345</span><span class="delimiter">&quot;</span></span>);
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">nextVariable</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">54321</span><span class="delimiter">&quot;</span></span>);

    traceVariables(<span class="string"><span class="delimiter">&quot;</span><span class="content">myVariable</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">nextVariable</span><span class="delimiter">&quot;</span></span>);
    traceVariables();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Simply add the &lt;trace-variables&gt; action to your action chain and all variables will be printed out to the console. You are able to define a special set of variables by using the &lt;variable&gt; child elements. See the output that was generated by the test example above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Current value of variable myVariable = 12345
Current value of variable nextVariable = 54321</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="actions-transform"><a class="anchor" href="#actions-transform"></a><a class="link" href="#actions-transform">13.11. Transform</a></h3>
<div class="paragraph">
<p>The <strong><em>`&lt;transform&gt;`</em></strong> action transforms XML fragments with XSLT in order to construct various XML representations. The transformation result is stored into a test variable for further usage. The property <strong>xml-data</strong> defines the XML source, that is going to be transformed, while <strong>xslt-data</strong> defines the XSLT transformation rules. The attribute <strong>variable</strong> specifies the target test variable which receives the transformation result. The tester might use the action to transform XML messages as shown in the next code example:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transformTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;actions&gt;</span>
          <span class="tag">&lt;transform</span> <span class="attribute-name">variable</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
              <span class="tag">&lt;xml-data&gt;</span>
                  <span class="inline-delimiter">&lt;![CDATA[</span>
                      &lt;TestRequest&gt;
                          &lt;Message&gt;Hello World!&lt;/Message&gt;
                      &lt;/TestRequest&gt;
                  <span class="inline-delimiter">]]&gt;</span>
              <span class="tag">&lt;/xml-data&gt;</span>
              <span class="tag">&lt;xslt-data&gt;</span>
                  <span class="inline-delimiter">&lt;![CDATA[</span>
                      &lt;xsl:stylesheet version=&quot;1.0&quot; xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;&gt;
                      &lt;xsl:template match=&quot;/&quot;&gt;
                          &lt;html&gt;
                              &lt;body&gt;
                                  &lt;h2&gt;Test Request&lt;/h2&gt;
                                  &lt;p&gt;Message: &lt;xsl:value-of select=&quot;TestRequest/Message&quot;/&gt;&lt;/p&gt;
                              &lt;/body&gt;
                          &lt;/html&gt;
                      &lt;/xsl:template&gt;
                      &lt;/xsl:stylesheet&gt;
                  <span class="inline-delimiter">]]&gt;</span>
              <span class="tag">&lt;/xslt-data&gt;</span>
          <span class="tag">&lt;/transform&gt;</span>
          <span class="tag">&lt;echo&gt;</span>
              <span class="tag">&lt;message&gt;</span>${result}<span class="tag">&lt;/message&gt;</span>
          <span class="tag">&lt;/echo&gt;</span>
      <span class="tag">&lt;/actions&gt;</span>
  <span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The transformation above results to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;html&gt;</span>
      <span class="tag">&lt;body&gt;</span>
          <span class="tag">&lt;h2&gt;</span>Test Request<span class="tag">&lt;/h2&gt;</span>
          <span class="tag">&lt;p&gt;</span>Message: Hello World!<span class="tag">&lt;/p&gt;</span>
      <span class="tag">&lt;/body&gt;</span>
  <span class="tag">&lt;/html&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example we used CDATA sections to define the transformation source as well as the XSL transformation rules. As usual you can also use external file resources here. The transform action with external file resources looks like follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">  <span class="tag">&lt;transform</span> <span class="attribute-name">variable</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;xml-resource</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:transform-source.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;xslt-resource</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:transform.xslt</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/transform&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Java DSL alternative for transforming data via XSTL in Citrus looks like follows:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> transformTest() {
    transform()
        .source(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;TestRequest&gt;</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Message&gt;Hello World!&lt;/Message&gt;</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/TestRequest&gt;</span><span class="delimiter">&quot;</span></span>)
        .xslt(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;xsl:stylesheet version=</span><span class="char">\&quot;</span><span class="content">1.0</span><span class="char">\&quot;</span><span class="content"> xmlns:xsl=</span><span class="char">\&quot;</span><span class="content">http://www.w3.org/1999/XSL/Transform</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;xsl:template match=</span><span class="char">\&quot;</span><span class="content">/</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;html&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;body&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                            <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;h2&gt;Test Request&lt;/h2&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                            <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;p&gt;Message: &lt;xsl:value-of select=</span><span class="char">\&quot;</span><span class="content">TestRequest/Message</span><span class="char">\&quot;</span><span class="content">/&gt;&lt;/p&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/body&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/html&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/xsl:template&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/xsl:stylesheet&gt;</span><span class="delimiter">&quot;</span></span>)
        .result(<span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span>);

    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">${result}</span><span class="delimiter">&quot;</span></span>);

    transform()
        .source(<span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">com/consol/citrus/actions/transform-source.xml</span><span class="delimiter">&quot;</span></span>))
        .xslt(<span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">com/consol/citrus/actions/transform.xslt</span><span class="delimiter">&quot;</span></span>))
        .result(<span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span>);

    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">${result}</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> transformTest() {
    transform(action -&gt;
        action.source(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;TestRequest&gt;</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;Message&gt;Hello World!&lt;/Message&gt;</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/TestRequest&gt;</span><span class="delimiter">&quot;</span></span>)
        .xslt(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;xsl:stylesheet version=</span><span class="char">\&quot;</span><span class="content">1.0</span><span class="char">\&quot;</span><span class="content"> xmlns:xsl=</span><span class="char">\&quot;</span><span class="content">http://www.w3.org/1999/XSL/Transform</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;xsl:template match=</span><span class="char">\&quot;</span><span class="content">/</span><span class="char">\&quot;</span><span class="content">&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;html&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;body&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;h2&gt;Test Request&lt;/h2&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;p&gt;Message: &lt;xsl:value-of select=</span><span class="char">\&quot;</span><span class="content">TestRequest/Message</span><span class="char">\&quot;</span><span class="content">/&gt;&lt;/p&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/body&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/html&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/xsl:template&gt;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/xsl:stylesheet&gt;</span><span class="delimiter">&quot;</span></span>)
        .result(<span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span>));

    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">${result}</span><span class="delimiter">&quot;</span></span>);

    transform(action -&gt;
        action.source(<span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">com/consol/citrus/actions/transform-source.xml</span><span class="delimiter">&quot;</span></span>))
              .xslt(<span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">com/consol/citrus/actions/transform.xslt</span><span class="delimiter">&quot;</span></span>))
              .result(<span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span>));

    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">${result}</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Defining multi-line Strings with nested quotes is no fun in Java. So you may want to use external file resources for your scripts as shown in the second part of the example. In fact you could also use script languages like Groovy or Scala that have much better support for multi-line Strings.</p>
</div>
</div>
<div class="sect2">
<h3 id="actions-groovy"><a class="anchor" href="#actions-groovy"></a><a class="link" href="#actions-groovy">13.12. Groovy script execution</a></h3>
<div class="paragraph">
<p>Groovy is an agile dynamic language for the Java Platform. Groovy ships with a lot of very powerful features and fits perfectly with Java as it is based on Java and runs inside the JVM.</p>
</div>
<div class="paragraph">
<p>The Citrus Groovy support might be the entrance for you to write customized test actions. You can easily execute Groovy code inside a test case, just like a normal test action. The whole test context with all variables is available to the Groovy action. This means someone can change variable values or create new variables very easily.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at some examples in order to understand the possible Groovy code interactions in Citrus:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groovyTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;variables&gt;</span>
    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">time</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate()</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/variables&gt;</span>
  <span class="tag">&lt;actions&gt;</span>
    <span class="tag">&lt;groovy&gt;</span>
        println 'Hello Citrus'
    <span class="tag">&lt;/groovy&gt;</span>
    <span class="tag">&lt;groovy&gt;</span>
        println 'The variable is: ${time}'
    <span class="tag">&lt;/groovy&gt;</span>
    <span class="tag">&lt;groovy</span> <span class="attribute-name">resource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/script/example.groovy</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> groovyTest() {
    groovy(<span class="string"><span class="delimiter">&quot;</span><span class="content">println 'Hello Citrus'</span><span class="delimiter">&quot;</span></span>);
    groovy(<span class="string"><span class="delimiter">&quot;</span><span class="content">println 'The variable is: ${time}'</span><span class="delimiter">&quot;</span></span>);

    groovy(<span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">com/consol/citrus/script/example.groovy</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> groovyTest() {
    groovy(action -&gt; action.script(<span class="string"><span class="delimiter">&quot;</span><span class="content">println 'Hello Citrus'</span><span class="delimiter">&quot;</span></span>));
    groovy(action -&gt; action.script(<span class="string"><span class="delimiter">&quot;</span><span class="content">println 'The variable is: ${time}'</span><span class="delimiter">&quot;</span></span>));

    groovy(action -&gt; action.script(<span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">com/consol/citrus/script/example.groovy</span><span class="delimiter">&quot;</span></span>)));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see it is possible to write Groovy code directly into the test case. Citrus will interpret and execute the Groovy code at runtime. As usual nested variable expressions are replaced with respective values. In general this is done in advance before the Groovy code is interpreted. For more complex Groovy code sections which grow in lines of code you can also reference external file resources.</p>
</div>
<div class="paragraph">
<p>After this basic Groovy code usage inside a test case we might be interested accessing the whole TestContext. The TestContext Java object holds all test variables and function definitions for the test case and can be referenced in Groovy code via simple naming convention. Just access the object reference 'context' and you are able to manipulate the TestContext (e.g. setting a new variable which is directly ready for use in following test actions).</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groovyTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;actions&gt;</span>
    <span class="tag">&lt;groovy&gt;</span>
      context.setVariable(&quot;greetingText&quot;,&quot;Hello Citrus&quot;)
      println context.getVariable(&quot;greetingText&quot;)
    <span class="tag">&lt;/groovy&gt;</span>
    <span class="tag">&lt;echo&gt;</span>
      <span class="tag">&lt;message&gt;</span>New variable: ${greetingText}<span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;/echo&gt;</span>
  <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The implicit TestContext access that was shown in the previous sample works with a default Groovy script template provided by Citrus. The Groovy code you write in the test case is automatically surrounded with a Groovy script which takes care of handling the TestContext. The default template looks like follows:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.consol.citrus</span>.*
<span class="include">import</span> <span class="include">com.consol.citrus.variable</span>.*
<span class="include">import</span> <span class="include">com.consol.citrus.context.TestContext</span>
<span class="include">import</span> <span class="include">com.consol.citrus.script.GroovyAction.ScriptExecutor</span>

<span class="include">public</span> <span class="include">class</span> <span class="include">GScript</span> <span class="include">implements</span> <span class="include">ScriptExecutor</span> {
    <span class="include">public</span> <span class="include">void</span> <span class="include">execute</span>(<span class="include">TestContext</span> <span class="include">context</span>) {
        <span class="annotation">@SCRIPTBODY</span><span class="error">@</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your code is placed in substitution to the <strong><em>@SCRIPTBODY@</em></strong> placeholder. Now you might understand how Citrus handles the context automatically. You can also write your own script templates making more advanced usage of other Java APIs and Groovy code. Just add a script template path to the test action like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;groovy</span> <span class="attribute-name">script-template</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:my-custom-template.groovy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  [...]
<span class="tag">&lt;/groovy&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On the other hand you can disable the automatic script template wrapping in your action at all:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;groovy</span> <span class="attribute-name">use-script-template</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  println 'Just use some Groovy code'
<span class="tag">&lt;/groovy&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The next example deals with advanced Groovy code and writing whole classes. We write a new Groovy class which implements the ScriptExecutor interface offered by Citrus. This interface defines a special execute method and provides access to the whole TestContext for advanced test variables access.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">groovyTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;variables&gt;</span>
    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">time</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate()</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/variables&gt;</span>
  <span class="tag">&lt;actions&gt;</span>
    <span class="tag">&lt;groovy&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
        import com.consol.citrus.*
        import com.consol.citrus.variable.*
        import com.consol.citrus.context.TestContext
        import com.consol.citrus.script.GroovyAction.ScriptExecutor

        public class GScript implements ScriptExecutor {
            public void execute(TestContext context) {
                println context.getVariable(&quot;time&quot;)
            }
        }
      <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/groovy&gt;</span>
  <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Implementing the ScriptExecutor interface in a custom Groovy class is applicable for very special test context manipulations as you are able to import and use other Java API classes in this code.</p>
</div>
</div>
<div class="sect2">
<h3 id="actions-fail"><a class="anchor" href="#actions-fail"></a><a class="link" href="#actions-fail">13.13. Failing the test</a></h3>
<div class="paragraph">
<p>The fail action will generate an exception in order to terminate the test case with error. The test case will therefore not be successful in the reports.</p>
</div>
<div class="paragraph">
<p>The user can specify a custom error message for the exception in order to describe the error cause. Here is a very simple example to clarify the syntax:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">failTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;fail</span> <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Test will fail with custom message</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Test results:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Execution of test: failTest failed! Nested exception is:
com.consol.citrus.exceptions.CitrusRuntimeException:
Test will fail with custom message

[...]

CITRUS TEST RESULTS

failTest          : failed - Exception is: Test will fail with custom message

Found 1 test cases to execute
Skipped 0 test cases (0.0%)
Executed 1 test cases, containing 3 actions
Tests failed:        1 (100.0%)
Tests successfully:  0 (0.0%)</code></pre>
</div>
</div>
<div class="paragraph">
<p>While using the Java DSL tester might want to raise some Java exceptions in the middle of configuring the test case. But this is not possible as we have to separate the design time and the execution time of the test case. The <strong>@CitrusTest</strong> annotated configuration method is called for building up the whole test case. After this method was processed the test gets executed in runtime oth the test. If you specify a throws exception statement in the configuration method this will not be done at runtime but at design time. This is why you have to use the special fail test action which raises a Java exception during the runtime of the test. The next example will not work as expected:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> wrongUsageSample() {
    <span class="comment">// some test actions</span>

    <span class="keyword">throw</span> <span class="keyword">new</span> ValidationException(<span class="string"><span class="delimiter">&quot;</span><span class="content">This test should fail now</span><span class="delimiter">&quot;</span></span>); <span class="comment">// does not work as expected</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The validation exception above is directly raised before the test is able to start as the <strong>@CitrusTest</strong> annotated method does not represent the test runtime. Instead of this we have to use the fail action as follows:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> failTest() {
    <span class="comment">// some test actions</span>

    fail(<span class="string"><span class="delimiter">&quot;</span><span class="content">This test should fail now</span><span class="delimiter">&quot;</span></span>); <span class="comment">// fails at test runtime as expected</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the test fails at runtime as the fail action is raised during the test execution as expected.</p>
</div>
</div>
<div class="sect2">
<h3 id="actions-input"><a class="anchor" href="#actions-input"></a><a class="link" href="#actions-input">13.14. Input</a></h3>
<div class="paragraph">
<p>During the test case execution it is possible to read some user input from the command line. The test execution will stop and wait for keyboard inputs over the standard input stream. The user has to type the input and end it with the return key.</p>
</div>
<div class="paragraph">
<p>The user input is stored to the respective variable value.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">inputTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;variables&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/variable&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/variable&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/variable&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput3</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">yes</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/variable&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput4</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/variable&gt;</span>
    <span class="tag">&lt;/variables&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;input</span><span class="tag">/&gt;</span>
        <span class="tag">&lt;echo&gt;</span><span class="tag">&lt;message&gt;</span>user input was: ${userinput}<span class="tag">&lt;/message&gt;</span><span class="tag">&lt;/echo&gt;</span>

        <span class="tag">&lt;input</span> <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Now press enter:</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">variable</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;echo&gt;</span><span class="tag">&lt;message&gt;</span>user input was: ${userinput1}<span class="tag">&lt;/message&gt;</span><span class="tag">&lt;/echo&gt;</span>

        <span class="tag">&lt;input</span> <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Do you want to continue?</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">valid-answers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">y/n</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">variable</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;echo&gt;</span><span class="tag">&lt;message&gt;</span>user input was: ${userinput2}<span class="tag">&lt;/message&gt;</span><span class="tag">&lt;/echo&gt;</span>

        <span class="tag">&lt;input</span> <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Do you want to continue?</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">valid-answers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">yes/no</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">variable</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;echo&gt;</span><span class="tag">&lt;message&gt;</span>user input was: ${userinput3}<span class="tag">&lt;/message&gt;</span><span class="tag">&lt;/echo&gt;</span>

        <span class="tag">&lt;input</span> <span class="attribute-name">variable</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput4</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;echo&gt;</span><span class="tag">&lt;message&gt;</span>user input was: ${userinput4}<span class="tag">&lt;/message&gt;</span><span class="tag">&lt;/echo&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the input action is customizable with a prompt message that is displayed to the user and some valid answer possibilities. The user input is stored to a test variable for further use in the test case. In detail the input action offers following attributes:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
message
</td>
<td class="hdlist2">
<p>message displayed to the user</p>
</td>
</tr>
<tr>
<td class="hdlist1">
valid-answers
</td>
<td class="hdlist2">
<p>possible valid answers separated with '/' character</p>
</td>
</tr>
<tr>
<td class="hdlist1">
variable
</td>
<td class="hdlist2">
<p>result variable name holding the user input (default = ${userinput})</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The same action in Java DSL now looks quite familiar to us although attribute naming is slightly different:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> inputActionTest() {
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>);
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>);
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span>);
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput3</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">yes</span><span class="delimiter">&quot;</span></span>);
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput4</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>);

    input();
    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">user input was: ${userinput}</span><span class="delimiter">&quot;</span></span>);
    input().message(<span class="string"><span class="delimiter">&quot;</span><span class="content">Now press enter:</span><span class="delimiter">&quot;</span></span>).result(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput1</span><span class="delimiter">&quot;</span></span>);
    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">user input was: ${userinput1}</span><span class="delimiter">&quot;</span></span>);
    input().message(<span class="string"><span class="delimiter">&quot;</span><span class="content">Do you want to continue?</span><span class="delimiter">&quot;</span></span>).answers(<span class="string"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">n</span><span class="delimiter">&quot;</span></span>).result(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput2</span><span class="delimiter">&quot;</span></span>);
    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">user input was: ${userinput2}</span><span class="delimiter">&quot;</span></span>);
    input().message(<span class="string"><span class="delimiter">&quot;</span><span class="content">Do you want to continue?</span><span class="delimiter">&quot;</span></span>).answers(<span class="string"><span class="delimiter">&quot;</span><span class="content">yes</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">no</span><span class="delimiter">&quot;</span></span>).result(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput3</span><span class="delimiter">&quot;</span></span>);
    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">user input was: ${userinput3}</span><span class="delimiter">&quot;</span></span>);
    input().result(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput4</span><span class="delimiter">&quot;</span></span>);
    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">user input was: ${userinput4}</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> inputActionTest() {
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>);
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>);
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span>);
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput3</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">yes</span><span class="delimiter">&quot;</span></span>);
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput4</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>);

    input(action -&gt; {});
    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">user input was: ${userinput}</span><span class="delimiter">&quot;</span></span>);
    input(action -&gt; action.message(<span class="string"><span class="delimiter">&quot;</span><span class="content">Now press enter:</span><span class="delimiter">&quot;</span></span>).result(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput1</span><span class="delimiter">&quot;</span></span>));
    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">user input was: ${userinput1}</span><span class="delimiter">&quot;</span></span>);
    input(action -&gt; action.message(<span class="string"><span class="delimiter">&quot;</span><span class="content">Do you want to continue?</span><span class="delimiter">&quot;</span></span>).answers(<span class="string"><span class="delimiter">&quot;</span><span class="content">y</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">n</span><span class="delimiter">&quot;</span></span>).result(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput2</span><span class="delimiter">&quot;</span></span>));
    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">user input was: ${userinput2}</span><span class="delimiter">&quot;</span></span>);
    input(action -&gt; action.message(<span class="string"><span class="delimiter">&quot;</span><span class="content">Do you want to continue?</span><span class="delimiter">&quot;</span></span>).answers(<span class="string"><span class="delimiter">&quot;</span><span class="content">yes</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">no</span><span class="delimiter">&quot;</span></span>).result(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput3</span><span class="delimiter">&quot;</span></span>));
    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">user input was: ${userinput3}</span><span class="delimiter">&quot;</span></span>);
    input(action -&gt; action.result(<span class="string"><span class="delimiter">&quot;</span><span class="content">userinput4</span><span class="delimiter">&quot;</span></span>));
    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">user input was: ${userinput4}</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the user input is restricted to a set of valid answers the input validation of course can fail due to mismatch. This is the case when the user provides some input not matching the valid answers given. In this case the user is again asked to provide valid input. The test action will continue to ask for valid input until a valid answer is given.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
User inputs may not fit to automatic testing in terms of continuous integration testing where no user is present to type in the correct answer over the keyboard. In this case you can always skip the user input in advance by specifying a variable that matches the user input variable name. As the user input variable is then already present the user input is missed out and the test proceeds automatically.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="actions-load"><a class="anchor" href="#actions-load"></a><a class="link" href="#actions-load">13.15. Load</a></h3>
<div class="paragraph">
<p>You are able to load properties from external property files and store them as test variables. The action will require a file resource either from class path or file system in order to read the property values.</p>
</div>
<div class="paragraph">
<p>Let us look at an example to get an idea about this action:</p>
</div>
<div class="listingblock">
<div class="title">Content of load.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">username=Mickey Mouse
greeting.text=Hello Test Framework</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">loadPropertiesTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;load&gt;</span>
            <span class="tag">&lt;properties</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file:tests/resources/load.properties</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/load&gt;</span>

        <span class="tag">&lt;trace-variables</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> loadPropertiesTest() {
    load(<span class="string"><span class="delimiter">&quot;</span><span class="content">file:tests/resources/load.properties</span><span class="delimiter">&quot;</span></span>);

    traceVariables();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Output</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Current value of variable username = Mickey Mouse
Current value of variable greeting.text = Hello Test Framework</code></pre>
</div>
</div>
<div class="paragraph">
<p>The action will load all available properties in the file load.properties and store them to the test case as local variables.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Please be aware of the fact that existing variables are overwritten!
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="actions-wait"><a class="anchor" href="#actions-wait"></a><a class="link" href="#actions-wait">13.16. Wait</a></h3>
<div class="paragraph">
<p>With this action you can make your test wait until a certain condition is satisfied. The attribute <strong>seconds</strong> defines the amount of time to wait in seconds. You can also use the milliseconds attribute for a more fine grained time value. The attribute <strong>interval</strong> defines the amount of time to wait <strong>between</strong> each check. The interval is always specified as millisecond time interval.</p>
</div>
<div class="paragraph">
<p>If the check does not exceed within the defined overall waiting time then the test execution fails with an appropriate error message. There are different types of conditions to check.</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
http
</td>
<td class="hdlist2">
<p>This condition is based on a Http request call on a server endpoint. Citrus will wait until the Http response is as defined (e.g. Http 200 OK). This is useful when you want to wait for a server to start.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
file
</td>
<td class="hdlist2">
<p>This condition checks for the existence of a file on the local file system. Citrus will wait until the file is present.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
message
</td>
<td class="hdlist2">
<p>This condition checks for the existence of a message in the local message store of the current test case. Citrus will wait until the message with the given name is present.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next let us have a look at a simple example:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">waitTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;wait</span> <span class="attribute-name">seconds</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2000</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span>
          <span class="tag">&lt;http</span> <span class="attribute-name">url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://sample.org/resource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">statusCode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">200</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2000</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;wait</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> waitTest() {
    waitFor().http(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://sample.org/resource</span><span class="delimiter">&quot;</span></span>).seconds(<span class="integer">10L</span>).interval(<span class="integer">2000L</span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example waits for some Http server resource to be available with <strong>Http 200 OK</strong> response. Citrus will use <strong>HEAD</strong> request method by default. You can set the request method with the <strong>method</strong> attribute on the Http condition.</p>
</div>
<div class="paragraph">
<p>Next let us have a look at the file condition usage:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">waitTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;wait</span> <span class="attribute-name">seconds</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2000</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span>
          <span class="tag">&lt;file</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">path/to/resource/file.txt</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;wait</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> waitTest() {
    waitFor().file(<span class="string"><span class="delimiter">&quot;</span><span class="content">path/to/resource/file.txt</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus checks for the file to exist under the given path. Only if the file exists the test will continue with further test actions.</p>
</div>
<div class="paragraph">
<p>Next let us have a look at the message condition usage:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">waitTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;wait</span> <span class="attribute-name">seconds</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2000</span><span class="delimiter">&quot;</span></span> <span class="tag">&gt;</span>
          <span class="tag">&lt;message</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloRequest</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;wait</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> waitTest() {
    waitFor().message(<span class="string"><span class="delimiter">&quot;</span><span class="content">helloRequest</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus checks for the message with the name <strong>helloRequest</strong> in the local message store. Only if the message with the given name is found the test will continue with further test actions. The local message
store is automatically filled with all exchanged messages (send or receive) in a test case. The message names are defined in the respective send or receive operations in the test.</p>
</div>
<div class="paragraph">
<p>When should somebody use this action? This action is very useful when you want your test to wait for a certain event to occur before continuing with the test execution. For example if you wish that your test waits until a Docker container is started or for an application to create a log file before continuing, then use this action. You can also create your own condition statements and bind it to the test action.</p>
</div>
</div>
<div class="sect2">
<h3 id="actions-purging-jms-destinations"><a class="anchor" href="#actions-purging-jms-destinations"></a><a class="link" href="#actions-purging-jms-destinations">13.17. Purging JMS destinations</a></h3>
<div class="paragraph">
<p>Purging JMS destinations during the test run is quite essential. Different test cases can influence each other when sending messages to the same JMS destinations. A test case should only receive those messages that actually belong to it. Therefore it is a good idea to purge all JMS queue destinations between the test cases. Obsolete messages that are stuck in a JMS queue for some reason are then removed so that the following test case is not offended.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Citrus provides special support for JMS related features. We have to activate those JMS features in our test case by adding a special "jms" namespace and schema definition location to the test case XML.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;spring:beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/testcase</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:spring</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:jms</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/jms/testcase</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
        <span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content">http://www.citrusframework.org/schema/testcase</span>
        <span class="content">http://www.citrusframework.org/schema/testcase/citrus-testcase.xsd</span>
        <span class="content">http://www.citrusframework.org/schema/jms/testcase</span>
        <span class="content">http://www.citrusframework.org/schema/jms/testcase/citrus-jms-testcase.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    [...]

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we are ready to use the JMS features in our test case in order to purge some JMS queues. This can be done with following action definition:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">purgeTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;actions&gt;</span>
      <span class="tag">&lt;jms:purge-jms-queues&gt;</span>
          <span class="tag">&lt;jms:queue</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Some.JMS.QUEUE.Name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;jms:queue</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Another.JMS.QUEUE.Name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;jms:queue</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">My.JMS.QUEUE.Name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/jms:purge-jms-queues&gt;</span>

      <span class="tag">&lt;jms:purge-jms-queues</span> <span class="attribute-name">connection-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;jms:queue</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Some.JMS.QUEUE.Name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;jms:queue</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Another.JMS.QUEUE.Name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;jms:queue</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">My.JMS.QUEUE.Name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/jms:purge-jms-queues&gt;</span>
  <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that we have referenced the <strong>jms</strong> namespace when using the <strong>purge-jms-queues</strong> test action.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> ConnectionFactory connectionFactory;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> purgeTest() {
    purgeQueues()
        .queue(<span class="string"><span class="delimiter">&quot;</span><span class="content">Some.JMS.QUEUE.Name</span><span class="delimiter">&quot;</span></span>)
        .queue(<span class="string"><span class="delimiter">&quot;</span><span class="content">Another.JMS.QUEUE.Name</span><span class="delimiter">&quot;</span></span>);

    purgeQueues(connectionFactory)
        .timeout(<span class="integer">150L</span>) <span class="comment">// custom timeout in ms</span>
        .queue(<span class="string"><span class="delimiter">&quot;</span><span class="content">Some.JMS.QUEUE.Name</span><span class="delimiter">&quot;</span></span>)
        .queue(<span class="string"><span class="delimiter">&quot;</span><span class="content">Another.JMS.QUEUE.Name</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> ConnectionFactory connectionFactory;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> purgeTest() {
    purgeQueues(action -&gt;
        action.queue(<span class="string"><span class="delimiter">&quot;</span><span class="content">Some.JMS.QUEUE.Name</span><span class="delimiter">&quot;</span></span>)
            .queue(<span class="string"><span class="delimiter">&quot;</span><span class="content">Another.JMS.QUEUE.Name</span><span class="delimiter">&quot;</span></span>));

    purgeQueues(action -&gt; action.connectionFactory(connectionFactory)
            .timeout(<span class="integer">150L</span>) <span class="comment">// custom timeout in ms</span>
            .queue(<span class="string"><span class="delimiter">&quot;</span><span class="content">Some.JMS.QUEUE.Name</span><span class="delimiter">&quot;</span></span>)
            .queue(<span class="string"><span class="delimiter">&quot;</span><span class="content">Another.JMS.QUEUE.Name</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Purging the JMS queues in every test case is quite exhausting because every test case needs to define a purging action at the very beginning of the test. Fortunately the test suite definition offers tasks to run before, between and after the test cases which should ease up this tasks a lot. The test suite offers a very simple way to purge the destinations between the tests. See <a href="#before-suite">testsuite-before-test</a>for more information about this.</p>
</div>
<div class="paragraph">
<p>As you can see in the next example it is quite easy to specify a group of destinations in the Spring configuration that get purged before a test is executed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:before-test</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">purgeBeforeTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:actions&gt;</span>
        <span class="tag">&lt;jms:purge-jms-queues&gt;</span>
            <span class="tag">&lt;jms:queue</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Some.JMS.QUEUE.Name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;jms:queue</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Another.JMS.QUEUE.Name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/jms:purge-jms-queues&gt;</span>
    <span class="tag">&lt;/citrus:actions&gt;</span>
<span class="tag">&lt;/citrus:before-test&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please keep in mind that the JMS related configuration components in Citrus belong to a separate XML namespace <strong>jms:</strong> . We have to add this namespace declaration to each test case XML and Spring bean XML configuration file as described at the very beginning of this section.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The syntax for purging the destinations is the same as we used it inside the test case. So now we are able to purge JMS destinations with given destination names. But sometimes we do not want to rely on queue or topic names as we retrieve destinations over JNDI for instance. We can deal with destinations coming from JNDI lookup like follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;jee:jndi-lookup</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsQueueHelloRequestIn</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">jndi-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jms/jmsQueueHelloRequestIn</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;jee:jndi-lookup</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsQueueHelloResponseOut</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">jndi-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jms/jmsQueueHelloResponseOut</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;citrus:before-test</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">purgeBeforeTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:actions&gt;</span>
        <span class="tag">&lt;jms:purge-jms-queues&gt;</span>
            <span class="tag">&lt;jms:queue</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsQueueHelloRequestIn</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;jms:queue</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsQueueHelloResponseOut</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/jms:purge-jms-queues&gt;</span>
    <span class="tag">&lt;/citrus:actions&gt;</span>
<span class="tag">&lt;/citrus:before-test&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We just use the attribute <strong>'ref'</strong> instead of <strong>'name'</strong> and Citrus is looking for a bean reference for that identifier that resolves to a JMS destination. You can use the JNDI bean references inside a test case, too.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">purgeTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;actions&gt;</span>
      <span class="tag">&lt;jms:purge-jms-queues&gt;</span>
          <span class="tag">&lt;jms:queue</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsQueueHelloRequestIn</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;jms:queue</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsQueueHelloResponseOut</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/jms:purge-jms-queues&gt;</span>
  <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course you can use queue object references also in Java DSL test cases. Here we easily can use Spring&#8217;s dependency injection with autowiring to get the object references from the IoC container.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsQueueHelloRequestIn</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">Queue</span> jmsQueueHelloRequestIn;

<span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsQueueHelloResponseOut</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">Queue</span> jmsQueueHelloResponseOut;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> purgeTest() {
    purgeQueues()
        .queue(jmsQueueHelloRequestIn)
        .queue(jmsQueueHelloResponseOut);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsQueueHelloRequestIn</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">Queue</span> jmsQueueHelloRequestIn;

<span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsQueueHelloResponseOut</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">Queue</span> jmsQueueHelloResponseOut;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> purgeTest() {
    purgeQueues(action -&gt;
        action.queue(jmsQueueHelloRequestIn)
            .queue(jmsQueueHelloResponseOut));
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can mix queue name and queue object references as you like within one single purge queue test action.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="actions-purging-message-channels"><a class="anchor" href="#actions-purging-message-channels"></a><a class="link" href="#actions-purging-message-channels">13.18. Purging message channels</a></h3>
<div class="paragraph">
<p>Message channels define central messaging destinations in Citrus. These are namely in memory message queues holding messages for test cases. These messages may become obsolete during a test run, especially when test cases fail and stop in their message consumption. Purging these message channel destinations is essential in these scenarios in order to not influence upcoming test cases. Each test case should only receive those messages that actually refer to the test model. Therefore it is a good idea to purge all message channel destinations between the test cases. Obsolete messages that get stuck in a message channel destination for some reason are then removed so that upcoming test case are not broken.</p>
</div>
<div class="paragraph">
<p>Following action definition purges all messages from a list of message channels:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">purgeChannelTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;actions&gt;</span>
      <span class="tag">&lt;purge-channel&gt;</span>
          <span class="tag">&lt;channel</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someChannelName</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;channel</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">anotherChannelName</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/purge-channel&gt;</span>

      <span class="tag">&lt;purge-channel&gt;</span>
          <span class="tag">&lt;channel</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someChannel</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;channel</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">anotherChannel</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/purge-channel&gt;</span>
  <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the test action supports channel names as well as channel references to Spring bean instances. When using channel references you refer to the Spring bean id or name in your application context.</p>
</div>
<div class="paragraph">
<p>The Java DSL works quite similar as you can read from next examples:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">channelResolver</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> DestinationResolver&lt;MessageChannel&gt; channelResolver;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> purgeTest() {
    purgeChannels()
        .channelResolver(channelResolver)
        .channelNames(<span class="string"><span class="delimiter">&quot;</span><span class="content">ch1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ch2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ch3</span><span class="delimiter">&quot;</span></span>)
        .channel(<span class="string"><span class="delimiter">&quot;</span><span class="content">ch4</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">channelResolver</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> DestinationResolver&lt;MessageChannel&gt; channelResolver;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> purgeTest() {
    purgeChannels(action -&gt;
        action.channelResolver(channelResolver)
                .channelNames(<span class="string"><span class="delimiter">&quot;</span><span class="content">ch1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ch2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ch3</span><span class="delimiter">&quot;</span></span>)
                .channel(<span class="string"><span class="delimiter">&quot;</span><span class="content">ch4</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The channel resolver reference is optional. By default Citrus will automatically use a Spring application context channel resolver so you just have to use the respective Spring bean names that are configured in the Spring application context. However setting a custom channel resolver may be adequate for you in some special cases.</p>
</div>
<div class="paragraph">
<p>While speaking of Spring application context bean references the next example uses such bean references for channels to purge.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">channel1</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> MessageChannel channel1;

<span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">channel2</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> MessageChannel channel2;

<span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">channel3</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> MessageChannel channel3;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> purgeTest() {
    purgeChannels()
        .channels(channel1, channel2)
        .channel(channel3);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">channel1</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> MessageChannel channel1;

<span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">channel2</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> MessageChannel channel2;

<span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">channel3</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> MessageChannel channel3;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> purgeTest() {
    purgeChannels(action -&gt;
        action.channels(channel1, channel2)
                .channel(channel3));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Message selectors enable you to selectively remove messages from the destination. All messages that pass the message selection logic get deleted the other messages will remain unchanged inside the channel destination. The message selector is a Spring bean that implements a special message selector interface. A possible implementation could be a selector deleting all messages that are older than five seconds:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">org.springframework.messaging.Message</span>;
<span class="keyword">import</span> <span class="include">org.springframework.integration.core.MessageSelector</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">TimeBasedMessageSelector</span> <span class="directive">implements</span> MessageSelector {

    <span class="directive">public</span> <span class="type">boolean</span> accept(Message&lt;?&gt; message) {
        <span class="keyword">if</span> (<span class="predefined-type">System</span>.currentTimeMillis() - message.getHeaders().getTimestamp() &gt; <span class="integer">5000</span>) {
            <span class="keyword">return</span> <span class="predefined-constant">false</span>;
        } <span class="keyword">else</span> {
            <span class="keyword">return</span> <span class="predefined-constant">true</span>;
        }
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The message selector returns <strong>false</strong> for those messages that should be deleted from the channel!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You simply define the message selector as a new Spring bean in the Citrus application context and reference it in your test action property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">specialMessageSelector</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.special.TimeBasedMessageSelector</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let us have a look at how you reference the selector in your test case:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;purge-channels</span> <span class="attribute-name">message-selector</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">specialMessageSelector</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;channel</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someChannelName</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;channel</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">anotherChannelName</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/purge-channels&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">specialMessageSelector</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> MessageSelector specialMessageSelector;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> purgeTest() {
    purgeChannels()
        .channelNames(<span class="string"><span class="delimiter">&quot;</span><span class="content">ch1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ch2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ch3</span><span class="delimiter">&quot;</span></span>)
        .selector(specialMessageSelector);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">specialMessageSelector</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> MessageSelector specialMessageSelector;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> purgeTest() {
    purgeChannels(action -&gt;
        action.channelNames(<span class="string"><span class="delimiter">&quot;</span><span class="content">ch1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ch2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ch3</span><span class="delimiter">&quot;</span></span>)
                .selector(specialMessageSelector));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the examples above we use a message selector implementation that gets injected via Spring IoC container.</p>
</div>
<div class="paragraph">
<p>Purging channels in each test case every time is quite exhausting because every test case needs to define a purging action at the very beginning of the test. A more straight forward approach would be to introduce some purging action which is automatically executed before each test. Fortunately the Citrus test suite offers a very simple way to do this. It is described in <a href="#before-suite">testsuite-before-test</a>.</p>
</div>
<div class="paragraph">
<p>When using the special action sequence before test cases we are able to purge channel destinations every time a test case executes. See the upcoming example to find out how the action is defined in the Spring configuration application context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:before-test</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">purgeBeforeTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:actions&gt;</span>
        <span class="tag">&lt;purge-channel&gt;</span>
            <span class="tag">&lt;channel</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fooChannel</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;channel</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">barChannel</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/purge-channel&gt;</span>
    <span class="tag">&lt;/citrus:actions&gt;</span>
<span class="tag">&lt;/citrus:before-test&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Just use this before-test bean in the Spring bean application context and the purge channel action is active. Obsolete messages that are waiting on the message channels for consumption are purged before the next test in line is executed.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Purging message channels becomes also very interesting when working with server instances in Citrus. Each server component automatically has an inbound message channel where incoming messages are stored to internally. So if you need to clean up a server that has already stored some incoming messages you can do this easily by purging the internal message channel. The message channel follows a naming convention <strong>{serverName}.inbound</strong> where <strong>{serverName}</strong> is the Spring bean name of the Citrus server endpoint component. If you purge this internal channel in a before test nature you are sure that obsolete messages on a server instance get purged before each test is executed.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="actions-purging-endpoints"><a class="anchor" href="#actions-purging-endpoints"></a><a class="link" href="#actions-purging-endpoints">13.19. Purging endpoints</a></h3>
<div class="paragraph">
<p>Citrus works with message endpoints when sending and receiving messages. In general endpoints can also queue messages. This is especially the case when using JMS message endpoints or any server endpoint component in Citrus. These are in memory message queues holding messages for test cases. These messages may become obsolete during a test run, especially when a test case that would consume the messages fails. Deleting all messages from a message endpoint is therefore a useful task and is essential in such scenarios so that upcoming test cases are not influenced. Each test case should only receive those messages that actually refer to the test model. Therefore it is a good idea to purge all message endpoint destinations between the test cases. Obsolete messages that get stuck in a message endpoint destination for some reason are then removed so that upcoming test case are not broken.</p>
</div>
<div class="paragraph">
<p>Following action definition purges all messages from a list of message endpoints:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">purgeEndpointTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;actions&gt;</span>
      <span class="tag">&lt;purge-endpoint&gt;</span>
          <span class="tag">&lt;endpoint</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someEndpointName</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;endpoint</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">anotherEndpointName</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/purge-endpoint&gt;</span>

      <span class="tag">&lt;purge-endpoint&gt;</span>
          <span class="tag">&lt;endpoint</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;endpoint</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">anotherEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/purge-endpoint&gt;</span>
  <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the test action supports endpoint names as well as endpoint references to Spring bean instances. When using endpoint references you refer to the Spring bean name in your application context.</p>
</div>
<div class="paragraph">
<p>The Java DSL works quite similar - have a look:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> purgeTest() {
    purgeEndpoints()
        .endpointNames(<span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint3</span><span class="delimiter">&quot;</span></span>)
        .endpoint(<span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint4</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> purgeTest() {
    purgeEndpoints(action -&gt;
        action.endpointNames(<span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint3</span><span class="delimiter">&quot;</span></span>)
                .endpoint(<span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint4</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using the Java DSL we can inject endpoint objects with Spring bean container IoC. The next example uses such bean references for endpoints in a purge action.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint1</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> Endpoint endpoint1;

<span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint2</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> Endpoint endpoint2;

<span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint3</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> Endpoint endpoint3;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> purgeTest() {
    purgeEndpoints()
        .endpoints(endpoint1, endpoint2)
        .endpoint(endpoint3);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint1</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> Endpoint endpoint1;

<span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint2</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> Endpoint endpoint2;

<span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint3</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> Endpoint endpoint3;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> purgeTest() {
    purgeEndpoints(action -&gt;
        action.endpoints(endpoint1, endpoint2)
                .endpoint(endpoint3));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Message selectors enable you to selectively remove messages from an endpoint. All messages that meet the message selector condition get deleted and the other messages remain inside the endpoint destination. The message selector is either a normal String name-value representation or a map of key value pairs:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;purge-endpoints&gt;</span>
  <span class="tag">&lt;selector&gt;</span>
    <span class="tag">&lt;value&gt;</span>operation = 'sayHello'<span class="tag">&lt;/value&gt;</span>
  <span class="tag">&lt;/selector&gt;</span>
  <span class="tag">&lt;endpoint</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someEndpointName</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;endpoint</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">anotherEndpointName</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/purge-endpoints&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> purgeTest() {
    purgeEndpoints()
        .endpointNames(<span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint3</span><span class="delimiter">&quot;</span></span>)
        .selector(<span class="string"><span class="delimiter">&quot;</span><span class="content">operation = 'sayHello'</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> purgeTest() {
    purgeEndpoints(action -&gt;
        action.endpointNames(<span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">endpoint3</span><span class="delimiter">&quot;</span></span>)
                .selector(<span class="string"><span class="delimiter">&quot;</span><span class="content">operation = 'sayHello'</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the examples above we use a String to represent the message selector expression. In general the message selector operates on the message header. So following on from that we remove all messages selectively that have a message header <strong>operation</strong> with its value <strong>sayHello</strong> .</p>
</div>
<div class="paragraph">
<p>Purging endpoints in each test case every time is quite exhausting because every test case needs to define a purging action at the very beginning of the test. A more straight forward approach would be to introduce some purging action which is automatically executed before each test. Fortunately the Citrus test suite offers a very simple way to do this. It is described in <a href="#before-suite">testsuite-before-test</a>.</p>
</div>
<div class="paragraph">
<p>When using the special action sequence before test cases we are able to purge endpoint destinations every time a test case executes. See the upcoming example to find out how the action is defined in the Spring configuration application context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:before-test</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">purgeBeforeTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:actions&gt;</span>
        <span class="tag">&lt;purge-endpoint&gt;</span>
            <span class="tag">&lt;endpoint</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fooEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;endpoint</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">barEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/purge-endpoint&gt;</span>
    <span class="tag">&lt;/citrus:actions&gt;</span>
<span class="tag">&lt;/citrus:before-test&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Just use this before-test bean in the Spring bean application context and the purge endpoint action is active. Obsolete messages that are waiting on the message endpoints for consumption are purged before the next test in line is executed.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Purging message endpoints becomes also very interesting when working with server instances in Citrus. Each server component automatically has an inbound message endpoint where incoming messages are stored to internally. Citrus will automatically use this incoming message endpoint as target for the purge action so you can just use the server instance as you know it from your configuration in any purge action.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="actions-assert-failure"><a class="anchor" href="#actions-assert-failure"></a><a class="link" href="#actions-assert-failure">13.20. Assert failure</a></h3>
<div class="paragraph">
<p>Citrus test actions fail with Java exceptions and error messages. This gives you the opportunity to expect an action to fail during test execution. You can simple assert a Java exception to be thrown during execution. See the example for an assert action definition in a test case:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">assertFailureTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;assert</span> <span class="attribute-name">exception</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.exceptions.CitrusRuntimeException</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Unknown variable ${date}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;when&gt;</span>
                <span class="tag">&lt;echo&gt;</span>
                    <span class="tag">&lt;message&gt;</span>Current date is: ${date}<span class="tag">&lt;/message&gt;</span>
                <span class="tag">&lt;/echo&gt;</span>
            <span class="tag">&lt;/when&gt;</span>
        <span class="tag">&lt;/assert&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> assertTest() {
    assertException().exception(com.consol.citrus.exceptions.CitrusRuntimeException.class)
                     .message(<span class="string"><span class="delimiter">&quot;</span><span class="content">Unknown variable ${date}</span><span class="delimiter">&quot;</span></span>)
                .when(echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Current date is: ${date}</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that the assert action requires an exception. In case no exception is thrown by the embedded test action the assertion and the test case will fail!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The assert action always wraps a single test action, which is then monitored for failure. In case the nested test action fails with error you can validate the error in its type and error message (optional). The failure has to fit the expected one exactly otherwise the assertion fails itself.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Important to notice is the fact that asserted exceptions do not cause failure of the test case. As you except the failure to happen the test continues with its work once the assertion is done successfully.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="actions-catch-exceptions"><a class="anchor" href="#actions-catch-exceptions"></a><a class="link" href="#actions-catch-exceptions">13.21. Catch exceptions</a></h3>
<div class="paragraph">
<p>In the previous chapter we have seen how to expect failures in Citrus with assert action. Now the assert action is designed for single actions to be monitored and for failures to be expected in any case. The <strong>'catch'</strong> action in contrary can hold several nested test actions and exception failure is optional.</p>
</div>
<div class="paragraph">
<p>The nested actions are error proof for the chosen exception type. This means possible exceptions are caught and ignored - the test case will not fail for this exception type. But only for this particular exception type! Other exception types that occur during execution do cause the test to fail as usual.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">catchExceptionTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;catch</span> <span class="attribute-name">exception</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.exceptions.CitrusRuntimeException</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;echo&gt;</span>
                <span class="tag">&lt;message&gt;</span>Current date is: ${date}<span class="tag">&lt;/message&gt;</span>
            <span class="tag">&lt;/echo&gt;</span>
        <span class="tag">&lt;/catch&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> catchTest() {
    catchException().exception(CitrusRuntimeException.class)
                    .when(echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Current date is: ${date}</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Note that there is no validation available in a catch block. So catching exceptions is just to make a test more stable towards errors that can occur. The caught exception does not cause any failure in the test. The test case may continue with execution as if there was not failure. Also notice that the catch action is also happy when no exception at all is raised. In contrary to that the assert action requires the exception and an assert action is failing in positive processing.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Catching exceptions like this may only fit to very error prone action blocks where failures do not harm the test case success. Otherwise a failure in a test action should always reflect to the whole test case to fail with errors.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Java developers might ask why not use try-catch Java block instead? The answer is simple yet very important to understand. The test method is called by the Java DSL test case builder for building the Citrus test. This can be referred to as the design time of the test. After the building test method was processed the test gets executed, which can be called the runtime of the test. This means that a try-catch block within the design time method will never perform during the test run. The only reliable way to add the catch capability to the test as part of the test case runtime is to use the Citrus test action which gets executed during test runtime.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="actions-ant-build"><a class="anchor" href="#actions-ant-build"></a><a class="link" href="#actions-ant-build">13.22. Apache Ant build</a></h3>
<div class="paragraph">
<p>The &lt;ant&gt; action loads a build.xml Ant file and executes one or more targets in the Ant project. The target is executed with optional build properties passed to the Ant run. The Ant build output is logged with Citrus logger and the test case success is bound to the Ant build success. This means in case the Ant build fails for some reason the test case will also fail with build exception accordingly.</p>
</div>
<div class="paragraph">
<p>See this basic Ant run example to see how it works within your test case:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">AntRunTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;variables&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">today</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate()</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/variables&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;ant</span> <span class="attribute-name">build-file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/actions/build.xml</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;execute</span> <span class="attribute-name">target</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;properties&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${today}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">welcomeText</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello!</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/properties&gt;</span>
        <span class="tag">&lt;/ant&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> antRunTest() {
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">today</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate()</span><span class="delimiter">&quot;</span></span>);

    antrun(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/actions/build.xml</span><span class="delimiter">&quot;</span></span>)
        .target(<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>)
        .property(<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${today}</span><span class="delimiter">&quot;</span></span>)
        .property(<span class="string"><span class="delimiter">&quot;</span><span class="content">welcomeText</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">$Hello!</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> antRunTest() {
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">today</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate()</span><span class="delimiter">&quot;</span></span>);

    antrun(action -&gt; action.buildFilePath(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/actions/build.xml</span><span class="delimiter">&quot;</span></span>)
                .target(<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>)
                .property(<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${today}</span><span class="delimiter">&quot;</span></span>)
                .property(<span class="string"><span class="delimiter">&quot;</span><span class="content">welcomeText</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">$Hello!</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The respective build.xml Ant file must provide the target to call. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;project</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus-build</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">default</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">welcomeText</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Welcome to Citrus!</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/property&gt;</span>

    <span class="tag">&lt;target</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;echo</span> <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${welcomeText} - Today is ${date}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/echo&gt;</span>
    <span class="tag">&lt;/target&gt;</span>

    <span class="tag">&lt;target</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayGoodbye</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;echo</span> <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Goodbye everybody!</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/echo&gt;</span>
    <span class="tag">&lt;/target&gt;</span>
<span class="tag">&lt;/project&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see you can pass custom build properties to the Ant build execution. Existing Ant build properties are replaced and you can use the properties in your build file as usual.</p>
</div>
<div class="paragraph">
<p>You can also call multiple targets within one single build run by using a comma separated list of target names:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">AntRunTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;variables&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">today</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate()</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/variables&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;ant</span> <span class="attribute-name">build-file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/actions/build.xml</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;execute</span> <span class="attribute-name">targets</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello,sayGoodbye</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;properties&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${today}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/properties&gt;</span>
        <span class="tag">&lt;/ant&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> antRunTest() {
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">today</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate()</span><span class="delimiter">&quot;</span></span>);

    antrun(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/actions/build.xml</span><span class="delimiter">&quot;</span></span>)
        .targets(<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayGoodbye</span><span class="delimiter">&quot;</span></span>)
        .property(<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${today}</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> antRunTest() {
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">today</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate()</span><span class="delimiter">&quot;</span></span>);

    antrun(action -&gt; action.buildFilePath(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/actions/build.xml</span><span class="delimiter">&quot;</span></span>)
                .targets(<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayGoodbye</span><span class="delimiter">&quot;</span></span>)
                .property(<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${today}</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The build properties can live in external file resource as an alternative to the inline property definitions. You just have to use the respective file resource path and all nested properties get loaded as build properties.</p>
</div>
<div class="paragraph">
<p>In addition to that you can also define a custom build listener. The build listener must implement the Ant API interface <strong>org.apache.tools.ant.BuildListener</strong> . During the Ant build run the build listener is called with several callback methods (e.g. buildStarted(), buildFinished(), targetStarted(), targetFinished(), …). This is how you can add additional logic to the Ant build run from Citrus. A custom build listener could manage the fail state of your test case, in particular by raising some exception forcing the test case to fail accordingly.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">AntRunTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;ant</span> <span class="attribute-name">build-file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/actions/build.xml</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">build-listener</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customBuildListener</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;execute</span> <span class="attribute-name">target</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;properties</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/actions/build.properties</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/ant&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="directive">private</span> BuildListener customBuildListener;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> antRunTest() {
    antrun(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/actions/build.xml</span><span class="delimiter">&quot;</span></span>)
        .target(<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>)
        .propertyFile(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/actions/build.properties</span><span class="delimiter">&quot;</span></span>)
        .listener(customBuildListener);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="directive">private</span> BuildListener customBuildListener;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> antRunTest() {
    antrun(action -&gt; action.buildFilePath(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/actions/build.xml</span><span class="delimiter">&quot;</span></span>)
            .target(<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>)
            .propertyFile(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/actions/build.properties</span><span class="delimiter">&quot;</span></span>)
            .listener(customBuildListener));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>customBuildListener</strong> used in the example above should reference a Spring bean in the Citrus application context. The bean implements the interface <strong>org.apache.tools.ant.BuildListener</strong> and controls the Ant build run.</p>
</div>
</div>
<div class="sect2">
<h3 id="actions-start-stop"><a class="anchor" href="#actions-start-stop"></a><a class="link" href="#actions-start-stop">13.23. Start/Stop server</a></h3>
<div class="paragraph">
<p>Citrus is working with server components that are started and stopped within a test run. This can be a Http server or some SMTP mail server for instance. Usually the Citrus server components are automatically started when Citrus is starting and respectively stopped when Citrus is shutting down. Sometimes it might be helpful to explicitly start and stop a server instance within your test case. Here you can use special start and stop test actions inside your test. This is a good way to test downtime scenarios of interface partners with respective error handling when connections to servers are lost</p>
</div>
<div class="paragraph">
<p>Let me explain with a simple sample test case:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sleepTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;start</span> <span class="attribute-name">server</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myMailServer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

        <span class="tag">&lt;sleep</span><span class="tag">/&gt;</span>

        <span class="tag">&lt;stop</span> <span class="attribute-name">server</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myMailServer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The start and stop server test action receive a server name which references a Spring bean component of type <strong>com.consol.citrus.server.Server</strong> in your basic Spring application context. The server instance is started or stopped within the test case. As you can see in the next listing we can also start and stop multiple server instances within a single test action.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sleepTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;start&gt;</span>
            <span class="tag">&lt;servers&gt;</span>
                <span class="tag">&lt;server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myMailServer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myFtpServer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/servers&gt;</span>
        <span class="tag">&lt;/start&gt;</span>

        <span class="tag">&lt;sleep</span><span class="tag">/&gt;</span>

        <span class="tag">&lt;stop&gt;</span>
            <span class="tag">&lt;servers&gt;</span>
                <span class="tag">&lt;server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myMailServer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;server</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myFtpServer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/servers&gt;</span>
        <span class="tag">&lt;/stop&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When using the Java DSL the best way to reference a server instance is to autowire the Spring bean via dependency injection. The Spring framework takes case on injecting the proper Spring bean component defined in the Spring application context. This way you can easily start and stop server instances within Java DSL test cases.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">myFtpServer</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> FtpServer myFtpServer;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> startStopServerTest() {
    start(myFtpServer);

    sleep();

    stop(myFtpServer);
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Starting and stopping server instances is a synchronous test action. This means that your test case is waiting for the server to start before other test actions take place. Startup times and shut down of server instances may delay your test accordingly.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As you can see starting and stopping Citrus server instances is very easy. You can also write your own server implementations by implementing the interface <strong>com.consol.citrus.server.Server</strong> . All custom server implementations can then be started and stopped during a test case.</p>
</div>
</div>
<div class="sect2">
<h3 id="actions-stop-timer"><a class="anchor" href="#actions-stop-timer"></a><a class="link" href="#actions-stop-timer">13.24. Stop Timer</a></h3>
<div class="paragraph">
<p>The &lt;stop-timer&gt; action can be used for stopping either a specific timer (<a href="#containers-timer">containers-timer</a>) or all timers running within a test. This action is useful when timers are started in the background (using parallel or fork=true) and you wish to stop these timers at the end of the test. Some examples of using this action are provided below:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">timerTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
      <span class="tag">&lt;timer</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">forkedTimer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">fork</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;sleep</span> <span class="attribute-name">milliseconds</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">50</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;/timer&gt;</span>

      <span class="tag">&lt;timer</span> <span class="attribute-name">fork</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;sleep</span> <span class="attribute-name">milliseconds</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">50</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;/timer&gt;</span>

      <span class="tag">&lt;timer</span> <span class="attribute-name">repeatCount</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;sleep</span> <span class="attribute-name">milliseconds</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">50</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;/timer&gt;</span>

      <span class="tag">&lt;stop-timer</span> <span class="attribute-name">timerId</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">forkedTimer</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
    <span class="tag">&lt;finally&gt;</span>
      <span class="tag">&lt;stop-timer</span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/finally&gt;</span>
  <span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
  <span class="directive">public</span> <span class="type">void</span> timerTest() {

    timer()
      .timerId(<span class="string"><span class="delimiter">&quot;</span><span class="content">forkedTimer</span><span class="delimiter">&quot;</span></span>)
      .fork(<span class="predefined-constant">true</span>)
      .actions(sleep(<span class="integer">50L</span>)
    );

    timer()
      .fork(<span class="predefined-constant">true</span>)
      .actions(sleep(<span class="integer">50L</span>)
    );

    timer()
      .repeatCount(<span class="integer">5</span>)
      .actions(sleep(<span class="integer">50L</span>));

    stopTimer(<span class="string"><span class="delimiter">&quot;</span><span class="content">forkedTimer</span><span class="delimiter">&quot;</span></span>)

    doFinally().actions(
      stopTimer()
    );
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example 3 timers are started, the first 2 in the background and the third in the test execution thread. Timer #3 has a repeatCount set to 5 so it will terminate automatically after 5 runs. Timer #1 and #2 however have no repeatCount set so they will execute until they are told to stop.</p>
</div>
<div class="paragraph">
<p>Timer #1 is stopped explicitly using the first stopTimer action. Here the stopTimer action includes the name of the timer to stop. This is convenient when you wish to terminate a specific timer. However since no timerId was set for timer #2, you can terminate this (and all other timers) using the 'stopTimer' action with no explicit timerId set.</p>
</div>
</div>
<div class="sect2">
<h3 id="actions-custom"><a class="anchor" href="#actions-custom"></a><a class="link" href="#actions-custom">13.25. Custom test actions</a></h3>
<div class="paragraph">
<p>Now we have a look at the opportunity to add custom test actions to the test case flow. Let us start this section with an example:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ActionReferenceTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;action</span> <span class="attribute-name">reference</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cleanUpDatabase</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;action</span> <span class="attribute-name">reference</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mySpecialAction</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The generic &lt;action&gt; element references Spring beans that implement the Java interface <strong><em>com.consol.citrus.TestAction</em></strong> . This is a very fast way to add your own action implementations to a Citrus test case. This way you can easily implement your own actions in Java and include them into the test case.</p>
</div>
<div class="paragraph">
<p>In the example above the called actions are special database cleanup implementations. The actions are defined as Spring beans in the Citrus configuration and get referenced by their bean name or id.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cleanUpDatabase</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">my.domain.citrus.actions.SpecialDatabaseCleanupAction</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Spring application context holds your custom bean implementations. You can set properties and use the full Spring power while implementing your custom test action in Java. Let us have a look on how such a Java class may look like.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">com.consol.citrus.actions.AbstractTestAction</span>;
<span class="keyword">import</span> <span class="include">com.consol.citrus.context.TestContext</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">SpecialDatabaseCleanupAction</span> <span class="directive">extends</span> AbstractTestAction {

    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> <span class="predefined-type">DataSource</span> dataSource;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> doExecute(TestContext context) {
        JdbcTemplate jdbcTemplate = <span class="keyword">new</span> JdbcTemplate(dataSource);

        jdbcTemplate.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">...</span><span class="delimiter">&quot;</span></span>);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All you need to do in your Java class is to implement the Citrus <strong><em>com.consol.citrus.TestAction</em></strong> interface. The abstract class <strong><em>com.consol.citrus.actions.AbstractTestAction</em></strong> may help you to start with your custom test action implementation as it provides basic method implementations so you just have to implement the <strong><em>doExecute()</em></strong> method.</p>
</div>
<div class="paragraph">
<p>When using the Java test case DSL you are also quite comfortable with including your custom test actions.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="directive">private</span> SpecialDatabaseCleanupAction cleanUpDatabaseAction;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> genericActionTest() {
    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Now let's include our special test action</span><span class="delimiter">&quot;</span></span>);

    action(cleanUpDatabaseAction);

    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">That's it!</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using anonymous class implementations is also possible.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> genericActionTest() {
    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Now let's call our special test action anonymously</span><span class="delimiter">&quot;</span></span>);

    action(<span class="keyword">new</span> AbstractTestAction() {
        <span class="directive">public</span> <span class="type">void</span> doExecute(TestContext context) {
            <span class="comment">// do something</span>
        }
    });

    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">That's it!</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="templates"><a class="anchor" href="#templates"></a><a class="link" href="#templates">14. Templates</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Templates group action sequences to a logical unit. You can think of templates as reusable components that are used in several tests. The maintenance is much more effective because the templates are referenced several times.</p>
</div>
<div class="paragraph">
<p>The template always has a unique name. Inside a test case we call the template by this unique name. Have a look at a first example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;template</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">doCreateVariables</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;create-variables&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">var</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">123456789</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/create-variables&gt;</span>

    <span class="tag">&lt;call-template</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">doTraceVariables</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/template&gt;</span>

<span class="tag">&lt;template</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">doTraceVariables</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;echo&gt;</span>
        <span class="tag">&lt;message&gt;</span>Current time is: ${time}<span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;/echo&gt;</span>

    <span class="tag">&lt;trace-variables</span><span class="tag">/&gt;</span>
<span class="tag">&lt;/template&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The code example above describes two template definitions. Templates hold a sequence of test actions or call other templates themselves as seen in the example above.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The &lt;call-template&gt; action calls other templates by their name. The called template not necessarily has to be located in the same test case XML file. The template might be defined in a separate XML file other than the test case itself:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">templateTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;variables&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myTime</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate()</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/variables&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;call-template</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">doCreateVariables</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

        <span class="tag">&lt;call-template</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">doTraceVariables</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;parameter</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">time</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${myTime}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;/call-template&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> templateTest() {
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">myTime</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate()</span><span class="delimiter">&quot;</span></span>);

    applyTemplate(<span class="string"><span class="delimiter">&quot;</span><span class="content">doCreateVariables</span><span class="delimiter">&quot;</span></span>);

    applyTemplate(<span class="string"><span class="delimiter">&quot;</span><span class="content">doTraceVariables</span><span class="delimiter">&quot;</span></span>)
        .parameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">time</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${myTime}</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> templateTest() {
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">myTime</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate()</span><span class="delimiter">&quot;</span></span>);

    applyTemplate(template -&gt; template.name(<span class="string"><span class="delimiter">&quot;</span><span class="content">doCreateVariables</span><span class="delimiter">&quot;</span></span>));

    applyTemplate(template -&gt; template.name(<span class="string"><span class="delimiter">&quot;</span><span class="content">doTraceVariables</span><span class="delimiter">&quot;</span></span>)
                    .parameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">time</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${myTime}</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is an open question when dealing with templates that are defined somewhere else outside the test case. How to handle variables? A templates may use different variable names then the test and vice versa. No doubt the template will fail as soon as special variables with respective values are not present. Unknown variables cause the template and the whole test to fail with errors.</p>
</div>
<div class="paragraph">
<p>So a first approach would be to harmonize variable usage across templates and test cases, so that templates and test cases do use the same variable naming. But this approach might lead to high calibration effort. Therefore templates support parameters to solve this problem. When a template is called the calling actor is able to set some parameters. Let us discuss an example for this issue.</p>
</div>
<div class="paragraph">
<p>The template "doDateConversion" in the next sample uses the variable ${date}. The calling test case can set this variable as a parameter without actually declaring the variable in the test itself:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;call-template</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">doDateConversion</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;parameter</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${sampleDate}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;/call-template&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The variable <strong>sampleDate</strong> is already present in the test case and gets translated into the <strong>date</strong> parameter. Following from that the template works fine although test and template do work on different variable namings.</p>
</div>
<div class="paragraph">
<p>With template parameters you are able to solve the calibration effort when working with templates and variables. It is always a good idea to check the used variables/parameters inside a template when calling it. There might be a variable that is not declared yet inside your test. So you need to define this value as a parameter.</p>
</div>
<div class="paragraph">
<p>Template parameters may contain more complex values like XML fragments. The call-template action offers following CDATA variation for defining complex parameter values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;call-template</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">printXMLPayload</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;parameter</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">payload</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;value&gt;</span>
        <span class="inline-delimiter">&lt;![CDATA[</span>
          &lt;HelloRequest xmlns=&quot;http://www.consol.de/schemas/samples/sayHello.xsd&quot;&gt;
            &lt;Text&gt;Hello South ${var}&lt;/Text&gt;
          &lt;/HelloRequest&gt;
        <span class="inline-delimiter">]]&gt;</span>
      <span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;/parameter&gt;</span>
<span class="tag">&lt;/call-template&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When a template works on variable values and parameters changes to these variables will automatically affect the variables in the whole test. So if you change a variable&#8217;s value inside a template and the variable is defined inside the test case the changes will affect the variable in a global context. We have to be careful with this when executing a template several times in a test, especially in combination with parallel containers (see <a href="#containers-parallel">containers-parallel</a>).
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;parallel&gt;</span>
    <span class="tag">&lt;call-template</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">print</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;parameter</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">param1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;parameter</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">param2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Europe</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/call-template&gt;</span>
    <span class="tag">&lt;call-template</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">print</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;parameter</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">param1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;parameter</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">param2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Asia</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/call-template&gt;</span>
    <span class="tag">&lt;call-template</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">print</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;parameter</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">param1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;parameter</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">param2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Africa</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/call-template&gt;</span>
<span class="tag">&lt;/parallel&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the listing above a template <strong>print</strong> is called several times in a parallel container. The parameter values will be handled in a global context, so it is quite likely to happen that the template instances influence each other during execution. We might get such print messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">2. Hello Europe
2. Hello Africa
3. Hello Africa</code></pre>
</div>
</div>
<div class="paragraph">
<p>Index parameters do not fit and the message <strong>'Hello Asia'</strong> is completely gone. This is because templates overwrite parameters to each other as they are executed in parallel at the same time. To avoid this behavior we need to tell the template that it should handle parameters as well as variables in a local context. This will enforce that each template instance is working on a dedicated local context. See the <strong>global-context</strong> attribute that is set to <strong>false</strong> in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;template</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">print</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">global-context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;echo&gt;</span>
        <span class="tag">&lt;message&gt;</span>${param1}.${param2}<span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;/echo&gt;</span>
<span class="tag">&lt;/template&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After that template instances won&#8217;t influence each other anymore. But notice that variable changes inside the template then do not affect the test case neither.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="test-behavior"><a class="anchor" href="#test-behavior"></a><a class="link" href="#test-behavior">15. Test behaviors</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Test behaviors combine action sequences to a logical unit. The behavior defines a set of test actions that can be applied to a Java DSL test case.
Following from that you can say that behaviors are reusable test action templates. The maintenance is much more effective when you reuse basic test actions
in many test cases.</p>
</div>
<div class="paragraph">
<p>The behavior is a separate Java DSL class with a single <em>apply</em> method that configures the test actions. Have a look at this first example:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">FooBehavior</span> <span class="directive">extends</span> AbstractTestBehavior {
    <span class="directive">public</span> <span class="type">void</span> apply() {
        variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>);

        echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">fooBehavior</span><span class="delimiter">&quot;</span></span>);
    }
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">BarBehavior</span> <span class="directive">extends</span> AbstractTestBehavior {
    <span class="directive">public</span> <span class="type">void</span> apply() {
        variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>);

        echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">barBehavior</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the behavior class is able to use the Citrus Java DSL as usual. Each behavior is able to define test variables and actions. In a test case you can apply the behaviors
as follows:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> behaviorTest() {
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">myTime</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate()</span><span class="delimiter">&quot;</span></span>);

    FooBehavior fooBehavior = <span class="keyword">new</span> FooBehavior();
    applyBehavior(fooBehavior);

    applyBehavior(<span class="keyword">new</span> BarBehavior());

    applyBehavior(fooBehavior);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When dealing with behaviors test actions are defined somewhere outside the test case. How do we handle test variables? A behavior may use different variable names then the test and vice versa.
No doubt the behavior will fail as soon as special variables with respective values are not present. Unknown variables cause the behavior and the whole test to fail with errors.</p>
</div>
<div class="paragraph">
<p>So a good approach would be to harmonize variable usage across behaviors and test cases, so that templates and test cases do use the same variable naming. The behavior automatically knows all variables in the test case.
And all test variables created inside the behavior are visible to the test case after applying.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When a behavior changes variables this will automatically affect the variables in the whole test. So if you change a variable&#8217;s value inside a behavior and the variable is defined inside the test case the changes will affect
the variable in a global test context. This means we have to be careful when executing a behavior several times in a test, especially in combination with parallel containers (see <a href="#containers-parallel">containers-parallel</a>).
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="behavior-types"><a class="anchor" href="#behavior-types"></a><a class="link" href="#behavior-types">15.1. Behavior types</a></h3>
<div class="paragraph">
<p>The test case in Java is able to follow either designer or runner strategies. This means we also have two different behavior types for designer and runner respectively.
The behaviors are located in separate packages</p>
</div>
<div class="ulist">
<ul>
<li>
<p>com.consol.citrus.dsl.design.AbstractTestBehavior</p>
</li>
<li>
<p>com.consol.citrus.dsl.runner.AbstractTestBehavior</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Decide which base behavior you want to extend from according to your test case nature.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="containers"><a class="anchor" href="#containers"></a><a class="link" href="#containers">16. Containers</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Similar to templates a container element holds one to many test actions. In contrast to the template the container appears directly inside the test case action chain, meaning that the container is not referenced by more than one test case.</p>
</div>
<div class="paragraph">
<p>Containers execute the embedded test actions in specific logic. This can be an execution in iteration for instance. Combine different containers with each other and you will be able to generate very powerful hierarchical structures in order to create a complex execution logic. In the following sections some predefined containers are described.</p>
</div>
<div class="sect2">
<h3 id="containers-sequential"><a class="anchor" href="#containers-sequential"></a><a class="link" href="#containers-sequential">16.1. Sequential</a></h3>
<div class="paragraph">
<p>The sequential container executes the embedded test actions in strict sequence. Readers now might search for the difference to the normal action chain that is specified inside the test case. The actual power of sequential containers does show only in combination with other containers like iterations and parallels. We will see this later when handling these containers.</p>
</div>
<div class="paragraph">
<p>For now the sequential container seems not very sensational - one might say boring - because it simply groups a pair of test actions to sequential execution.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sequentialTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;sequential&gt;</span>
            <span class="tag">&lt;trace-time</span><span class="tag">/&gt;</span>
            <span class="tag">&lt;sleep</span><span class="tag">/&gt;</span>
            <span class="tag">&lt;echo&gt;</span>
                <span class="tag">&lt;message&gt;</span>Hallo TestFramework<span class="tag">&lt;/message&gt;</span>
            <span class="tag">&lt;/echo&gt;</span>
            <span class="tag">&lt;trace-time</span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/sequential&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> sequentialTest() {
    sequential()
        .actions(
            stopTime(),
            sleep(<span class="float">1.0</span>),
            echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Citrus</span><span class="delimiter">&quot;</span></span>),
            stopTime()
        );
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="containers-conditional"><a class="anchor" href="#containers-conditional"></a><a class="link" href="#containers-conditional">16.2. Conditional</a></h3>
<div class="paragraph">
<p>Now we deal with conditional executions of test actions. Nested actions inside a conditional container are executed only in case a boolean expression evaluates to true. Otherwise the container execution is not performed at all.</p>
</div>
<div class="paragraph">
<p>See some example to find out how it works with the conditional expression string.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">conditionalTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;variables&gt;</span>
      <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">shouldSleep</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/variables&gt;</span>

    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;conditional</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${index} = 5</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;sleep</span> <span class="attribute-name">seconds</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/conditional&gt;</span>

        <span class="tag">&lt;conditional</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${shouldSleep}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;sleep</span> <span class="attribute-name">seconds</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/conditional&gt;</span>

        <span class="tag">&lt;conditional</span> <span class="attribute-name">expression</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">@assertThat('${shouldSleep}', 'anyOf(is(true), isEmptyString())')@</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;sleep</span> <span class="attribute-name">seconds</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/conditional&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> conditionalTest() {
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>, <span class="integer">5</span>);
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">shouldSleep</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">true</span>);

    conditional().when(<span class="string"><span class="delimiter">&quot;</span><span class="content">${index} = 5</span><span class="delimiter">&quot;</span></span>))
        .actions(
            sleep(<span class="integer">10000L</span>)
        );

    conditional().when(<span class="string"><span class="delimiter">&quot;</span><span class="content">${shouldSleep}</span><span class="delimiter">&quot;</span></span>))
        .actions(
            sleep(<span class="integer">10000L</span>)
        );

    conditional().when(<span class="string"><span class="delimiter">&quot;</span><span class="content">${shouldSleep}</span><span class="delimiter">&quot;</span></span>, anyOf(is(<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>), isEmptyString()))
        .actions(
            sleep(<span class="integer">10000L</span>)
        );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The nested sleep action is executed in case the variable ${index} is equal to the value '5'. This conditional execution of test actions is useful when dealing with different test environments such as different operating systems for instance. The conditional container also supports expressions that evaluate to the character sequence "true" or "false" as shown in the ${shouldSleep} example.</p>
</div>
<div class="paragraph">
<p>The last conditional container in the example above makes use of Hamcrest matchers. The matcher evaluates to <strong>true</strong> of <strong>false</strong> and based on that the container actions are executed or skipped. The Hamcrest matchers are very powerful when it comes to evaluation of multiple conditions at a time.</p>
</div>
</div>
<div class="sect2">
<h3 id="containers-parallel"><a class="anchor" href="#containers-parallel"></a><a class="link" href="#containers-parallel">16.3. Parallel</a></h3>
<div class="paragraph">
<p>Parallel containers execute the embedded test actions concurrent to each other. Every action in this container will be executed in a separate Java Thread. Following example should clarify the usage:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">parallelTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;parallel&gt;</span>
            <span class="tag">&lt;sleep</span><span class="tag">/&gt;</span>

            <span class="tag">&lt;sequential&gt;</span>
                <span class="tag">&lt;sleep</span><span class="tag">/&gt;</span>
                <span class="tag">&lt;echo&gt;</span>
                    <span class="tag">&lt;message&gt;</span>1<span class="tag">&lt;/message&gt;</span>
                <span class="tag">&lt;/echo&gt;</span>
            <span class="tag">&lt;/sequential&gt;</span>

            <span class="tag">&lt;echo&gt;</span>
                <span class="tag">&lt;message&gt;</span>2<span class="tag">&lt;/message&gt;</span>
            <span class="tag">&lt;/echo&gt;</span>

            <span class="tag">&lt;echo&gt;</span>
                <span class="tag">&lt;message&gt;</span>3<span class="tag">&lt;/message&gt;</span>
            <span class="tag">&lt;/echo&gt;</span>

            <span class="tag">&lt;iterate</span> <span class="attribute-name">condition</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">i lt= 5</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">index</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">i</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;echo&gt;</span>
                    <span class="tag">&lt;message&gt;</span>10<span class="tag">&lt;/message&gt;</span>
                <span class="tag">&lt;/echo&gt;</span>
            <span class="tag">&lt;/iterate&gt;</span>
        <span class="tag">&lt;/parallel&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> paralletTest() {
    parallel().actions(
        sleep(),
        sequential().actions(
            sleep(),
            echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>)
        ),
        echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>),
        echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span>),
        iterate().condition(<span class="string"><span class="delimiter">&quot;</span><span class="content">i lt= 5</span><span class="delimiter">&quot;</span></span>).index(<span class="string"><span class="delimiter">&quot;</span><span class="content">i</span><span class="delimiter">&quot;</span></span>))
            .actions(
                echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span>)
            )
    );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>So the normal test action processing would be to execute one action after another. As the first action is a sleep of five seconds, the whole test processing would stop and wait for 5 seconds. Things are different inside the parallel container. Here the descending test actions will not wait but execute at the same time.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that containers can easily wrap other containers. The example shows a simple combination of sequential and parallel containers that will archive a complex execution logic. Actions inside the sequential container will execute one after another. But actions in parallel will be executed at the same time.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="containers-iterate"><a class="anchor" href="#containers-iterate"></a><a class="link" href="#containers-iterate">16.4. Iterate</a></h3>
<div class="paragraph">
<p>Iterations are very powerful elements when describing complex logic. The container executes the embedded actions several times. The container will continue with looping as long as the defined breaking condition string evaluates to <strong><em>true</em></strong> . In case the condition evaluates to <strong><em>false</em></strong> the iteration will break an finish execution.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">iterateTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;iterate</span> <span class="attribute-name">index</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">i</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">condition</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">i lt 5</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;echo&gt;</span>
                <span class="tag">&lt;message&gt;</span>index is: ${i}<span class="tag">&lt;/message&gt;</span>
            <span class="tag">&lt;/echo&gt;</span>
        <span class="tag">&lt;/iterate&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> iterateTest() {
    iterate().condition(<span class="string"><span class="delimiter">&quot;</span><span class="content">i lt 5</span><span class="delimiter">&quot;</span></span>).index(<span class="string"><span class="delimiter">&quot;</span><span class="content">i</span><span class="delimiter">&quot;</span></span>))
        .actions(
            echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">index is: ${i}</span><span class="delimiter">&quot;</span></span>)
        );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The attribute "index" automatically defines a new variable that holds the actual loop index starting at "1". This index variable is available as a normal variable inside the iterate container. Therefore it is possible to print out the actual loop index in the echo action as shown in the above example.</p>
</div>
<div class="paragraph">
<p>The condition string is mandatory and describes the actual end of the loop. In iterate containers the loop will break in case the condition evaluates to <strong><em>false</em></strong> .</p>
</div>
<div class="paragraph">
<p>The condition string can be any Boolean expression and supports several operators:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
lt
</td>
<td class="hdlist2">
<p>lower than</p>
</td>
</tr>
<tr>
<td class="hdlist1">
lt=
</td>
<td class="hdlist2">
<p>lower than equals</p>
</td>
</tr>
<tr>
<td class="hdlist1">
gt
</td>
<td class="hdlist2">
<p>greater than</p>
</td>
</tr>
<tr>
<td class="hdlist1">
gt=
</td>
<td class="hdlist2">
<p>greater than equals</p>
</td>
</tr>
<tr>
<td class="hdlist1">
=
</td>
<td class="hdlist2">
<p>equals</p>
</td>
</tr>
<tr>
<td class="hdlist1">
and
</td>
<td class="hdlist2">
<p>logical combining of two Boolean values</p>
</td>
</tr>
<tr>
<td class="hdlist1">
or
</td>
<td class="hdlist2">
<p>logical combining of two Boolean values</p>
</td>
</tr>
<tr>
<td class="hdlist1">
()
</td>
<td class="hdlist2">
<p>brackets</p>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
It is very important to notice that the condition is evaluated before the very first iteration takes place. The loop therefore can be executed 0-n times according to the condition value.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now the boolean expression evaluation as described above is limited to very basic operation such as <strong>lower than</strong>, <strong>greater than</strong> and so on. We also can use Hamcrest matchers in conditions that are way more powerful than that.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">iterateTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;iterate</span> <span class="attribute-name">index</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">i</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">condition</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">@assertThat(lessThan(5))@</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;echo&gt;</span>
                <span class="tag">&lt;message&gt;</span>index is: ${i}<span class="tag">&lt;/message&gt;</span>
            <span class="tag">&lt;/echo&gt;</span>
        <span class="tag">&lt;/iterate&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> iterateTest() {
    iterate().condition(lessThan(<span class="integer">5</span>)).index(<span class="string"><span class="delimiter">&quot;</span><span class="content">i</span><span class="delimiter">&quot;</span></span>))
        .actions(
            echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">index is: ${i}</span><span class="delimiter">&quot;</span></span>)
        );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above we use Hamcrest matchers as condition. You can combine Hamcrest matchers and create very powerful condition evaluations here.</p>
</div>
</div>
<div class="sect2">
<h3 id="containers-repeat-until-true"><a class="anchor" href="#containers-repeat-until-true"></a><a class="link" href="#containers-repeat-until-true">16.5. Repeat until true</a></h3>
<div class="paragraph">
<p>Quite similar to the previously described iterate container this repeating container will execute its actions in a loop according to an ending condition. The condition describes a Boolean expression using the operators as described in the previous chapter.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The loop continues its work until the provided condition evaluates to <strong>true</strong> . It is very important to notice that the repeat loop will execute the actions before evaluating the condition. This means the actions get executed <code>n-1</code> times.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">iterateTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;repeat-until-true</span> <span class="attribute-name">index</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">i</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">condition</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">(i = 3) or (i = 5)</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;echo&gt;</span>
                <span class="tag">&lt;message&gt;</span>index is: ${i}<span class="tag">&lt;/message&gt;</span>
            <span class="tag">&lt;/echo&gt;</span>
        <span class="tag">&lt;/repeat-until-true&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> repeatTest() {
    repeat().until(<span class="string"><span class="delimiter">&quot;</span><span class="content">(i gt 5) or (i = 3)</span><span class="delimiter">&quot;</span></span>).index(<span class="string"><span class="delimiter">&quot;</span><span class="content">i</span><span class="delimiter">&quot;</span></span>))
        .actions(
            echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">index is: ${i}</span><span class="delimiter">&quot;</span></span>)
        );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the repeat container is only executed when the iterating condition expression evaluates to <strong>false</strong> . By the time the condition is <strong>true</strong> execution is discontinued. You can use basic logical operators such as <strong>and</strong>, <strong>or</strong> and so on.</p>
</div>
<div class="paragraph">
<p>A more powerful way is given by Hamcrest matchers that are directly supported in condition expressions.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">iterateTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;repeat-until-true</span> <span class="attribute-name">index</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">i</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">condition</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">@assertThat(anyOf(is(3), is(5))@</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;echo&gt;</span>
                <span class="tag">&lt;message&gt;</span>index is: ${i}<span class="tag">&lt;/message&gt;</span>
            <span class="tag">&lt;/echo&gt;</span>
        <span class="tag">&lt;/repeat-until-true&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> repeatTest() {
    repeat().until(anyOf(is(<span class="integer">3</span>), is(<span class="integer">5</span>)).index(<span class="string"><span class="delimiter">&quot;</span><span class="content">i</span><span class="delimiter">&quot;</span></span>))
        .actions(
            echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">index is: ${i}</span><span class="delimiter">&quot;</span></span>)
        );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Hamcrest matcher usage simplifies the reading a lot. And it empowers you to combine more complex condition expressions. So I personally prefer this syntax.</p>
</div>
</div>
<div class="sect2">
<h3 id="containers-repeat-on-error-until-true"><a class="anchor" href="#containers-repeat-on-error-until-true"></a><a class="link" href="#containers-repeat-on-error-until-true">16.6. Repeat on error until true</a></h3>
<div class="paragraph">
<p>The next looping container is called repeat-on-error-until-true. This container repeats a group of actions in case one embedded action failed with error. In case of an error inside the container the loop will try to execute <strong><em>all</em></strong> embedded actions again in order to seek for overall success. The execution continues until all embedded actions were processed successfully <strong><em>or</em></strong> the ending condition evaluates to true and the error-loop will lead to final failure.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">iterateTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;repeat-onerror-until-true</span> <span class="attribute-name">index</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">i</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">condition</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">i = 5</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;echo&gt;</span>
                <span class="tag">&lt;message&gt;</span>index is: ${i}<span class="tag">&lt;/message&gt;</span>
            <span class="tag">&lt;/echo&gt;</span>
            <span class="tag">&lt;fail</span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/repeat-onerror-until-true&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> repeatOnErrorTest() {
    repeatOnError(
        echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">index is: ${i}</span><span class="delimiter">&quot;</span></span>),
        fail(<span class="string"><span class="delimiter">&quot;</span><span class="content">Force loop to fail!</span><span class="delimiter">&quot;</span></span>)
    ).until(<span class="string"><span class="delimiter">&quot;</span><span class="content">i = 5</span><span class="delimiter">&quot;</span></span>).index(<span class="string"><span class="delimiter">&quot;</span><span class="content">i</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> repeatOnErrorTest() {
    repeatOnError().until(<span class="string"><span class="delimiter">&quot;</span><span class="content">i = 5</span><span class="delimiter">&quot;</span></span>).index(<span class="string"><span class="delimiter">&quot;</span><span class="content">i</span><span class="delimiter">&quot;</span></span>))
        .actions(
            echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">index is: ${i}</span><span class="delimiter">&quot;</span></span>),
            fail(<span class="string"><span class="delimiter">&quot;</span><span class="content">Force loop to fail!</span><span class="delimiter">&quot;</span></span>)
        );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the code example the error-loop continues four times as the &lt;fail&gt; action definitely fails the test. During the fifth iteration The condition "i=5" evaluates to true and the loop breaks its processing leading to a final failure as the test actions were not successful.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The overall success of the test case depends on the error situation inside the repeat-onerror-until-true container. In case the loop breaks because of failing actions and the loop will discontinue its work the whole test case is failing too. The error loop processing is successful in case all embedded actions were not raising any errors during an iteration.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The repeat-on-error container also offers an automatic sleep mechanism. This auto-sleep property will force the container to wait a given amount of time before executing the next iteration. We used this mechanism a lot when validating database entries. Let&#8217;s say we want to check the existence of an order entry in the database. Unfortunately the system under test is not very well performing and may need some time to store the new order. This amount of time is not predictable, especially when dealing with different hardware on our test environments (local testing vs. server testing). Following from that our test case may fail unpredictable only because of runtime conditions.</p>
</div>
<div class="paragraph">
<p>We can avoid unstable test cases that are based on these runtime conditions with the auto-sleep functionality.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;repeat-onerror-until-true</span> <span class="attribute-name">auto-sleep</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">condition</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">i = 5</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">index</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">i</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;echo&gt;</span>
        <span class="tag">&lt;sql</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;statement&gt;</span>
              SELECT COUNT(1) AS CNT_ORDERS
              FROM ORDERS
              WHERE CUSTOMER_ID='${customerId}'
            <span class="tag">&lt;/statement&gt;</span>
            <span class="tag">&lt;validate</span> <span class="attribute-name">column</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CNT_ORDERS</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/sql&gt;</span>
    <span class="tag">&lt;/echo&gt;</span>
<span class="tag">&lt;/repeat-onerror-until-true&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> repeatOnErrorTest() {
    repeatOnError().until(<span class="string"><span class="delimiter">&quot;</span><span class="content">i = 5</span><span class="delimiter">&quot;</span></span>).index(<span class="string"><span class="delimiter">&quot;</span><span class="content">i</span><span class="delimiter">&quot;</span></span>).autoSleep(<span class="integer">1000</span>))
        .actions(
            query(action -&gt; action.dataSource(testDataSource)
                .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT COUNT(1) AS CNT_ORDERS FROM ORDERS WHERE CUSTOMER_ID='${customerId}'</span><span class="delimiter">&quot;</span></span>)
                .validate(<span class="string"><span class="delimiter">&quot;</span><span class="content">CNT_ORDERS</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>))
        );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We surrounded the database check with a repeat-onerror container having the auto-sleep property set to 1000 milliseconds. The repeat container will try to check the database up to five times with an automatic sleep of 1 second before every iteration. This gives the system under test up to five seconds time to store the new entry to the database. The test case is very stable and just fits to the hardware environment. On slow test environments the test may need several iterations to successfully read the database entry. On very fast environments the test may succeed right on the first try.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
We changed auto sleep time from seconds to milliseconds with Citrus 2.0 release. So if you are coming from previous Citrus versions be sure to now use proper millisecond values.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>So fast environments are not slowed down by static sleep operations and slower environments are still able to execute this test case with high stability.</p>
</div>
</div>
<div class="sect2">
<h3 id="containers-timer"><a class="anchor" href="#containers-timer"></a><a class="link" href="#containers-timer">16.7. Timer</a></h3>
<div class="paragraph">
<p>Timers are very useful containers when you wish to execute a collection of test actions several times at regular intervals. The timer component generates an event which in turn triggers the execution of the nested test actions associated with timer. This can be useful in a number of test scenarios for example when Citrus needs to simulate a heart beat or if you are debugging a test and you wist to query the contents of the database, to mention just a few. The following code sample should demonstrate the power and flexibility of timers:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">timerTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;timer</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">forkedTimer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">fork</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;echo&gt;</span>
            <span class="tag">&lt;message&gt;</span>I'm going to run in the background and let some other test actions run (nested action run ${forkedTimer-index} times)<span class="tag">&lt;/message&gt;</span>
          <span class="tag">&lt;/echo&gt;</span>
          <span class="tag">&lt;sleep</span> <span class="attribute-name">milliseconds</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">50</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;/timer&gt;</span>

        <span class="tag">&lt;timer</span> <span class="attribute-name">repeatCount</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">delay</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">50</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;sleep</span> <span class="attribute-name">milliseconds</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">50</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
          <span class="tag">&lt;echo&gt;</span>
            <span class="tag">&lt;message&gt;</span>I'm going to repeat this message 3 times before the next test actions are executed<span class="tag">&lt;/message&gt;</span>
          <span class="tag">&lt;/echo&gt;</span>
        <span class="tag">&lt;/timer&gt;</span>

        <span class="tag">&lt;echo&gt;</span>
          <span class="tag">&lt;message&gt;</span>Test almost complete. Make sure all timers running in the background are stopped<span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/echo&gt;</span>
      <span class="tag">&lt;/actions&gt;</span>
      <span class="tag">&lt;finally&gt;</span>
        <span class="tag">&lt;stop-timer</span> <span class="attribute-name">timerId</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">forkedTimer</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;/finally&gt;</span>
    <span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> timerTest() {

    timer()
        .timerId(<span class="string"><span class="delimiter">&quot;</span><span class="content">forkedTimer</span><span class="delimiter">&quot;</span></span>)
        .interval(<span class="integer">100L</span>)
        .fork(<span class="predefined-constant">true</span>)
        .actions(
            echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">I'm going to run in the background and let some other test actions run (nested action run ${forkedTimer-index} times)</span><span class="delimiter">&quot;</span></span>),
            sleep(<span class="integer">50L</span>)
        );

    timer()
        .repeatCount(<span class="integer">3</span>)
        .interval(<span class="integer">100L</span>)
        .delay(<span class="integer">50L</span>)
        .actions(
            sleep(<span class="integer">50L</span>),
            echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">I'm going to repeat this message 3 times before the next test actions are executed</span><span class="delimiter">&quot;</span></span>)
        );

    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Test almost complete. Make sure all timers running in the background are stopped</span><span class="delimiter">&quot;</span></span>);

    doFinally().actions(
        stopTimer(<span class="string"><span class="delimiter">&quot;</span><span class="content">forkedTimer</span><span class="delimiter">&quot;</span></span>)
    );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example the first timer (timerId = forkedTimer) is started in the background. By default timers are run in the current thread of execution but to start it in the background just use "fork=true". Every 100 milliseconds this timer emits an event which will result in the nested actions being executed. The nested 'echo' action outputs the number of times this timer has already been executed. It does this with the help of an 'index' variable, in this example ${forkedTimer-index}, which is named according to the timer <strong>id</strong> with the suffix '-index'. No limit is set on the number of times this timer should run so it will keep on running until either a nested test action fails or it is instructed to stop (more on this below).</p>
</div>
<div class="paragraph">
<p>The second timer is configured to run 3 times with a delay of 100 milliseconds between each iteration. Using the attribute 'delay' we can get the timer pause for 50 milliseconds before running the nested actions for the first time. The timer is configured to run in the current thread of execution so the last test action, the 'echo', has to wait for this timer to complete before it is executed.</p>
</div>
<div class="paragraph">
<p>So how do we tell the forked timer to stop running? If we forget to do this the timer will just execute indefinitely. To help us out here we can use the 'stop-timer' action. By adding this to the finally block we ensure that the timer will be stopped, even if some nested test action fails. We could have easily added it as a nested test action, to the forkedTimer for example, but if some other test action failed before the stop-timer was called, the timer would never stop.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can also configure timers to run in the background using the 'parallel' container, rather than setting the attribute 'fork' to true. Using parallel allows more fine-grained control of the test and has the added advantage that all errors generated from a nester timer action are visible to the test executer. If an error occurs within the timer then the test status is set to failed. Using fork=true an error causes the timer to stop executing, but the test status is not influenced by this error.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="containers-custom"><a class="anchor" href="#containers-custom"></a><a class="link" href="#containers-custom">16.8. Custom containers</a></h3>
<div class="paragraph">
<p>In case you have a custom action container implementation you might also want to use it in Java DSL. The action containers are handled with special care in the Java DSL because they have nested actions. So when you call a test action container in the Java DSL you always have something like this:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> containerTest() {
    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">This echo is outside of the action container</span><span class="delimiter">&quot;</span></span>);

    sequential()
        .actions(
            echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Inside</span><span class="delimiter">&quot;</span></span>),
            echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Inside once more</span><span class="delimiter">&quot;</span></span>),
            echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">And again: Inside!</span><span class="delimiter">&quot;</span></span>)
        );

    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">This echo is outside of the action container</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the three nested actions are added to the action <strong>sequential</strong> container rather than to the test case itself although we are using the same action Java DSL methods as outside the container. This mechanism is only working because Citrus is handling test action containers with special care.</p>
</div>
<div class="paragraph">
<p>A custom test action container implementation could look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">public class ReverseActionContainer extends AbstractActionContainer {
    @Override
    public void doExecute(TestContext context) {
        for (int i = getActions().size(); i <span class="error">&gt;</span> 0; i--) {
            getActions().get(i-1).execute(context);
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The container logic is very simple: The container executes the nested actions in reverse order. As already mentioned Citrus needs to take special care on all action containers when executing a Java DSL test. This is why you should not execute a custom test container implementation on your own.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">@CitrusTest
public void containerTest() {
    ReverseActionContainer reverseContainer = new ReverseActionContainer();
    reverseContainer.addTestAction(new EchoAction().setMessage(&quot;Foo&quot;));
    reverseContainer.addTestAction(new EchoAction().setMessage(&quot;Bar&quot;));
    run(reverseContainer);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above custom container execution is going to fail with internal error as the Citrus Java DSL was not able to recognise the action container as it should be. Also the <strong>EchoAction</strong> instance creation is not very comfortable. Instead you can use a special container Java DSL syntax also with your custom container implementation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">@CitrusTest
public void containerTest() {
    container(new ReverseActionContainer()).actions(
        echo(&quot;Foo&quot;),
        echo(&quot;Bar&quot;)
    );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The custom container implementation now works fine with the automatically nested echo actions. And we are able to use the usual Java DSL syntactic sugar for test actions like <strong>echo</strong> .</p>
</div>
<div class="paragraph">
<p>In a next step we add a custom superclass for all our test classes which provides a helper method for the custom container implementation in order to have a even more comfortable syntax.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CustomCitrusBaseTest</span> <span class="directive">extends</span> TestNGCitrusTestDesigner {

    <span class="directive">public</span> AbstractTestContainerBuilder&lt;ReverseActionContainer&gt; reverse() {
        <span class="keyword">return</span> container(<span class="keyword">new</span> ReverseActionContainer());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now all subclasses can use the new <strong>reverse</strong> method for calling the custom container implementation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">@CitrusTest
public void containerTest() {
    reverse().actions(
        echo(&quot;Foo&quot;),
        echo(&quot;Bar&quot;)
    );
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Nice! This is how we should integrate customized test action containers to the Citrus Java DSL.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jms"><a class="anchor" href="#jms"></a><a class="link" href="#jms">17. JMS support</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Citrus provides support for sending and receiving JMS messages. We have to separate between synchronous and asynchronous communication. So in this chapter we explain how to setup JMS message endpoints for synchronous and asynchronous outbound and inbound communication</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The JMS components in Citrus are kept in a separate Maven module. If not already done so you have to include the module as Maven dependency to your project
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>com.consol.citrus<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>citrus-jms<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>2.7.3<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus provides a "citrus-jms" configuration namespace and schema definition for JMS related components and features. Include this namespace into your Spring configuration in order to use the Citrus JMS configuration elements. The namespace URI and schema location are added to the Spring configuration XML file as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:citrus-jms</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/jms/config</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
       <span class="content">http://www.springframework.org/schema/beans</span>
       <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
       <span class="content">http://www.citrusframework.org/schema/jms/config</span>
       <span class="content">http://www.citrusframework.org/schema/jms/config/citrus-jms-config.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    [...]

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After that you are able to use customized Citrus XML elements in order to define the Spring beans.</p>
</div>
<div class="sect2">
<h3 id="jms-endpoints"><a class="anchor" href="#jms-endpoints"></a><a class="link" href="#jms-endpoints">17.1. JMS endpoints</a></h3>
<div class="paragraph">
<p>By default Citrus JMS endpoints are asynchronous. So let us first of all deal with asynchronous messaging which means that we will not wait for any response message after sending or receiving a message.</p>
</div>
<div class="paragraph">
<p>The test case itself should not know about JMS transport details like queue names or connection credentials. This information is stored in the endpoint component configuration that lives in the basic Spring configuration file in Citrus. So let us have a look at a simple JMS message endpoint configuration in Citrus.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-jms:endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceQueueEndpoint</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">destination-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Citrus.HelloService.Request.Queue</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The endpoint component receives an unique id and a JMS destination name. This can be a queue or topic destination. We will deal with JMS topics later on. For now the timeout setting completes our first JMS endpoint component definition.</p>
</div>
<div class="paragraph">
<p>The endpoint needs a JMS connection factory for connecting to a JMS message broker. The connection factory is also added as Spring bean to the Citrus Spring application context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.activemq.ActiveMQConnectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">brokerURL</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tcp://localhost:61616</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The JMS connection factory receives the JMS message broker URL and is able to hold many other connection specific options. In this example we use the Apache ActiveMQ connection factory implementation as we want to use the ActiveMQ message broker. Citrus works by default with a bean id <strong>connectionFactory</strong> . All Citrus JMS component will automatically recognize this connection factory.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Spring makes it very easy to connect to other JMS broker implementations too (e.g. Apache ActiveMQ, TIBCO Enterprise Messaging Service, IBM Websphere MQ). Just add the required connection factory implementation as <strong>connectionFactory</strong> bean.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All of the Citrus JMS endpoint components will automatically look for a bean named <strong>connectionFactory</strong> by default. You can use the <strong>connection-factory</strong> endpoint attribute in order to use another connection factory instance with different bean names.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-jms:endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceQueueEndpoint</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">destination-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Citrus.HelloService.Request.Queue</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">connection-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myConnectionFacotry</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As an alternative to that you may want to use a special Spring jms template implementation as custom bean in your endpoint.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-jms:endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceQueueEndpoint</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">destination-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Citrus.HelloService.Request.Queue</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">jms-template</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myJmsTemplate</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The endpoint is now ready to be used inside a test case. Inside a test case you can send or receive messages using this endpoint. The test actions can reference the JMS endpoint using its identifier. When sending a message the message endpoint creates a JMS message producer and will simply publish the message to the defined JMS destination. As the communication is asynchronous by default producer does not wait for a synchronous response.</p>
</div>
<div class="paragraph">
<p>When receiving a messages with this endpoint the endpoint creates a JMS consumer on the JMS destination. The endpoint then acts as a message driven listener. This means that the message consumer connects to the given destination and waits for messages to arrive.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Besides the destination-name attribute you can also provide a reference to a destination implementation.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-jms:endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceQueueEndpoint</span><span class="delimiter">&quot;</span></span>
                                <span class="attribute-name">destination</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceQueue</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;amq:queue</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceQueue</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">physicalName</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Citrus.HelloService.Request.Queue</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The destination attribute references to a JMS destination object in the Spring application context. In the example above we used the ActiveMQ queue destination component. The destination reference can also refer to a JNDI lookup for instance.</p>
</div>
</div>
<div class="sect2">
<h3 id="jms-synchronous-endpoints"><a class="anchor" href="#jms-synchronous-endpoints"></a><a class="link" href="#jms-synchronous-endpoints">17.2. JMS synchronous endpoints</a></h3>
<div class="paragraph">
<p>When using synchronous message endpoints Citrus will manage a reply destination for receiving a synchronous response message on the reply destination. The following figure illustrates that we now have two destinations in our communication scenario.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/figure_006.jpg" alt="figure_006.jpg"></span></p>
</div>
<div class="paragraph">
<p>The synchronous message endpoint component is similar to the asynchronous brother that we have discussed before. The only difference is that the endpoint will automatically manage a reply destination behind the scenes. By default Citrus uses temporary reply destinations that get automatically deleted after the communication handshake is done. Again we need to use a JMS connection factory in the Spring XML configuration as the component need to connect to a JMS message broker.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-jms:sync-endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceSyncEndpoint</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">destination-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Citrus.HelloService.InOut.Queue</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The synchronous component defines a target destination which again is either a queue or topic destination. If nothing else is defined the endpoint will create temporary reply destinations on its own. When the endpoint has sent a message it waits synchronously for the response message to arrive on the reply destination. You can receive this reply message in your test case by referencing this same endpoint in a receive test action. In case no reply message arrives in time a message timeout error is raised respectively.</p>
</div>
<div class="paragraph">
<p>See the following example test case which references the synchronous message endpoint in its send and receive test action in order to send out a message and wait for the synchronous response.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">synchronousMessagingTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceSyncEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;message&gt;</span>
                <span class="tag">&lt;data&gt;</span>
                  [...]
                <span class="tag">&lt;/data&gt;</span>
            <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/send&gt;</span>

        <span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceSyncEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;message&gt;</span>
                <span class="tag">&lt;data&gt;</span>
                  [...]
                <span class="tag">&lt;/data&gt;</span>
            <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/receive&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We initiated the synchronous communication by sending a message on the synchronous endpoint. The second step then receives the synchronous message on the temporary reply destination that was automatically created for us.</p>
</div>
<div class="paragraph">
<p>If you rather want to define a static reply destination you can do so, too. The static reply destination is not deleted after communication handshake. You may need to work with message selectors then in order to pick the right response message that belongs to a specific communication handshake. You can define a static reply destination on the synchronous endpoint component as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-jms:sync-endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceSyncEndpoint</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">destination-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Citrus.HelloService.InOut.Queue</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">reply-destination-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Citrus.HelloService.Reply.Queue</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of using the <strong>reply-destination-name</strong> feel free to use the destination reference with <strong>reply-destination</strong> attribute. Again you can use a JNDI lookup then to reference a destination object.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Be aware of permissions that are mandatory for creating temporary destinations. Citrus tries to create temporary queues on the JMS message broker. Following from that the Citrus JMS user has to have the permission to do so. Be sure that the user has the sufficient rights when using temporary reply destinations.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Up to now we have sent a message and waited for a synchronous response in the next step. Now it is also possible to switch the directions of send and receive actions. Then we have the situation where Citrus receives a JMS message first and then Citrus is in charge of providing a proper synchronous response message to the initial sender.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/figure_007.jpg" alt="figure_007.jpg"></span></p>
</div>
<div class="paragraph">
<p>In this scenario the foreign message producer has stored a dynamic JMS reply queue destination to the JMS header. So Citrus has to send the reply message to this specific reply destination, which is dynamic of course. Fortunately the heavy lift is done with the JMS message endpoint and we do not have to change anything in our configuration. Again we just define a synchronous message endpoint in the application context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-jms:sync-endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceSyncEndpoint</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">destination-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Citrus.HelloService.InOut.Queue</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the only thing that changes here is that we first receive a message in our test case on this endpoint. The second step is a send message action that references this same endpoint and we are done. Citrus automatically manages the reply destinations for us.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">synchronousMessagingTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceSyncEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;message&gt;</span>
                <span class="tag">&lt;data&gt;</span>
                  [...]
                <span class="tag">&lt;/data&gt;</span>
            <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/receive&gt;</span>

        <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceSyncEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;message&gt;</span>
                <span class="tag">&lt;data&gt;</span>
                  [...]
                <span class="tag">&lt;/data&gt;</span>
            <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/send&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jms-topics"><a class="anchor" href="#jms-topics"></a><a class="link" href="#jms-topics">17.3. JMS topics</a></h3>
<div class="paragraph">
<p>Up to now we have used JMS queue destinations on our endpoints. Citrus is also able to connect to JMS topic destinations. In contrary to JMS queues which represents the <strong>point-to-point</strong> communication JMS topics use <strong>publish-subscribe</strong> mechanism in order to spread messages over JMS. A JMS topic producer publishes messages to the topic, while the topic accepts multiple message subscriptions and delivers the message to all subscribers.</p>
</div>
<div class="paragraph">
<p>The Citrus JMS endpoints offer the attribute <strong>'pub-sub-domain'</strong> . Once this attribute is set to <strong>true</strong> Citrus will use JMS topics instead of queue destinations. See the following example where the publish-subscribe attribute is set to true in JMS message endpoint components.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-jms:endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceQueueEndpoint</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">destination</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceQueue</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">pub-sub-domain</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When using JMS topics you will be able to subscribe several test actions to the topic destination and receive a message multiple times as all subscribers will receive the message.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
It is very important to keep in mind that Citrus does not deal with durable subscribers. This means that messages that were sent in advance to the message subscription are not delivered to the message endpoint. So racing conditions may cause problems when using JMS topic endpoints in Citrus. Be sure to let Citrus subscribe to the topic before messages are sent to it. Otherwise you may loose some messages that were sent in advance to the subscription.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="jms-message-headers"><a class="anchor" href="#jms-message-headers"></a><a class="link" href="#jms-message-headers">17.4. JMS message headers</a></h3>
<div class="paragraph">
<p>The JMS specification defines a set of special message header entries that can go into your JMS message. These JMS headers are stored differently in a JMS message header than other custom header entries do. Therefore these special header values should be set in a special syntax that we discuss in the next paragraphs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;header&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_jms_correlationId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${correlationId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_jms_messageId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_jms_redelivered</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${redelivered}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_jms_timestamp</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${timestamp}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/header&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you see all JMS specific message headers use the <code>citrus_jms_</code> prefix. This prefix comes from Spring Integration message header mappers that take care of setting those headers in the JMS message header properly.</p>
</div>
<div class="paragraph">
<p>Typing of message header entries may also be of interest in order to meet the JMS standards of typed message headers. For instance the following message header is of type double and is therefore transferred via JMS as a double value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;header&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">amount</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">19.75</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">double</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/header&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dynamic-destination-names"><a class="anchor" href="#dynamic-destination-names"></a><a class="link" href="#dynamic-destination-names">17.5. Dynamic destination names</a></h3>
<div class="paragraph">
<p>Usually you set the target destination as property on the JMS endpoint component. In some cases it might be useful to set the target destination in a more dynamic way during the test run. You can do this
by adding a special message header named <strong>citrus_jms_destination_name</strong>. This header is automatically interpreted by the Citrus JMS endpoint and is set as the target destination before a message is sent.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        ...
    <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;header&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_jms_destination_name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dynamic.destination.name</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This action above will send the message to the destination "<em>dynamic.destination.name</em>" no matter what default destination is set on the referenced endpoint component named <em>jmsEndpoint</em>. The dynamic destination name setting also supports test variables so you
can use variables and functions in the destination name, too.</p>
</div>
<div class="paragraph">
<p>Another possibility for dynamic JMS destinations is given with the <a href="#dynamic-endpoint-components">dynamic endpoints</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="soap-over-jms"><a class="anchor" href="#soap-over-jms"></a><a class="link" href="#soap-over-jms">17.6. SOAP over JMS</a></h3>
<div class="paragraph">
<p>When sending SOAP messages you have to deal with proper envelope, body and header construction. In Citrus you can add a special message converter that performs the heavy lift for you. Just add the message converter to the JMS endpoint as shown in the next program listing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-jms:endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceSoapJmsEndpoint</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">destination-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Citrus.HelloService.Request.Queue</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">message-converter</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapJmsMessageConverter</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapJmsMessageConverter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.jms.message.SoapJmsMessageConverter</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With this message converter you can skip the SOAP envelope completely in your test case. You just deal with the message body payload and the header entries. The rest is done by the message converter. So you get proper SOAP messages on the producer and consumer side.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="http-rest"><a class="anchor" href="#http-rest"></a><a class="link" href="#http-rest">18. HTTP REST support</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>REST APIs have gained more and more significance regarding client-server interfaces. The REST client is nothing but a HTTP client sending HTTP requests usually in JSON data format to a HTTP server. As HTTP is a synchronous protocol by nature the client receives the server response synchronously. Citrus is able to connect with HTTP services and test REST APIs on both client and server side with a powerful JSON message data support. In the next sections you will learn how to invoke HTTP services as a client and how to handle REST HTTP requests in a test case. We deal with setting up a HTTP server in order to accept client requests and provide proper HTTP responses with GET, PUT, DELETE or POST request method.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The http components in Citrus are kept in a separate Maven module. So you should add the module as Maven dependency to your project accordingly.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>com.consol.citrus<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>citrus-http<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>2.7.3<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As Citrus provides a customized HTTP configuration schema for the Spring application context configuration files we have to add name to the top level <strong>beans</strong> element. Simply include the http-config namespace in the configuration XML files as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">xmlns:citrus</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/config</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">xmlns:citrus-http</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/http/config</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
   <span class="content">http://www.springframework.org/schema/beans</span>
   <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
   <span class="content">http://www.citrusframework.org/schema/config</span>
   <span class="content">http://www.citrusframework.org/schema/config/citrus-config.xsd</span>
   <span class="content">http://www.citrusframework.org/schema/http/config</span>
   <span class="content">http://www.citrusframework.org/schema/http/config/citrus-http-config.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    [...]

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we are ready to use the customized Citrus HTTP configuration elements with the citrus-http namespace prefix.</p>
</div>
<div class="sect2">
<h3 id="http-rest-client"><a class="anchor" href="#http-rest-client"></a><a class="link" href="#http-rest-client">18.1. HTTP REST client</a></h3>
<div class="paragraph">
<p>On the client side we have a simple HTTP message client component connecting to the server. The <strong>request-url</strong> attribute defines the HTTP server endpoint URL to connect to. As usual you can reference this client in your test case in order to send and receive messages. Citrus as client waits for the response message from server. After that the response message goes through the validation process as usual. Let us see how a Citrus HTTP client component looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-http:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloHttpClient</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">request-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/hello</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">request-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GET</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">content-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/xml</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">charset</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">60000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>request-method</strong> defines the HTTP method to use. In addition to that we can specify the content-type of the request we are about to send. The charset is also added to the content-type header. In case you do not want to set the charset at all please specify an empty string as the default value is <em>UTF-8</em>.
The client builds the HTTP request and sends it to the HTTP server. While the client is waiting for the synchronous HTTP response to arrive we are able to poll several times for the response message in our test case. As usual aou can use the same client endpoint in your test case to send and receive messages synchronously. In case the reply message comes in too late according to the timeout settings a respective timeout error is raised.</p>
</div>
<div class="paragraph">
<p>Http defines several request methods that a client can use to access Http server resources. In the example client above we are using <strong>GET</strong> as default request method. Of course you can overwrite this setting in a test case action by setting the HTTP request method inside the sending test action. The Http client component can be used as normal endpoint in a sending test action. Use something like this in your test:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloHttpClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;TestMessage&gt;</span>
                <span class="tag">&lt;Text&gt;</span>Hello HttpServer<span class="tag">&lt;/Text&gt;</span>
            <span class="tag">&lt;/TestMessage&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;header&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_http_method</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">POST</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Citrus uses the Spring REST template mechanism for sending out HTTP requests. This means you have great customizing opportunities with a special REST template configuration. You can think of basic HTTP authentication, read timeouts and special message factory implementations. Just use the custom REST template attribute in client configuration like this:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-http:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloHttpClient</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">request-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/hello</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">request-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GET</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">content-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">rest-template</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customizedRestTemplate</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="comment">&lt;!-- Customized rest template --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customizedRestTemplate</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.web.client.RestTemplate</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageConverters</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;util:list</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">converter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.http.converter.StringHttpMessageConverter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">supportedMediaTypes</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;util:list</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">types</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;value&gt;</span>text/plain<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;/util:list&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
      <span class="tag">&lt;/bean&gt;</span>
    <span class="tag">&lt;/util:list&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">errorHandler</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="comment">&lt;!-- Custom error handler --&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">requestFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.http.client.HttpComponentsClientHttpRequestFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">readTimeout</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">9000</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Up to now we have used a normal <strong>send</strong> test action to send Http requests as a client. This is completely valid strategy as the Citrus Http client is a normal endpoint. But we might want to set some more Http REST specific properties and settings. In order to simplify the Http usage in a test case we can use a special test action implementation. The Citrus Http specific actions are located in a separate XML namespace. So wen need to add this namespace to our test case XML first.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:http</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/http/testcase</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
        <span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content">http://www.citrusframework.org/schema/http/testcase</span>
        <span class="content">http://www.citrusframework.org/schema/http/testcase/citrus-http-testcase.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

      [...]

    <span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The test case is now ready to use the specific Http test actions by using the prefix <strong>http:</strong> .</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http:send-request</span> <span class="attribute-name">client</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;http:POST</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/customer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;http:headers</span> <span class="attribute-name">content-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/xml</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">accept</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/xml, */*</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">X-CustomHeaderId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${custom_header_id}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/http:headers&gt;</span>
    <span class="tag">&lt;http:body&gt;</span>
      <span class="tag">&lt;http:data&gt;</span>
        <span class="inline-delimiter">&lt;![CDATA[</span>
          &lt;customer&gt;
            &lt;id&gt;citrus:randomNumber()&lt;/id&gt;
            &lt;name&gt;testuser&lt;/name&gt;
          &lt;/customer&gt;
        <span class="inline-delimiter">]]&gt;</span>
      <span class="tag">&lt;/http:data&gt;</span>
    <span class="tag">&lt;/http:body&gt;</span>
  <span class="tag">&lt;/http:POST&gt;</span>
<span class="tag">&lt;/http:send-request&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The action above uses several Http specific settings such as the request method <strong>POST</strong> as well as the <strong>content-type</strong> and <strong>accept</strong> headers. As usual the send action needs a target Http client endpoint component. We can specify a request <strong>path</strong> attribute that added as relative path to the base uri used on the client.</p>
</div>
<div class="paragraph">
<p>When using a <strong>GET</strong> request we can specify some request uri parameters.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http:send-request</span> <span class="attribute-name">client</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;http:GET</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/customer/${custom_header_id}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;http:params</span> <span class="attribute-name">content-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/xml</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">accept</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/xml, */*</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;http:param</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">active</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/http:params&gt;</span>
  <span class="tag">&lt;/http:GET&gt;</span>
<span class="tag">&lt;/http:send-request&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The send action above uses a <strong>GET</strong> request on the endpoint uri <code><a href="http://localhost:8080/customer/1234?type=active" class="bare">http://localhost:8080/customer/1234?type=active</a></code>.</p>
</div>
<div class="paragraph">
<p>Of course when sending Http client requests we are also interested in receiving Http response messages. We want to validate the success response with Http status code.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http:receive-response</span> <span class="attribute-name">client</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;http:headers</span> <span class="attribute-name">status</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">200</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">reason-phrase</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OK</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP/1.1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">X-CustomHeaderId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${custom_header_id}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/http:headers&gt;</span>
  <span class="tag">&lt;http:body&gt;</span>
    <span class="tag">&lt;http:data&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
          &lt;customerResponse&gt;
            &lt;success&gt;true&lt;/success&gt;
          &lt;/customerResponse&gt;
      <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/http:data&gt;</span>
  <span class="tag">&lt;/http:body&gt;</span>
<span class="tag">&lt;/http:receive-response&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>receive-response</strong> test action also uses a client component. We can expect response status code information such as <strong>status</strong> and <strong>reason-phrase</strong> . Of course Citrus will raise a validation exception in case Http status codes mismatch.</p>
</div>
<div class="paragraph">
<p>Up to now we have used XML DSL test cases. The Java DSL in Citrus also works with specific Http test actions. See following example and find out how this works:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">@CitrusTest
public void httpActionTest() {
    http().client(&quot;httpClient&quot;)
          .send()
          .post(&quot;/customer&quot;)
          .payload(&quot;<span class="tag">&lt;customer&gt;</span>&quot; +
                    &quot;<span class="tag">&lt;id&gt;</span>citrus:randomNumber()<span class="tag">&lt;/id&gt;</span>&quot; +
                    &quot;<span class="tag">&lt;name&gt;</span>testuser<span class="tag">&lt;/name&gt;</span>&quot; +
                  &quot;<span class="tag">&lt;/customer&gt;</span>&quot;)
          .header(&quot;X-CustomHeaderId&quot;, &quot;${custom_header_id}&quot;)
          .contentType(&quot;text/xml&quot;)
          .accept(&quot;text/xml, */*&quot;);

    http().client(&quot;httpClient&quot;)
          .receive()
          .response(HttpStatus.OK)
          .payload(&quot;<span class="tag">&lt;customerResponse&gt;</span>&quot; +
                    &quot;<span class="tag">&lt;success&gt;</span>true<span class="tag">&lt;/success&gt;</span>&quot; +
                  &quot;<span class="tag">&lt;/customerResponse&gt;</span>&quot;)
          .header(&quot;X-CustomHeaderId&quot;, &quot;${custom_header_id}&quot;)
          .version(&quot;HTTP/1.1&quot;);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is one more setting on the client to be aware of. By default the client component will add the <strong>Accept</strong> http header and set its value to a list of all supported encodings on the host operating system. As
this list can get very long you may want to not set this default accept header. The setting is done in the Spring RestTemplate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customizedRestTemplate</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.web.client.RestTemplate</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageConverters</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;util:list</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">converter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.http.converter.StringHttpMessageConverter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">writeAcceptCharset</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/bean&gt;</span>
        <span class="tag">&lt;/util:list&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You would have add this custom RestTemplate configuration and set it to the client component with <strong>rest-template</strong> property. But fortunately the Citrus client component provides a separate setting <strong>default-accept-header</strong> which
is a Boolean setting. By default it is set to <strong>true</strong> so the default accept header is automatically added to all requests. If you set this flag to <strong>false</strong> the header is not set:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-http:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloHttpClient</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">request-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/hello</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">request-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GET</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">content-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>
                   <span class="attribute-name">default-accept-header</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course you can set the <strong>Accept</strong> header on each send operation in order to tell the server what kind of content types are supported in response messages.</p>
</div>
<div class="paragraph">
<p>Now we can send and receive messages as Http client with specific test actions. Now lets move on to the Http server.</p>
</div>
</div>
<div class="sect2">
<h3 id="http-client-interceptors"><a class="anchor" href="#http-client-interceptors"></a><a class="link" href="#http-client-interceptors">18.2. HTTP client interceptors</a></h3>
<div class="paragraph">
<p>The client component is able to add custom interceptors that participate in the request/response processing. The interceptors need to implement the common interface <strong>org.springframework.http.client.ClientHttpRequestInterceptor</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-http:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloHttpClient</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">request-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/hello</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">request-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GET</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">interceptors</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">clientInterceptors</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;util:list</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">clientInterceptors</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.http.interceptor.LoggingClientInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/util:list&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The sample above adds the Citrus logging client interceptor that logs requests and responses exchanged with that client component. You can add custom interceptor implementations here in order
to participate in the request/response message processing.</p>
</div>
</div>
<div class="sect2">
<h3 id="http-rest-server"><a class="anchor" href="#http-rest-server"></a><a class="link" href="#http-rest-server">18.3. HTTP REST server</a></h3>
<div class="paragraph">
<p>The HTTP client was quite easy and straight forward. Receiving HTTP messages is a little bit more complicated because Citrus has to provide server functionality listening on a local port for client connections. Therefore Citrus offers an embedded HTTP server which is capable of handling incoming HTTP requests. Once a client connection is accepted the HTTP server must also provide a proper HTTP response to the client. In the next few lines you will see how to simulate server side HTTP REST service with Citrus.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-http:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloHttpServer</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8080</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">auto-start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">resource-base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">src/it/resources</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus uses an embedded Jetty server that will automatically start when the Spring application context is loaded (auto-start="true"). The basic connector is listening on port <strong>8080</strong> for requests. Test cases can interact with this server instance via message channels by default. The server provides an inbound channel that holds incoming request messages. The test case can receive those requests from the channel with a normal receive test action. In a second step the test case can provide a synchronous response message as reply which will be automatically sent back to the HTTP client as response.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/figure_008.jpg" alt="figure_008.jpg"></span></p>
</div>
<div class="paragraph">
<p>The figure above shows the basic setup with inbound channel and reply channel. You as a tester should not worry about this to much. By default you as a tester just use the server as synchronous endpoint in your test case. This means that you simply receive a message from the server and send a response back.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpServerTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloHttpServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;message&gt;</span>
                <span class="tag">&lt;data&gt;</span>
                  [...]
                <span class="tag">&lt;/data&gt;</span>
            <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/receive&gt;</span>

        <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloHttpServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;message&gt;</span>
                <span class="tag">&lt;data&gt;</span>
                  [...]
                <span class="tag">&lt;/data&gt;</span>
            <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/send&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see we reference the server id in both receive and send actions. The Citrus server instance will automatically send the response back to the calling HTTP client. In most cases this is exactly what we want to do - send back a response message that is specified inside the test. The HTTP server component by default uses a channel endpoint adapter in order to forward all incoming requests to an in memory message channel. This is done completely behind the scenes. The Http server component provides some more customization possibilities when it comes to endpoint adapter implementations. This topic is discussed in a separate section <a href="#endpoint-adapter">endpoint-adapter</a>. Up to now we keep it simple by synchronously receiving and sending messages in the test case.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The default channel endpoint adapter automatically creates an inbound message channel where incoming messages are stored to internally. So if you need to clean up a server that has already stored some incoming messages you can do this easily by purging the internal message channel. The message channel follows a naming convention <strong>{serverName}.inbound</strong> where <strong>{serverName}</strong> is the Spring bean name of the Citrus server endpoint component. If you purge this internal channel in a before test nature you are sure that obsolete messages on a server instance get purged before each test is executed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>So lets get back to our mission of providing response messages as server to connected clients. As you might know Http REST works with some characteristic properties when it comes to send and receive messages. For instance a client can send different request methods GET, POST, PUT, DELETE, HEAD and so on. The Citrus server may verify this method when receiving client requests. Therefore we have introduced special Http test actions for server communication. Have a look at a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http:receive-request</span> <span class="attribute-name">server</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloHttpServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;http:POST</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/test</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;http:headers</span> <span class="attribute-name">content-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/xml</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">accept</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/xml, */*</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">X-CustomHeaderId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${custom_header_id}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Authorization</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Basic c29tZVVzZXJuYW1lOnNvbWVQYXNzd29yZA==</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/http:headers&gt;</span>
    <span class="tag">&lt;http:body&gt;</span>
    <span class="tag">&lt;http:data&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
        &lt;testRequestMessage&gt;
          &lt;text&gt;Hello HttpServer&lt;/text&gt;
        &lt;/testRequestMessage&gt;
      <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/http:data&gt;</span>
    <span class="tag">&lt;/http:body&gt;</span>
  <span class="tag">&lt;/http:POST&gt;</span>
  <span class="tag">&lt;http:extract&gt;</span>
    <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">X-MessageId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">variable</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">message_id</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/http:extract&gt;</span>
<span class="tag">&lt;/http:receive-request&gt;</span>

<span class="tag">&lt;http:send-response</span> <span class="attribute-name">server</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloHttpServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;http:headers</span> <span class="attribute-name">status</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">200</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">reason-phrase</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OK</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP/1.1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">X-MessageId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${message_id}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">X-CustomHeaderId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${custom_header_id}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/http:headers&gt;</span>
  <span class="tag">&lt;http:body&gt;</span>
  <span class="tag">&lt;http:data&gt;</span>
    <span class="inline-delimiter">&lt;![CDATA[</span>
      &lt;testResponseMessage&gt;
        &lt;text&gt;Hello Citrus&lt;/text&gt;
      &lt;/testResponseMessage&gt;
    <span class="inline-delimiter">]]&gt;</span>
  <span class="tag">&lt;/http:data&gt;</span>
  <span class="tag">&lt;/http:body&gt;</span>
<span class="tag">&lt;/http:send-response&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We receive a client request and validate that the request method is <strong>POST</strong> on request path <strong>/test</strong> . Now we can validate special message headers such as <strong>content-type</strong> . In addition to that we can check custom headers and basic authorization headers. As usual the optional message body is compared to an expected message template. The custom <strong>X-MessageId</strong> header is saved to a test variable <strong>message_id</strong> for later usage in the response.</p>
</div>
<div class="paragraph">
<p>The response message defines Http typical entities such as <strong>status</strong> and <strong>reason-phrase</strong> . Here the tester can simulate <strong>404 NOT_FOUND</strong> errors or similar other status codes that get send back to the client. In our example everything is <strong>OK</strong> and we send back a response body and some custom header entries.</p>
</div>
<div class="paragraph">
<p>That is basically how Citrus simulates Http server operations. We receive the client request and validate the request properties. Then we send back a response with a Http status code.</p>
</div>
<div class="paragraph">
<p>As usual all these Http specific actions are also available in Java DSL.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">@CitrusTest
public void httpServerActionTest() {
    http().server(&quot;helloHttpServer&quot;)
          .receive()
          .post(&quot;/test&quot;)
          .payload(&quot;<span class="tag">&lt;testRequestMessage&gt;</span>&quot; +
                    &quot;<span class="tag">&lt;text</span><span class="error">&lt;</span><span class="attribute-name">Hello</span> <span class="attribute-name">HttpServer</span><span class="error">&lt;</span><span class="error">/</span><span class="attribute-name">text</span><span class="tag">&gt;</span>&quot; +
                  &quot;<span class="tag">&lt;/testRequestMessage&gt;</span>&quot;)
          .contentType(&quot;application/xml&quot;)
          .accept(&quot;application/xml, */*&quot;)
          .header(&quot;X-CustomHeaderId&quot;, &quot;${custom_header_id}&quot;)
          .header(&quot;Authorization&quot;, &quot;Basic c29tZVVzZXJuYW1lOnNvbWVQYXNzd29yZA==&quot;)
          .extractFromHeader(&quot;X-MessageId&quot;, &quot;message_id&quot;);

    http().server(&quot;helloHttpServer&quot;)
          .send()
          .response(HttpStatus.OK)
          .payload(&quot;<span class="tag">&lt;testResponseMessage&gt;</span>&quot; +
                    &quot;<span class="tag">&lt;text</span><span class="error">&lt;</span><span class="attribute-name">Hello</span> <span class="attribute-name">Citrus</span><span class="error">&lt;</span><span class="error">/</span><span class="attribute-name">text</span><span class="tag">&gt;</span>&quot; +
                  &quot;<span class="tag">&lt;/testResponseMessage&gt;</span>&quot;)
          .version(&quot;HTTP/1.1&quot;)
          .contentType(&quot;application/xml&quot;)
          .header(&quot;X-CustomHeaderId&quot;, &quot;${custom_header_id}&quot;)
          .header(&quot;X-MessageId&quot;, &quot;${message_id}&quot;);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is the exact same example in Java DSL. We select server actions first and receive client requests. Then we send back a response with a <strong>HttpStatus.OK</strong> status. This completes the server actions on Http message transport. Now we continue with some more Http specific settings and features.</p>
</div>
</div>
<div class="sect2">
<h3 id="http-headers"><a class="anchor" href="#http-headers"></a><a class="link" href="#http-headers">18.4. HTTP headers</a></h3>
<div class="paragraph">
<p>When dealing with HTTP request/response communication we always deal with HTTP specific headers. The HTTP protocol defines a group of header attributes that both client and server need to be able to handle. You can set and validate these HTTP headers in Citrus quite easy. Let us have a look at a client operation in Citrus where some HTTP headers are explicitly set before the request is sent out.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http:send-request</span> <span class="attribute-name">client</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;http:POST&gt;</span>
    <span class="tag">&lt;http:headers&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">X-CustomHeaderId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${custom_header_id}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Accept</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/xml,*/*</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/http:headers&gt;</span>
    <span class="tag">&lt;http:body&gt;</span>
        <span class="tag">&lt;http:payload&gt;</span>
            <span class="tag">&lt;testRequestMessage&gt;</span>
                <span class="tag">&lt;text&gt;</span>Hello HttpServer<span class="tag">&lt;/text&gt;</span>
            <span class="tag">&lt;/testRequestMessage&gt;</span>
        <span class="tag">&lt;/http:payload&gt;</span>
    <span class="tag">&lt;/http:body&gt;</span>
  <span class="tag">&lt;/http:POST&gt;</span>
<span class="tag">&lt;/http:send-request&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We are able to set custom headers (<strong>X-CustomHeaderId</strong>) that go directly into the HTTP header section of the request. In addition to that testers can explicitly set HTTP reserved headers such as <strong>Content-Type</strong> . Fortunately you do not have to set all headers on your own. Citrus will automatically set the required HTTP headers for the request. So we have the following HTTP request which is sent to the server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">POST /test HTTP/1.1
Accept: text/xml, */*
Content-Type: text/xml
X-CustomHeaderId: 123456789
Accept-Charset: macroman
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8091
Content-Length: 175
<span class="tag">&lt;testRequestMessage&gt;</span>
    <span class="tag">&lt;text&gt;</span>Hello HttpServer<span class="tag">&lt;/text&gt;</span>
<span class="tag">&lt;/testRequestMessage&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On server side testers are interested in validating the HTTP headers. Within Citrus receive action you simply define the expected header entries. The HTTP specific headers are automatically available for validation as you can see in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http:receive-request</span> <span class="attribute-name">server</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;http:POST&gt;</span>
    <span class="tag">&lt;http:headers&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">X-CustomHeaderId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${custom_header_id}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Accept</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/xml,*/*</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/http:headers&gt;</span>
    <span class="tag">&lt;http:body&gt;</span>
        <span class="tag">&lt;http:payload&gt;</span>
            <span class="tag">&lt;testRequestMessage&gt;</span>
                <span class="tag">&lt;text&gt;</span>Hello HttpServer<span class="tag">&lt;/text&gt;</span>
            <span class="tag">&lt;/testRequestMessage&gt;</span>
        <span class="tag">&lt;/http:payload&gt;</span>
    <span class="tag">&lt;/http:body&gt;</span>
  <span class="tag">&lt;/http:POST&gt;</span>
<span class="tag">&lt;/http:receive-request&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The test checks on custom headers and HTTP specific headers to meet the expected values.</p>
</div>
<div class="paragraph">
<p>Now that we have accepted the client request and validated the contents we are able to send back a proper HTTP response message. Same thing here with HTTP specific headers. The HTTP protocol defines several headers marking the success or failure of the server operation. In the test case you can set those headers for the response message with conventional Citrus header names. See the following example to find out how that works for you.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http:send-response</span> <span class="attribute-name">server</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;http:headers</span> <span class="attribute-name">status</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">200</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">reason-phrase</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OK</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">X-CustomHeaderId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${custom_header_id}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/http:headers&gt;</span>
    <span class="tag">&lt;http:body&gt;</span>
        <span class="tag">&lt;http:payload&gt;</span>
            <span class="tag">&lt;testResponseMessage&gt;</span>
                <span class="tag">&lt;text&gt;</span>Hello Citrus Client<span class="tag">&lt;/text&gt;</span>
            <span class="tag">&lt;/testResponseMessage&gt;</span>
        <span class="tag">&lt;/http:payload&gt;</span>
    <span class="tag">&lt;/http:body&gt;</span>
<span class="tag">&lt;/http:send-response&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once more we set the custom header entry (<strong>X-CustomHeaderId</strong>) and a HTTP reserved header (<strong>Content-Type</strong>) for the response message. On top of this we are able to set the response status for the HTTP response. We use the reserved header names <strong>status</strong> in order to mark the success of the server operation. With this mechanism we can easily simulate different server behaviour such as HTTP error response codes (e.g. 404 - Not found, 500 - Internal error). Let us have a closer look at the generated response message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">HTTP/1.1 200 OK
Content-Type: text/xml;charset=UTF-8
Accept-Charset: macroman
Content-Length: 205
Server: Jetty(7.0.0.pre5)
<span class="tag">&lt;testResponseMessage&gt;</span>
    <span class="tag">&lt;text&gt;</span>Hello Citrus Client<span class="tag">&lt;/text&gt;</span>
<span class="tag">&lt;/testResponseMessage&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You do not have to set the reason phrase all the time. It is sufficient to only set the HTTP status code. Citrus will automatically add the proper reason phrase for well known HTTP status codes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The only thing that is missing right now is the validation of HTTP status codes when receiving the server response in a Citrus test case. It is very easy as you can use the Citrus reserved header names for validation, too.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http:receive-response</span> <span class="attribute-name">client</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;http:headers</span> <span class="attribute-name">status</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">200</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">reason-phrase</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OK</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP/1.1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">X-CustomHeaderId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${custom_header_id}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/http:headers&gt;</span>
    <span class="tag">&lt;http:body&gt;</span>
        <span class="tag">&lt;http:payload&gt;</span>
            <span class="tag">&lt;testResponseMessage&gt;</span>
                <span class="tag">&lt;text&gt;</span>Hello Test Framework<span class="tag">&lt;/text&gt;</span>
            <span class="tag">&lt;/testResponseMessage&gt;</span>
        <span class="tag">&lt;/http:payload&gt;</span>
    <span class="tag">&lt;/http:body&gt;</span>
<span class="tag">&lt;/http:receive-response&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Up to now we have used some of the basic Citrus reserved HTTP header names (status, version, reason-phrase). In HTTP RESTful services some other header names are essential for validation. These are request attributes like query parameters, context path and request URI. The Citrus server side REST message controller will automatically add all this information to the message header for you. So all you need to do is validate the header entries in your test.</p>
</div>
<div class="paragraph">
<p>The next example receives a HTTP GET method request on server side. Here the GET request does not have any message payload, so the validation just works on the information given in the message header. We assume the client to call <code><a href="http://localhost:8080/app/users?id=123456789" class="bare">http://localhost:8080/app/users?id=123456789</a></code>. As a tester we need to validate the request method, request URI, context path and the query parameters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http:receive-request</span> <span class="attribute-name">server</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;http:GET</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/app/users</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">context-path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/app</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;http:params&gt;</span>
        <span class="tag">&lt;http:param</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">123456789</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/http:params&gt;</span>
    <span class="tag">&lt;http:headers&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Host</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">localhost:8080</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Accept</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/xml,*/*</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/http:headers&gt;</span>
    <span class="tag">&lt;http:body&gt;</span>
        <span class="tag">&lt;http:data&gt;</span><span class="tag">&lt;/http:data&gt;</span>
    <span class="tag">&lt;/http:body&gt;</span>
  <span class="tag">&lt;/http:GET&gt;</span>
<span class="tag">&lt;/http:receive-request&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Be aware of the slight differences in request URI and context path. The context path gives you the web application context path within the servlet container for your web application. The request URI always gives you the complete path that was called for this request.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As you can see we are able to validate all parts of the initial request endpoint URI the client was calling. This completes the HTTP header processing within Citrus. On both client and server side Citrus is able to set and validate HTTP specific header entries which is essential for simulating HTTP communication.</p>
</div>
</div>
<div class="sect2">
<h3 id="http-server-interceptors"><a class="anchor" href="#http-server-interceptors"></a><a class="link" href="#http-server-interceptors">18.5. HTTP server interceptors</a></h3>
<div class="paragraph">
<p>The server component is able to add custom interceptors that participate in the request/response processing. The interceptors need to implement the common interface <strong>org.springframework.web.servlet.HandlerInterceptor</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-http:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpServer</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8080</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">auto-start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">interceptors</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serverInterceptors</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;util:list</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serverInterceptors</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.http.interceptor.LoggingHandlerInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/util:list&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The sample above adds the Citrus logging handler interceptor that logs requests and responses exchanged with that server component. You can add custom interceptor implementations here in order
to participate in the request/response message processing.</p>
</div>
</div>
<div class="sect2">
<h3 id="http-form-urlencoded-data"><a class="anchor" href="#http-form-urlencoded-data"></a><a class="link" href="#http-form-urlencoded-data">18.6. HTTP form urlencoded data</a></h3>
<div class="paragraph">
<p>HTML form data can be sent to the server using different methods and content types. One of them is a POST method with <strong>x-www-form-urlencoded</strong> body content. The form data elements are sent to the server using key-value pairs POST data where the form control name is the key and the control data is the url encoded value.</p>
</div>
<div class="paragraph">
<p>Form urlencoded form data content could look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">password=s%21cr%21t<span class="error">&amp;</span>username=foo</code></pre>
</div>
</div>
<div class="paragraph">
<p>A you can see the form data is automatically encoded. In the example above we transmit two form controls <strong>password</strong> and <strong>username</strong> with respective values <strong>s$cr$t</strong> and <strong>foo</strong> . In case we would validate this form data in Citrus we are able to do this with plaintext message validation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plaintext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;data&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
        password=s%21cr%21t&amp;username=${username}
      <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/data&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
  <span class="tag">&lt;header&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_http_method</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">POST</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_http_request_uri</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/form-test</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/x-www-form-urlencoded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Obviously validating these key-value pair character sequences can be hard especially when having HTML forms with lots of form controls. This is why Citrus provides a special message validator for <strong>x-www-form-urlencoded</strong> contents. First of all we have to add <strong>citrus-http</strong> module as dependency to our project if not done so yet. After that we can add the validator implementation to the list of message validators used in Citrus.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:message-validators&gt;</span>
  <span class="tag">&lt;citrus:validator</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.http.validation.FormUrlEncodedMessageValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/citrus:message-validators&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we are able to receive the urlencoded form data message in a test.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">x-www-form-urlencoded</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;payload&gt;</span>
      <span class="tag">&lt;form-data</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/http/message</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;content-type&gt;</span>application/x-www-form-urlencoded<span class="tag">&lt;/content-type&gt;</span>
        <span class="tag">&lt;action&gt;</span>/form-test<span class="tag">&lt;/action&gt;</span>
        <span class="tag">&lt;controls&gt;</span>
          <span class="tag">&lt;control</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;value&gt;</span>${password}<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;/control&gt;</span>
          <span class="tag">&lt;control</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;value&gt;</span>${username}<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;/control&gt;</span>
        <span class="tag">&lt;/controls&gt;</span>
      <span class="tag">&lt;/form-data&gt;</span>
    <span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
  <span class="tag">&lt;header&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_http_method</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">POST</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_http_request_uri</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/form-test</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/x-www-form-urlencoded</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We use a special message type <strong>x-www-form-urlencoded</strong> so the new message validator will take action. The form url encoded message validator is able to handle a special XML representation of the form data. This enables the very powerful XML message validation capabilities of Citrus such as ignoring elements and usage of test variables inline.</p>
</div>
<div class="paragraph">
<p>Each form control is translated to a control element with respective name and value properties. The form data is validated in a more comfortable way as the plaintext message validator would be able to offer.</p>
</div>
</div>
<div class="sect2">
<h3 id="http-error-handling"><a class="anchor" href="#http-error-handling"></a><a class="link" href="#http-error-handling">18.7. HTTP error handling</a></h3>
<div class="paragraph">
<p>So far we have received response messages with HTTP status code <strong>200 OK</strong> . How to deal with server errors like <strong>404 Not Found</strong> or <strong>500 Internal server error</strong> ? The default HTTP message client error strategy is to propagate server error response messages to the receive action for validation. We simply check on HTTP status code and status text for error validation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http:send-request</span> <span class="attribute-name">client</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;http:body&gt;</span>
        <span class="tag">&lt;http:payload&gt;</span>
            <span class="tag">&lt;testRequestMessage&gt;</span>
                <span class="tag">&lt;text&gt;</span>Hello HttpServer<span class="tag">&lt;/text&gt;</span>
            <span class="tag">&lt;/testRequestMessage&gt;</span>
        <span class="tag">&lt;/http:payload&gt;</span>
    <span class="tag">&lt;/http:body&gt;</span>
<span class="tag">&lt;/http:send-request&gt;</span>

<span class="tag">&lt;http:receive-request</span> <span class="attribute-name">client</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;http:body&gt;</span>
        <span class="tag">&lt;http:data&gt;</span><span class="inline-delimiter">&lt;![CDATA[</span><span class="inline-delimiter">]]&gt;</span><span class="tag">&lt;/http:data&gt;</span>
    <span class="tag">&lt;/http:body&gt;</span>
    <span class="tag">&lt;http:headers</span> <span class="attribute-name">status</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">403</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">reason-phrase</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FORBIDDEN</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/http:receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The message data can be empty depending on the server logic for these error situations. If we receive additional error information as message payload just add validation assertions as usual.</p>
</div>
<div class="paragraph">
<p>Instead of receiving such empty messages with checks on HTTP status header information we can change the error strategy in the message sender component in order to automatically raise exceptions on response messages other than <strong>200 OK</strong> . Therefore we go back to the HTTP message sender configuration for changing the error strategy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-http:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpClient</span><span class="delimiter">&quot;</span></span>
                              <span class="attribute-name">request-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/test</span><span class="delimiter">&quot;</span></span>
                              <span class="attribute-name">error-strategy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">throwsException</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we expect an exception to be thrown because of the error response. Following from that we have to change our test case. Instead of receiving the error message with receive action we assert the client exception and check on the HTTP status code and status text.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;assert</span> <span class="attribute-name">exception</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.web.client.HttpClientErrorException</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">message</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">403 Forbidden</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;when&gt;</span>
        <span class="tag">&lt;http:send-request</span> <span class="attribute-name">client</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;http:body&gt;</span>
                <span class="tag">&lt;http:payload&gt;</span>
                    <span class="tag">&lt;testRequestMessage&gt;</span>
                        <span class="tag">&lt;text&gt;</span>Hello HttpServer<span class="tag">&lt;/text&gt;</span>
                    <span class="tag">&lt;/testRequestMessage&gt;</span>
                <span class="tag">&lt;/http:payload&gt;</span>
            <span class="tag">&lt;/http:body&gt;</span>
        <span class="tag">&lt;/http:send-request&gt;</span>
    <span class="tag">&lt;/when&gt;</span>
<span class="tag">&lt;/assert&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Both ways of handling HTTP error messages on client side are valid for expecting the server to raise HTTP error codes. Choose the preferred way according to your test project requirements.</p>
</div>
</div>
<div class="sect2">
<h3 id="http-client-basic-authentication"><a class="anchor" href="#http-client-basic-authentication"></a><a class="link" href="#http-client-basic-authentication">18.8. HTTP client basic authentication</a></h3>
<div class="paragraph">
<p>As client you may have to use basic authentication in order to access a resource on the server. In most cases this will be username/password authentication where the credentials are transmitted in the request header section as base64 encoding.</p>
</div>
<div class="paragraph">
<p>The easiest approach to set the <strong>Authorization</strong> header for a basic authentication HTTP request would be to set it on your own in the send action definition. Of course you have to use the correct basic authentication header syntax with base64 encoding for the username:password phrase. See this simple example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http:headers&gt;</span>
    <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Authorization</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Basic c29tZVVzZXJuYW1lOnNvbWVQYXNzd29yZA==</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/http:headers&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus will add this header to the HTTP requests and the server will read the <strong>Authorization</strong> username and password. For more convenient base64 encoding you can also use a Citrus function, see <a href="#functions-encode-base64">functions-encode-base64</a></p>
</div>
<div class="paragraph">
<p>Now there is a more comfortable way to set the basic authentication header in all the Citrus requests. As Citrus uses Spring&#8217;s REST support with the RestTemplate and ClientHttpRequestFactory the basic authentication is already covered there in a more generic way. You simply have to configure the basic authentication credentials on the RestTemplate&#8217;s ClientHttpRequestFactory. Just see the following example and learn how to do that.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-http:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpClient</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">request-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">POST</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">request-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/test</span><span class="delimiter">&quot;</span></span>
                    <span class="attribute-name">request-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">basicAuthFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">basicAuthFactory</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.http.client.BasicAuthClientHttpRequestFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">authScope</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.http.auth.AuthScope</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8072</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">basic</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/bean&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">credentials</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.http.auth.UsernamePasswordCredentials</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someUsername</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">somePassword</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The advantages of this method is obvious. Now all sending test actions that reference the client component will automatically add the basic authentication header.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Since Citrus has upgraded to Spring 3.1.x the Jakarta commons HTTP client is deprecated with Citrus version 1.2. The formerly used UserCredentialsClientHttpRequestFactory is therefore also deprecated and will not continue with next versions. Please update your configuration if you are coming from Citrus 1.1 or earlier versions.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The above configuration results in HTTP client requests with authentication headers properly set for basic authentication. The client request factory takes care on adding the proper basic authentication header to each request that is sent with this Citrus message sender. Citrus uses preemptive authentication. The message sender only sends a single request to the server with all authentication information set in the message header. The request which determines the authentication scheme on the server is skipped. This is why you have to add some auth scope in the client request factory so Citrus can setup an authentication cache within the HTTP context in order to have preemptive authentication.</p>
</div>
<div class="paragraph">
<p>As a result of the basic auth client request factory the following example request that is created by the Citrus HTTP client has the <strong>Authorization</strong> header set. This is done now automatically for all requests with this HTTP client.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">POST /test HTTP/1.1
Accept: text/xml, */*
Content-Type: text/xml
Accept-Charset: iso-8859-1, us-ascii, utf-8
Authorization: Basic c29tZVVzZXJuYW1lOnNvbWVQYXNzd29yZA==
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8080
Content-Length: 175
<span class="tag">&lt;testRequestMessage&gt;</span>
  <span class="tag">&lt;text&gt;</span>Hello HttpServer<span class="tag">&lt;/text&gt;</span>
<span class="tag">&lt;/testRequestMessage&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="http-server-basic-authentication"><a class="anchor" href="#http-server-basic-authentication"></a><a class="link" href="#http-server-basic-authentication">18.9. HTTP server basic authentication</a></h3>
<div class="paragraph">
<p>Citrus as a server can also set basic authentication so clients need to authenticate properly when accessing server resources.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-http:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">basicAuthHttpServer</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8090</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">auto-start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">resource-base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">src/it/resources</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">security-handler</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">basicAuthSecurityHandler</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">basicAuthSecurityHandler</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.http.security.SecurityHandlerFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">users</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;list&gt;</span>
            <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.http.security.User</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">roles</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CitrusRole</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/bean&gt;</span>
        <span class="tag">&lt;/list&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">constraints</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;map&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/foo/*</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.http.security.BasicAuthConstraint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CitrusRole</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/bean&gt;</span>
            <span class="tag">&lt;/entry&gt;</span>
        <span class="tag">&lt;/map&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We have set a security handler on the server web container with a constraint on all resources with <code>/foo/*</code>. Following from that the server requires basic authentication for these resources. The granted users and roles are specified within the security handler bean definition. Connecting clients have to set the basic auth HTTP header properly using the correct user and role for accessing the Citrus server now.</p>
</div>
<div class="paragraph">
<p>You can customize the security handler for your very specific needs (e.g. load users and roles with JDBC from a database). Just have a look at the code base and inspect the settings and properties offered by the security handler interface.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This mechanism is not restricted to basic authentication only. With other settings you can also set up digest or form-based authentication constraints very easy.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="http-cookies"><a class="anchor" href="#http-cookies"></a><a class="link" href="#http-cookies">18.10. HTTP cookies</a></h3>
<div class="paragraph">
<p>Cookies hold any kind of information and are saved as test information on the client side. Http servers are able to instruct the client (browser) to save a new cookie with name, value and some attributes. This is usually done with a
<em>"Set-Cookie"</em> message header set on the server response message. Citrus is able to add those cookie information in a server response.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http:receive-request</span> <span class="attribute-name">server</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">echoHttpServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;http:POST&gt;</span>
        <span class="tag">&lt;http:headers&gt;</span>
            <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">getCookie</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/http:headers&gt;</span>
    <span class="tag">&lt;http:body&gt;</span>
        <span class="tag">&lt;http:data&gt;</span>
            <span class="inline-delimiter">&lt;![CDATA[</span>
            Some request data
            <span class="inline-delimiter">]]&gt;</span>
        <span class="tag">&lt;/http:data&gt;</span>
    <span class="tag">&lt;/http:body&gt;</span>
    <span class="tag">&lt;/http:POST&gt;</span>
<span class="tag">&lt;/http:receive-request&gt;</span>

<span class="tag">&lt;http:send-response</span> <span class="attribute-name">server</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">echoHttpServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;http:headers</span> <span class="attribute-name">status</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">200</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">reason-phrase</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OK</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP/1.1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">getCookie</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;http:cookie</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Token</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">secure</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">domain</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrusframework.org</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/test/cookie.py</span><span class="delimiter">&quot;</span></span>
                     <span class="attribute-name">max-age</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">86400</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/http:headers&gt;</span>
    <span class="tag">&lt;http:body&gt;</span>
        <span class="tag">&lt;http:data&gt;</span>
            <span class="inline-delimiter">&lt;![CDATA[</span>
            Some response body
            <span class="inline-delimiter">]]&gt;</span>
        <span class="tag">&lt;/http:data&gt;</span>
    <span class="tag">&lt;/http:body&gt;</span>
<span class="tag">&lt;/http:send-response&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Cookie cookie = <span class="keyword">new</span> Cookie(<span class="string"><span class="delimiter">&quot;</span><span class="content">Token</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span>);
cookie.setPath(<span class="string"><span class="delimiter">&quot;</span><span class="content">/test/cookie.py</span><span class="delimiter">&quot;</span></span>);
cookie.setSecure(<span class="predefined-constant">false</span>);
cookie.setDomain(<span class="string"><span class="delimiter">&quot;</span><span class="content">citrusframework.org</span><span class="delimiter">&quot;</span></span>);
cookie.setMaxAge(<span class="integer">86400</span>);

http().server(<span class="string"><span class="delimiter">&quot;</span><span class="content">echoHttpServer</span><span class="delimiter">&quot;</span></span>)
 .receive()
 .post()
 .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">Some request data</span><span class="delimiter">&quot;</span></span>)
 .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>);

http().server(<span class="string"><span class="delimiter">&quot;</span><span class="content">echoHttpServer</span><span class="delimiter">&quot;</span></span>)
 .send()
 .response(HttpStatus.OK)
 .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">Some response body</span><span class="delimiter">&quot;</span></span>)
 .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>)
 .cookie(cookie);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The sample above receives a Http request with method POST and some request data. The server response is specified with <em>Http 200 OK</em> and some additional cookie information. The
cookie is part of the message header specification and gets a name and value as well as several other attributes. This response will result in a Http response with the <em>"Set-Cookie"</em> header set:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">Set-Cookie:Token=5877643571;Path=/test/cookie.py;Domain=citrusframework.org;Max-Age=86400</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see test variables are replaced before the cookie is added to the response. The client now is able to receive the cookie information for validation:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http:receive-response</span> <span class="attribute-name">server</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">echoHttpClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;http:headers</span> <span class="attribute-name">status</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">200</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">reason-phrase</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OK</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP/1.1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">getCookie</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;http:cookie</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Token</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">secure</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">domain</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrusframework.org</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/test/cookie.py</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">max-age</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">86400</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/http:headers&gt;</span>
  <span class="tag">&lt;http:body&gt;</span>
    <span class="tag">&lt;http:data&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
        Some response body
      <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/http:data&gt;</span>
  <span class="tag">&lt;/http:body&gt;</span>
<span class="tag">&lt;/http:receive-response&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Cookie cookie = <span class="keyword">new</span> Cookie(<span class="string"><span class="delimiter">&quot;</span><span class="content">Token</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span>);
cookie.setPath(<span class="string"><span class="delimiter">&quot;</span><span class="content">/test/cookie.py</span><span class="delimiter">&quot;</span></span>);
cookie.setSecure(<span class="predefined-constant">false</span>);
cookie.setDomain(<span class="string"><span class="delimiter">&quot;</span><span class="content">citrusframework.org</span><span class="delimiter">&quot;</span></span>);
cookie.setMaxAge(<span class="integer">86400</span>);

http().client(<span class="string"><span class="delimiter">&quot;</span><span class="content">echoHttpClient</span><span class="delimiter">&quot;</span></span>)
 .receive()
 .response(HttpStatus.OK)
 .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">Some response body</span><span class="delimiter">&quot;</span></span>)
 .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>)
 .cookie(cookie);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once again the cookie information is added to the header specification. The Citrus message validation will make sure that the cookie information is present with all
specified attributes.</p>
</div>
<div class="paragraph">
<p>In all further actions the client is able to continue to send the cookie information with name and value:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http:send-request</span> <span class="attribute-name">client</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">echoHttpClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">fork</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;http:POST&gt;</span>
    <span class="tag">&lt;http:headers&gt;</span>
      <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;http:cookie</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Token</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/http:headers&gt;</span>
    <span class="tag">&lt;http:body&gt;</span>
      <span class="tag">&lt;http:data&gt;</span>
        <span class="inline-delimiter">&lt;![CDATA[</span>
          Some other request data
        <span class="inline-delimiter">]]&gt;</span>
      <span class="tag">&lt;/http:data&gt;</span>
    <span class="tag">&lt;/http:body&gt;</span>
  <span class="tag">&lt;/http:POST&gt;</span>
<span class="tag">&lt;/http:send-request&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http().client(<span class="string"><span class="delimiter">&quot;</span><span class="content">echoHttpClient</span><span class="delimiter">&quot;</span></span>)
    .send()
    .post()
    .fork(<span class="predefined-constant">true</span>)
    .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">Some other request data</span><span class="delimiter">&quot;</span></span>)
    .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>)
    .cookie(<span class="keyword">new</span> Cookie(<span class="string"><span class="delimiter">&quot;</span><span class="content">Token</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The cookie now is only specified with name and value as the cookie now goes to the <em>"Cookie"</em> request message header.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">Cookie:Token=5877643571</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course the Citrus Http server can now also validate the cookie information in a request validation:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;http:receive-request</span> <span class="attribute-name">client</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">echoHttpServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;http:POST&gt;</span>
    <span class="tag">&lt;http:headers&gt;</span>
      <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;http:cookie</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Token</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/http:headers&gt;</span>
    <span class="tag">&lt;http:body&gt;</span>
      <span class="tag">&lt;http:data&gt;</span>
        <span class="inline-delimiter">&lt;![CDATA[</span>
          Some other request data
        <span class="inline-delimiter">]]&gt;</span>
      <span class="tag">&lt;/http:data&gt;</span>
    <span class="tag">&lt;/http:body&gt;</span>
  <span class="tag">&lt;/http:POST&gt;</span>
<span class="tag">&lt;/http:receive-request&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">http().server(<span class="string"><span class="delimiter">&quot;</span><span class="content">echoHttpServer</span><span class="delimiter">&quot;</span></span>)
    .receive()
    .post()
    .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">Some other request data</span><span class="delimiter">&quot;</span></span>)
    .header(<span class="string"><span class="delimiter">&quot;</span><span class="content">Operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>)
    .cookie(<span class="keyword">new</span> Cookie(<span class="string"><span class="delimiter">&quot;</span><span class="content">Token</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Citrus message validation will make sure that the cookie is set in the request with respective name and value.</p>
</div>
</div>
<div class="sect2">
<h3 id="http-gzip-compression"><a class="anchor" href="#http-gzip-compression"></a><a class="link" href="#http-gzip-compression">18.11. HTTP Gzip compression</a></h3>
<div class="paragraph">
<p>Gzip is a very popular compression mechanism for optimizing the message transportation for large content. The Citrus http client and server components support gzip compression out of the box. This means
that you only need to set the specific encoding headers in your http request/response message.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Accept-Encoding=gzip</dt>
<dd>
<p>Setting for clients when requesting gzip compressed response content. The Http server must support gzip compression then in order to provide the response as zipped byte stream. The Citrus http server component automatically recognizes this header in a request and applies gzip compression to the response.</p>
</dd>
<dt class="hdlist1">Content-Encoding=gzip</dt>
<dd>
<p>When a http server sends compressed message content to the client this header is set to <strong>gzip</strong> in order to mark the compression. The Http client must support gzip compression then in order to unzip the message content. The Citrus http client component automatically recognizes this header in a response and applies gzip unzip logic before passing the message to the test case.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The Citrus client and server automatically take care on gzip compression when those headers are set. In the test case you do not need to zip or unzip the content then as it is automatically done before.</p>
</div>
<div class="paragraph">
<p>This means that you can request gzipped content from a server with just adding the message header <strong>Accept-Encoding</strong> in your http request operation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;echo&gt;</span>
  <span class="tag">&lt;message&gt;</span>Send Http client request for gzip compressed data<span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span>

<span class="tag">&lt;http:send-request</span> <span class="attribute-name">client</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">gzipClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;http:POST&gt;</span>
      <span class="tag">&lt;http:headers</span> <span class="attribute-name">content-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Accept-Encoding</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">gzip</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Accept</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/http:headers&gt;</span>
<span class="tag">&lt;/http:POST&gt;</span>
<span class="tag">&lt;/http:send-request&gt;</span>

<span class="tag">&lt;echo&gt;</span>
  <span class="tag">&lt;message&gt;</span>Receive text automatically gzip unzipped<span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span>

<span class="tag">&lt;http:receive-response</span> <span class="attribute-name">client</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">gzipClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;http:headers</span> <span class="attribute-name">status</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">200</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">reason-phrase</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OK</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/http:headers&gt;</span>
    <span class="tag">&lt;http:body</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plaintext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;http:data&gt;</span>${text}<span class="tag">&lt;/http:data&gt;</span>
    <span class="tag">&lt;/http:body&gt;</span>
<span class="tag">&lt;/http:receive-response&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On the server side if we receive a message and the response should be compressed with Gzip we just have to set the <strong>Content-Encoding</strong> header in the response operation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;echo&gt;</span>
  <span class="tag">&lt;message&gt;</span>Receive gzip compressed as base64 encoded text<span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span>

<span class="tag">&lt;http:receive-request</span> <span class="attribute-name">server</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">echoHttpServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;http:POST</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/echo</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;http:headers&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/html</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Accept-Encoding</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">gzip</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Accept</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/http:headers&gt;</span>
    <span class="tag">&lt;/http:POST&gt;</span>
<span class="tag">&lt;/http:receive-request&gt;</span>

<span class="tag">&lt;echo&gt;</span>
  <span class="tag">&lt;message&gt;</span>Send Http server gzip compressed response<span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span>

<span class="tag">&lt;http:send-response</span> <span class="attribute-name">server</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">echoHttpServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;http:headers</span> <span class="attribute-name">status</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">200</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">reason-phrase</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OK</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Encoding</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">gzip</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;http:header</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/http:headers&gt;</span>
    <span class="tag">&lt;http:body&gt;</span>
      <span class="tag">&lt;http:data&gt;</span>${text}<span class="tag">&lt;/http:data&gt;</span>
    <span class="tag">&lt;/http:body&gt;</span>
<span class="tag">&lt;/http:send-response&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So the Citrus server will automatically add gzip compression to the response for us.</p>
</div>
<div class="paragraph">
<p>Of course you can also send gzipped content as a client. Then you would just set the <strong>Content-Encoding</strong> header to <strong>gzip</strong> in your request. The client will automatically apply compression for you.</p>
</div>
</div>
<div class="sect2">
<h3 id="http-servlet-filters"><a class="anchor" href="#http-servlet-filters"></a><a class="link" href="#http-servlet-filters">18.12. HTTP servlet filters</a></h3>
<div class="paragraph">
<p>The Citrus http server component supports custom servlet filters that take part in handling an incoming request/response communication. This might be useful when customizing
the basic server behavior such as custom zip/unzip mechanisms. The custom servlet filters are referenced in the http server component as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-http:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpServer</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8080</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">filters</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">filters</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">filter-mappings</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">filterMappings</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;util:map</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">filters</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">request-caching-filter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.http.servlet.RequestCachingServletFilter</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/entry&gt;</span>
    <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">gzip-filter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.http.servlet.GzipServletFilter</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/entry&gt;</span>
<span class="tag">&lt;/util:map&gt;</span>

<span class="tag">&lt;util:map</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">filterMappings</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">request-caching-filter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/*</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">gzip-filter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/gzip/*</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/util:map&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The map of filters are specified as normal Spring configuration entries. The server component uses the attribute <code>filters</code> to reference a set of custom servlet filters.
The map holds one to many servlet filter beans each given a name that is also referenced in the respective servlet mappings. The servlet mappings specify when to apply those filters.</p>
</div>
<div class="paragraph">
<p>This way you can set a very custom servlet filter chain for each request/response communication. As usual the filter implementations can participate in the request and response handling process.</p>
</div>
<div class="paragraph">
<p>Citrus provides several default servlet implementations that are automatically added to each http server component these implementations are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">com.consol.citrus.http.servlet.RequestCachingServletFilter</dt>
<dd>
<p>caches incoming request data so input streams can be read multiple times during request processing (important when request logging is enabled)</p>
</dd>
<dt class="hdlist1">com.consol.citrus.http.servlet.GzipServletFilter</dt>
<dd>
<p>applies Gzip compressing when according headers are set and client explicitly asks for compressed request/response communication</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>By the time you define some custom servlet filters or mappings to the server component Citrus will not apply default servlet filters. This means you always need to construct the whole servlet filter
chain including default servlet filters mentioned above.</p>
</div>
</div>
<div class="sect2">
<h3 id="http-servlet-context-customization"><a class="anchor" href="#http-servlet-context-customization"></a><a class="link" href="#http-servlet-context-customization">18.13. HTTP servlet context customization</a></h3>
<div class="paragraph">
<p>The Citrus HTTP server uses Spring application context loading on startup. For high customizations you can provide a custom servlet context file which holds all custom configurations as Spring beans for the server. Here is a sample servlet context with some basic Spring MVC components and the central HttpMessageController which is responsible for handling incoming requests (GET, PUT, DELETE, POST, etc.).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrusHandlerMapping</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrusMethodHandlerAdapter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageConverters</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;util:list</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">converters</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.http.converter.StringHttpMessageConverter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">supportedMediaTypes</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;util:list&gt;</span>
            <span class="tag">&lt;value&gt;</span>text/xml<span class="tag">&lt;/value&gt;</span>
          <span class="tag">&lt;/util:list&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
      <span class="tag">&lt;/bean&gt;</span>
    <span class="tag">&lt;/util:list&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrusHttpMessageController</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.http.controller.HttpMessageController</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">endpointAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;bean</span>
       <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.endpoint.adapter.EmptyResponseEndpointAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The beans above are responsible for proper HTTP server configuration. In general you do not need to adjust those beans, but we have the possibility to do so which gives us a great customization and extension points. The important part is the endpoint adapter definition inside the HttpMessageController. Once a client request was accepted the adapter is responsible for generating a proper response to the client.</p>
</div>
<div class="paragraph">
<p>You can add the custom servlet context as file resource to the Citrus HTTP server component. Just use the <strong>context-config-location</strong> attribute as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-http:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloHttpServer</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8080</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">auto-start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">context-config-location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/http/custom-servlet-context.xml</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">resource-base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">src/it/resources</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="websocket"><a class="anchor" href="#websocket"></a><a class="link" href="#websocket">19. WebSocket support</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The WebSocket message protocol builds on top of Http standard and brings bidirectional communication to the Http client-server world. Citrus is able to send and receive messages with WebSocket connections as client and server. The Http server implementation is now able to define multiple WebSocket endpoints. The new Citrus WebSocket client is able to publish and consumer messages via bidirectional WebSocket protocol.</p>
</div>
<div class="paragraph">
<p>The new WebSocket support is located in the module <strong>citrus-websocket</strong> . Therefore we need to add this module to our project as dependency when we are about to use the WebSocket features in Citrus.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>com.consol.citrus<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>citrus-websocket<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>2.7.3<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As Citrus provides a customized WebSocket configuration schema for the Spring application context configuration files we have to add name to the top level <strong>beans</strong> element. Simply include the websocket-config namespace in the configuration XML files as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:citrus</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/config</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:citrus-websocket</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/websocket/config</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
            <span class="content">http://www.springframework.org/schema/beans</span>
            <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
            <span class="content">http://www.citrusframework.org/schema/config</span>
            <span class="content">http://www.citrusframework.org/schema/config/citrus-config.xsd</span>
            <span class="content">http://www.citrusframework.org/schema/websocket/config</span>
            <span class="content">http://www.citrusframework.org/schema/websocket/config/citrus-websocket-config.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    [...]

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now our project is ready to use the Citrus WebSocket support. First of all let us send a message via WebSocket connection to some server.</p>
</div>
<div class="sect2">
<h3 id="websocket-client"><a class="anchor" href="#websocket-client"></a><a class="link" href="#websocket-client">19.1. WebSocket client</a></h3>
<div class="paragraph">
<p>On the client side Citrus offers a client component that goes directly to the Spring bean application context. The client needs a server endpoint uri. This is a WebSocket protocol endpoint uri.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-websocket:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloWebSocketClient</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/hello</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>url</strong> defines the endpoint to send messages to. The server has to be a WebSocket ready web server that supports Http connection upgrade for WebSocket protocols. WebSocket by its nature is an asynchronous bidirectional protocol. This means that the connection between client and server remains open and both server and client can send and receive messages. So when the Citrus client is waiting for a message we need a timeout that stops the asynchronous waiting. The receiving test action and the test case will fail when such a timeout is raised.</p>
</div>
<div class="paragraph">
<p>The WebSocket client will automatically open a connection to the server and ask for a connection upgrade to WebSocket protocol. This handshake is done once when the connection to the server is established. After that the client can push messages to the server and on the other side the server can push messages to the client. Now lets first push some messages to the server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloWebSocketClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message&gt;</span>
      <span class="tag">&lt;payload&gt;</span>
          <span class="tag">&lt;TestMessage&gt;</span>
              <span class="tag">&lt;Text&gt;</span>Hello WebSocketServer<span class="tag">&lt;/Text&gt;</span>
          <span class="tag">&lt;/TestMessage&gt;</span>
      <span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The connection handshake and the connection upgrade is done automatically by the client. After that the message is pushed to the server. As WebSocket is a bidirectional protocol we can also receive messages on the WebSocket client. These messages are pushed from server to all connected clients.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloWebSocketClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message&gt;</span>
      <span class="tag">&lt;payload&gt;</span>
          <span class="tag">&lt;TestMessage&gt;</span>
              <span class="tag">&lt;Text&gt;</span>Hello WebSocketClient<span class="tag">&lt;/Text&gt;</span>
          <span class="tag">&lt;/TestMessage&gt;</span>
      <span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We just use the very same client endpoint component in a message receive action. The client will wait for messages from the server and once received perform the well known message validation. Here we expect some XML message payload. This completes the client side as we are able to push and consumer messages via WebSocket connections.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Up to now we have used static WebSocket endpoint URIs in our client component configurations. This can be done with a more powerful dynamic endpoint URI in WebSocket client. Similar to the endpoint resolving mechanism in SOAP you can dynamically set the called endpoint uri at test runtime through message header values. By default Citrus will check a specific header entry for dynamic endpoint URI which is simply defined for each message sending action inside the test.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <strong>dynamicEndpointResolver</strong> bean must implement the EndpointUriResolver interface in order to resolve dynamic endpoint uri values. Citrus offers a default implementation, the <strong>DynamicEndpointUriResolver</strong>, which uses a specific message header for setting dynamic endpoint uri. The message header needs to specify the header <strong>citrus_endpoint_uri</strong> with a valid request uri.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;header&gt;</span>
  <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_endpoint_uri</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ws://localhost:8080/customers/${customerId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/header&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The specific send action above will send its message to the dynamic endpoint (ws://localhost:8080/customers/${customerId}[ws://localhost:8080/customers/${customerId}]) which is set in the header <strong>citrus_endpoint_uri</strong> .</p>
</div>
</div>
<div class="sect2">
<h3 id="websocket-server-endpoints"><a class="anchor" href="#websocket-server-endpoints"></a><a class="link" href="#websocket-server-endpoints">19.2. WebSocket server endpoints</a></h3>
<div class="paragraph">
<p>On the server side Citrus has a Http server implementation that we can easily start during test runtime. The Http server accepts connections from clients and also supports WebSocket upgrade strategies. This means clients can ask for a upgrade to the WebSocket standard. In this handshake the server will upgrade the connection to WebSocket and afterwards client and server can exchange messages over this connection. This means the connection is kept alive and multiple messages can be exchanged. Lets see how WebSocket endpoints are added to a Http server component in Citrus.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-websocket:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloHttpServer</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8080</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">auto-start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">resource-base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">src/it/resources</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus-websocket:endpoints&gt;</span>
        <span class="tag">&lt;citrus-websocket:endpoint</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">websocket1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;citrus-websocket:endpoint</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">websocket2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/citrus-websocket:endpoints&gt;</span>
<span class="tag">&lt;/citrus-websocket:server&gt;</span>

<span class="tag">&lt;citrus-websocket:endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">websocket1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/test1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;citrus-websocket:endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">websocket2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/test2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The embedded Jetty WebSocket server component in Citrus now is able to define multiple WebSocket endpoints. The WebSocket endpoints match to a request path on the server and are referenced by a unique id. Each WebSocket endpoint can follow individual timeout settings. In a test we can use these endpoints directly to receive messages.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpWebSocketServerTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">websocket1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;message&gt;</span>
                <span class="tag">&lt;data&gt;</span>
                  [...]
                <span class="tag">&lt;/data&gt;</span>
            <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/receive&gt;</span>

        <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">websocket1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;message&gt;</span>
                <span class="tag">&lt;data&gt;</span>
                  [...]
                <span class="tag">&lt;/data&gt;</span>
            <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/send&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see we reference the endpoint id in both receive and send actions. Each WebSocket endpoint holds one or more open connections to its clients. Each message that is sent is pushed to all connected clients. Each client can send messages to the WebSocket endpoint.</p>
</div>
<div class="paragraph">
<p>The WebSocket endpoint component handles connection handshakes automatically and caches all open sessions in memory. By default all connected clients will receive the messages pushed from server. This is done completely behind the scenes. The Citrus server is able to handle multiple WebSocket endpoints with different clients connected to it at the same time. This is why we have to choose the WebSocket endpoint on the server by its identifier when sending and receiving messages.</p>
</div>
<div class="paragraph">
<p>With this WebSocket endpoints we change the Citrus server behavior so that clients can upgrade to WebSocket connection. Now we have a bidirectional connection where the server can push messages to the client and vice versa.</p>
</div>
</div>
<div class="sect2">
<h3 id="websocket-headers"><a class="anchor" href="#websocket-headers"></a><a class="link" href="#websocket-headers">19.3. WebSocket headers</a></h3>
<div class="paragraph">
<p>The WebSocket standard defines some default headers to use during connection upgrade. These headers are made available to the test case in both directions. Citrus will handle these header values with special care when WebSocket support is activated on a server or client. Now WebSocket messages can also be split into multiple pieces. Each message part is pushed separately to the server but still is considered to be a single message payload. The server has to collect and aggregate all messages until a special message header <strong>isLast</strong> is set in one of the message parts.</p>
</div>
<div class="paragraph">
<p>The Citrus WebSocket client can slice messages into several parts.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">webSocketClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">json</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;data&gt;</span>
        [
            {
                &quot;event&quot; : &quot;client_message_1&quot;,
                &quot;timestamp&quot; : &quot;citrus:currentDate()&quot;
            },
        <span class="tag">&lt;/data&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;header&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_websocket_is_last</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/send&gt;</span>

<span class="tag">&lt;sleep</span> <span class="attribute-name">milliseconds</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">500</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">webSocketClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">json</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;data&gt;</span>
            {
                &quot;event&quot; : &quot;client_message_2&quot;,
                &quot;timestamp&quot; : &quot;citrus:currentDate()&quot;
            }
          ]
        <span class="tag">&lt;/data&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;header&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_websocket_is_last</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The test above has two separate send operations both sending to a WebSocket endpoint. The first sending action sets the header <strong>citrus_websocket_is_last</strong> to <strong>false</strong> which indicates that the message is not complete yet. The 2nd send action pushes the rest of the message to the server and set the <strong>citrus_websocket_is_last</strong> header to <strong>true</strong> . Now the server is able to aggregate the message pieces to a single message payload. The result is a valida JSON array with both events in it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">[
  {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">event</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">client_message_1</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">timestamp</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">2015-01-01</span><span class="delimiter">&quot;</span></span>
  },
  {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">event</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">client_message_2</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">timestamp</span><span class="delimiter">&quot;</span></span> : <span class="string"><span class="delimiter">&quot;</span><span class="content">2015-01-01</span><span class="delimiter">&quot;</span></span>
  }
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the server part in Citrus is able to handle these sliced messages, too. The server will automatically aggregate those message parts before passing it to the test case for validation.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="soap-webservices"><a class="anchor" href="#soap-webservices"></a><a class="link" href="#soap-webservices">20. SOAP WebServices</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>SOAP Web Services over HTTP is a widely used communication scenario in modern enterprise applications. A SOAP Web Service client is posting a SOAP request via HTTP to a server. SOAP via HTTP is a synchronous message protocol by default so the client is waiting synchronously for the response message. Citrus provides both SOAP client and server components in order to meet both directions of this scenario. The components used are very similar to the HTTP components that were have discussed in the sections before.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The SOAP WebService components in Citrus are kept in a separate Maven module. So you should add the module as Maven dependency to your project accordingly.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>com.consol.citrus<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>citrus-ws<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>2.7.3<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to use the SOAP WebService support you need to include the specific XML configuration schema provided by Citrus. See following XML definition to find out how to include the citrus-ws namespace.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:citrus</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/config</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:citrus-ws</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/ws/config</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
       <span class="content">http://www.springframework.org/schema/beans</span>
       <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
       <span class="content">http://www.citrusframework.org/schema/config</span>
       <span class="content">http://www.citrusframework.org/schema/config/citrus-config.xsd</span>
       <span class="content">http://www.citrusframework.org/schema/ws/config</span>
       <span class="content">http://www.citrusframework.org/schema/ws/config/citrus-ws-config.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    [...]

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you are ready to use the customized soap configuration elements - all using the citrus-ws prefix - in your Spring configuration.</p>
</div>
<div class="sect2">
<h3 id="soap-client"><a class="anchor" href="#soap-client"></a><a class="link" href="#soap-client">20.1. SOAP client</a></h3>
<div class="paragraph">
<p>Citrus is able to form a proper SOAP request in order to pass it to the server via HTTP and validate the respective SOAP response message. Let us see how a message client for SOAP looks like in the Spring configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ws:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span>
                       <span class="attribute-name">request-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8090/test</span><span class="delimiter">&quot;</span></span>
                       <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">60000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The client component uses the <strong>request-url</strong> in order to access the server resource. The client will automatically build a proper SOAP request message including the SOAP envelope, SOAP header and the message payload as SOAP body. This means that you as a tester do not care about SOAP envelope specific logic in the test case. The client endpoint component saves the synchronous SOAP response so the test case can receive this message with a normal receive test action.</p>
</div>
<div class="paragraph">
<p>In detail you as a tester just send and receive using the same client endpoint reference just as you would do with a synchronous JMS or channel communication. In case no response message is available in time according to the timeout settings Citrus raises a timeout error and the test will fail.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The SOAP client component uses a SoapMessageFactory implementation in order to create the SOAP messages. This is a Spring bean added to the Citrus Spring application context. Spring offers several reference implementations as message factories so you can choose one of them (e.g. for SOAP 1.1 or 1.2 implementations).
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- Default SOAP Message Factory (SOAP 1.1) --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.soap.saaj.SaajSoapMessageFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="comment">&lt;!-- SOAP 1.2 Message Factory --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soap12MessageFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.soap.saaj.SaajSoapMessageFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapVersion</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;util:constant</span> <span class="attribute-name">static-field</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.soap.SoapVersion.SOAP_12</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By default Citrus will search for a bean with id <strong>'messageFactory'</strong> . In case you intend to use different identifiers you need to tell the SOAP client component which message factory to use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ws:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">request-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8090/test</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">message-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soap12MessageFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Up to now we have used a static endpoint request url for the SOAP message sender. Besides that we can use dynamic endpoint uri in configuration. We just use an endpoint uri resolver instead of the static request url like this:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ws:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">endpoint-resolver</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dynamicEndpointResolver</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">message-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soap12MessageFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dynamicEndpointResolver</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.endpoint.resolver.DynamicEndpointUriResolver</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>dynamicEndpointResolver</strong> bean must implement the EndpointUriResolver interface in order to resolve dynamic endpoint uri values. Citrus offers a default implementation, the <strong>DynamicEndpointUriResolver</strong>, which uses a specific message header for setting the dynamic endpoint uri for each message. The message header needs to specify the header <strong>citrus_endpoint_uri</strong> with a valid request uri. Just like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;header&gt;</span>
  <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_endpoint_uri</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:${port}/${context}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/header&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see you can use dynamic test variables then in order to build the request uri to use. The SOAP client evaluates the endpoint uri header and sends the message to this server resource. You can use a different uri value then in different test cases and send actions.</p>
</div>
</div>
<div class="sect2">
<h3 id="soap-client-interceptors"><a class="anchor" href="#soap-client-interceptors"></a><a class="link" href="#soap-client-interceptors">20.2. SOAP client interceptors</a></h3>
<div class="paragraph">
<p>The client component is able to add custom interceptors that participate in the request/response processing. The interceptors need to implement the common interface <strong>org.springframework.ws.client.support.interceptor.ClientInterceptor</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ws:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secureSoapClient</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">request-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/services/ws/todolist</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">interceptors</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">clientInterceptors</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;util:list</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">clientInterceptors</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.soap.security.wss4j.Wss4jSecurityInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">securementActions</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Timestamp UsernameToken</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">securementUsername</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">securementPassword</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/bean&gt;</span>
  <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.ws.interceptor.LoggingClientInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/util:list&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The sample above adds Wss4J WsSecurity interceptors in order to add security constraints to the request messages.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When customizing the interceptor chain all default interceptors (like logging interceptor) are lost. You need to add these interceptors explicitly as shown with the <em>com.consol.citrus.ws.interceptor.LoggingClientInterceptor</em> which
is able to log request/response messages during communication.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="soap-server"><a class="anchor" href="#soap-server"></a><a class="link" href="#soap-server">20.3. SOAP server</a></h3>
<div class="paragraph">
<p>Every client need a server to talk to. When receiving SOAP messages we require a web server instance listening on a port. Citrus is using an embedded Jetty server instance in combination with the Spring Web Service API in order to accept SOAP request calls asa server. See how the Citrus SOAP server is configured in the Spring configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ws:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSoapServer</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8080</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">auto-start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">resource-base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">src/it/resources</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The server component is able to start automatically when application starts up. In the example above the server is listening for requests on port <strong><em>8080</em></strong> . This setup uses the standard connector configuration for the Jetty server. For detailed customization the Citrus Jetty server configuration also supports explicit connector configurations (@connector and @connectors attributes). For more information please see the Jetty connector documentation.</p>
</div>
<div class="paragraph">
<p>Test cases interact with this server instance via message channels by default. The server component provides an inbound channel that holds incoming request messages. The test case can receive those requests from the channel with a normal receive test action. In a second step the test case can provide a synchronous response message as reply which will be automatically sent back to the calling SOAP client as response.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/figure_010.jpg" alt="figure_010.jpg"></span></p>
</div>
<div class="paragraph">
<p>The figure above shows the basic setup with inbound channel and reply channel. You as a tester should not worry about this to much. By default you as a tester just use the server as synchronous endpoint in your test case. This means that you simply receive a message from the server and send a response back.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapServerTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSoapServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;message&gt;</span>
                <span class="tag">&lt;data&gt;</span>
                  [...]
                <span class="tag">&lt;/data&gt;</span>
            <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/receive&gt;</span>

        <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSoapServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;message&gt;</span>
                <span class="tag">&lt;data&gt;</span>
                  [...]
                <span class="tag">&lt;/data&gt;</span>
            <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/send&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see we reference the server id in both receive and send actions. The Citrus server instance will automatically send the response back to the calling client. In most cases this is what you need to simulate a SOAP server instance in Citrus. Of course we have some more customization possibilities that we will go over later on. This customizations are optional so you can also skip the next description on endpoint adapters if you are happy with just what you have learned about the SOAP server component in Citrus.</p>
</div>
<div class="paragraph">
<p>Just like the HTTP server component the SOAP server component by default uses the channel endpoint adapter in order to forward all incoming requests to an in memory message channel. This is done completely behind the scenes. The Citrus configuration has become a lot easier here so you do not have to configure this by default. When nothing else is set the test case does not worry about that settings on the server and just uses the server id reference as synchronous endpoint.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The default channel endpoint adapter automatically creates an inbound message channel where incoming messages are stored to internally. So if you need to clean up a server that has already stored some incoming messages you can do this easily by purging the internal message channel. The message channel follows a naming convention <strong>{serverName}.inbound</strong> where <strong>{serverName}</strong> is the Spring bean name of the Citrus server endpoint component. If you purge this internal channel in a before test nature you are sure that obsolete messages on a server instance get purged before each test is executed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>However we do not want to loose the great extendability and customizing capabilities of the Citrus server component. This is why you can optionally define the endpoint adapter implementation used by the Citrus SOAP server. We provide several message endpoint adapter implementations for different simulation strategies. With these endpoint adapters you should be able to generate proper SOAP response messages for the client in various ways. Before we have a closer look at the different adapter implementations we want to show how you can set a custom endpoint adapter on the server component.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ws:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSoapServer</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8080</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">auto-start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">endpoint-adapter</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">emptyResponseEndpointAdapter</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">resource-base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">src/it/resources</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

        <span class="tag">&lt;citrus:empty-response-adapter</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">emptyResponseEndpointAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With this endpoint adapter configuration above we change the Citrus server behavior from scratch. Now the server automatically sends back an empty SOAP response message every time. Setting a custom endpoint adapter implementation with custom logic is easy as defining a custom endpoint adapter Spring bean and reference it in the server attribute. You can read more about endpoint adapters in <a href="#endpoint-adapter">endpoint-adapter</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="soap-send-and-receive"><a class="anchor" href="#soap-send-and-receive"></a><a class="link" href="#soap-send-and-receive">20.4. SOAP send and receive</a></h3>
<div class="paragraph">
<p>Citrus provides test actions for sending and receiving messages of all kind. Different message content and different message transports are available to these send and receive actions. When using SOAP message transport we might need to set special information on that messages. These are special SOAP headers, SOAP faults and so on. So we have created a special SOAP namespace for all your SOAP related send and receive operations in a XML DSL test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;spring:beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/testcase</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xmlns:spring</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xmlns:ws</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/ws/testcase</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
          <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
          <span class="content">http://www.citrusframework.org/schema/testcase</span>
          <span class="content">http://www.citrusframework.org/schema/testcase/citrus-testcase.xsd</span>
          <span class="content">http://www.citrusframework.org/schema/ws/testcase</span>
          <span class="content">http://www.citrusframework.org/schema/ws/testcase/citrus-ws-testcase.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you have added the <strong>ws</strong> namespace from above to your test case you are ready to use special send and receive operations in the test.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">soap-action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MySoapService/sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        [...]
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/ws:send&gt;</span>

          <span class="tag">&lt;ws:receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapServer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">soap-action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MySoapService/sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        [...]
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/ws:receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The special namespace contains following elements:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
send
</td>
<td class="hdlist2">
<p>Special send operation for sending out SOAP message content.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
receive
</td>
<td class="hdlist2">
<p>Special receive operation for validating SOAP message content.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
send-fault
</td>
<td class="hdlist2">
<p>Special send operation for sending out SOAP fault message content.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
assert-fault
</td>
<td class="hdlist2">
<p>Special assertion operation for expecting a SOAP fault message as response.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The special SOAP related send and receive actions can coexist with normal Citrus actions. In fact you can mix those action types as you want inside of a test case. All test actions that work with SOAP message content on client and server side should use this special namespace.</p>
</div>
<div class="paragraph">
<p>In Java DSL we have something similar to that. The Java DSL provides special SOAP related features when calling the <strong>soap()</strong> method. With a fluent API you are able to then send and receive SOAP message content as client and server.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">@CitrusTest
public void soapTest() {

    soap().client(&quot;soapClient&quot;)
        .send()
        .soapAction(&quot;MySoapService/sayHello&quot;)
        .payload(&quot;...&quot;);

    soap().client(&quot;soapClient&quot;)
        .receive()
        .payload(&quot;...&quot;);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the following sections the SOAP related capabilities are discussed in more detail.</p>
</div>
</div>
<div class="sect2">
<h3 id="soap-headers"><a class="anchor" href="#soap-headers"></a><a class="link" href="#soap-headers">20.5. SOAP headers</a></h3>
<div class="paragraph">
<p>SOAP defines several header variations that we discuss in the following sections. First of all we deal with the special <strong>SOAP action</strong> header. In case we need to set this SOAP action header we simply need to use the special <strong><em>soap-action</em></strong> attribute in our test. The special header key in combination with a underlying SOAP client endpoint component constructs the SOAP action in the SOAP message.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">soap-action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MySoapService/sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        [...]
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/ws:send&gt;</span>

          <span class="tag">&lt;ws:receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapServer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">soap-action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MySoapService/sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        [...]
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/ws:receive&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">@CitrusTest
public void soapActionTest() {

    soap().client(&quot;soapClient&quot;)
        .send()
        .soapAction(&quot;MySoapService/sayHello&quot;)
        .payload(&quot;...&quot;);

    soap().server(&quot;soapClient&quot;)
        .receive()
        .soapAction(&quot;MySoapService/sayHello&quot;)
        .payload(&quot;...&quot;);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The SOAP action header is added to the message before sending and validated when used in a receive operation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <strong>soap-action</strong> attribute is defined in the special SOAP namespace in Citrus. We recommend to use this namespace for all your send and receive operations that deal with SOAP message content. However you can also set the special SOAP action header when not using the special SOAP namespace: Just set this header in your test action:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;header&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_soap_action</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/header&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Secondly a SOAP message is able to contain customized SOAP headers. These are key-value pairs where the key is a qualified name (QName) and the value a normal String value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;header&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{http://www.consol.de/sayHello}h1:Operation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{http://www.consol.de/sayHello}h1:Request</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HelloRequest</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/header&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The key is defined as qualified QName character sequence which has a mandatory XML namespace and a prefix along with a header name. Last not least a SOAP header can contain whole XML fragment values. The next example shows how to set these XML fragments as SOAP header in Citrus:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;header&gt;</span>
    <span class="tag">&lt;data&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
          &lt;User xmlns=&quot;http://www.consol.de/schemas/sayHello&quot;&gt;
              &lt;UserId&gt;123456789&lt;/UserId&gt;
              &lt;Handshake&gt;S123456789&lt;/Handshake&gt;
          &lt;/User&gt;
      <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/data&gt;</span>
<span class="tag">&lt;/header&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use external file resources to set this SOAP header XML fragment as shown in this last example code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;header&gt;</span>
    <span class="tag">&lt;resource</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:request-soap-header.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/header&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This completes the SOAP header possibilities for sending SOAP messages with Citrus. Of course you can also use these variants in SOAP message header validation. You define expected SOAP headers, SOAP action and XML fragments and Citrus will match incoming request to that. Just use <strong>citrus_soap_action</strong> header key in your receiving message action and you validate this SOAP header accordingly.</p>
</div>
<div class="paragraph">
<p>When validating SOAP header XML fragments you need to define the whole XML header fragment as expected header data like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapMessageEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;data&gt;</span>
          <span class="inline-delimiter">&lt;![CDATA[</span>
            &lt;ResponseMessage xmlns=&quot;http://citrusframework.org/schema&quot;&gt;
              &lt;resultCode&gt;OK&lt;/resultCode&gt;
            &lt;/ResponseMessage&gt;
          <span class="inline-delimiter">]]&gt;</span>
        <span class="tag">&lt;/data&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;header&gt;</span>
        <span class="tag">&lt;data&gt;</span>
            <span class="inline-delimiter">&lt;![CDATA[</span>
                &lt;SOAP-ENV:Header
                    xmlns:SOAP-ENV=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;
                    &lt;customHeader xmlns=&quot;http://citrusframework.org/headerschema&quot;&gt;
                        &lt;correlationId&gt;${correlationId}&lt;/correlationId&gt;
                        &lt;applicationId&gt;${applicationId}&lt;/applicationId&gt;
                        &lt;trackingId&gt;${trackingId}&lt;/trackingId&gt;
                        &lt;serviceId&gt;${serviceId}&lt;/serviceId&gt;
                        &lt;interfaceVersion&gt;1.0&lt;/interfaceVersion&gt;
                        &lt;timestamp&gt;@ignore@&lt;/timestamp&gt;
                    &lt;/customHeader&gt;
                &lt;/SOAP-ENV:Header&gt;
            <span class="inline-delimiter">]]&gt;</span>
        <span class="tag">&lt;/data&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_soap_action</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">doResponse</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the SOAP XML header validation can combine header element and XML fragment validation. This is also likely to be used when dealing with WS-Security message headers.</p>
</div>
</div>
<div class="sect2">
<h3 id="soap-http-mime-headers"><a class="anchor" href="#soap-http-mime-headers"></a><a class="link" href="#soap-http-mime-headers">20.6. SOAP HTTP mime headers</a></h3>
<div class="paragraph">
<p>Besides the SOAP specific header elements the HTTP mime headers (e.g. Content-Type, Content-Length, Authorization) might be candidates for validation, too. When using HTTP as transport layer the SOAP message may define those mime headers. The tester is able to send and validate these headers inside the test case, although these HTTP headers are located outside of the SOAP envelope. Let us first of all speak about validating the HTTP mime headers. This feature is not enabled by default. We have enable this in our SOAP server configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ws:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSoapServer</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8080</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">auto-start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">handle-mime-headers</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">resource-base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">src/it/resources</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With this configuration Citrus will handle all available mime headers and pass those to the test case for normal header validation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSoapServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;SoapMessageRequest</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.consol.de/schemas/sample.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;Operation&gt;</span>Validate mime headers<span class="tag">&lt;/Operation&gt;</span>
            <span class="tag">&lt;/SoapMessageRequest&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;header&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/xml; charset=utf-8</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/ws:receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The validation of these HTTP mime headers is as usual now that we have enabled the mime header handling in the SOAP server. The transport HTTP headers are available in the header just like the normal SOAP header elements do. So you can validate the headers as usual.</p>
</div>
<div class="paragraph">
<p>So much for receiving and validating HTTP mime message headers with SOAP communication. Now we want to send special mime headers on client side. We overwrite or add mime headers to our sending action. We mark some headers with following prefix <strong><em>"citrus_http</em>"_</strong> . This tells the SOAP client to add these headers to the HTTP header section outside the SOAP envelope. Keep in mind that header elements without this prefix go right into the SOAP header section by default.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  [...]
  <span class="tag">&lt;header&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_http_operation</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/header&gt;</span>
  [...]
<span class="tag">&lt;/ws:send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The listing above defines a HTTP mime header <strong>operation</strong> . The header prefix <strong><em>citrus_http_</em></strong> is cut off before the header goes into the HTTP header section. With this feature we can decide where exactly our header information is located in our resulting client message.</p>
</div>
</div>
<div class="sect2">
<h3 id="soap-envelope-handling"><a class="anchor" href="#soap-envelope-handling"></a><a class="link" href="#soap-envelope-handling">20.7. SOAP Envelope handling</a></h3>
<div class="paragraph">
<p>By default Citrus will remove the SOAP envelope in message converter. Following from that the Citrus test case is independent from SOAP message formats and is not bothered with handling of SOAP envelope at all. This is great in most cases but sometimes it might be mandatory to also see the whole SOAP envelope inside the test case receive action. Therefore you can keep the SOAP envelope for incoming messages by configuration on the SOAP server side.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ws:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSoapServer</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8080</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">auto-start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">keep-soap-envelope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With this configuration Citrus will handle all available mime headers and pass those to the test case for normal header validation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSoapServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;message&gt;</span>
  <span class="tag">&lt;payload&gt;</span>
    <span class="tag">&lt;SOAP-ENV:Envelope</span> <span class="attribute-name">xmlns:SOAP-ENV</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://schemas.xmlsoap.org/soap/envelope/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;SOAP-ENV:Header</span><span class="tag">/&gt;</span>
      <span class="tag">&lt;SOAP-ENV:Body&gt;</span>
        <span class="tag">&lt;SoapMessageRequest</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.consol.de/schemas/sample.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;Operation&gt;</span>Validate mime headers<span class="tag">&lt;/Operation&gt;</span>
        <span class="tag">&lt;/SoapMessageRequest&gt;</span>
      <span class="tag">&lt;/SOAP-ENV:Body&gt;</span>
    <span class="tag">&lt;/SOAP-ENV:Envelope&gt;</span>
  <span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/ws:receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So now you are able to validate the whole SOAP envelope as is. This might be of interest in very special cases. As mentioned by default the Citrus server will automatically remove the SOAP envelope and translate the SOAP body to the message payload for straight forward validation inside the test cases.</p>
</div>
</div>
<div class="sect2">
<h3 id="soap-server-interceptors"><a class="anchor" href="#soap-server-interceptors"></a><a class="link" href="#soap-server-interceptors">20.8. SOAP server interceptors</a></h3>
<div class="paragraph">
<p>The Citrus SOAP server supports the concept of interceptors in order to add custom logic to the request/response processing steps. The interceptors need to implement a common interface: <strong>org.springframework.ws.server.EndpointInterceptor</strong>. We are able to customize the interceptor
chain on the server component as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ws:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secureSoapServer</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8080</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">auto-start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">interceptors</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serverInterceptors</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;util:list</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">serverInterceptors</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.ws.interceptor.SoapMustUnderstandEndpointInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">acceptedHeaders</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;list&gt;</span>
        <span class="tag">&lt;value&gt;</span>{http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd}Security<span class="tag">&lt;/value&gt;</span>
      <span class="tag">&lt;/list&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;/bean&gt;</span>
  <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.ws.interceptor.LoggingEndpointInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.soap.security.wss4j.Wss4jSecurityInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">validationActions</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Timestamp UsernameToken</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">validationCallbackHandler</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">passwordCallbackHandler</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.soap.security.wss4j.callback.SimplePasswordValidationCallbackHandler</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">usersMap</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;map&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;/map&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
      <span class="tag">&lt;/bean&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;/util:list&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The custom interceptors are used to enable WsSecurity features on the soap server component via Wss4J.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When customizing the interceptor chain of the soap server component all default interceptors (like logging interceptors) are lost. You can see that we had to add
the <em>com.consol.citrus.ws.interceptor.LoggingEndpointInterceptor</em> explicitly in order to log request/response messages for the server communication.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="soap-1-2"><a class="anchor" href="#soap-1-2"></a><a class="link" href="#soap-1-2">20.9. SOAP 1.2</a></h3>
<div class="paragraph">
<p>By default Citrus components use SOAP 1.1 version. Fortunately SOAP 1.2 is supported same way. As we already mentioned before the Citrus SOAP components do use a SOAP message factory for creating messages in SOAP format.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- SOAP 1.1 Message Factory --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapMessageFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.soap.saaj.SaajSoapMessageFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapVersion</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;util:constant</span> <span class="attribute-name">static-field</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.soap.SoapVersion.SOAP_11</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="comment">&lt;!-- SOAP 1.2 Message Factory --&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soap12MessageFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.soap.saaj.SaajSoapMessageFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapVersion</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;util:constant</span> <span class="attribute-name">static-field</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.soap.SoapVersion.SOAP_12</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the SOAP message factory can either create SOAP 1.1 or SOAP 1.2 messages. This is how Citrus can create both SOAP 1.1 and SOAP 1.2 messages. Of course you can have multiple message factories configured in your project. Just set the message factory on a WebService client or server component in order to define which version should be used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ws:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soap12Client</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">request-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/echo</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">message-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soap12MessageFactory</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;citrus-ws:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soap12Server</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8080</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">auto-start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">root-parent-context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">message-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soap12MessageFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By default Citrus components do connect with a message factory called <strong>messageFactory</strong> no matter what SOAP version this factory is using.</p>
</div>
</div>
<div class="sect2">
<h3 id="soap-faults"><a class="anchor" href="#soap-faults"></a><a class="link" href="#soap-faults">20.10. SOAP faults</a></h3>
<div class="paragraph">
<p>SOAP faults describe a failed communication in SOAP WebServices world. Citrus is able to send and receive SOAP fault messages. On server side Citrus can simulate SOAP faults with fault-code, fault-reason, fault-actor and fault-detail. On client side Citrus is able to handle and validate SOAP faults in response messages. The next section describes how to deal with SOAP faults in Citrus.</p>
</div>
</div>
<div class="sect2">
<h3 id="send-soap-faults"><a class="anchor" href="#send-soap-faults"></a><a class="link" href="#send-soap-faults">20.11. Send SOAP faults</a></h3>
<div class="paragraph">
<p>As Citrus simulates SOAP server endpoints you also need to think about sending a SOAP fault to the calling client. In case Citrus receives a SOAP request as a server you can respond with a proper SOAP fault if necessary.</p>
</div>
<div class="paragraph">
<p>Please keep in mind that we use the citrus-ws extension for sending SOAP faults in our test case, as shown in this very simple example:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:send-fault</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSoapServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;ws:fault&gt;</span>
        <span class="tag">&lt;ws:fault-code&gt;</span>{http://www.citrusframework.org/faults}citrus:TEC-1000<span class="tag">&lt;/ws:fault-code&gt;</span>
        <span class="tag">&lt;ws:fault-string&gt;</span>Invalid request<span class="tag">&lt;/ws:fault-string&gt;</span>
        <span class="tag">&lt;ws:fault-actor&gt;</span>SERVER<span class="tag">&lt;/ws:fault-actor&gt;</span>
        <span class="tag">&lt;ws:fault-detail&gt;</span>
            <span class="inline-delimiter">&lt;![CDATA[</span>
                &lt;FaultDetail xmlns=&quot;http://www.consol.de/schemas/sayHello.xsd&quot;&gt;
                    &lt;MessageId&gt;${messageId}&lt;/MessageId&gt;
                    &lt;CorrelationId&gt;${correlationId}&lt;/CorrelationId&gt;
                    &lt;ErrorCode&gt;TEC-1000&lt;/ErrorCode&gt;
                    &lt;Text&gt;Invalid request&lt;/Text&gt;
                &lt;/FaultDetail&gt;
            <span class="inline-delimiter">]]&gt;</span>
        <span class="tag">&lt;/ws:fault-detail&gt;</span>
    <span class="tag">&lt;/ws:fault&gt;</span>
    <span class="tag">&lt;ws:header&gt;</span>
        <span class="tag">&lt;ws:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_soap_action</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/ws:header&gt;</span>
<span class="tag">&lt;/ws:send-fault&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The example generates a simple SOAP fault that is sent back to the calling client. The fault-actor and the fault-detail elements are optional. Same with the soap action declared in the special Citrus header <strong><em>citrus_soap_action</em></strong> . In the sample above the fault-detail data is placed inline as XML data. As an alternative to that you can also set the fault-detail via external file resource. Just use the <strong><em>file</em></strong> attribute as fault detail instead of the inline CDATA definition.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:send-fault</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSoapServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;ws:fault&gt;</span>
        <span class="tag">&lt;ws:fault-code&gt;</span>{http://www.citrusframework.org/faults}citrus:TEC-1000<span class="tag">&lt;/ws:fault-code&gt;</span>
        <span class="tag">&lt;ws:fault-string&gt;</span>Invalid request<span class="tag">&lt;/ws:fault-string&gt;</span>
        <span class="tag">&lt;ws:fault-actor&gt;</span>SERVER<span class="tag">&lt;/ws:fault-actor&gt;</span>
        <span class="tag">&lt;ws:fault-detail</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:myFaultDetail.xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/ws:fault&gt;</span>
    <span class="tag">&lt;ws:header&gt;</span>
        <span class="tag">&lt;ws:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_soap_action</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/ws:header&gt;</span>
<span class="tag">&lt;/ws:send-fault&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The generated SOAP fault looks like follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">HTTP/1.1 500 Internal Server Error
Accept: text/xml, text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2
SOAPAction: &quot;sayHello&quot;
Content-Type: text/xml; charset=utf-8
Content-Length: 680
Server: Jetty(7.0.0.pre5)

<span class="tag">&lt;SOAP-ENV:Envelope</span> <span class="attribute-name">xmlns:SOAP-ENV</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://schemas.xmlsoap.org/soap/envelope/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;SOAP-ENV:Header</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;SOAP-ENV:Body&gt;</span>
        <span class="tag">&lt;SOAP-ENV:Fault&gt;</span>
            <span class="tag">&lt;faultcode</span> <span class="attribute-name">xmlns:citrus</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/faults</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>citrus:TEC-1000<span class="tag">&lt;/faultcode&gt;</span>
            <span class="tag">&lt;faultstring</span> <span class="attribute-name">xml:lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Invalid request<span class="tag">&lt;/faultstring&gt;</span>
            <span class="tag">&lt;detail&gt;</span>
                <span class="tag">&lt;FaultDetail</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.consol.de/schemas/sayHello.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;MessageId&gt;</span>9277832563<span class="tag">&lt;/MessageId&gt;</span>
                    <span class="tag">&lt;CorrelationId&gt;</span>4346806225<span class="tag">&lt;/CorrelationId&gt;</span>
                    <span class="tag">&lt;ErrorCode&gt;</span>TEC-1000<span class="tag">&lt;/ErrorCode&gt;</span>
                    <span class="tag">&lt;Text&gt;</span>Invalid request<span class="tag">&lt;/Text&gt;</span>
                <span class="tag">&lt;/FaultDetail&gt;</span>
            <span class="tag">&lt;/detail&gt;</span>
        <span class="tag">&lt;/SOAP-ENV:Fault&gt;</span>
    <span class="tag">&lt;/SOAP-ENV:Body&gt;</span>
<span class="tag">&lt;/SOAP-ENV:Envelope&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Notice that the send action uses a special XML namespace (ws:send). This ws namespace belongs to the Citrus WebService extension and adds SOAP specific features to the normal send action. When you use such ws extensions you need to define the additional namespace in your test case. This is usually done in the root <code>&lt;spring:beans&gt;</code> element where we simply declare the citrus-ws specific namespace like follows.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;spring:beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/testcase</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:spring</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:ws</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/ws/testcase</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
    <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
    <span class="content">http://www.citrusframework.org/schema/testcase</span>
    <span class="content">http://www.citrusframework.org/schema/testcase/citrus-testcase.xsd</span>
    <span class="content">http://www.citrusframework.org/schema/ws/testcase</span>
    <span class="content">http://www.citrusframework.org/schema/ws/testcase/citrus-ws-testcase.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="receive-soap-faults"><a class="anchor" href="#receive-soap-faults"></a><a class="link" href="#receive-soap-faults">20.12. Receive SOAP faults</a></h3>
<div class="paragraph">
<p>In case you receive SOAP response messages as a client endpoint you may need to handle and validate SOAP faults in error situations. Citrus can validate SOAP faults with fault-code, fault-actor, fault-string and fault-detail values.</p>
</div>
<div class="paragraph">
<p>As a client we send out a request and receive a SOAP fault as response. By default the client sending action in Citrus throws a specific exception when the SOAP response is a SOAP fault element. This exception is called <strong><em>SoapFaultClientException</em></strong> coming from the Spring API. You as a tester can assert this kind of exception in a test case in order to expect the SOAP error.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;assert</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.soap.client.SoapFaultClientException</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;message&gt;</span>
            <span class="tag">&lt;payload&gt;</span>
                <span class="tag">&lt;SoapFaultForcingRequest</span>
                  <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.consol.de/schemas/soap</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;Message&gt;</span>This is invalid<span class="tag">&lt;/Message&gt;</span>
                <span class="tag">&lt;/SoapFaultForcingRequest&gt;</span>
            <span class="tag">&lt;/payload&gt;</span>
        <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;/send&gt;</span>
<span class="tag">&lt;/assert&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The SOAP message sending action is surrounded by a simple assert action. The asserted exception class is the <strong><em>SoapFaultClientException</em></strong> that we have mentioned before. This means that the test expects the exception to be thrown during the communication. In case the exception is missing the test is fails.</p>
</div>
<div class="paragraph">
<p>So far we have used the Citrus core capabilities of asserting an exception. This basic assertion test action is not able to offer direct access to the SOAP fault-code and fault-string values for validation. The basic assert action simply has no access to the actual SOAP fault elements. Fortunately we can use the <strong>citrus-ws</strong> namespace again which offers a special assert action implementation especially designed for SOAP faults in this case.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:assert-fault</span> <span class="attribute-name">fault-code</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{http://www.citrusframework.org/faults}TEC-1001</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">fault-string</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Invalid request</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
           fault-actor=&quot;SERVER&quot;<span class="error">&gt;</span>
  <span class="tag">&lt;ws:when&gt;</span>
    <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;message&gt;</span>
            <span class="tag">&lt;payload&gt;</span>
                <span class="tag">&lt;SoapFaultForcingRequest</span>
                  <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.consol.de/schemas/soap</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;Message&gt;</span>This is invalid<span class="tag">&lt;/Message&gt;</span>
                <span class="tag">&lt;/SoapFaultForcingRequest&gt;</span>
            <span class="tag">&lt;/payload&gt;</span>
        <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;/send&gt;</span>
  <span class="tag">&lt;/ws:when&gt;</span>
<span class="tag">&lt;/ws:assert-fault&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The special assert action offers several attributes to validate the expected SOAP fault. Namely these are <strong>"fault-code"</strong>, <strong>"fault-string"</strong> and <strong>"fault-actor"</strong> . The <strong>fault-code</strong> is defined as a QName string and is mandatory for the validation. The fault assertion also supports test variable replacement as usual.</p>
</div>
<div class="paragraph">
<p>The time you use SOAP fault validation you need to tell Citrus how to validate the SOAP faults. Citrus needs an instance of a <strong><em>SoapFaultValitator</em></strong> that we need to add to the Spring application context. By default Citrus is searching for a bean with the id <strong>'soapFaultValidator'</strong> .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapFaultValidator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.ws.validation.SimpleSoapAttachmentValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus offers several reference implementations for these SOAP fault validators. These are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>com.consol.citrus.ws.validation.SimpleSoapAttachmentValidator</p>
</li>
<li>
<p>com.consol.citrus.ws.validation.SimpleSoapFaultValidator</p>
</li>
<li>
<p>com.consol.citrus.ws.validation.XmlSoapFaultValidator</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please see the API documentation for details on the available reference implementations. Of course you can also define your own SOAP validator logic (would be great if you could share your ideas!). In the test case you can explicitly choose the validator to use:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:assert-fault</span> <span class="attribute-name">fault-code</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{http://www.citrusframework.org/faults}TEC-1001</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">fault-string</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Invalid request</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">fault-validator</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mySpecialSoapFaultValidator</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   [...]
<span class="tag">&lt;/ws:assert-fault&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Another important thing to notice when asserting SOAP faults is the fact, that Citrus needs to have a <strong><em>SoapMessageFactory</em></strong> available in the Spring application context. If you deal with SOAP messaging in general you will already have such a bean in the context.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.soap.saaj.SaajSoapMessageFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Choose one of Spring&#8217;s reference implementations or some other implementation as SOAP message factory. Citrus will search for a bean with id <strong>'messageFactory'</strong> by default. In case you have other beans with different identifiers please choose the messageFactory in the test case assert action:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:assert-fault</span> <span class="attribute-name">fault-code</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{http://www.citrusframework.org/faults}TEC-1001</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">fault-string</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Invalid request</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">message-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mySpecialMessageFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   [...]
<span class="tag">&lt;/ws:assert-fault&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Notice the ws specific namespace that belongs to the Citrus WebService extensions. As the <strong>ws:assert</strong> action uses SOAP specific features we need to refer to the citrus-ws namespace. You can find the namespace declaration in the root element in your test case.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;spring:beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/testcase</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:spring</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:ws</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/ws/testcase</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
    <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
    <span class="content">http://www.citrusframework.org/schema/testcase</span>
    <span class="content">http://www.citrusframework.org/schema/testcase/citrus-testcase.xsd</span>
    <span class="content">http://www.citrusframework.org/schema/ws/testcase</span>
    <span class="content">http://www.citrusframework.org/schema/ws/testcase/citrus-ws-testcase.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus is also able to validate SOAP fault details. See the following example for understanding how to do it:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:assert-fault</span> <span class="attribute-name">fault-code</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{http://www.citrusframework.org/faults}TEC-1001</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">fault-string</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Invalid request</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;ws:fault-detail&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
          &lt;FaultDetail xmlns=&quot;http://www.consol.de/schemas/soap&quot;&gt;
              &lt;ErrorCode&gt;TEC-1000&lt;/ErrorCode&gt;
              &lt;Text&gt;Invalid request&lt;/Text&gt;
          &lt;/FaultDetail&gt;
      <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/ws:fault-detail&gt;</span>
    <span class="tag">&lt;ws:when&gt;</span>
        <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;message&gt;</span>
                <span class="tag">&lt;payload&gt;</span>
                    <span class="tag">&lt;SoapFaultForcingRequest</span>
                      <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.consol.de/schemas/soap</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                        <span class="tag">&lt;Message&gt;</span>This is invalid<span class="tag">&lt;/Message&gt;</span>
                    <span class="tag">&lt;/SoapFaultForcingRequest&gt;</span>
                <span class="tag">&lt;/payload&gt;</span>
            <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/send&gt;</span>
    <span class="tag">&lt;/ws:when&gt;</span>
<span class="tag">&lt;/ws:assert-fault&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The expected SOAP fault detail content is simply added to the <strong>ws:assert</strong> action. The <strong><em>SoapFaultValidator</em></strong> implementation defined in the Spring application context is responsible for checking the SOAP fault detail with validation algorithm. The validator implementation checks the detail content to meet the expected template. Citrus provides some default <strong><em>SoapFaultValidator</em></strong> implementations. Supported algorithms are pure String comparison (<strong>com.consol.citrus.ws.validation.SimpleSoapFaultValidator</strong>) as well as XML tree walk-through (<strong>com.consol.citrus.ws.validation.XmlSoapFaultValidator</strong>).</p>
</div>
<div class="paragraph">
<p>When using the XML validation algorithm you have the complete power as known from normal message validation in receive actions. This includes schema validation or ignoring elements for instance. On the fault-detail element you are able to add some validation settings such as <strong>schema-validation=enabled/disabled</strong>, custom <strong>schema-repository</strong> and so on.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:assert-fault</span> <span class="attribute-name">fault-code</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{http://www.citrusframework.org/faults}TEC-1001</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">fault-string</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Invalid request</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;ws:fault-detail</span> <span class="attribute-name">schema-validation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
          &lt;FaultDetail xmlns=&quot;http://www.consol.de/schemas/soap&quot;&gt;
              &lt;ErrorCode&gt;TEC-1000&lt;/ErrorCode&gt;
              &lt;Text&gt;Invalid request&lt;/Text&gt;
          &lt;/FaultDetail&gt;
      <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/ws:fault-detail&gt;</span>
    <span class="tag">&lt;ws:when&gt;</span>
        <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            [...]
        <span class="tag">&lt;/send&gt;</span>
    <span class="tag">&lt;/ws:when&gt;</span>
<span class="tag">&lt;/ws:assert-fault&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Please see also the Citrus API documentation for available validator implementations and validation algorithms.</p>
</div>
<div class="paragraph">
<p>So far we have used assert action wrapper in order to catch SOAP fault exceptions and validate the SOAP fault content. Now we have an alternative way of handling SOAP faults in Citrus. With exceptions the send action aborts and we do not have a receive action for the SOAP fault. This might be inadequate if we need to validate the SOAP message content (SOAPHeader and SOAPBody) coming with the SOAP fault. Therefore the web service message sender component offers several fault strategy options. In the following we discuss the propagation of SOAP fault as messages to the receive action as we would do with normal SOAP messages.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ws:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span>
                               <span class="attribute-name">request-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8090/test</span><span class="delimiter">&quot;</span></span>
                               <span class="attribute-name">fault-strategy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">propagateError</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We have configured a fault strategy <strong>propagateError</strong> so the message sender will not raise client exceptions but inform the receive action with SOAP fault message contents. By default the fault strategy raises client exceptions (fault-strategy= <strong>throwsException</strong>).</p>
</div>
<div class="paragraph">
<p>So now that we do not raise exceptions we can leave out the assert action wrapper in our test. Instead we simply use a receive action and validate the SOAP fault like this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;SoapFaultForcingRequest</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.consol.de/schemas/sample.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;Message&gt;</span>This is invalid<span class="tag">&lt;/Message&gt;</span>
            <span class="tag">&lt;/SoapFaultForcingRequest&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span>

<span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5000</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;SOAP-ENV:Fault</span> <span class="attribute-name">xmlns:SOAP-ENV</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://schemas.xmlsoap.org/soap/envelope/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;faultcode</span> <span class="attribute-name">xmlns:CITRUS</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrus.org/soap</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>CITRUS:${soapFaultCode}<span class="tag">&lt;/faultcode&gt;</span>
                <span class="tag">&lt;faultstring</span> <span class="attribute-name">xml:lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>${soapFaultString}<span class="tag">&lt;/faultstring&gt;</span>
            <span class="tag">&lt;/SOAP-ENV:Fault&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So choose the preferred way of handling SOAP faults either by asserting client exceptions or propagating fault messages to the receive action on a SOAP client.</p>
</div>
</div>
<div class="sect2">
<h3 id="multiple-soap-fault-details"><a class="anchor" href="#multiple-soap-fault-details"></a><a class="link" href="#multiple-soap-fault-details">20.13. Multiple SOAP fault details</a></h3>
<div class="paragraph">
<p>SOAP fault messages can hold multiple SOAP fault detail elements. In the previous sections we have used SOAP fault details in sending and receiving actions as single element. In order to meet the SOAP specification Citrus is also able to handle multiple SOAP fault detail elements in a message. You just use multiple fault-detail elements in your test action like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:send-fault</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSoapServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;ws:fault&gt;</span>
        <span class="tag">&lt;ws:fault-code&gt;</span>{http://www.citrusframework.org/faults}citrus:TEC-1000<span class="tag">&lt;/ws:fault-code&gt;</span>
        <span class="tag">&lt;ws:fault-string&gt;</span>Invalid request<span class="tag">&lt;/ws:fault-string&gt;</span>
        <span class="tag">&lt;ws:fault-actor&gt;</span>SERVER<span class="tag">&lt;/ws:fault-actor&gt;</span>
        <span class="tag">&lt;ws:fault-detail&gt;</span>
            <span class="inline-delimiter">&lt;![CDATA[</span>
                &lt;FaultDetail xmlns=&quot;http://www.consol.de/schemas/sayHello.xsd&quot;&gt;
                    &lt;MessageId&gt;${messageId}&lt;/MessageId&gt;
                    &lt;CorrelationId&gt;${correlationId}&lt;/CorrelationId&gt;
                    &lt;ErrorCode&gt;TEC-1000&lt;/ErrorCode&gt;
                    &lt;Text&gt;Invalid request&lt;/Text&gt;
                &lt;/FaultDetail&gt;
            <span class="inline-delimiter">]]&gt;</span>
        <span class="tag">&lt;/ws:fault-detail&gt;</span>
        <span class="tag">&lt;ws:fault-detail&gt;</span>
            <span class="inline-delimiter">&lt;![CDATA[</span>
                &lt;ErrorDetail xmlns=&quot;http://www.consol.de/schemas/sayHello.xsd&quot;&gt;
                    &lt;ErrorCode&gt;TEC-1000&lt;/ErrorCode&gt;
                &lt;/ErrorDetail&gt;
            <span class="inline-delimiter">]]&gt;</span>
        <span class="tag">&lt;/ws:fault-detail&gt;</span>
    <span class="tag">&lt;/ws:fault&gt;</span>
    <span class="tag">&lt;ws:header&gt;</span>
        <span class="tag">&lt;ws:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_soap_action</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/ws:header&gt;</span>
<span class="tag">&lt;/ws:send-fault&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This will result in following SOAP envelope message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">HTTP/1.1 500 Internal Server Error
Accept: text/xml, text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2
SOAPAction: &quot;sayHello&quot;
Content-Type: text/xml; charset=utf-8
Content-Length: 680
Server: Jetty(7.0.0.pre5)

<span class="tag">&lt;SOAP-ENV:Envelope</span> <span class="attribute-name">xmlns:SOAP-ENV</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://schemas.xmlsoap.org/soap/envelope/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;SOAP-ENV:Header</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;SOAP-ENV:Body&gt;</span>
        <span class="tag">&lt;SOAP-ENV:Fault&gt;</span>
            <span class="tag">&lt;faultcode</span> <span class="attribute-name">xmlns:citrus</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/faults</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>citrus:TEC-1000<span class="tag">&lt;/faultcode&gt;</span>
            <span class="tag">&lt;faultstring</span> <span class="attribute-name">xml:lang</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Invalid request<span class="tag">&lt;/faultstring&gt;</span>
            <span class="tag">&lt;detail&gt;</span>
                <span class="tag">&lt;FaultDetail</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.consol.de/schemas/sayHello.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;MessageId&gt;</span>9277832563<span class="tag">&lt;/MessageId&gt;</span>
                    <span class="tag">&lt;CorrelationId&gt;</span>4346806225<span class="tag">&lt;/CorrelationId&gt;</span>
                    <span class="tag">&lt;ErrorCode&gt;</span>TEC-1000<span class="tag">&lt;/ErrorCode&gt;</span>
                    <span class="tag">&lt;Text&gt;</span>Invalid request<span class="tag">&lt;/Text&gt;</span>
                <span class="tag">&lt;/FaultDetail&gt;</span>
                <span class="tag">&lt;ErrorDetail</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.consol.de/schemas/sayHello.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;ErrorCode&gt;</span>TEC-1000<span class="tag">&lt;/ErrorCode&gt;</span>
                <span class="tag">&lt;/ErrorDetail&gt;</span>
            <span class="tag">&lt;/detail&gt;</span>
        <span class="tag">&lt;/SOAP-ENV:Fault&gt;</span>
    <span class="tag">&lt;/SOAP-ENV:Body&gt;</span>
<span class="tag">&lt;/SOAP-ENV:Envelope&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course we can also expect several fault detail elements when receiving a SOAP fault.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:assert-fault</span> <span class="attribute-name">fault-code</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{http://www.citrusframework.org/faults}TEC-1001</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">fault-string</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Invalid request</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;ws:fault-detail</span> <span class="attribute-name">schema-validation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
          &lt;FaultDetail xmlns=&quot;http://www.consol.de/schemas/soap&quot;&gt;
              &lt;ErrorCode&gt;TEC-1000&lt;/ErrorCode&gt;
              &lt;Text&gt;Invalid request&lt;/Text&gt;
          &lt;/FaultDetail&gt;
      <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/ws:fault-detail&gt;</span>
    <span class="tag">&lt;ws:fault-detail&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
          &lt;ErrorDetail xmlns=&quot;http://www.consol.de/schemas/soap&quot;&gt;
              &lt;ErrorCode&gt;TEC-1000&lt;/ErrorCode&gt;
          &lt;/ErrorDetail&gt;
      <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/ws:fault-detail&gt;</span>
    <span class="tag">&lt;ws:when&gt;</span>
        <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            [...]
        <span class="tag">&lt;/send&gt;</span>
    <span class="tag">&lt;/ws:when&gt;</span>
<span class="tag">&lt;/ws:assert-fault&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see we can individually use validation settings for each fault detail. In the example above we disabled schema validation for the first fault detail element.</p>
</div>
</div>
<div class="sect2">
<h3 id="send-http-error-codes-with-soap"><a class="anchor" href="#send-http-error-codes-with-soap"></a><a class="link" href="#send-http-error-codes-with-soap">20.14. Send HTTP error codes with SOAP</a></h3>
<div class="paragraph">
<p>The SOAP server logic in Citrus is able to simulate pure HTTP error codes such as 404 "Not found" or 500 "Internal server error". The good thing is that the Citrus server is able to receive a request for proper validation in a receive action and then simulate HTTP errors on demand.</p>
</div>
<div class="paragraph">
<p>The mechanism on HTTP error code simulation is not different to the usual SOAP request/response handling in Citrus. We receive the request as usual and we provide a response. The HTTP error situation is simulated according to the special HTTP header <strong>citrus_http_status</strong> in the Citrus SOAP response definition. In case this header is set to a value other than 200 OK the Citrus SOAP server sends an empty SOAP response with HTTP error status code set accordingly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSoapServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message&gt;</span>
      <span class="tag">&lt;payload&gt;</span>
          <span class="tag">&lt;Message</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://consol.de/schemas/sample.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
              <span class="tag">&lt;Text&gt;</span>Hello SOAP server<span class="tag">&lt;/Text&gt;</span>
          <span class="tag">&lt;/Message&gt;</span>
      <span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span>

<span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSoapServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;data&gt;</span><span class="tag">&lt;/data&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;header&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_http_status_code</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">500</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The SOAP response must be empty and the HTTP status code is set to a value other than 200, like 500. This results in a HTTP error sent to the calling client with error 500 "Internal server error".</p>
</div>
</div>
<div class="sect2">
<h3 id="soap-attachment"><a class="anchor" href="#soap-attachment"></a><a class="link" href="#soap-attachment">20.15. SOAP attachment support</a></h3>
<div class="paragraph">
<p>Citrus is able to add attachments to a SOAP request on client and server side. As usual you can validate the SOAP attachment content on a received SOAP message. The next chapters describe how to handle SOAP attachments in Citrus.</p>
</div>
</div>
<div class="sect2">
<h3 id="send-soap-attachments"><a class="anchor" href="#send-soap-attachments"></a><a class="link" href="#send-soap-attachments">20.16. Send SOAP attachments</a></h3>
<div class="paragraph">
<p>As client Citrus is able to add attachments to the SOAP message. I think it is best to go straight into an example in order to understand how it works.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;SoapMessageWithAttachment</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://consol.de/schemas/sample.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;Operation&gt;</span>Read the attachment<span class="tag">&lt;/Operation&gt;</span>
            <span class="tag">&lt;/SoapMessageWithAttachment&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;ws:attachment</span> <span class="attribute-name">content-id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MySoapAttachment</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;ws:resource</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/ws/soapAttachment.txt</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/ws:attachment&gt;</span>
<span class="tag">&lt;/ws:send&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the previous chapters you may have already noticed the <strong>citrus-ws</strong> namespace that stands for the SOAP extensions in Citrus. Please include the <strong>citrus-ws</strong> namespace in your test case as described earlier in this chapter so you can use the attachment support.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The special send action of the SOAP extension namespace is aware of SOAP attachments. The attachment content usually consists of a <strong>content-id</strong> a <strong>content-type</strong> and the actual content as plain text or binary content. Inside the test case you can use external file resources or inline CDATA sections for the attachment content. As you are familiar with Citrus you may know this already from other actions.</p>
</div>
<div class="paragraph">
<p>Citrus will construct a SOAP message with the SOAP attachment. Currently only one attachment per message is supported.</p>
</div>
</div>
<div class="sect2">
<h3 id="receive-soap-attachments"><a class="anchor" href="#receive-soap-attachments"></a><a class="link" href="#receive-soap-attachments">20.17. Receive SOAP attachments</a></h3>
<div class="paragraph">
<p>When Citrus calls SOAP WebServices as a client we may receive SOAP responses with attachments. The tester can validate those received SOAP messages with attachment content quite easy. As usual let us have a look at an example first.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;SoapMessageWithAttachmentRequest</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://consol.de/schemas/sample.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;Operation&gt;</span>Read the attachment<span class="tag">&lt;/Operation&gt;</span>
            <span class="tag">&lt;/SoapMessageWithAttachmentRequest&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;ws:attachment</span> <span class="attribute-name">content-id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">MySoapAttachment</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">content-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">validator</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mySoapAttachmentValidator</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;ws:resource</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/ws/soapAttachment.txt</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/ws:attachment&gt;</span>
<span class="tag">&lt;/ws:receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Again we use the Citrus SOAP extension namespace with the specific receive action that is aware of SOAP attachment validation. The tester can validate the <strong>content-id</strong>, the <strong>content-type</strong> and the attachment content. Instead of using the external file resource you could also define an expected attachment template directly in the test case as inline CDATA section.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <strong>ws:attachment</strong> element specifies a validator instance. This validator determines how to validate the attachment content. SOAP attachments are not limited to XML content. Plain text content and binary content is possible, too. So each SOAP attachment validating action can use a different <strong><em>SoapAttachmentValidator</em></strong> instance which is responsible for validating and comparing received attachments to expected template attachments. In the Citrus configuration the validator is set as normal Spring bean with the respective identifier.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapAttachmentValidator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.ws.validation.SimpleSoapAttachmentValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mySoapAttachmentValidator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.company.ws.validation.MySoapAttachmentValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can define several validator instances in the Citrus configuration. The validator with the general id <strong>"soapAttachmentValidator"</strong> is the default validator for all actions that do not explicitly set a validator instance. Citrus offers a set of reference validator implementations. The <strong><em>SimpleSoapAttachmentValidator</em></strong> will use a simple plain text comparison. Of course you are able to add individual validator implementations, too.</p>
</div>
</div>
<div class="sect2">
<h3 id="soap-mtom"><a class="anchor" href="#soap-mtom"></a><a class="link" href="#soap-mtom">20.18. SOAP MTOM support</a></h3>
<div class="paragraph">
<p>MTOM (Message Transmission Optimization Mechanism) enables you to send and receive large SOAP message content using streamed data handlers. This optimizes the resource allocation on server and client side where not all data is loaded into memory when marshalling/unmarshalling the message payload data. In detail MTOM enabled messages do have a XOP package inside the message payload replacing the actual large content data. The content is then streamed aas separate attachment. Server and client can operate with a data handler providing access to the streamed content. This is very helpful when using large binary content inside a SOAP message for instance.</p>
</div>
<div class="paragraph">
<p>Citrus is able to both send and receive MTOM enabled SOAP messages on client and server. Just use the <strong>mtom-enabled</strong> flag when sending a SOAP message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapMtomClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mtom-enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message&gt;</span>
    <span class="tag">&lt;data&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
        &lt;image:addImage xmlns:image=&quot;http://www.citrusframework.org/imageService/&quot;&gt;
          &lt;image&gt;cid:IMAGE&lt;/image&gt;
        &lt;/image:addImage&gt;
      <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/data&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
  <span class="tag">&lt;ws:attachment</span> <span class="attribute-name">content-id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">IMAGE</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/octet-stream</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;ws:resource</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/hugeImageData.png</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/ws:attachment&gt;</span>
<span class="tag">&lt;/ws:send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the example above sends a SOAP message that contains a large binary image content. The actual binary image data is referenced with a content id marker <strong>cid:IMAGE</strong> inside the message payload. The actual image content is added as attachment with a separate file resource. Important is here the <strong>content-id</strong> which matches the id marker in the SOAP message payload (<strong>IMAGE</strong>).</p>
</div>
<div class="paragraph">
<p>Citrus builds a proper SOAP MTOM enabled message automatically adding the XOP package inside the message. The binary data is sent as separate SOAP attachment accordingly. The resulting SOAP message looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;SOAP-ENV:Envelope</span> <span class="attribute-name">xmlns:SOAP-ENV</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://schemas.xmlsoap.org/soap/envelope/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;SOAP-ENV:Header&gt;</span><span class="tag">&lt;/SOAP-ENV:Header&gt;</span>
  <span class="tag">&lt;SOAP-ENV:Body&gt;</span>
    <span class="tag">&lt;image:addImage</span> <span class="attribute-name">xmlns:image</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/imageService/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;image&gt;</span><span class="tag">&lt;xop:Include</span> <span class="attribute-name">xmlns:xop</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2004/08/xop/include</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cid:IMAGE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/image&gt;</span>
    <span class="tag">&lt;/image:addImage&gt;</span>
  <span class="tag">&lt;/SOAP-ENV:Body&gt;</span>
<span class="tag">&lt;/SOAP-ENV:Envelope&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On the server side Citrus is also able to handle MTOM enabled SOAP messages. In a server receive action you can specify the MTOM SOAP attachment content as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapMtomServer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mtom-enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message</span> <span class="attribute-name">schema-validation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;data&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
        &lt;image:addImage xmlns:image=&quot;http://www.citrusframework.org/imageService/&quot;&gt;
          &lt;image&gt;&lt;xop:Include xmlns:xop=&quot;http://www.w3.org/2004/08/xop/include&quot; href=&quot;cid:IMAGE&quot;/&gt;&lt;/image&gt;
        &lt;/image:addImage&gt;
      <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/data&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
  <span class="tag">&lt;ws:attachment</span> <span class="attribute-name">content-id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">IMAGE</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/octet-stream</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;ws:resource</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/hugeImageData.png</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/ws:attachment&gt;</span>
<span class="tag">&lt;/ws:receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We define the MTOM attachment content as separate SOAP attachment. The <strong>content-id</strong> is referenced somewhere in the SOAP message payload data. At runtime Citrus will add the XOP package definition automatically and perform validation on the message and its streamed MTOM attachment data.</p>
</div>
<div class="paragraph">
<p>Next thing that we have to talk about is inline MTOM data. This means that the content should be added as either <strong>base64Binary</strong> or <strong>hexBinary</strong> encoded String data directly to the message content. See the following example that uses the <strong>mtom-inline</strong> setting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapMtomClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mtom-enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message&gt;</span>
    <span class="tag">&lt;data&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
        &lt;image:addImage xmlns:image=&quot;http://www.citrusframework.org/imageService/&quot;&gt;
          &lt;image&gt;cid:IMAGE&lt;/image&gt;
          &lt;icon&gt;cid:ICON&lt;/icon&gt;
        &lt;/image:addImage&gt;
      <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/data&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
  <span class="tag">&lt;ws:attachment</span> <span class="attribute-name">content-id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">IMAGE</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/octet-stream</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">mtom-inline</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">encoding-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">base64Binary</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;ws:resource</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/image.png</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/ws:attachment&gt;</span>
  <span class="tag">&lt;ws:attachment</span> <span class="attribute-name">content-id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ICON</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">content-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/octet-stream</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">mtom-inline</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">encoding-type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hexBinary</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;ws:resource</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/icon.ico</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/ws:attachment&gt;</span>
<span class="tag">&lt;/ws:send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The listing above defines two inline MTOM attachments. The first attachment <strong>cid:IMAGE</strong> uses the encoding type <strong>base64Binary</strong> which is the default. The second attachment <strong>cid:ICON</strong> uses <strong>hexBinary</strong> encoding. Both attachments are added as inline data before the message is sent. The final SOAP message looks like follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;SOAP-ENV:Envelope</span> <span class="attribute-name">xmlns:SOAP-ENV</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://schemas.xmlsoap.org/soap/envelope/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;SOAP-ENV:Header&gt;</span><span class="tag">&lt;/SOAP-ENV:Header&gt;</span>
  <span class="tag">&lt;SOAP-ENV:Body&gt;</span>
    <span class="tag">&lt;image:addImage</span> <span class="attribute-name">xmlns:image</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/imageService/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;image&gt;</span>VGhpcyBpcyBhIGJpbmFyeSBpbWFnZSBhdHRhY2htZW50IQpWYXJpYWJsZXMgJXt0ZXN0fSBzaG91bGQgbm90IGJlIHJlcGxhY2VkIQ==<span class="tag">&lt;/image&gt;</span>
      <span class="tag">&lt;icon&gt;</span>5468697320697320612062696E6172792069636F6E206174746163686D656E74210A5661726961626C657320257B746573747D2073686F756C64206E6F74206265207265706C6163656421<span class="tag">&lt;/icon&gt;</span>
    <span class="tag">&lt;/image:addImage&gt;</span>
  <span class="tag">&lt;/SOAP-ENV:Body&gt;</span>
<span class="tag">&lt;/SOAP-ENV:Envelope&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The image content is a base64Binary String and the icon a heyBinary String. Of course this mechanism also is supported in receive actions on the server side where the expected message content is added als inline MTOM data before validation takes place.</p>
</div>
</div>
<div class="sect2">
<h3 id="soap-client-basic-authentication"><a class="anchor" href="#soap-client-basic-authentication"></a><a class="link" href="#soap-client-basic-authentication">20.19. SOAP client basic authentication</a></h3>
<div class="paragraph">
<p>As a SOAP client you may have to use basic authentication in order to access a server resource. Basic authentication via HTTP stands for username/password authentication where the credentials are transmitted in the HTTP request header section as base64 encoded entry. As Citrus uses the Spring WebService stack we can use the basic authentication support there. We set the user credentials on the HttpClient message sender which is used inside the Spring <strong><em>WebServiceTemplate</em></strong> .</p>
</div>
<div class="paragraph">
<p>Citrus provides a comfortable way to set the HTTP message sender with basic authentication credentials on the <strong><em>WebServiceTemplate</em></strong> . Just see the following example and learn how to do that.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ws:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span>
                              <span class="attribute-name">request-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8090/test</span><span class="delimiter">&quot;</span></span>
                              <span class="attribute-name">message-sender</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">basicAuthClient</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">basicAuthClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.transport.http.HttpComponentsMessageSender</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">authScope</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.http.auth.AuthScope</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8090</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">basic</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/bean&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">credentials</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.http.auth.UsernamePasswordCredentials</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someUsername</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">somePassword</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above configuration results in SOAP requests with authentication headers properly set for basic authentication. The special message sender takes care on adding the proper basic authentication header to each request that is sent with this Citrus message sender. By default preemptive authentication is used. The message sender only sends a single request to the server with all authentication information set in the message header. The request which determines the authentication scheme on the server is skipped. This is why you have to add some auth scope so Citrus can setup an authentication cache within the HTTP context in order to have preemptive authentication.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can also skip the message sender configuration and set the <strong>Authorization</strong> header on each request in your send action definition on your own. Be aware of setting the header as HTTP mime header using the correct prefix and take care on using the correct basic authentication with base64 encoding for the <strong>username:password</strong> phrase.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;header&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_http_Authorization</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Basic c29tZVVzZXJuYW1lOnNvbWVQYXNzd29yZA==</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/header&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For base64 encoding you can also use a Citrus function, see <a href="#functions-encode-base64">functions-encode-base64</a></p>
</div>
</div>
<div class="sect2">
<h3 id="soap-server-basic-authentication"><a class="anchor" href="#soap-server-basic-authentication"></a><a class="link" href="#soap-server-basic-authentication">20.20. SOAP server basic authentication</a></h3>
<div class="paragraph">
<p>When providing SOAP WebService server functionality Citrus can also set basic authentication so all clients need to authenticate properly when accessing the server resource.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ws:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simpleSoapServer</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8080</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">auto-start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">resource-base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">src/it/resources</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">security-handler</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">basicSecurityHandler</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">securityHandler</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.ws.security.SecurityHandlerFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">users</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;list&gt;</span>
            <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.ws.security.User</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">secret</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">roles</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CitrusRole</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/bean&gt;</span>
        <span class="tag">&lt;/list&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">constraints</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;map&gt;</span>
            <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/foo/*</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.ws.security.BasicAuthConstraint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CitrusRole</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/bean&gt;</span>
            <span class="tag">&lt;/entry&gt;</span>
        <span class="tag">&lt;/map&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We have set a security handler on the server web container with a constraint on all resources with <code>/foo/*</code>. Following from that the server requires basic authentication for these resources. The granted users and roles are specified within the security handler bean definition. Connecting clients have to set the basic auth HTTP header properly using the correct user and role for accessing the Citrus server now.</p>
</div>
<div class="paragraph">
<p>You can customize the security handler for your very specific needs (e.g. load users and roles with JDBC from a database). Just have a look at the code base and inspect the settings and properties offered by the security handler interface.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This mechanism is not restricted to basic authentication only. With other settings you can also set up digest or form-based authentication constraints very easy.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="ws-addressing"><a class="anchor" href="#ws-addressing"></a><a class="link" href="#ws-addressing">20.21. WS-Addressing support</a></h3>
<div class="paragraph">
<p>The web service stack offers a lot of different technologies and standards within the context of SOAP WebServices. We speak of WS-* specifications in particular. One of these specifications deals with addressing. On client side you may add wsa header information to the request in order to give the server instructions how to deal with SOAP faults for instance.</p>
</div>
<div class="paragraph">
<p>In Citrus WebService client you can add those header information using the common configuration like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ws:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">request-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8090/test</span><span class="delimiter">&quot;</span></span>
                         <span class="attribute-name">message-converter</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">wsAddressingMessageConverter</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">wsAddressingMessageConverter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.ws.message.converter.WsAddressingMessageConverter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;constructor-arg&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">wsAddressing200408</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.ws.addressing.WsAddressingHeaders</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">version</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">VERSION200408</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">action</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrus.sample/sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">to</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrus.sample/server</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">from</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.soap.addressing.core.EndpointReference</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrus.sample/client</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/bean&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">replyTo</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.soap.addressing.core.EndpointReference</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrus.sample/client</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/bean&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
        <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">faultTo</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.soap.addressing.core.EndpointReference</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrus.sample/fault/resolver</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/bean&gt;</span>
        <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;/bean&gt;</span>
  <span class="tag">&lt;/constructor-arg&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The WsAddressing header values will be used for all request messages that are sent with the soap client component <em>soapClient</em>. You can overwrite the WsAddressing
header in each send test action in your test though. Just set the special WsAddressing message header on your request. You can use the following message header names in
order to overwrite the default addressing headers specified in the message converter configuration (also see the class <em>com.consol.citrus.ws.addressing.WsAddressingMessageHeaders</em>).</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
citrus_soap_ws_addressing_messageId
</td>
<td class="hdlist2">
<p>addressing message id as URI</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus_soap_ws_addressing_from
</td>
<td class="hdlist2">
<p>addressing from endpoint reference as URI</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus_soap_ws_addressing_to
</td>
<td class="hdlist2">
<p>addressing to URI</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus_soap_ws_addressing_action
</td>
<td class="hdlist2">
<p>addressing action URI</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus_soap_ws_addressing_replyTo
</td>
<td class="hdlist2">
<p>addressing reply to endpoint reference as URI</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus_soap_ws_addressing_faultTo
</td>
<td class="hdlist2">
<p>addressing fault to endpoint reference as URI</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When using this message headers you are able to explicitly overwrite the WsAddressing headers. Test variables are supported of course when specifying the values. Most of the values
are parsed to a URI value at the end so please make sure to use correct URI String representations.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The WS-Addressing specification knows several versions. Supported version are:
</td>
</tr>
</table>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
VERSION10
</td>
<td class="hdlist2">
<p>WS-Addressing 1.0 May 2006</p>
</td>
</tr>
<tr>
<td class="hdlist1">
VERSION200408
</td>
<td class="hdlist2">
<p>August 2004 edition of the WS-Addressing specification</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The addressing headers find a place in the SOAP message header with respective namespaces and values. A possible SOAP request with WS addressing headers looks like follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;SOAP-ENV:Envelope</span> <span class="attribute-name">xmlns:SOAP-ENV</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://schemas.xmlsoap.org/soap/envelope/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;SOAP-ENV:Header</span> <span class="attribute-name">xmlns:wsa</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://schemas.xmlsoap.org/ws/2004/08/addressing</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;wsa:To</span> <span class="attribute-name">SOAP-ENV:mustUnderstand</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>http://citrus.sample/server<span class="tag">&lt;/wsa:To&gt;</span>
        <span class="tag">&lt;wsa:From&gt;</span>
            <span class="tag">&lt;wsa:Address&gt;</span>http://citrus.sample/client<span class="tag">&lt;/wsa:Address&gt;</span>
        <span class="tag">&lt;/wsa:From&gt;</span>
        <span class="tag">&lt;wsa:ReplyTo&gt;</span>
            <span class="tag">&lt;wsa:Address&gt;</span>http://citrus.sample/client<span class="tag">&lt;/wsa:Address&gt;</span>
        <span class="tag">&lt;/wsa:ReplyTo&gt;</span>
        <span class="tag">&lt;wsa:FaultTo&gt;</span>
            <span class="tag">&lt;wsa:Address&gt;</span>http://citrus.sample/fault/resolver<span class="tag">&lt;/wsa:Address&gt;</span>
        <span class="tag">&lt;/wsa:FaultTo&gt;</span>
        <span class="tag">&lt;wsa:Action&gt;</span>http://citrus.sample/sayHello<span class="tag">&lt;/wsa:Action&gt;</span>
        <span class="tag">&lt;wsa:MessageID&gt;</span>urn:uuid:4c4d8af2-b402-4bc0-a2e3-ad33b910e394<span class="tag">&lt;/wsa:MessageID&gt;</span>
    <span class="tag">&lt;/SOAP-ENV:Header&gt;</span>
    <span class="tag">&lt;SOAP-ENV:Body&gt;</span>
        <span class="tag">&lt;cit:HelloRequest</span> <span class="attribute-name">xmlns:cit</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrus/sample/sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;cit:Text&gt;</span>Hello Citrus!<span class="tag">&lt;/cit:Text&gt;</span>
        <span class="tag">&lt;/cit:HelloRequest&gt;</span>
    <span class="tag">&lt;/SOAP-ENV:Body&gt;</span>
<span class="tag">&lt;/SOAP-ENV:Envelope&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
By default when not set explicitly on the message headers the WsAddressing message id property is automatically generated for each request. You can set the message id generation strategy in the Spring application context message converter configuration:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">wsAddressingMessageConverter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.ws.message.converter.WsAddressingMessageConverter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageIdStrategy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.soap.addressing.messageid.UuidMessageIdStrategy</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By default the strategy will create a new Java UUID for each request. The strategy also uses a common resource name prefix <em>urn:uuid:</em>. You can overwrite the message id
any time for each request explicitly by setting the message header <em>citrus_soap_ws_addressing_messageId</em> with a respective value on the message in your test.</p>
</div>
</div>
<div class="sect2">
<h3 id="soap-client-fork-mode"><a class="anchor" href="#soap-client-fork-mode"></a><a class="link" href="#soap-client-fork-mode">20.22. SOAP client fork mode</a></h3>
<div class="paragraph">
<p>SOAP over HTTP uses synchronous communication by nature. This means that sending a SOAP message in Citrus over HTTP will automatically block further test actions until the synchronous HTTP response has been received. In test cases this synchronous blocking might cause problems for several reasons. A simple reason would be that you need to do further test actions in parallel to the synchronous HTTP SOAP communication (e.g. simulate another backend system in the test case).</p>
</div>
<div class="paragraph">
<p>You can separate the SOAP send action from the rest of the test case by using the <strong>"fork"</strong> mode. The SOAP client will automatically open a new Java Thread for the synchronous communication and the test is able to continue with execution although the synchronous HTTP SOAP response has not arrived yet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">fork</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message&gt;</span>
    <span class="tag">&lt;payload&gt;</span>
        <span class="tag">&lt;SoapRequest</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.consol.de/schemas/sample.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;Operation&gt;</span>Read the attachment<span class="tag">&lt;/Operation&gt;</span>
        <span class="tag">&lt;/SoapRequest&gt;</span>
    <span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/ws:send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With the <strong>"fork"</strong> mode enabled the test continues with execution while the sending action waits for the synchronous response in a separate Java Thread. You could reach the same behaviour with a complex &lt;parallel&gt;/&lt;sequential&gt; container construct, but forking the send action is much more straight forward.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
It is highly recommended to use a proper <strong>"timeout"</strong> setting on the SOAP receive action when using fork mode. The forked send operation might take some time and the corresponding receive action might run into failure as the response was has not been received yet. The result would be a broken test because of the missing response message. A proper <strong>"timeout"</strong> setting for the receive action solves this problem as the action waits for this time period and occasionally repeatedly asks for the SOAP response message. The following listing sets the receive timeout to 10 seconds, so the action waits for the forked send action to deliver the SOAP response in time.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ws:receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message&gt;</span>
    <span class="tag">&lt;payload&gt;</span>
        <span class="tag">&lt;SoapResponse</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.consol.de/schemas/sample.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;Operation&gt;</span>Did something<span class="tag">&lt;/Operation&gt;</span>
          <span class="tag">&lt;Success&gt;</span>true<span class="tag">&lt;/Success&gt;</span>
        <span class="tag">&lt;/SoapResponse&gt;</span>
    <span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/ws:receive&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="soap-servlet-context-customization"><a class="anchor" href="#soap-servlet-context-customization"></a><a class="link" href="#soap-servlet-context-customization">20.23. SOAP servlet context customization</a></h3>
<div class="paragraph">
<p>For highly customized SOAP server components in Citrus you can define a full servlet context configuration file. Here you have the full power to add Spring endpoint mappings and custom endpoint implementations. You can set the custom servlet context as external file resource on the server component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ws:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">context-config-location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:citrus-ws-servlet.xml</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">message-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soap11MessageFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let us have a closer look at the context-config-location attribute. This configuration defines the Spring application context file for endpoints, request mappings and other SpringWS specific information. Please see the official SpringWS documentation for details on this Spring based configuration. You can also just copy the following example application context which should work for you in general.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
       <span class="content">http://www.springframework.org/schema/beans</span>
       <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

  <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">loggingInterceptor</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.server.endpoint.interceptor.PayloadLoggingInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;description&gt;</span>
          This interceptor logs the message payload.
      <span class="tag">&lt;/description&gt;</span>
  <span class="tag">&lt;/bean&gt;</span>

  <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServicePayloadMapping</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.ws.server.endpoint.mapping.PayloadRootQNameEndpointMapping</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mappings</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;props&gt;</span>
              <span class="tag">&lt;prop</span>
                  <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{http://www.consol.de/schemas/sayHello}HelloRequest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                  helloServiceEndpoint
              <span class="tag">&lt;/prop&gt;</span>
          <span class="tag">&lt;/props&gt;</span>
      <span class="tag">&lt;/property&gt;</span>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">interceptors</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;list&gt;</span>
              <span class="tag">&lt;ref</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">loggingInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;/list&gt;</span>
      <span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;/bean&gt;</span>

  <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloServiceEndpoint</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.ws.server.WebServiceEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">endpointAdapter</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">staticResponseEndpointAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/bean&gt;</span>

  <span class="tag">&lt;citrus:static-response-adapter</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">staticResponseEndpointAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;citrus:payload&gt;</span>
          <span class="inline-delimiter">&lt;![CDATA[</span>
              &lt;HelloResponse xmlns=&quot;http://www.consol.de/schemas/sayHello&quot;&gt;
                  &lt;MessageId&gt;123456789&lt;/MessageId&gt;
                  &lt;CorrelationId&gt;CORR123456789&lt;/CorrelationId&gt;
                  &lt;User&gt;WebServer&lt;/User&gt;
                  &lt;Text&gt;Hello User&lt;/Text&gt;
              &lt;/HelloResponse&gt;
          <span class="inline-delimiter">]]&gt;</span>
      <span class="tag">&lt;/citrus:payload&gt;</span>
      <span class="tag">&lt;citrus:header&gt;</span>
          <span class="tag">&lt;citrus:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{http://www.consol.de/schemas/samples/sayHello.xsd}ns0:Operation</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHelloResponse</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;citrus:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{http://www.consol.de/schemas/samples/sayHello.xsd}ns0:Request</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HelloRequest</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;citrus:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_soap_action</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/citrus:header&gt;</span>
  <span class="tag">&lt;/citrus:static-response-adapter&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The program listing above describes a normal SpringWS request mapping with endpoint configurations. The mapping is responsible to forward incoming requests to the endpoint which will handle the request and provide a proper response message. First of all we add a logging interceptor to the context so all incoming requests get logged to the console first. Then we use a payload mapping (PayloadRootQNameEndpointMapping) in order to map all incoming <strong><em>'HelloRequest'</em></strong> SOAP messages to the <strong><em>'helloServiceEndpoint'</em></strong> . Endpoints are of essential nature in Citrus SOAP WebServices implementation. They are responsible for processing a request in order to provide a proper response message that is sent back to the calling client. Citrus uses the endpoint in combination with a message endpoint adapter implementation.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/figure_009.jpg" alt="figure_009.jpg"></span></p>
</div>
<div class="paragraph">
<p>The endpoint works together with the message endpoint adapter that is responsible for providing a response message for the client. The various message endpoint adapter implementations in Citrus were already discussed in <a href="#endpoint-adapter">endpoint-adapter</a>.</p>
</div>
<div class="paragraph">
<p>In this example the <strong><em>'helloServiceEndpoint'</em></strong> uses the <strong><em>'static-response-adapter'</em></strong> which is always returning a static response message. In most cases static responses will not fit the test scenario and you will have to respond more dynamically.</p>
</div>
<div class="paragraph">
<p>Regardless of which message endpoint adapter setup you are using in your test case the endpoint transforms the response into a proper SOAP message. You can add as many request mappings and endpoints as you want to the server context configuration. So you are able to handle different request types with one single Jetty server instance.</p>
</div>
<div class="paragraph">
<p>That&#8217;s it for connecting with SOAP WebServices! We saw how to send and receive SOAP messages with Jetty and Spring WebServices. Have a look at the samples coming with your Citrus archive in order to learn more about the SOAP message handling.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ftp"><a class="anchor" href="#ftp"></a><a class="link" href="#ftp">21. FTP support</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>With Citrus it is possible to start your own ftp server for accepting incoming client requests. You can also use Citrus as a FTP client to send FTP commands. The next sections deal with FTP connectivity.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The FTP components in Citrus are maintained in their own Maven module. So you should add the module as Maven dependency to your project accordingly.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>com.consol.citrus<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>citrus-ftp<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>2.7.3<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As Citrus provides a customized FTP configuration schema for the Spring application context configuration files we have to add name to the top level <strong>beans</strong> element. Simply include the ftp-config namespace in the configuration XML files as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:citrus</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/config</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:citrus-ftp</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/ftp/config</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
    <span class="content">http://www.springframework.org/schema/beans</span>
    <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
    <span class="content">http://www.citrusframework.org/schema/config</span>
    <span class="content">http://www.citrusframework.org/schema/config/citrus-config.xsd</span>
    <span class="content">http://www.citrusframework.org/schema/http/config</span>
    <span class="content">http://www.citrusframework.org/schema/ftp/config/citrus-ftp-config.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

      [...]

      <span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we are ready to use the customized Citrus FTP configuration elements with the citrus-ftp namespace prefix.</p>
</div>
<div class="sect2">
<h3 id="ftp-client"><a class="anchor" href="#ftp-client"></a><a class="link" href="#ftp-client">21.1. FTP client</a></h3>
<div class="paragraph">
<p>We want to use Citrus fo connect to dome FTP server as a client sending commands such as creating a directory or listing all files. Citrus offers a client component doing exactly this FTP client connection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ftp:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ftpClient</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">host</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">22222</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">username</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration above describes a Citrus ftp client connected to a ftp server with <code><a href="ftp://localhost:22222" class="bare">ftp://localhost:22222</a></code>. For authentication username and password are defined as well as the global connection timeout. The client will automatically send username and password for proper authentication to the server when opening a new connection.</p>
</div>
<div class="paragraph">
<p>In a test case you are now able to use the client to push commands to the server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ftpClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">fork</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message&gt;</span>
    <span class="tag">&lt;data&gt;</span><span class="tag">&lt;/data&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
  <span class="tag">&lt;header&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_ftp_command</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PWD</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_ftp_arguments</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/send&gt;</span>

<span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ftpClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plaintext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;data&gt;</span>PWD<span class="tag">&lt;/data&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
  <span class="tag">&lt;header&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_ftp_command</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PWD</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_ftp_arguments</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_ftp_reply_code</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">257</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_ftp_reply_string</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">@contains('is current directory')@</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see most of the ftp communication parameters are specified as special header elements in the message. Citrus automatically converts those information to proper FTP commands and response messages.</p>
</div>
</div>
<div class="sect2">
<h3 id="ftp-server"><a class="anchor" href="#ftp-server"></a><a class="link" href="#ftp-server">21.2. FTP server</a></h3>
<div class="paragraph">
<p>Now that we are able to access FTP as a client we might also want to simulate the server side. Therefore Citrus offers a server component that is listening on a port for incoming FTP connections. The server has a default home directory on the local file system specified. But you can also define home directories per user. For now let us have a look at the server configuration component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ftp:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ftpServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      port=&quot;22222&quot;
      auto-start=&quot;true&quot;
      user-manager-properties=&quot;classpath:ftp.server.properties&quot;/<span class="error">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The ftp server configuration is quite simple. The server starts automatically and binds to a port. The user configuration is read from a <strong>user-manager-property</strong> file. Let us have a look at the content of this user management file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"># Password is &quot;admin&quot;
ftpserver.user.admin.userpassword=21232F297A57A5A743894A0E4A801FC3
ftpserver.user.admin.homedirectory=target/ftp/user/admin
ftpserver.user.admin.enableflag=true
ftpserver.user.admin.writepermission=true
ftpserver.user.admin.maxloginnumber=0
ftpserver.user.admin.maxloginperip=0
ftpserver.user.admin.idletime=0
ftpserver.user.admin.uploadrate=0
ftpserver.user.admin.downloadrate=0

ftpserver.user.anonymous.userpassword=
ftpserver.user.anonymous.homedirectory=target/ftp/user/anonymous
ftpserver.user.anonymous.enableflag=true
ftpserver.user.anonymous.writepermission=false
ftpserver.user.anonymous.maxloginnumber=20
ftpserver.user.anonymous.maxloginperip=2
ftpserver.user.anonymous.idletime=300
ftpserver.user.anonymous.uploadrate=4800
ftpserver.user.anonymous.downloadrate=4800</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see you are able to define as many user for the ftp server as you like. Username and password define the authentication on the server. In addition to that you have plenty of configuration possibilities per user. Citrus uses the Apache ftp server implementation. So for more details on configuration capabilities please consult the official Apache ftp server documentation.</p>
</div>
<div class="paragraph">
<p>Now we would like to use the server in a test case. Very easy you just have to define a receive message action within your test case that uses the server id as endpoint reference:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;echo&gt;</span>
  <span class="tag">&lt;message&gt;</span>Receive user login on FTP server<span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span>

<span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ftpServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plaintext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;data&gt;</span>USER<span class="tag">&lt;/data&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
  <span class="tag">&lt;header&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_ftp_command</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">USER</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_ftp_arguments</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/receive&gt;</span>

<span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ftpServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plaintext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;data&gt;</span>OK<span class="tag">&lt;/data&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span>

<span class="tag">&lt;echo&gt;</span>
  <span class="tag">&lt;message&gt;</span>Receive user password on FTP server<span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span>

<span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ftpServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plaintext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;data&gt;</span>PASS<span class="tag">&lt;/data&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
  <span class="tag">&lt;header&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_ftp_command</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PASS</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_ftp_arguments</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/receive&gt;</span>

<span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ftpServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plaintext</span><span class="delimiter">&quot;</span></span><span class="error">&quot;</span><span class="tag">&gt;</span>
    <span class="tag">&lt;data&gt;</span>OK<span class="tag">&lt;/data&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The listing above shows two incoming commands representing a user login. We indicate with re send actions that we would link the server to respond with positive feedback and to accept the login. As we have a fully qualified ftp server running the client can also push files read directories and more. All incoming commands can be validated inside a test case.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="message-channels"><a class="anchor" href="#message-channels"></a><a class="link" href="#message-channels">22. Message channel support</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Message channels represent the in memory messaging solution in Citrus. Producer and consumer components are linked via channels exchanging messages in memory. As this transport mechanism comes from Spring Integration API (<a href="http://www.springsource.org/spring-integration">http://www.springsource.org/spring-integration</a>) and Citrus itself uses a lot of Spring APIs, especially those from Spring Integration you are able to connect to all Spring messaging adapters via these in memory channels.</p>
</div>
<div class="paragraph">
<p>Citrus offers a channel components that can be used both by Citrus and Spring Integration. The conclusion is that Citrus supports the sending and receiving of messages both to and from Spring Integration message channel components. This opens up a lot of great possibilities to interact with the Spring Integration transport adapters for FTP, TCP/IP and so on. In addition to that the message channel support provides us a good way to exchange messages in memory.</p>
</div>
<div class="paragraph">
<p>Citrus provides support for sending and receiving JMS messages. We have to separate between synchronous and asynchronous communication. So in this chapter we explain how to setup JMS message endpoints for synchronous and asynchronous outbound and inbound communication</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The message channel configuration components use the default "citrus" configuration namespace and schema definition. Include this namespace into your Spring configuration in order to use the Citrus configuration elements. The namespace URI and schema location are added to the Spring configuration XML file as follows.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:citrus-jms</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/config</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
        <span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content">http://www.citrusframework.org/schema/config</span>
        <span class="content">http://www.citrusframework.org/schema/config/citrus-config.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    [...]

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After that you are able to use customized Citrus XML elements in order to define the Spring beans.</p>
</div>
<div class="sect2">
<h3 id="channel-endpoint"><a class="anchor" href="#channel-endpoint"></a><a class="link" href="#channel-endpoint">22.1. Channel endpoint</a></h3>
<div class="paragraph">
<p>Citrus offers a channel endpoint component that is able to create producer and consumer components. Producer and consumer send and receive messages both to and from a channel endpoint. By default the endpoint is asynchronous when configured in the Citrus application context. With this component you are able to access message channels directly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:channel-endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloEndpoint</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">channel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloChannel</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;si:channel</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloChannel</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Citrus channel endpoint references a Spring Integration channel directly. Inside your test case you can reference the Citrus endpoint as usual to send and receive messages. We will see this later in some example code listings.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Spring Integration configuration components use a specific namespace that has to be included into your Spring application context. You can use the following template which holds all necessary namespaces and schema locations:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:citrus</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/config</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:si</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/integration</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
            <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
            <span class="content">http://www.citrusframework.org/schema/config</span>
            <span class="content">http://www.citrusframework.org/schema/config/citrus-config.xsd</span>
            <span class="content">http://www.springframework.org/schema/integration</span>
            <span class="content">http://www.springframework.org/schema/integration/spring-integration.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Citrus channel endpoint also supports a customized message channel template that will actually send the messages. The customized template might give you access to special configuration possibilities. However it is optional, so if no message channel template is defined in the configuration Citrus will create a default template.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:channel-endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloEndpoint</span><span class="delimiter">&quot;</span></span>
                            <span class="attribute-name">channel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloChannel</span><span class="delimiter">&quot;</span></span>
                            <span class="attribute-name">message-channel-template</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myMessageChannelTemplate</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The message sender is now ready to publish messages to the defined channel. The communication is supposed to be asynchronous, so the producer is not able to process a reply message. We will deal with synchronous communication and reply messages later in this chapter. The message producer just publishes messages to the channel and is done. Interacting with the endpoints in a test case is quite easy. Just reference the id of the endpoint in your send and receive test actions</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;v1:HelloRequest</span> <span class="attribute-name">xmlns:v1</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrusframework.org/schemas/HelloService.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;v1:Text&gt;</span>Hello World!<span class="tag">&lt;/v1:Text&gt;</span>
            <span class="tag">&lt;/v1:HelloRequest&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span>

<span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;v1:HelloResponse</span> <span class="attribute-name">xmlns:v1</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrusframework.org/schemas/HelloService.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;v1:Text&gt;</span>Hello Citrus!<span class="tag">&lt;/v1:Text&gt;</span>
            <span class="tag">&lt;/v1:HelloResponse&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see Citrus is also able to receive messages from the same Spring Integration message channel destination. We just references the same channel-endpoint in the receive action.</p>
</div>
<div class="paragraph">
<p>As usual the receiver connects to the message destination and waits for messages to arrive. The user can set a receive timeout which is set to 5000 milliseconds by default. In case no message was received in this time frame the receiver raises timeout errors and the test fails.</p>
</div>
</div>
<div class="sect2">
<h3 id="synchronous-channel-endpoints"><a class="anchor" href="#synchronous-channel-endpoints"></a><a class="link" href="#synchronous-channel-endpoints">22.2. Synchronous channel endpoints</a></h3>
<div class="paragraph">
<p>The synchronous channel producer publishes messages and waits synchronously for the response to arrive on some reply channel destination. The reply channel name is set in the message&#8217;s header attributes so the counterpart in this communication can send its reply to that channel. The basic configuration for a synchronous channel endpoint component looks like follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:channel-sync-endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSyncEndpoint</span><span class="delimiter">&quot;</span></span>
                            <span class="attribute-name">channel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloChannel</span><span class="delimiter">&quot;</span></span>
                            <span class="attribute-name">reply-timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span>
                            <span class="attribute-name">polling-interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Synchronous message channel endpoints usually do poll for synchronous reply messages for processing the reply messages. The poll interval is an optional setting in order to manage the amount of reply message handshake attempts. Once the endpoint was able to receive the reply message synchronously the test case can receive the reply. In case all message handshake attempts do fail because the reply message is not available in time we raise some timeout error and the test will fail.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default the channel endpoint uses temporary reply channel destinations. The temporary reply channels are only used once for a single communication handshake. After that the reply channel is deleted again. Static reply channels are not supported as it has not been in scope yet.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When sending a message to this endpoint in the first place the producer will wait synchronously for the response message to arrive on the reply destination. You can receive the reply message in your test case using the same endpoint component. So we have two actions on the same endpoint, first send then receive.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSyncEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;v1:HelloRequest</span> <span class="attribute-name">xmlns:v1</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrusframework.org/schemas/HelloService.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;v1:Text&gt;</span>Hello World!<span class="tag">&lt;/v1:Text&gt;</span>
            <span class="tag">&lt;/v1:HelloRequest&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span>

<span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSyncEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;v1:HelloResponse</span> <span class="attribute-name">xmlns:v1</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrusframework.org/schemas/HelloService.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;v1:Text&gt;</span>Hello Citrus!<span class="tag">&lt;/v1:Text&gt;</span>
            <span class="tag">&lt;/v1:HelloResponse&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the last section we saw that synchronous communication is based on reply messages on temporary reply channels. We saw that Citrus is able to publish messages to channels and wait for reply messages to arrive on temporary reply channels. This section deals with the same synchronous communication over reply messages, but now Citrus has to send dynamic reply messages to temporary channels.</p>
</div>
<div class="paragraph">
<p>The scenario we are talking about is that Citrus receives a message and we need to reply to a temporary reply channel that is stored in the message header attributes. We handle this synchronous communication with the same synchronous channel endpoint component. When initiating the communication by receiving a message from a synchronous channel endpoint you are able to send a synchronous response back. Again just use the same endpoint reference in your test case. The handling of temporary reply destinations is done automatically behind the scenes. So we have again two actions in our test case, but this time first receive then send.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSyncEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;v1:HelloRequest</span> <span class="attribute-name">xmlns:v1</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrusframework.org/schemas/HelloService.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;v1:Text&gt;</span>Hello World!<span class="tag">&lt;/v1:Text&gt;</span>
            <span class="tag">&lt;/v1:HelloRequest&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span>

<span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloSyncEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;v1:HelloResponse</span> <span class="attribute-name">xmlns:v1</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrusframework.org/schemas/HelloService.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;v1:Text&gt;</span>Hello Citrus!<span class="tag">&lt;/v1:Text&gt;</span>
            <span class="tag">&lt;/v1:HelloResponse&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The synchronous message channel endpoint will handle all reply channel destinations and provide those behind the scenes.</p>
</div>
</div>
<div class="sect2">
<h3 id="message-channel-selector"><a class="anchor" href="#message-channel-selector"></a><a class="link" href="#message-channel-selector">22.3. Message selectors on channels</a></h3>
<div class="paragraph">
<p>Unfortunately Spring Integration message channels do not support message selectors on header values as described in <a href="#message-selectors">message-selector</a>. With Citrus version 1.2 we found a way to also add message selector support on message channels. We had to introduce a special queue message channel implementation. So first of all we use this new message channel implementation in our configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:channel</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">orderChannel</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">capacity</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Citrus message channel implementation extends the queue channel implementation from Spring Integration. So we can add a capacity attribute for this channel. That&#8217;s it! Now we use the message channel that supports message selection. In our test we define message selectors on header values as described in <a href="#message-selectors">message-selector</a>and you will see that it works.</p>
</div>
<div class="paragraph">
<p>In addition to that we have implemented other message filter possibilities on message channels that we discuss in the next sections.</p>
</div>
</div>
<div class="sect2">
<h3 id="root-qname-message-selector"><a class="anchor" href="#root-qname-message-selector"></a><a class="link" href="#root-qname-message-selector">22.4. Root QName Message Selector</a></h3>
<div class="paragraph">
<p>You can use the XML root QName of your message as selection criteria. Let&#8217;s see how this works in a small example:</p>
</div>
<div class="paragraph">
<p>We have two different XML messages on a message channel waiting to be picked up by a consumer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;HelloMessage</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrusframework.org/schema</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Hello Citrus<span class="tag">&lt;/HelloMessage&gt;</span>
<span class="tag">&lt;GoodbyeMessage</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrusframework.org/schema</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Goodbye Citrus<span class="tag">&lt;/GoodbyeMessage&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We would like to pick up the <strong>GoodbyeMessage</strong> in our test case. The <strong>HelloMessage</strong> should be left on the message channel as we are not interested in it right now. We can define a root qname message selector in the receive action like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">orderChannelEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;selector&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">root-qname</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GoodbyeMessage</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/selector&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;GoodbyeMessage</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrusframework.org/schema</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Goodbye Citrus<span class="tag">&lt;/GoodbyeMessage&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Citrus receiver picks up the <strong>GoodbyeMessage</strong> from the channel selected via the root qname of the XML message payload. Of course you can also combine message header selectors and root qname selectors as shown in this example below where a message header <strong>sequenceId</strong> is added to the selection logic.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;selector&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">root-qname</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">GoodbyeMessage</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sequenceId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1234</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/selector&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As we deal with XML qname values, we can also use namespaces in our selector root qname selection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;selector&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">root-qname</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{http://citrusframework.org/schema}GoodbyeMessage</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/selector&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="xpath-evaluating-message-selector"><a class="anchor" href="#xpath-evaluating-message-selector"></a><a class="link" href="#xpath-evaluating-message-selector">22.5. XPath Evaluating Message Selector</a></h3>
<div class="paragraph">
<p>It is also possible to evaluate some XPath expression on the message payload in order to select a message from a message channel. The XPath expression outcome must match an expected value and only then the message is consumed form the channel.</p>
</div>
<div class="paragraph">
<p>The syntax for the XPath expression is to be defined as the element name like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;selector&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xpath://Order/status</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pending</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/selector&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The message selector looks for order messages with <strong>status="pending"</strong> in the message payload. This means that following messages would get accepted/declined by the message selector.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;Order&gt;</span><span class="tag">&lt;status&gt;</span>pending<span class="tag">&lt;/status&gt;</span><span class="tag">&lt;/Order&gt;</span> = ACCEPTED
<span class="tag">&lt;Order&gt;</span><span class="tag">&lt;status&gt;</span>finished<span class="tag">&lt;/status&gt;</span><span class="tag">&lt;/Order&gt;</span> = NOT ACCEPTED</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course you can also use XML namespaces in your XPath expressions when selecting messages from channels.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;selector&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xpath://ns1:Order/ns1:status</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pending</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/selector&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Namespace prefixes must match the incoming message - otherwise the XPath expression will not work as expected. In our example the message should look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ns1:Order</span> <span class="attribute-name">xmlns:ns1</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrus.org/schema</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;ns1:status&gt;</span>pending<span class="tag">&lt;/ns1:status&gt;</span><span class="tag">&lt;/ns1:Order&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Knowing the correct XML namespace prefix is not always easy. If you are not sure which namespace prefix to choose Citrus ships with a dynamic namespace replacement for XPath expressions. The XPath expression looks like this and is most flexible:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;selector&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xpath://{http://citrus.org/schema}:Order/{http://citrus.org/schema}:status</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pending</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/selector&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This will match all incoming messages regardless the XML namespace prefix that is used.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="file"><a class="anchor" href="#file"></a><a class="link" href="#file">23. File support</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In chapter <a href="#message-channels">message-channels</a>we discussed the native Spring Integration channel support which enables Citrus to interact with all Spring Integration messaging adapter implementations. This is a fantastic way to extend Citrus for additional transports. This interaction now comes handy when writing and reading files from the file system in Citrus.</p>
</div>
<div class="sect2">
<h3 id="write-files"><a class="anchor" href="#write-files"></a><a class="link" href="#write-files">23.1. Write files</a></h3>
<div class="paragraph">
<p>We want to use the Spring Integration file adapter for both reading and writing files with a local directory. Citrus can easily connect to this file adapter implementation with its message channel support. Citrus message sender and receiver speak to message channels that are connected to the Spring Integration file adapters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:channel-endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fileEndpoint</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">channel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fileChannel</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;file:outbound-channel-adapter</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fileOutboundAdapter</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">channel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fileChannel</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">directory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file:${some.directory.property}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;si:channel</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fileChannel</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The configuration above describes a Citrus message channel endpoint connected to a Spring Integration outbound file adapter that writes messages to a storage directory. With this combination you are able to write files to a directory in your Citrus test case. The test case uses the channel endpoint in its send action and the endpoint interacts with the Spring Integration file adapter so sending out the file.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Spring Integration file adapter configuration components add a new namespace to our Spring application context. See this template which holds all necessary namespaces and schema locations:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
        <span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:citrus</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/config</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:si</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/integration</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/integration/file</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content">http://www.citrusframework.org/schema/config</span>
        <span class="content">http://www.citrusframework.org/schema/config/citrus-config.xsd</span>
        <span class="content">http://www.springframework.org/schema/integration</span>
        <span class="content">http://www.springframework.org/schema/integration/spring-integration.xsd</span>
        <span class="content">http://www.springframework.org/schema/integration/file</span>
        <span class="content">http://www.springframework.org/schema/integration/file/spring-integration-file.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="read-files"><a class="anchor" href="#read-files"></a><a class="link" href="#read-files">23.2. Read files</a></h3>
<div class="paragraph">
<p>The next program listing shows a possible inbound file communication. So the Spring Integration file inbound adapter will read files from a storage directory and publish the file contents to a message channel. Citrus can then receive those files as messages in a test case via the channel endpoint and validate the file contents for instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;file:inbound-channel-adapter</span>  <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fileInboundAdapter</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">channel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fileChannel</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">directory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file:${some.directory.property}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;si:poller</span> <span class="attribute-name">fixed-rate</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/file:inbound-channel-adapter&gt;</span>

<span class="tag">&lt;si:channel</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fileChannel</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;si:queue</span> <span class="attribute-name">capacity</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">25</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;si:interceptors&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.integration.transformer.MessageTransformingChannelInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;constructor-arg&gt;</span>
                <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.integration.file.transformer.FileToStringTransformer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/constructor-arg&gt;</span>
        <span class="tag">&lt;/bean&gt;</span>
    <span class="tag">&lt;/si:interceptors&gt;</span>
<span class="tag">&lt;/si:channel&gt;</span>

<span class="tag">&lt;citrus:channel-endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fileEndpoint</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">channel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fileChannel</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The file inbound adapter constructs Java file objects as the message payload by default. Citrus can only work on String message payloads. So we need a file transformer that converts the file objects to String payloads representing the file&#8217;s content.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This file adapter example shows how easy Citrus can work hand in hand with Spring Integration adapter implementations. The message channel support is a fantastic way to extend the transport and protocol support in Citrus by connecting with the very good Spring Integration adapter implementations. Have a closer look at the Spring Integration project for more details and other adapter implementations that you can use with Citrus integration testing.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="apache-camel"><a class="anchor" href="#apache-camel"></a><a class="link" href="#apache-camel">24. Apache Camel support</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apache Camel project implements the enterprise integration patterns for building mediation and routing rules in your enterprise application. With the Citrus Camel support you are able to directly interact with the Apache Camel components and route definitions. You can call Camel routes and receive synchronous response messages. You can also simulate the Camel route endpoint with receiving messages and providing simulated response messages.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The camel components in Citrus are kept in a separate Maven module. So you should add the module as Maven dependency to your project accordingly.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>com.consol.citrus<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>citrus-camel<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>2.7.3<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus provides a special Apache Camel configuration schema that is used in our Spring configuration files. You have to include the citrus-camel namespace in your Spring configuration XML files as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:citrus</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/config</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:citrus-camel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/camel/config</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
      <span class="content">http://www.springframework.org/schema/beans</span>
      <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
      <span class="content">http://www.citrusframework.org/schema/config</span>
      <span class="content">http://www.citrusframework.org/schema/config/citrus-config.xsd</span>
      <span class="content">http://www.citrusframework.org/schema/camel/config</span>
      <span class="content">http://www.citrusframework.org/schema/camel/config/citrus-camel-config.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

      [...]

      <span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you are ready to use the Citrus Apache Camel configuration elements using the citrus-camel namespace prefix.</p>
</div>
<div class="paragraph">
<p>The next sections explain the Citrus capabilities while working with Apache Camel.</p>
</div>
<div class="sect2">
<h3 id="camel-endpoint"><a class="anchor" href="#camel-endpoint"></a><a class="link" href="#camel-endpoint">24.1. Camel endpoint</a></h3>
<div class="paragraph">
<p>Camel and Citrus both use the endpoint pattern in order to define message destinations. Users can interact with these endpoints when creating the mediation and routing logic. The Citrus endpoint component for Camel interaction is defined as follows in your Citrus Spring configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-camel:endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">directCamelEndpoint</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">endpoint-uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">direct:news</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Right next to that Citrus endpoint we need the Apache Camel route that is located inside a camel context component.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;camelContext</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">camelContext</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://camel.apache.org/schema/spring</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;route</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">newsRoute</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;from</span> <span class="attribute-name">uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">direct:news</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;to</span> <span class="attribute-name">uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">log:com.consol.citrus.camel?level=INFO</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;to</span> <span class="attribute-name">uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">seda:news-feed</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/route&gt;</span>
<span class="tag">&lt;/camelContext&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the Citrus camel endpoint is able to interact with the Camel route. In the example above the Camel context is placed as Spring bean Camel context.</p>
</div>
<div class="paragraph">
<p>The Camel context is automatically referenced in the Citrus Camel endpoint. This is because Citrus will automatically look for a Camel context in the
Spring bean configuration.</p>
</div>
<div class="paragraph">
<p>In case you have multiple Camel context instances in your configuration you can explicitly link the endpoint to a context with <code>camel-context=&quot;camelContext&quot;</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-camel:endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">directCamelEndpoint</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">camel-contxt</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">camelContext</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">endpoint-uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">direct:news</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This explicitly binds the endpoint to the context named "<em>camelContext</em>". This configuration would be the easiest setup to use Camel with Citrus as you can add the Camel context straight to the Spring bean application context and interact with it in Citrus. Of course you can also import your Camel context and routes from other Spring bean context files or you can start the Camel context routes with Java code.</p>
</div>
<div class="paragraph">
<p>In the example the Apache Camel route is listening on the route endpoint uri <strong>direct:news</strong> . Incoming messages will be logged to the console using a <strong>log</strong> Camel component. After that the message is forwarded to a <strong>seda</strong> Camel component which is a simple queue in memory. So we have a small Camel routing logic with two different message transports.</p>
</div>
<div class="paragraph">
<p>The Citrus endpoint can interact with this sample route definition. The endpoint configuration holds the endpoint uri information that tells Citrus how to access the Apache Camel route destination. This endpoint uri can be any Camel endpoint uri that is used in a Camel route. Here we just use the direct endpoint uri <strong>direct:news</strong> so the sample Camel route gets called directly. In your test case you can use this endpoint component referenced by its id or name in order to send and receive messages on the route address <strong>direct:news</strong> . The Camel route listening on this direct address will be invoked accordingly.</p>
</div>
<div class="paragraph">
<p>The Apache Camel routes support asynchronous and synchronous message communication patterns. By default Citrus uses asynchronous communication with Camel routes. This means that the Citrus producer sends the exchange message to the route endpoint uri and is finished immediately. There is no synchronous response to await. In contrary to that the synchronous endpoint will send and receive a synchronous message on the Camel destination route. We will discuss this later on in this chapter. For now we have a look on how to use the Citrus camel endpoint in a test case in order to send a message to the Camel route:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">directCamelEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plaintext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;payload&gt;</span>Hello from Citrus!<span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Citrus camel endpoint component can also be used in a receive message action in your test case. In this situation you would receive a message from the route endpoint. This is especially designed for queueing endpoint routes such as the Camel seda component. In our example Camel route above the seda Camel component is called with the endpoint uri <strong>seda:news-feed</strong> . This means that the Camel route is sending a message to the seda component. Citrus is able to receive this route message with a endpoint component like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-camel:endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sedaCamelEndpoint</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">endpoint-uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">seda:news-feed</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use the Citrus camel endpoint in your test case receive action in order to consume the message on the seda component.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sedaCamelEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plaintext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;payload&gt;</span>Hello from Citrus!<span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Instead of defining a static Citrus camel component you could also use the dynamic endpoint components in Citrus. This would enable you to send your message directly using the endpoint uri <strong>direct:news</strong> in your test case. Read more about this in <a href="#dynamic-endpoint-components">dynamic-endpoint-components</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Citrus is able to send and receive messages with Camel route endpoint uri. This enables you to invoke a Camel route. The Camel components used is defined by the endpoint uri as usual. When interacting with Camel routes you might need to send back some response messages in order to simulate boundary applications. We will discuss the synchronous communication in the next section.</p>
</div>
</div>
<div class="sect2">
<h3 id="synchronous-camel-endpoint"><a class="anchor" href="#synchronous-camel-endpoint"></a><a class="link" href="#synchronous-camel-endpoint">24.2. Synchronous Camel endpoint</a></h3>
<div class="paragraph">
<p>The synchronous Apache Camel producer sends a message to some route and waits synchronously for the response to arrive. In Camel this communication is represented with the exchange pattern <strong>InOut</strong> . The basic configuration for a synchronous Apache Camel endpoint component looks like follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-camel:sync-endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">camelSyncEndpoint</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">endpoint-uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">direct:hello</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">polling-interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">300</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Synchronous endpoints poll for synchronous reply messages to arrive. The poll interval is an optional setting in order to manage the amount of reply message handshake attempts. Once the endpoint was able to receive the reply message synchronously the test case can receive the reply. In case the reply message is not available in time we raise some timeout error and the test will fail.</p>
</div>
<div class="paragraph">
<p>In a first test scenario we write a test case the sends a message to the synchronous endpoint and waits for the synchronous reply message to arrive. So we have two actions on the same Citrus endpoint, first send then receive.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">camelSyncEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plaintext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;payload&gt;</span>Hello from Citrus!<span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span>

<span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">camelSyncEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plaintext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;payload&gt;</span>This is the reply from Apache Camel!<span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The next variation deals with the same synchronous communication, but send and receive roles are switched. Now Citrus receives a message from a Camel route and has to provide a reply message. We handle this synchronous communication with the same synchronous Apache Camel endpoint component. Only difference is that we initially start the communication by receiving a message from the endpoint. Knowing this Citrus is able to send a synchronous response back. Again just use the same endpoint reference in your test case. So we have again two actions in our test case, but this time first receive then send.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">camelSyncEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plaintext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;payload&gt;</span>Hello from Apache Camel!<span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span>

<span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">camelSyncEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plaintext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;payload&gt;</span>This is the reply from Citrus!<span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is pretty simple. Citrus takes care on setting the Apache Camel exchange pattern <strong>InOut</strong> while using synchronous communications. The Camel routes do respond and Citrus is able to receive the synchronous messages accordingly. With this pattern you can interact with Apache Camel routes where Citrus simulates synchronous clients and consumers.</p>
</div>
</div>
<div class="sect2">
<h3 id="camel-exchange-headers"><a class="anchor" href="#camel-exchange-headers"></a><a class="link" href="#camel-exchange-headers">24.3. Camel exchange headers</a></h3>
<div class="paragraph">
<p>Apache Camel uses exchanges when sending and receiving messages to and from routes. These exchanges hold specific information on the communication outcome. Citrus automatically converts these exchange information to special message header entries. You can validate those exchange headers then easily in your test case:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sedaCamelEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plaintext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;payload&gt;</span>Hello from Camel!<span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
  <span class="tag">&lt;header&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_camel_route_id</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">newsRoute</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_camel_exchange_id</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ID-local-50532-1402653725341-0-3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_camel_exchange_failed</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_camel_exchange_pattern</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">InOnly</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CamelCorrelationId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ID-local-50532-1402653725341-0-1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CamelToEndpoint</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">seda://news-feed</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Besides the Camel specific exchange information the Camel exchange does also hold some custom properties. These properties such as <strong>CamelToEndpoint</strong> or <strong>CamelCorrelationId</strong> are also added automatically to the Citrus message header so can expect them in a receive message action.</p>
</div>
</div>
<div class="sect2">
<h3 id="camel-exception-handling"><a class="anchor" href="#camel-exception-handling"></a><a class="link" href="#camel-exception-handling">24.4. Camel exception handling</a></h3>
<div class="paragraph">
<p>Let us suppose following route definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;camelContext</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">camelContext</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://camel.apache.org/schema/spring</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;route</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">newsRoute</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;from</span> <span class="attribute-name">uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">direct:news</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;to</span> <span class="attribute-name">uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">log:com.consol.citrus.camel?level=INFO</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;to</span> <span class="attribute-name">uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">seda:news-feed</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;onException&gt;</span>
      <span class="tag">&lt;exception&gt;</span>com.consol.citrus.exceptions.CitrusRuntimeException<span class="tag">&lt;/exception&gt;</span>
      <span class="tag">&lt;to</span> <span class="attribute-name">uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">seda:exceptions</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/onException&gt;</span>
  <span class="tag">&lt;/route&gt;</span>
<span class="tag">&lt;/camelContext&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The route has an exception handling block defined that is called as soon as the exchange processing ends up in some error or exception. With Citrus you can also simulate a exchange exception when sending back a synchronous response to a calling route.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sedaCamelEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plaintext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;payload&gt;</span>Something went wrong!<span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
  <span class="tag">&lt;header&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_camel_exchange_exception</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.exceptions.CitrusRuntimeException</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_camel_exchange_exception_message</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Something went wrong!</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_camel_exchange_failed</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This message as response to the <strong>seda:news-feed</strong> route would cause Camel to enter the exception handling in the route definition. The exception handling is activated and calls the error handling route endpoint <strong>seda:exceptions</strong> . Of course Citrus would be able to receive such an exception exchange validating the exception handling outcome.</p>
</div>
<div class="paragraph">
<p>In such failure scenarios the Apache Camel exchange holds the exception information (<strong>CamelExceptionCaught</strong>) such as causing exception class and error message. These headers are present in an error scenario and can be validated in Citrus when receiving error messages as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">errorCamelEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plaintext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;payload&gt;</span>Something went wrong!<span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
  <span class="tag">&lt;header&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_camel_route_id</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">newsRoute</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_camel_exchange_failed</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CamelExceptionCaught</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.exceptions.CitrusRuntimeException: Something went wrong!</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This completes the basic exception handling in Citrus when using the Apache Camel endpoints.</p>
</div>
</div>
<div class="sect2">
<h3 id="camel-context-handling"><a class="anchor" href="#camel-context-handling"></a><a class="link" href="#camel-context-handling">24.5. Camel context handling</a></h3>
<div class="paragraph">
<p>In the previous samples we have used the Apache Camel context as Spring bean context that is automatically loaded when Citrus starts up. Now when using a single Camel context instance Citrus is able to automatically pick this Camel context for route interaction. If you use more that one Camel context you have to tell the Citrus endpoint component which context to use. The endpoint offers an optional attribute called <strong>camel-context</strong> .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-camel:endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">directCamelEndpoint</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">camel-context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">newsContext</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">endpoint-uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">direct:news</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;camelContext</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">newsContext</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://camel.apache.org/schema/spring</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;route</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">newsRoute</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;from</span> <span class="attribute-name">uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">direct:news</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;to</span> <span class="attribute-name">uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">log:com.consol.citrus.camel?level=INFO</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;to</span> <span class="attribute-name">uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">seda:news-feed</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/route&gt;</span>
<span class="tag">&lt;/camelContext&gt;</span>

<span class="tag">&lt;camelContext</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloContext</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://camel.apache.org/schema/spring</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;route</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloRoute</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;from</span> <span class="attribute-name">uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">direct:hello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;to</span> <span class="attribute-name">uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">log:com.consol.citrus.camel?level=INFO</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;to</span> <span class="attribute-name">uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">seda:hello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/route&gt;</span>
<span class="tag">&lt;/camelContext&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example abpove we have two Camel context instances loaded. The endpoint has to pick the context to use with the attribute <strong>camel-context</strong> which resides to the Spring bean id of the Camel context.</p>
</div>
</div>
<div class="sect2">
<h3 id="camel-route-actions"><a class="anchor" href="#camel-route-actions"></a><a class="link" href="#camel-route-actions">24.6. Camel route actions</a></h3>
<div class="paragraph">
<p>Since Citrus 2.4 we introduced some Camel specific test actions that enable easy interaction with Camel routes and the Camel context. The test actions do follow a specific XML namespace so we have to add this namespace to the test case when using the actions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:camel</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/camel/testcase</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
      <span class="content">http://www.springframework.org/schema/beans</span>
      <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
      <span class="content">http://www.citrusframework.org/schema/camel/testcase</span>
      <span class="content">http://www.citrusframework.org/schema/camel/testcase/citrus-camel-testcase.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

  [...]

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We added a special camel namespace with prefix <strong>camel:</strong> so now we can start to add Camel test actions to the test case:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CamelRouteIT</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;actions&gt;</span>
      <span class="tag">&lt;camel:create-routes&gt;</span>
        <span class="tag">&lt;routeContext</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://camel.apache.org/schema/spring</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;route</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">route_1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;from</span> <span class="attribute-name">uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">direct:test1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;to</span> <span class="attribute-name">uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mock:test1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;/route&gt;</span>

          <span class="tag">&lt;route</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">route_2</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
              <span class="tag">&lt;from</span> <span class="attribute-name">uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">direct:test2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
              <span class="tag">&lt;to</span> <span class="attribute-name">uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mock:test2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;/route&gt;</span>
        <span class="tag">&lt;/routeContext&gt;</span>
      <span class="tag">&lt;/camel:create-routes&gt;</span>

      <span class="tag">&lt;camel:create-routes</span> <span class="attribute-name">camel-context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">camelContext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;routeContext</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://camel.apache.org/schema/spring</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;route&gt;</span>
            <span class="tag">&lt;from</span> <span class="attribute-name">uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">direct:test3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;to</span> <span class="attribute-name">uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mock:test3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;/route&gt;</span>
        <span class="tag">&lt;/routeContext&gt;</span>
      <span class="tag">&lt;/camel:create-routes&gt;</span>
  <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above we have used the <strong>camel:create-route</strong> test action that will create new Camel routes at runtime in the Camel context. The target Camel context is referenced with an automatically context lookup. The default Camel context name in this lookup is "<em>citrusCamelContext</em>".
If no specific settings are set Citrus will automatically try to look up the Camel context with name "<em>citrusCamelContext</em>" in the Spring bean configuration. All
route operations will target this Camel context then.</p>
</div>
<div class="paragraph">
<p>In addition to that you can skip this lookup and directly reference a target Camel context with the action attribute <strong>camel-context</strong> (used in the second action above).</p>
</div>
<div class="paragraph">
<p>Removing routes at runtime is also supported.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CamelRouteIT</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;actions&gt;</span>
      <span class="tag">&lt;camel:remove-routes</span> <span class="attribute-name">camel-context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">camelContext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;route</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">route_1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;route</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">route_2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;route</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">route_3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/camel:remove-routes&gt;</span>
  <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Next operation we will discuss is the start and stop of existing Camel routes:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CamelRouteIT</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;actions&gt;</span>
      <span class="tag">&lt;camel:start-routes</span> <span class="attribute-name">camel-context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">camelContext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;route</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">route_1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/camel:start-routes&gt;</span>

      <span class="tag">&lt;camel:stop-routes</span> <span class="attribute-name">camel-context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">camelContext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;route</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">route_2</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;route</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">route_3</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/camel:stop-routes&gt;</span>
  <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Starting and stopping Camel routes at runtime is important when temporarily Citrus need to receive a message on a Camel endpoint URI. We can stop a route, use a Citrus camel endpoint instead for validation and start the route after the test is done. This way wen can also simulate errors and failure scenarios in a Camel route interaction.</p>
</div>
<div class="paragraph">
<p>Of course all Camel route actions are also available in Java DSL.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="directive">private</span> CamelContext camelContext;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> camelRouteTest() {
    camel().context(camelContext).create(<span class="keyword">new</span> RouteBuilder(camelContext) {
          <span class="annotation">@Override</span>
          <span class="directive">public</span> <span class="type">void</span> configure() <span class="directive">throws</span> <span class="exception">Exception</span> {
              from(<span class="string"><span class="delimiter">&quot;</span><span class="content">direct:news</span><span class="delimiter">&quot;</span></span>)
                  .routeId(<span class="string"><span class="delimiter">&quot;</span><span class="content">route_1</span><span class="delimiter">&quot;</span></span>)
                  .autoStartup(<span class="predefined-constant">false</span>)
                  .setHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">headline</span><span class="delimiter">&quot;</span></span>, simple(<span class="string"><span class="delimiter">&quot;</span><span class="content">This is BIG news!</span><span class="delimiter">&quot;</span></span>))
                  .to(<span class="string"><span class="delimiter">&quot;</span><span class="content">mock:news</span><span class="delimiter">&quot;</span></span>);

              from(<span class="string"><span class="delimiter">&quot;</span><span class="content">direct:rumors</span><span class="delimiter">&quot;</span></span>)
                  .routeId(<span class="string"><span class="delimiter">&quot;</span><span class="content">route_2</span><span class="delimiter">&quot;</span></span>)
                  .autoStartup(<span class="predefined-constant">false</span>)
                  .setHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">headline</span><span class="delimiter">&quot;</span></span>, simple(<span class="string"><span class="delimiter">&quot;</span><span class="content">This is just a rumor!</span><span class="delimiter">&quot;</span></span>))
                  .to(<span class="string"><span class="delimiter">&quot;</span><span class="content">mock:rumors</span><span class="delimiter">&quot;</span></span>);
          }
      });

    camel().context(camelContext).start(<span class="string"><span class="delimiter">&quot;</span><span class="content">route_1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">route_2</span><span class="delimiter">&quot;</span></span>);

    camel().context(camelContext).stop(<span class="string"><span class="delimiter">&quot;</span><span class="content">route_2</span><span class="delimiter">&quot;</span></span>);

    camel().context(camelContext).remove(<span class="string"><span class="delimiter">&quot;</span><span class="content">route_2</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see we have access to the Camel route builder that adds <code>n-1</code> new Camel routes to the context. After that we can start, stop and remove the routes within the test case.</p>
</div>
</div>
<div class="sect2">
<h3 id="camel-controlbus-actions"><a class="anchor" href="#camel-controlbus-actions"></a><a class="link" href="#camel-controlbus-actions">24.7. Camel controlbus actions</a></h3>
<div class="paragraph">
<p>The Camel controlbus component is a good way to access route statistics and route status information within a Camel context. Citrus provides controlbus test actions to easily access the controlbus operations at runtime.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">CamelControlBusIT</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;actions&gt;</span>
    <span class="tag">&lt;camel:control-bus&gt;</span>
      <span class="tag">&lt;camel:route</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">route_1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">start</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/camel:control-bus&gt;</span>

    <span class="tag">&lt;camel:control-bus</span> <span class="attribute-name">camel-context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">camelContext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;camel:route</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">route_2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;camel:result&gt;</span>Stopped<span class="tag">&lt;/camel:result&gt;</span>
    <span class="tag">&lt;/camel:control-bus&gt;</span>

    <span class="tag">&lt;camel:control-bus&gt;</span>
      <span class="tag">&lt;camel:language</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simple</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>${camelContext.stop()}<span class="tag">&lt;/camel:language&gt;</span>
    <span class="tag">&lt;/camel:control-bus&gt;</span>

    <span class="tag">&lt;camel:control-bus</span> <span class="attribute-name">camel-context</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">camelContext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;camel:language</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simple</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>${camelContext.getRouteStatus('route_3')}<span class="tag">&lt;/camel:language&gt;</span>
      <span class="tag">&lt;camel:result&gt;</span>Started<span class="tag">&lt;/camel:result&gt;</span>
    <span class="tag">&lt;/camel:control-bus&gt;</span>
  <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The example test case shows the controlbus access. As already mentioned you can explicitly reference a target Camel context with <code>camel-context=&quot;camelContext&quot;</code>. In case no specific context is referenced Citrus will automatically lookup a target Camel context with the default context name "<em>citrusCamelContext</em>".</p>
</div>
<div class="paragraph">
<p>Camel provides two different ways to specify operations and parameters. The first option is the use of an <strong>action</strong> attribute. The Camel route id has to be specified as mandatory attribute. As a result the controlbus action will be executed on the target route during test runtime. This way we can also start and stop Camel routes in a Camel context.</p>
</div>
<div class="paragraph">
<p>In case an controlbus operation has a result such as the <strong>status</strong> action we can specify a control result that is compared. Citrus will raise validation exceptions when the results differ. The second option for executing a controlbus action is the language expression. We can use Camel language expressions on the Camel context for accessing a controlbus operation. Also here we can define an optional outcome as expected result.</p>
</div>
<div class="paragraph">
<p>The Java DSL also supports these controlbus operations as the next example shows:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="directive">private</span> CamelContext camelContext;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> camelRouteTest() {
      camel().controlBus()
              .route(<span class="string"><span class="delimiter">&quot;</span><span class="content">my_route</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">start</span><span class="delimiter">&quot;</span></span>);

      camel().controlBus()
              .language(SimpleBuilder.simple(<span class="string"><span class="delimiter">&quot;</span><span class="content">${camelContext.getRouteStatus('my_route')}</span><span class="delimiter">&quot;</span></span>))
              .result(ServiceStatus.Started);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Java DSL works with Camel language expression builders as well as <strong>ServiceStatus</strong> enum values as expected result.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vert-x-event-bus"><a class="anchor" href="#vert-x-event-bus"></a><a class="link" href="#vert-x-event-bus">25. Vert.x event bus support</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Vert.x is an application platform for the JVM that provides a network event bus for lightweight scalable messaging solutions. The Citrus Vert.x
components do participate on that event bus messaging as producer or consumer. With these components you can access Vert.x instances
available in your network in order to test those Vert.x applications in some integration test scenario.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Vert.x components in Citrus are kept in a separate Maven module. So you should add the module as Maven dependency to your project accordingly.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>com.consol.citrus<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>citrus-vertx<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>2.7.3<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus provides a special Vert.x configuration schema that is used in our Spring configuration files. You have to include the citrus-vertx
namespace in your Spring configuration XML files as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:citrus</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/config</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:citrus-vertx</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/vertx/config</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
      <span class="content">http://www.springframework.org/schema/beans</span>
      <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
      <span class="content">http://www.citrusframework.org/schema/config</span>
      <span class="content">http://www.citrusframework.org/schema/config/citrus-config.xsd</span>
      <span class="content">http://www.citrusframework.org/schema/vertx/config</span>
      <span class="content">http://www.citrusframework.org/schema/vertx/config/citrus-vertx-config.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

      [...]

      <span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you are ready to use the Citrus Vert.x configuration elements using the citrus-vertx namespace prefix.</p>
</div>
<div class="paragraph">
<p>The next sections discuss sending and receiving operations on the Vert.x event bus with Citrus.</p>
</div>
<div class="sect2">
<h3 id="vert-x-endpoint"><a class="anchor" href="#vert-x-endpoint"></a><a class="link" href="#vert-x-endpoint">25.1. Vert.x endpoint</a></h3>
<div class="paragraph">
<p>As usual Citrus uses an endpoint component in order to specify some message destination to send and receive messages to and from.
The Vert.x endpoint component is defined as follows in your Citrus Spring configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-vertx:endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simpleVertxEndpoint</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">host</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5001</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">pubSubDomain</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">address</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">news-feed</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vertxInstanceFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.vertx.factory.CachingVertxInstanceFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The endpoint holds some general information how to access the Vert.x event bus. Host and port values define the Vert.x Hazelcast
cluster hostname and port. Citrus starts a new Vert.x instance using this cluster. So all other Vert.x instances connected to this
cluster host will receive the event bus messages from Citrus during the test. In your test case you can use this endpoint component
referenced by its id or name in order to send and receive messages on the event bus address <strong>news-feed</strong> . In Vert.x the event bus
address defines the destination for event consumers to listen on. As already mentioned cluster hostname and port are optional, so
Citrus will use <strong>localhost</strong> and a new random port on the cluster host if nothing is specified.</p>
</div>
<div class="paragraph">
<p>The Vert.x event bus supports publish-subscribe and point-to-point message communication patterns. By default the <strong>pubSubDomain</strong> in
Citrus is false so the event bus sender will initiate a point-to-point communication on the event bus address. This means that only
one single consumer on the event bus address will receive the message. If there are more consumers on the address the first to come
wins and receives the message. In contrary to that the publish-subscribe scenario would deliver the message to all available consumers
on the event bus address simultaneously. You can enable the <strong>pubSubDomain</strong> on the Vert.x endpoint component for this communication pattern.</p>
</div>
<div class="paragraph">
<p>The Vert.x endpoint needs a instance factory implementation in order to create the embedded Vert.x instance. By default the bean name
<strong>vertxInstanceFactory</strong> is recognized by all Vert.x endpoint components. We will talk about Vert.x instance factories in more detail
later on in this chapter.</p>
</div>
<div class="paragraph">
<p>As message content you can send and receive JSON objects or simple character sequences to the event bus. Let us have a look at a
simple sample sending action that uses the new Vert.x endpoint component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simpleVertxEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plaintext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;payload&gt;</span>Hello from Citrus!<span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As the Vert.x Citrus endpoint is bidirectional you can also receive messages from the event bus.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simpleVertxEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plaintext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;payload&gt;</span>Hello from Vert.x!<span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
  <span class="tag">&lt;header&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_vertx_address</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">news-feed</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus automatically adds some special message headers to the message, so you can validate the Vert.x event bus address. This completes
the simple send and receive operations on a Vert.x event bus. Now lets move on to synchronous endpoints where Citrus waits for a reply on the event bus.</p>
</div>
</div>
<div class="sect2">
<h3 id="synchronous-vert-x-endpoint"><a class="anchor" href="#synchronous-vert-x-endpoint"></a><a class="link" href="#synchronous-vert-x-endpoint">25.2. Synchronous Vert.x endpoint</a></h3>
<div class="paragraph">
<p>The synchronous Vert.x event bus producer sends a message and waits synchronously for the response to arrive on some reply address destination.
The reply address name is generated automatically and set in the request message header attributes so the receiving counterpart in this
communication can send its reply to that event bus address. The basic configuration for a synchronous Vert.x endpoint component looks like follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-vertx:sync-endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vertxSyncEndpoint</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">address</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">polling-interval</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">300</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Synchronous endpoints poll for synchronous reply messages to arrive on the event bus reply address. The poll interval is an optional
setting in order to manage the amount of reply message handshake attempts. Once the endpoint was able to receive the reply message
synchronously the test case can receive the reply. In case all message handshake attempts do fail because the reply message is not
available in time we raise some timeout error and the test will fail.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Vert.x endpoint uses temporary reply address destinations. The temporary reply address in generated and is only used once
for a single communication handshake. After that the reply address is dismissed again.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When sending a message to the synchronous Vert.x endpoint the producer will wait synchronously for the response message to arrive
on the reply address. You can receive the reply message in your test case using the same endpoint component. So we have two actions
on the same endpoint, first send then receive.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vertxSyncEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plaintext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;payload&gt;</span>Hello from Citrus!<span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span>

<span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vertxSyncEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plaintext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;payload&gt;</span>This is the reply from Vert.x!<span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the last section we saw that synchronous communication is based on reply messages on temporary reply event bus address. We saw that
Citrus is able to send messages to event bus address and wait for reply messages to arrive. This next section deals with the same synchronous
communication, but send and receive roles are switched. Now Citrus receives a message and has to send a reply message to a temporary reply address.</p>
</div>
<div class="paragraph">
<p>We handle this synchronous communication with the same synchronous Vert.x endpoint component. Only difference is that we initially
start the communication by receiving a message from the endpoint. Knowing this Citrus is able to send a synchronous response back.
Again just use the same endpoint reference in your test case. The handling of the temporary reply address is done automatically behind the scenes.
So we have again two actions in our test case, but this time first receive then send.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vertxSyncEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plaintext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;payload&gt;</span>Hello from Vert.x!<span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span>

<span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vertxSyncEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plaintext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;payload&gt;</span>This is the reply from Citrus!<span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The synchronous message endpoint for Vert.x event bus communication will handle all reply address destinations and provide those behind the scenes.</p>
</div>
</div>
<div class="sect2">
<h3 id="vert-x-instance-factory"><a class="anchor" href="#vert-x-instance-factory"></a><a class="link" href="#vert-x-instance-factory">25.3. Vert.x instance factory</a></h3>
<div class="paragraph">
<p>Citrus starts an embedded Vert.x instance at runtime in order to participate in the Vert.x cluster. Within this cluster multiple Vert.x
instances are connected via the event bus. For starting the Vert.x event bus Citrus uses a cluster hostname and port definition. You can
customize this cluster host in order to connect to a very special cluster in your network.</p>
</div>
<div class="paragraph">
<p>Now Citrus needs to manage the Vert.x instances created during the test run. By default Citrus will look for a instance factory bean
named <strong>vertxInstanceFactory</strong> . You can choose the factory implementation to use in your project. By default you can use the caching factory
implementation that caches the Vert.x instances so we do not connect more than one Vert.x instance to the same cluster host.
Citrus offers following instance factory implementations:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">com.consol.citrus.vertx.factory.CachingVertxInstanceFactory</dt>
<dd>
<p>default implementation that reuses the Vert.x instance based on given
cluster host and port. With this implementation we ensure to connect a single Citrus Vert.x instance to a cluster host.</p>
</dd>
<dt class="hdlist1">com.consol.citrus.vertx.factory.SingleVertxInstanceFactory</dt>
<dd>
<p>creates a single Vert.x instance and reuses this instance for all endpoints.
You can also set your very custom Vert.x instance via configuration for custom Vert.x instantiation.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The instance factory implementations do implement the <strong><em>VertxInstanceFactory</em></strong> interface. So you can also provide your very special implementation.
By default Citrus looks for a bean named <strong>vertxInstanceFactory</strong> but you can also define your very special factory implementation onm an endpoint component.
The Vert.x instance factory is set on the Vert.x endpoint as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-vertx:endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vertxHelloEndpoint</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">address</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">vertx-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">singleVertxInstanceFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">singleVertxInstanceFactory</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.vertx.factory.SingleVertxInstanceFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mail"><a class="anchor" href="#mail"></a><a class="link" href="#mail">26. Mail support</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sending and receiving mails is the next interest we are going to talk about. When dealing with mail communication you most certainly need to interact with some sort of IMAP or POP mail server. But in Citrus we do not want to manage mails in a personal inbox. We just need to be able to exchange mail messages the persisting in a user inbox is not part of our business.</p>
</div>
<div class="paragraph">
<p>This is why Citrus provides <strong>just</strong> a SMTP mail server which accepts mail messages from clients. Once the SMTP server has accepted an incoming mail it forwards those data to the running test case. In the test case you can receive the incoming mail message and perform message validation as usual. The mail sending part is easy as Citrus offers a mail client that connects to some SMTP server for sending mails to the outside world.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The mail components in Citrus are kept in a separate Maven module. So you should check that the module is available as Maven dependency in your project
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>com.consol.citrus<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>citrus-mail<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>2.7.3<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As usual Citrus provides a customized mail configuration schema that is used in Spring configuration files. Simply include the citrus-mail namespace in the configuration XML files as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:citrus</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/config</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:citrus-mail</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/mail/config</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
      <span class="content">http://www.springframework.org/schema/beans</span>
      <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
      <span class="content">http://www.citrusframework.org/schema/config</span>
      <span class="content">http://www.citrusframework.org/schema/config/citrus-config.xsd</span>
      <span class="content">http://www.citrusframework.org/schema/mail/config</span>
      <span class="content">http://www.citrusframework.org/schema/mail/config/citrus-mail-config.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

      [...]

      <span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you are ready to use the customized Http configuration elements with the citrus-mail namespace prefix.</p>
</div>
<div class="paragraph">
<p>Read the next section in order to find out more about the mail message support in Citrus.</p>
</div>
<div class="sect2">
<h3 id="mail-client"><a class="anchor" href="#mail-client"></a><a class="link" href="#mail-client">26.1. Mail client</a></h3>
<div class="paragraph">
<p>The mail sending part is quite easy and straight forward. We just need to send a mail message to some SMTP server. So Citrus provides a mail client that sends out mail messages.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-mail:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simpleMailClient</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">host</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">25025</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is how a Citrus mail client component is defined in the Spring application context. You can use this client referenced by its id or name in your test case in a message sending action. The client defines a host and port attribute which should connect the client to some SMTP server instance.</p>
</div>
<div class="paragraph">
<p>We all know mail message contents. The mail message has some general properties set by the user:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
from
</td>
<td class="hdlist2">
<p>The message sender mail address</p>
</td>
</tr>
<tr>
<td class="hdlist1">
to
</td>
<td class="hdlist2">
<p>The message recipient mail address. You can add multiple recipients by using a comma separated list.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
cc
</td>
<td class="hdlist2">
<p>Copy recipient mail address. You can add multiple recipients by using a comma separated list.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
bcc
</td>
<td class="hdlist2">
<p>Blind copy recipient mail address. You can add multiple recipients by using a comma separated list.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
subject
</td>
<td class="hdlist2">
<p>Some subject used as mail head line.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As a tester you are able to set these properties in your test case. Citrus defines a XML mail message representation that you can use inside your send action. Let us have a look at this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simpleMailClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;mail-message</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/mail/message</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;from&gt;</span>christoph@citrusframework.com<span class="tag">&lt;/from&gt;</span>
                <span class="tag">&lt;to&gt;</span>dev@citrusframework.com<span class="tag">&lt;/to&gt;</span>
                <span class="tag">&lt;cc&gt;</span><span class="tag">&lt;/cc&gt;</span>
                <span class="tag">&lt;bcc&gt;</span><span class="tag">&lt;/bcc&gt;</span>
                <span class="tag">&lt;subject&gt;</span>This is a test mail message<span class="tag">&lt;/subject&gt;</span>
                <span class="tag">&lt;body&gt;</span>
                    <span class="tag">&lt;contentType&gt;</span>text/plain; charset=utf-8<span class="tag">&lt;/contentType&gt;</span>
                    <span class="tag">&lt;content&gt;</span>Hello Citrus mail server!<span class="tag">&lt;/content&gt;</span>
                <span class="tag">&lt;/body&gt;</span>
            <span class="tag">&lt;/mail-message&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The basic XML mail message representation defines a list of basic mail properties such as <strong>from</strong>, <strong>to</strong> or <strong>subject</strong> . In addition to that we define a text body which is either plain text or HTML. You can specify the content type of the mail body very easy (e.g. text/plain or text/html). By default Citrus uses <strong>text/plain</strong> content type.</p>
</div>
<div class="paragraph">
<p>Now when dealing with mail messages you often come to use multipart structures for attachments. In Citrus you can define attachment content as base64 character sequence. The Citrus mail client will automatically create a proper multipart mail mime message using the content types and body parts specified.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simpleMailClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;mail-message</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/mail/message</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;from&gt;</span>christoph@citrusframework.com<span class="tag">&lt;/from&gt;</span>
                <span class="tag">&lt;to&gt;</span>dev@citrusframework.com<span class="tag">&lt;/to&gt;</span>
                <span class="tag">&lt;cc&gt;</span><span class="tag">&lt;/cc&gt;</span>
                <span class="tag">&lt;bcc&gt;</span><span class="tag">&lt;/bcc&gt;</span>
                <span class="tag">&lt;subject&gt;</span>This is a test mail message<span class="tag">&lt;/subject&gt;</span>
                <span class="tag">&lt;body&gt;</span>
                    <span class="tag">&lt;contentType&gt;</span>text/plain; charset=utf-8<span class="tag">&lt;/contentType&gt;</span>
                    <span class="tag">&lt;content&gt;</span>Hello Citrus mail server!<span class="tag">&lt;/content&gt;</span>
                    <span class="tag">&lt;attachments&gt;</span>
                        <span class="tag">&lt;attachment&gt;</span>
                            <span class="tag">&lt;contentType&gt;</span>text/plain; charset=utf-8<span class="tag">&lt;/contentType&gt;</span>
                            <span class="tag">&lt;content&gt;</span>This is attachment data<span class="tag">&lt;/content&gt;</span>
                            <span class="tag">&lt;fileName&gt;</span>attachment.txt<span class="tag">&lt;/fileName&gt;</span>
                        <span class="tag">&lt;/attachment&gt;</span>
                    <span class="tag">&lt;/attachments&gt;</span>
                <span class="tag">&lt;/body&gt;</span>
            <span class="tag">&lt;/mail-message&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That completes the basic mail client capabilities. But wait we have not talked about error scenarios where mail communication results in error. When running into mail error scenarios we have to handle the error respectively with exception handling. When the mail server responded with errors Citrus will raise mail exceptions automatically and your test case fails accordingly.</p>
</div>
<div class="paragraph">
<p>As a tester you can catch and assert these mail exceptions verifying your error scenario.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;assert</span> <span class="attribute-name">exception</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.mail.MailSendException</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;when&gt;</span>
        <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simpleMailClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;message&gt;</span>
                <span class="tag">&lt;payload&gt;</span>
                    <span class="tag">&lt;mail-message</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/mail/message</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                        [...]
                    <span class="tag">&lt;/mail-message&gt;</span>
                <span class="tag">&lt;/payload&gt;</span>
            <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/send&gt;</span>
    <span class="tag">&lt;/when&gt;</span>
<span class="tag">&lt;assert</span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We assert the <strong><em>MailSendException</em></strong> from Spring to be thrown while sending the mail message to the SMTP server. With exception message validation you are able to expect very specific mail send errors on the client side. This is how you can handle some sort of error situation returned by the mail server. Speaking of mail servers we need to also talk about providing a mail server endpoint in Citrus for clients. This is part of our next section.</p>
</div>
</div>
<div class="sect2">
<h3 id="mail-server"><a class="anchor" href="#mail-server"></a><a class="link" href="#mail-server">26.2. Mail server</a></h3>
<div class="paragraph">
<p>Consuming mail messages is a more complicated task as we need to have some sort of server that clients can connect to. In your mail client software you typically point to some IMAP or POP inbox and receive mails from that endpoint. In Citrus we do not want to manage a whole personal mail inbox such as IMAP or POP would provide. We just need a SMTP server endpoint for clients to send mails to. The SMTP server accepts mail messages and forwards those to a running test case for further validation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We have no user inbox where incoming mails are stored. The mail server just forwards incoming mails to the running test for validation. After the test the incoming mail message is gone.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And this is exactly what the Citrus mail server is capable of. The server is a very lightweight SMTP server. All incoming mail client connections are accepted by default and the mail data is converted into a Citrus XML mail interface representation. The XML mail message is then passed to the running test for validation.</p>
</div>
<div class="paragraph">
<p>Let us have a look at the Citrus mail server component and how you can add it to the Spring application context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-mail:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simpleMailServer</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">25025</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">auto-start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The mail server component receives several properties such as <strong>port</strong> or <strong>auto-start</strong> . Citrus starts a in memory SMTP server that clients can connect to.</p>
</div>
<div class="paragraph">
<p>In your test case you can then receive the incoming mail messages on the server in order to perform the well known XML validation mechanisms within Citrus. The message header and the payload contain all mail information so you can verify the content with expected templates as usual:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">simpleMailServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;mail-message</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/mail/message</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;from&gt;</span>christoph@citrusframework.com<span class="tag">&lt;/from&gt;</span>
                <span class="tag">&lt;to&gt;</span>dev@citrusframework.com<span class="tag">&lt;/to&gt;</span>
                <span class="tag">&lt;cc&gt;</span><span class="tag">&lt;/cc&gt;</span>
                <span class="tag">&lt;bcc&gt;</span><span class="tag">&lt;/bcc&gt;</span>
                <span class="tag">&lt;subject&gt;</span>This is a test mail message<span class="tag">&lt;/subject&gt;</span>
                <span class="tag">&lt;body&gt;</span>
                    <span class="tag">&lt;contentType&gt;</span>text/plain; charset=utf-8<span class="tag">&lt;/contentType&gt;</span>
                    <span class="tag">&lt;content&gt;</span>Hello Citrus mail server!<span class="tag">&lt;/content&gt;</span>
                <span class="tag">&lt;/body&gt;</span>
            <span class="tag">&lt;/mail-message&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
    <span class="tag">&lt;header&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_mail_from</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">christoph@citrusframework.com</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_mail_to</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dev@citrusframework.com</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_mail_subject</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">This is a test mail message</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_mail_content_type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain; charset=utf-8</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/header&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The general mail properties such as <strong>from</strong>, <strong>to</strong>, <strong>subject</strong> are available as elements in the mail payload and in the message header information. The message header names do start with a common Citrus mail prefix <strong>citrus_mail</strong> . Following from that you can verify these special mail message headers in your test as shown above. Citrus offers following mail headers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>citrus_mail_from</p>
</li>
<li>
<p>citrus_mail_to</p>
</li>
<li>
<p>citrus_mail_cc</p>
</li>
<li>
<p>citrus_mail_bcc</p>
</li>
<li>
<p>citrus_mail_subject</p>
</li>
<li>
<p>citrus_mail_replyTo</p>
</li>
<li>
<p>citrus_mail_date</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition to that Citrus converts the incoming mail data to a special XML mail representation which is passed as message payload to the test. The mail body parts are represented as body and optional attachment elements. As this is plain XML you can verify the mail message content as usual using Citrus variables, functions and validation matchers.</p>
</div>
<div class="paragraph">
<p>Regardless of how the mail message has passed the validation the Citrus SMTP mail server will automatically respond with success codes (SMTP 250 OK) to the calling client. This is the basic Citrus mail server behavior where all client connections are accepted an all mail messages are responded with SMTP 250 OK response codes.</p>
</div>
<div class="paragraph">
<p>Now in more advanced usage scenarios the tester may want to control the mail communication outcome. User can force some error scenarios where mail clients are not accepted or mail communication should fail with some SMTP error state for instance.</p>
</div>
<div class="paragraph">
<p>By using a more advanced mail server setup the tester gets more power to sending back mail server response codes to the mail client. Just use the advanced mail adapter implementation in your mail server component configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-mail:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">advancedMailServer</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">auto-accept</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">split-multipart</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">25025</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">auto-start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We have disabled the <strong>auto-accept</strong> mode on the mail server. This means that we have to do some additional steps in your test case to accept the incoming mail message first. So we can decide in our test case whether to accept or decline the incoming mail message for a more powerful test. You accept/decline a mail message with a special XML accept request/response exchange in your test case:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">advancedMailServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;accept-request</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/mail/message</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;from&gt;</span>christoph@citrusframework.com<span class="tag">&lt;/from&gt;</span>
                <span class="tag">&lt;to&gt;</span>dev@citrusframework.com<span class="tag">&lt;/to&gt;</span>
            <span class="tag">&lt;/accept-request&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So before receiving the actual mail message we receive this simple accept-request in our test. The accept request gives us the message <strong>from</strong> and <strong>to</strong> resources of the mail message. Now the test decides to also decline a mail client connection. You can simulate that the server does not accept the mail client connection by sending back a negative accept response.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">advancedMailServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;accept-response</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/mail/message</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;accept&gt;</span>true<span class="tag">&lt;/accept&gt;</span>
            <span class="tag">&lt;/accept-response&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Depending on the accept outcome the mail client will receive an error response with proper error codes. If you accept the mail message with a positive accept response the next step in your test receives the actual mail message as we have seen it before in this chapter.</p>
</div>
<div class="paragraph">
<p>Now besides not accepting a mail message in the first place you can als simulate another error scenario with the mail server. In this scenario the mail server should respond with some sort of SMTP error code after accepting the message. This is done with a special mail response message like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">advancedMailServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;mail-message</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/mail/message</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;from&gt;</span>christoph@citrusframework.com<span class="tag">&lt;/from&gt;</span>
                <span class="tag">&lt;to&gt;</span>dev@citrusframework.com<span class="tag">&lt;/to&gt;</span>
                <span class="tag">&lt;cc&gt;</span><span class="tag">&lt;/cc&gt;</span>
                <span class="tag">&lt;bcc&gt;</span><span class="tag">&lt;/bcc&gt;</span>
                <span class="tag">&lt;subject&gt;</span>This is a test mail message<span class="tag">&lt;/subject&gt;</span>
                <span class="tag">&lt;body&gt;</span>
                    <span class="tag">&lt;contentType&gt;</span>text/plain; charset=utf-8<span class="tag">&lt;/contentType&gt;</span>
                    <span class="tag">&lt;content&gt;</span>Hello Citrus mail server!<span class="tag">&lt;/content&gt;</span>
                <span class="tag">&lt;/body&gt;</span>
            <span class="tag">&lt;/mail-message&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span>

<span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">advancedMailServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;mail-response</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/mail/message</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;code&gt;</span>443<span class="tag">&lt;/code&gt;</span>
                <span class="tag">&lt;message&gt;</span>Failed!<span class="tag">&lt;/message&gt;</span>
            <span class="tag">&lt;/mail-response&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see from the example above we first accept the connection and receive the mail content as usual. Now the test returns a negative mail response with some error code reason set. The Citrus SMTP communication will then fail and the calling mail client receives the respective error.</p>
</div>
<div class="paragraph">
<p>If you skip the negative mail response the server will automatically response with positive SMTP response codes to the calling client.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="arquillian"><a class="anchor" href="#arquillian"></a><a class="link" href="#arquillian">27. Arquillian support</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Arquillian is a well known integration test framework that comes with a great feature set when it comes to Java EE testing inside of a full qualified application server. With Arquiliian you can deploy your Java EE services in a real application server of your choice and execute the tests inside the application server boundaries. This makes it very easy to test your Java EE services in scope with proper JNDI resource allocation and other resources provided by the application server. Citrus is able to connect with the Arquillian test case. Speaking in more detail your Arquillian test is able to use a Citrus extension in order to use the Citrus feature set inside the Arquillian boundaries.</p>
</div>
<div class="paragraph">
<p>Read the next section in order to find out more about the Citrus Arquillian extension.</p>
</div>
<div class="sect2">
<h3 id="citrus-arquillian-extension"><a class="anchor" href="#citrus-arquillian-extension"></a><a class="link" href="#citrus-arquillian-extension">27.1. Citrus Arquillian extension</a></h3>
<div class="paragraph">
<p>Arquillian offers a fine mechanism for extensions adding features to the Arquillian test setup and test execution. The Citrus extension respectively adds Citrus framework instance creation and Citrus test execution to the Arquillian world. First of all lets have a look at the extension descriptor properties settable via <strong>arquillian.xml</strong> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;extension</span> <span class="attribute-name">qualifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrusVersion</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>2.7.3<span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">autoPackage</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>true<span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">suiteName</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>citrus-arquillian-suite<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/extension&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Citrus extension uses a specific qualifier <strong>citrus</strong> for defining properties inside the Arquillian descriptor. Following properties are settable in current version:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">citrusVersion</dt>
<dd>
<p>The explicit version of Citrus that should be used. Be sure to have the same library version available in your project (e.g. as Maven dependency).
This property is optional. By default the extension just uses the latest stable version.</p>
</dd>
<dt class="hdlist1">autoPackage</dt>
<dd>
<p>When true (default setting) the extension will automatically add Citrus libraries and all transitive dependencies to the test deployment.
This automatically enables you to use the Citrus API inside the Arquillian test even when the test is executed inside the application container.</p>
</dd>
<dt class="hdlist1">suiteName</dt>
<dd>
<p>This optional setting defines the name of the test suite that is used for the Citrus test run. When using before/after suite functionality in Citrus this setting might be of interest.</p>
</dd>
<dt class="hdlist1">configurationClass</dt>
<dd>
<p>Full qualified Java class name of customized Citrus Spring bean configuration to use when loading the Citrus Spring application context.
As a user you can define a custom configuration class that must be a subclass of com.consol.citrus.config.CitrusSpringConfig. When specified the custom class is loaded otherwise the default
com.consol.citrus.config.CitrusSpringConfig is loaded to set up the Spring application context.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Now that we have added the extension descriptor with all properties we need to add the respective Citrus Arquillian extension as library to our project. This is done via Maven in your project&#8217;s POM file as normal dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>com.consol.citrus<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>citrus-arquillian<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>2.7.3<span class="tag">&lt;/version&gt;</span>
  <span class="tag">&lt;scope&gt;</span>test<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now everything is set up to use Citrus within Arquillian. Lets use Citrus functionality in a Arquillian test case.</p>
</div>
</div>
<div class="sect2">
<h3 id="client-side-testing"><a class="anchor" href="#client-side-testing"></a><a class="link" href="#client-side-testing">27.2. Client side testing</a></h3>
<div class="paragraph">
<p>Arquillian separates client and container side testing. When using client side testing the test case is executed outside of the application container deployment. This means that your test case has no direct access to container managed resources such as JNDI resources. On the plus side it is not necessary to include your test in the container deployment. The test case interacts with the container deployment as a normal client would do. Lets have a look at a first example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(Arquillian.class)
<span class="annotation">@RunAsClient</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">EmployeeResourceTest</span> {

    <span class="annotation">@CitrusFramework</span>
    <span class="directive">private</span> Citrus citrusFramework;

    <span class="annotation">@ArquillianResource</span>
    <span class="directive">private</span> <span class="predefined-type">URL</span> baseUri;

    <span class="directive">private</span> <span class="predefined-type">String</span> serviceUri;

    <span class="annotation">@Deployment</span>
    <span class="directive">public</span> <span class="directive">static</span> WebArchive createDeployment() {
        <span class="keyword">return</span> ShrinkWrap.create(WebArchive.class)
            .addClasses(RegistryApplication.class, EmployeeResource.class,
                Employees.class, Employee.class, EmployeeRepository.class);
    }

    <span class="annotation">@Before</span>
    <span class="directive">public</span> <span class="type">void</span> setUp() <span class="directive">throws</span> <span class="exception">MalformedURLException</span> {
        serviceUri = <span class="keyword">new</span> <span class="predefined-type">URL</span>(baseUri, <span class="string"><span class="delimiter">&quot;</span><span class="content">registry/employee</span><span class="delimiter">&quot;</span></span>).toExternalForm();
    }

    <span class="annotation">@Test</span>
    <span class="annotation">@CitrusTest</span>
    <span class="directive">public</span> <span class="type">void</span> testCreateEmployeeAndGet(<span class="annotation">@CitrusResource</span> TestDesigner designer) {
        designer.send(serviceUri)
            .message(<span class="keyword">new</span> HttpMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">name=Penny&amp;age=20</span><span class="delimiter">&quot;</span></span>)
                  .method(HttpMethod.POST)
                  .contentType(MediaType.APPLICATION_FORM_URLENCODED));

        designer.receive(serviceUri)
            .message(<span class="keyword">new</span> HttpMessage()
                  .statusCode(HttpStatus.NO_CONTENT));

        designer.send(serviceUri)
            .message(<span class="keyword">new</span> HttpMessage()
                  .method(HttpMethod.GET)
                  .accept(MediaType.APPLICATION_XML));

        designer.receive(serviceUri)
            .message(<span class="keyword">new</span> HttpMessage(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span> +
                  <span class="string"><span class="delimiter">&quot;</span><span class="content">20</span><span class="delimiter">&quot;</span></span> +
                  <span class="string"><span class="delimiter">&quot;</span><span class="content">Penny</span><span class="delimiter">&quot;</span></span> +
                  <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>)
                  .statusCode(HttpStatus.OK));

        citrusFramework.run(designer.build());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>First of all we use the basic Arquillian JUnit test runner <strong>@RunWith(Arquillian.class)</strong> in combination with the <strong>@RunAsClient</strong> annotation telling Arquillian that this is a client side test case. As this is a usual Arquillian test case we have access to Arquillian resources that automatically get injected such as the base uri of the test deployment. The test deployment is a web deployment created via ShrinkWrap. We add the application specific classes that build our remote RESTful service that we would like to test.</p>
</div>
<div class="paragraph">
<p>The Citrus Arquillian extension is able to setup a proper Citrus test environment in the background. As a result the test case can reference a Citrus framework instance with the <strong>@CitrusFramework</strong> annotation. We will use this instance of Citrus later on when it comes to execute the Citrus testing logic.</p>
</div>
<div class="paragraph">
<p>No we can focus on writing a test method which is again nothing but a normal JUnit test method. The Citrus extension takes care on injecting the <strong>@CitrusResource</strong> annotated method parameter. With this Citrus test designer instance we can build a Citrus test logic for sending and receiving messages via Http in order to call the remote RESTful employee service of our test deployment. The Http endpoint uri is injected via Arquillian and we are able to call the remote service as a client.</p>
</div>
<div class="paragraph">
<p>The Citrus test designer provides Java DSL methods for building the test logic. Please note that the designer will aggregate all actions such as send or receive until the designer is called to build the test case with <strong>build()</strong> method invocation. The resulting test case object can be executed by the Citrus framework instance with <strong>run()</strong> method.</p>
</div>
<div class="paragraph">
<p>When the Citrus test case is executed the messages are sent over the wire. The respective response message is received with well known Citrus receive message logic. We can validate the response messages accordingly and make sure the client call was done right. In case something goes wrong within Citrus test execution the framework will raise exceptions accordingly. As a result the JUnit test method is successful or failed with errors coming from Citrus test execution.</p>
</div>
<div class="paragraph">
<p>This is how Citrus and Arquillian can interact in a test scenario where the test deployment is managed by Arquillian and the client side actions take place within Citrus. This is a great way to combine both frameworks with Citrus being able to call different service API endpoints in addition with validating the outcome. This was a client side test case where the test logic was executed outside of the application container. Arquillian also supports container remote test cases where we have direct access to container managed resources. The following section describes how this works with Citrus.</p>
</div>
</div>
<div class="sect2">
<h3 id="container-side-testing"><a class="anchor" href="#container-side-testing"></a><a class="link" href="#container-side-testing">27.3. Container side testing</a></h3>
<div class="paragraph">
<p>In previous sections we have seen how to combine Citrus with Arquillian in a client side test case. This is the way to go for all test cases that do not need to have access on container managed resources. Lets have a look at a sample where we want to gain access to a JMS queue and connection managed by the application container.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(Arquillian.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">EchoServiceTest</span> {

      <span class="annotation">@CitrusFramework</span>
      <span class="directive">private</span> Citrus citrusFramework;

      <span class="annotation">@Resource</span>(mappedName = <span class="string"><span class="delimiter">&quot;</span><span class="content">jms/queue/test</span><span class="delimiter">&quot;</span></span>)
      <span class="directive">private</span> <span class="predefined-type">Queue</span> echoQueue;

      <span class="annotation">@Resource</span>(mappedName = <span class="string"><span class="delimiter">&quot;</span><span class="content">/ConnectionFactory</span><span class="delimiter">&quot;</span></span>)
      <span class="directive">private</span> ConnectionFactory connectionFactory;

      <span class="directive">private</span> JmsSyncEndpoint jmsSyncEndpoint;

      <span class="annotation">@Deployment</span>
      <span class="annotation">@OverProtocol</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Servlet 3.0</span><span class="delimiter">&quot;</span></span>)
      <span class="directive">public</span> <span class="directive">static</span> WebArchive createDeployment() <span class="directive">throws</span> <span class="exception">MalformedURLException</span> {
          <span class="keyword">return</span> ShrinkWrap.create(WebArchive.class)
                  .addClasses(EchoService.class);
      }

      <span class="annotation">@Before</span>
      <span class="directive">public</span> <span class="type">void</span> setUp() {
          JmsSyncEndpointConfiguration endpointConfiguration = <span class="keyword">new</span> JmsSyncEndpointConfiguration();
          endpointConfiguration.setConnectionFactory(<span class="keyword">new</span> SingleConnectionFactory(connectionFactory));
          endpointConfiguration.setDestination(echoQueue);
          jmsSyncEndpoint = <span class="keyword">new</span> JmsSyncEndpoint(endpointConfiguration);
      }

      <span class="annotation">@After</span>
      <span class="directive">public</span> <span class="type">void</span> cleanUp() {
          closeConnections();
      }

      <span class="annotation">@Test</span>
      <span class="annotation">@CitrusTest</span>
      <span class="directive">public</span> <span class="type">void</span> shouldBeAbleToSendMessage(<span class="annotation">@CitrusResource</span> TestDesigner designer) <span class="directive">throws</span> <span class="exception">Exception</span> {
          <span class="predefined-type">String</span> messageBody = <span class="string"><span class="delimiter">&quot;</span><span class="content">ping</span><span class="delimiter">&quot;</span></span>;

          designer.send(jmsSyncEndpoint)
                .messageType(MessageType.PLAINTEXT)
                .message(<span class="keyword">new</span> JmsMessage(messageBody));

          designer.receive(jmsSyncEndpoint)
                .messageType(MessageType.PLAINTEXT)
                .message(<span class="keyword">new</span> JmsMessage(messageBody));

          citrusFramework.run(designer.build());
      }

      <span class="directive">private</span> <span class="type">void</span> closeConnections() {
          ((SingleConnectionFactory)jmsSyncEndpoint.getEndpointConfiguration().getConnectionFactory()).destroy();
      }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the test case accesses two container managed resources via JNDI. This is a JMS queue and a JMS connection that get automatically injected as resources. In a before test annotated method we can use these resources to build up a proper Citrus JMS endpoint. Inside the test method we can use the JMS endpoint for sending and receiving JMS messages via Citrus. As usual response messages received are validated and compared to an expected message. As usual we use the Citrus <strong>TestDesigner</strong> method parameter that is injected by the framework. The designer is able to build Citrus test logic with Java DSL methods. Once the complete test is designed we can build the test case and run the test case with the framework instance. After the test we should close the JMS connection in order to avoid exceptions when the application container is shutting down after the test.</p>
</div>
<div class="paragraph">
<p>The test is now part of the test deployment and is executed within the application container boundaries. As usual we can use the Citrus extension to automatically inject the Citrus framework instance as well as the Citrus test builder instance for building the Citrus test logic.</p>
</div>
<div class="paragraph">
<p>This is how to combine Citrus and Arquillian in order to build integration tests on Java EE services in a real application container environment. With Citrus you are able to set up more complex test scenarios with simulated services such as mail or ftp servers. We can build Citrus endpoints with container managed resources.</p>
</div>
</div>
<div class="sect2">
<h3 id="test-runners"><a class="anchor" href="#test-runners"></a><a class="link" href="#test-runners">27.4. Test runners</a></h3>
<div class="paragraph">
<p>In the previous sections we have used the Citrus <strong>TestDesigner</strong> in order to construct a Citrus test case to execute within the Arquillian boundaries. The nature of the test designer is to aggregate all Java DSL method calls in order to build a complete Citrus test case before execution is done via the Citrus framework. This approach can cause some unexpected behavior when mixing the Citrus Java DSL method calls with Arquillian test logic. Lets describe this by having a look at an example where th mixture of test designer and pure Java test logic causes unseen problems.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">@Test
@CitrusTest
public void testDesignRuntimeMixture(@CitrusResource TestDesigner designer) throws Exception {
    designer.send(serviceUri)
        .message(new HttpMessage(&quot;name=Penny<span class="error">&amp;</span>age=20&quot;)
            .method(HttpMethod.POST)
            .contentType(MediaType.APPLICATION_FORM_URLENCODED));

    designer.receive(serviceUri)
        .message(new HttpMessage())
            .statusCode(HttpStatus.NO_CONTENT));

    Employee testEmployee = employeeService.findEmployee(&quot;Penny&quot;);
    employeeService.addJob(testEmployee, &quot;waitress&quot;);

    designer.send(serviceUri)
        .message(new HttpMessage()
            .method(HttpMethod.GET)
            .accept(MediaType.APPLICATION_XML));

    designer.receive(serviceUri)
        .message(new HttpMessage(&quot;&quot; +
          &quot;&quot; +
            &quot;20&quot; +
            &quot;Penny&quot; +
            &quot;&quot; +
              &quot;waitress&quot; +
            &quot;&quot; +
            &quot;&quot; +
          &quot;&quot;))
            .statusCode(HttpStatus.OK));

    citrusFramework.run(designer.build());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see in this example we create a new Employee named <strong>Penny</strong> via the Http REST API on our service. We do this with Citrus Http send and receive message logic. Once this is done we would like to add a job description to the employee. We use a service instance of <strong>EmployeeService</strong> which is a service of our test domain that is injected to the Arquillian test as container JEE resource. First of all we find the employee object and then we add some job description using the service. Now as a result we would like to receive the employee as XML representation via a REST service call with Citrus and we expect the job description to be present.</p>
</div>
<div class="paragraph">
<p>This combination of Citrus Java DSL methods and service call logic will not work with <strong>TestDesigner</strong> . This is because the Citrus test logic is not executed immediately but aggregated to the very end where the designer is called to build the test case. The combination of Citrus design time and Java test runtime is tricky.</p>
</div>
<div class="paragraph">
<p>Fortunately we have solved this issue with providing a separate <strong>TestRunner</strong> component. The test runner provides nearly the same Java DSL methods for constructing Citrus test logic as the test designer. The difference though is that the test logic is executed immediately when calling the Java DSL methods. So following from that we can mix Citrus Java DSL code with test runtime logic as expected. See how this looks like with our example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">@Test
@CitrusTest
public void testDesignRuntimeMixture(@CitrusResource TestRunner runner) throws Exception {
    runner.send(builder -<span class="error">&gt;</span> builder.endpoint(serviceUri)
                  .message(new HttpMessage(&quot;name=Penny<span class="error">&amp;</span>age=20&quot;)
                      .method(HttpMethod.POST)
                      .contentType(MediaType.APPLICATION_FORM_URLENCODED)));

    runner.receive(builder -<span class="error">&gt;</span> builder.endpoint(serviceUri)
              .message(new HttpMessage()
                  .statusCode(HttpStatus.NO_CONTENT)));

    Employee testEmployee = employeeService.findEmployee(&quot;Penny&quot;);
    employeeService.addJob(testEmployee, &quot;waitress&quot;);

    runner.send(builder -<span class="error">&gt;</span> builder.endpoint(serviceUri)
                  .message(new HttpMessage()
                      .method(HttpMethod.GET)
                      .accept(MediaType.APPLICATION_XML)));

    runner.receive(builder -<span class="error">&gt;</span> builder.endpoint(serviceUri)
              .message(new HttpMessage(&quot;&quot; +
                &quot;&quot; +
                  &quot;20&quot; +
                  &quot;Penny&quot; +
                  &quot;&quot; +
                    &quot;waitress&quot; +
                  &quot;&quot; +
                  &quot;&quot; +
                &quot;&quot;)
              .statusCode(HttpStatus.OK)));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The test logic has not changed significantly. We use the Citrus <strong>TestRunner</strong> as method injected parameter instead of the <strong>TestDesigner</strong> . And this is pretty much the trick. Now the Java DSL methods do execute the Citrus test logic immediately. This is why the syntax of the Citrus Java DSL methods have changed a little bit. We now use a anonymous interface implementation for constructing the send/receive test action logic. As a result we can use the Citrus Java DSL as normal code and we can mix the runtime Java logic as each statement is executed immediately.</p>
</div>
<div class="paragraph">
<p>With Java 8 lambda expressions our code looks even more straight forward and less verbose as we can skip the anonymous interface implementations. With Java 8 you can write the same test like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">@Test
@CitrusTest
public void testDesignRuntimeMixture(@CitrusResource TestRunner runner) throws Exception {
    runner.send(builder -<span class="error">&gt;</span> builder.endpoint(serviceUri)
                  .message(new HttpMessage(&quot;name=Penny<span class="error">&amp;</span>age=20&quot;)
                      .method(HttpMethod.POST)
                      .contentType(MediaType.APPLICATION_FORM_URLENCODED));

    runner.receive(builder -<span class="error">&gt;</span> builder.endpoint(serviceUri)
              .message(new HttpMessage()
                  .statusCode(HttpStatus.NO_CONTENT));

    Employee testEmployee = employeeService.findEmployee(&quot;Penny&quot;);
    employeeService.addJob(testEmployee, &quot;waitress&quot;);

    runner.send(builder -<span class="error">&gt;</span> builder.endpoint(serviceUri)
                  .message(new HttpMessage()
                      .method(HttpMethod.GET)
                      .accept(MediaType.APPLICATION_XML));

    runner.receive(builder -<span class="error">&gt;</span> builder.endpoint(serviceUri)
              .message(new HttpMessage(&quot;&quot; +
                &quot;&quot; +
                  &quot;20&quot; +
                  &quot;Penny&quot; +
                  &quot;&quot; +
                    &quot;waitress&quot; +
                  &quot;&quot; +
                  &quot;&quot; +
                &quot;&quot;)
                      .statusCode(HttpStatus.OK));
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="docker"><a class="anchor" href="#docker"></a><a class="link" href="#docker">28. Docker support</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Citrus provides configuration components and test actions for interaction with a Docker daemon. The Citrus docker client component will execute Docker commands for container management such as start, stop, build, inspect and so on. The Docker client by default uses the Docker remote REST API. As a user you can execute Docker commands as part of a Citrus test and validate possible command results.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Docker test components in Citrus are kept in a separate Maven module. If not already done so you have to include the module as Maven dependency to your project
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>com.consol.citrus<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>citrus-docker<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>2.7.3<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus provides a "citrus-docker" configuration namespace and schema definition for Docker related components and actions. Include this namespace into your Spring configuration in order to use the Citrus Docker configuration elements. The namespace URI and schema location are added to the Spring configuration XML file as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:citrus-docker</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/docker/config</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
       <span class="content">http://www.springframework.org/schema/beans</span>
       <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
       <span class="content">http://www.citrusframework.org/schema/docker/config</span>
       <span class="content">http://www.citrusframework.org/schema/docker/config/citrus-docker-config.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    [...]

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After that you are able to use customized Citrus XML elements in order to define the Spring beans.</p>
</div>
<div class="sect2">
<h3 id="docker-client"><a class="anchor" href="#docker-client"></a><a class="link" href="#docker-client">28.1. Docker client</a></h3>
<div class="paragraph">
<p>Citrus operates with the Docker remote REST API in order to interact with the Docker daemon. The Docker client is defined as Spring bean component in the configuration as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-docker:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dockerClient</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Docker client component above is using all default configuration values. By default Citrus is searching the system properties as well as environment variables for default Docker settings such as:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
DOCKER_HOST
</td>
<td class="hdlist2">
<p>tcp://localhost:2376</p>
</td>
</tr>
<tr>
<td class="hdlist1">
DOCKER_CERT_PATH
</td>
<td class="hdlist2">
<p>~/.docker/machine/machines/default</p>
</td>
</tr>
<tr>
<td class="hdlist1">
DOCKER_TLS_VERIFY
</td>
<td class="hdlist2">
<p>1</p>
</td>
</tr>
<tr>
<td class="hdlist1">
DOCKER_MACHINE_NAME
</td>
<td class="hdlist2">
<p>default</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In case these settings are not settable in your environment you can also use explicit settings in the Docker client component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-docker:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dockerClient</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tcp://localhost:2376</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.20</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">username</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s!cr!t</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">email</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">user@consol.de</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">registry</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https://index.docker.io/v1/</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">cert-path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/path/to/some/cert/directory</span><span class="delimiter">&quot;</span></span>
            <span class="attribute-name">config-path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/path/to/some/config/directory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now Citrus is able to access the Docker remote API for executing commands such as start, stop, build, inspect and so on.</p>
</div>
</div>
<div class="sect2">
<h3 id="docker-commands"><a class="anchor" href="#docker-commands"></a><a class="link" href="#docker-commands">28.2. Docker commands</a></h3>
<div class="paragraph">
<p>We have several Citrus test actions each representing a Docker command. These actions can be part of a test case where you can manage Docker containers inside the test. As a prerequisite we have to enable the Docker specific test actions in our XML test as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:docker</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/docker/testcase</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
        <span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content">http://www.citrusframework.org/schema/docker/testcase</span>
        <span class="content">http://www.citrusframework.org/schema/docker/testcase/citrus-docker-testcase.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    [...]

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We added a special docker namespace with prefix <strong>docker:</strong> so now we can start to add Docker test actions to the test case:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DockerCommandIT</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
          <span class="tag">&lt;docker:ping&gt;</span><span class="tag">&lt;/docker:ping&gt;</span>

          <span class="tag">&lt;docker:version&gt;</span>
            <span class="tag">&lt;docker:expect&gt;</span>
              <span class="tag">&lt;docker:result&gt;</span>
                <span class="inline-delimiter">&lt;![CDATA[</span>
                  {
                    &quot;Version&quot;:&quot;1.8.3&quot;,
                    &quot;ApiVersion&quot;:&quot;1.21&quot;,
                    &quot;GitCommit&quot;:&quot;@ignore@&quot;,
                    &quot;GoVersion&quot;:&quot;go1.4.2&quot;,
                    &quot;Os&quot;:&quot;darwin&quot;,
                    &quot;Arch&quot;:&quot;amd64&quot;,
                    &quot;KernelVersion&quot;:&quot;@ignore@&quot;
                  }
                <span class="inline-delimiter">]]&gt;</span>
              <span class="tag">&lt;/docker:result&gt;</span>
            <span class="tag">&lt;/docker:expect&gt;</span>
          <span class="tag">&lt;/docker:version&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this very simple example we first ping the Docker daemon to make sure we have connectivity up and running. After that we get the Docker version information. The second action shows an important concept when executing Docker commands in Citrus. As a tester we might be interested in validating the command result. So wen can specify an optional <strong>docker:result</strong> which is usually in JSON data format. As usual we can use test variables here and ignore some values explicitly such as the <strong>GitCommit</strong> value.</p>
</div>
<div class="paragraph">
<p>Based on that we can execute several Docker commands in a test case:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DockerCommandIT</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;variables&gt;</span>
      <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">imageId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">busybox</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/variable&gt;</span>
      <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">containerName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_box</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/variable&gt;</span>
    <span class="tag">&lt;/variables&gt;</span>

    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;docker:pull</span> <span class="attribute-name">image</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${imageId}</span><span class="delimiter">&quot;</span></span>
                        <span class="attribute-name">tag</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">latest</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

        <span class="tag">&lt;docker:create</span> <span class="attribute-name">image</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${imageId}</span><span class="delimiter">&quot;</span></span>
                          <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${containerName}</span><span class="delimiter">&quot;</span></span>
                          <span class="attribute-name">cmd</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">top</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;docker:expect&gt;</span>
                <span class="tag">&lt;docker:result&gt;</span>
                    <span class="inline-delimiter">&lt;![CDATA[</span>
                      {&quot;Id&quot;:&quot;@variable(containerId)@&quot;,&quot;Warnings&quot;:null}
                    <span class="inline-delimiter">]]&gt;</span>
                <span class="tag">&lt;/docker:result&gt;</span>
            <span class="tag">&lt;/docker:expect&gt;</span>
        <span class="tag">&lt;/docker:create&gt;</span>

        <span class="tag">&lt;docker:start</span> <span class="attribute-name">container</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${containerName}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example we pull a Docker image, build a new container out of this image and start the container. As you can see each Docker command action offers attributes such as <strong>container</strong>, <strong>image</strong> or <strong>tag</strong> . These are command settings that are available on the Docker command specification. Read more about the Docker commands and the specific settings in official Docker API reference guide.</p>
</div>
<div class="paragraph">
<p>Citrus supports the following Docker commands with respective test actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>docker:pull</strong></p>
</li>
<li>
<p><strong>docker:build</strong></p>
</li>
<li>
<p><strong>docker:create</strong></p>
</li>
<li>
<p><strong>docker:start</strong></p>
</li>
<li>
<p><strong>docker:stop</strong></p>
</li>
<li>
<p><strong>docker:wait</strong></p>
</li>
<li>
<p><strong>docker:ping</strong></p>
</li>
<li>
<p><strong>docker:version</strong></p>
</li>
<li>
<p><strong>docker:inspect</strong></p>
</li>
<li>
<p><strong>docker:remove</strong></p>
</li>
<li>
<p><strong>docker:info</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Some of the Docker commands can be executed both on container and image targets such as <strong>docker:inspect</strong> or <strong>docker:remove</strong> . The command action then offers both <strong>container</strong> and <strong>image</strong> attributes so the user can choose the target of the command operation to be a container or an image.</p>
</div>
<div class="paragraph">
<p>Up to now we have only used the Citrus XML DSL. Of course all Docker commands are also available in Java DSL as the next example shows.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> dockerTest() {
    docker().version()
        .validateCommandResult(<span class="keyword">new</span> CommandResultCallback&lt;Version&gt;() {
            <span class="annotation">@Override</span>
            <span class="directive">public</span> <span class="type">void</span> doWithCommandResult(Version version, TestContext context) {
                Assert.assertEquals(version.getApiVersion(), <span class="string"><span class="delimiter">&quot;</span><span class="content">1.20</span><span class="delimiter">&quot;</span></span>);
            }
    });

    docker().ping();

    docker().start(<span class="string"><span class="delimiter">&quot;</span><span class="content">my_container</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Java DSL Docker commands provide an optional <strong>CommandResultCallback</strong> that is called with the unmarshalled command result object. In the example above the <em>Version</em> model object is passed as argument to the callback. So the tester can access the command result and validate its properties with assertions.</p>
</div>
<div class="paragraph">
<p>By default Citrus tries to find a Docker client component within the Citrus Spring application context. If not present Citrus will instantiate a default docker client with all default settings. You can also explicitly set the docker client instance when using the Java DSL Docker command actions:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="directive">private</span> DockerClient dockerClient;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> dockerTest() {
    docker().client(dockerClient).version()
        .validateCommandResult(<span class="keyword">new</span> CommandResultCallback&lt;Version&gt;() {
            <span class="annotation">@Override</span>
            <span class="directive">public</span> <span class="type">void</span> doWithCommandResult(Version version, TestContext context) {
                Assert.assertEquals(version.getApiVersion(), <span class="string"><span class="delimiter">&quot;</span><span class="content">1.20</span><span class="delimiter">&quot;</span></span>);
            }
    });

    docker().client(dockerClient).ping();

    docker().client(dockerClient).start(<span class="string"><span class="delimiter">&quot;</span><span class="content">my_container</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="kubernetes"><a class="anchor" href="#kubernetes"></a><a class="link" href="#kubernetes">29. Kubernetes support</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://kubernetes.io/">Kubernetes</a> is one of the hottest management platforms for containerized applications these days. Kubernetes lets you deploy, scale and manage your containers on the platform so you get features like auto-scaling, self-healing, service discovery and load balancing.
Citrus provides interaction with the Kubernetes REST API so you can access the Kubernetes platform and its resources within a Citrus test case.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Kubernetes test components in Citrus are kept in a separate Maven module. If not already done so you have to include the module as Maven dependency to your project
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>com.consol.citrus<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>citrus-kubernetes<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>2.7.3<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus provides a "citrus-kubernetes" configuration namespace and schema definition for Kubernetes related components and actions. Include this namespace into your Spring configuration in order to use the Citrus Kubernetes configuration elements. The namespace URI and schema location are added to the Spring configuration XML file as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:citrus-k8s</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/kubernetes/config</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
       <span class="content">http://www.springframework.org/schema/beans</span>
       <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
       <span class="content">http://www.citrusframework.org/schema/kubernetes/config</span>
       <span class="content">http://www.citrusframework.org/schema/kubernetes/config/citrus-kubernetes-config.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    [...]

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After that you are able to use customized Citrus XML elements in order to define the Spring beans.</p>
</div>
<div class="sect2">
<h3 id="kubernetes-client"><a class="anchor" href="#kubernetes-client"></a><a class="link" href="#kubernetes-client">29.1. Kubernetes client</a></h3>
<div class="paragraph">
<p>Citrus operates with the Kubernetes remote REST API in order to interact with the Kubernetes platform. The Kubernetes client is defined as Spring bean component in the configuration as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-k8s:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myK8sClient</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Kubernetes client is based on the <a href="https://github.com/fabric8io/kubernetes-client">Fabric8 Java Kubernetes client</a> implementation. Following from that the component can be configured in various ways.
By default the client reads the system properties as well as environment variables for default Kubernetes settings such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>kubernetes.master</strong> / <strong>KUBERNETES_MASTER</strong></p>
</li>
<li>
<p><strong>kubernetes.api.version</strong> / <strong>KUBERNETES_API_VERSION</strong></p>
</li>
<li>
<p><strong>kubernetes.trust.certificates</strong> / <strong>KUBERNETES_TRUST_CERTIFICATES</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you set these properties in your environment the client component will automatically pick up the configuration settings. Also when using <code>kubectl</code> command line locally the client may automatically
use the stored user authentication settings from there. For a complete list of settings and explanation of those please refer to the <a href="https://github.com/fabric8io/kubernetes-client">Fabric8 client documentation</a>.</p>
</div>
<div class="paragraph">
<p>In case you need to set the client configuration explicitly on your environment you can also use explicit settings on the Kubernetes client component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-k8s:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myK8sClient</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8843</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">v1</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">username</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s!cr!t</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">namespace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">user_namespace</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">message-converter</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageConverter</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">object-mapper</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">objectMapper</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now Citrus is able to access the Kubernetes remote API for executing commands such as list-pods, watch-services and so on. Citrus provides a set of actions that
perform a Kubernetes command via REST. The results usually get validated in the Citrus test as usual.</p>
</div>
<div class="paragraph">
<p>Based on that we can execute several Kubernetes commands in a test case and validate the Json results:</p>
</div>
<div class="paragraph">
<p>Citrus supports the following Kubernetes API commands with respective test actions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>k8s:info</strong></p>
</li>
<li>
<p><strong>k8s:list-pods</strong></p>
</li>
<li>
<p><strong>k8s:get-pod</strong></p>
</li>
<li>
<p><strong>k8s:delete-pod</strong></p>
</li>
<li>
<p><strong>k8s:list-services</strong></p>
</li>
<li>
<p><strong>k8s:get-service</strong></p>
</li>
<li>
<p><strong>k8s:delete-service</strong></p>
</li>
<li>
<p><strong>k8s:list-namespaces</strong></p>
</li>
<li>
<p><strong>k8s:list-events</strong></p>
</li>
<li>
<p><strong>k8s:list-endpoints</strong></p>
</li>
<li>
<p><strong>k8s:list-nodes</strong></p>
</li>
<li>
<p><strong>k8s:list-replication-controllers</strong></p>
</li>
<li>
<p><strong>k8s:watch-pods</strong></p>
</li>
<li>
<p><strong>k8s:watch-services</strong></p>
</li>
<li>
<p><strong>k8s:watch-namespaces</strong></p>
</li>
<li>
<p><strong>k8s:watch-nodes</strong></p>
</li>
<li>
<p><strong>k8s:watch-replication-controllers</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We will discuss these commands in detail later on in this chapter. For now lets have a closer look on how to use the commands inside of a Citrus test.</p>
</div>
</div>
<div class="sect2">
<h3 id="kubernetes-commands-in-xml"><a class="anchor" href="#kubernetes-commands-in-xml"></a><a class="link" href="#kubernetes-commands-in-xml">29.2. Kubernetes commands in XML</a></h3>
<div class="paragraph">
<p>We have several Citrus test actions each representing a Kubernetes command. These actions can be part of a test case where you can manage Kubernetes pods inside the test. As a prerequisite we have to enable the Kubernetes
specific test actions in our XML test as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:k8s</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/kubernetes/testcase</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
        <span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content">http://www.citrusframework.org/schema/kubernetes/testcase</span>
        <span class="content">http://www.citrusframework.org/schema/kubernetes/testcase/citrus-kubernetes-testcase.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    [...]

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We added a special kubernetes namespace with prefix <strong>k8s:</strong> so now we can start to add Kubernetes test actions to the test case:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">KubernetesCommandIT</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
      <span class="tag">&lt;k8s:info</span> <span class="attribute-name">client</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myK8sClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;k8s:validate&gt;</span>
          <span class="tag">&lt;k8s:result&gt;</span>{
            &quot;result&quot;: {
              &quot;clientVersion&quot;: &quot;1.4.27&quot;,
              &quot;apiVersion&quot;: &quot;v1&quot;,
              &quot;kind&quot;:&quot;Info&quot;,
              &quot;masterUrl&quot;: &quot;${masterUrl}&quot;,
              &quot;namespace&quot;: &quot;test&quot;
            }
          }<span class="tag">&lt;/k8s:result&gt;</span>
        <span class="tag">&lt;/k8s:validate&gt;</span>
      <span class="tag">&lt;/k8s:info&gt;</span>

      <span class="tag">&lt;k8s:list-pods&gt;</span>
        <span class="tag">&lt;k8s:validate&gt;</span>
          <span class="tag">&lt;k8s:result&gt;</span>{
            &quot;result&quot;: {
              &quot;apiVersion&quot;:&quot;v1&quot;,
              &quot;kind&quot;:&quot;PodList&quot;,
              &quot;metadata&quot;:&quot;@ignore@&quot;,
              &quot;items&quot;:[]
            }
          }<span class="tag">&lt;/k8s:result&gt;</span>
          <span class="tag">&lt;k8s:element</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$.result.items.size()</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/k8s:validate&gt;</span>
      <span class="tag">&lt;/k8s:list-pods&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this very simple example we first ping the Kubernetes REST API to make sure we have connectivity up and running. The info command connects the REST API and returns a list of status information of the Kubernetes client.
After that we get the list of available Kubernetes pods. As a tester we might be interested in validating the command results. So wen can specify an optional <strong>k8s:result</strong> which is usually in Json format. With that we can apply the full
Citrus Json validation power to the Kubernetes results. As usual we can use test variables here and ignore some values explicitly such as the <strong>metadata</strong> value. Also JsonPath expression validation and Json test message validation features in
Citrus come in here to validate the results.</p>
</div>
</div>
<div class="sect2">
<h3 id="kubernetes-commands-in-java"><a class="anchor" href="#kubernetes-commands-in-java"></a><a class="link" href="#kubernetes-commands-in-java">29.3. Kubernetes commands in Java</a></h3>
<div class="paragraph">
<p>Up to now we have only used the Citrus XML DSL. Of course all Kubernetes commands are also available in Java DSL as the next example shows.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> kubernetesTest() {
    kubernetes().info()
                .validate(<span class="keyword">new</span> CommandResultCallback&lt;InfoResult&gt;() {
                    <span class="annotation">@Override</span>
                    <span class="directive">public</span> <span class="type">void</span> doWithCommandResult(InfoResult info, TestContext context) {
                        Assert.assertEquals(info.getApiVersion(), <span class="string"><span class="delimiter">&quot;</span><span class="content">v1</span><span class="delimiter">&quot;</span></span>);
                    }
            });

    kubernetes().pods()
                .list()
                .withoutLabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">running</span><span class="delimiter">&quot;</span></span>)
                .label(<span class="string"><span class="delimiter">&quot;</span><span class="content">app</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">myApp</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Java DSL Kubernetes commands provide an optional <strong>CommandResultCallback</strong> that is automatically called with the unmarshalled command result object.
In the example above the <em>InfoResult</em> model object is passed as argument to the callback. So the tester can access the command result and validate its properties with assertions.</p>
</div>
<div class="paragraph">
<p>Java 8 Lambda expressions add some syntactical sugar to the command result validation:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> kubernetesTest() {
    kubernetes().info()
                .validate((info, context) -&gt; Assert.assertEquals(info.getApiVersion(), <span class="string"><span class="delimiter">&quot;</span><span class="content">v1</span><span class="delimiter">&quot;</span></span>));

    kubernetes().pods()
                .list()
                .withoutLabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">running</span><span class="delimiter">&quot;</span></span>)
                .label(<span class="string"><span class="delimiter">&quot;</span><span class="content">app</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">myApp</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default Citrus tries to find a Kubernetes client component within the Citrus Spring application context. If not present Citrus will instantiate a default kubernetes client with all default settings.
You can also explicitly set the kubernetes client instance when using the Java DSL Kubernetes command actions:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="directive">private</span> KubernetesClient kubernetesClient;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> kubernetesTest() {
    kubernetes().client(kubernetesClient)
                .info()
                .validate((info, context) -&gt; Assert.assertEquals(info.getApiVersion(), <span class="string"><span class="delimiter">&quot;</span><span class="content">v1</span><span class="delimiter">&quot;</span></span>));

    kubernetes().client(kubernetesClient)
                .pods()
                .list()
                .withoutLabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">running</span><span class="delimiter">&quot;</span></span>)
                .label(<span class="string"><span class="delimiter">&quot;</span><span class="content">app</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">myApp</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="info-command"><a class="anchor" href="#info-command"></a><a class="link" href="#info-command">29.4. Info command</a></h3>
<div class="paragraph">
<p>The info command just gets the client connection settings and provides them as a Json result to the action.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;k8s:info</span> <span class="attribute-name">client</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myK8sClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;k8s:validate&gt;</span>
    <span class="tag">&lt;k8s:result&gt;</span>{
      &quot;result&quot;: {
        &quot;clientVersion&quot;: &quot;1.4.27&quot;,
        &quot;apiVersion&quot;: &quot;v1&quot;,
        &quot;kind&quot;:&quot;Info&quot;,
        &quot;masterUrl&quot;: &quot;${masterUrl}&quot;,
        &quot;namespace&quot;: &quot;test&quot;
      }
    }<span class="tag">&lt;/k8s:result&gt;</span>
  <span class="tag">&lt;/k8s:validate&gt;</span>
<span class="tag">&lt;/k8s:info&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> infoTest() {
    kubernetes().info()
                .validate((info, context) -&gt; Assert.assertEquals(info.getApiVersion(), <span class="string"><span class="delimiter">&quot;</span><span class="content">v1</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="list-resources"><a class="anchor" href="#list-resources"></a><a class="link" href="#list-resources">29.5. List resources</a></h3>
<div class="paragraph">
<p>We can list Kubernetes resources such as pods, services, endpoints and replication controllers. The list can be filtered by several properties such as</p>
</div>
<div class="ulist">
<ul>
<li>
<p>label</p>
</li>
<li>
<p>namespace</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The test action is able to define respective filters to the list so we get only pods the match the given attributes:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;k8s:list-pods</span> <span class="attribute-name">label</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">app=todo</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;k8s:validate&gt;</span>
      <span class="tag">&lt;k8s:result&gt;</span>{
        &quot;result&quot;: {
          &quot;apiVersion&quot;:&quot;${apiVersion}&quot;,
          &quot;kind&quot;:&quot;PodList&quot;,
          &quot;metadata&quot;:&quot;@ignore@&quot;,
          &quot;items&quot;:&quot;@ignore@&quot;
        }
      }<span class="tag">&lt;/k8s:result&gt;</span>
      <span class="tag">&lt;k8s:element</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$.result.items.size()</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;k8s:element</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$..status.phase</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Running</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/k8s:validate&gt;</span>
<span class="tag">&lt;/k8s:list-pods&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> listPodsTest() {
    kubernetes()
        .client(k8sClient)
        .pods()
        .list()
        .label(<span class="string"><span class="delimiter">&quot;</span><span class="content">app=todo</span><span class="delimiter">&quot;</span></span>)
        .validate(<span class="string"><span class="delimiter">&quot;</span><span class="content">$..status.phase</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Running</span><span class="delimiter">&quot;</span></span>)
        .validate((pods, context) -&gt; {
            Assert.assertFalse(CollectionUtils.isEmpty(pods.getResult().getItems()));
        });
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see we are able to give the pod label that is searched for in list of all pods. The list returned is validated either by giving an expected Json message
or by adding JsonPath expressions with expected values to check.</p>
</div>
<div class="paragraph">
<p>In Java DSL we can add a validation result callback that is provided with the unmarshalled result object for validation. Besides <em>label</em> filtering we can also specify the <em>namespace</em>
and the pod <em>name</em> to search for.</p>
</div>
<div class="paragraph">
<p>You can also define multiple labels as comma delimited list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;k8s:list-services</span> <span class="attribute-name">label</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">stage!=test,provider=fabric8</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">namespace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see we have combined to label filters <em>stage!=test</em> and <em>provider=fabric8</em> on pods in namespace <em>default</em>. The first label filter is negated so the label <em>stage</em> should <strong>not</strong> be <em>test</em> here.</p>
</div>
</div>
<div class="sect2">
<h3 id="list-nodes-and-namespaces"><a class="anchor" href="#list-nodes-and-namespaces"></a><a class="link" href="#list-nodes-and-namespaces">29.6. List nodes and namespaces</a></h3>
<div class="paragraph">
<p>Nodes and namespaces are special resources that are not filtered by their namespace as they are more global resources. The rest is pretty similar to listing pods or services. We can
add filteres such as <em>name</em> and <em>label</em>.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;k8s:list-namespaces</span> <span class="attribute-name">label</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">provider=citrus</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;k8s:validate&gt;</span>
      <span class="tag">&lt;k8s:element</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$.result.items.size()</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/k8s:validate&gt;</span>
<span class="tag">&lt;/k8s:list-namespaces&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> listPodsTest() {
    kubernetes()
        .client(k8sClient)
        .namespaces()
        .list()
        .label(<span class="string"><span class="delimiter">&quot;</span><span class="content">provider=citrus</span><span class="delimiter">&quot;</span></span>)
        .validate((pods, context) -&gt; {
            Assert.assertFalse(CollectionUtils.isEmpty(pods.getResult().getItems()));
        });
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="get-resources"><a class="anchor" href="#get-resources"></a><a class="link" href="#get-resources">29.7. Get resources</a></h3>
<div class="paragraph">
<p>We can get a very special Kubernetes resource such as a pod or service for detailed validation of that resource. We need to specify a resource name
in order to select the resource from list of available resources in Kubernetes.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;k8s:get-pod</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_pod</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;k8s:validate&gt;</span>
      <span class="tag">&lt;k8s:result&gt;</span>{
      &quot;result&quot;: {
        &quot;apiVersion&quot;:&quot;${apiVersion}&quot;,
        &quot;kind&quot;:&quot;Pod&quot;,
        &quot;metadata&quot;: {
            &quot;annotations&quot;:&quot;@ignore@&quot;,
            &quot;creationTimestamp&quot;:&quot;@ignore@&quot;,
            &quot;finalizers&quot;:[],
            &quot;generateName&quot;:&quot;@startsWith('hello-minikube-')@&quot;,
            &quot;labels&quot;:{
              &quot;pod-template-hash&quot;:&quot;@ignore@&quot;,
              &quot;run&quot;:&quot;hello-minikube&quot;
            },
            &quot;name&quot;:&quot;${podName}&quot;,
            &quot;namespace&quot;:&quot;default&quot;,
            &quot;ownerReferences&quot;:&quot;@ignore@&quot;,
            &quot;resourceVersion&quot;:&quot;@ignore@&quot;,
            &quot;selfLink&quot;:&quot;/api/${apiVersion}/namespaces/default/pods/${podName}&quot;,
            &quot;uid&quot;:&quot;@ignore@&quot;
        },
        &quot;spec&quot;: {
          &quot;containers&quot;: [{
            &quot;args&quot;:[],
            &quot;command&quot;:[],
            &quot;env&quot;:[],
            &quot;image&quot;:&quot;gcr.io/google_containers/echoserver:1.4&quot;,
            &quot;imagePullPolicy&quot;:&quot;IfNotPresent&quot;,
            &quot;name&quot;:&quot;hello-minikube&quot;,
            &quot;ports&quot;:[{
              &quot;containerPort&quot;:8080,
              &quot;protocol&quot;:&quot;TCP&quot;
            }],
            &quot;resources&quot;:{},
            &quot;terminationMessagePath&quot;:&quot;/dev/termination-log&quot;,
            &quot;volumeMounts&quot;:&quot;@ignore@&quot;
          }],
          &quot;dnsPolicy&quot;:&quot;ClusterFirst&quot;,
          &quot;imagePullSecrets&quot;:&quot;@ignore@&quot;,
          &quot;nodeName&quot;:&quot;minikube&quot;,
          &quot;restartPolicy&quot;:&quot;Always&quot;,
          &quot;securityContext&quot;:&quot;@ignore@&quot;,
          &quot;serviceAccount&quot;:&quot;default&quot;,
          &quot;serviceAccountName&quot;:&quot;default&quot;,
          &quot;terminationGracePeriodSeconds&quot;:30,
          &quot;volumes&quot;:&quot;@ignore@&quot;
        },
        &quot;status&quot;: &quot;@ignore@&quot;
      }
      }<span class="tag">&lt;/k8s:result&gt;</span>
      <span class="tag">&lt;k8s:element</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$..status.phase</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Running</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/k8s:validate&gt;</span>
<span class="tag">&lt;/k8s:get-pod&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> getPodsTest() {
    kubernetes()
        .client(k8sClient)
        .pods()
        .get(<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_pod</span><span class="delimiter">&quot;</span></span>)
        .validate(<span class="string"><span class="delimiter">&quot;</span><span class="content">$..status.phase</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Running</span><span class="delimiter">&quot;</span></span>)
        .validate((pod, context) -&gt; {
            Assert.assertEquals(pods.getResult().getStatus().getPhase(), <span class="string"><span class="delimiter">&quot;</span><span class="content">Running</span><span class="delimiter">&quot;</span></span>);
        });
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see we are able get the complete pod information from Kubernetes. The result is validated with Json message validator in Citrus. This means we can use <em>@ignore@</em> as well as test variables and
JsonPath expressions.</p>
</div>
</div>
<div class="sect2">
<h3 id="create-resources"><a class="anchor" href="#create-resources"></a><a class="link" href="#create-resources">29.8. Create resources</a></h3>
<div class="paragraph">
<p>We can create new Kubernetes resources within a Citrus test. This is very important in case we need to setup new pods or services for the test run. You can create new resources
by giving a <code>.yml</code> file holding all information how to create the new resource. See the following sample YAML for a new pod and service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>kind: Pod
apiVersion: v1
metadata:
  name: hello-jetty-${randomId}
  namespace: default
  selfLink: /api/v1/namespaces/default/pods/hello-jetty-${randomId}
  uid: citrus:randomUUID()
  labels:
    server: hello-jetty
spec:
  containers:
    - name: hello-jetty
      image: jetty:9.3
      imagePullPolicy: IfNotPresent
      ports:
        - containerPort: 8080
          protocol: TCP
  restartPolicy: Always
  terminationGracePeriodSeconds: 30
  dnsPolicy: ClusterFirst
  serviceAccountName: default
  serviceAccount: default
  nodeName: minikube</code></pre>
</div>
</div>
<div class="paragraph">
<p>This YAML file specifies a new resource of kind <em>Pod</em>. We define the metadata as well as all containers that are part of this pod. The container is build from
<em>jetty:9.3</em> Docker image that should be pulled automatically from Docker Hub registry. We also expose port 8080 as <em>containerPort</em> so the upcoming service configuration can provide this
port to clients as Kubernetes service.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>kind: Service
apiVersion: v1
metadata:
  name: hello-jetty
  namespace: default
  selfLink: /api/v1/namespaces/default/services/hello-jetty
  uid: citrus:randomUUID()
  labels:
    service: hello-jetty
spec:
  ports:
    - protocol: TCP
      port: 8080
      targetPort: 8080
      nodePort: 31citrus:randomNumber(3)
  selector:
    server: hello-jetty
  type: NodePort
  sessionAffinity: None</code></pre>
</div>
</div>
<div class="paragraph">
<p>The service resource maps the port <em>8080</em> and selects all pods with label <em>server=hello-jetty</em>. This makes the jetty container available to clients. The service type is <em>NodePort</em> which means
that clients outside of Kubernetes are also able to access the service by using the dynamic port <em>nodePort=31xxx</em>. We can use Citrus functions such as <em>randomNumber</em> in the YAML files.</p>
</div>
<div class="paragraph">
<p>In the test case we can use these YAML files to create the resources in Kubernetes:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;k8s:create-pod</span> <span class="attribute-name">namespace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;k8s:template</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:templates/hello-jetty-pod.yml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/k8s:create-pod&gt;</span>

<span class="tag">&lt;k8s:create-service</span> <span class="attribute-name">namespace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;k8s:template</span> <span class="attribute-name">file</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:templates/hello-jetty-service.yml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/k8s:create-service&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> createPodsTest() {
    kubernetes()
        .pods()
        .create(<span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">templates/hello-jetty-pod.yml</span><span class="delimiter">&quot;</span></span>))
        .namespace(<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>);

    kubernetes()
        .services()
        .create(<span class="keyword">new</span> ClassPathResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">templates/hello-jetty-service.yml</span><span class="delimiter">&quot;</span></span>))
        .namespace(<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Creating new resources may take some time to finish. Kubernetes will have to pull images, build containers and start up everything. The create action is not waiting synchronously for all that to have happened.
Therefore we might add a list-pods action that waits for the new resources to appear.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;repeat-onerror-until-true</span> <span class="attribute-name">condition</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">@assertThat('greaterThan(9)')@</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">auto-sleep</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1000</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;k8s:list-pods</span> <span class="attribute-name">label</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">server=hello-jetty</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;k8s:validate&gt;</span>
      <span class="tag">&lt;k8s:element</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$.result.items.size()</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;k8s:element</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$..status.phase</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Running</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/k8s:validate&gt;</span>
  <span class="tag">&lt;/k8s:list-pods&gt;</span>
<span class="tag">&lt;/repeat-onerror-until-true&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With this repeat on error action we wait for the new <em>server=hello-jetty</em> labeled pod to be in state <em>Running</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="delete-resources"><a class="anchor" href="#delete-resources"></a><a class="link" href="#delete-resources">29.9. Delete resources</a></h3>
<div class="paragraph">
<p>With that command we are able to delete a resource in Kubernetes. Up to now deletion of pods and services is supported. We have to give a name of the resource that we want
to delete.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;k8s:delete-pod</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_pod</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;k8s:validate&gt;</span>
      <span class="tag">&lt;k8s:element</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$.result.success</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/k8s:validate&gt;</span>
<span class="tag">&lt;/k8s:delete-pod&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> deletePodsTest() {
    kubernetes()
        .pods()
        .delete(<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_pod</span><span class="delimiter">&quot;</span></span>)
        .validate((result, context) -&gt; Assert.assertTrue(result.getResult().getSuccess()));
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="watch-resources"><a class="anchor" href="#watch-resources"></a><a class="link" href="#watch-resources">29.10. Watch resources</a></h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The watch operation is still in experimental state and may face severe adjustments and improvements in near future.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When using a watch command we add a subscription to change events on a Kubernetes resources. So we can watch resources such as pods, services for future changes.
Each change on that resource triggers a new watch event result that we can expect and validate.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;k8s:watch-pods</span> <span class="attribute-name">label</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">provider=citrus</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;k8s:validate&gt;</span>
      <span class="tag">&lt;k8s:element</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$.action</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DELETED</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/k8s:validate&gt;</span>
<span class="tag">&lt;/k8s:watch-pods&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> listPodsTest() {
    kubernetes()
        .pods()
        .watch()
        .label(<span class="string"><span class="delimiter">&quot;</span><span class="content">provider=citrus</span><span class="delimiter">&quot;</span></span>)
        .validate((watchEvent, context) -&gt; {
            Assert.assertFalse(watchEvent.hasError());
            Assert.assertEquals(((WatchEventResult) watchEvent).getAction(), Watcher.Action.DELETED);
        });
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The watch command may be triggered several times for multiple changes on the respective Kubernetes resource. The watch action will always handle one single event result. The first
event trigger is forwarded to the action validation. All further watch events on that same resource are ignored. This means that you may need multiple watch actions in your test case in case you expect
multiple watch events to be triggered.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="kubernetes-messaging"><a class="anchor" href="#kubernetes-messaging"></a><a class="link" href="#kubernetes-messaging">29.11. Kubernetes messaging</a></h3>
<div class="paragraph">
<p>We have seen how to access the Kubernetes remote REST API by using special Citrus test actions in out test. As an alternative to that we can also use more
generic send/receive actions in Citrus for accessing the Kubernetes API. We demonstrate this with a simple example:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">KubernetesSendReceiveIT</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
      <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">k8sClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;message&gt;</span>
          <span class="tag">&lt;data&gt;</span>
            { &quot;command&quot;: &quot;info&quot; }
          <span class="tag">&lt;/data&gt;</span>
        <span class="tag">&lt;/message&gt;</span>
      <span class="tag">&lt;/send&gt;</span>

      <span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">k8sClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">json</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;data&gt;</span>{
            &quot;command&quot;: &quot;info&quot;,
            &quot;result&quot;: {
                &quot;clientVersion&quot;: &quot;1.4.27&quot;,
                &quot;apiVersion&quot;: &quot;v1&quot;,
                &quot;kind&quot;:&quot;Info&quot;,
                &quot;masterUrl&quot;: &quot;${masterUrl}&quot;,
                &quot;namespace&quot;: &quot;test&quot;
              }
            }<span class="tag">&lt;/data&gt;</span>
        <span class="tag">&lt;/message&gt;</span>
      <span class="tag">&lt;/receive&gt;</span>

      <span class="tag">&lt;echo&gt;</span>
        <span class="tag">&lt;message&gt;</span>List all pods<span class="tag">&lt;/message&gt;</span>
      <span class="tag">&lt;/echo&gt;</span>

      <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">k8sClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;message&gt;</span>
          <span class="tag">&lt;data&gt;</span>
            { &quot;command&quot;: &quot;list-pods&quot; }
          <span class="tag">&lt;/data&gt;</span>
        <span class="tag">&lt;/message&gt;</span>
      <span class="tag">&lt;/send&gt;</span>

      <span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">k8sClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">json</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;data&gt;</span>{
            &quot;command&quot;: &quot;list-pods&quot;,
            &quot;result&quot;: {
                  &quot;apiVersion&quot;:&quot;v1&quot;,
                  &quot;kind&quot;:&quot;PodList&quot;,
                  &quot;metadata&quot;:&quot;@ignore@&quot;,
                  &quot;items&quot;:[]
              }
          }<span class="tag">&lt;/data&gt;</span>
          <span class="tag">&lt;validate</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$.result.items.size()</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/message&gt;</span>
      <span class="tag">&lt;/receive&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see we can use the send/receive actions to call Kubernetes API commands and receive the respective results in Json format, too. This gives us the well known
Json validation mechanism in Citrus in order to validate the results from Kubernetes. This way you can load Kubernetes resources verifying its state and properties.
Of course JsonPath expressions also come in here in order to validate Json elements explicitly.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ssh"><a class="anchor" href="#ssh"></a><a class="link" href="#ssh">30. SSH support</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the spirit of other Citrus mock services, there is support for simulating an external SSH server as well as for connecting to SSH servers as a client during the test execution. Citrus translates SSH requests and responses to simple XML documents for better validation with the common Citrus mechanisms.</p>
</div>
<div class="paragraph">
<p>This means that the Citrus test case does not deal with pure SSH protocol commands. Instead of this we use the powerful XML validation capabilities in Citrus when dealing with the simple XML documents that represent the SSH request/response data.</p>
</div>
<div class="paragraph">
<p>Let us clarify this with a little example. Once the real SSH server daemon is fired up within Citrus we accept a SSH EXEC request for instance. The request is translated into a XML message of the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ssh-request</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/ssh/message</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;command&gt;</span>cat - | sed -e 's/Hello/Hello SSH/'<span class="tag">&lt;/command&gt;</span>
  <span class="tag">&lt;stdin&gt;</span>Hello World<span class="tag">&lt;/stdin&gt;</span>
<span class="tag">&lt;/ssh-request&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This message can be validated with the usual Citrus mechanism in a receive test action. If you do not know how to do this, please read one of the sections about XML message validation in this reference guide first. Now after having received this request message the respective SSH response should be provided as appropriate answer. This is done with a message sending action on a reply handler as it is known from synchronous http message communication in Citrus for instance. The SSH XML representation of a response message looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ssh-response</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/ssh/message</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;stdout&gt;</span>Hello SSH World<span class="tag">&lt;/stdout&gt;</span>
  <span class="tag">&lt;stderr&gt;</span><span class="tag">&lt;/stderr&gt;</span>
  <span class="tag">&lt;exit&gt;</span>0<span class="tag">&lt;/exit&gt;</span>
<span class="tag">&lt;/ssh-response&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Besides simulating a full featured SSH server, Citrus also provides SSH client functionality. This client uses the same request message pattern, which is translated into a real SSH call to an SSH server. The SSH response received is also translated into a XML message as shown above so we can validate it with known validation mechanisms in Citrus.</p>
</div>
<div class="paragraph">
<p>Similar to the other Citrus modules (http, soap), a Citrus SSH server and client is configured in Citrus Spring application context. There is a dedicated <strong>ssh</strong> namespace available for all ssh Citrus components. The namespace declaration goes into the context top-level element as usual:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span>
    <span class="error">[</span><span class="attribute-name">...</span><span class="error">]</span>
    <span class="attribute-name">xmlns:citrus-ssh</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/ssh/config</span><span class="delimiter">&quot;</span></span>
    <span class="error">[</span><span class="attribute-name">...</span><span class="error">]</span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
        <span class="content">[...]</span>
        <span class="content">http://www.citrusframework.org/schema/ssh/config</span>
        <span class="content">http://www.citrusframework.org/schema/ssh/config/citrus-ssh-config.xsd</span>
        <span class="content">[...] </span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
   [...]
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Both, SSH server and client along with their configuration options are described in the following two sections.</p>
</div>
<div class="sect2">
<h3 id="ssh-client"><a class="anchor" href="#ssh-client"></a><a class="link" href="#ssh-client">30.1. SSH Client</a></h3>
<div class="paragraph">
<p>A Citrus SSH client is useful for testing against a real SSH server. So Citrus is able to invoke SSH commands on the external server and validate the SSH response accordingly. The test case does not deal with the pure SSH protocol within this communication. The Citrus SSH client component expects a customized XML representation and automatically translates these request messages into a real SSH call to a specific host. Once the synchronous SSH response was received the result gets translated back to the XML response message representation. On this translated response we can easily apply the validation steps by the usual Citrus means.</p>
</div>
<div class="paragraph">
<p>The SSH client components receive its configuration in the Spring application context as usual. We can use the special SSH module namespace for easy configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ssh:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sshClient</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">9072</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">user</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">roland</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">private-key-path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/ssh/test_user.priv</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">strict-host-checking</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">host</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The SSH client receives several attributes, these are:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
id
</td>
<td class="hdlist2">
<p>Id identifying the bean and used as reference from with test descriptions. (e.g. id="sshClient")</p>
</td>
</tr>
<tr>
<td class="hdlist1">
host
</td>
<td class="hdlist2">
<p>Host to connect to for sending an SSH Exec request. Default is 'localhost' (e.g. host="localhost")
port: Port to use. Default is 2222 (e.g. port="9072")</p>
</td>
</tr>
<tr>
<td class="hdlist1">
private-key-path
</td>
<td class="hdlist2">
<p>Path to a private key, which can be either a plain file path or an class resource if prefixed with 'classpath' (e.g. private-key-path="classpath:test_user.priv")</p>
</td>
</tr>
<tr>
<td class="hdlist1">
private-key-password
</td>
<td class="hdlist2">
<p>Optional password for the private key (e.g. password="s!cr!t")</p>
</td>
</tr>
<tr>
<td class="hdlist1">
user
</td>
<td class="hdlist2">
<p>User used for connecting to the SSH server (e.g. user="roland")</p>
</td>
</tr>
<tr>
<td class="hdlist1">
password
</td>
<td class="hdlist2">
<p>Password used for password based authentication. Might be combined with "private-key-path" in which case both authentication mechanism are tried (e.g. password=&quot;ps!st)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
strict-host-checking
</td>
<td class="hdlist2">
<p>Whether the host key should be verified by looking it up in a 'known_hosts' file. Default is false (e.g. strict-host-checking="true")</p>
</td>
</tr>
<tr>
<td class="hdlist1">
known-hosts-path
</td>
<td class="hdlist2">
<p>Path to a known hosts file. If prefixed with 'classpath:' this file is looked up as a resource in the classpath (e.g. known-hosts-path="/etc/ssh/known_hosts")</p>
</td>
</tr>
<tr>
<td class="hdlist1">
command-timeout
</td>
<td class="hdlist2">
<p>Timeout in milliseconds for how long to wait for the SSH command to complete. Default is 5 minutes (e.g. command-timeout="300000")</p>
</td>
</tr>
<tr>
<td class="hdlist1">
connection-timeout
</td>
<td class="hdlist2">
<p>Timeout in milliseconds for how long to for a connectiuon to connect. Default is 1 minute (e.g. connection-timeout="60000")</p>
</td>
</tr>
<tr>
<td class="hdlist1">
actor
</td>
<td class="hdlist2">
<p>Actor used for switching groups of actions (e.g. actor="ssh-mock")</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once defines as client component in the Spring application context test cases can reference the client in every send test action.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sshClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message&gt;</span>
    <span class="tag">&lt;payload&gt;</span>
        <span class="tag">&lt;ssh-request</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/ssh/message</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;command&gt;</span>shutdown<span class="tag">&lt;/command&gt;</span>
          <span class="tag">&lt;stdin&gt;</span>input<span class="tag">&lt;/stdin&gt;</span>
        <span class="tag">&lt;/ssh-request&gt;</span>
    <span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span>

<span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sshClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message&gt;</span>
    <span class="tag">&lt;payload&gt;</span>
        <span class="tag">&lt;ssh-response</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/ssh/message</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;stdout&gt;</span>Hello Citrus<span class="tag">&lt;/stdout&gt;</span>
            <span class="tag">&lt;stderr</span><span class="tag">/&gt;</span>
            <span class="tag">&lt;exit&gt;</span>0<span class="tag">&lt;/exit&gt;</span>
        <span class="tag">&lt;/ssh-response&gt;</span>
    <span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see we use usual send and receive test actions. The XML SSH representation helps us to specify the request and response data for validation. This way you can call SSH commands against an external SSH server and validate the response data.</p>
</div>
</div>
<div class="sect2">
<h3 id="ssh-server"><a class="anchor" href="#ssh-server"></a><a class="link" href="#ssh-server">30.2. SSH Server</a></h3>
<div class="paragraph">
<p>Now that we have used Citrus on the client side we can also use Citrus SSH server module in order to provide a full stacked SSH server daemon. We can accept SSH client connections and provide proper response messages as an answer.</p>
</div>
<div class="paragraph">
<p>Given the above SSH module namespace declaration, adding a new SSH server is quite simple:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ssh:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sshServer</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">allowed-key-path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/ssh/test_user_pub.pem</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">user</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">roland</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">9072</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">auto-start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">endpoint-adapter</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sshEndpointAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>endpoint-adapter</strong> is the handler which receives the SSH request as messages (in the request format described above). Endpoint adapter implementations are fully described in <a href="#http-rest-server">http-server</a>All adapters described there are supported in SSH server module, too.</p>
</div>
<div class="paragraph">
<p>The <code>&lt;citrus-ssh:server&gt;</code> supports the following attributes:</p>
</div>
<div class="hdlist">
<div class="title">SSH Server Attributes:</div>
<table>
<tr>
<td class="hdlist1">
id
</td>
<td class="hdlist2">
<p>Name of the SSH server which identifies it unique within the Citrus Spring context (e.g. id="sshServer")</p>
</td>
</tr>
<tr>
<td class="hdlist1">
host-key-path
</td>
<td class="hdlist2">
<p>Path to PEM encoded key pair (public and private key) which is used as host key. By default, a standard, pre-generate, fixed keypair is used. The path can be specified either as an file path, or, if prefixed with <strong>classpath:</strong> is looked up from within the classpath. The path the is relative from to the top-level package, so no leading slash should be used (e.g. hist-key-path=&quot;/etc/citrus_ssh_server.pem)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
user
</td>
<td class="hdlist2">
<p>User which is allowed to connect (e.g. user="roland")</p>
</td>
</tr>
<tr>
<td class="hdlist1">
allowed-key-path
</td>
<td class="hdlist2">
<p>Path to a SSH public key stored in PEM format. These are the keys, which are allowed to connect to the SSH server when publickey authentication is used. It seves the same purpose as authorized_keys for standard SSH installations. The path can be specified either as an file path, or, if prefixed with <strong>classpath:</strong> is looked up from within the classpath. The path the is relative from to the top-level package, so no leading slash should be used (e.g. allowed-key-path=&quot;classpath:test_user_pub.pem)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
password
</td>
<td class="hdlist2">
<p>Password which should be used when password authentication is used. Both publickey authentication and password based authentication can be used together in which case both methods are tried in turn (e.g. password="s!cr!t")</p>
</td>
</tr>
<tr>
<td class="hdlist1">
host
</td>
<td class="hdlist2">
<p>Host address (e.g. localhost)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
port
</td>
<td class="hdlist2">
<p>Port on which to listen. The SSH server will bind on localhost to this port (e.g. port="9072")</p>
</td>
</tr>
<tr>
<td class="hdlist1">
auto-start
</td>
<td class="hdlist2">
<p>Whether to start this SSH server automatically. Default is <strong>true</strong> . If set to <strong>false</strong>, a test action is responsible for starting/stopping the server (e.g. auto-start="true")</p>
</td>
</tr>
<tr>
<td class="hdlist1">
endpoint-adapter
</td>
<td class="hdlist2">
<p>Bean reference to a endpoint adapter which processes the incoming SSH request. The message format for the request and response are described above (e.g. endpoint-adapter="sshEndpointAdapter")</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once the SSH server component is added to the Spring application context with a proper endpoint adapter like the MessageChannel forwarding adapter we can receive incoming requests in a test case and provide a respone message for the client.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sshServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message&gt;</span>
    <span class="tag">&lt;payload&gt;</span>
        <span class="tag">&lt;ssh-request</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/ssh/message</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
           <span class="tag">&lt;command&gt;</span>shutdown<span class="tag">&lt;/command&gt;</span>
           <span class="tag">&lt;stdin&gt;</span>input<span class="tag">&lt;/stdin&gt;</span>
        <span class="tag">&lt;/ssh-request&gt;</span>
    <span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span>

<span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sshServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message&gt;</span>
    <span class="tag">&lt;payload&gt;</span>
        <span class="tag">&lt;ssh-response</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/ssh/message</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;stdout&gt;</span>Hello Citrus<span class="tag">&lt;/stdout&gt;</span>
            <span class="tag">&lt;exit&gt;</span>0<span class="tag">&lt;/exit&gt;</span>
        <span class="tag">&lt;/ssh-response&gt;</span>
    <span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rmi"><a class="anchor" href="#rmi"></a><a class="link" href="#rmi">31. RMI support</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>RMI stands for Remote Method Invocation and is a standard way of calling Java method interfaces where caller and callee (client and server) are not located within the same JVM. So the object passed to the method as argument as well as the method return value are transmitted over the wire.</p>
</div>
<div class="paragraph">
<p>As a client Citrus is able to connect to some RMI registry that exposes some remote interfaces. As a server Citrus implements such a RMI registry and handles incoming method calls with providing the respective return value.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The RMI components in Citrus are kept in a separate Maven module. So you should check that the module is available as Maven dependency in your project
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>com.consol.citrus<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>citrus-rmi<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>2.7.3<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As usual Citrus provides a customized rmi configuration schema that is used in Spring configuration files. Simply include the citrus-rmi namespace in the configuration XML files as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:citrus</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/config</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:citrus-rmi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/rmi/config</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
      <span class="content">http://www.springframework.org/schema/beans</span>
      <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
      <span class="content">http://www.citrusframework.org/schema/config</span>
      <span class="content">http://www.citrusframework.org/schema/config/citrus-config.xsd</span>
      <span class="content">http://www.citrusframework.org/schema/rmi/config</span>
      <span class="content">http://www.citrusframework.org/schema/rmi/config/citrus-rmi-config.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

      [...]

      <span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you are ready to use the customized Http configuration elements with the citrus-rmi namespace prefix.</p>
</div>
<div class="paragraph">
<p>Read the next section in order to find out more about the RMI message support in Citrus.</p>
</div>
<div class="sect2">
<h3 id="rmi-client"><a class="anchor" href="#rmi-client"></a><a class="link" href="#rmi-client">31.1. RMI client</a></h3>
<div class="paragraph">
<p>On the client side we want to call e remote interface. We need to specify the method to call as well as all method arguments. The respective method return value is receivable within the test case for validation. Citrus provides a client component for RMI that sends out service invocation calls.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-rmi:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rmiClient1</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">host</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1099</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">newsService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

      <span class="tag">&lt;citrus-rmi:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rmiClient2</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">server-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rmi://localhost:1099/newsService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The client component in the Spring application context receives host and port configuration of a valid RMI service registry. Either by specifying a proper server url or by giving host, port and binding properties. The service binding is the name of the service that we would like to address in the registry. Now we are ready to use this client referenced by its id or name in a test case for a message sending action.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rmiClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;service-invocation</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/rmi/message</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
              <span class="tag">&lt;remote&gt;</span>com.consol.citrus.rmi.remote.NewsService<span class="tag">&lt;/remote&gt;</span>
              <span class="tag">&lt;method&gt;</span>getNews<span class="tag">&lt;/method&gt;</span>
            <span class="tag">&lt;/service-invocation&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> rmiClientTest() {
  send(rmiClient)
      .message(RmiMessage.invocation(NewsService.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">getNews</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We are using the usual Citrus send message action referencing the <strong>rmiClient</strong> as endpoint. The message payload is a special Citrus message that defines the service invocation. We define the <strong>remote</strong> interface as well as the <strong>method</strong> to call. Citrus RMI client component will be able to interpret this message content and call the service method.</p>
</div>
<div class="paragraph">
<p>The method return value is receivable for validation using the very same client endpoint.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rmiClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;service-result</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/rmi/message</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
              <span class="tag">&lt;object</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.String</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">This is news from RMI!</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/service-result&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> rmiClientTest() {
    receive(rmiClient)
        .message(RmiMessage.result(<span class="string"><span class="delimiter">&quot;</span><span class="content">This is news from RMI!</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the sample above we receive the service result and expect a <strong>java.lang.String</strong> object return value. The return value content is also validated within the service result payload.</p>
</div>
<div class="paragraph">
<p>Of course we can also deal with method arguments.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rmiClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;service-invocation</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/rmi/message</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;remote&gt;</span>com.consol.citrus.rmi.remote.NewsService<span class="tag">&lt;/remote&gt;</span>
                <span class="tag">&lt;method&gt;</span>setNews<span class="tag">&lt;/method&gt;</span>
                <span class="tag">&lt;args&gt;</span>
                  <span class="tag">&lt;arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">This is breaking news!</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/args&gt;</span>
            <span class="tag">&lt;/service-invocation&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> rmiServerTest() {
    send(rmiClient)
        .message(RmiMessage.invocation(NewsService.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">setNews</span><span class="delimiter">&quot;</span></span>)
              .argument(<span class="string"><span class="delimiter">&quot;</span><span class="content">This is breaking news!</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This completes the basic remote service call. Citrus invokes the remote interface method and validates the method return value. As a tester you might also face errors and exceptions when calling the remote interface method. You can catch and assert these remote exceptions verifying your error scenario.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;assert</span> <span class="attribute-name">exception</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.rmi.RemoteException</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;when&gt;</span>
        <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rmiClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;message&gt;</span>
                <span class="tag">&lt;payload&gt;</span>
                    <span class="tag">&lt;service-invocation</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/rmi/message</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                        [...]
                    <span class="tag">&lt;/service-invocation&gt;</span>
                <span class="tag">&lt;/payload&gt;</span>
            <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/send&gt;</span>
    <span class="tag">&lt;/when&gt;</span>
<span class="tag">&lt;assert</span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We assert the <strong><em>RemoteException</em></strong> to be thrown while calling the remote service method. This is how you can handle some sort of error situation while calling remote services. In the next section we will handle RMI communication where Citrus provides the remote interfaces.</p>
</div>
</div>
<div class="sect2">
<h3 id="rmi-server"><a class="anchor" href="#rmi-server"></a><a class="link" href="#rmi-server">31.2. RMI server</a></h3>
<div class="paragraph">
<p>On the server side Citrus needs to provide remote interfaces with methods callable for clients. This means that Citrus needs to support all your remote interfaces with method arguments and return values. The Citrus RMI server is able to bind your remote interfaces to a service registry. All incoming RMI client method calls are automatically accepted and the method arguments are converted into a Citrus XML service invocation representation. The RMI method call is then passed to the running test for validation.</p>
</div>
<div class="paragraph">
<p>Let us have a look at the Citrus RMI server component and how you can add it to the Spring application context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-rmi:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rmiServer</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">host</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1099</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">interface</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.rmi.remote.NewsService</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">newService</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">create-registry</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">auto-start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The RMI server component uses properties such as <strong>host</strong> and <strong>port</strong> to define the service registry. By default Citrus will connect to this service registry and bind its remote interfaces to it. With the attribute <strong>create-registry</strong> Citrus can also create the registry for you.</p>
</div>
<div class="paragraph">
<p>You have to give Citrus the fully qualified remote interface name so Citrus can bind it to the service registry and handle incoming method calls properly. In your test case you can then receive the incoming method calls on the server in order to perform validation steps.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rmiServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;service-invocation</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/rmi/message</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
              <span class="tag">&lt;remote&gt;</span>com.consol.citrus.rmi.remote.NewsService<span class="tag">&lt;/remote&gt;</span>
              <span class="tag">&lt;method&gt;</span>getNews<span class="tag">&lt;/method&gt;</span>
            <span class="tag">&lt;/service-invocation&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
        <span class="tag">&lt;header&gt;</span>
            <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_rmi_interface</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.rmi.remote.NewsService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_rmi_method</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">getNews</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/header&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> rmiServerTest() {
    receive(rmiServer)
        .message(RmiMessage.invocation(NewsService.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">getNews</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see Citrus converts the incoming service invocation to a special XML representation which is passed as message payload to the test. As this is plain XML you can verify the RMI message content as usual using Citrus variables, functions and validation matchers.</p>
</div>
<div class="paragraph">
<p>Since we have received the method call we need to provide some return value for the client. As usual we can specify the method return value with some XML representation.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rmiServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
          <span class="tag">&lt;service-result</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/rmi/message</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;object</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.String</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">This is news from RMI!</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;/service-result&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> rmiServerTest() {
    send(rmiServer)
        .message(RmiMessage.result(<span class="string"><span class="delimiter">&quot;</span><span class="content">This is news from RMI!</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The service result is defined as object with a <strong>type</strong> and <strong>value</strong> . The Citrus RMI remote interface method will return this value to the calling client. This would complete the successful remote service invocation. At this point we also have to think of choosing to raise some remote exception as service outcome.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rmiServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
          <span class="tag">&lt;service-result</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/rmi/message</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;exception&gt;</span>Something went wrong<span class="tag">&lt;exception</span><span class="tag">/&gt;</span>
          <span class="tag">&lt;/service-result&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> rmiServerTest() {
    send(rmiServer)
        .message(RmiMessage.exception(<span class="string"><span class="delimiter">&quot;</span><span class="content">Something went wrong</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above Citrus will not return some object as service result but raise a <strong>java.rmi.RemoteException</strong> with respective error message as specified in the test case. The calling client will receive the exception accordingly.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jmx"><a class="anchor" href="#jmx"></a><a class="link" href="#jmx">32. JMX support</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>JMX is a standard Java API for making beans accessible to others in terms of management and remote configuration. JMX is the short term for Java Management Extensions and is often used in JEE application servers to manage bean attributes and operations from outside (e.g. another JVM). A managed bean server hosts multiple managed beans for JMX access. Remote connections to JMX can be realized with RMI (Remote method invocation) capabilities.</p>
</div>
<div class="paragraph">
<p>Citrus is able to connect to JMX managed beans as client and server. As a client Citrus can invoke managed bean operations and read write managed bean attributes. As a server Citrus is able to expose managed beans as mbean server. Clients can access those Citrus managed beans and get proper response objects as result. Doing so you can use the JVM platform managed bean server or some RMI registry for providing remote access.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The JMX components in Citrus are kept in a separate Maven module. So you should check that the module is available as Maven dependency in your project
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>com.consol.citrus<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>citrus-jmx<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>2.7.3<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As usual Citrus provides a customized jmx configuration schema that is used in Spring configuration files. Simply include the citrus-jmx namespace in the configuration XML files as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:citrus</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/config</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:citrus-jmx</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/jmx/config</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
      <span class="content">http://www.springframework.org/schema/beans</span>
      <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
      <span class="content">http://www.citrusframework.org/schema/config</span>
      <span class="content">http://www.citrusframework.org/schema/config/citrus-config.xsd</span>
      <span class="content">http://www.citrusframework.org/schema/jmx/config</span>
      <span class="content">http://www.citrusframework.org/schema/jmx/config/citrus-jmx-config.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

      [...]

      <span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you are ready to use the customized Http configuration elements with the citrus-jmx namespace prefix.</p>
</div>
<div class="paragraph">
<p>Next sections describe the JMX message support in Citrus in more detail.</p>
</div>
<div class="sect2">
<h3 id="jmx-client"><a class="anchor" href="#jmx-client"></a><a class="link" href="#jmx-client">32.1. JMX client</a></h3>
<div class="paragraph">
<p>On the client side we want to call some managed bean by either accessing managed attributes with read/write or by invoking a managed bean operation. For proper mbean server connectivity we should specify a client component for JMX that sends out mbean invocation calls.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-jmx:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmxClient</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">server-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">platform</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The client component specifies the target managed bean server that we want to connect to. In this example we are using the JVM platform mbean server. This means we are able to access all JVM managed beans such as Memory, Threading and Logging. In addition to that we can access all custom managed beans that were exposed to the platform mbean server.</p>
</div>
<div class="paragraph">
<p>In most cases you may want to access managed beans on a different JVM or application server. So we need some remote connection to the foreign mbean server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-jmx:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmxClient</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">server-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">service:jmx:rmi:///jndi/rmi://localhost:1099/jmxrmi</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">username</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">password</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">s!cr!t</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">auto-reconnect</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">delay-on-reconnect</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example above we connect to a remote mbean server via RMI using the default RMI registry <strong>localhost:1099</strong> and the service name <strong>jmxrmi</strong> . Citrus is able to handle different remote transport protocols. Just define those in the <strong>server-url</strong> .</p>
</div>
<div class="paragraph">
<p>Now that we have setup the client component we can use it in a test case to access a managed bean.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmxClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;mbean-invocation</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/jmx/message</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
              <span class="tag">&lt;mbean&gt;</span>java.lang:type=Memory<span class="tag">&lt;/mbean&gt;</span>
              <span class="tag">&lt;attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Verbose</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/mbean-invocation&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> jmxClientTest() {
    send(jmxClient)
        .message(JmxMessage.invocation(<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang:type=Memory</span><span class="delimiter">&quot;</span></span>)
            .attribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">Verbose</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see we just used a normal send action referencing the jmx client component that we have just added. The message payload is a XML representation of the managed bean access. This is a special Citrus XML representation. Citrus will convert this XML payload to the actuel managed bean access. In the example above we try to access a managed bean with object name <strong>java.lang:type=Memory</strong> . The object name is defined in JMX specification and consists of a key <strong>java.lang:type</strong> and a value <strong>Memory</strong> . So we identify the managed bean on the server by its type.</p>
</div>
<div class="paragraph">
<p>Now that we have access to the managed bean we can read its managed attributes such as <strong>Verbose</strong> . This is a boolean type attribute so the mbean invocation result will be a respective Boolean object. We can validate the managed bean attribute access in a receive action.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmxClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;mbean-result</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/jmx/message</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
              <span class="tag">&lt;object</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.Boolean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/mbean-result&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> jmxClientTest() {
    receive(jmxClient)
        .message(JmxMessage.result(<span class="predefined-constant">false</span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the sample above we receive the mbean result and expect a <strong>java.lang.Boolean</strong> object return value. The return value content is also validated within the mbean result payload.</p>
</div>
<div class="paragraph">
<p>Some managed bean attributes might also be settable for us. So wen can define the attribute access as write operation by specifying a value in the send action payload.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmxClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;mbean-invocation</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/jmx/message</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
              <span class="tag">&lt;mbean&gt;</span>java.lang:type=Memory<span class="tag">&lt;/mbean&gt;</span>
              <span class="tag">&lt;attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Verbose</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.Boolean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/mbean-invocation&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> jmxClientTest() {
    send(jmxClient)
        .message(JmxMessage.invocation(<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang:type=Memory</span><span class="delimiter">&quot;</span></span>)
            .attribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">Verbose</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">true</span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we have write access to the managed attribute <strong>Verbose</strong> . We do specify the value and its type <strong>java.lang.Boolean</strong> . This is how we can set attribute values on managed beans.</p>
</div>
<div class="paragraph">
<p>Last not least we are able to access managed bean operations.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmxClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;mbean-invocation</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/jmx/message</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
              <span class="tag">&lt;mbean&gt;</span>com.consol.citrus.jmx.mbean:type=HelloBean<span class="tag">&lt;/mbean&gt;</span>
              <span class="tag">&lt;operation</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="error">&gt;</span>parameter<span class="error">&gt;</span>
                  <span class="error">&gt;</span>param type=&quot;java.lang.String&quot; value=&quot;Hello JMX!&quot;/<span class="error">&gt;</span>
                <span class="error">&gt;</span>/parameter<span class="error">&gt;</span>
              <span class="error">&gt;</span>/operation<span class="error">&gt;</span>
            <span class="tag">&lt;/mbean-invocation&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> jmxClientTest() {
    send(jmxClient)
        .message(JmxMessage.invocation(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.jmx.mbean:type=HelloBean</span><span class="delimiter">&quot;</span></span>)
            .operation(<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>)
            .parameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello JMX!</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above we access a custom managed bean and invoke its operation <strong>sayHello</strong> . We are also using operation parameters for the invocation. This should call the managed bean operation and return its result if any as usual.</p>
</div>
<div class="paragraph">
<p>This completes the basic JMX managed bean access as client. Now we also want to discuss the server side were Citrus is able to provide managed beans for others</p>
</div>
</div>
<div class="sect2">
<h3 id="jmx-server"><a class="anchor" href="#jmx-server"></a><a class="link" href="#jmx-server">32.2. JMX server</a></h3>
<div class="paragraph">
<p>The server side is always a little bit more tricky because we need to simulate custom managed bean access as a server. First of all Citrus provides a server component that specifies the connection properties for clients such as transport protocols, ports and mbean object names. Lets create a new server that accepts incoming requests via RMI on a remote registry <strong>localhost:1099</strong> .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-jmx:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmxServer</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">server-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">service:jmx:rmi:///jndi/rmi://localhost:1099/jmxrmi</span><span class="delimiter">&quot;</span></span>
    <span class="error">&lt;</span><span class="attribute-name">citrus-jmx:mbeans</span><span class="tag">&gt;</span>
        <span class="tag">&lt;citrus-jmx:mbean</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.jmx.mbean.HelloBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;citrus-jmx:mbean</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.jmx.mbean.NewsBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">objectDomain</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.news</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">objectName</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name=News</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/citrus-jmx:mbeans&gt;</span>
<span class="tag">&lt;/citrus-jmx:server&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As usual we define a <strong>server-url</strong> that controls the JMX connector access to the mbean server. In this example above we open a JMX RMI connector for clients using the registry <strong>localhost:1099</strong> and the service name <strong>jmxrmi</strong> By default Citrus will not attempt to create this registry automatically so the registry has to be present before the server start up. With the optional server property <strong>create-registry</strong> set to <strong>true</strong> you can auto create the registry when the server starts up. These properties do only apply when using a remote JMX connector server.</p>
</div>
<div class="paragraph">
<p>Besides using the whole server-url as property we can also construct the connection by host, port, protocol and binding properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-jmx:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmxServer</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">host</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">localhost</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1099</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">protocol</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rmi</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmxrmi</span><span class="delimiter">&quot;</span></span>
    <span class="error">&lt;</span><span class="attribute-name">citrus-jmx:mbeans</span><span class="tag">&gt;</span>
        <span class="tag">&lt;citrus-jmx:mbean</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.jmx.mbean.HelloBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;citrus-jmx:mbean</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.jmx.mbean.NewsBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">objectDomain</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.news</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">objectName</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name=News</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/citrus-jmx:mbeans&gt;</span>
<span class="tag">&lt;/citrus-jmx:server&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On last thing to mention is that we could have also used <strong>platform</strong> as server-url in order to use the JVM platform mbean server instead.</p>
</div>
<div class="paragraph">
<p>Now that we clarified the connectivity we need to talk about how to define the managed beans that are available on our JMX mbean server. This is done as nested <strong>mbean</strong> configuration elements. Here the managed bean definitions describe the managed bean with its objectDomain, objectName, operations and attributes. The most convenient way of defining such managed bean definitions is to give a bean type which is the fully qualified class name of the managed bean. Citrus will use the package name and class name for proper objectDomain and objectName construction.</p>
</div>
<div class="paragraph">
<p>Lets have a closer look at the first mbean definition in the example above. So the first managed bean is defined by its class name <strong>com.consol.citrus.jmx.mbean.HelloBean</strong> and therefore is accessible using the objectName <strong>com.consol.citrus.jmx.mbean:type=HelloBean</strong> . In addition to that Citrus will read the class information such as available methods, getters and setters for constructing a proper MBeanInfo. In the second managed bean definition in our example we have used additional custom objectDomain and objectName values. So the <strong>NewsBean</strong> will be accessible with <strong>com.consol.citrus.news:name=News</strong> on the managed bean server.</p>
</div>
<div class="paragraph">
<p>This is how we can define the bindings of managed beans and what clients need to search for when finding and accessing the managed beans on the server. When clients try to find the managed beans they have to use proper objectNames accordingly. ObjectNames that are not defined on the server will be rejected with managed bean not found error.</p>
</div>
<div class="paragraph">
<p>Right now we have to use the qualified class name of the managed bean in the definition. What happens if we do not have access to that mbean class or if there is not managed bean interface available at all? Citrus provides a generic managed bean that is able to handle any managed bean interaction. The generic bean implementation needs to know the managed operations and attributes though. So lets define a new generic managed bean on our server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-jmx:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmxServer</span><span class="delimiter">&quot;</span></span>
<span class="attribute-name">server-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">service:jmx:rmi:///jndi/rmi://localhost:1099/jmxrmi</span><span class="delimiter">&quot;</span></span>
    <span class="error">&lt;</span><span class="attribute-name">citrus-jmx:mbeans</span><span class="tag">&gt;</span>
        <span class="tag">&lt;citrus-jmx:mbean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fooBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">objectDomain</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo.object.domain</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">objectName</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">type=FooBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;citrus-jmx:operations&gt;</span>
                <span class="tag">&lt;citrus-jmx:operation</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fooOperation</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                    <span class="tag">&lt;citrus-jmx:parameter&gt;</span>
                        <span class="tag">&lt;citrus-jmx:param</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.String</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                        <span class="tag">&lt;citrus-jmx:param</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.Integer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                    <span class="tag">&lt;/citrus-jmx:parameter&gt;</span>
                <span class="tag">&lt;/citrus-jmx:operation&gt;</span>
                <span class="tag">&lt;citrus-jmx:operation</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">barOperation</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/citrus-jmx:operations&gt;</span>
            <span class="tag">&lt;citrus-jmx:attributes&gt;</span>
                <span class="tag">&lt;citrus-jmx:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fooAttribute</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.String</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;citrus-jmx:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">barAttribute</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.Boolean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/citrus-jmx:attributes&gt;</span>
        <span class="tag">&lt;/citrus-jmx:mbean&gt;</span>
    <span class="tag">&lt;/citrus-jmx:mbeans&gt;</span>
<span class="tag">&lt;/citrus-jmx:server&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The generic bean definition needs to define all operations and attributes that are available for access. Up to now we are restricted to using Java base types when defining operation parameter and attribute return types. There is actually no way to define more complex return types. Nevertheless Citrus is now able to expose the managed bean for client access without having to know the actual managed bean implementation.</p>
</div>
<div class="paragraph">
<p>Now we can use the server component in a test case to receive some incoming managed bean access.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmxServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;mbean-invocation</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/jmx/message</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
              <span class="tag">&lt;mbean&gt;</span>com.consol.citrus.jmx.mbean:type=HelloBean<span class="tag">&lt;/mbean&gt;</span>
              <span class="tag">&lt;operation</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="error">&gt;</span>parameter<span class="error">&gt;</span>
                  <span class="error">&gt;</span>param type=&quot;java.lang.String&quot; value=&quot;Hello JMX!&quot;/<span class="error">&gt;</span>
                <span class="error">&gt;</span>/parameter<span class="error">&gt;</span>
              <span class="tag">&lt;/operation&gt;</span>
            <span class="tag">&lt;/mbean-invocation&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> jmxServerTest() {
    receive(jmxServer)
        .message(JmxMessage.invocation(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.jmx.mbean:type=HelloBean</span><span class="delimiter">&quot;</span></span>)
            .operation(<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span>)
            .parameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello JMX!</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this very first example we expect a managed bean access to the bean <strong>com.consol.citrus.jmx.mbean:type=HelloBean</strong> . We further expect the operation <strong>sayHello</strong> to be called with respective parameter values. Now we have to define the operation result that will be returned to the calling client as operation result.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmxServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
          <span class="tag">&lt;mbean-result</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/jmx/message</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;object</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.String</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello from JMX!</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;/mbean-result&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> jmxServerTest() {
    send(jmxServer)
        .message(JmxMessage.result(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello from JMX!</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The operation returns a String <strong>Hello from JMX!</strong> . This is how we can expect operation calls on managed beans. Now we already have seen that managed beans also expose attributes. The next example is handling incoming attribute read access.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmxServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
            <span class="tag">&lt;mbean-invocation</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/jmx/message</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
              <span class="tag">&lt;mbean&gt;</span>com.consol.citrus.news:name=News<span class="tag">&lt;/mbean&gt;</span>
                <span class="error">&gt;</span>attribute name=&quot;newsCount&quot;/<span class="error">&gt;</span>
            <span class="tag">&lt;/mbean-invocation&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span>

<span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmxServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="tag">&lt;payload&gt;</span>
          <span class="tag">&lt;mbean-result</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/jmx/message</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;object</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.Integer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">100</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;/mbean-result&gt;</span>
        <span class="tag">&lt;/payload&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> jmxServerTest() {
    receive(jmxServer)
        .message(JmxMessage.invocation(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.news:name=News</span><span class="delimiter">&quot;</span></span>)
            .attribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">newsCount</span><span class="delimiter">&quot;</span></span>);

    send(jmxServer)
        .message(JmxMessage.result(<span class="integer">100</span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The receive action expects read access to the <strong>NewsBean</strong> attribute <strong>newsCount</strong> and returns a result object of type <strong>java.lang.Integer</strong> . This way we can expect all attribute access to our managed beans. Write operations will have a attribute value specified.</p>
</div>
<div class="paragraph">
<p>This completes the JMX server capabilities with managed bean access on operations and attributes.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cucumber"><a class="anchor" href="#cucumber"></a><a class="link" href="#cucumber">33. Cucumber BDD support</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Behavior driven development (BDD) is becoming more and more popular these days. The idea of defining and describing the software behavior as basis for all tests in prior to translating those feature descriptions into executable tests is a very interesting approach because it includes the technical experts as well as the domain experts. With BDD the domain experts can easily read and verify the tests and the technical experts get a detailed description of what should happen in the test.</p>
</div>
<div class="paragraph">
<p>The test scenario descriptions follow the Gherkin syntax with a <strong>"Given-When-Then"</strong> structure most of the time. The Gherkin language is business readable and well known in BDD.</p>
</div>
<div class="paragraph">
<p>There are lots of frameworks in the Java community that support BDD concepts. Citrus has dedicated support for the Cucumber framework because Cucumber is well suited for extensions and plugins. So with the Citrus and Cucumber integration you can write Gherkin syntax scenario and feature stories in order to execute the Citrus integration test capabilities. As usual we have a look at a first example. First lets see the Citrus cucumber dependency and XML schema definitions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Cucumber components in Citrus are kept in a separate Maven module. If not already done so you have to include the module as Maven dependency to your project
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>com.consol.citrus<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>citrus-cucumber<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>2.7.3<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus provides a separate configuration namespace and schema definition for Cucumber related step definitions. Include this namespace into your Spring configuration in order to use the Citrus Cucumber configuration elements. The namespace URI and schema location are added to the Spring configuration XML file as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;spring:beans</span> <span class="attribute-name">xmlns:spring</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
     <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
     <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/cucumber/testcase</span><span class="delimiter">&quot;</span></span>
     <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
     <span class="content">http://www.springframework.org/schema/beans</span>
     <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
     <span class="content">http://www.citrusframework.org/schema/cucumber/testcase</span>
     <span class="content">http://www.citrusframework.org/schema/cucumber/testcase/citrus-cucumber-testcase.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    [...]

<span class="tag">&lt;/spring:beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Cucumber works with both JUnit and TestNG as unit testing framework. You can choose which framework to use with Cucumber. So following from that we need a Maven dependency for the unit testing framework support:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>info.cukes<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>cucumber-junit<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>${cucumber.version}<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to enable Citrus Cucumber support we need to specify a special object factory in the environment. The most comfortable way to specify a custom object factory is to add this property to the <strong>cucumber.properties</strong> in classpath.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">cucumber.api.java.ObjectFactory=cucumber.runtime.java.CitrusObjectFactory</code></pre>
</div>
</div>
<div class="paragraph">
<p>This special object factory takes care on creating all step definition instances. The object factory is able to inject <strong>@CitrusResource</strong> annotated fields in step classes. We will see this later on in the examples. The usage of this special object factory is mandatory in order to combine Citrus and Cucumber capabilities.</p>
</div>
<div class="paragraph">
<p>The <strong>CitrusObjectFactory</strong> will automatically initialize the Citrus world for us. This includes the default <strong>citrus-context.xml</strong> Citrus Spring configuration that is automatically loaded within the object factory. So you can define and use Citrus components as usual within your test.</p>
</div>
<div class="paragraph">
<p>After these preparation steps you are able to combine Citrus and Cucumber in your project.</p>
</div>
<div class="sect2">
<h3 id="cucumber-integration"><a class="anchor" href="#cucumber-integration"></a><a class="link" href="#cucumber-integration">33.1. Cucumber integration</a></h3>
<div class="paragraph">
<p>Cucumber is able to run tests with JUnit. The basic test case is an empty test which uses the respective JUnit runner implementation from cucumber.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(Cucumber.class)
<span class="annotation">@CucumberOptions</span>(
  plugin = { <span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.cucumber.CitrusReporter</span><span class="delimiter">&quot;</span></span> } )
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyFeatureIT</span> {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The test case above uses the <strong>Cucumber</strong> JUnit test runner. In addition to that we give some options to the Cucumber execution. We define a special Citrus reporter implementation. This class is responsible for printing the Citrus test summary. This reporter extends the default Cucumber reporter implementation so the default Cucumber report summaries are also printed to the console.</p>
</div>
<div class="paragraph">
<p>That completes the JUnit class configuration. Now we are able to add feature stories and step definitions to the package of our test <strong>MyFeatureIT</strong> . Cucumber and Citrus will automatically pick up step definitions and glue code in that test package. So lets write a feature story <strong>echo.feature</strong> right next to the <strong>MyFeatureIT</strong> test class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Feature: Echo service

  Scenario: Say hello
    Given My name is Citrus
    When I say hello to the service
    Then the service should return: &quot;Hello, my name is Citrus!&quot;

  Scenario: Say goodbye
    Given My name is Citrus
    When I say goodbye to the service
    Then the service should return: &quot;Goodbye from Citrus!&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see this story defines two scenarios with the Gherkin <strong>Given-When-Then</strong> syntax. Now we need to add step definitions that glue the story description to Citrus test actions. Lets do this in a new class <strong>EchoSteps</strong> .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">EchoSteps</span> {

    <span class="annotation">@CitrusResource</span>
    <span class="directive">protected</span> TestDesigner designer;

    <span class="annotation">@Given</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">^My name is (.*)$</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> my_name_is(<span class="predefined-type">String</span> name) {
        designer.variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>, name);
    }

    <span class="annotation">@When</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">^I say hello.*$</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> say_hello() {
        designer.send(<span class="string"><span class="delimiter">&quot;</span><span class="content">echoEndpoint</span><span class="delimiter">&quot;</span></span>)
          .messageType(MessageType.PLAINTEXT)
          .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello, my name is ${username}!</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@When</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">^I say goodbye.*$</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> say_goodbye() {
        designer.send(<span class="string"><span class="delimiter">&quot;</span><span class="content">echoEndpoint</span><span class="delimiter">&quot;</span></span>)
          .messageType(MessageType.PLAINTEXT)
          .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">Goodbye from ${username}!</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@Then</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">^the service should return: </span><span class="char">\&quot;</span><span class="content">([^</span><span class="char">\&quot;</span><span class="content">]*)</span><span class="char">\&quot;</span><span class="content">$</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> verify_return(<span class="directive">final</span> <span class="predefined-type">String</span> body) {
        designer.receive(<span class="string"><span class="delimiter">&quot;</span><span class="content">echoEndpoint</span><span class="delimiter">&quot;</span></span>)
          .messageType(MessageType.PLAINTEXT)
          .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">You just said: </span><span class="delimiter">&quot;</span></span> + body);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we have a closer look at the step definition class we see that it is a normal POJO that uses a <strong>@CitrusResource</strong> annotated <strong>TestDesigner</strong>. The test designer is automatically injected by Citrus Cucumber extension. This is done because we have included the citrus-cucumber dependency to our project before.</p>
</div>
<div class="paragraph">
<p>We can set the injection mode for the Citrus Cucumber extension with a system property named <em>citrus.cucumber.injection.mode</em>. By default this is set to <strong>DESIGNER</strong> so Citrus will inject a test designer instance. In case you want to use the
test runner instead you should set the system property or environment property in your project.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">citrus.cucumber.injection.mode=RUNNER
CITRUS_CUCUMBER_INJECTION_MODE=RUNNER</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can write @Given, @When or @Then annotated methods that match the scenario descriptions in our story. Cucumber will automatically find matching methods and execute them. The methods add test actions to the test designer as we are used to it in normal Java DSL tests. At the end the test designer is automatically executed with the test logic.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Of course you can do the dependency injection with <strong>@CitrusResource</strong> annotations on <strong>TestRunner</strong> instances, too. Which variation should someone use <strong>TestDesigner</strong> or <strong>TestRunner</strong> ? In fact there is a significant difference when looking at the two approaches. The designer will use the Gherkin methods to build the whole Citrus test case first before any action is executed. The runner will execute each test action that has been built with a Gherkin step immediately. This means that a designer approach will always complete all BDD step definitions before taking action. This directly affects the Cucumber step reports. All steps are usually marked as successful when using a designer approach as the Citrus test is executed after the Cucumber steps have been executed. The runner approach in contrast will fail the step when the corresponding test action fails. The Cucumber test reports will definitely look different depending on what approach you are choosing. All other functions stay the same in both approaches. If you need to learn more about designer and runner approaches please see
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If we run the Cucumber test the Citrus test case automatically performs its actions. That is a first combination of Citrus and Cucumber BDD. The story descriptions are translated to test actions and we are able to run integration tests with behavior driven development. Great! In a next step we will use XML step definitions rather than coding the steps in Java DSL.</p>
</div>
</div>
<div class="sect2">
<h3 id="cucumber-xml-steps"><a class="anchor" href="#cucumber-xml-steps"></a><a class="link" href="#cucumber-xml-steps">33.2. Cucumber XML steps</a></h3>
<div class="paragraph">
<p>So far we have written glue code in Java in order to translate Gherkin syntax descriptions to test actions. Now we want to do the same with just XML configuration. The JUnit Cucumber class should not change. We still use the Cucumber runner implementation with some options specific to Citrus:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(Cucumber.class)
<span class="annotation">@CucumberOptions</span>(
    plugin = { <span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.cucumber.CitrusReporter</span><span class="delimiter">&quot;</span></span> } )
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyFeatureIT</span> {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The scenario description is also not changed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Feature: Echo service

  Scenario: Say hello
    Given My name is Citrus
    When I say hello to the service
    Then the service should return: &quot;Hello, my name is Citrus!&quot;

  Scenario: Say goodbye
    Given My name is Citrus
    When I say goodbye to the service
    Then the service should return: &quot;Goodbye from Citrus!&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the feature package <strong>my.company.features</strong> we add a new XML file <strong>EchoSteps.xml</strong> that holds the new XML step definitions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;spring:beans</span> <span class="attribute-name">xmlns:citrus</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/testcase</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:spring</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/cucumber/testcase</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
                          <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
                          <span class="content">http://www.citrusframework.org/schema/cucumber/testcase</span>
                          <span class="content">http://www.citrusframework.org/schema/cucumber/testcase/citrus-cucumber-testcase.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

  <span class="tag">&lt;step</span> <span class="attribute-name">given</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">^My name is (.*)$</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parameter-names</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:create-variables&gt;</span>
      <span class="tag">&lt;citrus:variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${username}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/citrus:create-variables&gt;</span>
  <span class="tag">&lt;/step&gt;</span>

  <span class="tag">&lt;step</span> <span class="attribute-name">when</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">^I say hello.*$</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">echoEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;citrus:message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plaintext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;citrus:data&gt;</span>Hello, my name is ${username}!<span class="tag">&lt;/citrus:data&gt;</span>
      <span class="tag">&lt;/citrus:message&gt;</span>
    <span class="tag">&lt;/citrus:send&gt;</span>
  <span class="tag">&lt;/step&gt;</span>

  <span class="tag">&lt;step</span> <span class="attribute-name">when</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">^I say goodbye.*$</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">echoEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;citrus:message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plaintext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;citrus:data&gt;</span>Goodbye from ${username}!<span class="tag">&lt;/citrus:data&gt;</span>
      <span class="tag">&lt;/citrus:message&gt;</span>
    <span class="tag">&lt;/citrus:send&gt;</span>
  <span class="tag">&lt;/step&gt;</span>

  <span class="tag">&lt;step</span> <span class="attribute-name">then</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">^the service should return: </span><span class="entity">&amp;quot;</span><span class="content">([^</span><span class="entity">&amp;quot;</span><span class="content">]*)</span><span class="entity">&amp;quot;</span><span class="content">$</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">parameter-names</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">body</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">echoEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;citrus:message</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plaintext</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;citrus:data&gt;</span>You just said: ${body}<span class="tag">&lt;/citrus:data&gt;</span>
      <span class="tag">&lt;/citrus:message&gt;</span>
    <span class="tag">&lt;/citrus:receive&gt;</span>
  <span class="tag">&lt;/step&gt;</span>

<span class="tag">&lt;/spring:beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above steps definition is written in pure XML. Citrus will automatically read the step definition and add those to the Cucumber runtime. Following from that the step definitions are executed when matching to the feature story. The XML step files follow a naming convention. Citrus will look for all files located in the feature package with name pattern <code>**/**.Steps.xml</code> and load those definitions when Cucumber starts up.</p>
</div>
<div class="paragraph">
<p>The XML steps are able to receive parameters from the Gherkin regexp matcher. The parameters are passed to the step as test variable. The parameter names get declared in the optional attribute <strong>parameter-names</strong> . In the step definition actions you can use the parameter names as test variables.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The test variables are visible in all upcoming steps, too. This is because the test variables are global by default. If you need to set local state for a step definition you can use another attribute <strong>global-context</strong> and set it to <strong>false</strong> in the step definition. This way all test variables and parameters are only visible in the step definition. Other steps will not see the test variables.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Another notable thing is the XML escaping of reserved characters in the pattern definition. You can see that in the last step where the <strong>then</strong> attribute is escaping quotation characters.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">then=&quot;^the service should return: <span class="entity">&amp;quot;</span>([^<span class="entity">&amp;quot;</span>]*)<span class="entity">&amp;quot;</span>$&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>We have to do this because otherwise the quotation characters will interfere with the XML syntax in the attribute.</p>
</div>
<div class="paragraph">
<p>This completes the description of how to add XML step definitions to the cucumber BDD tests. In a next section we will use predefined steps for sending and receiving messages.</p>
</div>
</div>
<div class="sect2">
<h3 id="cucumber-spring"><a class="anchor" href="#cucumber-spring"></a><a class="link" href="#cucumber-spring">33.3. Cucumber Spring support</a></h3>
<div class="paragraph">
<p>Cucumber provides support for Spring dependency injection in step definition classes. The Cucumber Spring capabilities are included in a separate module. So we first of all we have to add this dependency to our project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>info.cukes<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>cucumber-spring<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>${cucumber.version}<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Citrus Cucumber extension has to handle things different when Cucumber Spring support is enabled. Therefore we use another object factory implementation that also support Cucumber Spring features. Change the object factory property in <strong>cucumber.properties</strong> to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">cucumber.api.java.ObjectFactory=cucumber.runtime.java.spring.CitrusSpringObjectFactory</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we are ready to add <strong>@Autowired</strong> Spring bean dependency injection to step definition classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ContextConfiguration</span>(classes = CitrusSpringConfig.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">EchoSteps</span> {
    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> Endpoint echoEndpoint;

    <span class="annotation">@CitrusResource</span>
    <span class="directive">protected</span> TestDesigner designer;

    <span class="annotation">@Given</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">^My name is (.*)$</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> my_name_is(<span class="predefined-type">String</span> name) {
        designer.variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>, name);
    }

    <span class="annotation">@When</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">^I say hello.*$</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> say_hello() {
        designer.send(echoEndpoint)
            .messageType(MessageType.PLAINTEXT)
            .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello, my name is ${username}!</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@When</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">^I say goodbye.*$</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> say_goodbye() {
        designer.send(echoEndpoint)
            .messageType(MessageType.PLAINTEXT)
            .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">Goodbye from ${username}!</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@Then</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">^the service should return: </span><span class="char">\&quot;</span><span class="content">([^</span><span class="char">\&quot;</span><span class="content">]*)</span><span class="char">\&quot;</span><span class="content">$</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="type">void</span> verify_return(<span class="directive">final</span> <span class="predefined-type">String</span> body) {
        designer.receive(echoEndpoint)
            .messageType(MessageType.PLAINTEXT)
            .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">You just said: </span><span class="delimiter">&quot;</span></span> + body);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see we used Spring autowiring mechanism for the <strong>echoEndpoint</strong> field in the step definition. Also be sure to define the <strong>@ContextConfiguration</strong> annotation on the step definition. The Cucumber Spring support loads the Spring application context and takes care on dependency injection. We use the Citrus <strong>CitrusSpringConfig</strong> Java configuration because this is the main entrance for Citrus test cases. You can add custom beans and further Spring related configuration to this Spring application context. If you want to add more beans for autowiring do so in the Citrus Spring configuration. Usually this is the default <strong>citrus-context.xml</strong> which is automatically loaded.</p>
</div>
<div class="paragraph">
<p>Of course you can also use a custom Java Spring configuration class here. But be sure to always import the Citrus Spring Java configuration classes, too. Otherwise you will not be able to execute the Citrus integration test capabilities.</p>
</div>
<div class="paragraph">
<p>As usual we are able to use <strong>@CitrusResource</strong> annotated <strong>TestDesigner</strong> fields for building the Citrus integration test logic. With this extension you can use the full Spring testing power in your tests in particular dependency injection and also transaction management for data persistence tests.</p>
</div>
</div>
<div class="sect2">
<h3 id="citrus-step-definitions"><a class="anchor" href="#citrus-step-definitions"></a><a class="link" href="#citrus-step-definitions">33.4. Citrus step definitions</a></h3>
<div class="paragraph">
<p>Citrus provides some out of the box predefined steps for typical integration test scenarios. These steps are ready to use in scenario or feature stories. You can basically define send and receive operations. As these steps are predefined in Citrus you just need to write feature stories. The step definitions with glue to test actions are handled automatically.</p>
</div>
<div class="paragraph">
<p>If you want to enable predefined steps support in your test you need to include the glue code package in your test class like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(Cucumber.class)
<span class="annotation">@CucumberOptions</span>(
    glue = { <span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.cucumber.step.designer.core</span><span class="delimiter">&quot;</span></span> },
    plugin = { <span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.cucumber.CitrusReporter</span><span class="delimiter">&quot;</span></span> } )
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyFeatureIT</span> {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of writing the glue code on our own in step definition classes we include the glue package <strong>com.consol.citrus.cucumber.step.designer.core</strong> . This automatically loads all Citrus glue step definitions in this package. Once you have done this you can use predefined steps that add Citrus test logic without having to write any glue code in Java step definitions.</p>
</div>
<div class="paragraph">
<p>Of course you can also choose to include the <strong>TestRunner</strong> step definitions by choosing the glue package <strong>com.consol.citrus.cucumber.step.runner.core</strong> .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RunWith</span>(Cucumber.class)
<span class="annotation">@CucumberOptions</span>(
    glue = { <span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.cucumber.step.runner.core</span><span class="delimiter">&quot;</span></span> },
    plugin = { <span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.cucumber.CitrusReporter</span><span class="delimiter">&quot;</span></span> } )
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyFeatureIT</span> {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Following basic step definitions are included in this package:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Given variable [name] is &quot;[value]&quot;
Given variables
| [name1]   | [value1]   |
| [name2]   | [value2]   |

When <span class="error">&lt;</span>[endpoint-name]<span class="error">&gt;</span> sends &quot;[message-payload]&quot;
Then <span class="error">&lt;</span>[endpoint-name]<span class="error">&gt;</span> should receive (message-type) &quot;[message-payload]&quot;

When <span class="error">&lt;</span>[endpoint-name]<span class="error">&gt;</span> sends
  &quot;&quot;&quot;
  [message-payload]
  &quot;&quot;&quot;
Then <span class="error">&lt;</span>[endpoint-name]<span class="error">&gt;</span> should receive (message-type)
  &quot;&quot;&quot;
  [message-payload]
  &quot;&quot;&quot;

When <span class="error">&lt;</span>[endpoint-name]<span class="error">&gt;</span> receives (message-type) &quot;[message-payload]&quot;
Then <span class="error">&lt;</span>[endpoint-name]<span class="error">&gt;</span> should send &quot;[message-payload]&quot;

When <span class="error">&lt;</span>[endpoint-name]<span class="error">&gt;</span> receives (message-type)
  &quot;&quot;&quot;
  [message-payload]
  &quot;&quot;&quot;
Then <span class="error">&lt;</span>[endpoint-name]<span class="error">&gt;</span> should send
  &quot;&quot;&quot;
  [message-payload]
  &quot;&quot;&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once again it should be said that the step definitions included in this package are loaded automatically as glue code. So you can start to write feature stories in Gherkin syntax that trigger the predefined steps.</p>
</div>
<div class="paragraph">
<p>There are several default step definitions for different aspects of integration testing. Please see the following packages that define default steps in Citrus:</p>
</div>
<div class="ulist">
<div class="title">Test designer packages</div>
<ul>
<li>
<p>com.consol.citrus.cucumber.step.designer.core</p>
</li>
<li>
<p>com.consol.citrus.cucumber.step.designer.http</p>
</li>
<li>
<p>com.consol.citrus.cucumber.step.designer.docker</p>
</li>
<li>
<p>com.consol.citrus.cucumber.step.designer.selenium</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Test runner packages</div>
<ul>
<li>
<p>com.consol.citrus.cucumber.step.runner.core</p>
</li>
<li>
<p>com.consol.citrus.cucumber.step.runner.http</p>
</li>
<li>
<p>com.consol.citrus.cucumber.step.runner.docker</p>
</li>
<li>
<p>com.consol.citrus.cucumber.step.runner.selenium</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the following sections we have a closer look at all predefined Citrus steps and how they work.</p>
</div>
</div>
<div class="sect2">
<h3 id="variable-steps"><a class="anchor" href="#variable-steps"></a><a class="link" href="#variable-steps">33.5. Variable steps</a></h3>
<div class="paragraph">
<p>As you already know Citrus is able to work with test variables that hold important information during a test such as identifiers and dynamic values. The predefined step definitions in Citrus are able to create new test variables.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Given variable messageText is &quot;Hello&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The syntax of this predefined step is pretty self describing. The step instruction follows the pattern:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Given variable [name] is &quot;[value]&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you keep this syntax in your feature story the predefined step is activated for creating a new variable. We always use the <strong>Given</strong> step to create new variables.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Scenario: Create Variables
    Given variable messageText is &quot;Hello&quot;
      And variable operationHeader is &quot;sayHello&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>So we can use the <strong>And</strong> keyword to create more than one variable. Even more comfortable is the usage of data tables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Given variables
    | hello   | I say hello   |
    | goodbye | I say goodbye |</code></pre>
</div>
</div>
<div class="paragraph">
<p>This data table will create the test variable for each row. This is how you can easily create new variables in your Citrus test. As usual the variables are referenced in message payloads and headers as placeholders for dynamically adding content.</p>
</div>
<div class="paragraph">
<p>Adding variables is usually done within a <strong>Scenario</strong> block in your feature story. This means that the test variable is used in this scenario which is exactly one Citrus test case. Cucumber BDD also defines a <strong>Background</strong> block at the very beginning of your <strong>Feature</strong> . We can also place variables in here. This means that Cucumber will execute these steps for all upcoming scenarios. The test variable is so to speak global for this feature story.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Feature: Variables

    Background:
      Given variable messageText is &quot;Hello&quot;

    Scenario: Do something
    Scenario: Do something else</code></pre>
</div>
</div>
<div class="paragraph">
<p>That completes the variable step definitions in Citrus.</p>
</div>
</div>
<div class="sect2">
<h3 id="messaging-steps"><a class="anchor" href="#messaging-steps"></a><a class="link" href="#messaging-steps">33.6. Messaging steps</a></h3>
<div class="paragraph">
<p>In the previous section we have learned how to use a first predefined Citrus step. Now we want to cover messaging steps for sending and receiving messages in Citrus. As usual with predefined steps you do not need to write any glue code for the steps to take action. The steps are already included in Citrus just use them in your feature stories.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Feature: Messaging features

    Background:
      Given variable messageText is &quot;Hello&quot;

    Scenario: Send and receive plaintext
      When <span class="tag">&lt;echoEndpoint&gt;</span> sends &quot;${messageText}&quot;
      Then <span class="tag">&lt;echoEndpoint&gt;</span> should receive plaintext &quot;You just said: ${messageText}&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course we need to follow the predefined syntax when writing feature stories in order to trigger a predefined step. Let&#8217;s have a closer look at this predefined syntax by further describing the above example.</p>
</div>
<div class="paragraph">
<p>First of all we define a new test variable with <strong>Given variable messageText is "Hello"</strong> . This tells Citrus to create a new test variable named <strong>messageText</strong> with respective value. We can do the same for sending and receiving messages like done in our test scenario:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">When <span class="error">&lt;</span>[endpoint-name]<span class="error">&gt;</span> sends &quot;[message-payload]&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step definition requires the endpoint component name and a message payload. The predefined step will automatically configure a send test action in the Citrus test as result.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Then <span class="error">&lt;</span>[endpoint-name]<span class="error">&gt;</span> should receive (message-type) &quot;[message-payload]&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The predefined receive step also requires the <strong>endpoint-name</strong> and <strong>message-payload</strong> . As optional parameter you can define the <strong>message-type</strong> . This is required when sending message payloads other than XML.</p>
</div>
<div class="paragraph">
<p>This way you can write Citrus tests with just writing feature stories in Gherkin syntax. Up to now we have used pretty simple message payloads in on single line. Of course we can also use multiline payloads in the stories:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Feature: Messaging features

    Background:
      Given variable messageText is &quot;Hello&quot;

    Scenario: Send and receive
      When <span class="tag">&lt;echoEndpoint&gt;</span> sends
        &quot;&quot;&quot;
        <span class="tag">&lt;message&gt;</span>
          <span class="tag">&lt;text&gt;</span>${messageText}<span class="tag">&lt;/text&gt;</span>
        <span class="tag">&lt;/message&gt;</span>
        &quot;&quot;&quot;
      Then <span class="tag">&lt;echoEndpoint&gt;</span> should receive
        &quot;&quot;&quot;
        <span class="tag">&lt;message&gt;</span>
          <span class="tag">&lt;text&gt;</span>${messageText}<span class="tag">&lt;/text&gt;</span>
        <span class="tag">&lt;/message&gt;</span>
        &quot;&quot;&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see we are able to use the send and receive steps with multiline XML message payload data.</p>
</div>
</div>
<div class="sect2">
<h3 id="named-messages"><a class="anchor" href="#named-messages"></a><a class="link" href="#named-messages">33.7. Named messages</a></h3>
<div class="paragraph">
<p>In the previous section we have learned how to use Citrus predefined step definitions for send and receive operations. The message payload has been added directly to the stories so far. But what is with message header information? We want to specify a complete message with payload and header. You can do this by defining a named message.</p>
</div>
<div class="paragraph">
<p>As usual we demonstrate this in a first example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Feature: Named message feature

    Background:
      Given message echoRequest
        And <span class="tag">&lt;echoRequest&gt;</span> payload is &quot;Hi my name is Citrus!&quot;
        And <span class="tag">&lt;echoRequest&gt;</span> header operation is &quot;sayHello&quot;

      Given message echoResponse
        And <span class="tag">&lt;echoResponse&gt;</span> payload is &quot;Hi, Citrus how are you doing today?&quot;
        And <span class="tag">&lt;echoResponse&gt;</span> header operation is &quot;sayHello&quot;

    Scenario: Send and receive
      When <span class="tag">&lt;echoEndpoint&gt;</span> sends message <span class="tag">&lt;echoRequest&gt;</span>
      Then <span class="tag">&lt;echoEndpoint&gt;</span> should receive message <span class="tag">&lt;echoResponse&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the <strong>Background</strong> section we introduce named messages <strong>echoRequest</strong> and <strong>echoResponse</strong> . This makes use of the new predefined step for adding named message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Given message [message-name]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the message is introduced with its name we can use the message in further configuration steps. You can add payload information and you can add multiple headers to the message. The named message then is referenced in send and receive steps as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">When <span class="error">&lt;</span>[endpoint-name]<span class="error">&gt;</span> sends message <span class="error">&lt;</span>[message-name]<span class="error">&gt;</span>
Then <span class="error">&lt;</span>[endpoint-name]<span class="error">&gt;</span> should receive message <span class="error">&lt;</span>[message-name]<span class="error">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The steps reference a message by its name <strong>echoRequest</strong> and <strong>echoResponse</strong> .</p>
</div>
<div class="paragraph">
<p>As you can see the named messages are used to define complete messages with payload and header information. Of course the named messages can be referenced in many scenarios and steps. Also with usage of test variables in payload and header you can dynamically adjust those messages in each step.</p>
</div>
</div>
<div class="sect2">
<h3 id="message-creator-steps"><a class="anchor" href="#message-creator-steps"></a><a class="link" href="#message-creator-steps">33.8. Message creator steps</a></h3>
<div class="paragraph">
<p>In the previous section we have learned how to use named messages as predefined step. The named message has been defined directly in the stories so far. The message creator concept moves this task to some Java POJO. This way you are able to construct more complicated messages for reuse in several scenarios and feature stories.</p>
</div>
<div class="paragraph">
<p>As usual we demonstrate this in a first example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Feature: Message creator features

    Background:
      Given message creator com.consol.citrus.EchoMessageCreator
      And variable messageText is &quot;Hello&quot;
      And variable operation is &quot;sayHello&quot;

    Scenario: Send and receive
      When <span class="tag">&lt;echoEndpoint&gt;</span> sends message <span class="tag">&lt;echoRequest&gt;</span>
      Then <span class="tag">&lt;echoEndpoint&gt;</span> should receive message <span class="tag">&lt;echoResponse&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the <strong>Background</strong> section we introduce a message creator <strong>EchoMessageCreator</strong> in package <strong>com.consol.citrus</strong> . This makes use of the new predefined step for adding message creators to the test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Given message creator [message-creator-name]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The message creator name must be the fully qualified Java class name with package information. Once this is done we can use named messages in the send and receive operations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">When <span class="error">&lt;</span>[endpoint-name]<span class="error">&gt;</span> sends message <span class="error">&lt;</span>[message-name]<span class="error">&gt;</span>
Then <span class="error">&lt;</span>[endpoint-name]<span class="error">&gt;</span> should receive message <span class="error">&lt;</span>[message-name]<span class="error">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The steps reference a message by its name <strong>echoRequest</strong> and <strong>echoResponse</strong> . Now lets have a look at the message creator <strong>EchoMessageCreator</strong> implementation in order to see how this correlates to a real message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">EchoMessageCreator</span> {
    <span class="annotation">@MessageCreator</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">echoRequest</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> Message createEchoRequest() {
      <span class="keyword">return</span> <span class="keyword">new</span> DefaultMessage(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">${messageText}</span><span class="delimiter">&quot;</span></span> +
          <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>)
            .setHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${operation}</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@MessageCreator</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">echoResponse</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> Message createEchoResponse() {
      <span class="keyword">return</span> <span class="keyword">new</span> DefaultMessage(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">${messageText}</span><span class="delimiter">&quot;</span></span> +
          <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>)
            .setHeader(<span class="string"><span class="delimiter">&quot;</span><span class="content">operation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">${operation}</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the message creator is a POJO Java class that defines one or more methods that are annotated with <strong>@MessageCreator</strong> annotation. The annotation requires a message name. This is how Citrus will correlate message names in feature stories to message creator methods. The message returned is the used for the send and receive operations in the test. The message creator is reusable across multiple feature stories and scenarios. In addition to that the creator is able to construct messages in a more powerful way. For instance the message payload could be loaded from file system resources.</p>
</div>
</div>
<div class="sect2">
<h3 id="echo-steps"><a class="anchor" href="#echo-steps"></a><a class="link" href="#echo-steps">33.9. Echo steps</a></h3>
<div class="paragraph">
<p>Another predefined step definition in Citrus is used to add a <strong>echo</strong> test action. You can use the following step in your feature scenarios:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Feature: Echo features

    Scenario: Echo messages
      Given variable foo is &quot;bar&quot;
      Then echo &quot;Variable foo=${foo}&quot;
      Then echo &quot;Today is citrus:currentDate()&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step definition requires following pattern:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Then echo &quot;[message]&quot;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sleep-steps"><a class="anchor" href="#sleep-steps"></a><a class="link" href="#sleep-steps">33.10. Sleep steps</a></h3>
<div class="paragraph">
<p>You can add <strong>sleep</strong> test actions to the feature scenarios:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Feature: Sleep features

      Scenario: Sleep default time
        Then sleep

      Scenario: Sleep milliseconds time
        Then sleep 200 ms</code></pre>
</div>
</div>
<div class="paragraph">
<p>The step definition requires one of the following patterns:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Then sleep
Then sleep [time] ms</code></pre>
</div>
</div>
<div class="paragraph">
<p>This adds a new sleep test action to the Citrus test.</p>
</div>
</div>
<div class="sect2">
<h3 id="http-steps"><a class="anchor" href="#http-steps"></a><a class="link" href="#http-steps">33.11. Http steps</a></h3>
<div class="paragraph">
<p>The Http steps are specially designed for Http client-server communication. You can use these steps by adding following packages as glue options in your Cucumber test:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>com.consol.citrus.cucumber.step.(designer|runner).http</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This package contains Http specific steps that enable you to send and receive messages via Http REST:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Feature: Voting Http REST API

  Background:
    Given URL: http://localhost:8080/rest/services
    Given variables
      | id      | citrus:randomUUID()  |
      | title   | Do you like Mondays? |
      | options | [ { "name": "yes", "votes": 0 }, { "name": "no", "votes": 0 } ] |
      | report  | true                 |

  Scenario: Clear voting list
    When send DELETE /voting
    Then receive status 200 OK

  Scenario: Get empty voting list
    Given Accept: application/json
    When send GET /voting
    Then Response: []
    And receive status 200 OK

  Scenario: Create voting
    Given Request:
    """
    {
      "id": "${id}",
      "title": "${title}",
      "options": ${options},
      "report": ${report}
    }
    """
    And Content-Type: application/json
    When send POST /voting
    Then receive status 200 OK

  Scenario: Get voting list
    When send GET /voting
    Then validate $.size() is 1
    Then validate $..title is ${title}
    Then validate $..report is ${report}
    And receive status 200 OK</code></pre>
</div>
</div>
<div class="paragraph">
<p>The feature scenarios use default Http steps to send requests with different methods (GET, POST, PUT, DELETE) and receive status responses (Http 200 OK). Please
explore the default step definitions in the respective package to get a detailed understanding on how to use those in your feature specification.</p>
</div>
</div>
<div class="sect2">
<h3 id="docker-steps"><a class="anchor" href="#docker-steps"></a><a class="link" href="#docker-steps">33.12. Docker steps</a></h3>
<div class="paragraph">
<p>Docker steps access containers and build images. By default the steps try to find a valida DockerClient component in the Spring application context configuration.
You can use the steps in feature specifications to manage container states.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Feature: Voting Docker infrastructure

  Scenario: Check container deployment state
    Given docker-client "dockerClient"
    Then container "voting-app" should be running
    And container "message-broker" should be running</code></pre>
</div>
</div>
<div class="paragraph">
<p>We are able to check the container state <code>running</code>. All we need is the Docker container name or id. What else can we do within the default Docker steps? We can
build new images:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Feature: Build images

  Scenario: Build voting image
    Given docker-client "dockerClient"
    When build image "voting:1.0.0" from file "scr/main/docker/Dockerfile"
    Then create container "voting-app" from "voting:1.0.0"
    And container "voting-app" should be running</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is how we can use Docker commands in Cucumber feature specifications with Citrus default step definitions. All default step definitions for Docker are located in package</p>
</div>
<div class="ulist">
<ul>
<li>
<p>com.consol.citrus.cucumber.step.(designer|runner).docker</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="selenium-steps"><a class="anchor" href="#selenium-steps"></a><a class="link" href="#selenium-steps">33.13. Selenium steps</a></h3>
<div class="paragraph">
<p>Selenium is a widely used UI automation framework where browser user interactions are simulated. We can use default Selenium steps in the feature specifications in order to
access Selenium commands in our tests.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Feature: Voting user interface

  Background:
    Given user starts browser
    And user navigates to "http://localhost:8080"

  Scenario: Welcome page
    Then page should display link with link-text="Run application"

  Scenario: Start application
    When user clicks link with link-text="Run application"
    And sleep 500 ms
    Then page should display heading with tag-name="h1" having
    | text | Voting list |

    And page should display link with link-text="No voting found"
    And page should display form with id="new-voting" having
    | tag-name  | form          |
    | attribute | method="post" |

  Scenario: Add voting
    Given user navigates to "http://localhost:8080/voting"
    When user sets text "Do you like burgers?" to input with id="title"
    And user clicks button with id="submitNew"
    And sleep 500 ms
    Then page should display element with link-text="Do you like burgers?"</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the predefined Cucumber steps for Selenium we are able to interact with the browser. For instance we can click buttons, verify page objects and
navigate to different pages.</p>
</div>
<div class="paragraph">
<p>All these Selenium steps are located in package:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>com.consol.citrus.cucumber.step.(designer|runner).selenium</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Selenium browser is automatically picked from the Spring bean application context configuration in Citrus. Here you can decide which Selenium WebDriver to use during the tests.
Also you can instantiate web page instances and call page actions and validation steps:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">VotingListPage</span> <span class="directive">implements</span> WebPage, PageValidator&lt;VotingListPage&gt; {

    <span class="annotation">@FindBy</span>(tagName = <span class="string"><span class="delimiter">&quot;</span><span class="content">h1</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> WebElement heading;

    <span class="annotation">@FindBy</span>(id = <span class="string"><span class="delimiter">&quot;</span><span class="content">new-voting</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> WebElement newVotingForm;

    <span class="comment">/**
     * Submits new voting.
     * @param title
     * @param options
     */</span>
    <span class="directive">public</span> <span class="type">void</span> submit(<span class="predefined-type">String</span> title, <span class="predefined-type">String</span> options) {
        newVotingForm.findElement(By.id(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>)).sendKeys(title);
        <span class="keyword">if</span> (StringUtils.hasText(options)) {
            newVotingForm.findElement(By.id(<span class="string"><span class="delimiter">&quot;</span><span class="content">options</span><span class="delimiter">&quot;</span></span>)).sendKeys(options.replaceAll(<span class="string"><span class="delimiter">&quot;</span><span class="content">:</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>));
        }

        newVotingForm.submit();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> validate(VotingListPage webPage, SeleniumBrowser browser, TestContext context) {
        Assert.assertEquals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Voting list</span><span class="delimiter">&quot;</span></span>, heading.getText());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This page object defines elements and actions on that page that are callable in our feature specification.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Feature: Voting pages

  Background:
    Given page "welcomePage" com.consol.citrus.demo.voting.selenium.pages.WelcomePage
    Given page "votingListPage" com.consol.citrus.demo.voting.selenium.pages.VotingListPage

  Scenario: Welcome page
    When user starts browser
    And user navigates to "http://localhost:8080"
    Then page welcomePage should validate

  Scenario: Start application
    When user navigates to "http://localhost:8080"
    And page welcomePage performs startApp
    And sleep 500 ms
    Then page votingListPage should validate

  Scenario: Add voting
    Given user navigates to "http://localhost:8080/voting"
    When page votingListPage performs submit with arguments
    | Do you like pizza? |
    And sleep 500 ms
    Then page should display element with link-text="Do you like pizza?"
    And page votingListPage should validate

  Scenario: Add voting with options
    Given user navigates to "http://localhost:8080/voting"
    When page votingListPage performs submit with arguments
      | What is your favorite color? |
      | red:green:blue |
    And sleep 500 ms
    Then page should display element with link-text="What is your favorite color?"
    And page votingListPage should validate</code></pre>
</div>
</div>
<div class="paragraph">
<p>The page objects get instantiated and dependency injection makes sure that web elements and other resources are passed to
the page object. Then action method can perform as well as validation tasks can validate the page state.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="zookeeper"><a class="anchor" href="#zookeeper"></a><a class="link" href="#zookeeper">34. Zookeeper support</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Citrus provides configuration components and test actions for interacting with Zookeeper. The Citrus Zookeeper client component executes commands like create-node, check node-exists, delete-node, get node-data or set node-data. As a user you can execute Zookeeper commands as part of a Citrus test and validate possible command results.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Zookeeper test components in Citrus are kept in a separate Maven module. If not already done so you have to include the module as Maven dependency to your project
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
      <span class="tag">&lt;groupId&gt;</span>com.consol.citrus<span class="tag">&lt;/groupId&gt;</span>
      <span class="tag">&lt;artifactId&gt;</span>citrus-zookeeper<span class="tag">&lt;/artifactId&gt;</span>
      <span class="tag">&lt;version&gt;</span>2.7.3<span class="tag">&lt;/version&gt;</span>
      <span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus provides a "citrus-zookeeper" configuration namespace and schema definition for Zookeeper related components and actions. Include this namespace into your Spring configuration in order to use the Citrus zookeeper configuration elements. The namespace URI and schema location are added to the Spring configuration XML file as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:citrus-zookeeper</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/zookeeper/config</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
      <span class="content">http://www.springframework.org/schema/beans</span>
      <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
      <span class="content">http://www.citrusframework.org/schema/zookeeper/config</span>
      <span class="content">http://www.citrusframework.org/schema/zookeeper/config/citrus-zookeeper-config.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

      [...]

      <span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After that you are able to use customized Citrus XML elements in order to define the Spring beans.</p>
</div>
<div class="sect2">
<h3 id="zookeeper-client"><a class="anchor" href="#zookeeper-client"></a><a class="link" href="#zookeeper-client">34.1. Zookeeper client</a></h3>
<div class="paragraph">
<p>Before you can interact with a Zookeeper server you have to configure the Zookeeper client. A sample configuration is provided below describing the configuration options available:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-zookeeper:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">zookeeperClient</span><span class="delimiter">&quot;</span></span>
                               <span class="attribute-name">url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:21118</span><span class="delimiter">&quot;</span></span>
                               <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2000</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is a typical client configuration for connecting to a Zookeeper server. Now you are able to execute several commands. These commands will be sent to the Zookeeper server for execution.</p>
</div>
</div>
<div class="sect2">
<h3 id="zookeeper-commands"><a class="anchor" href="#zookeeper-commands"></a><a class="link" href="#zookeeper-commands">34.2. Zookeeper commands</a></h3>
<div class="paragraph">
<p>See below all available Zookeeper commands that a Citrus client is able to execute.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">info: Retrieves the current state of the client connection
create: Creates a znode in a specified path of the ZooKeeper namespace
delete: Deletes a znode from a specified path of the ZooKeeper namespace
exists: Checks if a znode exists in the path
children: Gets a list of children of a znode
get: Gets the data associated with a znode
set: Sets/writes data into the data field of a znode</code></pre>
</div>
</div>
<div class="paragraph">
<p>Before we see some of these commands in action we have to add a new test namespace to our test case when using the XML DSL.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xmlns:zookeeper</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/zookeeper/testcase</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
      <span class="content">http://www.springframework.org/schema/beans</span>
      <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
      <span class="content">http://www.citrusframework.org/schema/zookeeper/testcase</span>
      <span class="content">http://www.citrusframework.org/schema/zookeeper/testcase/citrus-zookeeper-testcase.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

      [...]

      <span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We added the Zookeeper namespace with prefix <strong>zookeeper:</strong> so now we can start to add special test actions to the test case:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;zookeeper:create</span> <span class="attribute-name">zookeeper-client</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">zookeeperClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/${randomString}</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">acl</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OPEN_ACL_UNSAFE</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PERSISTENT</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;zookeeper:data&gt;</span>foo<span class="tag">&lt;/zookeeper:data&gt;</span>
  <span class="tag">&lt;zookeeper:expect&gt;</span>
    <span class="tag">&lt;zookeeper:result&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
        {
          &quot;responseData&quot;:{
              &quot;path&quot;:&quot;/${randomString}&quot;
          }
        }
      <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/zookeeper:result&gt;</span>
  <span class="tag">&lt;/zookeeper:expect&gt;</span>
<span class="tag">&lt;/zookeeper:create&gt;</span>

<span class="tag">&lt;zookeeper:get</span> <span class="attribute-name">zookeeper-client</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">zookeeperClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/${randomString}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;zookeeper:expect&gt;</span>
    <span class="tag">&lt;zookeeper:result&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
      {
        &quot;responseData&quot;:{
          &quot;data&quot;:&quot;foo&quot;
        }
      }
      <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/zookeeper:result&gt;</span>
  <span class="tag">&lt;/zookeeper:expect&gt;</span>
<span class="tag">&lt;/zookeeper:getData&gt;</span>

<span class="tag">&lt;zookeeper:set</span> <span class="attribute-name">zookeeper-client</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">zookeeperClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/${randomString}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;zookeeper:data&gt;</span>bar<span class="tag">&lt;/zookeeper:data&gt;</span>
<span class="tag">&lt;/zookeeper:setData&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When using the Java DSL we can directly configure the commands with a fluent API.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">@CitrusTest
public void testZookeeper() {
    variable(&quot;randomString&quot;, &quot;citrus:randomString(10)&quot;);

    zookeeper()
        .create(&quot;/${randomString}&quot;, &quot;foo&quot;)
        .acl(&quot;OPEN_ACL_UNSAFE&quot;)
        .mode(&quot;PERSISTENT&quot;)
        .validateCommandResult(new CommandResultCallback<span class="tag">&lt;ZooResponse&gt;</span>() {
            @Override
            public void doWithCommandResult(ZooResponse result, TestContext context) {
                Assert.assertEquals(result.getResponseData().get(&quot;path&quot;), context.replaceDynamicContentInString(&quot;/${randomString}&quot;));
            }
        });

    zookeeper()
        .get(&quot;/${randomString}&quot;)
        .validateCommandResult(new CommandResultCallback<span class="tag">&lt;ZooResponse&gt;</span>() {
            @Override
            public void doWithCommandResult(ZooResponse result, TestContext context) {
                Assert.assertEquals(result.getResponseData().get(&quot;version&quot;), 0);
            }
        });

    zookeeper()
        .set(&quot;/${randomString}&quot;, &quot;bar&quot;);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The examples above create a new znode in Zookeeper using a <strong>randomString</strong> as path. We can get and set the data with expecting and validating the result of the Zookeeper server. This is basically the idea of integrating Zookepper operations to a Citrus test. This opens the gate to manage Zookeeper related entities within a Citrus test. We can manipulate and validate the znodes on the Zookeeper instance.</p>
</div>
<div class="paragraph">
<p>Zookeeper keeps its nodes in a hierarchical storage. This means a znode can have children and we can add and remove those. In Citrus you can get all children of a znode and manage those within the test:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;zookeeper:create</span> <span class="attribute-name">zookeeper-client</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">zookeeperClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/${randomString}/child1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">acl</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OPEN_ACL_UNSAFE</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">EPHEMERAL</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;zookeeper:data&gt;</span><span class="tag">&lt;/zookeeper:data&gt;</span>
  <span class="tag">&lt;zookeeper:expect&gt;</span>
    <span class="tag">&lt;zookeeper:result&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
        {
          &quot;responseData&quot;:{
              &quot;path&quot;:&quot;/${randomString}/child1&quot;
          }
        }
      <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/zookeeper:result&gt;</span>
  <span class="tag">&lt;/zookeeper:expect&gt;</span>
<span class="tag">&lt;/zookeeper:create&gt;</span>

<span class="tag">&lt;zookeeper:create</span> <span class="attribute-name">zookeeper-client</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">zookeeperClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/${randomString}/child2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">acl</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OPEN_ACL_UNSAFE</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">EPHEMERAL</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;zookeeper:data&gt;</span><span class="tag">&lt;/zookeeper:data&gt;</span>
  <span class="tag">&lt;zookeeper:expect&gt;</span>
    <span class="tag">&lt;zookeeper:result&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
        {
          &quot;responseData&quot;:{
              &quot;path&quot;:&quot;/${randomString}/child2&quot;
          }
        }
      <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/zookeeper:result&gt;</span>
  <span class="tag">&lt;/zookeeper:expect&gt;</span>
<span class="tag">&lt;/zookeeper:create&gt;</span>

<span class="tag">&lt;zookeeper:children</span> <span class="attribute-name">zookeeper-client</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">zookeeperClient</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/${randomString}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;zookeeper:expect&gt;</span>
    <span class="tag">&lt;zookeeper:result&gt;</span>
      <span class="inline-delimiter">&lt;![CDATA[</span>
        {
          &quot;responseData&quot;:{
              &quot;children&quot;:[&quot;child1&quot;,&quot;child2&quot;]
          }
        }
      <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/zookeeper:result&gt;</span>
  <span class="tag">&lt;/zookeeper:expect&gt;</span>
<span class="tag">&lt;/zookeeper:children&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">zookeeper()
    .create(&quot;/${randomString}/child1&quot;, &quot;&quot;)
    .acl(&quot;OPEN_ACL_UNSAFE&quot;)
    .mode(&quot;PERSISTENT&quot;)
    .validateCommandResult(new CommandResultCallback<span class="tag">&lt;ZooResponse&gt;</span>() {
        @Override
        public void doWithCommandResult(ZooResponse result, TestContext context) {
            Assert.assertEquals(result.getResponseData().get(&quot;path&quot;), context.replaceDynamicContentInString(&quot;/${randomString}/child1&quot;));
        }
    });

zookeeper()
    .create(&quot;/${randomString}/child2&quot;, &quot;&quot;)
    .acl(&quot;OPEN_ACL_UNSAFE&quot;)
    .mode(&quot;PERSISTENT&quot;)
    .validateCommandResult(new CommandResultCallback<span class="tag">&lt;ZooResponse&gt;</span>() {
        @Override
        public void doWithCommandResult(ZooResponse result, TestContext context) {
            Assert.assertEquals(result.getResponseData().get(&quot;path&quot;), context.replaceDynamicContentInString(&quot;/${randomString}/child2&quot;));
        }
    });

zookeeper()
    .children(&quot;/${randomString}&quot;)
    .validateCommandResult(new CommandResultCallback<span class="tag">&lt;ZooResponse&gt;</span>() {
        @Override
        public void doWithCommandResult(ZooResponse result, TestContext context) {
            Assert.assertEquals(result.getResponseData().get(&quot;children&quot;).toString(), &quot;[child1, child2]&quot;);
        }
    });</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-restdocs"><a class="anchor" href="#spring-restdocs"></a><a class="link" href="#spring-restdocs">35. Spring Restdocs support</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Spring Restdocs project helps to easily generate API documentation for RESTful services. While messages are exchanged the Restdocs library generates request/response snippets and API documentation. You can add the Spring Restdocs documentation to the Citrus client components for Http <strong>and</strong> SOAP endpoints.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Spring Restdocs support components in Citrus are kept in a separate Maven module. If not already done so you have to include the module as Maven dependency to your project
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>com.consol.citrus<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>citrus-restdocs<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>2.7.3<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For easy configuration Citrus has created a separate namespace and schema definition for Spring Restdocs related documentation. Include this namespace into your Spring configuration in order to use the Citrus Restdocs configuration elements. The namespace URI and schema location are added to the Spring configuration XML file as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;spring:beans</span> <span class="attribute-name">xmlns:spring</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
     <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
     <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/cucumber/testcase</span><span class="delimiter">&quot;</span></span>
     <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
     <span class="content">http://www.springframework.org/schema/beans</span>
     <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
     <span class="content">http://www.citrusframework.org/schema/restdocs/config</span>
     <span class="content">http://www.citrusframework.org/schema/restdocs/config/citrus-restdocs-config.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    [...]

<span class="tag">&lt;/spring:beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After that you are able to use customized Citrus XML elements in order to define the Spring beans.</p>
</div>
<div class="sect2">
<h3 id="spring-restdocs-using-http"><a class="anchor" href="#spring-restdocs-using-http"></a><a class="link" href="#spring-restdocs-using-http">35.1. Spring Restdocs using Http</a></h3>
<div class="paragraph">
<p>First of all we concentrate on adding the Spring Restdocs feature to Http client communication. The next sample configuration uses the new Spring Restdocs components in Citrus:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-restdocs:documentation</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">restDocumentation</span><span class="delimiter">&quot;</span></span>
                                              <span class="attribute-name">output-directory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">target/citrus-docs/generated-snippets</span><span class="delimiter">&quot;</span></span>
                                              <span class="attribute-name">identifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest-docs/{method-name}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above component adds a new documentation configuration. Behind the scenes the component creates a new restdocs configurer and a client interceptor. We can reference the new restdocs component in <strong>citrus-http</strong> client components like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-http:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpClient</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">request-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/test</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">request-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">POST</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">interceptors</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">restDocumentation</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Spring Restdocs documentation component acts as a client interceptor. Every time the client component is used to send and receive a message the restdocs interceptor will automatically create its API documentation. The configuration <strong>identifier</strong> attribute describes the output format <strong>rest-docs/{method-name}</strong> which results in a folder layout like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">target/citrus-docs
  |- rest-docs
    |- test-a
      |- curl-request.adoc
      |- http-request.adoc
      |- http-response.adoc
    |- test-b
      |- curl-request.adoc
      |- http-request.adoc
      |- http-response.adoc
    |- test-c
      |- curl-request.adoc
      |- http-request.adoc
      |- http-response.adoc</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above is the result of three test cases each of them performing a client Http request/response communication. Each test message exchange is documented with separate files:</p>
</div>
<div class="listingblock">
<div class="title">curl-request.adoc</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ curl 'http://localhost:8080/test' -i -X POST -H 'Accept: application/xml' -H 'CustomHeaderId: 123456789' -H 'Content-Type: application/xml;charset=UTF-8' -H 'Accept-Charset: utf-8' -d '&lt;testRequestMessage&gt;
    &lt;text&gt;Hello HttpServer&gt;/text&gt;
&lt;/testRequestMessage&gt;'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The curl file represents the client request as curl command and can be seen as a sample to reproduce the request.</p>
</div>
<div class="listingblock">
<div class="title">http-request.adoc</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="http">POST /test HTTP/1.1
Accept: application/xml
CustomHeaderId: 123456789
Content-Type: application/xml;charset=UTF-8
Content-Length: 118
Accept-Charset: utf-8
Host: localhost

&lt;testRequestMessage&gt;
    &lt;text&gt;Hello HttpServer&gt;/text&gt;
&lt;/testRequestMessage&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>http-request.adoc</strong> file represents the sent message data for the client request. The respective <strong>http-response.adoc</strong> represents the response that was sent to the client.</p>
</div>
<div class="listingblock">
<div class="title">http-response.adoc</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="http">HTTP/1.1 200 OK
Date: Tue, 07 Jun 2016 12:10:46 GMT
Content-Type: application/xml;charset=UTF-8
Accept-Charset: utf-8
Content-Length: 122
Server: Jetty(9.2.15.v20160210)

&lt;testResponseMessage&gt;
    &lt;text&gt;Hello Citrus!&gt;/text&gt;
&lt;/testResponseMessage&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Nice work! We have automatically created snippets for the RESTful API by just adding the interceptor to the Citrus client component. Spring Restdocs components can be combined manually. See the next configuration that uses this approach.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-restdocs:configurer</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">restDocConfigurer</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">output-directory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">target/citrus-docs/generated-snippets</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;citrus-restdocs:client-interceptor</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">restDocClientInterceptor</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">identifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rest-docs/{method-name}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;util:list</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">restDocInterceptors</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;ref</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">restDocConfigurer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;ref</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">restDocClientInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/util:list&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-http:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpClient</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">request-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/test</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">request-method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">POST</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">interceptors</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">restDocInterceptors</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>What exactly is the difference to the <strong>citrus-restdocs:documentation</strong> that we have used before? In general there is no difference. Both configurations are identical in its outcome. Why should someone use the second approach then? It is more verbose as we need to also define a list of interceptors. The answer is easy. If you want to combine the restdocs interceptors with other client interceptors in a list then you should use the manual combination approach. We can add basic authentication interceptors for instance to the list of interceptors then. The more comfortable <strong>citrus-restdocs:documentation</strong> component only supports exclusive restdocs interceptors.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-restdocs-using-soap"><a class="anchor" href="#spring-restdocs-using-soap"></a><a class="link" href="#spring-restdocs-using-soap">35.2. Spring Restdocs using SOAP</a></h3>
<div class="paragraph">
<p>You can use the Spring Restdocs features also for SOAP clients in Citrus. This is a controversy idea as SOAP endpoints are different to RESTful concepts. But at the end SOAP Http communication is Http communication with request and response messages. Why should we miss out the fantastic documentation feature here just because of ideology reasons.</p>
</div>
<div class="paragraph">
<p>The concept of adding the Spring Restdocs documentation as interceptor to the client is still the same.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-restdocs:documentation</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapDocumentation</span><span class="delimiter">&quot;</span></span>
                                              <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soap</span><span class="delimiter">&quot;</span></span>
                                              <span class="attribute-name">output-directory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">target/citrus-docs/generated-snippets</span><span class="delimiter">&quot;</span></span>
                                              <span class="attribute-name">identifier</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soap-docs/{method-name}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We have added a <strong>type</strong> setting with value <strong>soap</strong> . And that is basically all we need to do. Now Citrus knows that we would like to add documentation for a SOAP client:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ws:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapClient</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">request-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/test</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">interceptors</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">soapDocumentation</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Following from that the <strong>soapClient</strong> is enabled to generate Spring Restdocs documentation for each request/response. The generated snippets then do represent the SOAP request and response messages.</p>
</div>
<div class="listingblock">
<div class="title">http-request.adoc</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="http">POST /test HTTP/1.1
SOAPAction: &quot;test&quot;
Accept: application/xml
CustomHeaderId: 123456789
Content-Type: application/xml;charset=UTF-8
Content-Length: 529
Accept-Charset: utf-8
Host: localhost

&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;
  &lt;SOAP-ENV:Header&gt;
    &lt;Operation xmlns=&quot;http://citrusframework.org/test&quot;&gt;sayHello&gt;/Operation&gt;
  &lt;/SOAP-ENV:Header&gt;
  &lt;SOAP-ENV:Body&gt;
    &lt;testRequestMessage&gt;
      &lt;text&gt;Hello HttpServer&gt;/text&gt;
    &lt;/testRequestMessage&gt;
  &lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">http-response.adoc</div>
<div class="content">
<pre class="CodeRay highlight nowrap"><code data-lang="http">HTTP/1.1 200 OK
Date: Tue, 07 Jun 2016 12:10:46 GMT
Content-Type: application/xml;charset=UTF-8
Accept-Charset: utf-8
Content-Length: 612
Server: Jetty(9.2.15.v20160210)

&lt;SOAP-ENV:Envelope xmlns:SOAP-ENV=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot;&gt;
  &lt;SOAP-ENV:Header&gt;
    &gt;Operation xmlns=&quot;http://citrusframework.org/test&quot;&gt;sayHello&gt;/Operation&gt;
  &lt;/SOAP-ENV:Header&gt;
  &lt;SOAP-ENV:Body&gt;
    &lt;testResponseMessage&gt;
      &lt;text&gt;Hello Citrus!&gt;/text&gt;
    &lt;/testResponseMessage&gt;
  &lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The file names are still using <strong>http-request</strong> and <strong>http-response</strong> but the content is clearly the SOAP request/response message data.</p>
</div>
</div>
<div class="sect2">
<h3 id="spring-restdocs-in-java-dsl"><a class="anchor" href="#spring-restdocs-in-java-dsl"></a><a class="link" href="#spring-restdocs-in-java-dsl">35.3. Spring Restdocs in Java DSL</a></h3>
<div class="paragraph">
<p>How can we use Spring Restdocs in Java DSL? Of course we have special support in Citrus Java DSL for the Spring Restdocs configuration, too.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">RestDocConfigurationIT</span> <span class="directive">extends</span> TestNGCitrusTestDesigner {

    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> TestListeners testListeners;

    <span class="directive">private</span> HttpClient httpClient;

    <span class="annotation">@BeforeClass</span>
    <span class="directive">public</span> <span class="type">void</span> setup() {
        CitrusRestDocConfigurer restDocConfigurer = CitrusRestDocsSupport.restDocsConfigurer(<span class="keyword">new</span> ManualRestDocumentation(<span class="string"><span class="delimiter">&quot;</span><span class="content">target/generated-snippets</span><span class="delimiter">&quot;</span></span>));
        RestDocClientInterceptor restDocInterceptor = CitrusRestDocsSupport.restDocsInterceptor(<span class="string"><span class="delimiter">&quot;</span><span class="content">rest-docs/{method-name}</span><span class="delimiter">&quot;</span></span>);

        httpClient = CitrusEndpoints.http()
            .client()
            .requestUrl(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8073/test</span><span class="delimiter">&quot;</span></span>)
            .requestMethod(HttpMethod.POST)
            .contentType(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/xml</span><span class="delimiter">&quot;</span></span>)
            .interceptors(<span class="predefined-type">Arrays</span>.asList(restDocConfigurer, restDocInterceptor))
            .build();

        testListeners.addTestListener(restDocConfigurer);
    }

    <span class="annotation">@Test</span>
    <span class="annotation">@CitrusTest</span>
    <span class="directive">public</span> <span class="type">void</span> testRestDocs() {
        http().client(httpClient)
            .send()
            .post()
            .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;testRequestMessage&gt;</span><span class="delimiter">&quot;</span></span> +
                      <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;text&gt;Hello HttpServer&lt;/text&gt;</span><span class="delimiter">&quot;</span></span> +
                  <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/testRequestMessage&gt;</span><span class="delimiter">&quot;</span></span>);

        http().client(httpClient)
            .receive()
            .response(HttpStatus.OK)
            .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;testResponseMessage&gt;</span><span class="delimiter">&quot;</span></span> +
                      <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;text&gt;Hello TestFramework&lt;/text&gt;</span><span class="delimiter">&quot;</span></span> +
                  <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;/testResponseMessage&gt;</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The mechanism is quite similar to the XML configuration. We add the Restdocs configurer and interceptor to the list of interceptors for the Http client. If we do this all client communication is automatically documented. The Citrus Java DSL provides some convenient configuration methods in class <strong>CitrusRestDocsSupport</strong> for creating the configurer and interceptor objects.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The configurer must be added to the list of test listeners. This is a mandatory step in order to enable the configurer for documentation preparations before each test. Otherwise we would not be able to generate proper documentation. If you are using the XML configuration this is done automatically for you.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="selenium"><a class="anchor" href="#selenium"></a><a class="link" href="#selenium">36. Selenium support</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://www.seleniumhq.org/">Selenium</a> is a very popular tool for testing user interfaces with browser automation. Citrus is able to integrate with the Selenium Java API in order to execute Selenium commands.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Selenium test components in Citrus are kept in a separate Maven module. If not already done so you have to include the module as Maven dependency to your project
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>com.consol.citrus<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>citrus-selenium<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>2.7.3<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus provides a "citrus-selenium" configuration namespace and schema definition for Selenium related components and actions. Include this namespace into your Spring configuration in order to use the Citrus Selenium configuration elements. The namespace URI and schema location are added to the Spring configuration XML file as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:citrus-selenium</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/selenium/config</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
       <span class="content">http://www.springframework.org/schema/beans</span>
       <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
       <span class="content">http://www.citrusframework.org/schema/selenium/config</span>
       <span class="content">http://www.citrusframework.org/schema/selenium/config/citrus-selenium-config.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    [...]

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After that you are able to use customized Citrus XML elements in order to define the Spring beans.</p>
</div>
<div class="sect2">
<h3 id="selenium-browser"><a class="anchor" href="#selenium-browser"></a><a class="link" href="#selenium-browser">36.1. Selenium browser</a></h3>
<div class="paragraph">
<p>Selenium uses browser automation in order to simulate the user interact with web applications. You can configure the Selenium browser and web driver as Spring bean.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-selenium:browser</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">seleniumBrowser</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">firefox</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">start-page</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrusframework.org</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Selenium browser component supports different browser types for the commonly used browsers out in the wild.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>htmlunit</strong></p>
</li>
<li>
<p><strong>firefox</strong></p>
</li>
<li>
<p><strong>safari</strong></p>
</li>
<li>
<p><strong>chrome</strong></p>
</li>
<li>
<p><strong>googlechrome</strong></p>
</li>
<li>
<p><strong>internet explorer</strong></p>
</li>
<li>
<p><strong>edge</strong></p>
</li>
<li>
<p><strong>custom</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Html unit is the default browser type and represents a headless browser that executed without displaying the graphical user interface. In case you need a totally different browser or
you need to customize the Selenium web driver you can use the <em>browserType="custom"</em> in combination with a web driver reference:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-selenium:browser</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mySeleniumBrowser</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">custom</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">web-driver</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">operaWebDriver</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">operaWebDriver</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.openqa.selenium.opera.OperaDriver</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now Citrus is using the customized Selenium web driver implementation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When using Firefox as browser you may also want to set the optional properties <strong>firefox-profile</strong> and <strong>version</strong>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-selenium:browser</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mySeleniumBrowser</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">firefox</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">firefox-profile</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">firefoxProfile</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FIREFOX_38</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">start-page</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrusframework.org</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">firefoxProfile</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.openqa.selenium.firefox.FirefoxProfile</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now Citrus is able to execute Selenium operations as a user.</p>
</div>
</div>
<div class="sect2">
<h3 id="selenium-actions"><a class="anchor" href="#selenium-actions"></a><a class="link" href="#selenium-actions">36.2. Selenium actions</a></h3>
<div class="paragraph">
<p>We have several Citrus test actions each representing a Selenium command. These actions can be part of a Citrus test case. As a prerequisite we have to enable the Selenium specific test actions in our XML test as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:selenium</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/selenium/testcase</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
        <span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content">http://www.citrusframework.org/schema/selenium/testcase</span>
        <span class="content">http://www.citrusframework.org/schema/selenium/testcase/citrus-selenium-testcase.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    [...]

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We added a special selenium namespace with prefix <strong>selenium:</strong> so now we can start to add Selenium test actions to the test case:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SeleniumCommandIT</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
      <span class="tag">&lt;selenium:start</span> <span class="attribute-name">browser</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">webBrowser</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

      <span class="tag">&lt;selenium:navigate</span> <span class="attribute-name">page</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

      <span class="tag">&lt;selenium:find&gt;</span>
        <span class="tag">&lt;selenium:element</span> <span class="attribute-name">tag-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">h1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Welcome!</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;selenium:styles&gt;</span>
            <span class="tag">&lt;selenium:style</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">font-size</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">40px</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;/selenium:styles&gt;</span>
        <span class="tag">&lt;/selenium:element&gt;</span>
      <span class="tag">&lt;/selenium:find&gt;</span>

      <span class="tag">&lt;selenium:click&gt;</span>
        <span class="tag">&lt;selenium:element</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ok-button</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/selenium:click&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this very simple example we first start the Selenium browser instance. After that we can continue to use Selenium commands without browser attribute explicitly set. Citrus
knows which browser instance is currently active and will automatically use this opened browser instance. Next in this example we find some element on the displayed page by its
tag-name and text. We also validate the element style <em>font-size</em> to meet the expected value <em>40px</em> in this step.</p>
</div>
<div class="paragraph">
<p>In addition to that the example performs a click operation on the element with the id <em>ok-button</em>. Selenium supports element find operations on different properties:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
id
</td>
<td class="hdlist2">
<p>finds element based on the <em>id</em> attribute</p>
</td>
</tr>
<tr>
<td class="hdlist1">
name
</td>
<td class="hdlist2">
<p>finds element based on the <em>name</em> attribute</p>
</td>
</tr>
<tr>
<td class="hdlist1">
tag-name
</td>
<td class="hdlist2">
<p>finds element based on the <em>tag name</em></p>
</td>
</tr>
<tr>
<td class="hdlist1">
class-name
</td>
<td class="hdlist2">
<p>finds element based on the css <em>class name</em></p>
</td>
</tr>
<tr>
<td class="hdlist1">
link-text
</td>
<td class="hdlist2">
<p>finds link element based on the <em>link-text</em></p>
</td>
</tr>
<tr>
<td class="hdlist1">
xpath
</td>
<td class="hdlist2">
<p>finds element based on XPath evaluation in the DOM</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Based on that we can execute several Selenium commands in a test case and validate the results such as web elements. Citrus supports the following Selenium commands with respective test actions:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
selenium:start
</td>
<td class="hdlist2">
<p>Start the browser instance</p>
</td>
</tr>
<tr>
<td class="hdlist1">
selenium:find
</td>
<td class="hdlist2">
<p>Finds element on current page and validates element properties</p>
</td>
</tr>
<tr>
<td class="hdlist1">
selenium:click
</td>
<td class="hdlist2">
<p>Performs click operation on element</p>
</td>
</tr>
<tr>
<td class="hdlist1">
selenium:hover
</td>
<td class="hdlist2">
<p>Performs hover operation on element</p>
</td>
</tr>
<tr>
<td class="hdlist1">
selenium:navigate
</td>
<td class="hdlist2">
<p>Navigates to new page url (including history back, forward and refresh)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
selenium:set-input
</td>
<td class="hdlist2">
<p>Finds input element and sets value</p>
</td>
</tr>
<tr>
<td class="hdlist1">
selenium:check-input
</td>
<td class="hdlist2">
<p>Finds checkbox element and sets/unsets value</p>
</td>
</tr>
<tr>
<td class="hdlist1">
selenium:dropdown-select
</td>
<td class="hdlist2">
<p>Finds dropdown element and selects single or multiple value/s</p>
</td>
</tr>
<tr>
<td class="hdlist1">
selenium:page
</td>
<td class="hdlist2">
<p>Instantiate page object with dependency injection and execute page action with verification</p>
</td>
</tr>
<tr>
<td class="hdlist1">
selenium:open
</td>
<td class="hdlist2">
<p>Open new window</p>
</td>
</tr>
<tr>
<td class="hdlist1">
selenium:close
</td>
<td class="hdlist2">
<p>Close window by given name</p>
</td>
</tr>
<tr>
<td class="hdlist1">
selenium:switch
</td>
<td class="hdlist2">
<p>Switch focus to window with given name</p>
</td>
</tr>
<tr>
<td class="hdlist1">
selenium:wait-until
</td>
<td class="hdlist2">
<p>Wait for element to be <em>hidden</em> or <em>visible</em></p>
</td>
</tr>
<tr>
<td class="hdlist1">
selenium:alert
</td>
<td class="hdlist2">
<p>Access current alert dialog (with action <em>access</em> or <em>dismiss</em>)</p>
</td>
</tr>
<tr>
<td class="hdlist1">
selenium:screenshot
</td>
<td class="hdlist2">
<p>Makes screenshot of current page</p>
</td>
</tr>
<tr>
<td class="hdlist1">
selenium:store-file
</td>
<td class="hdlist2">
<p>Store file to temporary browser directory</p>
</td>
</tr>
<tr>
<td class="hdlist1">
selenium:get-stored-file
</td>
<td class="hdlist2">
<p>Gets stored file from temporary browser directory</p>
</td>
</tr>
<tr>
<td class="hdlist1">
selenium:javascript
</td>
<td class="hdlist2">
<p>Execute Javascript code in browser</p>
</td>
</tr>
<tr>
<td class="hdlist1">
selenium:clear-cache
</td>
<td class="hdlist2">
<p>Clear browser cache and all cookies</p>
</td>
</tr>
<tr>
<td class="hdlist1">
selenium:stop
</td>
<td class="hdlist2">
<p>Stops the browser instance</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Up to now we have only used the Citrus XML DSL. Of course all Selenium commands are also available in Java DSL as the next example shows.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="directive">private</span> SeleniumBrowser seleniumBrowser;

<span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> seleniumTest() {
    selenium().start(seleniumBrowser);

    selenium().navigate(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080</span><span class="delimiter">&quot;</span></span>);

    selenium().find().element(By.id(<span class="string"><span class="delimiter">&quot;</span><span class="content">header</span><span class="delimiter">&quot;</span></span>));
                .tagName(<span class="string"><span class="delimiter">&quot;</span><span class="content">h1</span><span class="delimiter">&quot;</span></span>)
                .enabled(<span class="predefined-constant">true</span>)
                .displayed(<span class="predefined-constant">true</span>)
                .text(<span class="string"><span class="delimiter">&quot;</span><span class="content">Welcome!</span><span class="delimiter">&quot;</span></span>)
                .style(<span class="string"><span class="delimiter">&quot;</span><span class="content">font-size</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">40px</span><span class="delimiter">&quot;</span></span>);

    selenium().click().element(By.linkText(<span class="string"><span class="delimiter">&quot;</span><span class="content">Click Me!</span><span class="delimiter">&quot;</span></span>));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now lets have a closer look at the different Selenium test actions supported in Citrus.</p>
</div>
</div>
<div class="sect2">
<h3 id="start-stop-browser"><a class="anchor" href="#start-stop-browser"></a><a class="link" href="#start-stop-browser">36.3. Start/stop browser</a></h3>
<div class="paragraph">
<p>You can start and stop the browser instance with a test action. This instantiates a new browser window and prepares everything for interacting with the web
interface.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;selenium:start</span> <span class="attribute-name">browser</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">seleniumBrowser</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="comment">&lt;!-- Do something in browser --&gt;</span>

<span class="tag">&lt;selenium:stop</span> <span class="attribute-name">browser</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">seleniumBrowser</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">selenium().start(seleniumBrowser);

<span class="comment">// do something in browser</span>

selenium().stop(seleniumBrowser);</code></pre>
</div>
</div>
<div class="paragraph">
<p>After starting a browser instance Citrus will automatically use this very same browser instance in all further Selenium actions. This mechanism is based on a test variable (<strong>selenium_browser</strong>) that
is automatically set. All other test actions are able to load the current browser instance by reading this test variable before execution. In case you need to explicitly use
a different browser instance than the active instance you can add the <strong>browser</strong> attribute to all Selenium test actions.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is a good idea to start and stop the browser instance before each test case. This makes sure that tests are also executable in single run and it always sets up a new browser instance so tests
will not influence each other.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="find"><a class="anchor" href="#find"></a><a class="link" href="#find">36.4. Find</a></h3>
<div class="paragraph">
<p>The find element test action searches for an element on the current page. The element is specified by one of the following settings:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
id
</td>
<td class="hdlist2">
<p>finds element based on the <em>id</em> attribute</p>
</td>
</tr>
<tr>
<td class="hdlist1">
name
</td>
<td class="hdlist2">
<p>finds element based on the <em>name</em> attribute</p>
</td>
</tr>
<tr>
<td class="hdlist1">
tag-name
</td>
<td class="hdlist2">
<p>finds element based on the <em>tag name</em></p>
</td>
</tr>
<tr>
<td class="hdlist1">
class-name
</td>
<td class="hdlist2">
<p>finds element based on the css <em>class name</em></p>
</td>
</tr>
<tr>
<td class="hdlist1">
link-text
</td>
<td class="hdlist2">
<p>finds link element based on the <em>link-text</em></p>
</td>
</tr>
<tr>
<td class="hdlist1">
xpath
</td>
<td class="hdlist2">
<p>finds element based on XPath evaluation in the DOM</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The find element action will automatically fail in case there is no such element on the current page. In case the element is found you can add additional attributes and properties
for further element validation:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;selenium:find&gt;</span>
  <span class="tag">&lt;selenium:element</span> <span class="attribute-name">tag-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">h1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Welcome!</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;selenium:styles&gt;</span>
      <span class="tag">&lt;selenium:style</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">font-size</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">40px</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/selenium:styles&gt;</span>
  <span class="tag">&lt;/selenium:element&gt;</span>
<span class="tag">&lt;/selenium:find&gt;</span>

<span class="tag">&lt;selenium:find&gt;</span>
  <span class="tag">&lt;selenium:element</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ok-button</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Ok</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">displayed</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;selenium:attributes&gt;</span>
      <span class="tag">&lt;selenium:attribute</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/selenium:attributes&gt;</span>
  <span class="tag">&lt;/selenium:element&gt;</span>
<span class="tag">&lt;/selenium:find&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">selenium().find().element(By.tagName(<span class="string"><span class="delimiter">&quot;</span><span class="content">h1</span><span class="delimiter">&quot;</span></span>))
        .text(<span class="string"><span class="delimiter">&quot;</span><span class="content">Welcome!</span><span class="delimiter">&quot;</span></span>)
        .style(<span class="string"><span class="delimiter">&quot;</span><span class="content">font-size</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">40px</span><span class="delimiter">&quot;</span></span>);

selenium().find().element(By.id(<span class="string"><span class="delimiter">&quot;</span><span class="content">ok-button</span><span class="delimiter">&quot;</span></span>))
        .tagName(<span class="string"><span class="delimiter">&quot;</span><span class="content">button</span><span class="delimiter">&quot;</span></span>)
        .enabled(<span class="predefined-constant">true</span>)
        .displayed(<span class="predefined-constant">true</span>)
        .text(<span class="string"><span class="delimiter">&quot;</span><span class="content">Ok</span><span class="delimiter">&quot;</span></span>)
        .style(<span class="string"><span class="delimiter">&quot;</span><span class="content">color</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">red</span><span class="delimiter">&quot;</span></span>)
        .attribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above finds the <strong>h1</strong> element by its tag name and validates the text and css style attributes. Secondly the <strong>ok-button</strong> is validated with expected
enabled, displayed, text, style and attribute values. The elements must be present on the current page and all expected element properties have to match. Otherwise the test action and the test case
is failing with validation errors.</p>
</div>
</div>
<div class="sect2">
<h3 id="click"><a class="anchor" href="#click"></a><a class="link" href="#click">36.5. Click</a></h3>
<div class="paragraph">
<p>The action performs a click operation on the element.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;selenium:click&gt;</span>
  <span class="tag">&lt;selenium:element</span> <span class="attribute-name">link-text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Click Me!</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/selenium:click&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">selenium().click().element(By.linkText(<span class="string"><span class="delimiter">&quot;</span><span class="content">Click Me!</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="hover"><a class="anchor" href="#hover"></a><a class="link" href="#hover">36.6. Hover</a></h3>
<div class="paragraph">
<p>The action performs a hover operation on the element.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;selenium:hover&gt;</span>
  <span class="tag">&lt;selenium:element</span> <span class="attribute-name">link-text</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Find Me!</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/selenium:hover&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">selenium().hover().element(By.linkText(<span class="string"><span class="delimiter">&quot;</span><span class="content">Find Me!</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="form-input-actions"><a class="anchor" href="#form-input-actions"></a><a class="link" href="#form-input-actions">36.7. Form input actions</a></h3>
<div class="paragraph">
<p>The following actions are used to access form input elements such as text fields, checkboxes and dropdown lists.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;selenium:set-input</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Citrus</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;selenium:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/selenium:set-input&gt;</span>

<span class="tag">&lt;selenium:check-input</span> <span class="attribute-name">checked</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;selenium:element</span> <span class="attribute-name">xpath</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//input[@type='checkbox']</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/selenium:check-input&gt;</span>

<span class="tag">&lt;selenium:dropdown-select</span> <span class="attribute-name">option</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">happy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;selenium:element</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">user-mood</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/selenium:dropdown-select&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">selenium().setInput(<span class="string"><span class="delimiter">&quot;</span><span class="content">Citrus</span><span class="delimiter">&quot;</span></span>).element(By.name(<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>));
selenium().checkInput(<span class="predefined-constant">true</span>).element(By.xpath(<span class="string"><span class="delimiter">&quot;</span><span class="content">//input[@type='checkbox']</span><span class="delimiter">&quot;</span></span>));

selenium().select(<span class="string"><span class="delimiter">&quot;</span><span class="content">happy</span><span class="delimiter">&quot;</span></span>).element(By.id(<span class="string"><span class="delimiter">&quot;</span><span class="content">user-mood</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The actions above select dropdown options and set user input on text fields and checkboxes. As usual the form elements are selected by some properties such as
ids, names or xpath expressions.</p>
</div>
</div>
<div class="sect2">
<h3 id="page-actions"><a class="anchor" href="#page-actions"></a><a class="link" href="#page-actions">36.8. Page actions</a></h3>
<div class="paragraph">
<p>Page objects are a well known pattern when using Selenium. The page objects define elements that the page is working with. In addition to that the
page objects define actions that can be executed from outside. This object oriented approach for accessing pages and their elements is a very good idea.
Lets have a look at a sample page object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">UserFormPage</span> <span class="directive">implements</span> WebPage {

    <span class="annotation">@FindBy</span>(id = <span class="string"><span class="delimiter">&quot;</span><span class="content">userForm</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> WebElement form;

    <span class="annotation">@FindBy</span>(id = <span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> WebElement userName;

    <span class="comment">/**
     * Sets the user name.
     */</span>
    <span class="directive">public</span> <span class="type">void</span> setUserName(<span class="predefined-type">String</span> value, TestContext context) {
        userName.clear();
        userName.sendKeys(value);
    }

    <span class="comment">/**
     * Submits the form.
     * @param context
     */</span>
    <span class="directive">public</span> <span class="type">void</span> submit(TestContext context) {
        form.submit();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the page object is a Java POJO that implements the <strong>WebPage</strong> interface. The page defines <strong>WebElement</strong> members. These are automatically
injected by Citrus and Selenium based on the <strong>FindBy</strong> annotation. Now the test case is able to load that page object and execute some action methods on the page such as
<em>setUserName</em> or <em>submit</em>.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;selenium:page</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.selenium.pages.UserFormPage</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">setUserName</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;selenium:arguments&gt;</span>
    <span class="tag">&lt;selenium:argument&gt;</span>Citrus<span class="tag">&lt;/selenium:argument&gt;</span>
  <span class="tag">&lt;/selenium:arguments&gt;</span>
<span class="tag">&lt;/selenium:page&gt;</span>

<span class="tag">&lt;selenium:page</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.selenium.pages.UserFormPage</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">selenium().page(UserFormPage.class).argument(<span class="string"><span class="delimiter">&quot;</span><span class="content">Citrus</span><span class="delimiter">&quot;</span></span>).execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">setUserName</span><span class="delimiter">&quot;</span></span>);

selenium().page(UserFormPage.class).execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The page object class is automatically loaded and instantiated with dependency injection for all <em>FindBy</em> annotated web elements. After that the action method is executed.
The action methods can also have method parameters as seen in <em>setUserName</em>. The value parameter is automatically set when calling the method.</p>
</div>
<div class="paragraph">
<p>Methods can also use the optional parameter <em>TestContext</em>. With this context you can access the current test context with all test variables for instance. This method parameter
should always be the last parameter.</p>
</div>
</div>
<div class="sect2">
<h3 id="page-validation"><a class="anchor" href="#page-validation"></a><a class="link" href="#page-validation">36.9. Page validation</a></h3>
<div class="paragraph">
<p>We can also use page object for validation purpose. The page object is loaded and instantiated as described in previous section. Then the page validator
is called. The validator performs assertions and validation operations with the page object. Lets see a sample page validator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">UserFormValidator</span> <span class="directive">implements</span> PageValidator&lt;UserFormPage&gt; {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> validate(UserFormPage webPage, SeleniumBrowser browser, TestContext context) {
        Assert.isTrue(webPage.getUserName() != <span class="predefined-constant">null</span>);
        Assert.isTrue(StringUtils.hasText(webPage.getUserName().getAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>)));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The page validator is called with the web page instance, the browser and the test context. The validator should assert page objects and web elements for
validation purpose. In a test case we can call the validator to validate the page.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span> =<span class="string"><span class="delimiter">&quot;</span><span class="content">userFormValidator</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.selenium.pages.UserFormValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;selenium:page</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.selenium.pages.UserFormPage</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">validate</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">validator</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">userFormValidator</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Autowired</span>
<span class="directive">private</span> UserFormValidator userFormValidator;

selenium().page(UserFormPage.class).execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">validate</span><span class="delimiter">&quot;</span></span>).validator(userFormValidator);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of using a separate validator class you can also put the validation method to the page object itself. Then page object and validation is
done within the same class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">UserFormPage</span> <span class="directive">implements</span> WebPage, PageValidator&lt;UserFormPage&gt; {

    <span class="annotation">@FindBy</span>(id = <span class="string"><span class="delimiter">&quot;</span><span class="content">userForm</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> WebElement form;

    <span class="annotation">@FindBy</span>(id = <span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">private</span> WebElement userName;

    <span class="comment">/**
     * Sets the user name.
     */</span>
    <span class="directive">public</span> <span class="type">void</span> setUserName(<span class="predefined-type">String</span> value, TestContext context) {
        userName.clear();
        userName.sendKeys(value);
    }

    <span class="comment">/**
     * Submits the form.
     * @param context
     */</span>
    <span class="directive">public</span> <span class="type">void</span> submit(TestContext context) {
        form.submit();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> validate(UserFormPage webPage, SeleniumBrowser browser, TestContext context) {
        Assert.isTrue(userName != <span class="predefined-constant">null</span>);
        Assert.isTrue(StringUtils.hasText(userName.getAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>)));
        Assert.isTrue(form != <span class="predefined-constant">null</span>);
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;selenium:page</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.selenium.pages.UserFormPage</span><span class="delimiter">&quot;</span></span>
               <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">validate</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">selenium().page(UserFormPage.class).execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">validate</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="wait"><a class="anchor" href="#wait"></a><a class="link" href="#wait">36.10. Wait</a></h3>
<div class="paragraph">
<p>Sometimes it is required to wait for an element to appear or disappear on the current page. The wait action will wait a given time for the element status
to be <em>visible</em> or <em>hidden</em>.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;selenium:wait</span> <span class="attribute-name">until</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;selenium:element</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">info-dialog</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/selenium:wait&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">selenium().waitUntil().hidden().element(By.id(<span class="string"><span class="delimiter">&quot;</span><span class="content">info-dialog</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example waits for the element <em>info-dialog</em> to disappear. The time to wait is 5000 milliseconds by default. You can set the timeout on the action. Due
to Selenium limitations the minimum wait time is 1000 milliseconds.</p>
</div>
</div>
<div class="sect2">
<h3 id="navigate"><a class="anchor" href="#navigate"></a><a class="link" href="#navigate">36.11. Navigate</a></h3>
<div class="paragraph">
<p>The action navigates to a new page either by using a new relative path or a complete new Http URL.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;selenium:navigate</span> <span class="attribute-name">page</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;selenium:navigate</span> <span class="attribute-name">page</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">help</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">selenium().navigate(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080</span><span class="delimiter">&quot;</span></span>);

selenium().navigate(<span class="string"><span class="delimiter">&quot;</span><span class="content">help</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The sample above describes a new page with new Http URL. The browser will navigate to this new page. All further Selenium actions are performed on this new
page. The second navigation action opens the relative page <em>help</em> so the new page URL is <code><a href="http://localhost:8080/help" class="bare">http://localhost:8080/help</a></code>.</p>
</div>
<div class="paragraph">
<p>Navigation is always done on the active browser window. You can manage the opened windows as described in next section.</p>
</div>
</div>
<div class="sect2">
<h3 id="window-actions"><a class="anchor" href="#window-actions"></a><a class="link" href="#window-actions">36.12. Window actions</a></h3>
<div class="paragraph">
<p>Selenium is able to manage multiple windows. So you can open, close and switch active windows in a Citrus test.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;selenium:open-window</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">my_window</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;selenium:switch-window</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">my_window</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;selenium:close-window</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">my_window</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">selenium().open().window(<span class="string"><span class="delimiter">&quot;</span><span class="content">my_window</span><span class="delimiter">&quot;</span></span>);
selenium().focus().window(<span class="string"><span class="delimiter">&quot;</span><span class="content">my_window</span><span class="delimiter">&quot;</span></span>);
selenium().close().window(<span class="string"><span class="delimiter">&quot;</span><span class="content">my_window</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a new window is opened Selenium creates a window handle for us. This window handle is saved as test variable using a given window name. So after opening the window you can access the
window by its name in further actions. All upcoming Selenium actions will take place in this new active window. Of course the test actions will fail as soon as the window with that given
name is missing. Citrus uses default window names that are automatically used as test variables:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
selenium_active_window
</td>
<td class="hdlist2">
<p>the active window handle</p>
</td>
</tr>
<tr>
<td class="hdlist1">
selenium_last_window
</td>
<td class="hdlist2">
<p>the last window handle when switched to other window</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="alert"><a class="anchor" href="#alert"></a><a class="link" href="#alert">36.13. Alert</a></h3>
<div class="paragraph">
<p>We are able to access the alert dialog on the current page. Citrus will validate the displayed dialog text and accept or dismiss of the dialog.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;selenium:alert</span> <span class="attribute-name">accept</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;selenium:alert-text&gt;</span>Hello!<span class="tag">&lt;/selenium:alert-text&gt;</span>
<span class="tag">&lt;/selenium:alert&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">selenium().alert().text(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello!</span><span class="delimiter">&quot;</span></span>).accept();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The alert dialog text is validated when expected text is given on the test action. The user can decide to accept or dismiss the dialog. After that the dialog should be closed.
In case the test action fails to find an open alert dialog the test action raises runtime errors and the test will fail.</p>
</div>
</div>
<div class="sect2">
<h3 id="make-screenshot"><a class="anchor" href="#make-screenshot"></a><a class="link" href="#make-screenshot">36.14. Make screenshot</a></h3>
<div class="paragraph">
<p>You can execute this action in case you want to take a screenshot of the current page. This action only works with browsers that actually display the user interface. The action will not have any effect
when executed with Html unit web driver in headless mode.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;selenium:screenshot</span><span class="tag">/&gt;</span>

<span class="tag">&lt;selenium:screenshot</span> <span class="attribute-name">output-dir</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">target</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">selenium().screenhsot();

selenium().screenhsot(<span class="string"><span class="delimiter">&quot;</span><span class="content">target</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The test action has an optional parameter <em>output-dir</em> which represents the output directory where the screenshot is saved to.</p>
</div>
<div class="paragraph">
<p>[[temporary-storage-(firefox)]]
== Temporary storage (Firefox)</p>
</div>
<div class="paragraph">
<p><strong>Important</strong> This action only works with Firefox web driver! Other browsers are not working with the temporary download storage.</p>
</div>
<div class="paragraph">
<p>The browser uses a temporary storage for downloaded files. We can access this temporary storage during a test case.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;selenium:store-file</span> <span class="attribute-name">file-path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:download/file.txt</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;selenium:get-stored-file</span> <span class="attribute-name">file-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file.txt</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">selenium().store(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:download/file.txt</span><span class="delimiter">&quot;</span></span>);
selenium().getStored(<span class="string"><span class="delimiter">&quot;</span><span class="content">file.txt</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the test case is able to store new files to the temporary browser storage. We have to give the file path as classpath
or file system path. When reading the temporary file storage we need to specify the file name that we want to access in the temporary storage. The
temporary storage is not capable of subdirectories all files are stored directly to the storage in one single directory.</p>
</div>
<div class="paragraph">
<p>In case the stored file is not found by that name the test action fails with respective errors. On the other hand when the file is found in temporary storage
Citrus will automatically create a new test variable <strong>selenium_download_file</strong> which contains the file name as value.</p>
</div>
</div>
<div class="sect2">
<h3 id="clear-browser-cache"><a class="anchor" href="#clear-browser-cache"></a><a class="link" href="#clear-browser-cache">36.15. Clear browser cache</a></h3>
<div class="paragraph">
<p>When clearing the browser cache all cookies and temporary files will be deleted.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;selenium:clear-cache</span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">selenium().clearCache();</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dynamic-endpoint-components"><a class="anchor" href="#dynamic-endpoint-components"></a><a class="link" href="#dynamic-endpoint-components">37. Dynamic endpoint components</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Endpoints represent the central components in Citrus to send or receive a message on some destination. Usually endpoints get defined in the basic Citrus Spring application context configuration as Spring bean components. In some cases this might be over engineering as the tester just wants to send or receive a message. In particular this is done when doing sanity checks in server endpoints while debugging a certain scenario.</p>
</div>
<div class="paragraph">
<p>With endpoint components you are able to create the Citrus endpoint for sending and receiving a message at test runtime. There is no additional configuration or Spring bean component needed. You just use the endpoint uri in a special naming convention and Citrus will create the endpoint for you. Let us see a first example of this scenario:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DynamicEndpointTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jms:Hello.Queue?timeout=10000</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;message&gt;</span>
                <span class="tag">&lt;payload&gt;</span>
                [...]
                <span class="tag">&lt;/payload&gt;</span>
            <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/send&gt;</span>

        <span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jms:Hello.Response.Queue?timeout=5000</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;message&gt;</span>
                <span class="tag">&lt;payload&gt;</span>
                [...]
                <span class="tag">&lt;/payload&gt;</span>
            <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/receive&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the endpoint uri just goes into the test case action in substitution to the usual endpoint reference name. Instead of referencing a bean id that points to the previously configured Citrus endpoint we use the endpoint uri directly. The endpoint uri should give all information to create the endpoint at runtime. In the example above we use a keyword <strong>jms:</strong> which tells Citrus that we need to create a JMS message endpoint. Secondly we give the JMS destination name <strong>Hello.Queue</strong> which is a mandatory part of the endpoint uri when using the JMS component. The optional timeout parameter completed the uri. Citrus is able to create the JMS endpoint at runtime sending the message to the defined destination via JMS.</p>
</div>
<div class="paragraph">
<p>Of course this mechanism is not limited to JMS endpoints. We can use all default Citrus message transports in the endpoint uri. Just pick the right keyword that defines the message transport to use. Here is a list of supported keywords:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
jms
</td>
<td class="hdlist2">
<p>Creates a JMS endpoint for sending and receiving message to a queue or topic</p>
</td>
</tr>
<tr>
<td class="hdlist1">
channel
</td>
<td class="hdlist2">
<p>Creates a channel endpoint for sending and receiving messages using an in memory Spring Integration message channel</p>
</td>
</tr>
<tr>
<td class="hdlist1">
http
</td>
<td class="hdlist2">
<p>Creates a HTTP client for sending a request to some server URL synchronously waiting for the response message</p>
</td>
</tr>
<tr>
<td class="hdlist1">
ws
</td>
<td class="hdlist2">
<p>Creates a Web Socket client for sending messages to or receiving messages from a Web Socket server</p>
</td>
</tr>
<tr>
<td class="hdlist1">
soap
</td>
<td class="hdlist2">
<p>Creates a SOAP WebService client that send a proper SOAP message to the server URL and waits for the synchronous response to arrive</p>
</td>
</tr>
<tr>
<td class="hdlist1">
ssh
</td>
<td class="hdlist2">
<p>Creates a new ssh client for publishing a command to the server</p>
</td>
</tr>
<tr>
<td class="hdlist1">
mail
</td>
<td class="hdlist2">
<p>or smtp: Creates a new mail client for sending a mail mime message to a SMTP server</p>
</td>
</tr>
<tr>
<td class="hdlist1">
camel
</td>
<td class="hdlist2">
<p>Creates a new Apache Camel endpoint for sending and receiving Camel exchanges both to and from Camel routes.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
vertx
</td>
<td class="hdlist2">
<p>or eventbus: Creates a new Vert.x instance sending and receiving messages with the network event bus</p>
</td>
</tr>
<tr>
<td class="hdlist1">
rmi
</td>
<td class="hdlist2">
<p>Creates a new RMI client instance sending and receiving messages for method invocation on remote interfaces</p>
</td>
</tr>
<tr>
<td class="hdlist1">
jmx
</td>
<td class="hdlist2">
<p>Creates a new JMX client instance sending and receiving messages to and from a managed bean server.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Depending on the message transport we have to add mandatory parameters to the endpoint uri. In the JMS example we had to specify the destination name. The mandatory parameters are always part of the endpoint uri. Optional parameters can be added as key value pairs to the endpoint uri. The available parameters depend on the endpoint keyword that you have chosen. See these example endpoint uri expressions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">    jms:queuename?connectionFactory=specialConnectionFactory<span class="error">&amp;</span>timeout=10000
    jms:topic:topicname?connectionFactory=topicConnectionFactory
    jms:sync:queuename?connectionFactory=specialConnectionFactory<span class="error">&amp;</span>pollingInterval=100<span class="error">&amp;</span>replyDestination=myReplyDestination

    channel:channelName
    channel:sync:channelName
    channel:channelName?timeout=10000<span class="error">&amp;</span>channelResolver=myChannelResolver

    http:localhost:8088/test
    http://localhost:8088/test
    http:localhost:8088?requestMethod=GET<span class="error">&amp;</span>timeout=10000<span class="error">&amp;</span>errorHandlingStrategy=throwsException<span class="error">&amp;</span>requestFactory=myRequestFactory
    http://localhost:8088/test?requestMethod=DELETE<span class="error">&amp;</span>customParam=foo

    websocket:localhost:8088/test
    websocket://localhost:8088/test
    ws:localhost:8088/test
    ws://localhost:8088/test

    soap:localhost:8088/test
    soap:localhost:8088?timeout=10000<span class="error">&amp;</span>errorHandlingStrategy=propagateError<span class="error">&amp;</span>messageFactory=myMessageFactory

    mail:localhost:25000
    smtp://localhost:25000
    smtp://localhost?timeout=10000<span class="error">&amp;</span>username=foo<span class="error">&amp;</span>password=1234<span class="error">&amp;</span>mailMessageMapper=myMapper

    ssh:localhost:2200
    ssh://localhost:2200?timeout=10000<span class="error">&amp;</span>strictHostChecking=true<span class="error">&amp;</span>user=foo<span class="error">&amp;</span>password=12345678

    rmi://localhost:1099/someService
    rmi:localhost/someService<span class="error">&amp;</span>timeout=10000

    jmx:rmi:///jndi/rmi://localhost:1099/someService
    jmx:platform<span class="error">&amp;</span>timeout=10000

    camel:direct:address
    camel:seda:address
    camel:jms:queue:someQueue?connectionFactory=myConnectionFactory
    camel:activemq:queue:someQueue?concurrentConsumers=5<span class="error">&amp;</span>destination.consumer.prefetchSize=50
    camel:controlbus:route?routeId=myRoute<span class="error">&amp;</span>action=status

    vertx:addressName
    vertx:addressName?port=10105<span class="error">&amp;</span>timeout=10000<span class="error">&amp;</span>pubSubDomain=true
    vertx:addressName?vertxInstanceFactory=vertxFactory</code></pre>
</div>
</div>
<div class="paragraph">
<p>The optional parameters get directly set as endpoint configuration. You can use primitive values as well as Spring bean id references. Citrus will automatically detect the target parameter type and resolve the value to a Spring bean in the application context if necessary. If you use some unknown parameter Citrus will raise an exception at runtime as the endpoint could not be created properly.</p>
</div>
<div class="paragraph">
<p>In synchronous communication we have to reuse endpoint components in order to receive synchronous messages on reply destinations. This is a problem when using dynamic endpoints as the endpoints get created at runtime. Citrus uses a caching of endpoints that get created at runtime. Following from that we have to use the exact same endpoint uri in your test case in order to get the cached endpoint instance. With this little trick synchronous communication will work just as it is done with static endpoint components. Have a look at this sample test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DynamicEndpointTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jms:sync:Hello.Sync.Queue</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;message&gt;</span>
                <span class="tag">&lt;payload&gt;</span>
                [...]
                <span class="tag">&lt;/payload&gt;</span>
            <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/send&gt;</span>

        <span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jms:sync:Hello.Sync.Queue</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;message&gt;</span>
                <span class="tag">&lt;payload&gt;</span>
                [...]
                <span class="tag">&lt;/payload&gt;</span>
            <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/receive&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see we used the exact dynamic endpoint uri in both send and receive actions. Citrus is then able to reuse the same dynamic endpoint and the synchronous reply will be received as expected. However the reuse of exactly the same endpoint uri might get annoying as we also have to copy endpoint uri parameters and so on.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DynamicEndpointTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/HelloService?user=1234567</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;message&gt;</span>
                <span class="tag">&lt;payload&gt;</span>
                [...]
                <span class="tag">&lt;/payload&gt;</span>
            <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/send&gt;</span>

        <span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/HelloService?user=1234567</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;message&gt;</span>
                <span class="tag">&lt;payload&gt;</span>
                [...]
                <span class="tag">&lt;/payload&gt;</span>
            <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/receive&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We have to use the exact same endpoint uri when receiving the synchronous service response. This is not very straight forward. This is why Citrus also supports dynamic endpoint names. With a special endpoint uri parameter called <strong>endpointName</strong> you can name the dynamic endpoint. In a corresponding receive action you just use the endpoint name as reference which makes life easier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DynamicEndpointTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/HelloService?endpointName=myHttpClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;message&gt;</span>
                <span class="tag">&lt;payload&gt;</span>
                [...]
                <span class="tag">&lt;/payload&gt;</span>
            <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/send&gt;</span>

        <span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost?endpointName=myHttpClient</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;message&gt;</span>
                <span class="tag">&lt;payload&gt;</span>
                [...]
                <span class="tag">&lt;/payload&gt;</span>
            <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/receive&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>So we can reference the dynamic endpoint with the given name. The internal <strong>endpointName</strong> uri parameter is automatically removed before sending out messages. Once again the dynamic endpoint uri mechanism provides a fast way to write test cases in Citrus with less configuration. But you should consider to use the static endpoint components defined in the basic Spring bean application context for endpoints that are heavily reused in multiple test cases.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="endpoint-adapter"><a class="anchor" href="#endpoint-adapter"></a><a class="link" href="#endpoint-adapter">38. Endpoint adapter</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Endpoint adapter help to customize the behavior of a Citrus server such as HTTP or SOAP web servers. As the servers get started with the Citrus context they are ready to receive incoming client requests. Now there are different ways to process these incoming requests and to provide a proper response message. By default the server will forward the incoming request to a in memory message channel where a test can receive the message and provide a synchronous response. This message channel handling is done automatically behind the scenes so the tester does not care about these things. The tester just uses the server directly as endpoint reference in the test case. This is the default behaviour. In addition to that you can define custom endpoint adapters on the Citrus server in order to change this default behavior.</p>
</div>
<div class="paragraph">
<p>You set the custom endpoint adapter directly on the server configuration as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-http:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloHttpServer</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8080</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">auto-start</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">endpoint-adapter</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">emptyResponseEndpointAdapter</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">resource-base</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">src/it/resources</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;citrus:empty-response-adapter</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">emptyResponseEndpointAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now let us have a closer look at the provided endpoint adapter implementations.</p>
</div>
<div class="sect2">
<h3 id="empty-response-endpoint-adapter"><a class="anchor" href="#empty-response-endpoint-adapter"></a><a class="link" href="#empty-response-endpoint-adapter">38.1. Empty response endpoint adapter</a></h3>
<div class="paragraph">
<p>This is the simplest endpoint adapter you can think of. It simply provides an empty success response using the HTTP response code <strong>200</strong> . The adapter does not need any configurations or properties as it simply responds with an empty HTTP response.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:empty-response-adapter</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">emptyResponseEndpointAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="static-response-endpoint-adapter"><a class="anchor" href="#static-response-endpoint-adapter"></a><a class="link" href="#static-response-endpoint-adapter">38.2. Static response endpoint adapter</a></h3>
<div class="paragraph">
<p>The next more complex endpoint adapter will always return a static response message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:static-response-adapter</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">endpointAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:payload&gt;</span>
        <span class="inline-delimiter">&lt;![CDATA[</span>
          &lt;HelloResponse
            xmlns=&quot;http://www.consol.de/schemas/samples/sayHello.xsd&quot;&gt;
              &lt;MessageId&gt;123456789&lt;/MessageId&gt;
              &lt;CorrelationId&gt;Cx1x123456789&lt;/CorrelationId&gt;
              &lt;Text&gt;Hello User&lt;/Text&gt;
          &lt;/HelloResponse&gt;
        <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/citrus:payload&gt;</span>
    <span class="tag">&lt;citrus:header&gt;</span>
        <span class="tag">&lt;citrus:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{http://www.consol.de/schemas/samples}h1:Operation</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;citrus:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{http://www.consol.de/schemas/samples}h1:MessageId</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">123456789</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/citrus:header&gt;</span>
 <span class="tag">&lt;/citrus:static-response-adapter&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The endpoint adapter is configured with a static message payload and static response header values. The response to the client is therefore always the same. You can add dynamic
values by using Citrus functions such as <strong>randomString</strong> or <strong>randomNumber</strong>. Also we are able to use values of the actual request message that has triggered the
response adapter. The request is available via the local message store. In combination with Xpath or JsonPath functions we can map values from the actual request.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:static-response-adapter</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">endpointAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:payload&gt;</span>
        <span class="inline-delimiter">&lt;![CDATA[</span>
          &lt;HelloResponse
            xmlns=&quot;http://www.consol.de/schemas/samples/sayHello.xsd&quot;&gt;
              &lt;MessageId&gt;citrus:randomNumber(10)&lt;/MessageId&gt;
              &lt;CorrelationId&gt;citrus:xpath(citrus:message(request.payload()), '/hello:HelloRequest/hello:CorrelationId')&lt;/CorrelationId&gt;
              &lt;Text&gt;Hello User&lt;/Text&gt;
          &lt;/HelloResponse&gt;
        <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/citrus:payload&gt;</span>
    <span class="tag">&lt;citrus:header&gt;</span>
        <span class="tag">&lt;citrus:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{http://www.consol.de/schemas/samples}h1:Operation</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;citrus:element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{http://www.consol.de/schemas/samples}h1:MessageId</span><span class="delimiter">&quot;</span></span>
                  <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:randomNumber(10)</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/citrus:header&gt;</span>
 <span class="tag">&lt;/citrus:static-response-adapter&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The example above maps the <strong>CorrelationId</strong> of the <strong>HelloRequest</strong> message to the response with Xpath function. The local message store automatically has the message named
<strong>request</strong> stored so we can access the payload with this message name.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
XML is namespace specific so we need to use the namespace prefix <strong>hello</strong> in the Xpath expression. The namespace prefix should evaluate to a global namespace entry in the global
Citrus <a href="xpath-namespace">xpath-namespace</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="request-dispatching-endpoint-adapter"><a class="anchor" href="#request-dispatching-endpoint-adapter"></a><a class="link" href="#request-dispatching-endpoint-adapter">38.3. Request dispatching endpoint adapter</a></h3>
<div class="paragraph">
<p>The idea behind the request dispatching endpoint adapter is that the incoming requests are dispatched to several other endpoint adapters. The decision which endpoint adapter should handle the actual request is done depending on some adapter mapping. The mapping is done based on the payload or header data of the incoming request. A mapping strategy evaluates a mapping key using the incoming request. You can think of an XPath expression that evaluates to the mapping key for instance. The endpoint adapter that maps to the mapping key is then called to handle the request.</p>
</div>
<div class="paragraph">
<p>So the request dispatching endpoint adapter is able to dynamically call several other endpoint adapters based on the incoming request message at runtime. This is very powerful. The next example uses the request dispatching endpoint adapter with a XPath mapping key extractor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:dispatching-endpoint-adapter</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dispatchingEndpointAdapter</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">mapping-key-extractor</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mappingKeyExtractor</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">mapping-strategy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mappingStrategy</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mappingStrategy</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.endpoint.adapter.mapping.SimpleMappingStrategy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">adapterMappings</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;map&gt;</span>
          <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sayHello</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloEndpointAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/map&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mappingKeyExtractor</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.endpoint.adapter.mapping.XPathPayloadMappingKeyExtractor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xpathExpression</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//TestMessage/Operation/*</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;citrus:static-response-adapter</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">helloEndpointAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:payload&gt;</span>
        <span class="inline-delimiter">&lt;![CDATA[</span>
            &lt;HelloResponse
                xmlns=&quot;http://www.consol.de/schemas/samples/sayHello.xsd&quot;&gt;
                &lt;MessageId&gt;123456789&lt;/MessageId&gt;
                &lt;Text&gt;Hello User&lt;/Text&gt;
            &lt;/HelloResponse&gt;
        <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/citrus:payload&gt;</span>
<span class="tag">&lt;/citrus:static-response-adapter&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The XPath mapping key extractor expression decides for each request which mapping key to use in order to find a proper endpoint adapter through the mapping strategy. The endpoint adapters available in the application context are mapped via their bean id. For instance an incoming request with a matching element <strong><em>//TestMessage/Operation/sayHello</em></strong> would be handled by the endpoint adapter bean that is registered in the mapping strategy as "sayHello" key. The available endpoint adapters are configured in the same Spring application context.</p>
</div>
<div class="paragraph">
<p>Citrus provides several default mapping key extractor implementations.</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
HeaderMappingKeyExtractor
</td>
<td class="hdlist2">
<p>Reads a special header entry and uses its value as mapping key</p>
</td>
</tr>
<tr>
<td class="hdlist1">
SoapActionMappingKeyExtractor
</td>
<td class="hdlist2">
<p>Uses the soap action header entry as mapping key</p>
</td>
</tr>
<tr>
<td class="hdlist1">
XPathPayloadMappingKeyExtractor
</td>
<td class="hdlist2">
<p>Evaluates a XPath expression on the request payload and uses the result as mapping key</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In addition to that we need a mapping strategy. Citrus provides following default implementations.</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
SimpleMappingStrategy
</td>
<td class="hdlist2">
<p>Simple key value map with endpoint adapter references</p>
</td>
</tr>
<tr>
<td class="hdlist1">
BeanNameMappingStrategy
</td>
<td class="hdlist2">
<p>Loads the endpoint adapter Spring bean with the given id matching the mapping key</p>
</td>
</tr>
<tr>
<td class="hdlist1">
ContextLoadingMappingStrategy
</td>
<td class="hdlist2">
<p>Same as BeanNameMappingStrategy but loads a separate application context defined by external file resource</p>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="channel-endpoint-adapter"><a class="anchor" href="#channel-endpoint-adapter"></a><a class="link" href="#channel-endpoint-adapter">38.4. Channel endpoint adapter</a></h3>
<div class="paragraph">
<p>The channel connecting endpoint adapter is the default adapter used in all Citrus server components. Indeed this adapter also provides the most flexibility. This adapter forwards incoming requests to a channel destination. The adapter is waiting for a proper response on a reply destination synchronously. With the channel endpoint components you can read the requests on the channel and provide a proper response on the reply destination.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:channel-endpoint-adapter</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">channelEndpointAdapter</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">channel-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">inbound.channel</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2500</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jms-endpoint-adapter"><a class="anchor" href="#jms-endpoint-adapter"></a><a class="link" href="#jms-endpoint-adapter">38.5. JMS endpoint adapter</a></h3>
<div class="paragraph">
<p>Another powerful endpoint adapter is the JMS connecting adapter implementation. This adapter forwards incoming requests to a JMS destination and waits for a proper response on a reply destination. A JMS endpoint can access the requests internally and provide a proper response on the reply destination. So this adapter is very flexible to provide proper response messages.</p>
</div>
<div class="paragraph">
<p>This special adapter comes with the <strong>citrus-jms</strong> module. So you have to add the module and the special XML namespace for this module to your configuration files. The Maven module for <strong>citrus-jms</strong> goes to the Maven POM file as normal project dependency. The <strong>citrus-jms</strong> namespace goes to the Spring bean XML configuration file as follows:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Citrus provides a "citrus-jms" configuration namespace and schema definition for JMS related components and features. Include this namespace into your Spring configuration in order to use the Citrus JMS configuration elements. The namespace URI and schema location are added to the Spring configuration XML file as follows.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:citrus-jms</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/jms/config</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
        <span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content">http://www.citrusframework.org/schema/jms/config</span>
        <span class="content">http://www.citrusframework.org/schema/jms/config/citrus-jms-config.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    [...]

<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After that you are able to use the adapter implementation in the Spring bean configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-jms:endpoint-adapter</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsEndpointAdapter</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">destination-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">JMS.Queue.Requests.In</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">reply-destination-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">JMS.Queue.Response.Out</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">connection-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsConnectionFactory</span><span class="delimiter">&quot;</span></span>
              <span class="attribute-name">timeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2500</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsConnectionFactory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.activemq.ActiveMQConnectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">brokerURL</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tcp://localhost:61616</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="functions"><a class="anchor" href="#functions"></a><a class="link" href="#functions">39. Functions</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The test framework will offer several functions that are useful throughout the test execution. The functions will always return a string value that is ready for use as variable value or directly inside a text message.</p>
</div>
<div class="paragraph">
<p>A set of functions is usually combined to a function library. The library has a prefix that will identify the functions inside the test case. The default test framework function library uses a default prefix (citrus). You can write your own function library using your own prefix in order to extend the test framework functionality whenever you want.</p>
</div>
<div class="paragraph">
<p>The library is built in the Spring configuration and contains a set of functions that are of public use.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:function-library</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testLibrary</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">prefix</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo:</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;citrus:function</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">randomNumber</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.functions.RandomNumberFunction</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;citrus:function</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">randomString</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.functions.RandomStringFunction</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          <span class="tag">&lt;citrus:function</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customFunction</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customFunctionBean</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
          ...
<span class="tag">&lt;/citrus:function-library&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the library defines one to many functions either referenced as normal Spring bean or by its implementing Java class name. Citrus constructs the library and you are able to use the functions in your test case with the leading library prefix just like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">foo:randomNumber()
      foo:randomString()
      foo:customFunction()</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can add custom function implementations and custom function libraries. Just use a custom prefix for your library. The default Citrus function library uses the <strong>citrus:</strong> prefix.In the next chapters the default functions offered by the framework will be described in detail.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="functions-concat"><a class="anchor" href="#functions-concat"></a><a class="link" href="#functions-concat">39.1. concat()</a></h3>
<div class="paragraph">
<p>The function will combine several string tokens to a single string value. This means that you can combine a static text value with a variable value for instance. A first example should clarify the usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">concatFunctionTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;variables&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate(yyyy-MM-dd)</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello Test Framework!</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/variables&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;echo&gt;</span>
            <span class="tag">&lt;message&gt;</span>
                citrus:concat('Today is: ', ${date}, ' right!?')
            <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/echo&gt;</span>
        <span class="tag">&lt;echo&gt;</span>
            <span class="tag">&lt;message&gt;</span>
                citrus:concat('Text is: ', ${text})
            <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/echo&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Please do not forget to mark static text with single quote signs. There is no limitation for string tokens to be combined.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>citrus:concat('Text1', 'Text2', 'Text3', ${text}, 'Text5', …, 'TextN')</code></pre>
</div>
</div>
<div class="paragraph">
<p>The function can be used wherever variables can be used. For instance when validating XML elements in the receive action.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;message&gt;</span>
    <span class="tag">&lt;validate</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//element/element</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:concat('Cx1x', ${generatedId})</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/message&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="functions-substring"><a class="anchor" href="#functions-substring"></a><a class="link" href="#functions-substring">39.2. substring()</a></h3>
<div class="paragraph">
<p>The function will have three parameters.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>String to work on</p>
</li>
<li>
<p>Starting index</p>
</li>
<li>
<p>End index (optional)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Let us have a look at a simple example for this function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;echo&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        citrus:substring('Hello Test Framework', 6)
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span>
<span class="tag">&lt;echo&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        citrus:substring('Hello Test Framework', 0, 5)
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Function output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Test Framework
Hello</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="functions-stringlength"><a class="anchor" href="#functions-stringlength"></a><a class="link" href="#functions-stringlength">39.3. stringLength()</a></h3>
<div class="paragraph">
<p>The function will calculate the number of characters in a string representation and return the number.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;echo&gt;</span>
    <span class="tag">&lt;message&gt;</span>citrus:stringLength('Hello Test Framework')<span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Function output:</p>
</div>
<div class="paragraph">
<p><strong>20</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="functions-translate"><a class="anchor" href="#functions-translate"></a><a class="link" href="#functions-translate">39.4. translate()</a></h3>
<div class="paragraph">
<p>This function will replace regular expression matching values inside a string representation with a specified replacement string.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;echo&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        citrus:translate('H.llo Test Fr.mework', '\.', 'a')
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the second parameter will be a regular expression. The third parameter will be a simple replacement string value.</p>
</div>
<div class="paragraph">
<p>Function output:</p>
</div>
<div class="paragraph">
<p><strong>Hello Test Framework</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="functions-substring-before"><a class="anchor" href="#functions-substring-before"></a><a class="link" href="#functions-substring-before">39.5. substringBefore()</a></h3>
<div class="paragraph">
<p>The function will search for the first occurrence of a specified string and will return the substring before that occurrence. Let us have a closer look in a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;echo&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        citrus:substringBefore('Test/Framework', '/')
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the specific example the function will search for the ‘/’ character and return the string before that index.</p>
</div>
<div class="paragraph">
<p>Function output:</p>
</div>
<div class="paragraph">
<p><strong>Test</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="functions-substring-after"><a class="anchor" href="#functions-substring-after"></a><a class="link" href="#functions-substring-after">39.6. substringAfter()</a></h3>
<div class="paragraph">
<p>The function will search for the first occurrence of a specified string and will return the substring after that occurrence. Let us clarify this with a simple example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;echo&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        citrus:substringAfter('Test/Framework', '/')
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Similar to the substringBefore function the ‘/’ character is found in the string. But now the remaining string is returned by the function meaning the substring after this character index.</p>
</div>
<div class="paragraph">
<p>Function output:</p>
</div>
<div class="paragraph">
<p><strong>Framework</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="functions-round"><a class="anchor" href="#functions-round"></a><a class="link" href="#functions-round">39.7. round()</a></h3>
<div class="paragraph">
<p>This is a simple mathematic function that will round decimal numbers representations to their nearest non decimal number.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;echo&gt;</span>
    <span class="tag">&lt;message&gt;</span>citrus:round('3.14')<span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Function output:</p>
</div>
<div class="paragraph">
<p><strong>3</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="functions-floor"><a class="anchor" href="#functions-floor"></a><a class="link" href="#functions-floor">39.8. floor()</a></h3>
<div class="paragraph">
<p>This function will round down decimal number values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;echo&gt;</span>
    <span class="tag">&lt;message&gt;</span>citrus:floor('3.14')<span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Function output:</p>
</div>
<div class="paragraph">
<p><strong>3.0</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="functions-ceiling"><a class="anchor" href="#functions-ceiling"></a><a class="link" href="#functions-ceiling">39.9. ceiling()</a></h3>
<div class="paragraph">
<p>Similar to floor function, but now the function will round up the decimal number values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;echo&gt;</span>
    <span class="tag">&lt;message&gt;</span>citrus:ceiling('3.14')<span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Function output:</p>
</div>
<div class="paragraph">
<p><strong>4.0</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="functions-random-number"><a class="anchor" href="#functions-random-number"></a><a class="link" href="#functions-random-number">39.10. randomNumber()</a></h3>
<div class="paragraph">
<p>The random number function will provide you the opportunity to generate random number strings containing positive number letters. There is a singular Boolean parameter for that function describing whether the generated number should have exactly the amount of digits. Default value for this padding flag will be true.</p>
</div>
<div class="paragraph">
<p>Next example will show the function usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;variables&gt;</span>
    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rndNumber1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:randomNumber(10)</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rndNumber2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:randomNumber(10, true)</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rndNumber2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:randomNumber(10, false)</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rndNumber3</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:randomNumber(3, false)</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/variables&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Function output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>8954638765
5003485980
6387650
65</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="functions-random-string"><a class="anchor" href="#functions-random-string"></a><a class="link" href="#functions-random-string">39.11. randomString()</a></h3>
<div class="paragraph">
<p>This function will generate a random string representation with a defined length. A second parameter for this function will define the case of the generated letters (UPPERCASE, LOWERCASE, MIXED). The last parameter allows also digit characters in the generated string. By default digit characters are not allowed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;variables&gt;</span>
    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rndString0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${citrus:randomString(10)}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rndString1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:randomString(10)</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rndString2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:randomString(10, UPPERCASE)</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rndString3</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:randomString(10, LOWERCASE)</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rndString4</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:randomString(10, MIXED)</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">rndString4</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:randomString(10, MIXED, true)</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/variables&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Function output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>HrGHOdfAer
AgSSwedetG
JSDFUTTRKU
dtkhirtsuz
Vt567JkA32</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="functions-random-enum-value"><a class="anchor" href="#functions-random-enum-value"></a><a class="link" href="#functions-random-enum-value">39.12. randomEnumValue()</a></h3>
<div class="paragraph">
<p>This function returns one of its supplied arguments. Furthermore you can specify a custom function with a configured list of values (the enumeration). The function will randomly return an entry when called without arguments. This promotes code reuse and facilitates refactoring.</p>
</div>
<div class="paragraph">
<p>In the next sample the function is used to set a httpStatusCode variable to one of the given HTTP status codes (200, 401, 500)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpStatusCode</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:randomEnumValue('200', '401', '500')</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As mentioned before you can define a custom function for your very specific needs in order to easily manage a list of predefined values like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:function-library</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myCustomFunctionLibrary</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">prefix</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">custom:</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus-function</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">randomHttpStatusCode</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">randomHttpStatusCodeFunction</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/citrus:function-library&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">randomHttpStatusCodeFunction</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.functions.core.RandomEnumValueFunction</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">values</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;list&gt;</span>
      <span class="tag">&lt;value&gt;</span>200<span class="tag">&lt;/value&gt;</span>
      <span class="tag">&lt;value&gt;</span>500<span class="tag">&lt;/value&gt;</span>
      <span class="tag">&lt;value&gt;</span>401<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;/list&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We have added a custom function library with a custom function definition. The custom function "randomHttpStatusCode" randomly chooses an HTTP status code each time it is called. Inside the test you can use the function like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpStatusCode</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">custom:randomHttpStatusCode()</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="functions-current-date"><a class="anchor" href="#functions-current-date"></a><a class="link" href="#functions-current-date">39.13. currentDate()</a></h3>
<div class="paragraph">
<p>This function will definitely help you when accessing the current date. Some examples will show the usage in detail:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;echo&gt;</span><span class="tag">&lt;message&gt;</span>citrus:currentDate()<span class="tag">&lt;/message&gt;</span><span class="tag">&lt;/echo&gt;</span>
<span class="tag">&lt;echo&gt;</span><span class="tag">&lt;message&gt;</span>citrus:currentDate('yyyy-MM-dd')<span class="tag">&lt;/message&gt;</span><span class="tag">&lt;/echo&gt;</span>
<span class="tag">&lt;echo&gt;</span><span class="tag">&lt;message&gt;</span>citrus:currentDate('yyyy-MM-dd HH:mm:ss')<span class="tag">&lt;/message&gt;</span><span class="tag">&lt;/echo&gt;</span>
<span class="tag">&lt;echo&gt;</span><span class="tag">&lt;message&gt;</span>citrus:currentDate('yyyy-MM-dd'T'hh:mm:ss')<span class="tag">&lt;/message&gt;</span><span class="tag">&lt;/echo&gt;</span>
<span class="tag">&lt;echo&gt;</span><span class="tag">&lt;message&gt;</span>citrus:currentDate('yyyy-MM-dd HH:mm:ss', '+1y')<span class="tag">&lt;/message&gt;</span><span class="tag">&lt;/echo&gt;</span>
<span class="tag">&lt;echo&gt;</span><span class="tag">&lt;message&gt;</span>citrus:currentDate('yyyy-MM-dd HH:mm:ss', '+1M')<span class="tag">&lt;/message&gt;</span><span class="tag">&lt;/echo&gt;</span>
<span class="tag">&lt;echo&gt;</span><span class="tag">&lt;message&gt;</span>citrus:currentDate('yyyy-MM-dd HH:mm:ss', '+1d')<span class="tag">&lt;/message&gt;</span><span class="tag">&lt;/echo&gt;</span>
<span class="tag">&lt;echo&gt;</span><span class="tag">&lt;message&gt;</span>citrus:currentDate('yyyy-MM-dd HH:mm:ss', '+1h')<span class="tag">&lt;/message&gt;</span><span class="tag">&lt;/echo&gt;</span>
<span class="tag">&lt;echo&gt;</span><span class="tag">&lt;message&gt;</span>citrus:currentDate('yyyy-MM-dd HH:mm:ss', '+1m')<span class="tag">&lt;/message&gt;</span><span class="tag">&lt;/echo&gt;</span>
<span class="tag">&lt;echo&gt;</span><span class="tag">&lt;message&gt;</span>citrus:currentDate('yyyy-MM-dd HH:mm:ss', '+1s')<span class="tag">&lt;/message&gt;</span><span class="tag">&lt;/echo&gt;</span>
<span class="tag">&lt;echo&gt;</span><span class="tag">&lt;message&gt;</span>citrus:currentDate('yyyy-MM-dd HH:mm:ss', '-1y')<span class="tag">&lt;/message&gt;</span><span class="tag">&lt;/echo&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the currentDate function provides two parameters. First parameter describes the date format string. The second will define a date offset string containing year, month, days, hours, minutes or seconds that will be added or subtracted to or from the actual date value.</p>
</div>
<div class="paragraph">
<p>Function output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>01.09.2009
2009-09-01
2009-09-01 12:00:00
2009-09-01T12:00:00</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="functions-uppercase"><a class="anchor" href="#functions-uppercase"></a><a class="link" href="#functions-uppercase">39.14. upperCase()</a></h3>
<div class="paragraph">
<p>This function converts any string to upper case letters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;echo&gt;</span>
    <span class="tag">&lt;message&gt;</span>citrus:upperCase('Hello Test Framework')<span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Function output:</p>
</div>
<div class="paragraph">
<p><strong>HELLO TEST FRAMEWORK</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="functions-lowercase"><a class="anchor" href="#functions-lowercase"></a><a class="link" href="#functions-lowercase">39.15. lowerCase()</a></h3>
<div class="paragraph">
<p>This function converts any string to lower case letters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;echo&gt;</span>
    <span class="tag">&lt;message&gt;</span>citrus:lowerCase('Hello Test Framework')<span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Function output:</p>
</div>
<div class="paragraph">
<p><strong>hello test framework</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="functions-average"><a class="anchor" href="#functions-average"></a><a class="link" href="#functions-average">39.16. average()</a></h3>
<div class="paragraph">
<p>The function will sum up all specified number values and divide the result through the number of values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">avg</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:average('3', '4', '5')</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>avg = <strong>4.0</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="functions-minimum"><a class="anchor" href="#functions-minimum"></a><a class="link" href="#functions-minimum">39.17. minimum()</a></h3>
<div class="paragraph">
<p>This function returns the minimum value in a set of number values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">min</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:minimum('3', '4', '5')</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>min = <strong>3.0</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="functions-maximum"><a class="anchor" href="#functions-maximum"></a><a class="link" href="#functions-maximum">39.18. maximum()</a></h3>
<div class="paragraph">
<p>This function returns the maximum value in a set of number values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">max</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:maximum('3', '4', '5')</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>max = <strong>5.0</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="functions-sum"><a class="anchor" href="#functions-sum"></a><a class="link" href="#functions-sum">39.19. sum()</a></h3>
<div class="paragraph">
<p>The function will sum up all number values. The number values can also be negative.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sum</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:sum('3', '4', '5')</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>sum = <strong>12.0</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="functions-absolute"><a class="anchor" href="#functions-absolute"></a><a class="link" href="#functions-absolute">39.20. absolute()</a></h3>
<div class="paragraph">
<p>The function will return the absolute number value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">abs</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:absolute('-3')</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>abs = <strong>3.0</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="functions-map-value"><a class="anchor" href="#functions-map-value"></a><a class="link" href="#functions-map-value">39.21. mapValue()</a></h3>
<div class="paragraph">
<p>This function implementation maps string keys to string values. This is very helpful when the used key is randomly chosen at runtime and the corresponding value is not defined during the design time.</p>
</div>
<div class="paragraph">
<p>The following function library defines a custom function for mapping HTTP status codes to the corresponding messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:function-library</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myCustomFunctionLibrary</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">prefix</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">custom:</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;citrus-function</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">getHttpStatusMessage</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">getHttpStatusMessageFunction</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/citrus:function-library&gt;</span>

<span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">getHttpStatusMessageFunction</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.functions.core.MapValueFunction</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">values</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;map&gt;</span>
      <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">200</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OK</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">401</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Unauthorized</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
      <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">500</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Internal Server Error</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/map&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example the function sets the variable httpStatusMessage to the 'Internal Server Error' string dynamically at runtime. The test only knows the HTTP status code and does not care about spelling and message locales.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpStatusCodeMessage</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">custom:getHttpStatusMessage('500')</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="functions-random-uuid"><a class="anchor" href="#functions-random-uuid"></a><a class="link" href="#functions-random-uuid">39.22. randomUUID()</a></h3>
<div class="paragraph">
<p>The function will generate a random Java UUID.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">uuid</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:randomUUID()</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>uuid = <strong>98fbd7b0-832e-4b85-b9d2-e0113ee88356</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="functions-encode-base64"><a class="anchor" href="#functions-encode-base64"></a><a class="link" href="#functions-encode-base64">39.23. encodeBase64()</a></h3>
<div class="paragraph">
<p>The function will encode a string to binary data using base64 hexadecimal encoding.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">encoded</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:encodeBase64('Hallo Testframework')</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>encoded = <strong>VGVzdCBGcmFtZXdvcms=</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="functions-decode-base64"><a class="anchor" href="#functions-decode-base64"></a><a class="link" href="#functions-decode-base64">39.24. decodeBase64()</a></h3>
<div class="paragraph">
<p>The function will decode binary data to a character sequence using base64 hexadecimal decoding.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">decoded</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:decodeBase64('VGVzdCBGcmFtZXdvcms=')</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>decoded = <strong>Hallo Testframework</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="functions-escape-xml"><a class="anchor" href="#functions-escape-xml"></a><a class="link" href="#functions-escape-xml">39.25. escapeXml()</a></h3>
<div class="paragraph">
<p>If you want to deal with escaped XML in your test case you may want to use this function. It automatically escapes all XML special characters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;echo&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        <span class="inline-delimiter">&lt;![CDATA[</span>
            citrus:escapeXml('&lt;Message&gt;Hallo Test Framework&lt;/Message&gt;')
        <span class="inline-delimiter">]]&gt;</span>
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>&lt;Message&gt;Hallo Test Framework&lt;/Message&gt;</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="functions-cdata-section"><a class="anchor" href="#functions-cdata-section"></a><a class="link" href="#functions-cdata-section">39.26. cdataSection()</a></h3>
<div class="paragraph">
<p>Usually we use CDATA sections to define message payload data inside a testcase. We might run into problems when the payload itself contains CDATA sections as nested CDATA sections are prohibited by XML nature. In this case the next function ships very usefull.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cdata</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:cdataSection('payload')</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>cdata = <code>&lt;![CDATA[payload]]&gt;</code></p>
</div>
</div>
<div class="sect2">
<h3 id="functions-digest-auth-header"><a class="anchor" href="#functions-digest-auth-header"></a><a class="link" href="#functions-digest-auth-header">39.27. digestAuthHeader()</a></h3>
<div class="paragraph">
<p>Digest authentication is a commonly used security algorithm, especially in Http communication and SOAP WebServices. Citrus offers a function to generate a digest authentication principle used in the Http header section of a message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">digest</span><span class="delimiter">&quot;</span></span>
  <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:digestAuthHeader('username', 'password', 'authRealm', 'acegi',</span>
                            <span class="content">'POST', 'http://127.0.0.1:8080', 'citrus', 'md5')</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A possible digest authentication header value looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;Digest</span> <span class="attribute-name">username</span>=<span class="attribute-value">foo</span><span class="error">,</span><span class="attribute-name">realm</span>=<span class="attribute-value">arealm</span><span class="error">,</span><span class="attribute-name">nonce</span>=<span class="attribute-value">MTMzNT</span><span class="error">,</span>
<span class="attribute-name">uri</span>=<span class="attribute-value">http:</span><span class="error">/</span><span class="error">/</span><span class="attribute-name">127.0.0.1:8080</span><span class="error">,</span><span class="attribute-name">response</span>=<span class="attribute-value">51f98c</span><span class="error">,</span><span class="attribute-name">opaque</span>=<span class="attribute-value">b29a30</span><span class="error">,</span><span class="attribute-name">algorithm</span>=<span class="attribute-value">md5</span><span class="tag">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use these digest headers in messages sent by Citrus like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;header&gt;</span>
  <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus_http_Authorization</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">vflig:digestAuthHeader('${username}','${password}','${authRealm}',</span>
                            <span class="content">'${nonceKey}','POST','${uri}','${opaque}','${algorithm}')</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/header&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This will set a Http Authorization header with the respective digest in the request message. So your test is ready for client digest authentication.</p>
</div>
</div>
<div class="sect2">
<h3 id="functions-localhost-address"><a class="anchor" href="#functions-localhost-address"></a><a class="link" href="#functions-localhost-address">39.28. localHostAddress()</a></h3>
<div class="paragraph">
<p>Test cases may use the local host address for some reason (e.g. used as authentication principle). As the tests may run on different machines at the same time we can not use static host addresses. The provided function localHostAddress() reads the local host name dynamically at runtime.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">address</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:localHostAddress()</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A possible value is either the host name as used in DNS entry or an IP address value:</p>
</div>
<div class="paragraph">
<p>address = <code>&lt;192.168.2.100&gt;</code></p>
</div>
</div>
<div class="sect2">
<h3 id="functions-change-date"><a class="anchor" href="#functions-change-date"></a><a class="link" href="#functions-change-date">39.29. changeDate()</a></h3>
<div class="paragraph">
<p>This function works with date values and manipulates those at runtime by adding or removing a date value offset. You can manipulate several date fields such as: year, month, day, hour, minute or second.</p>
</div>
<div class="paragraph">
<p>Let us clarify this with a simple example for this function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;echo&gt;</span>
    <span class="tag">&lt;message&gt;</span>citrus:changeDate('01.01.2000', '+1y+1M+1d')<span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span>
<span class="tag">&lt;echo&gt;</span>
    <span class="tag">&lt;message&gt;</span>citrus:changeDate(citrus:currentDate(), '-1M')<span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Function output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>02.02.2001
13.04.2013</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the change date function works on static date values or dynamic variable values or functions like <strong>citrus:currentDate()</strong> . By default the change date function requires a date format such as the current date function ('dd.MM.yyyy'). You can also define a custom date format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;echo&gt;</span>
    <span class="tag">&lt;message&gt;</span>citrus:changeDate('2000-01-10', '-1M-1d', 'yyyy-MM-dd')<span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Function output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>1999-12-09</code></pre>
</div>
</div>
<div class="paragraph">
<p>With this you are able to manipulate all date values of static or dynamic nature at test runtime.</p>
</div>
</div>
<div class="sect2">
<h3 id="functions-read-file"><a class="anchor" href="#functions-read-file"></a><a class="link" href="#functions-read-file">39.30. readFile()</a></h3>
<div class="paragraph">
<p>The <strong>readFile</strong> function reads a file resource from given file path and loads the complete file content as function result. The file path can be a system file path as well as a classpath file resource. The file path can have test variables as part of the path or file name. In addition to that the file content can also have test variable values and other functions.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s see this function in action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;echo&gt;</span>
    <span class="tag">&lt;message&gt;</span>citrus:readFile('classpath:some/path/to/file.txt')<span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span>
<span class="tag">&lt;echo&gt;</span>
    <span class="tag">&lt;message&gt;</span>citrus:readFile(${filePath})<span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The function reads the file content and places the content at the position where the function has been called. This means that you can also use this function as part of Strings and message payloads for instance. This is a very powerful way to extract large message parts to separate file resources. Just add the <strong>readFile</strong> function somewhere to the message content and Citrus will load the extra file content and place it right into the message payload for you.</p>
</div>
</div>
<div class="sect2">
<h3 id="functions-message"><a class="anchor" href="#functions-message"></a><a class="link" href="#functions-message">39.31. message()</a></h3>
<div class="paragraph">
<p>When messages are exchanged in Citrus the content is automatically saved to an in memory storage for further access in the test case. That means that functions and test actions can access the messages
that have been sent or received within the test case. The <strong>message</strong> function loads a message content from that message store. The message is identified by its name. Receive and send actions usually define
the message name. Now we can load the message payload with that name.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s see this function in action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;echo&gt;</span>
    <span class="tag">&lt;message&gt;</span>citrus:message(myRequest.payload())<span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The function above loads the message named <strong>myRequest</strong> from the local memory store. This requires a send or receive action to have handled the message before in the same test case.</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myRequest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;payload&gt;</span>Some payload<span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">send(<span class="string"><span class="delimiter">&quot;</span><span class="content">someEndpoint</span><span class="delimiter">&quot;</span></span>)
    .name(<span class="string"><span class="delimiter">&quot;</span><span class="content">myRequest</span><span class="delimiter">&quot;</span></span>)
    .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">Some payload</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The name of the message is important. Otherwise the message can not be found in the local message store. Note: a message can either be received or sent with a name in order to be stored
in the local message store. The <strong>message</strong> function is then able to access the message by its name. In the first example the <strong>payload()</strong> has been loaded. Of course we can also access header information.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;echo&gt;</span>
    <span class="tag">&lt;message&gt;</span>citrus:message(myRequest.header('Operation'))<span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The sample above loads the header <strong>Operation</strong> of the message.</p>
</div>
<div class="paragraph">
<p>In Java DSL the message store is also accessible over the TestContext.</p>
</div>
</div>
<div class="sect2">
<h3 id="functions-xpath"><a class="anchor" href="#functions-xpath"></a><a class="link" href="#functions-xpath">39.32. xpath()</a></h3>
<div class="paragraph">
<p>The <strong>xpath</strong> function evaluates a Xpath expressions on some XML source and returns the expression result as String.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;echo&gt;</span>
    <span class="tag">&lt;message&gt;</span><span class="inline-delimiter">&lt;![CDATA[</span>citrus:xpath('&lt;message&gt;&lt;id&gt;1000&lt;/id&gt;&lt;/text&gt;Some text content&lt;/text&gt;&lt;/message&gt;', '/message/id')<span class="inline-delimiter">]]&gt;</span><span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The XML source is given as first function parameter and can be loaded in different ways. In the example above a static XML source has been used. We could load the XML content from
external file or just use a test variable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;echo&gt;</span>
    <span class="tag">&lt;message&gt;</span><span class="inline-delimiter">&lt;![CDATA[</span>citrus:xpath(citrus:readFile('some/path/to/file.xml'), '/message/id')<span class="inline-delimiter">]]&gt;</span><span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Also accessing the local message store is valid here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;echo&gt;</span>
    <span class="tag">&lt;message&gt;</span><span class="inline-delimiter">&lt;![CDATA[</span>citrus:xpath(citrus:message(myRequest.payload()), '/message/id')<span class="inline-delimiter">]]&gt;</span><span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This combination is quite powerful as all previously exchanged messages in the test are automatically stored to the local message store. Reusing dynamic message values from other messages
becomes very easy then.</p>
</div>
</div>
<div class="sect2">
<h3 id="functions-jsonpath"><a class="anchor" href="#functions-jsonpath"></a><a class="link" href="#functions-jsonpath">39.33. jsonPath()</a></h3>
<div class="paragraph">
<p>The <strong>jsonPath</strong> function evaluates a JsonPath expressions on some JSON source and returns the expression result as String.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;echo&gt;</span>
    <span class="tag">&lt;message&gt;</span><span class="inline-delimiter">&lt;![CDATA[</span>citrus:jsonPath('{ &quot;message&quot;: { &quot;id&quot;: 1000, &quot;text&quot;: &quot;Some text content&quot; } }', '$.message.id')<span class="inline-delimiter">]]&gt;</span><span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The JSON source is given as first function parameter and can be loaded in different ways. In the example above a static JSON source has been used. We could load the JSON content from
external file or just use a test variable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;echo&gt;</span>
    <span class="tag">&lt;message&gt;</span><span class="inline-delimiter">&lt;![CDATA[</span>citrus:jsonPath(${jsonSource}, '$.message.id')<span class="inline-delimiter">]]&gt;</span><span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Also accessing the local message store is valid here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;echo&gt;</span>
    <span class="tag">&lt;message&gt;</span><span class="inline-delimiter">&lt;![CDATA[</span>citrus:jsonPath(citrus:message(myRequest.payload()), '$.message.id')<span class="inline-delimiter">]]&gt;</span><span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/echo&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This combination is quite powerful as all previously exchanged messages in the test are automatically stored to the local message store. Reusing dynamic message values from other messages
becomes very easy then.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="validation-matcher"><a class="anchor" href="#validation-matcher"></a><a class="link" href="#validation-matcher">40. Validation matcher</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Message validation in Citrus is essential. The framework offers several validation mechanisms for different message types and formats. With test variables we are able to check for simple value equality. We ensure that message entries are equal to predefined expected values. Validation matcher add powerful assertion functionality on top of that. You just can use the predefined validation matcher functionalities in order to perform more complex assertions like <strong>contains</strong> or <strong>isNumber</strong> in your validation statements.</p>
</div>
<div class="paragraph">
<p>The following sections describe the Citrus default validation matcher implementations that are ready for usage. The matcher implementations should cover the basic assertions on character sequences and numbers. Of course you can add custom validation matcher implementations in order to meet your very specific validation assertions, too.</p>
</div>
<div class="paragraph">
<p>First of all let us have a look at a validation matcher statement in action so we understand how to use them in a test case.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;message&gt;</span>
    <span class="tag">&lt;payload&gt;</span>
        <span class="tag">&lt;RequestMessage&gt;</span>
            <span class="tag">&lt;MessageBody&gt;</span>
                <span class="tag">&lt;Customer&gt;</span>
                    <span class="tag">&lt;Id&gt;</span>@greaterThan(0)@<span class="tag">&lt;/Id&gt;</span>
                    <span class="tag">&lt;Name&gt;</span>@equalsIgnoreCase('foo')@<span class="tag">&lt;/Name&gt;</span>
                <span class="tag">&lt;/Customer&gt;</span>
            <span class="tag">&lt;/MessageBody&gt;</span>
        <span class="tag">&lt;/RequestMessage&gt;</span>
    <span class="tag">&lt;/payload&gt;</span>
<span class="tag">&lt;/message&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The listing above describes a normal message validation block inside a receive test action. We use some inline message payload template as CDATA. As you know Citrus will compare the actual message payload to this expected template in DOM tree comparison. In addition to that you can simply include validation matcher statements. The message element <strong>Id</strong> is automatically validated to be a number greater than zero and the <strong>Name</strong> character sequence is supposed to match 'foo' ignoring case spelling considerations.</p>
</div>
<div class="paragraph">
<p>Please note the special validation matcher syntax. The statements are surrounded with '@' markers and are identified by some unique name. The optional parameters passed to the matcher implementation state the expected values to match.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can use validation matcher with all validation mechanisms - not only with XML validation. Plaintext, JSON, SQL result set validation are also supported.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A set of validation matcher implementations is usually combined to a validation matcher library. The library has a prefix that will identify the validation matcher inside the test case. The default test framework validation matcher library uses a default prefix (citrus). You can write your own validation matcher library using your own prefix in order to extend the test framework functionality whenever you want.</p>
</div>
<div class="paragraph">
<p>The library is built in the Spring configuration and contains a set of validation matcher that are of public use.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:validation</span> <span class="attribute-name">matcher-library</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testMatcherLibrary</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">prefix</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo:</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;citrus:matcher</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">isNumber</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> class=&quot;com.consol.citrus.validation.matcher.core.IsNumberValidationMatcher&quot;/<span class="error">&gt;</span>
      <span class="tag">&lt;citrus:matcher</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">contains</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> class=&quot;com.consol.citrus.validation.matcher.core.ContainsValidationMatcher&quot;/<span class="error">&gt;</span>
      <span class="tag">&lt;citrus:matcher</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customMatcher</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span> ref=&quot;customMatcherBean&quot;/<span class="error">&gt;</span>
      ...
      <span class="tag">&lt;/citrus:validation</span> matcher-library<span class="error">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the library defines one to many validation matcher members either referenced as normal Spring bean or by its implementing Java class name. Citrus constructs the library and you are able to use the validation matcher in your test case with the leading library prefix just like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">@foo:isNumber()@
      @foo:contains()@
      @foo:customMatcher()@</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can add custom validation matcher implementations and custom validation matcher libraries. Just use a custom prefix for your library. The default Citrus validation matcher library uses no prefix.See now the following sections describing the default validation validation matcher in Citrus.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="matcher-ignore"><a class="anchor" href="#matcher-ignore"></a><a class="link" href="#matcher-ignore">40.1. ignore()</a></h3>
<div class="paragraph">
<p>The ignore validation matcher is a special matcher that ignores the value and is always positive in its outcome. You should use the ignore validation matcher when
only validating the pure existence of an element. The value is ignored but the element has to be present in the message payload.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;message&gt;</span>
    <span class="tag">&lt;payload&gt;</span>
        <span class="tag">&lt;RequestMessage&gt;</span>
            <span class="tag">&lt;MessageBody&gt;</span>
                <span class="tag">&lt;Customer&gt;</span>
                    <span class="tag">&lt;Id&gt;</span>@ignore()@<span class="tag">&lt;/Id&gt;</span>
                    <span class="tag">&lt;Name&gt;</span>@equalsIgnoreCase('foo')@<span class="tag">&lt;/Name&gt;</span>
                <span class="tag">&lt;/Customer&gt;</span>
            <span class="tag">&lt;/MessageBody&gt;</span>
        <span class="tag">&lt;/RequestMessage&gt;</span>
    <span class="tag">&lt;/payload&gt;</span>
<span class="tag">&lt;/message&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The ignore validation matcher is the only validation matcher that is able to skip the function parameter body. So you can use both <code>@ignore()@</code> and <code>@ignore@</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="matcher-matches-xml"><a class="anchor" href="#matcher-matches-xml"></a><a class="link" href="#matcher-matches-xml">40.2. matchesXml()</a></h3>
<div class="paragraph">
<p>The XML validation matcher implementation is the possibly most exciting one, as we can validate nested XML with full validation power (e.g. ignoring elements, variable support). The matcher checks a nested XML fragment to compare against expected XML. For instance we receive following XML message payload for validation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;GetCustomerMessage&gt;</span>
      <span class="tag">&lt;CustomerDetails&gt;</span>
          <span class="tag">&lt;Id&gt;</span>5<span class="tag">&lt;/Id&gt;</span>
          <span class="tag">&lt;Name&gt;</span>Christoph<span class="tag">&lt;/Name&gt;</span>
          <span class="tag">&lt;Configuration&gt;</span><span class="inline-delimiter">&lt;![CDATA[</span>
            &lt;config&gt;
                &lt;premium&gt;true&lt;/premium&gt;
                &lt;last-login&gt;2012-02-24T23:34:23&lt;/last-login&gt;
                &lt;link&gt;http://www.citrusframework.org/customer/5&lt;/link&gt;
            &lt;/config&gt;
          <span class="inline-delimiter">]]&gt;</span><span class="tag">&lt;/Configuration&gt;</span>
      <span class="tag">&lt;/CustomerDetails&gt;</span>
<span class="tag">&lt;/GetCustomerMessage&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the message payload contains some configuration as nested XML data in a CDATA section. We could validate this CDATA section as static character sequence comparison, true. But the &lt;last-login&gt; timestamp changes its value continuously. This breaks the static validation for CDATA elements in XML. Fortunately the new XML validation matcher provides a solution for us:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;message&gt;</span>
    <span class="tag">&lt;payload&gt;</span>
        <span class="tag">&lt;GetCustomerMessage&gt;</span>
            <span class="tag">&lt;CustomerDetails&gt;</span>
                <span class="tag">&lt;Id&gt;</span>5<span class="tag">&lt;/Id&gt;</span>
                <span class="tag">&lt;Name&gt;</span>Christoph<span class="tag">&lt;/Name&gt;</span>
                <span class="tag">&lt;Configuration&gt;</span>citrus:cdataSection('@matchesXml('<span class="tag">&lt;config&gt;</span>
                    <span class="tag">&lt;premium&gt;</span>${isPremium}<span class="tag">&lt;/premium&gt;</span>
                    <span class="tag">&lt;last-login&gt;</span>@ignore@<span class="tag">&lt;/last-login&gt;</span>
                    <span class="tag">&lt;link&gt;</span>http://www.citrusframework.org/customer/5<span class="tag">&lt;/link&gt;</span>
                  <span class="tag">&lt;/config&gt;</span>')@')<span class="tag">&lt;/Configuration&gt;</span>
            <span class="tag">&lt;/CustomerDetails&gt;</span>
        <span class="tag">&lt;/GetCustomerMessage&gt;</span>
    <span class="tag">&lt;/payload&gt;</span>
<span class="tag">&lt;/message&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With the validation matcher you are able to validate the nested XML with full validation power. Ignoring elements is possible and we can also use variables in our control XML.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Nested CDATA elements within other CDATA sections are not allowed by XML standard. This is why we create the nested CDATA section on the fly with the function cdataSection().
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="matcher-equals-ignore-case"><a class="anchor" href="#matcher-equals-ignore-case"></a><a class="link" href="#matcher-equals-ignore-case">40.3. equalsIgnoreCase()</a></h3>
<div class="paragraph">
<p>This matcher implementation checks for equality without any case spelling considerations. The matcher expects a single parameter as the expected character sequence to check for.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;value&gt;</span>@equalsIgnoreCase('foo')@<span class="tag">&lt;/value&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="matcher-contains"><a class="anchor" href="#matcher-contains"></a><a class="link" href="#matcher-contains">40.4. contains()</a></h3>
<div class="paragraph">
<p>This matcher searches for a character sequence inside the actual value. If the character sequence is not found somewhere the matcher starts complaining.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;value&gt;</span>@contains('foo')@<span class="tag">&lt;/value&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The validation matcher also exist in a case insensitive variant.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;value&gt;</span>@containsIgnoreCase('foo')@<span class="tag">&lt;/value&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="matcher-startswith"><a class="anchor" href="#matcher-startswith"></a><a class="link" href="#matcher-startswith">40.5. startsWith()</a></h3>
<div class="paragraph">
<p>The matcher implementation asserts that the given value starts with a character sequence otherwise the matcher will arise some error.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;value&gt;</span>@startsWith('foo')@<span class="tag">&lt;/value&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="matcher-endswith"><a class="anchor" href="#matcher-endswith"></a><a class="link" href="#matcher-endswith">40.6. endsWith()</a></h3>
<div class="paragraph">
<p>Ends with matcher validates a value to end with a given character sequence.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;value&gt;</span>@endsWith('foo')@<span class="tag">&lt;/value&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="matcher-matches"><a class="anchor" href="#matcher-matches"></a><a class="link" href="#matcher-matches">40.7. matches()</a></h3>
<div class="paragraph">
<p>You can check a value to meet a regular expression with this validation matcher. This is for instance very useful for email address validation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;value&gt;</span>@matches('[a-z0-9]')@<span class="tag">&lt;/value&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="matcher-matches-date-pattern"><a class="anchor" href="#matcher-matches-date-pattern"></a><a class="link" href="#matcher-matches-date-pattern">40.8. matchesDatePattern()</a></h3>
<div class="paragraph">
<p>Date values are always difficult to check for equality. Especially when you have millisecond timestamps to deal with. Therefore the date pattern validation matcher should have some improvement for you. You simply validate the date format pattern instead of checking for total equality.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;value&gt;</span>@matchesDatePattern('yyyy-MM-dd')@<span class="tag">&lt;/value&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The example listing uses a date format pattern that is expected. The actual date value is parsed according to this pattern and may cause errors in case the value is no valid date matching the desired format.</p>
</div>
</div>
<div class="sect2">
<h3 id="matcher-isnumber"><a class="anchor" href="#matcher-isnumber"></a><a class="link" href="#matcher-isnumber">40.9. isNumber()</a></h3>
<div class="paragraph">
<p>Checking on values to be of numeric nature is essential. The actual value must be a numeric number otherwise the matcher raises errors. The matcher implementation does not evaluate any parameters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;value&gt;</span>@isNumber()@<span class="tag">&lt;/value&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="matcher-lowerthan"><a class="anchor" href="#matcher-lowerthan"></a><a class="link" href="#matcher-lowerthan">40.10. lowerThan()</a></h3>
<div class="paragraph">
<p>This matcher checks a number to be lower than a given threshold value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;value&gt;</span>@lowerThan(5)@<span class="tag">&lt;/value&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="matcher-greaterthan"><a class="anchor" href="#matcher-greaterthan"></a><a class="link" href="#matcher-greaterthan">40.11. greaterThan()</a></h3>
<div class="paragraph">
<p>The matcher implementation will check on numeric values to be greater than a minimum value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;value&gt;</span>@greaterThan(5)@<span class="tag">&lt;/value&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="matcher-isweekday"><a class="anchor" href="#matcher-isweekday"></a><a class="link" href="#matcher-isweekday">40.12. isWeekday()</a></h3>
<div class="paragraph">
<p>The matcher works on date values and checks that a given date evaluates to the expected day of the week. The user defines the expected day by its name in uppercase characters. The matcher fails in case the given date is another week day than expected.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;someDate&gt;</span>@isWeekday('MONDAY')@<span class="tag">&lt;/someDate&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Possible values for the expected day of the week are: MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY or SUNDAY.</p>
</div>
<div class="paragraph">
<p>The field value has to be a date value otherwise the matcher will fail to parse the date. The matcher requires a date format which is <strong>dd.MM.yyyy</strong> by default. You can change this date format as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;someDate&gt;</span>@isWeekday(MONDAY('yyyy-MM-dd'))@<span class="tag">&lt;/someDate&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the matcher uses the custom date format in order to parse the date value for evaluation. The validation matcher also works with date time values. In this case you have to give a valid date time format respectively (e.g. FRIDAY('yyyy-MM-dd&#8217;T&#8217;hh:mm:ss')).</p>
</div>
</div>
<div class="sect2">
<h3 id="matcher-variable"><a class="anchor" href="#matcher-variable"></a><a class="link" href="#matcher-variable">40.13. variable()</a></h3>
<div class="paragraph">
<p>This is a very special validation matcher. Instead of performing a validation logic you can save the actual value passed to the validation matcher as new test variable. This comes very handy as you can use the matcher wherever you want: JSON message payloads, XML message payloads, headers and so on.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;value&gt;</span>@variable('foo')@<span class="tag">&lt;/value&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The validation matcher creates a new variable <strong>foo</strong> with the actual element value as variable value. When leaving out the control value the field name itself is used as variable name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;date&gt;</span>@variable()@<span class="tag">&lt;/date&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This creates a new variable <strong>date</strong> with the actual element value as variable value.</p>
</div>
</div>
<div class="sect2">
<h3 id="matcher-daterange"><a class="anchor" href="#matcher-daterange"></a><a class="link" href="#matcher-daterange">40.14. dateRange()</a></h3>
<div class="paragraph">
<p>The matcher works on date values and checks that a given date is within the expected date range. The user defines the expected date range by specifying a from-date, a to-date and optionally a date format. The matcher fails when the given date lies outside the expected date range.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;someDate&gt;</span>@dateRange('01-12-2015', '31-12-2015', 'dd-MM-yyyy')@<span class="tag">&lt;/someDate&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Possible valid values would be 'some date' &gt;= '01-12-2015' and 'some date' &lt;= '31-12-2015'</p>
</div>
<div class="paragraph">
<p>The date-format is optional and when omitted it is assumed that all dates match the default date format <strong>yyyy-MM-dd</strong> . When specifying a custom date format use java&#8217;s date format as a reference for valid date formats. Only dates were used in the example above but we could just as easily used date and time as shown in the example below</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;someDate&gt;</span>@dateRange('2015.12.01 07:00:00', '2015.12.01 19:00:00', 'yyyy.MM.dd HH:mm:ss')@<span class="tag">&lt;/someDate&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="matcher-assert-that"><a class="anchor" href="#matcher-assert-that"></a><a class="link" href="#matcher-assert-that">40.15. assertThat()</a></h3>
<div class="paragraph">
<p>Hamcrest is a very powerful matcher library with extraordinary matcher implementations. You can use Hamcrest matchers also as Citrus validation matcher.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;someValue&gt;</span>@assertThat(equalTo(foo))@<span class="tag">&lt;/someValue&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the listing above we are using the <strong>equalTo()</strong> matcher. All Hamcrest matchers are surrounded by a <strong>assertThat</strong> expression. You are able to combine several Hamcrest matchers then in order to construct very powerful validation logic. See the following examples on what is possible then:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;someValue&gt;</span>@assertThat(equalTo(value))@<span class="tag">&lt;/someValue&gt;</span>
<span class="tag">&lt;someValue&gt;</span>@assertThat(not(equalTo(other))@<span class="tag">&lt;/someValue&gt;</span>
<span class="tag">&lt;someValue&gt;</span>@assertThat(is(not(other)))@<span class="tag">&lt;/someValue&gt;</span>
<span class="tag">&lt;someValue&gt;</span>@assertThat(not(is(other)))@<span class="tag">&lt;/someValue&gt;</span>
<span class="tag">&lt;someValue&gt;</span>@assertThat(equalToIgnoringCase(VALUE))@<span class="tag">&lt;/someValue&gt;</span>
<span class="tag">&lt;someValue&gt;</span>@assertThat(containsString(lue))@<span class="tag">&lt;/someValue&gt;</span>
<span class="tag">&lt;someValue&gt;</span>@assertThat(not(containsString(other)))@<span class="tag">&lt;/someValue&gt;</span>
<span class="tag">&lt;someValue&gt;</span>@assertThat(startsWith(val))@<span class="tag">&lt;/someValue&gt;</span>
<span class="tag">&lt;someValue&gt;</span>@assertThat(endsWith(lue))@<span class="tag">&lt;/someValue&gt;</span>
<span class="tag">&lt;someValue&gt;</span>@assertThat(anyOf(startsWith(val), endsWith(lue)))@<span class="tag">&lt;/someValue&gt;</span>
<span class="tag">&lt;someValue&gt;</span>@assertThat(allOf(startsWith(val), endsWith(lue)))@<span class="tag">&lt;/someValue&gt;</span>
<span class="tag">&lt;someValue&gt;</span>@assertThat(isEmptyString())@<span class="tag">&lt;/someValue&gt;</span>
<span class="tag">&lt;someValue&gt;</span>@assertThat(not(isEmptyString()))@<span class="tag">&lt;/someValue&gt;</span>
<span class="tag">&lt;someValue&gt;</span>@assertThat(isEmptyOrNullString())@<span class="tag">&lt;/someValue&gt;</span>
<span class="tag">&lt;someValue&gt;</span>@assertThat(nullValue())@<span class="tag">&lt;/someValue&gt;</span>
<span class="tag">&lt;someValue&gt;</span>@assertThat(notNullValue())@<span class="tag">&lt;/someValue&gt;</span>
<span class="tag">&lt;someValue&gt;</span>@assertThat(empty())@<span class="tag">&lt;/someValue&gt;</span>
<span class="tag">&lt;someValue&gt;</span>@assertThat(not(empty())@<span class="tag">&lt;/someValue&gt;</span>
<span class="tag">&lt;someValue&gt;</span>@assertThat(greaterThan(4))@<span class="tag">&lt;/someValue&gt;</span>
<span class="tag">&lt;someValue&gt;</span>@assertThat(allOf(greaterThan(4), lessThan(6), not(lessThan(5)))@<span class="tag">&lt;/someValue&gt;</span>
<span class="tag">&lt;someValue&gt;</span>@assertThat(is(not(greaterThan(5))))@<span class="tag">&lt;/someValue&gt;</span>
<span class="tag">&lt;someValue&gt;</span>@assertThat(greaterThanOrEqualTo(5))@<span class="tag">&lt;/someValue&gt;</span>
<span class="tag">&lt;someValue&gt;</span>@assertThat(lessThan(5))@<span class="tag">&lt;/someValue&gt;</span>
<span class="tag">&lt;someValue&gt;</span>@assertThat(not(lessThan(1)))@<span class="tag">&lt;/someValue&gt;</span>
<span class="tag">&lt;someValue&gt;</span>@assertThat(lessThanOrEqualTo(4))@<span class="tag">&lt;/someValue&gt;</span>
<span class="tag">&lt;someValue&gt;</span>@assertThat(hasSize(5))@<span class="tag">&lt;/someValue&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Citrus will automatically perform validation matchers on the element value. Only if all matchers are satisfied the validation will pass.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="data-dictionaries"><a class="anchor" href="#data-dictionaries"></a><a class="link" href="#data-dictionaries">41. Data dictionaries</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Data dictionaries in Citrus provide a new way to manipulate message payload data before a message is sent or received. The dictionary defines a set of keys and respective values. Just like every other dictionary it is used to translate things. In our case we translate message data elements.</p>
</div>
<div class="paragraph">
<p>You can translate common message elements that are used widely throughout your domain model. As Citrus deals with different types of message data (e.g. XML, JSON) we have different dictionary implementations that are described in the next sections.</p>
</div>
<div class="sect2">
<h3 id="xml-data-dictionaries"><a class="anchor" href="#xml-data-dictionaries"></a><a class="link" href="#xml-data-dictionaries">41.1. XML data dictionaries</a></h3>
<div class="paragraph">
<p>As you would expect XML data dictionaries can be used together with XML formatted message payloads. To do so a dictionary has to be added to the basic Citrus Spring application context which will make the dictionary visible to all test cases:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:xml-data-dictionary</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nodeMappingDataDictionary</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;citrus:mappings&gt;</span>
    <span class="tag">&lt;citrus:mapping</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TestMessage.MessageId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:mapping</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TestMessage.CorrelationId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${correlationId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:mapping</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TestMessage.User</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Christoph</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:mapping</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TestMessage.TimeStamp</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate()</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/citrus:mappings&gt;</span>
<span class="tag">&lt;/citrus:xml-data-dictionary&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the dictionary is nothing but a normal Spring bean definition. The <strong>NodeMappingDataDictionary</strong> implementation receives a map of key value pairs where the key is a message element path expression. For XML payloads the message element tree is traversed so the path expression is built for an exact message element inside the payload. When matched the respective value is set according to the value stored within the dictionary.</p>
</div>
<div class="paragraph">
<p>Alternatively the key-value mappings can be defined in an external file and a reference to the file can be provided:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:xml-data-dictionary</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nodeMappingDataDictionary</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;citrus:mapping-file</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/sample.dictionary</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/citrus:xml-data-dictionary&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The mapping file content just looks like a normal property file in Java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">TestMessage.MessageId=${messageId}
TestMessage.CorrelationId=${correlationId}
TestMessage.User=Christoph
TestMessage.TimeStamp=citrus:currentDate()</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can set any message element value inside the XML message payload. The path expression also supports XML attributes. Just use the attribute name as the last part of the path expression. Let us have a closer look at a sample XML message payload with attributes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;TestMessage&gt;</span>
  <span class="tag">&lt;User</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Christoph</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">age</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">18</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/TestMessage&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Using this sample XML payload we can access the attributes in the data dictionary as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:mapping</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TestMessage.User.name</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${userName}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;citrus:mapping</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TestMessage.User.age</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${userAge}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>NodeMappingDataDictionary</strong> implementation is easy to use and can be used with most basic XML payloads.</p>
</div>
<div class="paragraph">
<p>For more complex XML payloads where more flexibility is required the XPath data dictionaries may be better suited:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:xpath-data-dictionary</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xpathMappingDataDictionary</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;citrus:mappings&gt;</span>
    <span class="tag">&lt;citrus:mapping</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//TestMessage/MessageId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:mapping</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//TestMessage/CorrelationId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${correlationId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:mapping</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//TestMessage/User</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Christoph</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:mapping</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//TestMessage/User/@id</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">123</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:mapping</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//TestMessage/TimeStamp</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate()</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/citrus:mappings&gt;</span>
<span class="tag">&lt;/citrus:xpath-data-dictionary&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As expected XPath mapping expressions are more powerful and can better handle complex scenarios with XML namespaces, attributes and node lists. Just like the node mapping dictionary the XPath mapping dictionary also supports variables, functions and an external mapping file.</p>
</div>
<div class="paragraph">
<p>XPath works fine with namespaces. In general it is good practice to define a namespace context where you map namespace URI values with prefix values. So your XPath expression is more precise and evaluation is strict. In Citrus the <strong>NamespaceContextBuilder</strong> which is also added as a normal Spring bean to the application context manages namespaces used in your XPath expressions. See our XML and XPath chapters in this documentation for detailed description how to accomplish fail safe XPath expressions with namespaces.</p>
</div>
<div class="paragraph">
<p>This completes the XML data dictionary usage in Citrus. Later on we will see some more advanced data dictionary scenarios where we will discuss the usage of dictionary scopes and mapping strategies. But before that let us have a look at other message formats like JSON messages.</p>
</div>
</div>
<div class="sect2">
<h3 id="json-data-dictionaries"><a class="anchor" href="#json-data-dictionaries"></a><a class="link" href="#json-data-dictionaries">41.2. JSON data dictionaries</a></h3>
<div class="paragraph">
<p>JSON data dictionaries complement with XML data dictionaries. As usual we have to add the JSON data dictionary to the basic Spring application context first. Once this is done the data dictionary automatically applies for all JSON message payloads in Citrus. This means that all JSON messages sent and received get translated with the JSON data dictionary implementation.</p>
</div>
<div class="paragraph">
<p>Citrus uses message types in order to evaluate which data dictionary may fit to the message that is currently processed. As usual you can define the message type directly in your test case as attribute inside the sending and receiving message action.</p>
</div>
<div class="paragraph">
<p>Let us see a simple dictionary for JSON data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:json-data-dictionary</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jsonMappingDataDictionary</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;citrus:mappings&gt;</span>
    <span class="tag">&lt;citrus:mapping</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TestMessage.MessageId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:mapping</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TestMessage.CorrelationId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${correlationId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:mapping</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TestMessage.User</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Christoph</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:mapping</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TestMessage.TimeStamp</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate()</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/citrus:mappings&gt;</span>
<span class="tag">&lt;/citrus:json-data-dictionary&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The message path expressions do look very similar to those used in XML data dictionaries. Here the path expression keys do apply to the JSON object graph. See the following sample JSON data which perfectly applies to the dictionary expressions above.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">{&quot;TestMessage&quot;: {
  &quot;MessageId&quot;: &quot;1122334455&quot;,
  &quot;CorrelationId&quot;: &quot;100000001&quot;,
  &quot;User&quot;: &quot;Christoph&quot;,
  &quot;TimeStamp&quot;: 1234567890 }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The path expressions will match a very specific message element inside the JSON object graph. The dictionary will automatically set the message element values then. The path expressions are easy to use as you can traverse the JSON object graph very easy.</p>
</div>
<div class="paragraph">
<p>Of course the data dictionary does also support test variables, functions. Also very interesting is the usage of JSON arrays. A JSON array element is referenced in a data dictionary like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:mapping</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TestMessage.Users[0]</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Christoph</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;citrus:mapping</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TestMessage.Users[1]</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Julia</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>Users</strong> element is a JSON array, so we can access the elements with index. Nesting JSON objects and arrays is also supported so you can also handle more complex JSON data.</p>
</div>
<div class="paragraph">
<p>The <strong>JsonMappingDataDictionary</strong> implementation is easy to use and fits the basic needs for JSON data dictionaries. The message element path expressions are very simple and do fit basic needs.
However when more complex JSON payloads apply for translation we might reach the boundaries here.</p>
</div>
<div class="paragraph">
<p>For more complex JSON message payloads JsonPath data dictionaries are very effective:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:json-path-data-dictionary</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jsonMappingDataDictionary</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;citrus:mappings&gt;</span>
    <span class="tag">&lt;citrus:mapping</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$.TestMessage.MessageId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${messageId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:mapping</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$..CorrelationId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${correlationId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:mapping</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$..Users[0]</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Christoph</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;citrus:mapping</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">$.TestMessage.TimeStamp</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate()</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/citrus:mappings&gt;</span>
<span class="tag">&lt;/citrus:json-path-data-dictionary&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>JsonPath mapping expressions are way more powerful and can also handle very complex scenarios. You can apply for all elements named <em>CorrelationId</em> in one single entry for instance.</p>
</div>
</div>
<div class="sect2">
<h3 id="dictionary-scopes"><a class="anchor" href="#dictionary-scopes"></a><a class="link" href="#dictionary-scopes">41.3. Dictionary scopes</a></h3>
<div class="paragraph">
<p>Now that we have learned how to add data dictionaries to Citrus we need to discuss some advanced topics. Data dictionary scopes do define the boundaries where the dictionary may apply. By default data dictionaries are global scope dictionaries. This means that the data dictionary applies to all messages sent and received with Citrus. Of course message types are considered so XML data dictionaries do only apply to XML message types. However global scope dictionaries will be activated throughout all test cases and actions.</p>
</div>
<div class="paragraph">
<p>You can overwrite the dictionary scope. For instance in order to use an explicit scope. When this is done the dictionary wil not apply automatically but the user has to explicitly set the data dictionary in sending or receiving test action. This way you can activate the dictionary to a very special set of test actions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:xml-data-dictionary</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">specialDataDictionary</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">global-scope</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;citrus:mapping-file</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:com/consol/citrus/sample.dictionary</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/citrus:xml-data-dictionary&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We set the global scope property to <strong>false</strong> so the dictionary is handled in explicit scope. This means that you have to set the data dictionary explicitly in your test actions:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;message</span> <span class="attribute-name">data-dictionary</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">specialDataDictionary</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;payload&gt;</span>
      <span class="tag">&lt;TestMessage&gt;</span>Hello Citrus<span class="tag">&lt;/TestMessage&gt;</span>
    <span class="tag">&lt;/payload&gt;</span>
  <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Java DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> dictionaryTest() {
    send(myEndpoint)
        .payload(<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;TestMessage&gt;Hello Citrus&lt;/TestMessage&gt;</span><span class="delimiter">&quot;</span></span>)
        .dictionary(<span class="string"><span class="delimiter">&quot;</span><span class="content">specialDataDictionary</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The sample above is a sending test action with an explicit data dictionary reference set. Before sending the message the dictionary is asked for translation. So all matching message element values will be set by the dictionary accordingly. Other global data dictionaries do also apply for this message but the explicit dictionary will always overwrite the message element values.</p>
</div>
</div>
<div class="sect2">
<h3 id="path-mapping-strategies"><a class="anchor" href="#path-mapping-strategies"></a><a class="link" href="#path-mapping-strategies">41.4. Path mapping strategies</a></h3>
<div class="paragraph">
<p>Another advanced topic about data dictionaries is the path mapping strategy. When using simple path expressions the default strategy is always <strong>EXACT</strong> . This means that the path expression has to evaluate exactly to a message element within the payload data. And only this exact message element is translated.</p>
</div>
<div class="paragraph">
<p>You can set your own path mapping strategy in order to change this behavior. For instance another mapping strategy would be <strong>STARS_WITH</strong> . All elements are translated that start with a certain path expression. Let us clarify this with an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:xml-data-dictionary</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nodeMappingDataDictionary</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mapping-strategy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">STARTS_WITH</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;citrus:mappings&gt;</span>
    <span class="tag">&lt;citrus:mapping</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TestMessage.Property</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:randomString()</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/citrus:mappings&gt;</span>
<span class="tag">&lt;/citrus:xml-data-dictionary&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now with the path mapping strategy set to <strong>STARS_WITH</strong> all message element path expressions starting with <strong>TestMessage.Property</strong> will find translation in this dictionary. Following sample message payload would be translated accordingly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;TestMessage&gt;</span>
    <span class="tag">&lt;Property&gt;</span>XXX<span class="tag">&lt;/Property&gt;</span>
    <span class="tag">&lt;PropertyName&gt;</span>XXX<span class="tag">&lt;/PropertyName&gt;</span>
    <span class="tag">&lt;PropertyValue&gt;</span>XXX<span class="tag">&lt;/PropertyValue&gt;</span>
  <span class="tag">&lt;/TestMessage&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>All child elements of <strong>TestMessage</strong> starting with <strong>Property</strong> will be translated with this data dictionary. In the resulting message payload Citrus will use a random string as value for these elements as we used the <strong>citrus:randomString()</strong> function in the dictionary mapping.</p>
</div>
<div class="paragraph">
<p>The next mapping strategy would be <strong>ENDS_WITH</strong> . No surprises here - this mapping strategy looks for message elements that end with a certain path expression. Again a simple example will clarify this for you.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:xml-data-dictionary</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">nodeMappingDataDictionary</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mapping-strategy</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ENDS_WITH</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;citrus:mappings&gt;</span>
    <span class="tag">&lt;citrus:mapping</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Id</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:randomNumber()</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/citrus:mappings&gt;</span>
<span class="tag">&lt;/citrus:xml-data-dictionary&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Again let us see some sample message payload for this dictionary usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;TestMessage&gt;</span>
  <span class="tag">&lt;RequestId&gt;</span>XXX<span class="tag">&lt;/RequestId&gt;</span>
  <span class="tag">&lt;Properties&gt;</span>
    <span class="tag">&lt;Property&gt;</span>
      <span class="tag">&lt;PropertyId&gt;</span>XXX<span class="tag">&lt;/PropertyId&gt;</span>
      <span class="tag">&lt;PropertyValue&gt;</span>XXX<span class="tag">&lt;/PropertyValue&gt;</span>
    <span class="tag">&lt;/Property&gt;</span>
    <span class="tag">&lt;Property&gt;</span>
      <span class="tag">&lt;PropertyId&gt;</span>XXX<span class="tag">&lt;/PropertyId&gt;</span>
      <span class="tag">&lt;PropertyValue&gt;</span>XXX<span class="tag">&lt;/PropertyValue&gt;</span>
    <span class="tag">&lt;/Property&gt;</span>
  <span class="tag">&lt;/Properties&gt;</span>
  <span class="tag">&lt;/TestMessage&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this sample all message elements ending with <strong>Id</strong> would be translated with a random number. No matter where in the message tree the elements are located. This is quite useful but also very powerful. So be careful to use this strategy in global data dictionaries as it may translate message elements that you would not expect in the first place.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="test-actors"><a class="anchor" href="#test-actors"></a><a class="link" href="#test-actors">42. Test actors</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The concept of test actors came to our mind when reusing Citrus test cases in end-to-end test scenarios. Usually Citrus simulates all interface partners within a test case which is great for continuous integration testing. In end-to-end integration test scenarios some of our interface partners may be real and alive. Some other interface partners still require Citrus simulation logic.</p>
</div>
<div class="paragraph">
<p>It would be great if we could reuse the Citrus integration tests in this test setup as we have the complete test flow of messages available in the Citrus tests. We only have to remove the simulated send/receive actions for those real interface partner applications which are available in our end-to-end test setup.</p>
</div>
<div class="paragraph">
<p>With test actors we have the opportunity to link test actions, in particular send/receive message actions, to a test actor. The test actor can be disabled in configuration very easy and following from that all linked send/receive actions are disabled, too. One Citrus test case is runnable with different test setup scenarios where different partner applications on the one hand are available as real life applications and on the other hand my require simulation.</p>
</div>
<div class="sect2">
<h3 id="define-test-actors"><a class="anchor" href="#define-test-actors"></a><a class="link" href="#define-test-actors">42.1. Define test actors</a></h3>
<div class="paragraph">
<p>First thing to do is to define one or more test actors in Citrus configuration. A test actor represents a participating party (e.g. interface partner, backend application). We write the test actors into the central Spring application context. We can use a special Citrus Spring XML schema so definitions are quite easy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:actor</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">travelagency</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TRAVEL_AGENCY</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;citrus:actor</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">royalairline</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ROYAL_AIRLINE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;citrus:actor</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">smartariline</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SMART_AIRLINE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The listing above defines three test actors participating in our test scenario. A travel agency application which is simulated by Citrus as a calling client, the smart airline application and a royal airline application. Now we have the test actors defined we can link those to message sender/receiver instances and/or test actions within our test case.</p>
</div>
</div>
<div class="sect2">
<h3 id="link-test-actors"><a class="anchor" href="#link-test-actors"></a><a class="link" href="#link-test-actors">42.2. Link test actors</a></h3>
<div class="paragraph">
<p>We need to link the test actors to message send and receive actions in our test cases. We can do this in two different ways. First we can set a test actor reference on a message sender and message receiver.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-jms:sync-endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">royalAirlineBookingEndpoint</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">destination-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${royal.airline.request.queue}</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">actor</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">royalairline</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now all test actions that are using these message receiver and message sender instances are linked to the test actor. In addition to that you can also explicitly link test actions to test actors in a test.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">royalAirlineBookingEndpoint</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">actor</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">royalairline</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        [...]
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/receive&gt;</span>

<span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">royalAirlineBookingEndpoint</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">actor</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">royalairline</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;message&gt;</span>
        [...]
    <span class="tag">&lt;/message&gt;</span>
<span class="tag">&lt;/send&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This explicitly links test actors to test actions so you can decide which link should be set without having to rely on the message receiver and sender configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="disable-test-actors"><a class="anchor" href="#disable-test-actors"></a><a class="link" href="#disable-test-actors">42.3. Disable test actors</a></h3>
<div class="paragraph">
<p>Usually both airline applications are simulated in our integration tests. But this time we want to change this by introducing a royal airline application which is online as a real application instance. So we need to skip all simulated message interactions for the royal airline application in our Citrus tests. This is easy as we have linked all send/receive actions to one of our test actors. So wen can disable the royal airline test actor in our configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:actor</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">royalairline</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ROYAL_AIRLINE</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">disabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Any test action linked to this test actor is now skipped. As we introduced a real royal airline application in our test scenario the requests get answered and the test should be successful within this end-to-end test scenario. The travel agency and the smart airline still get simulated by Citrus. This is a perfect way of reusing integration tests in different test scenarios where you enable and disable simulated participating parties in Citrus.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Server ports may be of special interest when dealing with different test scenarios. You may have to also disable a Citrus embedded Jetty server instance in order to avoid port binding conflicts and you may have to wire endpoint URIs accordingly before executing a test. The real life application may not use the same port and ip as the Citrus embedded servers for simulation.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="test-suite-actions"><a class="anchor" href="#test-suite-actions"></a><a class="link" href="#test-suite-actions">43. Test suite actions</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>A test framework should also provide the functionality to do some work before and after the test run. You could think of preparing/deleting the data in a database or starting/stopping a server in this section before/after a test run. These tasks fit best into the initialization and cleanup phases of Citrus.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is important to notice that the Citrus configuration components that we are going to use in the next section belong to a separate XML namespace <strong>citrus-test</strong> . We have to add the namespace declaration to the XML root element of our XML configuration file accordingly.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;spring:beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/testcase</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:spring</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:citrus-test</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/testcase</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
        <span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
        <span class="content">http://www.citrusframework.org/schema/testcase</span>
        <span class="content">http://www.citrusframework.org/schema/testcase/citrus-testcase.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

        [...]

        <span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="before-suite"><a class="anchor" href="#before-suite"></a><a class="link" href="#before-suite">43.1. Before suite</a></h3>
<div class="paragraph">
<p>You can influence the behavior of a test run in the initialization phase actually before the tests are executed. See the next code example to find out how it works with actions that take place before the first test is executed:</p>
</div>
<div class="listingblock">
<div class="title">XML Config</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:before-suite</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">actionsBeforeSuite</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:actions&gt;</span>
        <span class="comment">&lt;!-- list of actions before suite --&gt;</span>
    <span class="tag">&lt;/citrus:actions&gt;</span>
<span class="tag">&lt;/citrus:before-suite&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Citrus configuration component holds a list of Citrus test actions that get executed before the test suite run. You can add all Citrus test actions here as you would do in a normal test case definition.</p>
</div>
<div class="listingblock">
<div class="title">XML Config</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:before-suite</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">actionsBeforeSuite</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:actions&gt;</span>
        <span class="tag">&lt;citrus-test:sql</span> <span class="attribute-name">dataSource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;citrus-test:statement&gt;</span>CREATE TABLE PERSON (ID integer, NAME char(250))<span class="tag">&lt;/citrus-test:statement&gt;</span>
        <span class="tag">&lt;/citrus-test:sql&gt;</span>
    <span class="tag">&lt;/citrus:actions&gt;</span>
<span class="tag">&lt;/citrus:before-suite&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that we must use the Citrus test case namespace for the nested test action definitions. We access the database and create a table PERSON which is obviously needed in our test cases. You can think of several actions here to prepare the database for instance.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Citrus offers special startup and shutdown actions that may start and stop server implementations automatically. This might be helpful when dealing with Http servers or WebService containers like Jetty. You can also think of starting/stopping a JMS broker before a test run.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>So far we have used XML DSL actions in before suite configuration. Now if you exclusively want to use Java DSL you can do the same with adding a custom class that extends <strong>TestDesignerBeforeSuiteSupport</strong> or <strong>TestRunnerBeforeSuiteSupport</strong> .</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyBeforeSuite</span> <span class="directive">extends</span> TestDesignerBeforeSuiteSupport {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> beforeSuite(TestDesigner designer) {
        designer.echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">This action should be executed before suite</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The custom implementation extends <strong>TestDesignerBeforeSuiteSupport</strong> and therefore has to implement the method <strong>beforeSuite</strong> . This method add some Java DSL designer logic to the before suite. The designer instance is injected as method argument. You can use all Java DSL methods to this designer instance. Citrus will automatically find and execute the before suite logic. We only need to add this class to the Spring bean application context. You can do this explicitly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myBeforeSuite</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">my.company.citrus.MyBeforeSuite</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course you can also use other Spring bean mechanisms such as component-scans here too. The respective test runner implementation extends the <strong>TestRunnerBeforeSuiteSupport</strong> and gets a test runner instance as method argument injected.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyBeforeSuite</span> <span class="directive">extends</span> TestRunnerBeforeSuiteSupport {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> beforeSuite(TestRunner runner) {
        runner.echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">This action should be executed before suite</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can have many before-suite configuration components with different ids in a Citrus project. By default the containers are always executed. But you can restrict the after suite action container execution by defining a suite name, test group names, environment or system properties that should match accordingly:</p>
</div>
<div class="listingblock">
<div class="title">XML Config</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:before-suite</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">actionsBeforeSuite</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">suites</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">databaseSuite</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">groups</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">e2e</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:actions&gt;</span>
        <span class="tag">&lt;citrus-test:sql</span> <span class="attribute-name">dataSource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;citrus-test:statement&gt;</span>CREATE TABLE PERSON (ID integer, NAME char(250))<span class="tag">&lt;/citrus-test:statement&gt;</span>
        <span class="tag">&lt;/citrus-test:sql&gt;</span>
    <span class="tag">&lt;/citrus:actions&gt;</span>
<span class="tag">&lt;/citrus:before-suite&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above before suite container is only executed with the test suite called <strong>databaseSuite</strong> or when the test group <strong>e2e</strong> is defined. Test groups and suite names are only supported when using the TestNG unit test framework. Unfortunately JUnit does not allow to hook into suite execution as easily as TestNG does.
This is why after suite action containers are not restricted in execution when using Citrus with the JUnit test framework. You can define multiple suite names and test groups with comma delimited strings as attribute values.</p>
</div>
<div class="paragraph">
<p>When using the Java DSL before suite support you can set suite names and test group filters by simply calling the respective setter methods in your custom implementation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myBeforeSuite</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">my.company.citrus.MyBeforeSuite</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">suiteNames</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;list&gt;</span>
      <span class="tag">&lt;value&gt;</span>databaseSuite<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;/list&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testGroups</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;list&gt;</span>
      <span class="tag">&lt;value&gt;</span>e2e<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;/list&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Environment or system properties are defined as list of key-value pairs. When specified the properties have to be present with respective value. In case the property value is left out in configuration the property must simply exists on the system
in order to enable the before suite sequence in that test run.</p>
</div>
<div class="listingblock">
<div class="title">XML Config</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:before-suite</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">actionsBeforeSuite</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">suites</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">databaseSuite</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">groups</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">e2e</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:env&gt;</span>
      <span class="tag">&lt;citrus:property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">USER</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/citrus:env&gt;</span>
    <span class="tag">&lt;citrus:system&gt;</span>
      <span class="tag">&lt;citrus:property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">test-stage</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">e2e</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/citrus:system&gt;</span>
    <span class="tag">&lt;citrus:actions&gt;</span>
        <span class="tag">&lt;citrus-test:sql</span> <span class="attribute-name">dataSource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;citrus-test:statement&gt;</span>CREATE TABLE PERSON (ID integer, NAME char(250))<span class="tag">&lt;/citrus-test:statement&gt;</span>
        <span class="tag">&lt;/citrus-test:sql&gt;</span>
    <span class="tag">&lt;/citrus:actions&gt;</span>
<span class="tag">&lt;/citrus:before-suite&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above the suite sequence will only apply on environments with <em>USER</em> property set and the system property <em>test-stage</em> must be set to <em>e2e</em>. Otherwise
the sequence execution is skipped.</p>
</div>
</div>
<div class="sect2">
<h3 id="after-suite"><a class="anchor" href="#after-suite"></a><a class="link" href="#after-suite">43.2. After suite</a></h3>
<div class="paragraph">
<p>A test run may require the test environment to be clean. Therefore it is a good idea to purge all JMS destinations or clean up the database after the test run in order to avoid errors in follow-up test runs. Just like we prepared some data in actions before suite we can clean up the test run in actions after the tests are finished. The Spring bean syntax here is not significantly different to those in before suite section:</p>
</div>
<div class="listingblock">
<div class="title">XML Config</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:after-suite</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">actionsAfterSuite</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:actions&gt;</span>
        <span class="comment">&lt;!-- list of actions after suite --&gt;</span>
    <span class="tag">&lt;/citrus:actions&gt;</span>
<span class="tag">&lt;/citrus:after-suite&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Again we give the after suite configuration component a unique id within the configuration and put one to many test actions as nested configuration elements to the list of actions executed after the test suite run.</p>
</div>
<div class="listingblock">
<div class="title">XML Config</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:after-suite</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">actionsAfterSuite</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:actions&gt;</span>
        <span class="tag">&lt;citrus-test:sql</span> <span class="attribute-name">dataSource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;citrus-test:statement&gt;</span>DELETE FROM TABLE PERSON<span class="tag">&lt;/citrus-test:statement&gt;</span>
        <span class="tag">&lt;/citrus-test:sql&gt;</span>
    <span class="tag">&lt;/citrus:actions&gt;</span>
<span class="tag">&lt;/citrus:after-suite&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We have to use the Citrus test case XML namespace when defining nested test actions in after suite list. We just remove all data from the database so we do not influence follow-up tests. Quite simple isn&#8217;t it!?</p>
</div>
<div class="paragraph">
<p>Of course we can also define Java DSL after suite actions. You can do this by adding a custom class that extends <strong>TestDesignerAfterSuiteSupport</strong> or <strong>TestRunnerAfterSuiteSupport</strong> .</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyAfterSuite</span> <span class="directive">extends</span> TestDesignerAfterSuiteSupport {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> afterSuite(TestDesigner designer) {
        designer.echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">This action should be executed after suite</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The custom implementation extends <strong>TestDesignerAfterSuiteSupport</strong> and therefore has to implement the method <strong>afterSuite</strong> . This method add some Java DSL designer logic to the after suite. The designer instance is injected as method argument. You can use all Java DSL methods to this designer instance. Citrus will automatically find and execute the after suite logic. We only need to add this class to the Spring bean application context. You can do this explicitly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myAfterSuite</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">my.company.citrus.MyAfterSuite</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course you can also use other Spring bean mechanisms such as component-scans here too. The respective test runner implementation extends the <strong>TestRunnerAfterSuiteSupport</strong> and gets a test runner instance as method argument injected.</p>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyAfterSuite</span> <span class="directive">extends</span> TestRunnerAfterSuiteSupport {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> afterSuite(TestRunner runner) {
        runner.echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">This action should be executed after suite</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can have many after-suite configuration components with different ids in a Citrus project. By default the containers are always executed. But you can restrict the after suite action container execution by defining a suite name, test group names, environment or system properties that should match accordingly:</p>
</div>
<div class="listingblock">
<div class="title">XML Config</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:after-suite</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">actionsAfterSuite</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">suites</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">databaseSuite</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">groups</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">e2e</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:actions&gt;</span>
        <span class="tag">&lt;citrus-test:sql</span> <span class="attribute-name">dataSource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;citrus-test:statement&gt;</span>DELETE FROM TABLE PERSON<span class="tag">&lt;/citrus-test:statement&gt;</span>
        <span class="tag">&lt;/citrus-test:sql&gt;</span>
    <span class="tag">&lt;/citrus:actions&gt;</span>
<span class="tag">&lt;/citrus:after-suite&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above after suite container is only executed with the test suite called <strong>databaseSuite</strong> or when the test group <strong>e2e</strong> is defined. Test groups and suite names are only supported when using the TestNG unit test framework.
Unfortunately JUnit does not allow to hook into suite execution as easily as TestNG does. This is why after suite action containers are not restricted in execution when using Citrus with the JUnit test framework.</p>
</div>
<div class="paragraph">
<p>You can define multiple suite names and test groups with comma delimited strings as attribute values.</p>
</div>
<div class="paragraph">
<p>When using the Java DSL before suite support you can set suite names and test group filters by simply calling the respective setter methods in your custom implementation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myAfterSuite</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">my.company.citrus.MyAfterSuite</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">suiteNames</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;list&gt;</span>
      <span class="tag">&lt;value&gt;</span>databaseSuite<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;/list&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testGroups</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;list&gt;</span>
      <span class="tag">&lt;value&gt;</span>e2e<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;/list&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Environment or system properties are defined as list of key-value pairs. When specified the properties have to be present with respective value. In case the property value is left out in configuration the property must simply exists on the system
in order to enable the before suite sequence in that test run.</p>
</div>
<div class="listingblock">
<div class="title">XML Config</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:after-suite</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">actionsBeforeSuite</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">suites</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">databaseSuite</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">groups</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">e2e</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:env&gt;</span>
      <span class="tag">&lt;citrus:property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">USER</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/citrus:env&gt;</span>
    <span class="tag">&lt;citrus:system&gt;</span>
      <span class="tag">&lt;citrus:property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">test-stage</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">e2e</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/citrus:system&gt;</span>
    <span class="tag">&lt;citrus:actions&gt;</span>
        <span class="tag">&lt;citrus-test:sql</span> <span class="attribute-name">dataSource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;citrus-test:statement&gt;</span>DELETE FROM TABLE PERSON<span class="tag">&lt;/citrus-test:statement&gt;</span>
        <span class="tag">&lt;/citrus-test:sql&gt;</span>
    <span class="tag">&lt;/citrus:actions&gt;</span>
<span class="tag">&lt;/citrus:after-suite&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above the suite sequence will only apply on environments with <em>USER</em> property set and the system property <em>test-stage</em> must be set to <em>e2e</em>. Otherwise
the sequence execution is skipped.</p>
</div>
</div>
<div class="sect2">
<h3 id="before-test"><a class="anchor" href="#before-test"></a><a class="link" href="#before-test">43.3. Before test</a></h3>
<div class="paragraph">
<p>Before each test is executed it also might sound reasonable to purge all JMS queues for instance. In case a previous test fails some messages might be left in the JMS queues. Also the database might be in dirty state. The follow-up test then will be confronted with these invalid messages and data. Purging all JMS destinations before a test is therefore a good idea. Just like we prepared some data in actions before suite we can clean up the data before a test starts to execute.</p>
</div>
<div class="listingblock">
<div class="title">XML Config</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:before-test</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultBeforeTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:actions&gt;</span>
        <span class="comment">&lt;!-- list of actions before test --&gt;</span>
    <span class="tag">&lt;/citrus:actions&gt;</span>
<span class="tag">&lt;/citrus:before-test&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The before test configuration component receives a unique id and a list of test actions that get executed before a test case is started. The component receives usual test action definitions just like you would write them in a normal test case definition. See the example below how to add test actions.</p>
</div>
<div class="listingblock">
<div class="title">XML Config</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:before-test</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultBeforeTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:actions&gt;</span>
            <span class="tag">&lt;citrus-test:echo&gt;</span>
              <span class="tag">&lt;citrus-test:message&gt;</span>This is executed before each test!<span class="tag">&lt;/citrus-test:message&gt;</span>
            <span class="tag">&lt;/citrus-test:echo&gt;</span>
    <span class="tag">&lt;/citrus:actions&gt;</span>
<span class="tag">&lt;/citrus:before-test&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that we must use the Citrus test case XML namespace for the nested test action definitions. You have to declare the XML namespaces accordingly in your configuration root element. The echo test action is now executed before each test in our test suite run. Also notice that we can restrict the before test container execution. We can restrict execution based on the test name, package, test groups and environment or system properties. See following example how this works:</p>
</div>
<div class="listingblock">
<div class="title">XML Config</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:before-test</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultBeforeTest</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">test</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">*_Ok_Test</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">package</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.longrunning.*</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:actions&gt;</span>
        <span class="tag">&lt;citrus-test:echo&gt;</span>
          <span class="tag">&lt;citrus-test:message&gt;</span>This is executed before each test!<span class="tag">&lt;/citrus-test:message&gt;</span>
        <span class="tag">&lt;/citrus-test:echo&gt;</span>
    <span class="tag">&lt;/citrus:actions&gt;</span>
<span class="tag">&lt;/citrus:before-test&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above before test component is only executed for test cases that match the name pattern <code>\*_Ok_Test</code> and that match the package <code>com.consol.citrus.longrunning.*</code>. Also we could just use the test name pattern or the package name pattern exclusively. And the execution can be restricted based on the included test groups in our test suite run. This enables us to specify before test actions in various ways. Of course you can have multiple before test configuration components at the same time. Citrus will pick the right containers and put it to execution when necessary.</p>
</div>
<div class="paragraph">
<p>Environment or system properties are defined as list of key-value pairs. When specified the properties have to be present with respective value. In case the property value is left out in configuration the property must simply exists on the system
in order to enable the before suite sequence in that test run.</p>
</div>
<div class="listingblock">
<div class="title">XML Config</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:before-test</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">specialBeforeTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:env&gt;</span>
      <span class="tag">&lt;citrus:property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">USER</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/citrus:env&gt;</span>
    <span class="tag">&lt;citrus:system&gt;</span>
      <span class="tag">&lt;citrus:property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">test-stage</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">e2e</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/citrus:system&gt;</span>
    <span class="tag">&lt;citrus:actions&gt;</span>
        <span class="tag">&lt;citrus-test:echo&gt;</span>
          <span class="tag">&lt;citrus-test:message&gt;</span>This is executed before each test!<span class="tag">&lt;/citrus-test:message&gt;</span>
        <span class="tag">&lt;/citrus-test:echo&gt;</span>
    <span class="tag">&lt;/citrus:actions&gt;</span>
<span class="tag">&lt;/citrus:before-test&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above the test sequence will only apply on environments with <em>USER</em> property set and the system property <em>test-stage</em> must be set to <em>e2e</em>. Otherwise
the sequence execution is skipped.</p>
</div>
<div class="paragraph">
<p>When using the Java DSL we need to implement the before test logic in a separate class that extends <strong>TestDesignerBeforeTestSupport</strong> or <strong>TestRunnerBeforeTestSupport</strong></p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyBeforeTest</span> <span class="directive">extends</span> TestDesignerBeforeTestSupport {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> beforeTest(TestDesigner designer) {
        designer.echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">This action should be executed before each test</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the class implements the method <strong>beforeTest</strong> that is provided with a test designer argument. You simply add the before test actions to the designer instance as usual by calling Java DSL methods on the designer object. Citrus will automatically execute these operations before each test is executed. The same logic applies to the test runner variation that extends <strong>TestRunnerBeforeTestSupport</strong> :</p>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyBeforeTest</span> <span class="directive">extends</span> TestRunnerBeforeTestSupport {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> beforeTest(TestRunner runner) {
        runner.echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">This action should be executed before each test</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The before test implementations are added to the Spring bean application context for general activation. You can do this either as explicit Spring bean definition or via package component-scan. Here is a sample for adding the bean implementation explicitly with some configuration</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myBeforeTest</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">my.company.citrus.MyBeforeTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">packageNamePattern</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.e2e</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can add filter properties to the before test Java DSL actions so they applied to specific packages or test name patterns. The above example will only apply to tests in package <strong>com.consol.citrus.e2e</strong> . Leave these properties empty for default actions that are executed before all tests.</p>
</div>
</div>
<div class="sect2">
<h3 id="after-test"><a class="anchor" href="#after-test"></a><a class="link" href="#after-test">43.4. After test</a></h3>
<div class="paragraph">
<p>The same logic that applies to the <strong>before-test</strong> configuration component can be done after each test. The <strong>after-test</strong> configuration component defines test actions executed after each test. Just like we prepared some data in actions before a test we can clean up the data after a test has finished execution.</p>
</div>
<div class="listingblock">
<div class="title">XML Config</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:after-test</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultAfterTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:actions&gt;</span>
        <span class="comment">&lt;!-- list of actions after test --&gt;</span>
    <span class="tag">&lt;/citrus:actions&gt;</span>
<span class="tag">&lt;/citrus:after-test&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The after test configuration component receives a unique id and a list of test actions that get executed after a test case is finished. Notice that the after test actions are executed no matter what result success or failure the previous test case came up to. The component receives usual test action definitions just like you would write them in a normal test case definition. See the example below how to add test actions.</p>
</div>
<div class="listingblock">
<div class="title">XML Config</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:after-test</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultAfterTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:actions&gt;</span>
            <span class="tag">&lt;citrus-test:echo&gt;</span>
              <span class="tag">&lt;citrus-test:message&gt;</span>This is executed after each test!<span class="tag">&lt;/citrus-test:message&gt;</span>
            <span class="tag">&lt;/citrus-test:echo&gt;</span>
    <span class="tag">&lt;/citrus:actions&gt;</span>
<span class="tag">&lt;/citrus:after-test&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Please be aware of the fact that we must use the Citrus test case XML namespace for the nested test action definitions. You have to declare the XML namespaces accordingly in your configuration root element. The echo test action is now executed after each test in our test suite run. Of course we can restrict the after test container execution. Supported restrictions are based on the test name, package, test groups and environment or system properties. See following example how this works:</p>
</div>
<div class="listingblock">
<div class="title">XML Config</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:after-test</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">defaultAfterTest</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">test</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">*_Error_Test</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">package</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.error.*</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:actions&gt;</span>
        <span class="tag">&lt;citrus-test:echo&gt;</span>
          <span class="tag">&lt;citrus-test:message&gt;</span>This is executed after each test!<span class="tag">&lt;/citrus-test:message&gt;</span>
        <span class="tag">&lt;/citrus-test:echo&gt;</span>
    <span class="tag">&lt;/citrus:actions&gt;</span>
<span class="tag">&lt;/citrus:after-test&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above after test component is obviously only executed for test cases that match the name pattern <code>\*_Error_Test</code> and that match the package <code>com.consol.citrus.error.*</code>. Also we could just use the test name pattern or the package name pattern exclusively. And the execution can be restricted based on the included test groups in our test suite run. This enables us to specify after test actions in various ways. Of course you can have multiple after test configuration components at the same time.
Citrus will pick the right containers and put it to execution when necessary.</p>
</div>
<div class="paragraph">
<p>Environment or system properties are defined as list of key-value pairs. When specified the properties have to be present with respective value. In case the property value is left out in configuration the property must simply exists on the system
in order to enable the before suite sequence in that test run.</p>
</div>
<div class="listingblock">
<div class="title">XML Config</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus:after-test</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">specialAfterTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;citrus:env&gt;</span>
      <span class="tag">&lt;citrus:property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">USER</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/citrus:env&gt;</span>
    <span class="tag">&lt;citrus:system&gt;</span>
      <span class="tag">&lt;citrus:property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">test-stage</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">e2e</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/citrus:system&gt;</span>
    <span class="tag">&lt;citrus:actions&gt;</span>
        <span class="tag">&lt;citrus-test:echo&gt;</span>
          <span class="tag">&lt;citrus-test:message&gt;</span>This is executed after each test!<span class="tag">&lt;/citrus-test:message&gt;</span>
        <span class="tag">&lt;/citrus-test:echo&gt;</span>
    <span class="tag">&lt;/citrus:actions&gt;</span>
<span class="tag">&lt;/citrus:after-test&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above the test sequence will only apply on environments with <em>USER</em> property set and the system property <em>test-stage</em> must be set to <em>e2e</em>. Otherwise
the sequence execution is skipped.</p>
</div>
<div class="paragraph">
<p>When using the Java DSL we need to implement the after test logic in a separate class that extends <strong>TestDesignerAfterTestSupport</strong> or <strong>TestRunnerAfterTestSupport</strong></p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyAfterTest</span> <span class="directive">extends</span> TestDesignerAfterTestSupport {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> afterTest(TestDesigner designer) {
        designer.echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">This action should be executed after each test</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the class implements the method <strong>afterTest</strong> that is provided with a test designer argument. You simply add the after test actions to the designer instance as usual by calling Java DSL methods on the designer object. Citrus will automatically execute these operations after each test is executed. The same logic applies to the test runner variation that extends <strong>TestRunnerAfterTestSupport</strong> :</p>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyAfterTest</span> <span class="directive">extends</span> TestRunnerAfterTestSupport {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> afterTest(TestRunner runner) {
        runner.echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">This action should be executed after each test</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The after test implementations are added to the Spring bean application context for general activation. You can do this either as explicit Spring bean definition or via package component-scan. Here is a sample for adding the bean implementation explicitly with some configuration</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myAfterTest</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">my.company.citrus.MyAfterTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">packageNamePattern</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.e2e</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can add filter properties to the after test Java DSL actions so they applied to specific packages or test name patterns. The above example will only apply to tests in package <strong>com.consol.citrus.e2e</strong> . Leave these properties empty for default actions that are executed after all tests.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="finally-section"><a class="anchor" href="#finally-section"></a><a class="link" href="#finally-section">44. Finally section</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter deals with a special section inside the test case that is executed even in case errors did occur during the test. Lets say you have started a Jetty web server instance at the beginning of the test case and you need to shutdown the server when the test has finished its work. Or as a second example imagine that you have prepared some data inside the database at the beginning of your test and you want to make sure that the data is cleaned up at the end of the test case.</p>
</div>
<div class="paragraph">
<p>In both situations we might run into some problems when the test failed. We face the problem that the whole test case will terminate immediately in case of errors. Cleanup tasks at the end of the test action chain may not be executed correctly.</p>
</div>
<div class="paragraph">
<p>Dirty states inside the database or still running server instances then might cause problems for following test cases. To avoid this problems you should use the finally block of the test case. The &lt;finally&gt; section contains actions that are executed even in case the test fails. Using this strategy the database cleaning tasks mentioned before will find execution in every case (success or failure).</p>
</div>
<div class="paragraph">
<p>The following example shows how to use the finally section at the end of a test:</p>
</div>
<div class="listingblock">
<div class="title">XML DSL</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">finallyTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;variables&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">orderId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:randomNumber(5)</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate('dd.MM.yyyy')</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/variables&gt;</span>
    <span class="tag">&lt;actions&gt;</span>
        <span class="tag">&lt;sql</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;statement&gt;</span>
                INSERT INTO ORDERS VALUES (${orderId}, 1, 1, '${date}')
            <span class="tag">&lt;/statement&gt;</span>
        <span class="tag">&lt;/sql&gt;</span>

        <span class="tag">&lt;echo&gt;</span>
            <span class="tag">&lt;message&gt;</span>
                ORDER creation time: ${date}
            <span class="tag">&lt;/message&gt;</span>
        <span class="tag">&lt;/echo&gt;</span>
    <span class="tag">&lt;/actions&gt;</span>
    <span class="tag">&lt;finally&gt;</span>
        <span class="tag">&lt;sql</span> <span class="attribute-name">datasource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">testDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;statement&gt;</span>
              DELETE FROM ORDERS WHERE ORDER_ID='${orderId}'
            <span class="tag">&lt;/statement&gt;</span>
        <span class="tag">&lt;/sql&gt;</span>
    <span class="tag">&lt;/finally&gt;</span>
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example the first action creates an entry in the database using an <strong><em>INSERT</em></strong> statement. To be sure that the entry in the database is deleted after the test, the finally section contains the respective <strong><em>DELETE</em></strong> statement that is always executed regardless the test case state (successful or failed).</p>
</div>
<div class="paragraph">
<p>Of course you can also use the finally block in the Java test case DSL. Find following example to see how it works:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL designer</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> finallySectionTest() {
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">orderId</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:randomNumber(5)</span><span class="delimiter">&quot;</span></span>);
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate('dd.MM.yyyy')</span><span class="delimiter">&quot;</span></span>);

    sql(dataSource)
        .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO ORDERS VALUES (${orderId}, 1, 1, '${date}')</span><span class="delimiter">&quot;</span></span>);

    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">ORDER creation time: citrus:currentDate('dd.MM.yyyy')</span><span class="delimiter">&quot;</span></span>);

    doFinally(
        sql(dataSource).statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">DELETE FROM ORDERS WHERE ORDER_ID='${orderId}'</span><span class="delimiter">&quot;</span></span>)
    );
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Java developers might ask why not use try-finally Java block instead? The answer is simple yet very important to understand. The <strong>@CitrusTest</strong> annotated method is called at design time of the test case. The method builds the test case afterwards the test is executed at runtime. This means that a try-finally block within the <strong>@CitrusTest</strong> annotated method will never perform during the test run but at design time before the test gets executed. This is why we have to add the finally section as part of the test case with <strong>doFinally()</strong> .
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> finallySectionTest() {
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">orderId</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:randomNumber(5)</span><span class="delimiter">&quot;</span></span>);
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate('dd.MM.yyyy')</span><span class="delimiter">&quot;</span></span>);

    doFinally()
        .actions(
            sql(action -&gt; action.dataSource(dataSource).statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">DELETE FROM ORDERS WHERE ORDER_ID='${orderId}'</span><span class="delimiter">&quot;</span></span>))
        );

    sql(action -&gt; action.dataSource(dataSource)
            .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO ORDERS VALUES (${orderId}, 1, 1, '${date}')</span><span class="delimiter">&quot;</span></span>));

    echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">ORDER creation time: citrus:currentDate('dd.MM.yyyy')</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the <code>doFinally()</code> is also available in test runner DSL. Please notice that the finally section is then placed at the very beginning of the test. This is because the test runner is immediately executing
each test action as it is called within the Java DSL methods. This is the only way the test case can perform the final actions also in case of previous error. A finally section placed at the very end of the test will not take action
unless put in a traditional Java try-finally-block:</p>
</div>
<div class="listingblock">
<div class="title">Java DSL runner</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@CitrusTest</span>
<span class="directive">public</span> <span class="type">void</span> finallySectionTest() {
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">orderId</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:randomNumber(5)</span><span class="delimiter">&quot;</span></span>);
    variable(<span class="string"><span class="delimiter">&quot;</span><span class="content">date</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:currentDate('dd.MM.yyyy')</span><span class="delimiter">&quot;</span></span>);

    <span class="keyword">try</span> {
        sql(action -&gt; action.dataSource(dataSource)
            .statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO ORDERS VALUES (${orderId}, 1, 1, '${date}')</span><span class="delimiter">&quot;</span></span>));

        echo(<span class="string"><span class="delimiter">&quot;</span><span class="content">ORDER creation time: citrus:currentDate('dd.MM.yyyy')</span><span class="delimiter">&quot;</span></span>);
    } <span class="keyword">finally</span> {
        sql(action -&gt; action.dataSource(dataSource).statement(<span class="string"><span class="delimiter">&quot;</span><span class="content">DELETE FROM ORDERS WHERE ORDER_ID='${orderId}'</span><span class="delimiter">&quot;</span></span>));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the traditional Java try-finally feels more natural no doubt. Please notice that the Citrus report and logging will not account the finally block actions in detail then. Good news is whatever layout you choose -
the outcome is always the same. The finally block is executed safely even in case some previous test action raises an error for some reason.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="customize-meta-information"><a class="anchor" href="#customize-meta-information"></a><a class="link" href="#customize-meta-information">45. Customize meta information</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Test cases in Citrus are usually provided with some meta information like the author’s name or the date of creation. In Citrus you are able to extend this test case meta information with your own very specific criteria.</p>
</div>
<div class="paragraph">
<p>By default a test case comes shipped with meta information that looks like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PwdChange_OK_1_Test</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;meta-info&gt;</span>
        <span class="tag">&lt;author&gt;</span>Christoph<span class="tag">&lt;/author&gt;</span>
        <span class="tag">&lt;creationdate&gt;</span>2010-01-18<span class="tag">&lt;/creationdate&gt;</span>
        <span class="tag">&lt;status&gt;</span>FINAL<span class="tag">&lt;/status&gt;</span>
        <span class="tag">&lt;last-updated-by&gt;</span>Christoph<span class="tag">&lt;/last-updated-by&gt;</span>
        <span class="tag">&lt;last-updated-on&gt;</span>2010-01-18T15:00:00<span class="tag">&lt;/last-updated-on&gt;</span>
    <span class="tag">&lt;/meta-info&gt;</span>

    [...]
<span class="tag">&lt;/testcase&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can quite easily add data to this section in order to meet your individual testing strategy. Let us have a simple example to show how it is done.</p>
</div>
<div class="paragraph">
<p>First of all we define a custom XSD schema describing the new elements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;schema</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">xmlns:tns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/samples/my-testcase-info</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">targetNamespace</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/samples/my-testcase-info</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">elementFormDefault</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">qualified</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">requirement</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">pre-condition</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classification</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">string</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/schema&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We have four simple elements (<strong>requirement</strong>, <strong>pre-condition</strong>, <strong>result</strong> and <strong>classification</strong>) all typed as string. These new elements later go into the test case meta information section.</p>
</div>
<div class="paragraph">
<p>After we added the new XML schema file to the classpath of our project we need to announce the schema to Spring. As you might know already a Citrus test case is nothing else but a simple Spring configuration file with customized XML schema support. If we add new elements to a test case Spring needs to know the XML schema for parsing the test case configuration file. See the <strong>spring.schemas</strong> file usually placed in the META-INF/spring.schemas in your project.</p>
</div>
<div class="paragraph">
<p>The file content for our example will look like follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">http://www.citrusframework.org/samples/my-testcase-info/my-testcase-info.xsd=com/consol/citrus/schemas/my-testcase-info.xsd</code></pre>
</div>
</div>
<div class="paragraph">
<p>So now we are finally ready to use the new meta-info elements inside the test case:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;spring:beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/testcase</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:spring</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:custom</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/samples/my-testcase-info</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
      <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
      <span class="content">http://www.citrusframework.org/schema/testcase</span>
      <span class="content">http://www.citrusframework.org/schema/testcase/citrus-testcase.xsd</span>
      <span class="content">http://www.citrusframework.org/samples/my-testcase-info</span>
      <span class="content">http://www.citrusframework.org/samples/my-testcase-info/my-testcase-info.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PwdChange_OK_1_Test</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;meta-info&gt;</span>
            <span class="tag">&lt;author&gt;</span>Christoph<span class="tag">&lt;/author&gt;</span>
            <span class="tag">&lt;creationdate&gt;</span>2010-01-18<span class="tag">&lt;/creationdate&gt;</span>
            <span class="tag">&lt;status&gt;</span>FINAL<span class="tag">&lt;/status&gt;</span>
            <span class="tag">&lt;last-updated-by&gt;</span>Christoph<span class="tag">&lt;/last-updated-by&gt;</span>
            <span class="tag">&lt;last-updated-on&gt;</span>2010-01-18T15:00:00<span class="tag">&lt;/last-updated-on&gt;</span>
            <span class="tag">&lt;custom:requirement&gt;</span>REQ10001<span class="tag">&lt;/custom:requirement&gt;</span>
            <span class="tag">&lt;custom:pre-condition&gt;</span>Existing user, sufficient rights<span class="tag">&lt;/custom:pre-condition&gt;</span>
            <span class="tag">&lt;custom:result&gt;</span>Password reset in database<span class="tag">&lt;/custom:result&gt;</span>
            <span class="tag">&lt;custom:classification&gt;</span>PasswordChange<span class="tag">&lt;/custom:classification&gt;</span>
        <span class="tag">&lt;/meta-info&gt;</span>

        [...]
    <span class="tag">&lt;/testcase&gt;</span>
<span class="tag">&lt;/spring:beans&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We use a separate namespace declaration with a custom namespace prefix “custom” in order to declare the new XML schema to our test case. Of course you can pick a namespace url and prefix that fits best for your project.As you see it is quite easy to add custom meta information to your Citrus test case. The customized elements may be precious for automatic reporting. XSL transformations for instance are able to read those meta information elements in order to generate automatic test reports and documentation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also declare our new XML schema in the Eclipse preferences section as user specific XML catalog entry. Then even the schema code completion in your Eclipse XML editor will be available for our customized meta-info elements.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tracing-incoming-outgoing-messages"><a class="anchor" href="#tracing-incoming-outgoing-messages"></a><a class="link" href="#tracing-incoming-outgoing-messages">46. Tracing incoming/outgoing messages</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>As we deal with message based interfaces Citrus will send and receive a lot of messages during a test run. Now we may want to see these messages in chronological order as they were processed by Citrus. We can enable message tracing in Citrus in order to save messages to the file system for further investigations.</p>
</div>
<div class="paragraph">
<p>Citrus offers an easy way to debug all received messages to the file system. You need to enable some specific loggers and interceptors in the Spring application context.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.report.MessageTracingTestListener</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Just add this bean to the Spring configuration and Citrus will listen for sent and received messages for saving those to the file system. You will find files like these in the default test output folder after the test run:</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>logs/trace/messages/MyTest.msgs
logs/trace/messages/FooTest.msgs
logs/trace/messages/SomeTest.msgs</code></pre>
</div>
</div>
<div class="paragraph">
<p>Each Citrus test writes a <strong>.msgs</strong> file containing all messages that went over the wire during the test. By default the debug directory is set to <strong><em>logs/trace/messages/</em></strong> relative to the project test output directory. But you can set your own output directory in the configuration</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.report.MessageTracingTestListener</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">outputDirectory</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file:/path/to/folder</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As the file names do not change with each test run message tracing files may be overwritten. So you eventually need to save the generated message debug files before running another group of test cases.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Lets see some sample output for a test case with message communication over SOAP Http:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Sending SOAP request:
<span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;SOAP-ENV:Envelope</span> <span class="attribute-name">xmlns:SOAP-ENV</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://schemas.xmlsoap.org/soap/envelope/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;SOAP-ENV:Header&gt;</span>
<span class="tag">&lt;Operation</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://citrusframework.org/test</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>sayHello<span class="tag">&lt;/Operation&gt;</span>
<span class="tag">&lt;/SOAP-ENV:Header&gt;</span>
<span class="tag">&lt;SOAP-ENV:Body&gt;</span>
<span class="tag">&lt;ns0:HelloRequest</span> <span class="attribute-name">xmlns:ns0</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.consol.de/schemas/samples/sayHello.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;ns0:MessageId&gt;</span>0857041782<span class="tag">&lt;/ns0:MessageId&gt;</span>
    <span class="tag">&lt;ns0:CorrelationId&gt;</span>6915071793<span class="tag">&lt;/ns0:CorrelationId&gt;</span>
    <span class="tag">&lt;ns0:User&gt;</span>Christoph<span class="tag">&lt;/ns0:User&gt;</span>
    <span class="tag">&lt;ns0:Text&gt;</span>Hello WebServer<span class="tag">&lt;/ns0:Text&gt;</span>
<span class="tag">&lt;/ns0:HelloRequest&gt;</span>
<span class="tag">&lt;/SOAP-ENV:Body&gt;</span>
<span class="tag">&lt;/SOAP-ENV:Envelope&gt;</span>

======================================================================

Received SOAP response:
<span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="tag">&lt;SOAP-ENV:Envelope</span> <span class="attribute-name">xmlns:SOAP-ENV</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://schemas.xmlsoap.org/soap/envelope/</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;SOAP-ENV:Header</span><span class="tag">/&gt;</span>
<span class="tag">&lt;SOAP-ENV:Body&gt;</span>
<span class="tag">&lt;ns0:HelloResponse</span> <span class="attribute-name">xmlns:ns0</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.consol.de/schemas/samples/sayHello.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;ns0:MessageId&gt;</span>0857041782<span class="tag">&lt;/ns0:MessageId&gt;</span>
    <span class="tag">&lt;ns0:CorrelationId&gt;</span>6915071793<span class="tag">&lt;/ns0:CorrelationId&gt;</span>
    <span class="tag">&lt;ns0:User&gt;</span>WebServer<span class="tag">&lt;/ns0:User&gt;</span>
    <span class="tag">&lt;ns0:Text&gt;</span>Hello Christoph<span class="tag">&lt;/ns0:Text&gt;</span>
<span class="tag">&lt;/ns0:HelloResponse&gt;</span>
<span class="tag">&lt;/SOAP-ENV:Body&gt;</span>
<span class="tag">&lt;/SOAP-ENV:Envelope&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For this message tracing to work we need to add logging listeners to our sender and receiver components accordingly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-ws:client</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">webServiceClient</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">request-url</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8071</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">message-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">messageFactory</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">interceptors</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">clientInterceptors</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

    <span class="tag">&lt;util:list</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">clientInterceptors</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.consol.citrus.ws.interceptor.LoggingClientInterceptor</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/util:list&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Be aware of adding the Spring <strong>util</strong> XML namespace to the application context when using the <strong>util:list</strong> construct.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="reporting-and-test-results"><a class="anchor" href="#reporting-and-test-results"></a><a class="link" href="#reporting-and-test-results">47. Reporting and test results</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The framework generates different reports and results after a test run for you. These report and result pages will help you to get an overview of the test cases that were executed and which one were failing.</p>
</div>
<div class="sect2">
<h3 id="console-logging"><a class="anchor" href="#console-logging"></a><a class="link" href="#console-logging">47.1. Console logging</a></h3>
<div class="paragraph">
<p>During the test run the framework will provide a huge amount of information that is printed out to the console. This includes current test progress, validation results and error information. This enables the user to quickly supervise the test run progress. Failures in tests will be printed to the console just the time the error occurred. The detailed stack trace information and the detailed error messages are helpful to get the idea what went wrong.</p>
</div>
<div class="paragraph">
<p>As the console output might be limited to a defined buffer limit, the user may not be able to follow the output to the very beginning of the test run. Therefore the framework additionally prints all information to a log file according to the logging configuration.</p>
</div>
<div class="paragraph">
<p>The logging mechanism uses the SLF4J logging framework. SLF4J is independent of logging framework implementations on the market. So in case you use Log4J logging framework the specified log file path as well as logging levels can be freely configured in the respective log4j.xml file in your project. At the end of a test run the combined test results get printed to both console and log file. The overall test results look like following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">CITRUS TEST RESULTS

  [...]
  HelloService_Ok_1             : SUCCESS
  HelloService_Ok_2             : SUCCESS
  EchoService_Ok_1              : SUCCESS
  EchoService_Ok_2              : SUCCESS
  EchoService_TempError_1       : SUCCESS
  EchoService_AutomaticRetry_1 : SUCCESS
  [...]

  Found 175 test cases to execute
  Skipped 0 test cases (0.0%)
  Executed 175 test cases
  Tests failed:         0 (0.0%)
  Tests successfully: 175 (100.0%)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Failed tests will be marked as failed in the result list. The framework will give a short description of the error cause while the detailed stack trace information can be found in the log messages that were made during the test run.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">HelloService_Ok_3 : failed - Exception is Action timed out</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="junit-reports"><a class="anchor" href="#junit-reports"></a><a class="link" href="#junit-reports">47.2. JUnit reports</a></h3>
<div class="paragraph">
<p>As tests are executed as TestNG test cases, the framework will also generate JUnit compliant XML and HTML reports. JUnit test reports are very popular and find support in many build management and development tools. In general the Citrus test reports give you an overall picture of all tests and tell you which of them were failing.</p>
</div>
<div class="paragraph">
<p>Build management tools like Jenkins can easily import and display the generated JUnit XML results. Please have a look at the TestNG and JUnit documentation for more information about this topic as well as the build management tools (e.g. Jenkins) to find out how to integrate the tests results.</p>
</div>
</div>
<div class="sect2">
<h3 id="html-reports"><a class="anchor" href="#html-reports"></a><a class="link" href="#html-reports">47.3. HTML reports</a></h3>
<div class="paragraph">
<p>Citrus creates HTML reports after each test run. The report provides detailed information on the test run with a summary of all test results. You can find the report after a test run in the directory <strong><em>${project.build.directory}/citrus-reports</em></strong> .</p>
</div>
<div class="paragraph">
<p>The report consists of two parts. The test summary on top shows the total number executed tests. The main part lists all test cases with detailed information. With this report you immediately identify all tests that were failing. Each test case is marked in color according to its result outcome.</p>
</div>
<div class="paragraph">
<p>The failed tests give detailed error information with error messages and Java StackTrace information. In addition to that the report tries to find the test action inside the XML test part that failed in execution. With the failing code snippet you can see where the test stopped.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
JavaScript should be active in your web browser. This is to enable the detailed information which comes to you in form of tooltips like test author or description. If you want to access the tooltips JavaScript should be enabled in your browser.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The HTML reports are customizable by system properties. Use following properties e.g. in your <strong>citrus.properties</strong> file:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
citrus.html.report.enabled
</td>
<td class="hdlist2">
<p>Enables/disables HTML report generation (default= <strong><em>true</em></strong>).</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus.html.report.directory
</td>
<td class="hdlist2">
<p>Output directory path (default= <strong><em>${project.build.directory}/citrus-reports</em></strong>).</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus.html.report.file
</td>
<td class="hdlist2">
<p>File name for the report file (default= <strong><em>citrus-test-results.html</em></strong>).</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus.html.report.template
</td>
<td class="hdlist2">
<p>Template HTML file with placeholders for report results.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus.html.report.detail.template
</td>
<td class="hdlist2">
<p>Template file for detailed test results.</p>
</td>
</tr>
<tr>
<td class="hdlist1">
citrus.html.report.logo
</td>
<td class="hdlist2">
<p>File resource path pointing to a image that is added to top of HTML report.</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The HTML report is based on a template file that is customizable to your special needs. The default templates can be found in <a href="https://github.com/christophd/citrus/tree/master/modules/citrus-core/src/main/resources/com/consol/citrus/report">report-templates sources</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="samples"><a class="anchor" href="#samples"></a><a class="link" href="#samples">48. Samples</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter gives some samples where you can see Citrus in action.</p>
</div>
<div class="sect2">
<h3 id="samples-flightbooking"><a class="anchor" href="#samples-flightbooking"></a><a class="link" href="#samples-flightbooking">48.1. The FlightBooking sample</a></h3>
<div class="paragraph">
<p>A simple project example should give you the idea how Citrus works. The system under test is a flight booking service that handles travel requests from a travel agency. A travel request consists of a complete travel route including several flights. The FlightBookingService application will split the complete travel booking into separate flight bookings that are sent to the respective airlines in charge. The booking and customer data is persisted in a database.</p>
</div>
<div class="paragraph">
<p>The airlines will confirm or deny the flight bookings. The FlightBookingService application consolidates all incoming flight confirmations and combines them to a complete travel confirmation or denial that is sent back to the travel agency. Next picture tries to put the architecture into graphics:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/samples/flightbooking/architecture_overview.jpg" alt="samples/flightbooking/architecture_overview.jpg"></span></p>
</div>
<div class="paragraph">
<p>In our example two different airlines are connected to the FlightBookingService application: the SmartAriline over JMS and the RoyalAirline over Http.</p>
</div>
<div class="sect3">
<h4 id="flightbooking-use-case"><a class="anchor" href="#flightbooking-use-case"></a><a class="link" href="#flightbooking-use-case">48.1.1. The use case</a></h4>
<div class="paragraph">
<p>The use case that we would like to test is quite simple. The test should handle a simple travel booking and expect a positive processing to the end. The test case neither simulates business errors nor technical problems. Next picture shows the use case as a sequence diagram.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/samples/flightbooking/sequence_diagram.jpg" alt="samples/flightbooking/sequence_diagram.jpg"></span></p>
</div>
<div class="paragraph">
<p>The travel agency puts a travel booking request towards the system. The travel booking contains two separate flights. The flight requests are published to the airlines (SmartAirline and RoyalAirline). Both airlines confirm the flight bookings with a positive answer. The consolidated travel booking response is then sent back to the travel agency.</p>
</div>
</div>
<div class="sect3">
<h4 id="flightbooking-simulated-systems"><a class="anchor" href="#flightbooking-simulated-systems"></a><a class="link" href="#flightbooking-simulated-systems">48.1.2. Configure the simulated systems</a></h4>
<div class="paragraph">
<p>Citrus simulates all surrounding applications in their behavior during the test. The simulated applications are: TravelAgency, SmartAirline and RoyalAirline. The simulated systems have to be configured in the Citrus configuration first. The configuration is done in Spring XML configuration files, as Citrus uses Spring to glue all its services together.</p>
</div>
<div class="paragraph">
<p>First of all we have a look at the TravelAgency configuration. The TravelAgency is using JMS to connect to our tested system, so we need to configure this JMS connection in Citrus.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">connectionFactory</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.activemq.ActiveMQConnectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">brokerURL</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">tcp://localhost:61616</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span>

<span class="tag">&lt;citrus-jms:endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">travelAgencyBookingRequestEndpoint</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">destination-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${travel.agency.request.queue}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;citrus-jms:endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">travelAgencyBookingResponseEndpoint</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">destination-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${travel.agency.response.queue}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is all Citrus needs to send and receive messages over JMS in order to simulate the TravelAgency. By default all JMS message senders and receivers need a connection factory. Therefore Citrus is searching for a bean named "connectionFactory". In the example we connect to a ActiveMQ message broker. A connection to other JMS brokers like TIBCO EMS or Apache ActiveMQ is possible too by simply changing the connection factory implementation.</p>
</div>
<div class="paragraph">
<p>The identifiers of the message senders and receivers are very important. We should think of suitable ids that give the reader a first hint what the sender/receiver is used for. As we want to simulate the TravelAgency in combination with sending booking requests our id is "travelAgencyBookingRequestEndpoint" for example.</p>
</div>
<div class="paragraph">
<p>The sender and receivers do also need a JMS destination. Here the destination names are provided by property expressions. The Spring IoC container resolves the properties for us. All we need to do is publish the property file to the Spring container like this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">propertyLoader</span><span class="delimiter">&quot;</span></span>
   <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.beans.factory.config.PropertyPlaceholderConfigurer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">locations</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;list&gt;</span>
            <span class="tag">&lt;value&gt;</span>citrus.properties<span class="tag">&lt;/value&gt;</span>
        <span class="tag">&lt;/list&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ignoreUnresolvablePlaceholders</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The citrus.properties file is located in our project&#8217;s resources folder and defines the actual queue names besides other properties of course:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">#JMS queues
travel.agency.request.queue=Travel.Agency.Request.Queue
travel.agency.response.queue=Travel.Agency.Response.Queue
smart.airline.request.queue=Smart.Airline.Request.Queue
smart.airline.response.queue=Smart.Airline.Response.Queue
royal.airline.request.queue=Royal.Airline.Request.Queue</code></pre>
</div>
</div>
<div class="paragraph">
<p>What else do we need in our Spring configuration? There are some basic beans that are commonly defined in a Citrus application but I do not want to bore you with these details. So if you want to have a look at the Spring application context file in the resources folder and see how things are defined there.</p>
</div>
<div class="paragraph">
<p>We continue with the first airline to be configured the SmartAirline. The SmartAirline is also using JMS to communicate with the FlightBookingService. So there is nothing new for us, we simply define additional JMS message senders and receivers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-jms:endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">smartAirlineBookingRequestEndpoint</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">destination-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${smart.airline.request.queue}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;citrus-jms:endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">smartAirlineBookingResponseEndpoint</span><span class="delimiter">&quot;</span></span>
                      <span class="attribute-name">destination-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${smart.airline.response.queue}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We do not define a new JMS connection factory because TravelAgency and SmartAirline are using the same message broker instance. In case you need to handle multiple connection factories simply define the connection factory with the attribute "connection-factory".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-jms:endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">smartAirlineBookingRequestEndpoint</span><span class="delimiter">&quot;</span></span>
                            <span class="attribute-name">destination-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${smart.airline.request.queue}</span><span class="delimiter">&quot;</span></span>
                            <span class="attribute-name">connection-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">smartAirlineConnectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;citrus-jms:endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">smartAirlineBookingResponseEndpoint</span><span class="delimiter">&quot;</span></span>
                          <span class="attribute-name">destination-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${smart.airline.response.queue}</span><span class="delimiter">&quot;</span></span>
                          <span class="attribute-name">connection-factory</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">smartAirlineConnectionFactory</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="flightbooking-http-adapter"><a class="anchor" href="#flightbooking-http-adapter"></a><a class="link" href="#flightbooking-http-adapter">48.1.3. Configure the Http adapter</a></h4>
<div class="paragraph">
<p>The RoyalAirline is connected to our system using Http request/response communication. This means we have to simulate a Http server in the test that accepts client requests and provides proper responses. Citrus offers a Http server implementation that will listen on a port for client requests. The adapter forwards incoming request to the test engine over JMS and receives a proper response that is forwarded as a Http response to the client. The next picture shows this mechanism in detail.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/samples/flightbooking/http_adapter.jpg" alt="samples/flightbooking/http_adapter.jpg"></span></p>
</div>
<div class="paragraph">
<p>The RoyalAirline adapter receives client requests over Http and sends them over JMS to a message receiver as we already know it. The test engine validates the received request and provides a proper response back to the adapter. The adapter will transform the response to Http again and publishes it to the calling client. Citrus offers these kind of adapters for Http and SOAP communication. By writing your own adapters like this you will be able to extend Citrus so it works with protocols that are not supported yet.</p>
</div>
<div class="paragraph">
<p>Let us define the Http adapter in the Spring configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;citrus-http:server</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">royalAirlineHttpServer</span><span class="delimiter">&quot;</span></span>
                       <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8091</span><span class="delimiter">&quot;</span></span>
                       <span class="attribute-name">uri</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/flightbooking</span><span class="delimiter">&quot;</span></span>
                       <span class="attribute-name">endpoint-adapter</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsEndpointAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

<span class="tag">&lt;citrus-jms:endpoint-adapter</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jmsEndpointAdapter</span>
      <span class="content">destination-name=</span><span class="delimiter">&quot;</span></span><span class="error">$</span><span class="error">{</span><span class="attribute-name">royal.airline.request.queue</span><span class="error">}</span><span class="error">&quot;</span><span class="tag">/&gt;</span>
      connection-factory=&quot;connectionFactory&quot; /<span class="error">&gt;</span>
      timeout=&quot;2000&quot;/<span class="error">&gt;</span>

<span class="tag">&lt;citrus-jms:sync-endpoint</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">royalAirlineBookingEndpoint</span><span class="delimiter">&quot;</span></span>
                            <span class="attribute-name">destination-name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${royal.airline.request.queue}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We need to configure a Http server instance with a port, a request URI and the endpoint adapter. We define the JMS endpoint adapter to handle request as described. In Addition to the endpoint adapter we also need synchronous JMS message sender and receiver instances. That&#8217;s it! We are able to receive Http request in order to simulate the RoyalAirline application. What is missing now? The test case definition itself.</p>
</div>
</div>
<div class="sect3">
<h4 id="flightbooking-test-case"><a class="anchor" href="#flightbooking-test-case"></a><a class="link" href="#flightbooking-test-case">48.1.4. The test case</a></h4>
<div class="paragraph">
<p>The test case definition is also a Spring configuration file. Citrus offers a customized XML syntax to define a test case. This XML test defining language is supposed to be easy to understand and more specific to the domain we are dealing with. Next listing shows the whole test case definition. Keep in mind that a test case defines every step in the use case. So we define sending and receiving actions of the use case as described in the sequence diagram we saw earlier.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;spring:beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.citrusframework.org/schema/testcase</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">xmlns:spring</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
             <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
             <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span>
             <span class="content">http://www.citrusframework.org/schema/testcase</span>
             <span class="content">http://www.citrusframework.org/schema/testcase/citrus-testcase.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;testcase</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">FlightBookingTest</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;meta-info&gt;</span>
            <span class="tag">&lt;author&gt;</span>Christoph Deppisch<span class="tag">&lt;/author&gt;</span>
            <span class="tag">&lt;creationdate&gt;</span>2009-04-15<span class="tag">&lt;/creationdate&gt;</span>
            <span class="tag">&lt;status&gt;</span>FINAL<span class="tag">&lt;/status&gt;</span>
            <span class="tag">&lt;last-updated-by&gt;</span>Christoph Deppisch<span class="tag">&lt;/last-updated-by&gt;</span>
            <span class="tag">&lt;last-updated-on&gt;</span>2009-04-15T00:00:00<span class="tag">&lt;/last-updated-on&gt;</span>
        <span class="tag">&lt;/meta-info&gt;</span>
        <span class="tag">&lt;description&gt;</span>
            Test flight booking service.
        <span class="tag">&lt;/description&gt;</span>
        <span class="tag">&lt;variables&gt;</span>
            <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">correlationId</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:concat('Lx1x', 'citrus:randomNumber(10)')</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;variable</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">customerId</span><span class="delimiter">&quot;</span></span>
                <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">citrus:concat('Mx1x', citrus:randomNumber(10))</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/variables&gt;</span>
        <span class="tag">&lt;actions&gt;</span>
            <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">travelAgencyBookingRequestEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;message&gt;</span>
                    <span class="tag">&lt;data&gt;</span>
                      <span class="inline-delimiter">&lt;![CDATA[</span>
                        &lt;TravelBookingRequestMessage
                          xmlns=&quot;http://www.consol.com/schemas/TravelAgency&quot;&gt;
                          &lt;correlationId&gt;${correlationId}&lt;/correlationId&gt;
                          &lt;customer&gt;
                            &lt;id&gt;${customerId}&lt;/id&gt;
                            &lt;firstname&gt;John&lt;/firstname&gt;
                            &lt;lastname&gt;Doe&lt;/lastname&gt;
                          &lt;/customer&gt;
                          &lt;flights&gt;
                            &lt;flight&gt;
                              &lt;flightId&gt;SM 1269&lt;/flightId&gt;
                              &lt;airline&gt;SmartAirline&lt;/airline&gt;
                              &lt;fromAirport&gt;MUC&lt;/fromAirport&gt;
                              &lt;toAirport&gt;FRA&lt;/toAirport&gt;
                              &lt;date&gt;2009-04-15&lt;/date&gt;
                              &lt;scheduledDeparture&gt;11:55:00&lt;/scheduledDeparture&gt;
                              &lt;scheduledArrival&gt;13:00:00&lt;/scheduledArrival&gt;
                            &lt;/flight&gt;
                            &lt;flight&gt;
                              &lt;flightId&gt;RA 1780&lt;/flightId&gt;
                              &lt;airline&gt;RoyalAirline&lt;/airline&gt;
                              &lt;fromAirport&gt;FRA&lt;/fromAirport&gt;
                              &lt;toAirport&gt;HAM&lt;/toAirport&gt;
                              &lt;date&gt;2009-04-15&lt;/date&gt;
                              &lt;scheduledDeparture&gt;16:00:00&lt;/scheduledDeparture&gt;
                              &lt;scheduledArrival&gt;17:10:00&lt;/scheduledArrival&gt;
                            &lt;/flight&gt;
                          &lt;/flights&gt;
                        &lt;/TravelBookingRequestMessage&gt;
                      <span class="inline-delimiter">]]&gt;</span>
                    <span class="tag">&lt;/data&gt;</span>
                <span class="tag">&lt;/message&gt;</span>
                <span class="tag">&lt;header&gt;</span>
                    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">correlationId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${correlationId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/header&gt;</span>
            <span class="tag">&lt;/send&gt;</span>

            <span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">smartAirlineBookingRequestEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;message&gt;</span>
                    <span class="tag">&lt;data&gt;</span>
                      <span class="inline-delimiter">&lt;![CDATA[</span>
                        &lt;FlightBookingRequestMessage
                          xmlns=&quot;http://www.consol.com/schemas/AirlineSchema&quot;&gt;
                          &lt;correlationId&gt;${correlationId}&lt;/correlationId&gt;
                          &lt;bookingId&gt;???&lt;/bookingId&gt;
                          &lt;customer&gt;
                            &lt;id&gt;${customerId}&lt;/id&gt;
                            &lt;firstname&gt;John&lt;/firstname&gt;
                            &lt;lastname&gt;Doe&lt;/lastname&gt;
                          &lt;/customer&gt;
                          &lt;flight&gt;
                            &lt;flightId&gt;SM 1269&lt;/flightId&gt;
                            &lt;airline&gt;SmartAirline&lt;/airline&gt;
                            &lt;fromAirport&gt;MUC&lt;/fromAirport&gt;
                            &lt;toAirport&gt;FRA&lt;/toAirport&gt;
                            &lt;date&gt;2009-04-15&lt;/date&gt;
                            &lt;scheduledDeparture&gt;11:55:00&lt;/scheduledDeparture&gt;
                            &lt;scheduledArrival&gt;13:00:00&lt;/scheduledArrival&gt;
                          &lt;/flight&gt;
                        &lt;/FlightBookingRequestMessage&gt;
                      <span class="inline-delimiter">]]&gt;</span>
                    <span class="tag">&lt;/data&gt;</span>
                    <span class="tag">&lt;ignore</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//:FlightBookingRequestMessage/:bookingId</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/message&gt;</span>
                <span class="tag">&lt;header&gt;</span>
                    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">correlationId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${correlationId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/header&gt;</span>
                <span class="tag">&lt;extract&gt;</span>
                    <span class="tag">&lt;message</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//:FlightBookingRequestMessage/:bookingId</span><span class="delimiter">&quot;</span></span>
                                <span class="attribute-name">variable</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${smartAirlineBookingId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/extract&gt;</span>
            <span class="tag">&lt;/receive&gt;</span>

            <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">smartAirlineBookingResponseEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;message&gt;</span>
                    <span class="tag">&lt;data&gt;</span>
                      <span class="inline-delimiter">&lt;![CDATA[</span>
                        &lt;FlightBookingConfirmationMessage
                          xmlns=&quot;http://www.consol.com/schemas/AirlineSchema&quot;&gt;
                          &lt;correlationId&gt;${correlationId}&lt;/correlationId&gt;
                          &lt;bookingId&gt;${smartAirlineBookingId}&lt;/bookingId&gt;
                          &lt;success&gt;true&lt;/success&gt;
                          &lt;flight&gt;
                            &lt;flightId&gt;SM 1269&lt;/flightId&gt;
                            &lt;airline&gt;SmartAirline&lt;/airline&gt;
                            &lt;fromAirport&gt;MUC&lt;/fromAirport&gt;
                            &lt;toAirport&gt;FRA&lt;/toAirport&gt;
                            &lt;date&gt;2009-04-15&lt;/date&gt;
                            &lt;scheduledDeparture&gt;11:55:00&lt;/scheduledDeparture&gt;
                            &lt;scheduledArrival&gt;13:00:00&lt;/scheduledArrival&gt;
                          &lt;/flight&gt;
                        &lt;/FlightBookingConfirmationMessage&gt;
                      <span class="inline-delimiter">]]&gt;</span>
                    <span class="tag">&lt;/data&gt;</span>
                <span class="tag">&lt;/message&gt;</span>
                <span class="tag">&lt;header&gt;</span>
                    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">correlationId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${correlationId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/header&gt;</span>
            <span class="tag">&lt;/send&gt;</span>

            <span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">royalAirlineBookingEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;message&gt;</span>
                    <span class="tag">&lt;data&gt;</span>
                      <span class="inline-delimiter">&lt;![CDATA[</span>
                        &lt;FlightBookingRequestMessage
                          xmlns=&quot;http://www.consol.com/schemas/FlightBooking/AirlineSchema&quot;&gt;
                          &lt;correlationId&gt;${correlationId}&lt;/correlationId&gt;
                          &lt;bookingId&gt;???&lt;/bookingId&gt;
                          &lt;customer&gt;
                              &lt;id&gt;${customerId}&lt;/id&gt;
                              &lt;firstname&gt;John&lt;/firstname&gt;
                              &lt;lastname&gt;Doe&lt;/lastname&gt;
                          &lt;/customer&gt;
                          &lt;flight&gt;
                            &lt;flightId&gt;RA 1780&lt;/flightId&gt;
                            &lt;airline&gt;RoyalAirline&lt;/airline&gt;
                            &lt;fromAirport&gt;FRA&lt;/fromAirport&gt;
                            &lt;toAirport&gt;HAM&lt;/toAirport&gt;
                            &lt;date&gt;2009-04-15&lt;/date&gt;
                            &lt;scheduledDeparture&gt;16:00:00&lt;/scheduledDeparture&gt;
                            &lt;scheduledArrival&gt;17:10:00&lt;/scheduledArrival&gt;
                          &lt;/flight&gt;
                        &lt;/FlightBookingRequestMessage&gt;
                      <span class="inline-delimiter">]]&gt;</span>
                    <span class="tag">&lt;/data&gt;</span>
                    <span class="tag">&lt;ignore</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//:FlightBookingRequestMessage/:bookingId</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/message&gt;</span>
                <span class="tag">&lt;header&gt;</span>
                    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">correlationId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${correlationId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/header&gt;</span>
                <span class="tag">&lt;extract&gt;</span>
                    <span class="tag">&lt;message</span> <span class="attribute-name">path</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">//:FlightBookingRequestMessage/:bookingId</span><span class="delimiter">&quot;</span></span>
                                <span class="attribute-name">variable</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${royalAirlineBookingId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/extract&gt;</span>
            <span class="tag">&lt;/receive&gt;</span>

            <span class="tag">&lt;send</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">royalAirlineBookingEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;message&gt;</span>
                    <span class="tag">&lt;data&gt;</span>
                      <span class="inline-delimiter">&lt;![CDATA[</span>
                        &lt;FlightBookingConfirmationMessage
                          xmlns=&quot;http://www.consol.com/schemas/AirlineSchema&quot;&gt;
                          &lt;correlationId&gt;${correlationId}&lt;/correlationId&gt;
                          &lt;bookingId&gt;${royalAirlineBookingId}&lt;/bookingId&gt;
                          &lt;success&gt;true&lt;/success&gt;
                          &lt;flight&gt;
                            &lt;flightId&gt;RA 1780&lt;/flightId&gt;
                            &lt;airline&gt;RoyalAirline&lt;/airline&gt;
                            &lt;fromAirport&gt;FRA&lt;/fromAirport&gt;
                            &lt;toAirport&gt;HAM&lt;/toAirport&gt;
                            &lt;date&gt;2009-04-15&lt;/date&gt;
                            &lt;scheduledDeparture&gt;16:00:00&lt;/scheduledDeparture&gt;
                            &lt;scheduledArrival&gt;17:10:00&lt;/scheduledArrival&gt;
                          &lt;/flight&gt;
                        &lt;/FlightBookingConfirmationMessage&gt;
                      <span class="inline-delimiter">]]&gt;</span>
                    <span class="tag">&lt;/data&gt;</span>
                <span class="tag">&lt;/message&gt;</span>
                <span class="tag">&lt;header&gt;</span>
                    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">correlationid</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${correlationId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/header&gt;</span>
            <span class="tag">&lt;/send&gt;</span>

            <span class="tag">&lt;receive</span> <span class="attribute-name">endpoint</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">travelAgencyBookingResponseEndpoint</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;message&gt;</span>
                    <span class="tag">&lt;data&gt;</span>
                      <span class="inline-delimiter">&lt;![CDATA[</span>
                        &lt;TravelBookingResponseMessage
                          xmlns=&quot;http://www.consol.com/schemas/TravelAgency&quot;&gt;
                          &lt;correlationId&gt;${correlationId}&lt;/correlationId&gt;
                          &lt;success&gt;true&lt;/success&gt;
                          &lt;flights&gt;
                            &lt;flight&gt;
                              &lt;flightId&gt;SM 1269&lt;/flightId&gt;
                              &lt;airline&gt;SmartAirline&lt;/airline&gt;
                              &lt;fromAirport&gt;MUC&lt;/fromAirport&gt;
                              &lt;toAirport&gt;FRA&lt;/toAirport&gt;
                              &lt;date&gt;2009-04-15&lt;/date&gt;
                              &lt;scheduledDeparture&gt;11:55:00&lt;/scheduledDeparture&gt;
                              &lt;scheduledArrival&gt;13:00:00&lt;/scheduledArrival&gt;
                            &lt;/flight&gt;
                            &lt;flight&gt;
                              &lt;flightId&gt;RA 1780&lt;/flightId&gt;
                              &lt;airline&gt;RoyalAirline&lt;/airline&gt;
                              &lt;fromAirport&gt;FRA&lt;/fromAirport&gt;
                              &lt;toAirport&gt;HAM&lt;/toAirport&gt;
                              &lt;date&gt;2009-04-15&lt;/date&gt;
                              &lt;scheduledDeparture&gt;16:00:00&lt;/scheduledDeparture&gt;
                              &lt;scheduledArrival&gt;17:10:00&lt;/scheduledArrival&gt;
                            &lt;/flight&gt;
                          &lt;/flights&gt;
                        &lt;/TravelBookingResponseMessage&gt;
                      <span class="inline-delimiter">]]&gt;</span>
                    <span class="tag">&lt;/data&gt;</span>
                <span class="tag">&lt;/message&gt;</span>
                <span class="tag">&lt;header&gt;</span>
                    <span class="tag">&lt;element</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">correlationId</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${correlationId}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
                <span class="tag">&lt;/header&gt;</span>
            <span class="tag">&lt;/receive&gt;</span>

        <span class="tag">&lt;/actions&gt;</span>
    <span class="tag">&lt;/testcase&gt;</span>
<span class="tag">&lt;/spring:beans&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Similar to a sequence diagram the test case describes every step of the use case. At the very beginning the test case gets name and its meta information. Following with the variable values that are used all over the test. Here it is the correlationId and the customerId that are used as test variables. Inside message templates header values the variables are referenced several times in the test</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;correlationId&gt;${correlationId}&lt;/correlationId&gt;
&lt;id&gt;${customerId}&lt;/id&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The sending/receiving actions use a previously defined message sender/receiver. This is the link between test case and basic Spring configuration we have done before.</p>
</div>
<div class="paragraph">
<p><code>send endpoint=&quot;travelAgencyBookingRequestEndpoint&quot;</code></p>
</div>
<div class="paragraph">
<p>The sending action chooses a message sender to actually send the message using a message transport (JMS, Http, SOAP, etc.). After sending this first "TravelBookingRequestMessage" request the test case expects the first "FlightBookingRequestMessage" message on the SmartAirline JMS destination. In case this message is not arriving in time the test will fail with errors. In positive case our FlightBookingService works well and the message arrives in time. The received message is validated against a defined expected message template. Only in case all content validation steps are successful the test continues with the action chain. And so the test case proceeds and works through the use case until every message is sent respectively received and validated. The use case is done automatically without human interaction. Citrus simulates all surrounding applications and provides detailed validation possibilities of messages.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appendix"><a class="anchor" href="#appendix"></a><a class="link" href="#appendix">49. Appendix</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter gives a brief overview of all archived changes.</p>
</div>
<div class="sect2">
<h3 id="changes-2-6"><a class="anchor" href="#changes-2-6"></a><a class="link" href="#changes-2-6">Changes in Citrus 2.6</a></h3>
<div class="paragraph">
<p>Citrus 2.6 comes with a set of new modules that enable completely new aspects of integration testing. Namely these are the new modules for Cucumber behavior driven development and Zookeeper support. Just have a look at the following features that are shipped within the 2.6 box.</p>
</div>
<div class="sect3">
<h4 id="changes-gzip-compression"><a class="anchor" href="#changes-gzip-compression"></a><a class="link" href="#changes-gzip-compression">Gzip compression</a></h4>
<div class="paragraph">
<p>Citrus now supports Gzip message compression. For Http client server endpoints we introduced special compression filters that automatically tak care on compression
when the http header <strong>Accept-Encoding=gzip</strong> or <strong>Content-Encoding=gzip</strong> is set. For other endpoints we introduced the message type <strong>gzip</strong> and the message validator
<strong>gzip-base64</strong> which automatically compresses and decompresses message payloads and enables base64 String comparison for validation purpose. The new compression features are
described in <a href="http">http</a> and <a href="validation-gzip">validation-gzip</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-custom-servlet-filters"><a class="anchor" href="#changes-custom-servlet-filters"></a><a class="link" href="#changes-custom-servlet-filters">Custom servlet filters</a></h4>
<div class="paragraph">
<p>The Citrus http server component now accepts custom servlet filter implementations. This is useful for implementing custom logic on request/response processing such as
automatic message compression or caching. You can set one or many custom filter implementations and map those to request paths for the server. Read about this in chapter <a href="http">http</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-escape-test-variable-syntax"><a class="anchor" href="#changes-escape-test-variable-syntax"></a><a class="link" href="#changes-escape-test-variable-syntax">Escape test variable syntax</a></h4>
<div class="paragraph">
<p>Citrus uses test variables and looks for the expressions of type <strong>${variable-name}</strong>. Now when this same syntax is part of a message content we run into errors as Citrus
wants to find a test variable. At the end Citrus complains about the unknown variable. Therefore we introduced an escape syntax for variables so you can skip the Citrus variable expression evaluation.
You can do this by using <strong>${//escaped//}</strong> syntax. Read more about this in <a href="test-variables">test-variables</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-configurable-xml-serializer"><a class="anchor" href="#changes-configurable-xml-serializer"></a><a class="link" href="#changes-configurable-xml-serializer">Configurable XML serializer</a></h4>
<div class="paragraph">
<p>We often deal with XML message format and therefore need to parse and serialize XML data. The default XML serializer uses <strong>pretty print</strong> format and <strong>cdata section</strong> support. Now
sometimes it is mandatory to customize these settings which is possible with the new version. You can add a custom XML serializer in the Spring application context and Citrus will automatically use this
implementation and configuration. You can see how it works in chapter <a href="validation-xml">validation-xml</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-local-message-store"><a class="anchor" href="#changes-local-message-store"></a><a class="link" href="#changes-local-message-store">Local message store</a></h4>
<div class="paragraph">
<p>We introduced a local message store that automatically saves all exchanged messages (inbound and outbound). This message store can be used to get exchanged messages during and after the test.
Test actions as well as test listeners can access the local message store. Read more about this in chapters <a href="endpoints">endpoints</a>, <a href="actions-send">actions-send</a> and <a href="actions-receive">actions-receive</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-wait-message-condition"><a class="anchor" href="#changes-wait-message-condition"></a><a class="link" href="#changes-wait-message-condition">Wait message condition</a></h4>
<div class="paragraph">
<p>The wait test action has a new condition. Besides waiting for files to exist and http requests to be responded you can now wait for messages in the local message store. This way you
can wait for a certain message to arrive. This is described in chapter <a href="actions-wait">actions-wait</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-xpath-and-jsonpath-function"><a class="anchor" href="#changes-xpath-and-jsonpath-function"></a><a class="link" href="#changes-xpath-and-jsonpath-function">Xpath and JsonPath Function</a></h4>
<div class="paragraph">
<p>There are new functions available to evaluate some Xpath or JsonPath expression on a XML/Json source. The source can be a static structure coming from an external file or a message payload stored in the local
storage. See how to use this functions in chapter <a href="functions">functions</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-static-response-adapter-variables"><a class="anchor" href="#changes-static-response-adapter-variables"></a><a class="link" href="#changes-static-response-adapter-variables">Static response adapter variables support</a></h4>
<div class="paragraph">
<p>Server components can use static response adapters that automatically send response messages to any calling client. The response adapter is now able to use test variables and functions. In addition to that
you can map values from the actual request message that has triggered the response adapter by using the local message store in combination with Xpath or JsonPath. Read about this in <a href="endpoint-adapter">endpoint-adapter</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-cucumber-bdd"><a class="anchor" href="#changes-cucumber-bdd"></a><a class="link" href="#changes-cucumber-bdd">Cucumber BDD support</a></h4>
<div class="paragraph">
<p>Behavior driven development is more and more coming up also in the integration testing environment. Cucumber is a fantastic behavior driven development library that provides support for BDD concepts with Gherkin. The new Citrus integration with Cucumber enables the mix of Gherkin syntax feature scenarios with Citrus test case execution. You write feature stories as usual and create Citrus test cases with lots of actions for the integration test. See details for this feature in <a href="cucumber">cucumber</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-zookeeper"><a class="anchor" href="#changes-zookeeper"></a><a class="link" href="#changes-zookeeper">Zookeeper support</a></h4>
<div class="paragraph">
<p>Zookeeper from Apache lets you manage configuration with distributed coordination. As a user you create and edit values on a Zookeeper server. Other clients then can retrieve this information. With Citrus you are able to access this information from within a test case. The Zookeeper Citrus client lets you manage information on the Zookeeper server. See details for this feature in <a href="zookeeper">zookeeper</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-spring-restdocs"><a class="anchor" href="#changes-spring-restdocs"></a><a class="link" href="#changes-spring-restdocs">Spring Restdocs support</a></h4>
<div class="paragraph">
<p>Restdocs is a fantastic way of generating documentation for RESTful APIs. While exchanging request/response data with the server Restdocs creates documentation information on the data. The documentation includes field descriptions, headers and snippets for body content. With new Citrus version Http clients in Citrus can add Restdoc interceptors that generate the documentation while executing the test cases. This way you are able to document what messages were exchanged in tests. The Restdocs support is also available for the SOAP Http client in Citrus. See details in <a href="restdocs">restdocs</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-hamcrest-matcher-conditions"><a class="anchor" href="#changes-hamcrest-matcher-conditions"></a><a class="link" href="#changes-hamcrest-matcher-conditions">Hamcrest matcher conditions</a></h4>
<div class="paragraph">
<p>Iterating test action containers in Citrus evaluate boolean expressions for determination of how to execute the nested actions in a loop. Also the conditional container executes nested actions based on boolean expression evaluation. The Citrus boolean expression support is limited to very basic operations such as lower than or greater than. Furthermore the combination of boolean expressions with variables has not been supported. Following from that we have improved the boolean expression evaluation mechanism with extension to Hamcrest matchers. So now you can evaluate matchers in iterating conditions. This feature is described in <a href="containers-conditional">containers-conditional</a>and <a href="containers-iterate">containers-iterate</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-soap-java-dsl"><a class="anchor" href="#changes-soap-java-dsl"></a><a class="link" href="#changes-soap-java-dsl">SOAP Java DSL</a></h4>
<div class="paragraph">
<p>Citrus provides a new Java fluent API for sending and receiving SOAP related message content. The Java DSL enhancements are based on those of Http. Now you can define SOAP messages with special SOAP action headers more easily. On top of that you can handle SOAP faults on client and server with the fluent API. Checkout <a href="soap-webservices">soap-webservices</a>for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-refactoring"><a class="anchor" href="#changes-refactoring"></a><a class="link" href="#changes-refactoring">Refactoring</a></h4>
<div class="paragraph">
<p>Refactoring in terms of simplification and standardization is part of our daily life as a developer. We have been working on improving the Java DSL fluent API for SOAP. We also introduced a more common way of handling the test action containers like iterate, parallel and so on. This leads to some classes and methods that were marked as deprecated. So please have a look at your Java DSL code and if you see some usage of deprecated stuff please use the new approaches as soon as possible. The deprecated stuff will definitely disappear in upcoming releases.</p>
</div>
<div class="paragraph">
<p>Some of the changes that we have made might hit you right away. These changes are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">ws:assert</dt>
<dd>
<p>element in SOAP testcase schema has been renamed to <strong>ws:assert-fault</strong> . This was done for better interoperability reasons with <strong>assert</strong> action in core schema and to be compliant to <strong>send-fault</strong> action.</p>
</dd>
<dt class="hdlist1">Java DSL module</dt>
<dd>
<p>has had Maven dependencies to several other modules in Citrus (e.g. citrus-jms, citrus-soap). These dependencies were declared as compile dependencies, which is not very nice as you might not need JMS or SOAP functionalities in your project. We have added optional and provided markers to that dependencies which means that you have to decide in your project which of the modules to include.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>You may face some missing dependencies errors when running the Maven project. As a result you need to include the Citrus modules (e.g. citrus-http, citrus-docker, and so on) in your project Maven POM explicitly.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changes-2-5"><a class="anchor" href="#changes-2-5"></a><a class="link" href="#changes-2-5">Changes in Citrus 2.5</a></h3>
<div class="paragraph">
<p>We have added lots of new features and improvements with Citrus 2.5. Namely these are the new modules for RMI and JMX support, a new x-www-form-urlencoded message validator and new functions anc test actions. Just have a look at the following features that made it to the box.</p>
</div>
<div class="sect3">
<h4 id="changes-hamcrest-matcher"><a class="anchor" href="#changes-hamcrest-matcher"></a><a class="link" href="#changes-hamcrest-matcher">Hamcrest matcher support</a></h4>
<div class="paragraph">
<p>Hamcrest is a very powerful matcher library that provides a fantastic set of matcher implementations for message validation purpose. Citrus now supports these matchers coming from Hamcrest library. On the one hand you can use Hamcrest matchers as a Citrus validation matcher as described in <a href="validation-matcher-hamcrest">validation-matcher-hamcrest</a>. On the other hand you can use Hamcrest matchers now directly using the Citrus Java DSL. See details for this feature in <a href="json-path-validate">json-path-validate</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-binary-base64-message-validator"><a class="anchor" href="#changes-binary-base64-message-validator"></a><a class="link" href="#changes-binary-base64-message-validator">Binary base64 message validator</a></h4>
<div class="paragraph">
<p>There is a new message validator implementation that automatically converts binary message content to a base64 encoded String representation for comparison. This is the easiest way to compare binary message content with an expected message payload. See <a href="validation-binary">validation-binary</a>how this is working for you.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-rmi"><a class="anchor" href="#changes-rmi"></a><a class="link" href="#changes-rmi">RMI support</a></h4>
<div class="paragraph">
<p>Remote method invocation is a standard Java technology and API for calling methods on remote objects across different JVM instances. Although RMI has lost its popularity it is still used in legacy components. Testing RMI bean invocation is a hard thing to do. Now Citrus provides client and server support for remote interface invocation. See <a href="rmi">rmi</a> for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-jmx"><a class="anchor" href="#changes-jmx"></a><a class="link" href="#changes-jmx">JMX support</a></h4>
<div class="paragraph">
<p>Similar to RMI JMX can be used to connect to remote bean invocation. This time we expose some beans to a managed bean server in order to be managed by JMX operations for read and write. With Citrus 2.5 we have added a client and server support for calling and providing managed beans on a mbean server. See <a href="jmx">jmx</a> for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-resource-injection"><a class="anchor" href="#changes-resource-injection"></a><a class="link" href="#changes-resource-injection">Resource injection</a></h4>
<div class="paragraph">
<p>With 2.5 we have added mechanisms for injecting Citrus components to your Java DSL test methods. This is very useful when needing access to the Citrus test context for instance. Also we are able to use new injection of test designer and runner instances in order to support parallel test execution with multiple threads. See the explanations in <a href="testcase-resource-injection">testcase-resource-injection</a>and <a href="testcase-context-injection">testcase-context-injection</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-http-x-www-form-urlencoded-message-validator"><a class="anchor" href="#changes-http-x-www-form-urlencoded-message-validator"></a><a class="link" href="#changes-http-x-www-form-urlencoded-message-validator">Http x-www-form-urlencoded message validator</a></h4>
<div class="paragraph">
<p>HTML form data can be transmitted with different methods and content types. One of the most common ways is to use <strong>x-www-form-urlencoded</strong> form data content. As validation can be tricky we have added a special message validator for that. See <a href="http-www-form-urlencoded">http-www-form-urlencoded</a>for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-date-range-validation-matcher"><a class="anchor" href="#changes-date-range-validation-matcher"></a><a class="link" href="#changes-date-range-validation-matcher">Date range validation matcher</a></h4>
<div class="paragraph">
<p>Added a new validation matcher implementation that is able to check that a date value is between a certain date range (from and to) The date range is able to focus on days as well as additional time (hour, minute, second) specifications. See <a href="validation-matcher-daterange">validation-matcher-daterange</a>for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-read-file-resource-function"><a class="anchor" href="#changes-read-file-resource-function"></a><a class="link" href="#changes-read-file-resource-function">Read file resource function</a></h4>
<div class="paragraph">
<p>A new function implementation offers you the possibilities to read file resource contents as inline data. The function is called and returns the file content as return value. The file content is then placed right where the function was called e.g. inside of a message payload element or as message header value. See <a href="functions-read-file">functions-read-file</a>for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-timer-container"><a class="anchor" href="#changes-timer-container"></a><a class="link" href="#changes-timer-container">Timer container</a></h4>
<div class="paragraph">
<p>The new timer test action container repeats its execution based on a time expression (e.g. every 5 seconds). With this timer we can repeat test actions with a fixed time delay or constantly execute test actions with time schedule. See <a href="containers-timer">containers-timer</a>and <a href="actions-stop-timer">actions-stop-timer</a>for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-upgrade-to-vertx-3-2-0"><a class="anchor" href="#changes-upgrade-to-vertx-3-2-0"></a><a class="link" href="#changes-upgrade-to-vertx-3-2-0">Upgrade to Vert.x 3.2.0</a></h4>
<div class="paragraph">
<p>The Vert.x module was upgraded to use Vert.x 3.2.0 version. The Citrus module implementation was updated to work with this new Vert.x version. Learn more about the Vert.x integration in Citrus with <a href="vertx">vertx</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changes-2-4"><a class="anchor" href="#changes-2-4"></a><a class="link" href="#changes-2-4">Changes in Citrus 2.4</a></h3>
<div class="paragraph">
<p>Citrus 2.4 comes with a set of new features especially regarding Apache Camel and Docker integrations. Bugfixes of course are also part of the package. See the following overview on what has changed.</p>
</div>
<div class="sect3">
<h4 id="changes-docker"><a class="anchor" href="#changes-docker"></a><a class="link" href="#changes-docker">Docker support</a></h4>
<div class="paragraph">
<p>Docker and Microservices are frequent topics in software development recently. We have added interaction with Docker in Citrus so the user can manage Docker containers within a test case. Citrus now provides special Docker test actions for building, starting, stopping and inspecting Docker images and containers in a test. See <a href="docker">docker</a> for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-http-rest-actions"><a class="anchor" href="#changes-http-rest-actions"></a><a class="link" href="#changes-http-rest-actions">Http REST actions</a></h4>
<div class="paragraph">
<p>We have significantly improved the Http REST support in Citrus. The focus is on simplifying the Http REST usage in Citrus test cases. With new Http specific test actions on client and server we can send and receive Http REST messages very easy. See <a href="http">http</a> for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-wait-test-action"><a class="anchor" href="#changes-wait-test-action"></a><a class="link" href="#changes-wait-test-action">Wait test action</a></h4>
<div class="paragraph">
<p>With the new wait test action we can explicitly wait for some remote condition to become true inside of a test case. The conditions supported at the moment are Http url requests and file based conditions. A user can invoke a Http server url and wait for it to return a success <strong>Http 200 OK</strong> response. This is an awesome feature when waiting for a server to start up before the test continues. We can also think of waiting for a Docker container to start up before continuing. Or you can wait until a file is present on the local file system. See <a href="actions-wait">actions-wait</a>for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-camel-actions"><a class="anchor" href="#changes-camel-actions"></a><a class="link" href="#changes-camel-actions">Camel actions</a></h4>
<div class="paragraph">
<p>Citrus has already had support for Apache Camel routes and Camel context loading. Now with 2.4 version we have added some special Apache Camel test actions for interacting with a Camel context and its routes. This enables the tester to create and use a new Camel route on the fly inside a test case. Also Citrus is now able to interact with the Camel control bus accessing route statistics and status information. Also possible are start, stop, suspend, resume operations on a Camel route. See <a href="camel-actions">camel-actions</a>and <a href="camel-controlbus">camel-controlbus</a>for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-purge-endpoints-action"><a class="anchor" href="#changes-purge-endpoints-action"></a><a class="link" href="#changes-purge-endpoints-action">Purge endpoints action</a></h4>
<div class="paragraph">
<p>Purging JMS queues and in memory channels at test runtime has become a widely used feature especially when aiming to make tests more stable in terms of independent tests. We have added a purge endpoint test action that works on any consumer endpoint. So you do not need to separate between endpoint implementations anymore and more important you can purge server in memory channel components very easy. See <a href="actions-purge-endpoints">actions-purge-endpoints</a>for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-release-to-maven-central"><a class="anchor" href="#changes-release-to-maven-central"></a><a class="link" href="#changes-release-to-maven-central">Release to Maven Central</a></h4>
<div class="paragraph">
<p>This is not a new feature but also worth to tell here as it is a significant improvement on the whole framework project. We can now release the Citrus artifacts to Maven central repository. So you do not need the additional <strong>labs.consol.de</strong> repository in your Maven POM anymore. The <strong>labs.consol.de</strong> repository will continue to exist though as we will release SNAPSHOT versions of Citrus here in future.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changes-2-3"><a class="anchor" href="#changes-2-3"></a><a class="link" href="#changes-2-3">Changes in Citrus 2.3</a></h3>
<div class="paragraph">
<p>We want to give you a short overview of what has changed in Citrus 2.3. The release adds some new features and improvements to the box. Bugfixes of course are also part of the package. See the following overview on what has changed.</p>
</div>
<div class="sect3">
<h4 id="changes-test-runner-and-test-designer"><a class="anchor" href="#changes-test-runner-and-test-designer"></a><a class="link" href="#changes-test-runner-and-test-designer">Test runner and test designer</a></h4>
<div class="paragraph">
<p>One of the biggest issues with the Citrus Java DSL is the fact that the Citrus Java DSL methods first build the whole test case together before the actual execution takes place. So calling a Java DSL method <strong>send</strong> for instance just prepares the sending test action. The actual sending of the message takes place to a later time when all test actions are setup and the test case is ready to run. This separation of design time and runtime of a test case leads to misunderstandings as a Java developer is used to work with statements and method calls that perform immediately. Based on that the mixture of Citrus Java DSL method calls and normal Java code logic in your test may have lead to unexpected behavior. Following from that we decided to refactor the Java DSL method execution. The result is a new <strong>TestRunner</strong> concept that executes all Java DSL method calls immediately. The old way of building the whole test case before execution is represented with <strong>TestDesigner</strong> concept. So both worlds are now available to you. See <a href="testcase">testcase</a> for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-websocket"><a class="anchor" href="#changes-websocket"></a><a class="link" href="#changes-websocket">WebSocket support</a></h4>
<div class="paragraph">
<p>The WebSocket message protocol builds on top of Http standard and brings bidirectional communication to the Http client-server world. With this release Citrus users are able to send and receive messages with WebSocket connections. The Http server implementation is now able to define multiple WebSocket endpoints. The new Citrus WebSocket client is able to publish messages to the server via bidirectional WebSocket protocol. See <a href="http-websocket">http-websocket</a>for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-jsonpath"><a class="anchor" href="#changes-jsonpath"></a><a class="link" href="#changes-jsonpath">JSONPath support</a></h4>
<div class="paragraph">
<p>Citrus is able to work with Xpath expressions in several fields within the testing domain (overwrite elements, ignore elements, extract values from payloads). Now this support of manipulating message payloads via expressions is extended with JSONPath. Similar to Xpath the JSONPath expression statements enable you to find elements and values within a message payload. Not very surprising the JSONPath expressions work with Json message payloads. With the new release you can overwrite, ignore and manipulate Json elements using JSONPath expressions. See <a href="json-path">json-path</a>for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-customize-message-validators"><a class="anchor" href="#changes-customize-message-validators"></a><a class="link" href="#changes-customize-message-validators">Customize message validators</a></h4>
<div class="paragraph">
<p>The framework offers several message validator implementations for different message formats like XML, JSON, plaintext and so on. In addition to that Citrus has a set of Groovy script message validators. All these validator implementations are active by default so you are able to validate incoming messages accordingly in Citrus. Now with this release we added a more comfortable way of changing the framework validation functionality, particular when adding new customized message validator implementations. See <a href="validation">validation</a> for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-library-upgrades"><a class="anchor" href="#changes-library-upgrades"></a><a class="link" href="#changes-library-upgrades">Library upgrades</a></h4>
<div class="paragraph">
<p>We have upgraded the versions of the major dependency libraries of Citrus. This includes TestNG, JUnit, Spring Framework, Spring WS, Spring Integration, Apache Camel, Arquillian, Jetty and more. So Citrus is now working with up-to-date versions of the whole messaging and middleware integration gang.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-upgrade-from-citrus-2-2"><a class="anchor" href="#changes-upgrade-from-citrus-2-2"></a><a class="link" href="#changes-upgrade-from-citrus-2-2">Upgrade from Citrus 2.2</a></h4>
<div class="paragraph">
<p>Along with new features and improvements we refactored and changed some parts of Citrus so you might have to set things straight when upgrading to 2.3. See the following list of things that might be brought up to you:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">@CitrusTest annotation</dt>
<dd>
<p>We have moved the <strong>@CitrusTest</strong> annotation to a more common package. The old package was <strong>com.consol.citrus.dsl.annotations.CitrusTest</strong> . The new package is <strong>com.consol.citrus.annotations.CitrusTest</strong> . So you have to change the Java import statements in your Test classes when upgrading.</p>
</dd>
<dt class="hdlist1">TestResult</dt>
<dd>
<p>We changed the <strong>TestResult</strong> instantiation when generating the test reports. The <strong>TestResult</strong> class now works with static instantiation methods for success, skipped and failed tests. This only affects your code when you have created custom test reporters.</p>
</dd>
<dt class="hdlist1">CitrusTestBuilder deprecation</dt>
<dd>
<p>A major refactoring was done in the <strong>TestBuilder</strong> Java DSL code. <strong>com.consol.citrus.dsl.TestBuilder</strong> and all its subclasses were marked as deprecated and will disappear in next versions. So instead we now support <strong>com.consol.citrus.dsl.design.TestDesigner</strong> which basically offers the same functionality as former TestBuilder. In addition that refactoring brought a new way of executing the Java DSL test cases. Instead of building the whole test case before execution is done as a whole you can now use the <strong>com.consol.citrus.dsl.runner.TestRunner</strong> implementation in order to execute each test action in the Java DSL immediately. This is a more Java like way of writing Citrus test cases as you can mix Citrus test action execution with normal Java statements as usual. Read more about the new approach in <a href="testcase">testcase</a></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="changes-bugfixes"><a class="anchor" href="#changes-bugfixes"></a><a class="link" href="#changes-bugfixes">Bugfixes</a></h4>
<div class="paragraph">
<p>Bugs are part of our software developers world and fixing them is part of your daily business, too. Finding and solving issues makes Citrus better every day. For a detailed listing of all bugfixes please refer to the complete changes log of each release (<a href="http://www.citrusframework.org/changes-report.html">http://www.citrusframework.org/changes-report.html</a>).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changes-2-2"><a class="anchor" href="#changes-2-2"></a><a class="link" href="#changes-2-2">Changes in Citrus 2.2</a></h3>
<div class="paragraph">
<p>Citrus 2.2 is a release mostly adding new features as well as improvements to given Citrus features. Bugfixes of course are also part of the package. See the following overview on what has changed.</p>
</div>
<div class="sect3">
<h4 id="changes-arquillian"><a class="anchor" href="#changes-arquillian"></a><a class="link" href="#changes-arquillian">Arquillian support</a></h4>
<div class="paragraph">
<p>Arquillian is a well known integration test framework that comes with a great feature set when it comes to Java EE testing inside of a full qualified application server. With Arquiliian you can deploy your Java EE services in a real application server of your choice and execute the tests inside the application server boundaries. This makes it very easy to test your Java EE services in scope with proper JNDI resource allocation and other resources provided by the application server. Citrus is able to connect with the Arquillian test case. Speaking in more detail your Arquillian test is able to use a Citrus extension in order to use the Citrus feature set inside the Arquillian boundaries. See <a href="arquillian">arquillian</a> for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-junit"><a class="anchor" href="#changes-junit"></a><a class="link" href="#changes-junit">JUnit support</a></h4>
<div class="paragraph">
<p>Citrus supports both major players in unit testing TestNG and JUnit. Unfortunately we did not offer the same feature support for JUnit as it was done for TestNG. Now with Citrus 2.2 we improved the JUnit support in Citrus so you are able to use all features with both frameworks. This is especially related to using the <strong>@CitrusTest</strong> and <strong>@CitrusXmlTest</strong> method annotations in test classes. See <a href="run-junit">run-junit</a>how it works.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-start-stop-server-action"><a class="anchor" href="#changes-start-stop-server-action"></a><a class="link" href="#changes-start-stop-server-action">Start/Stop server action</a></h4>
<div class="paragraph">
<p>Citrus was missing a dedicated test action to start and stop Citrus server components at tet runtime. With the newly added test actions you are able to start and stop server components as you like within your test case. See <a href="actions-manage-server">actions-manage-server</a>with a detailed description.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-citrus-ant-tasks"><a class="anchor" href="#changes-citrus-ant-tasks"></a><a class="link" href="#changes-citrus-ant-tasks">Citrus Ant tasks</a></h4>
<div class="paragraph">
<p>We discontinue to support the Citrus Ant tasks. The Ant tasks were not very stable an lacked full feature support when executing test cases with JUnit in Apache Ant. Instead we added a brief description on how to execute Citrus tests with the well documented and stable default JUnit and TestNG ant tasks. See <a href="setup-using-ant">setup-using-ant</a>how it works.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-bugfixes"><a class="anchor" href="#changes-bugfixes"></a><a class="link" href="#changes-bugfixes">Bugfixes</a></h4>
<div class="paragraph">
<p>Bugs are part of our software developers world and fixing them is part of your daily business, too. Finding and solving issues makes Citrus better every day. For a detailed listing of all bugfixes please refer to the complete changes log of each release (<a href="http://www.citrusframework.org/changes-report.html">http://www.citrusframework.org/changes-report.html</a>).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changes-2-1"><a class="anchor" href="#changes-2-1"></a><a class="link" href="#changes-2-1">Changes in Citrus 2.1</a></h3>
<div class="paragraph">
<p>Citrus 2.1 adds some enhancements to the Citrus feature set as well as bugfixes and improvements. See the following overview on what has changed.</p>
</div>
<div class="sect3">
<h4 id="changes-soap-mtom"><a class="anchor" href="#changes-soap-mtom"></a><a class="link" href="#changes-soap-mtom">SOAP MTOM support</a></h4>
<div class="paragraph">
<p>SOAP MTOM stands for Message Transmission Optimization Mechanism which allows you to send and receive large SOAP attachment contents streamed with optimized resource allocation on server and client. Many thanks to community contributions (github/stonator) that made this happen with Citrus SOAP client and server. As a user you can shoose to send and receive SOAP attachments with MTOM optimization. See <a href="soap-attachment-mtom">soap-attachment-mtom</a>for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-soap-envelope-handling"><a class="anchor" href="#changes-soap-envelope-handling"></a><a class="link" href="#changes-soap-envelope-handling">SOAP envelope handling</a></h4>
<div class="paragraph">
<p>In its default behavior Citrus will remove the SOAP envelope for incoming SOAP requests just providing the SOAP body as message payload. This is more straight forward in a test case to perform further validation steps. However it might be mandatory to see the whole SOAP envelope inside the test case for special validation. As a user you can now choose how to handle incoming SOAP envelope by definig the <strong>keep-soap-envelope</strong> setting on the Citrus SOAP server components. See <a href="soap-keep-envelope">soap-keep-envelope</a> for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-soap-1-2-message-factory"><a class="anchor" href="#changes-soap-1-2-message-factory"></a><a class="link" href="#changes-soap-1-2-message-factory">SOAP 1.2 message factory</a></h4>
<div class="paragraph">
<p>The Citrus SOAP server component was missing a setting for the SOAP message factory to use. The SOAP message factory implementation decides which SOAP version to use 1.1 or 1.2. Now you can set the message factory on the server component and define the SOAP version to use. See <a href="soap-12">soap-12</a>for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-testng-data-provider-handling"><a class="anchor" href="#changes-testng-data-provider-handling"></a><a class="link" href="#changes-testng-data-provider-handling">TestNG data provider handling</a></h4>
<div class="paragraph">
<p>We improved the TestNG data provider handling in Citrus. Now you can use the usual TestNG data provider annotations in your test methods. TestNG will call the Citrus test case several times with respective parameters provided as test variables. This replaces the old <strong>citrusDataProvider</strong> mechanism that tried to make things working in a kind of workaround. The new provider handling also supports multiple data providers in a test class. <a href="run-testng-data-providers">run-testng-data-providers</a> describes how this is working for you.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-mail-message-namespace"><a class="anchor" href="#changes-mail-message-namespace"></a><a class="link" href="#changes-mail-message-namespace">Mail message namespace</a></h4>
<div class="paragraph">
<p>The Citrus mail components enable message exchange as mail client and server. For validation purpose the components offer a XML mail message representation. We have added a target namespace and a XSD schema for this XML mail message representation. From now on you have to use the namespace accordingly in your mail message payloads when sending and receiving mail messages in Citrus. See <a href="mail">mail</a> how to use the new XML mail message namespace.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-ssh-message-namespace"><a class="anchor" href="#changes-ssh-message-namespace"></a><a class="link" href="#changes-ssh-message-namespace">Ssh message namespace</a></h4>
<div class="paragraph">
<p>When sending and receiving messages via ssh Citrus provides a XML representation for request and response data. These ssh messages follow a new target namespace and a XSD schema. This means you have to use the namespace accordingly in your ssh message payloads when sending and receiving ssh messages in Citrus. See <a href="ssh">ssh</a> for further details.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="changes-2-0"><a class="anchor" href="#changes-2-0"></a><a class="link" href="#changes-2-0">Changes in Citrus 2.0</a></h3>
<div class="paragraph">
<p>Citrus 2.0 is a major version upgrade and therefore big things should be happening. In the following sections we shortly describe the Citrus evolution. We want you to get a quick overview of what has happened and all the new things in Citrus. So hopefully you can spot your favorite new feature.</p>
</div>
<div class="sect3">
<h4 id="changes-refactoring"><a class="anchor" href="#changes-refactoring"></a><a class="link" href="#changes-refactoring">Refactoring</a></h4>
<div class="paragraph">
<p>In Citrus 1.4 we began to refactor the configuration components in Citrus. This refactoring was finalized in Citrus 2.0 which means that all deprecated classes and api are no longer supported. The classes were removed so you get compilation errors when using those old stuff. If you still use the old configuration see this <a href="migration-sheet"><a href="http://citrusframework.org/migration-sheet.html" class="bare">http://citrusframework.org/migration-sheet.html</a></a>in order to learn how to upgrade to the new configuration. It is worth to do so! In addition to that we did refactoring in following fields:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Reply message correlation</dt>
<dd>
<p>In synchronous communication scenarios Citrus optionally correlated messages across send and receive test actions. In default setting the message correlation was disabled. With 2.0 release we changed this behavior to the opposite. Now message correlation is done by default with a default correlation algorithm. So in case you used the DefaultReplyMessageCorrelator in Citrus before you will not have to do so in future as this is done by default. The message correlation gives us more robust tests especially when executing tests in parallel. In the test case you do not have to do anything for proper message correlation.</p>
</dd>
<dt class="hdlist1">Citrus message API</dt>
<dd>
<p>We have refactored the Citrus message API to use custom message objects in endpoints, consumers and producers. This has no affect on your tests or configuration unless you have written endpoint extensions or custom endpoints on your own. You might have to refactor your code accordingly. Have a look at the Citrus endpoint implementations in order to see how the new message API works for you.</p>
</dd>
<dt class="hdlist1">Sleep time in milliseconds</dt>
<dd>
<p>This is something that we definitely carry around since the beginning of Citrus. The time values in sleep test action were done in seconds, which is inconvenient when using time periods below one second or non natural numbers. Now you can choose to use milliseconds which is more likely how you should configure time periods anyway. See <a href="actions-sleep">actions-sleep</a>for details</p>
</dd>
<dt class="hdlist1">Auto sleep time in milliseconds</dt>
<dd>
<p>We used seconds when using auto sleep in repeat on error container. This led to the fact that we were not able to sleep time periods below one second. Also it was not possible to specify non natural numbers such as 1.5 seconds auto sleep time. We changed to milliseconds which is more likely how you are used to configure time periods anyway. See <a href="containers-repeat-onerror">containers-repeat-onerror</a>for details</p>
</dd>
<dt class="hdlist1">Message handler vs. endpoint adapter</dt>
<dd>
<p>In previous releases prior to 1.4 we had message handlers on server side that were able to forward in coming requests to message channels or jms destinations. The old message handler implementations were removed in 2.0. Instead you should use the <strong>endpoint-adapter</strong> implementations. See <a href="endpoint-adapter">endpoint-adapter</a>how that works.</p>
</dd>
<dt class="hdlist1">XML endpoint reference attribute</dt>
<dd>
<p>In a XML test case you reference the message endpoint in the send and receive actions with a special attribute called <strong>with</strong> . This attribute is no longer supported and was removed. Instead you should use the <strong>endpoint</strong> attribute which was introduced in Citrus 1.4 and has the exact same functionality.</p>
</dd>
<dt class="hdlist1">Removed citrus-adapter module</dt>
<dd>
<p>The Maven module <strong>citrus-adapter</strong> was removed. Classes and API moved to <strong>citrus-core</strong> module. For endpoint adapters do use the new configuration components that were introduced in Citrus 1.4. See <a href="endpoint-adapter">endpoint-adapter</a>for details.</p>
</dd>
<dt class="hdlist1">WebServiceEndpoint class renamed</dt>
<dd>
<p>In terms of package refactoring the <strong>com.consol.citrus.ws.WebServiceEndpoint</strong> was renamed to <strong>com.consol.citrus.ws.server.WebServiceEndpoint</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="changes-spring-framework-4-x"><a class="anchor" href="#changes-spring-framework-4-x"></a><a class="link" href="#changes-spring-framework-4-x">Spring framework 4.x</a></h4>
<div class="paragraph">
<p>In terms of upgrading the Citrus API dependencies we introduced Spring 4.x versions. This includes the core Spring framework libraries as well as the Spring Integration and Spring WebService project artifacts. So with the major version upgrade lots of API changes were also done in Citrus code in order to meet the new Spring 4.x API. So we recommend for you to also use Spring 4.x version in your Citrus projects.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-ftp"><a class="anchor" href="#changes-ftp"></a><a class="link" href="#changes-ftp">FTP support</a></h4>
<div class="paragraph">
<p>New member of the Citrus family deals with FTP connectivity. The new <strong>citrus-ftp</strong> module provides a neat ftp server and client implementation so you can send and receive messages vie FTP message transport. <a href="ftp">ftp</a> describes the new functionality in detail.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-functions-with-test-context-access"><a class="anchor" href="#changes-functions-with-test-context-access"></a><a class="link" href="#changes-functions-with-test-context-access">Functions with test context access</a></h4>
<div class="paragraph">
<p>Functions are now able to access the test context. This enables you to access all test variables and other central test related components in a function implementation. Therefore the function Java interface has now an additional test context parameter. Refactor your custom written functions accordingly to meet the new interface rules. See <a href="http://www.citrusframework.org/tutorials-functions.html">how to write custom functions</a> for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-validation-matcher-with-test-context-access"><a class="anchor" href="#changes-validation-matcher-with-test-context-access"></a><a class="link" href="#changes-validation-matcher-with-test-context-access">Validation matcher with test context access</a></h4>
<div class="paragraph">
<p>Just like functions now validation matchers are able to access the test context. This enables you to access all test variables and other central test related components in a validation matcher implementation. The validation matcher Java interface has changed accordingly with an additional test context parameter. Refactor your custom written matcher implementation accordingly to meet the new interface rules.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-message-listener-with-test-context-access"><a class="anchor" href="#changes-message-listener-with-test-context-access"></a><a class="link" href="#changes-message-listener-with-test-context-access">Message listener with test context access</a></h4>
<div class="paragraph">
<p>Message listeners do now also have access to the test context. This is more powerful as you can access test variables and other central components within the test context.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-soap-over-jms"><a class="anchor" href="#changes-soap-over-jms"></a><a class="link" href="#changes-soap-over-jms">SOAP over JMS</a></h4>
<div class="paragraph">
<p>SOAP over JMS was supported in Citrus from the very beginning. Unfortunately you had to always specify the whole SOAP envelope in your test case. SOAP envelope handling is now done automatically by Citrus when using the new <strong>SoapJmsMessageConverter</strong> . The converter takes care on constructing a proper SOAP envelope message. See <a href="jms-soap">jms-soap</a>for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-multiple-soap-attachments"><a class="anchor" href="#changes-multiple-soap-attachments"></a><a class="link" href="#changes-multiple-soap-attachments">Multiple SOAP attachments</a></h4>
<div class="paragraph">
<p>When sending and receiving SOAP messages with Citrus as client or server you can add one to many attachments to the message. Before it was only possible to have one single attachment in a message. Now you have no limits in defining SOAP attachments. See <a href="soap-webservices">soap-webservices</a>for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-multiple-soap-xml-header-fragments"><a class="anchor" href="#changes-multiple-soap-xml-header-fragments"></a><a class="link" href="#changes-multiple-soap-xml-header-fragments">Multiple SOAP XML header fragments</a></h4>
<div class="paragraph">
<p>The SOAP header can hold multiple XML header fragments with different namespaces and content. With Citrus 2.0 you are able to construct such a SOAP message with multiple header contents. See <a href="soap-webservices">soap-webservices</a>for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-create-variable-validation-matcher"><a class="anchor" href="#changes-create-variable-validation-matcher"></a><a class="link" href="#changes-create-variable-validation-matcher">Create variable validation matcher</a></h4>
<div class="paragraph">
<p>A new validation matcher implementation is able to create a new variable on the fly. The actual field name is used as variable name and the element value as variable value. The variable name can slo be customized with optional validation matcher parameter. This is a great alternative to the XPath expression evaluating variable extraction. Also very handsome to use this validation matcher in Json message payloads. See <a href="validation-matcher-variable">validation-matcher-variable</a>for details.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-new-configuration-components"><a class="anchor" href="#changes-new-configuration-components"></a><a class="link" href="#changes-new-configuration-components">New configuration components</a></h4>
<div class="paragraph">
<p>A major part of the Citrus configuration is done in a Spring bean application context. Central Citrus components and features are added as Spring beans to the application context. Now with Citrus 2.0 we have added special configuration components for almost all features. This means that you can easily add configuration using the new XML schema components. See which components are available:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Function library</dt>
<dd>
<p>Custom function libraries with custom function implementations are now configured with the <strong>function-library</strong> XML schema components in the Spring application context configuration. See <a href="functions">functions</a> for details.</p>
</dd>
<dt class="hdlist1">Validation matcher library</dt>
<dd>
<p>Custom validation matcher implementations are now configured with the <strong>validation-matcher-library</strong> XML schema components in the Spring application context configuration. See <a href="validation-matchers">validation-matchers</a>for details.</p>
</dd>
<dt class="hdlist1">Data dictionary</dt>
<dd>
<p>Data dictionaries apply to all messages send and received in test cases. You can define multiple dictionaries using the <strong>data-dictionary</strong> XML schema components in the Spring application context configuration. See <a href="data-dictionary">data-dictionary</a> for details.</p>
</dd>
<dt class="hdlist1">Namespace context</dt>
<dd>
<p>Configuration of a global namespace context is necessary for XML message payloads and XPath expressions used in the test cases. The <strong>namespace-context</strong> XML schema component is used in the Spring application context configuration and simplifies the configuration. See <a href="xpath">xpath</a> for details.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="changes-before-after-suite-components"><a class="anchor" href="#changes-before-after-suite-components"></a><a class="link" href="#changes-before-after-suite-components">Before/after suite components</a></h4>
<div class="paragraph">
<p>When executing test actions before the actual test run you can use the sequence before suite components. We have improved these components to use a special XML schema. This enables easy configuration of both before and after suite actions. In addition to that you can bind the suite actions to special packages, test names or suite names. So you can now have more than one sequence before suite at the same time. According to the environment settings the before suite actions are executed or left out. Last not least we have done the same improvement to the before test actions and we have introduced a after test sequence component for execution after each test. See how this is done in <a href="testsuite">testsuite</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="changes-citrus-jms-module"><a class="anchor" href="#changes-citrus-jms-module"></a><a class="link" href="#changes-citrus-jms-module">Citrus JMS module</a></h4>
<div class="paragraph">
<p>JMS support has been a major part of Citrus from the very beginning. Up to now the JMS features were located in <strong>citrus-core</strong> Maven module. With Citrus 2.0 we introduced a separate <strong>citrus-jms</strong> Maven module. This means that you might have to add proper Maven dependency of this new module in your existing project when using JMS. See how this is done in <a href="jms">jms</a>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 2.7.3<br>
Last updated 2018-01-15 14:37:32 MESZ
</div>
</div>
<style>
  #footer {
    height: 180px;
  }

  #footer-sponsor {
    position: absolute;
    bottom: 5px;
    right: 25px;
    float: right;
  }
</style>
<div id="footer-sponsor">
    <img src="images/bmi_logo_eng.png" alt="Federal Ministry for Economic Affairs and Energy" style="margin-right: 50px"/>
    <a href="https://www.consol.de" target="_blank" alt="ConSol Software GmbH"><img src="images/sponsor-logo.png" /></a>
</div>
</body>
</html>