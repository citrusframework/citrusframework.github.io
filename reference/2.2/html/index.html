<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Citrus Framework - Reference Documentation</title><link xmlns="http://www.w3.org/TR/xhtml1/transitional" href="css/reference.css" rel="stylesheet" type="text/css"></link><meta name="generator" content="DocBook XSL Stylesheets V1.72.0"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="book" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="d0e1"></a>Citrus Framework - Reference Documentation</h1></div><div><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="authorgroup"><h2>Authors</h2><p></p><span class="author"><span xmlns="" class="firstname">Christoph</span> <span xmlns="" class="surname">Deppisch</span></span></div></div><div><p class="releaseinfo">2.2</p></div><div><p class="copyright">Copyright &copy; 2015 ConSol* Software GmbH</p></div></div><hr xmlns="http://www.w3.org/TR/xhtml1/transitional"></hr><img xmlns="http://www.w3.org/TR/xhtml1/transitional" src="images/citrus_logo.jpg" style="width:25%;float:right;"></img></div><div class="toc"><dl><dt><span class="preface"><a href="#preface">Preface</a></span></dt><dt><span class="chapter"><a href="#changes-new">1. What's new in Citrus 2.2?!</a></span></dt><dd><dl><dt><span class="section"><a href="#new-2-2-arquillian">1.1. Arquillian support</a></span></dt><dt><span class="section"><a href="#new-2-2-junit-improvements">1.2. JUnit support</a></span></dt><dt><span class="section"><a href="#new-2-2-startstop-action">1.3. Start/Stop server action</a></span></dt><dt><span class="section"><a href="#new-2-2-anttasks">1.4. Citrus Ant tasks</a></span></dt><dt><span class="section"><a href="#new-2-2-bugfixes">1.5. Bugfixes</a></span></dt></dl></dd><dt><span class="chapter"><a href="#introduction">2. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#introduction-overview">2.1. Overview</a></span></dt><dt><span class="section"><a href="#introduction-usage">2.2. Usage scenarios</a></span></dt></dl></dd><dt><span class="chapter"><a href="#setup">3. Setup</a></span></dt><dd><dl><dt><span class="section"><a href="#setup-using-maven">3.1. Using Maven</a></span></dt><dd><dl><dt><span class="section"><a href="#setup-maven-archetype">3.1.1. Use Citrus Maven archetype</a></span></dt><dt><span class="section"><a href="#setup-maven-integration">3.1.2. Add Citrus to existing Maven project</a></span></dt></dl></dd><dt><span class="section"><a href="#setup-using-ant">3.2. Using Ant</a></span></dt><dd><dl><dt><span class="section"><a href="#setup-prerequisits">3.2.1. Preconditions</a></span></dt><dt><span class="section"><a href="#setup-ant-download">3.2.2. Download</a></span></dt><dt><span class="section"><a href="#setup-ant-installation">3.2.3. Installation</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#testcase">4. Test cases</a></span></dt><dd><dl><dt><span class="section"><a href="#testcase-defining">4.1. Writing a test case</a></span></dt><dd><dl><dt><span class="section"><a href="#testcase-description">4.1.1. Description</a></span></dt><dt><span class="section"><a href="#testcase-variables">4.1.2. Variables</a></span></dt><dt><span class="section"><a href="#testcase-global-variables">4.1.3. Global variables</a></span></dt><dt><span class="section"><a href="#testcase-actions">4.1.4. Test Actions</a></span></dt><dt><span class="section"><a href="#testcase-finally">4.1.5. Finally cleanup section</a></span></dt></dl></dd><dt><span class="section"><a href="#testcase-metainfo">4.2. Meta information</a></span></dt></dl></dd><dt><span class="chapter"><a href="#test-actors">5. Test actors</a></span></dt><dd><dl><dt><span class="section"><a href="#test-actors-define">5.1. Define test actors</a></span></dt><dt><span class="section"><a href="#test-actors-link">5.2. Link test actors</a></span></dt><dt><span class="section"><a href="#test-actors-disable">5.3. Disable test actors</a></span></dt></dl></dd><dt><span class="chapter"><a href="#run">6. Running tests</a></span></dt><dd><dl><dt><span class="section"><a href="#run-testng">6.1. Run with TestNG</a></span></dt><dd><dl><dt><span class="section"><a href="#run-testng-data-providers">6.1.1. Using TestNG DataProviders</a></span></dt></dl></dd><dt><span class="section"><a href="#run-junit">6.2. Run with JUnit</a></span></dt></dl></dd><dt><span class="chapter"><a href="#messaging">7. Messaging</a></span></dt><dd><dl><dt><span class="section"><a href="#message-sending">7.1. Sending messages</a></span></dt><dt><span class="section"><a href="#message-receiving">7.2. Receiving messages</a></span></dt><dd><dl><dt><span class="section"><a href="#message-payload-validation">7.2.1. Validate message content</a></span></dt><dt><span class="section"><a href="#message-dynamic-validation">7.2.2. Dynamic message values</a></span></dt><dt><span class="section"><a href="#message-validation-ignore">7.2.3. Ignore message elements</a></span></dt><dt><span class="section"><a href="#message-validation-elements">7.2.4. Explicit message element validation</a></span></dt><dt><span class="section"><a href="#message-header-validation">7.2.5. Validate the message header</a></span></dt><dt><span class="section"><a href="#message-content-extract">7.2.6. Saving message content to variables</a></span></dt><dt><span class="section"><a href="#message-selector">7.2.7. Message selectors</a></span></dt></dl></dd><dt><span class="section"><a href="#validation-callback">7.3. Validation callback</a></span></dt><dt><span class="section"><a href="#groovy-utils">7.4. Groovy utils for send and receive</a></span></dt><dd><dl><dt><span class="section"><a href="#groovy-markupbuilder">7.4.1. Groovy MarkupBuilder</a></span></dt><dt><span class="section"><a href="#groovy-xmlslurper">7.4.2. Groovy XmlSlurper</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#validation">8. Message validation</a></span></dt><dd><dl><dt><span class="section"><a href="#validation-json">8.1. JSON message validation</a></span></dt><dt><span class="section"><a href="#validation-xhtml">8.2. XHTML message validation</a></span></dt><dt><span class="section"><a href="#validation-plaintext">8.3. Plain text message validation</a></span></dt></dl></dd><dt><span class="chapter"><a href="#schema-validation">9. XML schema validation</a></span></dt><dd><dl><dt><span class="section"><a href="#xsd-validation">9.1. XSD schema repositories</a></span></dt><dt><span class="section"><a href="#wsdl-validation">9.2. WSDL schemas</a></span></dt><dt><span class="section"><a href="#schema-location-pattern">9.3. Schema location patterns</a></span></dt><dt><span class="section"><a href="#schema-collections">9.4. Schema collections</a></span></dt><dt><span class="section"><a href="#schema-mapping-strategy">9.5. Schema mapping strategy</a></span></dt><dd><dl><dt><span class="section"><a href="#target-namespace-strategy">9.5.1. Target Namespace Mapping Strategy</a></span></dt><dt><span class="section"><a href="#root-qname-strategy">9.5.2. Root QName Mapping Strategy</a></span></dt><dt><span class="section"><a href="#schema-mapping-chain">9.5.3. Schema mapping strategy chain</a></span></dt></dl></dd><dt><span class="section"><a href="#schema-definition-overrule">9.6. Schema definition overruling</a></span></dt><dt><span class="section"><a href="#dtd-validation">9.7. DTD validation</a></span></dt></dl></dd><dt><span class="chapter"><a href="#xpath">10. Using XPath</a></span></dt><dd><dl><dt><span class="section"><a href="#xpath-namespace">10.1. Handling XML namespaces</a></span></dt><dt><span class="section"><a href="#xpath-default-namespaces">10.2. Handling default namespaces</a></span></dt></dl></dd><dt><span class="chapter"><a href="#actions">11. Test actions</a></span></dt><dd><dl><dt><span class="section"><a href="#actions-database">11.1. Connecting to the database</a></span></dt><dd><dl><dt><span class="section"><a href="#actions-database-update">11.1.1. Updating the database</a></span></dt><dt><span class="section"><a href="#actions-database-query">11.1.2. Verifying data from the database</a></span></dt><dt><span class="section"><a href="#actions-database-groovy">11.1.3. Groovy SQL result set validation</a></span></dt><dt><span class="section"><a href="#actions-database-read-values">11.1.4. Read data from database</a></span></dt></dl></dd><dt><span class="section"><a href="#actions-sleep">11.2. Sleep</a></span></dt><dt><span class="section"><a href="#actions-java">11.3. Java</a></span></dt><dt><span class="section"><a href="#actions-timeout">11.4. Expect timeouts on a destination</a></span></dt><dt><span class="section"><a href="#actions-echo">11.5. Echo</a></span></dt><dt><span class="section"><a href="#actions-measure-time">11.6. Time measurement</a></span></dt><dt><span class="section"><a href="#actions-create-variables">11.7. Create variables</a></span></dt><dt><span class="section"><a href="#actions-trace">11.8. Trace variables</a></span></dt><dt><span class="section"><a href="#actions-transform">11.9. Transform</a></span></dt><dt><span class="section"><a href="#actions-groovy">11.10. Groovy support</a></span></dt><dt><span class="section"><a href="#actions-fail">11.11. Failing the test</a></span></dt><dt><span class="section"><a href="#actions-input">11.12. Input</a></span></dt><dt><span class="section"><a href="#actions-load">11.13. Load</a></span></dt><dt><span class="section"><a href="#actions-purge-jms">11.14. Purging JMS destinations</a></span></dt><dt><span class="section"><a href="#actions-purge-channels">11.15. Purging message channels</a></span></dt><dt><span class="section"><a href="#actions-assert">11.16. Assert failure</a></span></dt><dt><span class="section"><a href="#actions-catch">11.17. Catch exceptions</a></span></dt><dt><span class="section"><a href="#actions-antrun">11.18. Running Apache Ant build targets</a></span></dt><dt><span class="section"><a href="#actions-manage-server">11.19. Start/Stop server instances</a></span></dt><dt><span class="section"><a href="#actions-generic-action">11.20. Including custom test actions</a></span></dt></dl></dd><dt><span class="chapter"><a href="#templates">12. Templates</a></span></dt><dt><span class="chapter"><a href="#containers">13. Containers</a></span></dt><dd><dl><dt><span class="section"><a href="#containers-sequential">13.1. Sequential</a></span></dt><dt><span class="section"><a href="#containers-conditional">13.2. Conditional</a></span></dt><dt><span class="section"><a href="#containers-parallel">13.3. Parallel</a></span></dt><dt><span class="section"><a href="#containers-iterate">13.4. Iterate</a></span></dt><dt><span class="section"><a href="#containers-repeat">13.5. Repeat until true</a></span></dt><dt><span class="section"><a href="#containers-repeat-onerror">13.6. Repeat on error until true</a></span></dt></dl></dd><dt><span class="chapter"><a href="#finally">14. Finally section</a></span></dt><dt><span class="chapter"><a href="#jms">15. JMS support</a></span></dt><dd><dl><dt><span class="section"><a href="#jms-endpoints">15.1. JMS endpoints</a></span></dt><dt><span class="section"><a href="#jms-sync-endpoints">15.2. JMS synchronous endpoints</a></span></dt><dt><span class="section"><a href="#jms-topics">15.3. JMS topics</a></span></dt><dt><span class="section"><a href="#jms-headers">15.4. JMS message headers</a></span></dt><dt><span class="section"><a href="#jms-soap">15.5. SOAP over JMS</a></span></dt></dl></dd><dt><span class="chapter"><a href="#http">16. HTTP REST support</a></span></dt><dd><dl><dt><span class="section"><a href="#http-client">16.1. HTTP REST client</a></span></dt><dt><span class="section"><a href="#http-server">16.2. HTTP REST server</a></span></dt><dt><span class="section"><a href="#http-headers">16.3. HTTP headers</a></span></dt><dt><span class="section"><a href="#http-error-handling">16.4. HTTP error handling</a></span></dt><dt><span class="section"><a href="#http-basic-auth-client">16.5. HTTP client basic authentication</a></span></dt><dt><span class="section"><a href="#http-basic-auth-server">16.6. HTTP server basic authentication</a></span></dt><dt><span class="section"><a href="#http-servlet-context">16.7. HTTP servlet context customization</a></span></dt></dl></dd><dt><span class="chapter"><a href="#soap-webservices">17. SOAP WebServices</a></span></dt><dd><dl><dt><span class="section"><a href="#soap-client">17.1. SOAP client</a></span></dt><dt><span class="section"><a href="#soap-server">17.2. SOAP server</a></span></dt><dt><span class="section"><a href="#soap-header">17.3. SOAP headers</a></span></dt><dt><span class="section"><a href="#soap-mime-headers">17.4. SOAP HTTP mime headers</a></span></dt><dt><span class="section"><a href="#soap-keep-envelope">17.5. SOAP Envelope handling</a></span></dt><dt><span class="section"><a href="#soap-12">17.6. SOAP 1.2</a></span></dt><dt><span class="section"><a href="#soap-faults">17.7. SOAP faults</a></span></dt><dd><dl><dt><span class="section"><a href="#soap-fault-send">17.7.1. Send SOAP faults</a></span></dt><dt><span class="section"><a href="#soap-fault-receive">17.7.2. Receive SOAP faults</a></span></dt><dt><span class="section"><a href="#soap-fault-details">17.7.3. Multiple SOAP fault details</a></span></dt></dl></dd><dt><span class="section"><a href="#soap-http-errors">17.8. Send HTTP error codes with SOAP</a></span></dt><dt><span class="section"><a href="#soap-attachments">17.9. SOAP attachment support</a></span></dt><dd><dl><dt><span class="section"><a href="#soap-attachment-send">17.9.1. Send SOAP attachments</a></span></dt><dt><span class="section"><a href="#soap-attachment-receiver">17.9.2. Receive SOAP attachments</a></span></dt><dt><span class="section"><a href="#soap-attachment-mtom">17.9.3. SOAP MTOM support</a></span></dt></dl></dd><dt><span class="section"><a href="#soap-basic-auth-client">17.10. SOAP client basic authentication</a></span></dt><dt><span class="section"><a href="#soap-basic-auth-server">17.11. SOAP server basic authentication</a></span></dt><dt><span class="section"><a href="#soap-ws-adressing">17.12. WS-Addressing support</a></span></dt><dt><span class="section"><a href="#soap-fork-mode">17.13. SOAP client fork mode</a></span></dt><dt><span class="section"><a href="#soap-servlet-context">17.14. SOAP servlet context customization</a></span></dt></dl></dd><dt><span class="chapter"><a href="#ftp">18. FTP support</a></span></dt><dd><dl><dt><span class="section"><a href="#ftp-client">18.1. FTP client</a></span></dt><dt><span class="section"><a href="#ftp-server">18.2. FTP server</a></span></dt></dl></dd><dt><span class="chapter"><a href="#message-channel">19. Message channel support</a></span></dt><dd><dl><dt><span class="section"><a href="#message-channel-endpoint">19.1. Channel endpoint</a></span></dt><dt><span class="section"><a href="#sync-message-channel-endpoint">19.2. Synchronous channel endpoints</a></span></dt><dt><span class="section"><a href="#message-channel-selector-support">19.3. Message selectors on channels</a></span></dt><dd><dl><dt><span class="section"><a href="#root-qname-message-selector">19.3.1. Root QName Message Selector</a></span></dt><dt><span class="section"><a href="#xpath-evaluating-message-selector">19.3.2. XPath Evaluating Message Selector</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#file">20. File support</a></span></dt><dd><dl><dt><span class="section"><a href="#file-send">20.1. Write files</a></span></dt><dt><span class="section"><a href="#file-receive">20.2. Read files</a></span></dt></dl></dd><dt><span class="chapter"><a href="#camel">21. Apache Camel support</a></span></dt><dd><dl><dt><span class="section"><a href="#camel-endpoint">21.1. Camel endpoint</a></span></dt><dt><span class="section"><a href="#camel-sync-endpoint">21.2. Synchronous Camel endpoint</a></span></dt><dt><span class="section"><a href="#camel-exchange-headers">21.3. Camel exchange headers</a></span></dt><dt><span class="section"><a href="#camel-exception-handling">21.4. Camel exception handling</a></span></dt><dt><span class="section"><a href="#camel-context">21.5. Camel context handling</a></span></dt></dl></dd><dt><span class="chapter"><a href="#vertx">22. Vert.x event bus support</a></span></dt><dd><dl><dt><span class="section"><a href="#vertx-endpoint">22.1. Vert.x endpoint</a></span></dt><dt><span class="section"><a href="#vertx-sync-endpoint">22.2. Synchronous Vert.x endpoint</a></span></dt><dt><span class="section"><a href="#vertx-instance-factory">22.3. Vert.x instance factory</a></span></dt></dl></dd><dt><span class="chapter"><a href="#mail">23. Mail support</a></span></dt><dd><dl><dt><span class="section"><a href="#mail-client">23.1. Mail client</a></span></dt><dt><span class="section"><a href="#mail-server">23.2. Mail server</a></span></dt></dl></dd><dt><span class="chapter"><a href="#arquillian">24. Arquillian support</a></span></dt><dd><dl><dt><span class="section"><a href="#arquillian-extension">24.1. Citrus Arquillian extension</a></span></dt><dt><span class="section"><a href="#arquillian-client">24.2. Client side testing</a></span></dt><dt><span class="section"><a href="#arquillian-container">24.3. Container side testing</a></span></dt></dl></dd><dt><span class="chapter"><a href="#ssh">25. SSH support</a></span></dt><dd><dl><dt><span class="section"><a href="#ssh-client">25.1. SSH Client</a></span></dt><dt><span class="section"><a href="#ssh-server">25.2. SSH Server</a></span></dt></dl></dd><dt><span class="chapter"><a href="#endpoint-components">26. Dynamic endpoint components</a></span></dt><dt><span class="chapter"><a href="#endpoint-adapter">27. Endpoint adapter</a></span></dt><dd><dl><dt><span class="section"><a href="#endpoint-adapter-empty">27.1. Empty response endpoint adapter</a></span></dt><dt><span class="section"><a href="#endpoint-adapter-static">27.2. Static response endpoint adapter</a></span></dt><dt><span class="section"><a href="#endpoint-adapter-dispatcher">27.3. Request dispatching endpoint adapter</a></span></dt><dt><span class="section"><a href="#endpoint-adapter-channel">27.4. Channel endpoint adapter</a></span></dt><dt><span class="section"><a href="#endpoint-adapter-jms">27.5. JMS endpoint adapter</a></span></dt></dl></dd><dt><span class="chapter"><a href="#functions">28. Functions</a></span></dt><dd><dl><dt><span class="section"><a href="#functions-concat">28.1. citrus:concat()</a></span></dt><dt><span class="section"><a href="#functions-substring">28.2. citrus:substring()</a></span></dt><dt><span class="section"><a href="#functions-string-length">28.3. citrus:stringLength()</a></span></dt><dt><span class="section"><a href="#functions-translate">28.4. citrus:translate()</a></span></dt><dt><span class="section"><a href="#functions-substring-before">28.5. citrus:substringBefore()</a></span></dt><dt><span class="section"><a href="#functions-substring-after">28.6. citrus:substringAfter()</a></span></dt><dt><span class="section"><a href="#functions-round">28.7. citrus:round()</a></span></dt><dt><span class="section"><a href="#functions-floor">28.8. citrus:floor()</a></span></dt><dt><span class="section"><a href="#functions-ceiling">28.9. citrus:ceiling()</a></span></dt><dt><span class="section"><a href="#functions-random-number">28.10. citrus:randomNumber()</a></span></dt><dt><span class="section"><a href="#functions-random-string">28.11. citrus:randomString()</a></span></dt><dt><span class="section"><a href="#functions-random-enum-value">28.12. citrus:randomEnumValue()</a></span></dt><dt><span class="section"><a href="#functions-current-date">28.13. citrus:currentDate()</a></span></dt><dt><span class="section"><a href="#functions-upper-case">28.14. citrus:upperCase()</a></span></dt><dt><span class="section"><a href="#functions-lower-case">28.15. citrus:lowerCase()</a></span></dt><dt><span class="section"><a href="#functions-average">28.16. citrus:average()</a></span></dt><dt><span class="section"><a href="#functions-minimum">28.17. citrus:minimum()</a></span></dt><dt><span class="section"><a href="#functions-maximum">28.18. citrus:maximum()</a></span></dt><dt><span class="section"><a href="#functions-sum">28.19. citrus:sum()</a></span></dt><dt><span class="section"><a href="#functions-absolute">28.20. citrus:absolute()</a></span></dt><dt><span class="section"><a href="#functions-map-value">28.21. citrus:mapValue()</a></span></dt><dt><span class="section"><a href="#functions-random-uuid">28.22. citrus:randomUUID()</a></span></dt><dt><span class="section"><a href="#functions-encode-base64">28.23. citrus:encodeBase64()</a></span></dt><dt><span class="section"><a href="#functions-decode-base64">28.24. citrus:decodeBase64()</a></span></dt><dt><span class="section"><a href="#functions-escape-xml">28.25. citrus:escapeXml()</a></span></dt><dt><span class="section"><a href="#functions-cdata-section">28.26. citrus:cdataSection()</a></span></dt><dt><span class="section"><a href="#functions-digest-auth">28.27. citrus:digestAuthHeader()</a></span></dt><dt><span class="section"><a href="#functions-localhost-address">28.28. citrus:localHostAddress()</a></span></dt><dt><span class="section"><a href="#functions-changedate">28.29. citrus:changeDate()</a></span></dt></dl></dd><dt><span class="chapter"><a href="#validation-matchers">29. Validation matcher</a></span></dt><dd><dl><dt><span class="section"><a href="#validation-matcher-xml">29.1. matchesXml()</a></span></dt><dt><span class="section"><a href="#validation-matcher-equals">29.2. equalsIgnoreCase()</a></span></dt><dt><span class="section"><a href="#validation-matcher-contains">29.3. contains()</a></span></dt><dt><span class="section"><a href="#validation-matcher-startswith">29.4. startsWith()</a></span></dt><dt><span class="section"><a href="#validation-matcher-endswith">29.5. endsWith()</a></span></dt><dt><span class="section"><a href="#validation-matcher-matches">29.6. matches()</a></span></dt><dt><span class="section"><a href="#validation-matcher-datepattern">29.7. matchesDatePattern()</a></span></dt><dt><span class="section"><a href="#validation-matcher-isnumber">29.8. isNumber()</a></span></dt><dt><span class="section"><a href="#validation-matcher-lowerthan">29.9. lowerThan()</a></span></dt><dt><span class="section"><a href="#validation-matcher-greaterthan">29.10. greaterThan()</a></span></dt><dt><span class="section"><a href="#validation-matcher-weekday">29.11. isWeekday()</a></span></dt><dt><span class="section"><a href="#validation-matcher-variable">29.12. variable()</a></span></dt></dl></dd><dt><span class="chapter"><a href="#data-dictionary">30. Data dictionaries</a></span></dt><dd><dl><dt><span class="section"><a href="#xml-data-dictionary">30.1. XML data dictionaries</a></span></dt><dt><span class="section"><a href="#json-data-dictionary">30.2. JSON data dictionaries</a></span></dt><dt><span class="section"><a href="#data-dictionary-scope">30.3. Dictionary scopes</a></span></dt><dt><span class="section"><a href="#data-dictonary-mapping-strategy">30.4. Path mapping strategies</a></span></dt></dl></dd><dt><span class="chapter"><a href="#testsuite">31. Actions before/after the test run</a></span></dt><dd><dl><dt><span class="section"><a href="#testsuite-before">31.1. Before suite</a></span></dt><dt><span class="section"><a href="#testsuite-after">31.2. After suite</a></span></dt><dt><span class="section"><a href="#testsuite-before-test">31.3. Before test</a></span></dt><dt><span class="section"><a href="#testsuite-after-test">31.4. After test</a></span></dt></dl></dd><dt><span class="chapter"><a href="#meta-info">32. Customize meta information</a></span></dt><dt><span class="chapter"><a href="#message-tracing">33. Tracing incoming/outgoing messages</a></span></dt><dt><span class="chapter"><a href="#reporting">34. Reporting and test results</a></span></dt><dd><dl><dt><span class="section"><a href="#reporting-logging">34.1. Console logging</a></span></dt><dt><span class="section"><a href="#reporting-junit">34.2. JUnit reports</a></span></dt><dt><span class="section"><a href="#reporting-html">34.3. HTML reports</a></span></dt></dl></dd><dt><span class="appendix"><a href="#samples">A. Citrus Samples</a></span></dt><dd><dl><dt><span class="section"><a href="#samples-flightbooking">A.1. The FlightBooking sample</a></span></dt><dd><dl><dt><span class="section"><a href="#samples-flightbooking-usecase">A.1.1. The use case</a></span></dt><dt><span class="section"><a href="#samples-flightbooking-configuration">A.1.2. Configure the simulated systems</a></span></dt><dt><span class="section"><a href="#samples-flightbooking-http">A.1.3. Configure the Http adapter</a></span></dt><dt><span class="section"><a href="#samples-flightbooking-testcase">A.1.4. The test case</a></span></dt></dl></dd></dl></dd><dt><span class="appendix"><a href="#changes-history">B. Change History</a></span></dt><dd><dl><dt><span class="section"><a href="#history-2-1">B.1. Changes in Citrus 2.1</a></span></dt><dd><dl><dt><span class="section"><a href="#new-2-1-soap-mtom">B.1.1. SOAP MTOM support</a></span></dt><dt><span class="section"><a href="#new-2-1-soap-keep-envelope">B.1.2. SOAP envelope handling</a></span></dt><dt><span class="section"><a href="#new-2-1-soap-1-2">B.1.3. SOAP 1.2 message factory</a></span></dt><dt><span class="section"><a href="#new-2-1-testng-data-provider">B.1.4. TestNG data provider handling</a></span></dt><dt><span class="section"><a href="#new-2-1-mail-namespace">B.1.5. Mail message namespace</a></span></dt><dt><span class="section"><a href="#new-2-1-ssh-namespace">B.1.6. Ssh message namespace</a></span></dt></dl></dd><dt><span class="section"><a href="#history-2-0">B.2. Changes in Citrus 2.0</a></span></dt><dd><dl><dt><span class="section"><a href="#history-2-0-refactoring">B.2.1. Refactoring</a></span></dt><dt><span class="section"><a href="#history-2-0-spring-4">B.2.2. Spring framework 4.x</a></span></dt><dt><span class="section"><a href="#history-2-0-ftp">B.2.3. FTP support</a></span></dt><dt><span class="section"><a href="#history-2-0-functions-refactoring">B.2.4. Functions with test context access</a></span></dt><dt><span class="section"><a href="#history-2-0-matcher-refactoring">B.2.5. Validation matcher with test context access</a></span></dt><dt><span class="section"><a href="#history-2-0-message-listener-refactoring">B.2.6. Message listener with test context access</a></span></dt><dt><span class="section"><a href="#history-2-0-soap-jms">B.2.7. SOAP over JMS</a></span></dt><dt><span class="section"><a href="#history-2-0-soap-attachments">B.2.8. Multiple SOAP attachments</a></span></dt><dt><span class="section"><a href="#history-2-0-soap-header">B.2.9. Multiple SOAP XML header fragments</a></span></dt><dt><span class="section"><a href="#history-2-0-variable-matcher">B.2.10. Create variable validation matcher</a></span></dt><dt><span class="section"><a href="#history-2-0-configuration-components">B.2.11. New configuration components</a></span></dt><dt><span class="section"><a href="#history-2-0-before-after-suite">B.2.12. Before/after suite components</a></span></dt><dt><span class="section"><a href="#history-2-0-jms-module">B.2.13. Citrus JMS module</a></span></dt></dl></dd><dt><span class="section"><a href="#history-1-4">B.3. Changes in Citrus 1.4.x</a></span></dt><dd><dl><dt><span class="section"><a href="#history-1-4-refactoring">B.3.1. Refactoring</a></span></dt><dt><span class="section"><a href="#history-1-4-data-dictionary">B.3.2. Data dictionaries</a></span></dt><dt><span class="section"><a href="#history-1-4-mail">B.3.3. Mail adapter</a></span></dt><dt><span class="section"><a href="#history-1-4-endpoint-adapter">B.3.4. Endpoint adapter</a></span></dt><dt><span class="section"><a href="#history-1-4-global-variables">B.3.5. Global variables component</a></span></dt><dt><span class="section"><a href="#history-1-4-json-validator-mode">B.3.6. Json text validator mode</a></span></dt><dt><span class="section"><a href="#history-1-4-http-options">B.3.7. HTTP REST specific Java DSL options</a></span></dt><dt><span class="section"><a href="#history-1-4-soap-http-uri">B.3.8. SOAP HTTP validation</a></span></dt><dt><span class="section"><a href="#history-1-4-camel">B.3.9. Apache Camel integration</a></span></dt><dt><span class="section"><a href="#history-1-4-vertx">B.3.10. Vert.x integration</a></span></dt><dt><span class="section"><a href="#history-1-4-dynamic-endpoints">B.3.11. Dynamic endpoint components</a></span></dt></dl></dd><dt><span class="section"><a href="#history-1-3">B.4. Changes in Citrus 1.3.x</a></span></dt><dd><dl><dt><span class="section"><a href="#history-1-3-1-annotations">B.4.1. @CitrusTest and @CitrusXmlTest annotations</a></span></dt><dt><span class="section"><a href="#history-1-3-1-parameters">B.4.2. @CitrusParameters annotation</a></span></dt><dt><span class="section"><a href="#history-1-3-1-schema-repository-parser">B.4.3. Schema repository configuration components</a></span></dt><dt><span class="section"><a href="#history-1-3-1-change-date-function">B.4.4. Change date function</a></span></dt><dt><span class="section"><a href="#history-1-3-1-weekday-matcher">B.4.5. Weekday validation matcher</a></span></dt><dt><span class="section"><a href="#history-1-3-javadsl">B.4.6. Java DSL</a></span></dt><dt><span class="section"><a href="#history-1-3-xhtml">B.4.7. XHTML message validation</a></span></dt><dt><span class="section"><a href="#history-1-3-soap-fault">B.4.8. Multiple SOAP fault detail support</a></span></dt><dt><span class="section"><a href="#history-1-3-server-security-handler">B.4.9. Jetty server security handler</a></span></dt><dt><span class="section"><a href="#history-1-3-actors">B.4.10. Test actors</a></span></dt><dt><span class="section"><a href="#history-1-3-soap-http-errors">B.4.11. Simulate Http error codes with SOAP</a></span></dt><dt><span class="section"><a href="#history-1-3-ssh">B.4.12. SSH server and client</a></span></dt><dt><span class="section"><a href="#history-1-3-antrun">B.4.13. ANT run test action</a></span></dt><dt><span class="section"><a href="#history-1-3-polling-interval">B.4.14. Polling interval for reply handlers</a></span></dt><dt><span class="section"><a href="#history-1-3-upgrading">B.4.15. Upgrading from version 1.2</a></span></dt></dl></dd><dt><span class="section"><a href="#history-1-2">B.5. Changes in Citrus 1.2</a></span></dt><dd><dl><dt><span class="section"><a href="#history-1-2-spring">B.5.1. Spring version update</a></span></dt><dt><span class="section"><a href="#history-1-2-groovy">B.5.2. New groovy features</a></span></dt><dt><span class="section"><a href="#history-1-2-sql">B.5.3. SQL multi-line result set validation</a></span></dt><dt><span class="section"><a href="#history-1-2-message-types">B.5.4. Extended message format support</a></span></dt><dt><span class="section"><a href="#history-1-2-xml">B.5.5. New XML features</a></span></dt><dt><span class="section"><a href="#history-1-2-soap">B.5.6. SOAP support improvements</a></span></dt><dt><span class="section"><a href="#history-1-2-http">B.5.7. Http and RESTful WebServices</a></span></dt><dt><span class="section"><a href="#history-1-2-html-report">B.5.8. HTML reporting</a></span></dt><dt><span class="section"><a href="#history-1-2-validation">B.5.9. Validation matchers</a></span></dt><dt><span class="section"><a href="#history-1-2-conditional">B.5.10. Conditional container</a></span></dt><dt><span class="section"><a href="#history-1-2-channel-selector">B.5.11. Support for message selectors on message channels</a></span></dt><dt><span class="section"><a href="#history-1-2-actions">B.5.12. New test actions</a></span></dt><dt><span class="section"><a href="#history-1-2-functions">B.5.13. New functions</a></span></dt><dt><span class="section"><a href="#history-1-2-upgrading">B.5.14. Upgrading from version 1.1</a></span></dt></dl></dd></dl></dd></dl></div><div class="preface" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="preface"></a>Preface</h2></div></div></div><p>Integration testing can be very hard, especially when there is no sufficient tool support. Unit testing 
  is flavored with fantastic tools and APIs like JUnit, TestNG, EasyMock, Mockito and so on. These tools support
  you in writing automated tests. A tester who is in charge of integration testing may lack of tool support for
  automated testing especially when it comes to simulate messaging interfaces.</p><p>In a typical enterprise application scenario the test team has to deal with different messaging
  interfaces and various transport protocols. Without sufficient tool support the automated integration testing of message-based 
  interactions between interface partners is exhausting and sometimes barely possible.</p><p>The tester is forced to simulate several interface partners in an end-to-end integration test. The first thing that comes
  to our mind is manual testing. No doubt manual testing is fast. In long term perspective manual testing is time consuming and
  causes severe problems regarding maintainability as they are error prone and not repeatable.</p><p>The Citrus framework gives a complete test automation tool for integration testing of enterprise applications. You can test
  your message interfaces to other applications as client and server. Every time a code change applies all automated Citrus tests
  ensure the stability of interfaces and message communication.</p><p>Regression testing and continuous integration is very easy as Citrus fits into your build lifecylce as usual Java unit test.
  You can use Citrus with JUnit or TestNG in order to integrate with your application build.</p><p>With powerful validation capabilities for various message formats like XML, CSV or JSON Citrus is designed to provide fully
  automated integration tests for end-to-end use cases. Citrus effectively composes complex messaging use cases with response
  generation, error simulation, database interaction and more.</p><p>This documentation provides a reference guide to all features of the Citrus test framework. It gives a detailed picture 
  of effective integration testing with automated integration test environments. Since this document is considered to be under 
  construction, please do not hesitate to give any comments or requests to us using our user or support mailing lists.</p></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="changes-new"></a>Chapter&nbsp;1.&nbsp;What's new in Citrus 2.2?!</h2></div></div></div><p>Citrus 2.2 is a release mostly adding new features as well as improvements to given Citrus features. Bugfixes of course are also part of the package. See the following overview on what has changed.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="new-2-2-arquillian"></a>1.1.&nbsp;Arquillian support</h2></div></div></div><p>Arquillian is a well known integration test framework that comes with a great feature set when it comes to Java EE testing inside of a full qualified application server. With Arquiliian you can deploy your
      Java EE services in a real application server of your choice and execute the tests inside the application server boundaries. This makes it very easy to test your Java EE services in scope with proper JNDI resource
      allocation and other resources provided by the application server. Citrus is able to connect with the Arquillian test case. Speaking in more detail your Arquillian test is able to use a Citrus extension in order
      to use the Citrus feature set inside the Arquillian boundaries. See <a href="#arquillian" title="Chapter&nbsp;24.&nbsp;Arquillian support">Chapter&nbsp;24, <i xmlns:xlink="http://www.w3.org/1999/xlink">Arquillian support</i></a> for details.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="new-2-2-junit-improvements"></a>1.2.&nbsp;JUnit support</h2></div></div></div><p>Citrus supports both major players in unit testing TestNG and JUnit. Unfortunately we did not offer the same feature support for JUnit as it was done for TestNG. Now with Citrus 2.2 we improved the JUnit support
      in Citrus so you are able to use all features with both frameworks. This is especially related to using the <span class="emphasis"><em>@CitrusTest</em></span> and <span class="emphasis"><em>@CitrusXmlTest</em></span> method annotations in test classes.
      See <a href="#run-junit" title="6.2.&nbsp;Run with JUnit">Section&nbsp;6.2, &#8220;Run with JUnit&#8221;</a> how it works.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="new-2-2-startstop-action"></a>1.3.&nbsp;Start/Stop server action</h2></div></div></div><p>Citrus was missing a dedicated test action to start and stop Citrus server components at tet runtime. With the newly added test actions you are able to start and stop server components as you like within your test
      case. See <a href="#actions-manage-server" title="11.19.&nbsp;Start/Stop server instances">Section&nbsp;11.19, &#8220;Start/Stop server instances&#8221;</a> with a detailed description.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="new-2-2-anttasks"></a>1.4.&nbsp;Citrus Ant tasks</h2></div></div></div><p>We discontinue to support the Citrus Ant tasks. The Ant tasks were not very stable an lacked full feature support when executing test cases with JUnit in Apache Ant. Instead we added a brief description on how to
      execute Citrus tests with the well documented and stable default JUnit and TestNG ant tasks. See <a href="#setup-using-ant" title="3.2.&nbsp;Using Ant">Section&nbsp;3.2, &#8220;Using Ant&#8221;</a> how it works.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="new-2-2-bugfixes"></a>1.5.&nbsp;Bugfixes</h2></div></div></div><p>Bugs are part of our software developers world and fixing them is part of your daily business, too. Finding and solving issues
      makes Citrus better every day. For a detailed listing of all bugfixes please refer to the complete changes log of each release in
      JIRA (<a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.citrusframework.org/changes-report.html" target="_top">http://www.citrusframework.org/changes-report.html</a>).</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="introduction"></a>Chapter&nbsp;2.&nbsp;Introduction</h2></div></div></div><p>Nowadays enterprise applications usually communicate with different partners over loosely coupled messaging interfaces.
  The interaction and the interface contract needs to be tested in integration testing.</p><p>In a typical integration test scenario we need to simulate the communication partners over various transports. How can we
  test use case scenarios that include several interface partners interacting with each other? How can somebody ensure that the
  software components work correctly regarding the interface contract? How can somebody run integration test cases in an automated
  reproducible way? Citrus tries to answer these questions!</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="introduction-overview"></a>2.1.&nbsp;Overview</h2></div></div></div><p>Citrus aims to strongly support you in simulating interface partners across different messaging transports. 
    You can easily produce and consume messages with a wide range of protocols like HTTP, JMS, TCP/IP, FTP, SMTP and more.
    The framework is able to both act as a client and server. In each communication step Citrus is able to validate message
    contents towards syntax and semantics.</p><p>In addition to that the Citrus offers a wide range of test actions to take control of the process flow during a test
    (e.g. iterations, system availability checks, database connectivity, parallelism, delaying, error simulation, scripting
    and many more).</p><p>The basic goal in Citrus test cases is to describe a whole use case scenario including several interface partners 
    that exchange many messages with each other. The composition of complex message flows in a single test case with several
    test steps is one of the major features in Citrus.</p><p>The test case description is either done in XML or Java and can be executed multiple times as automated integration test.
    With JUnit and TestNG integration Citrus can easily be integrated into your build lifecycle process. During a test Citrus simulates
    all surrounding interface partners (client or server) without any coding effort. With easy definition of expected message content
    (header and payload) for XML, CSV, SOAP, JSON or plaintext messages Citrus is able to validate the incoming data towards syntax and
    semantics.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="introduction-usage"></a>2.2.&nbsp;Usage scenarios</h2></div></div></div><p>If you are in charge of an enterprise application in a message based solution with message interfaces to other software
    components you should use Citrus. In case your project interacts with other software over different messaging transports and
    in case you need to simulate these interface partners on client or server side you should use Citrus. In case you need to continuously
    check the software stability not only on a unit testing basis but also in an end-to-end integration scenario you should use Citrus.
    Bug fixing, release or regression testing is very easy with Citrus. In case you are struggling with code stability and feel uncomfortable
    regarding your next software release you should definitely use Citrus.</p><p>
      </p><div class="mediaobject" align="center"><img src="images/usage_sample.jpg" align="middle"></div><p>
    </p><p>This test set up is typical for a Citrus use case. In such a test scenario we have a system under test (SUT) with several message
    interfaces to other applications like you would have with an enterprise service bus for instance. A client application invokes services
    on the SUT application. The SUT is linked to several backend applications over various messaging transports (here SOAP, JMS, and Http).
    Interim message notifications and final responses are sent back to the client application. This generates a bunch of messages that are
    exchanged throughout the applications involved.</p><p>In the automated integration test Citrus needs to send and receive those messages over different transports. Citrus takes care of all 
    interface partners (ClientApplication, Backend1, Backend2, Backend3) and simulates their behavior by sending proper response messages in 
    order to keep the message flow alive.</p><p>Each communication step comes with message validation and comparison against an expected message template (e.g. XML or JSON data).
    Besides messaging actions Citrus is also able to perform arbitrary other test actions. Citrus is able to perform a database query
    between requests as an example.</p><p>The Citrus test case runs fully automated as a Java application. In fact a Citrus test case is nothing but a JUnit or TestNG test case.
    Step by step the whole use case scenario is performed like in a real production environment. The Citrus test is repeatable and is included
    into the software build process (e.g. using Maven or ANT) like a normal unit test case would do. This gives you fully automated integration
    tests to ensure interface stability.</p><p>The following reference guide walks through all Citrus capabilities and shows how to set up a great integration test with Citrus.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="setup"></a>Chapter&nbsp;3.&nbsp;Setup</h2></div></div></div><p>This chapter discusses how to get started with Citrus. It deals with the installation and set up of the framework,
  so you are ready to start writing test cases after reading this chapter.</p><p>Usually you would use Citrus as a dependency library in your project. In Maven you would just add Citrus as a test-scoped
  dependency in your POM. When using ANT you can also run Citrus as normal Java application from your build.xml. As Citrus tests
  are nothing but normal unit tests you could also use JUnit or TestNG ant tasks to execute the Citrus test cases.</p><p>This chapter describes the Citrus project setup possibilities, choose one of them that fits best to include Citrus into
  your project.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="setup-using-maven"></a>3.1.&nbsp;Using Maven</h2></div></div></div><p>Citrus uses <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://maven.apache.org/" target="_top">Maven</a> internally as a project build tool and provides extended
    support for Maven projects. Maven will ease up your life as it manages project dependencies and provides extended build life cycles and 
    conventions for compiling, testing, packaging and installing your Java project. Therefore it is recommended to use the Citrus Maven 
    project setup. In case you already use Maven it is most suitable for you to include Citrus as a test-scoped dependency.</p><p>As Maven handles all project dependencies automatically you do not need to download any Citrus project artifacts in 
    advance. If you are new to Maven please refer to the official Maven documentation to find out how to set up a Maven project.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="setup-maven-archetype"></a>3.1.1.&nbsp;Use Citrus Maven archetype</h3></div></div></div><p>If you start from scratch or in case you would like to have Citrus operating in a separate Maven module you can use the Citrus 
        Maven archetype to create a new Maven project. The archetype will setup a basic Citrus project structure with basic settings and files.</p><pre class="programlisting">mvn archetype:generate -DarchetypeCatalog=http://citrusframework.org
        
Choose archetype:
1: http://citrusframework.org -&gt; citrus-archetype (Basic archetype for Citrus integration test project)
Choose a number: 1 

Define value for groupId: com.consol.citrus.samples
Define value for artifactId: citrus-sample
Define value for version: 1.0-SNAPSHOT
Define value for package: com.consol.citrus.samples</pre><p>We load the archetype information from "http://citrusframework.org" and choose the Citrus basic archetype. Now you have 
        to define several values for your project: the groupId, the artifactId, the package and the project version. After that we are done! Maven created a Citrus project structure
        for us which is ready for testing. You should see the following basic project folder structure.</p><pre class="programlisting">citrus-sample
  |   + src
  |   |   + main
  |   |    |   + java
  |   |    |   + resources
  |   |   + citrus
  |   |    |   + java
  |   |    |   + resources
  |   |    |   + tests
  pom.xml</pre><p>The Citrus project is absolutely ready for testing. With Maven we can build, package, install and test our project right away without any adjustments. 
        Try to execute the following commands:</p><pre class="programlisting">mvn integration-test 
mvn integration-test -Dtest=MyFirstCitrusTest </pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you need additional assistance in setting up a Citrus Maven project please visit our Maven setup tutorial
            on <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.citrusframework.org/tutorials.html" target="_top">http://www.citfrusframework.org</a>.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="setup-maven-integration"></a>3.1.2.&nbsp;Add Citrus to existing Maven project</h3></div></div></div><p>In case you already have a proper Maven project you can also integrate Citrus with it. Just add the Citrus project dependencies in your Maven pom.xml 
        as a dependency like follows.</p><div class="itemizedlist"><ul type="disc"><li><p>We add Citrus as test-scoped project dependency to the project POM (pom.xml)</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">dependency</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">groupId</span>&gt;com.consol.citrus&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/groupId</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">artifactId</span>&gt;citrus-core&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/artifactId</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">version</span>&gt;2.2&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/version</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scope</span>&gt;test&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scope</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/dependency</span>&gt;</pre></li><li><p>Add the citrus Maven plugin to your project</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">plugin</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">groupId</span>&gt;com.consol.citrus.mvn&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/groupId</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">artifactId</span>&gt;citrus-maven-plugin&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/artifactId</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">version</span>&gt;2.2&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/version</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">configuration</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">author</span>&gt;Donald Duck&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/author</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">targetPackage</span>&gt;com.consol.citrus&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/targetPackage</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/configuration</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/plugin</span>&gt;</pre></li></ul></div><p>Now that we have added Citrus to our Maven project we can start writing new test cases with the Citrus Maven
        plugin:</p><pre class="programlisting">mvn citrus:create-test</pre><p>Once you have written the Citrus test cases you can execute them automatically in your Maven software build lifecylce. 
        The tests will be included into your projects integration-test phase using the Maven surefire plugin. Here is a sample
        surefire configuration for Citrus.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">plugin</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">artifactId</span>&gt;maven-surefire-plugin&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/artifactId</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">version</span>&gt;2.4.3&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/version</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">configuration</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">skip</span>&gt;true&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/skip</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/configuration</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">executions</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">execution</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">id</span>&gt;citrus-tests&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/id</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">phase</span>&gt;integration-test&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/phase</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">goals</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">goal</span>&gt;test&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/goal</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/goals</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">configuration</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">skip</span>&gt;false&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/skip</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/configuration</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/execution</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/executions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/plugin</span>&gt;</pre><p>The Citrus source directories are defined as test sources like follows:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testSourceDirectory</span>&gt;src/citrus/java&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testSourceDirectory</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testResources</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testResource</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">directory</span>&gt;src/citrus/java&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/directory</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">includes</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">include</span>&gt;**&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/include</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/includes</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">excludes</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">exclude</span>&gt;*.java&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/exclude</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/excludes</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testResource</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testResource</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">directory</span>&gt;src/citrus/tests&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/directory</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">includes</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">include</span>&gt;**/*&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/include</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/includes</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">excludes</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/excludes</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testResource</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testResources</span>&gt;</pre><p>Now everything is set up and you can call the usual Maven <span class="emphasis"><em>install</em></span> goal (mvn clean install) 
        in order to build your project. The Citrus integration tests are executed automatically during the build process. 
        Besides that you can call the Maven integration-test phase explicitly to execute all Citrus tests or a specific test 
        by its name:</p><pre class="programlisting">mvn integration-test 
mvn integration-test -Dtest=MyFirstCitrusTest </pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you need additional assistance in setting up a Citrus Maven project please visit our Maven setup tutorial
            on <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.citrusframework.org/tutorials.html" target="_top">http://www.citfrusframework.org</a>.</p></td></tr></table></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="setup-using-ant"></a>3.2.&nbsp;Using Ant</h2></div></div></div><p>Ant is a very popular way to compile, test, package and execute Java projects. The Apache project has 
    effectively become a standard in building Java projects. You can run Citrus test cases with Ant as Citrus is nothing but a
    Java application. This section describes the steps to setup a proper Citrus Ant project.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="setup-prerequisits"></a>3.2.1.&nbsp;Preconditions</h3></div></div></div><p>Before we start with the Citrus setup be sure to meet the following preconditions. The following software should
      be installed on your computer, in order to use the Citrus framework:</p><div class="itemizedlist"><ul type="disc"><li><p>Java 7 or higher</p><p>Installed JDK plus JAVA_HOME environment variable set up and pointing
              to your Java installation directory</p></li><li><p>Java IDE (optional)</p><p>A Java IDE will help you to manage your Citrus project (e.g. creating 
              and executing test cases). You can use the any Java IDE (e.g. Eclipse or IntelliJ IDEA) but also
              any convenient XML Editor to write new test cases.</p></li><li><p>Ant 1.8 or higher</p><p>Ant (<a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://ant.apache.org/" target="_top">http://ant.apache.org/</a>) will run tests and 
              compile your Citrus code extensions if necessary.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="setup-ant-download"></a>3.2.2.&nbsp;Download</h3></div></div></div><p>First of all we need to download the latest Citrus release archive from the official website 
      <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.citrusframework.org" target="_top">http://www.citrusframework.org</a></p><p>Citrus comes to you as a zipped archive in one of the following packages:</p><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>citrus-x.x-release</em></span></p></li><li><p><span class="emphasis"><em>citrus-x.x-src</em></span></p></li></ul></div><p>The release package includes the Citrus binaries as well as the reference documentation and some sample applications.</p><p>In case you want to get in touch with developing and debugging Citrus you can also go with the source archive 
      which gives you the complete Citrus Java code sources. The whole Citrus project is also accessible for you on 
      <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://github.com/christophd/citrus" target="_top">http://github.com/christophd/citrus</a>. This open git repository 
      on GitHub enables you to build Citrus from scratch with Maven and contribute code changes.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="setup-ant-installation"></a>3.2.3.&nbsp;Installation</h3></div></div></div><p>After downloading the Citrus archives we extract those into an appropriate location on the local 
      storage. We are seeking for the Citrus project artifacts coming as normal Java archives (e.g. citrus-core.jar,
      citrus-ws.jar, etc.)</p><p>You have to include those Citrus Java archives as well as all dependency libraries to your Apache Ant Java classpath. Usually
      you would copy all libraries into your project's lib directory and declare those libraries in the Ant build file. As this approach
      can be very time consuming I recommend to use a dependency management API such as Apache Ivy which gives you automatic dependency
      resolution like that from Maven. In particular this comes in handy with all the 3rd party dependencies that would be resolved
      automatically.</p><p>No matter what approach you are using to set up the Apache Ant classpath see the following sample Ant build script which uses
      the Citrus project artifacts in combination with the TestNG Ant tasks to run the tests.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">project</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus-sample"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">basedir</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"."</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">default</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus.run.tests"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:artifact</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"antlib:org.apache.maven.artifact.ant"</span>&gt;

  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"src/citrus/resources/citrus.properties"</span>/&gt;

  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">path</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"maven-ant-tasks.classpath"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"lib/maven-ant-tasks-2.1.3.jar"</span> /&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">typedef</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">resource</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org/apache/maven/artifact/ant/antlib.xml"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">uri</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"antlib:org.apache.maven.artifact.ant"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">classpathref</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"maven-ant-tasks.classpath"</span> /&gt;

  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">artifact:pom</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus-pom"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"pom.xml"</span> /&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">artifact:dependencies</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">filesetId</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus-dependencies"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">pomRefId</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus-pom"</span> /&gt;

  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">path</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus-classpath"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">pathelement</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"src/citrus/java"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">pathelement</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"src/citrus/resources"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">pathelement</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"src/citrus/tests"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">fileset</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">refid</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus-dependencies"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/path</span>&gt;

  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">taskdef</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">resource</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testngtasks"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">classpath</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"lib/testng-6.8.8.jar"</span>/&gt;

  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">target</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"compile.tests"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">javac</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">srcdir</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"src/citrus/java"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">classpathref</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus-classpath"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">javac</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">srcdir</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"src/citrus/tests"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">classpathref</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus-classpath"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/target</span>&gt;

  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">target</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"create.test"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">description</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Creates a new empty test case"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">input</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Enter test name:"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">addproperty</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"test.name"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">input</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Enter test description:"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">addproperty</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"test.description"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">input</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Enter author's name:"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">addproperty</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"test.author"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">defaultvalue</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${default.test.author}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">input</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Enter package:"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">addproperty</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"test.package"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">defaultvalue</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${default.test.package}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">input</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Enter framework:"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">addproperty</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"test.framework"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">defaultvalue</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testng"</span>/&gt;

    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">java</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">classname</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.util.TestCaseCreator"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">classpath</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">refid</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus-classpath"</span>/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">arg</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">line</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"-name ${test.name} -author ${test.author} -description ${test.description} -package ${test.package} -framework ${test.framework}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/java</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/target</span>&gt;

  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">target</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus.run.tests"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">depends</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"compile.tests"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">description</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Runs all Citrus tests"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testng</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">classpathref</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus-classpath"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">classfileset</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">dir</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"src/citrus/java"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">includes</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"**/*.class"</span> /&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testng</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/target</span>&gt;

  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">target</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus.run.single.test"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">depends</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"compile.tests"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">description</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Runs a single test by name"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">touch</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"test.history"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">loadproperties</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">srcfile</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"test.history"</span>/&gt;

    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Last test executed: ${last.test.executed}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">input</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Enter test name or leave empty for last test executed:"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">addproperty</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testclass"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">defaultvalue</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${last.test.executed}"</span>/&gt;

    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">propertyfile</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"test.history"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">entry</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">key</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"last.test.executed"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"string"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${testclass}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/propertyfile</span>&gt;

    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testng</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">classpathref</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus-classpath"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">classfileset</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">dir</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"src/citrus/java"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">includes</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"**/${testclass}.class"</span> /&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testng</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/target</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/project</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you need detailed assistance for building Citrus with Ant do also visit our tutorials section on 
        <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.citrusframework.org" target="_top">http://www.citrusframework.org</a>. There you can find a 
        tutorial which describes the Citrus Java project set up with Ant from scratch.</p></td></tr></table></div></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="testcase"></a>Chapter&nbsp;4.&nbsp;Test cases</h2></div></div></div><p>Now let us start writing test cases! A test case in Citrus describes all steps for a certain use case in one single file.
  The Citrus test holds a sequence of test actions. Each action represents a very special purpose such as sending or receiving a message.
  Typically with message-based enterprise applications the sending and receiving of messages represent the main actions inside a test.</p><p>However you will learn that Citrus is more than just a simple SOAP client for instance. Each test case can hold complex actions such
  as connecting to the database, transforming data, adding loops and conditional steps. With the default Citrus action set you can accomplish
  very complex use case integration tests. Later in this guide we will briefly discuss all available test actions and learn how to use
  various message transports within the test. For now we will concentrate on the basic test case structure.</p><div class="mediaobject" align="center"><img src="images/figure_004.jpg" align="middle"></div><p>The figure above describes a typical test action sequence in Citrus. A list of sending and receiving test actions composing a typical
  test case here. Each action references a predefined Citrus endpoint component that we are going to talk about later on.</p><p>So how do we define those test cases? In general Citrus specifies test cases as Java classes. With TestNG or JUnit you can execute the
  Citrus tests within your Java runtime as you would do within unit testing. You can code the Citrus test in a single Java class doing assertions
  and using Spring's dependency injection mechanisms.</p><p>If you are not familiar to writing Java code you can also write Citrus tests as XML files. Whatever test language you choose for Citrus
  the whole test case description takes place in one single file (Java or XML). This chapter will introduce the custom XML schema language as
  well as the Java domain specific language so you will be able to write Citrus test cases no matter what knowledge base you belong to.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="testcase-defining"></a>4.1.&nbsp;Writing a test case</h2></div></div></div><p>Put simply, a Citrus test case is nothing but a simple Spring XML configuration file. The Spring framework has become a state of the art 
    development framework for enterprise Java applications. As you work with Citrus you will also learn how to use the Spring Ioc (Inversion of control)
    container and the concepts of dependency injection. So let us have a look at the pure Spring XML configuration syntax first. You are free to write 
    fully compatible test cases for the Citrus framework just using this syntax.</p><p><span class="emphasis"><em>Spring bean definition syntax</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">beans</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xsi</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;
    
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"MyFirstTest"</span> 
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.TestCase"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"variableDefinitions"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">!-- variables of this test go here --</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;     
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"actions"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">!-- actions of this test go here --</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/beans</span>&gt;</pre><p>Citrus can execute these Spring bean definitions as normal test cases - no problem, but the pure Spring XML
    syntax is very verbose and probably not the best way to describe a test case in Citrus. In particular you have to know a lot of Citrus internals 
    such as Java class names and property names. In addition to that as test scenarios get more complex the test cases grow in size. So we need a
    more effective and comfortable way of writing tests. Therefore Citrus provides a custom XML schema definition for writing test cases
    which is much more adequate for our testing purpose.</p><p>The custom XML schema aims to reach the convenience of domain specific languages (DSL). Let us have a look 
    at the Citrus test describing XML language by introducing a first very simple test case definition:</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">spring:beans</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/testcase"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xsi</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:spring</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"
    http://www.springframework.org/schema/beans 
    http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.citrusframework.org/schema/testcase 
    http://www.citrusframework.org/schema/testcase/citrus-testcase.xsd"</span>&gt;
    
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"MyFirstTest"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">description</span>&gt;
            First example showing the basic test case definition elements!
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/description</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"text"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Hello Test Framework"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;${text}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/spring:beans</span>&gt;</pre><p>We do need the <code class="literal">&lt;spring:beans&gt;</code> root element as the XML file is read by the Spring IoC container. 
    Inside this root element the Citrus specific namespace definitions take place.</p><p>The test case itself gets a mandatory name that must be unique throughout all test cases in a project. You will receive errors
    when using duplicate test names. The test name has to follow the common Java naming conventions and rules for Java classes. This means 
    names must not contain any whitespace characters but characters like '-', '.', '_' are supported. For example, <code class="literal">TestFeature_1</code> 
    is valid but <code class="literal">TestFeature 1</code> is not.</p><p>Before we go into more details on the attributes and actions that take place within a test case we just have a look at the Java capabilities.
    Citrus works with Java and uses the well known JUnit and TestNG framework benefits that you may be used to as a tester. Therefore each Citrus test
    comes with a Java class. When you use the XML test syntax mentioned above you may not change the Java class at all. You do not need to write Java code.</p><p>On the other hand many users may prefer to write Java code instead of the verbose XML syntax. Therefore you have another possibility for writing Citrus tests in
    pure Java. Let us have a look at a first Java test example:</p><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting"><span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> org.testng.annotations.Test;
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> com.consol.citrus.annotations.CitrusTest;
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> com.consol.citrus.dsl.TestNGCitrusTestBuilder;

@Test
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">class</span> MyFirstTest <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">extends</span> TestNGCitrusTestBuilder {
    @CitrusTest(name = <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"MyFirstTest"</span>)
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> myFirstTest() {
        description(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"First example showing the basic test case definition elements!"</span>);
    
        variable(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"text"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Hello Test Framework"</span>);
    
        echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"${text}"</span>);
    }
}</pre><p>Citrus provides a base builder Java class that provides all capabilities for you in form of builder pattern methods. Just use the @CitrusTest annotation on top of the test method.
    Citrus will use the method name as the test name by default. As you can see in the example above you can also customize the test name within the @CitrusTest annotation. The test method
    builds all test actions using the test builder pattern. The defined test actions will then be called later on during test runtime.</p><p>This is the basic test Java class pattern used in Citrus. You as a tester with development background can easily extend this pattern for customized logic. Again if you are
    coming without coding experience do not worry this Java code is optional. You can do exactly the same with the XML syntax only.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Please choose whatever code language type you want (Java, XML, Spring bean syntax) in order to write Citrus test cases. Developers may choose Java, testers without coding 
        experience may run best with the XML syntax. We are constantly working on even more test writing language support such as Groovy, Scala, Xtext, and so on. In general you can mix
        the different language types just as you like within your Citrus project which gives you the best of flexibility.</p></td></tr></table></div><p>Now let us continue with the basic test case attributes and properties that you will come across while writing new tests. A typical test case defines these basic attributes
    that we are going to discuss in detail in the next sections.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="testcase-description"></a>4.1.1.&nbsp;Description</h3></div></div></div><p>In the first examples you may have noticed that a tester can give a detailed test description. The test case description clarifies the testing purpose and perspectives. The
        description should give a short introduction to the intended use case scenario that will be tested. The user should get a first impression what the test case is all about as well 
        as special information to understand the test scenario. You can use free text in your test description no limit to the number of characters. But be aware of the XML validation rules 
        of well formed XML when using the XML test syntax (e.g. special character escaping, use of CDATA sections may be required)</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="testcase-variables"></a>4.1.2.&nbsp;Variables</h3></div></div></div><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"text"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Hello Test Framework"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"customerId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"123456789"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">variable("text", "Hello Test Framework");
variable("customerId", "123456789");</pre><p>The concept of test variables is essential when writing complex tests with lots of identifiers and semantical data. Test 
        variables are valid for the whole test case. You can reference them several times using a common variable expression <code class="literal">"${variable-name}"</code>. 
        It is good practice to provide all important entities as test variables. This makes the test easier to maintain and more flexible. 
        All essential entities and identifiers are present right at the beginning of the test, which may also give the opportunity to easily 
        create test variants by simply changing the variable values for other test scenarios.</p><p>The name of the variable is arbitrary. Feel free to specify any name you can think of. Of course you need to be careful with
        special characters and reserved XML entities like '&amp;', '&lt;', '&gt;'. If you are familiar with Java or any other programming 
        language simply think of the naming rules there and you will be fine with working on Citrus variables, too. The value of a variable 
        can be any character sequence. But again be aware of special XML characters like "&lt;" that need to be escaped ("&amp;lt;") when 
        used in variable values.</p><p>The advantage of variables is obvious. Once declared the variables can be referenced many times in
        the test. This makes it very easy to vary different test cases by adjusting the variables for different means (e.g. use different 
        error codes in test cases).</p><p>You can also use a script to create variable values. This is extremely handy when you have very complex variable values.
        Just code a small Groovy script for instance in order to define the variable value. A small sample should give you the idea how that
        works:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"avg"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">script</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"groovy"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">a</span> = <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">4</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">b</span> = <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">6</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">return</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">(a</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">+</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">b)</span> / 2
                ]]&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/script</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variable</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sum"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">script</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"groovy"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">5</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">+</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">5</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">]]&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/script&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/value&gt;</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/variable&gt;</span>
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/variables&gt;</span></pre><p>We use the script code right inside the variable value definition. The value of the variable is the result of the last operation performed 
        within the script. For longer script code the use of <code class="literal">&lt;![CDATA[ ]]&gt;</code> sections is recommended.</p><p>Citrus uses the javax ScriptEngine mechanism in order to evaluate the script code. By default Groovy is supported in any Citrus project. 
        So you can add additional ScriptEngine implementations to your project and support other script types, too.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="testcase-global-variables"></a>4.1.3.&nbsp;Global variables</h3></div></div></div><p>The last section told us to use variables as they are very useful and extend the maintainability of test cases. Now that every 
        test case defines local variables you can also define global variables. The global variables are valid in all tests by default.
        This is a good opportunity to declare constant values for all tests. As these variables are global we need to add those to the
        basic Spring application context file. The following example demonstrates how to add global variables in Citrus:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:global-variables</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"projectName"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Citrus Integration Testing"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"userName"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"TestUser"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:global-variables</span>&gt;</pre><p>We add the Spring bean component to the <span class="emphasis"><em>'citrus-context.xml'</em></span> application context file. The component
        receives a list of name-value variable elements. You can reference the global variables in your test cases as usual.</p><p>Another possibility to set global variables is to load those from external property files. This may give you more powerful
        global variables with user specific properties for instance. See how to load property files as global variables in this example:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:global-variables</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:file</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:global-variable.properties"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:global-variables</span>&gt;</pre><p>We have just added a file path reference to the global variables component. Citrus loads the property file content as global
        test variables. You can mix property file and name-value pair variable definitions in the global variables component.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The global variables can have variable expressions and Citrus functions. It is possible to use previously defined global
          variables as values of new variables, like in this example:</p></td></tr></table></div><pre class="programlisting">user=Citrus
greeting=Hello ${user}!
date=citrus:currentDate('yyyy-MM-dd')</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="testcase-actions"></a>4.1.4.&nbsp;Test Actions</h3></div></div></div><p>Now we get close to the main part of writing an integration test. A Citrus test case defines a sequence of actions that will take 
        place during the test. Actions by default are executed sequentially in the same order as they are defined in the test case definition.</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">action</span>&gt;[...]&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/action</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">action</span>&gt;[...]&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/action</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;</pre><p>All actions have individual names and properties that define the respective behavior. Citrus offers a wide range of test actions from scratch, 
        but you are also able to write your own test actions in Java or Groovy and execute them during a test. <a href="#actions" title="Chapter&nbsp;11.&nbsp;Test actions">Chapter&nbsp;11, <i xmlns:xlink="http://www.w3.org/1999/xlink">Test actions</i></a> gives you a brief 
        description of all available actions that can be part of a test case execution.</p><p>The actions are combined in free sequence to each other so that the tester is able to declare a special action chain inside the test.
        These actions can be sending or receiving messages, delaying the test, validating the database and so on. Step-by-step the test proceeds through 
        the action chain. In case one single action fails by reason the whole test case is red and declared not successful.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="testcase-finally"></a>4.1.5.&nbsp;Finally cleanup section</h3></div></div></div><p>Java developers might be familiar with the concept of doing something in the finally code section. The <code class="literal">finally</code> section 
        contains a list of test actions that will be executed guaranteed at the very  end of the test case even if errors did occur during the execution before. 
        This is the right place to tidy up things that were previously created by the test like cleaning up the database for instance. The <code class="literal">finally</code> 
        section is described in more detail in <a href="#finally" title="Chapter&nbsp;14.&nbsp;Finally section">Chapter&nbsp;14, <i xmlns:xlink="http://www.w3.org/1999/xlink">Finally section</i></a>. However here is the basic syntax inside a test.</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">finally</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;Do finally - regardless of what has happened before&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/finally</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> sampleTest() {
    echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Hello Test Framework"</span>);
    
    doFinally(
        echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Do finally - regardless of any error before"</span>);
    );
}</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="testcase-metainfo"></a>4.2.&nbsp;Meta information</h2></div></div></div><p>The user can provide some additional information about the test case. The meta-info section at the very beginning of the test case 
    holds information like author, status or creation date. In detail the meta information is specified like this:</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"metaInfoTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">meta-info</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">author</span>&gt;Christoph Deppisch&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/author</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">creationdate</span>&gt;2008-01-11&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/creationdate</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">status</span>&gt;FINAL&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/status</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">last-updated-by</span>&gt;Christoph Deppisch&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/last-updated-by</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">last-updated-on</span>&gt;2008-01-11T10:00:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/last-updated-on</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/meta-info</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">description</span>&gt;
        ...
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/description</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        ...
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> sampleTest() {
    description(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"This is a Test"</span>);
    author(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Christoph"</span>);
    status(Status.FINAL);
    
    echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Hello Citrus!"</span>);
}</pre><p>The status allows following values: DRAFT, READY_FOR_REVIEW, DISABLED, FINAL.
    The meta-data information to a test is quite important to give the reader a first information about
    the test. It is also possible to generate test documentation using this meta-data information. The built-in Citrus 
    documentation generates HTML or Excel documents that list all tests with their metadata information and description.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Tests with the status DISABLED will not be executed during a test suite run. So someone can just start adding
        planned test cases that are not finished yet in status DRAFT. In case a test is not runnable yet because it is not finished,
        someone may disable a test temporarily to avoid causing failures during a test run. Using these different statuses one can 
        easily set up test plans and review the progress of test coverage by comparing the number of DRAFT tests to those in the FINAL state.</p></td></tr></table></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="test-actors"></a>Chapter&nbsp;5.&nbsp;Test actors</h2></div></div></div><p>The concept of test actors came to our mind when reusing Citrus test cases in end-to-end test scenarios. Usually 
  Citrus simulates all interface partners within a test case which is great for continuous integration testing. In end-to-end integration test scenarios
  some of our interface partners may be real and alive. Some other interface partners still require Citrus simulation logic.</p><p>It would be great if we could reuse the Citrus integration tests in this test setup as we have the complete test flow of messages available in the Citrus tests. We only have to remove 
  the simulated send/receive actions for those real interface partner applications which are available in our end-to-end test setup.</p><p>With test actors we have the opportunity to link test actions, in particular send/receive message actions, to a test actor. The test actor can be disabled in configuration 
  very easy and following from that all linked send/receive actions are disabled, too. One Citrus test case is runnable with different test setup scenarios where different partner applications 
  on the one hand are available as real life applications and on the other hand my require simulation.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="test-actors-define"></a>5.1.&nbsp;Define test actors</h2></div></div></div><p>First thing to do is to define one or more test actors in Citrus configuration. A test actor represents a participating party (e.g. interface partner, backend application). We write
    the test actors into the central citrus-context.xml. We can use a special Citrus Spring XML schema so definitions are quite easy:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:actor</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"travelagency"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"TRAVEL_AGENCY"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:actor</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"royalairline"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"ROYAL_AIRLINE"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:actor</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"smartariline"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"SMART_AIRLINE"</span>/&gt;</pre><p>The listing above defines three test actors participating in our test scenario. A travel agency application which is simulated by Citrus as a calling client, the smart airline application 
    and a royal airline application. Now we have the test actors defined we can link those to message sender/receiver instances and/or test actions within our test case.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="test-actors-link"></a>5.2.&nbsp;Link test actors</h2></div></div></div><p>We need to link the test actors to message send and receive actions in our test cases. We can do this in two different ways. First we can set a test actor reference on a message sender and message
    receiver.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-jms:sync-endpoint</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"royalAirlineBookingEndpoint"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${royal.airline.request.queue}"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">actor</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"royalairline"</span>/&gt;</pre><p>Now all test actions that are using these message receiver and message sender instances are linked to the test actor. In addition to that you can also explicitly link test actions to 
    test actors in a test.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"royalAirlineBookingEndpoint"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">actor</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"royalairline"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        [...]
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"royalAirlineBookingEndpoint"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">actor</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"royalairline"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        [...]
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;</pre><p>This explicitly links test actors to test actions so you can decide which link should be set without having to rely on the message receiver and sender configuration.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="test-actors-disable"></a>5.3.&nbsp;Disable test actors</h2></div></div></div><p>Usually both airline applications are simulated in our integration tests. But this time we want to change this by introducing a royal airline application which is 
    online as a real application instance. So we need to skip all simulated message interactions for the royal airline application in our Citrus tests. This is easy as we have linked all send/receive 
    actions to one of our test actors. So wen can disable the royal airline test actor in our configuration:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:actor</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"royalairline"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"ROYAL_AIRLINE"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">disabled</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>/&gt;</pre><p>Any test action linked to this test actor is now skipped. As we introduced a real royal airline application in our test scenario the requests get answered and the test should be successful
    within this end-to-end test scenario. The travel agency and the smart airline still get simulated by Citrus. This is a perfect way of reusing integration tests in different test scenarios where 
    you enable and disable simulated participating parties in Citrus.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>Server ports may be of special interest when dealing with different test scenarios. You may have to also disable a Citrus embedded Jetty server instance in order to avoid port binding conflicts
    and you may have to wire endpoint URIs accordingly before executing a test. The real life application may not use the same port and ip as the Citrus embedded servers for simulation.</p></td></tr></table></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="run"></a>Chapter&nbsp;6.&nbsp;Running tests</h2></div></div></div><p>Citrus test cases are nothing but Java classes that get executed within a Java runtime environment. Each Citrus test therefore relates 
    to a Java class representing a JUnit or TestNG unit test. As optional add on a Citrus test can have a XML test declaration file. This is for 
    those of you that do not want to code Java. In this case the XML part holds all actions to tell Citrus what should happen in the test case. 
    The Java part will then just be responsible for test execution and is not likely to be changed at all. In the following sections we concentrate 
    on the Java part and the test execution mechanism.</p><p>If you create new test cases in Citrus - for instance via Maven plugin or ANT build script - Citrus 
    generates both parts in your test directory. For example: if you create a new test named 
    <span class="emphasis"><em>MyFirstCitrusTest</em></span> you will find these two files as a result:</p><p><code class="literal">src/citrus/tests/com/consol/citrus/MyFirstCitrusTest.xml</code></p><p><code class="literal">src/citrus/java/com/consol/citrus/MyFirstCitrusTest.java</code></p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If you prefer to just write Java code you can throw away the XML part immediately and continue working with the Java part only. In case
        you are familiar with writing Java code you may just skip the test template generation via Maven or ANT and preferably just create new Citrus Java 
        test classes on your own.</p></td></tr></table></div><p>With the creation of this test we have already made a very important decision. During creation, Citrus asks 
    you which execution framework should be used for this test. There are basically three options available: 
    <code class="literal">testng</code> and <code class="literal">junit</code>.</p><p>So why is Citrus related to Unit tests although it is intended to be a framework for integration testing? 
    The answer to this question is quite simple: This is because Citrus wants to benefit from both JUnit and TestNG for 
    Java test execution. Both the JUnit and TestNG Java APIs offer various ways of execution and both frameworks are widely supported 
    by other tools (e.g. continuous build, build lifecycle, development IDE).</p><p>Users might already know one of these frameworks and the chances are good that they are familiar with at least one of them. 
    Everything you can do with JUnit and TestNG test cases you can do with Citrus tests also. Include them into your Maven build 
    lifecycle. Execute tests from your IDE (Eclipse, IDEA or NetBeans). Include them into a continuous build tool (e.g. Jenkins).
    Generate test execution reports and test coverage reports with Sonar, Cobertura and so on. The possibilities with JUnit and TestNG are amazing.</p><p>So let us have a closer look at the Citrus TestNG and JUnit integration.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="run-testng"></a>6.1.&nbsp;Run with TestNG</h2></div></div></div><p>TestNG stands for next generation testing and has had a great influence in adding Java annotations to the unit
        test community. Citrus is able to generate TestNG Java classes that are executable as test cases. See the following standard
        template that Citrus will generate when having new test cases:</p><pre class="programlisting"><span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">package</span> com.consol.citrus.samples;

<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> org.testng.annotations.Test;

<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> com.consol.citrus.annotations.CitrusXmlTest;
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> com.consol.citrus.testng.AbstractTestNGCitrusTest;
    
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">/**
 * TODO: Description
 *
 * @author Unknown
 */</span>
@Test
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">class</span> SampleTest <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">extends</span> AbstractTestNGCitrusTest {
    @CitrusXmlTest(name = <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"SampleTest"</span>)
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> sampleTest() {}
}</pre><p>If you are familiar with TestNG you will see that the generated Java class is nothing but a normal TestNG test class.
        We just extend a basic Citrus TestNG class which enables the Citrus test execution features for us. Besides that we have a usual TestNG
        <span class="emphasis"><em>@Test</em></span> annotation placed on our class so all methods inside the class will be executed as separate test case.</p><p>The good news is that we can still use the fantastic TestNG features in our test class. You can think of parallel test execution, test groups,
        setup and tear down operations and so on. Just to give an example we can simply add a test group to our test like this:</p><p><code class="literal">@Test(groups = {"long-running"})</code></p><p>For more information on TestNG please visit the official homepage, where you find a complete reference documentation.</p><p>Now we also use the @CitrusXmlTest annotation in the Java class. This annotation makes Citrus search for a XML file that represents
        the Citrus test within your classpath. Later on we will also discuss another Citrus annotation (<span class="emphasis"><em>@CitrusTest</em></span>) which
        stands for defining the Citrus test just with Java domain specific language features. For now we continue to deal with the XML Citrus test execution.</p><p>The default naming convention requires a XML file with the tests name in the same package that the
        Java class is placed in. In the basic example above this means that Citrus searches for a XML test file in
        <span class="emphasis"><em>com/consol/citrus/samples/SampleTest.xml</em></span>. You tell Citrus to search for another XML file by using the @CitrusXmlTest
        annotation properties. Following annotation properties are valid:</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p>name: List of test case names to execute. Names also define XML file names to look for (<span class="emphasis"><em>.xml</em></span> file extension
            is not needed here).</p></li><li style="list-style-type: circle"><p>packageName: Custom package location for the XML files to load</p></li><li style="list-style-type: circle"><p>packageScan: List of packages that are automatically scanned for XML test files to execute. For each XML file found separate
            test is executed. Note that this performs a Java Classpath package scan so all XML files in package are assumed to be valid Citrus XML
            test cases. In order to minimize the amount of accidentally loaded XML files the scan will only load XML files with
            <span class="emphasis"><em>**/*Test.xml</em></span> file name pattern.</p></li></ul></div><p>You can also mix the various CitrusXmlTest annotation patterns in a single Java class. So we are able to have several test cases in one
        single Java class. Each annotated method represents one or more Citrus XML test cases. Se the following example to see what this is about.</p><pre class="programlisting">@Test
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">class</span> SampleTest <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">extends</span> AbstractTestNGCitrusTest {
    @CitrusXmlTest(name = <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"SampleTest"</span>)
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> sampleTest() {}

    @CitrusXmlTest(name = { <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"SampleTest"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Sample2Test"</span> })
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> multipleTests() {}

    @CitrusXmlTest(name = <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"OtherTest"</span>, packageName = <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"com.other.testpackage"</span>)
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> otherPackageTest() {}

    @CitrusXmlTest(packageScan =  { <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"com.some.testpackage"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"com.other.testpackage"</span> })
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> packageScanTest() {}
}</pre><p>You are free to combine these test annotations as you like in your class. As the whole Java class is annotated with the TestNG
      <span class="emphasis"><em>@Test</em></span> annotation each method gets executed automatically. Citrus will also take care on executing each XML test case as
      a separate unit test. So the test reports will have the exact number of executed tests and the JUnit/TestNG test reports do have the exact test
      outline for further usage (e.g. in continuous build reports).</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>When test execution takes place each test method annotation is evaluated in sequence. XML test cases that match several times, for instance by
        explicit name reference and a package scan will be executed several times respectively.</p></td></tr></table></div><p>The best thing about using the <span class="emphasis"><em>@CitrusXmlTest</em></span> annotation is that you can continue to use the fabulous TestNG
      capabilities (e.g. test groups, invocation count, thread pools, data providers, and so on).</p><p>So now we have seen how to execute a Citrus XML test with TestNG. The same logic also applies to executing Citrus Java DSL test cases. Here is a short
      sample TestNG Java class for this:</p><pre class="programlisting"><span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> org.testng.annotations.Test;
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> com.consol.citrus.annotations.CitrusTest;
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> com.consol.citrus.dsl.TestNGCitrusTestBuilder;

@Test
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">class</span> MyFirstTest <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">extends</span> TestNGCitrusTestBuilder {
    @CitrusTest(name = <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"MyFirstTest"</span>)
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> myFirstTest() {
        description(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"First example showing the basic test case definition elements!"</span>);

        variable(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"text"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Hello Test Framework"</span>);

        echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"${test}"</span>);
    }
}</pre><p>You see the class is quite similar to the XML test variation. Now we extends a Citrus test builder class which enables the Java DSL features in addition to the TestNG
      test execution for us. The basic <span class="emphasis"><em>@Test</em></span> annotation for TestNG has not changed. We still have a usual TestNG class with the possibility of several methods
      each representing a separate unit test.</p><p>Now what has changed is the <span class="emphasis"><em>@CitrusTest</em></span> annotation. Now the Citrus test logic is placed directly as the method body with using the
      Java domain specific language features. The XML Citrus test part is not necessary anymore. If you like to learn more about the Java DSL features continue to read
      this reference guide we will deal the capabilities in more detail later on.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="run-testng-data-providers"></a>6.1.1.&nbsp;Using TestNG DataProviders</h3></div></div></div><p>TestNG as a framework comes with lots of great features such as data providers. Data providers execute a test case several times. Each test execution gets
        a specific parameter value. With Citrus you can use those data provider parameters inside the test as variables. See the next listing
        on how to use TestNG data providers in Citrus:</p><pre class="programlisting"><span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">class</span> DataProviderITest <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">extends</span> AbstractTestNGCitrusTest {

  @CitrusXmlTest
  @CitrusParameters( <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"message"</span> )
  @Test(dataProvider = <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"messageDataProvider"</span>)
  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> DataProviderITest(ITestContext testContext) {
  }

  @DataProvider
  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> Object[][] messageDataProvider() {
  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">return</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">new</span> Object[][] {
      { <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Hello World!"</span> },
      { <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Hallo Welt!"</span> },
      { <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Hi Citrus!"</span> },
    };
  }
}</pre><p>Above test case method is annotated with TestNG data provider called <span class="emphasis"><em>messageDataProvider</em></span>. In the same class you can write the data provider
        that returns a list of parameter values. TestNG will execute the test case several times according to the provided parameter list. Each
        execution is shipped with the respective parameter value. According to the <span class="emphasis"><em>@CitrusParameter</em></span> annotation the test will have a test variable
        called <span class="emphasis"><em>message</em></span> that is accessible as usual.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="run-junit"></a>6.2.&nbsp;Run with JUnit</h2></div></div></div><p>JUnit is a very popular unit test framework for Java applications widely accepted and widely supported by many tools. In general Citrus supports both JUnit and TestNG
        as test execution frameworks. Although the TestNG customization features are slightly more powerful than those offered by JUnit you as a Citrus user should be able to use the framework of
        your choice. The complete support for executing test cases with package scans and multiple annotated methods is given for both frameworks. If you choose <span class="emphasis"><em>junit</em></span> as execution framework
        Citrus generates a Java file that looks like this:</p><pre class="programlisting"><span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">package</span> com.consol.citrus.samples;

<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> org.junit.Test;
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> com.consol.citrus.annotations.CitrusXmlTest;
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> com.consol.citrus.junit.AbstractJUnit4CitrusTest;
  
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">/**
 * TODO: Description
 *
 * @author Unknown
 */</span>
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">class</span> SampleTest <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">extends</span> AbstractJUnit4CitrusTest {
    @Test
    @CitrusXmlTest(name = <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"SampleTest"</span>)
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> sampleTest() {}

    @Test
    @CitrusXmlTest(name = { <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"SampleTest"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Sample2Test"</span> })
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> multipleTests() {}

    @Test
    @CitrusXmlTest(name = <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"OtherTest"</span>, packageName = <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"com.other.testpackage"</span>)
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> otherPackageTest() {}

    @Test
    @CitrusXmlTest(packageScan =  { <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"com.some.testpackage"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"com.other.testpackage"</span> })
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> packageScanTest() {}
}</pre><p>JUnit and TestNG as frameworks reveal slight differences, but the idea is the same. We extend a base JUnit Citrus test class and have one to many test methods that load the XML
        Citrus test cases for execution. As you can see the test class can hold several annotated test methods that get executed as JUnit tests. The fine thing here is that we are still able
        to use all JUnit features such as before/after test actions or enable/disable tests.</p><p>The Java JUnit classes are simply responsible for loading and executing the Citrus test cases. Citrus takes care on loading the XML test as a file system resource and to set up the
        Spring application context. The test is executed and success/failure state is reported exactly like a usual JUnit unit test would do. This also means that you can execute this Citrus JUnit class like every other
        JUnit test, especially out of any Java IDE, with Maven, with ANT and so on. This means that you can easily include the Citrus test execution into
        you software building lifecycle and continuous build.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>So now we know both TestNG and JUnit support in Citrus. Which framework should someone choose?
            To be honest, there is no easy answer to this question. The basic features are equivalent,
            but TestNG offers better possibilities for designing more complex test setup with test groups and 
            tasks before and after a group of tests. This is why TestNG is the default option in Citrus. But in 
            the end you have to decide on your own which framework fits best for your project.</p></td></tr></table></div><p>This is how you execute a Citrus XML test case with JUnit. Of course we also have the possibility to use the Citrus Java DSL
        with JUnit. See the following example on how this looks like:</p><pre class="programlisting"><span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">package</span> com.consol.citrus.samples;

<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> com.consol.citrus.annotations.CitrusTest;
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> com.consol.citrus.dsl.JUnit4CitrusTestBuilder;
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> org.junit.Test;

<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">/**
 * TODO: Description
 *
 * @author Unknown
 */</span>
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">class</span> SampleTest <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">extends</span> JUnit4CitrusTestBuilder {

    @Test
    @CitrusTest
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> EchoSampleTest() {
        variable(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"time"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"citrus:currentDate()"</span>);
        echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Hello Citrus!"</span>);
        echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"CurrentTime is: ${time}"</span>);
    }

    @Test
    @CitrusTest(name = <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"CitrusEchoTest"</span>)
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> echoTest() {
        echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Hello Citrus!"</span>);
    }
}</pre><p>The Java DSL test case looks quite familiar as we also use the JUnit4 <span class="emphasis"><em>@Test</em></span> annotation in order
      to mark our test for unit test execution. In addition to that we add a <span class="emphasis"><em>@CitrusTest</em></span> annotation and extend
      from a basic JUnit4 Citrus test builder which enables the Java domain specific language features. The Citrus test logic goes
      directly to the method block. There is no need for a XML test file anymore.</p><p>As you can see the <span class="emphasis"><em>@CitrusTest</em></span> annotation supports multiple tet methods in one single class. Each test is
      prepared and executed separately just as you know it from JUnit. You can define an explicit Citrus test name that is used in Citrus test
      reports. If no explicit test name is given the test method name will be used as a test name.</p><p>If you need to know more details on how to use the Citrus Java DSL just continue with this reference guide. We will describe
      the capabilities in detail later on.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="messaging"></a>Chapter&nbsp;7.&nbsp;Messaging</h2></div></div></div><p>In one of the previous chapters we have discussed the basic test case structure as we introduced <span class="emphasis"><em>variables</em></span> and
  <span class="emphasis"><em>test actions</em></span>. The &lt;actions&gt; section contains a list of test actions that take place during the test case. 
  Each test action is executed in sequential order by default. Citrus offers several built-in test actions that the user can choose from to construct a complex
  testing workflow without having to code everything from scratch. In particular Citrus aims to provide all the test actions that you need as predefined components 
  ready for you to use. The goal is to minimize the coding effort for you so you can concentrate on the test logic itself. All available test actions are discussed 
  in the next sections.</p><p>As sending and receiving messages is essential in integration testing of message-based architectures we will handle these actions in first place.
  But first of all lets have a look at the common message interface in Citrus:</p><div class="mediaobject" align="center"><img src="images/figure_001.jpg" align="middle"></div><p>A message consists of a message header (name-value pairs) and a message payload. Later in this document we will see how 
  a test constructs several messages with payload and header values. But first of all let's concentrate on sending and receiving 
  messages to/from various transports. Endpoint components play a significant role in this respect. The next figure shows a
  typical message sending endpoint component in Citrus:</p><div class="mediaobject" align="center"><img src="images/figure_002.jpg" align="middle"></div><p>The endpoint producer publishes messages to a destination. This destination can be a JMS queue/topic, a SOAP WebService endpoint, a Http URL, a FTP folder destination
  and many more. The producer just takes a previously defined message definition (header and payload) and sends it to the message destination.</p><p>Similar to that Citrus defines the several endpoint consumer components to consume messages from destinations. This can be a simple subscription
  on message channels and JMS queues/topics. In case of SOAP WebServices and Http GET/POST things are more complicated as we have to provide a 
  server component that clients can connect to. We will handle this Http server related communication later in this document. For now
  a endpoint consumer component in its most simple way is defined like this:</p><div class="mediaobject" align="center"><img src="images/figure_003.jpg" align="middle"></div><p>In the next sections you will learn how a test case uses those endpoint components for producing and consuming messages.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="message-sending"></a>7.1.&nbsp;Sending messages</h2></div></div></div><p>The &lt;send&gt; action publishes messages to a destination. The message transport which is used under the hood does not
    matter to the test case - for now. The test case simply defines the message contents and uses a predefined message sender components to actually 
    publish the constructed message to a destination. There are several message sender implementations in Citrus available representing different transport 
    protocols like JMS, SOAP, HTTP, TCP/IP and many more.</p><p>Again the type of transport to use is not specified inside the test case but in the message sender definition. The separation of concerns (test case/message sender transport) 
    gives us a good flexibility of our test cases. The test case does not know anything about connection factories, queue names or endpoint urls, connection timeouts and so on. The transport 
    internals underneath a sending test action can change easily without affecting the test case definition. We will see later in this document how to create different message senders for 
    various transports in Citrus. For now we concentrate on constructing the message content to be sent.</p><p>We assume that the message's payload will be plain XML format. Citrus uses XML as the default data format for message payload data. But Citrus is not limited to XML message format 
    though; you can always define other message data formats such as JSON, plain text, CSV. As XML is still a very popular message format in enterprise applications and message-based solution
    architectures we have this as a default format. Anyway Citrus works best on XML payloads and you will see a lot of example code in this document using XML. Finally let us have a look at a 
    first example how a sending action is defined in the test.</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"SendMessageTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">description</span>&gt;Basic send message example&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/description</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"text"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Hello Citrus!"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"messageId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Mx1x123456789"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloServiceClient"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">TestMessage</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Body</span>&gt;${text}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Body</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/TestMessage</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Operation"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sayHello"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"MessageId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${messageId}"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>The sample uses both header and payload as message parts to send. In both parts you can use variable definitions
    (see <span class="emphasis"><em>${text}</em></span> and <span class="emphasis"><em>${messageId}</em></span>). So first of all let us recap what variables do.
    Test variables are defined at the very beginning of the test case and are valid throughout all actions that take place in
    the test. This means that actions can simply reference a variable by the expression <code class="literal">${variable-name}</code>.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Use variables wherever you can! At least the important entities of a test should be defined as variables at the 
        beginning. The test case improves maintainability and flexibility when using variables.</p></td></tr></table></div><p>Now lets have a closer look at the sending action. The 'with' attribute might catch your attention first.
    This attribute references a message endpoint in Citrus configuration by name. As previously mentioned the message endpoint
    definition lives in a separate configuration file and contains the actual message transport settings. In this example the
    <span class="emphasis"><em>"helloServiceClient"</em></span> is referenced which is a special client endpoint for sending out messages via
    HTTP for instance.</p><p>The test case is not aware of any transport details, because it does not have to. The advantages are obvious: On the one hand multiple test
    cases can reference the message endpoint definition for better reuse. Secondly test cases are independent of message transport details.
    So connection factories, user credentials, endpoint uri values and so on are not present in the test case.</p><p>In other words the <span class="emphasis"><em>"endpoint"</em></span> attribute of the <span class="emphasis"><em>&lt;send&gt;</em></span> element specifies
    which message endpoint definition to use and therefore where the message should go to. Once again all available message endpoints are
    configured in a separate Citrus configuration file. We will come to this later on. Be sure to always pick the right message endpoint type
    in order to publish your message to the right destination.</p><p>If you do not like the XML language you can also use pure Java code to define the same test. In Java you would also make use of the message endpoint
    definition and reference this instance. The same test as shown above in Java DSL looks like this:</p><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting"><span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> org.testng.ITestContext;
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> org.testng.annotations.Test;
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> com.consol.citrus.annotations.CitrusTest;
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> com.consol.citrus.dsl.TestNGCitrusTestBuilder;

@Test
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">class</span> SendMessageTest <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">extends</span> TestNGCitrusTestBuilder {

    @CitrusTest(name = <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"SendMessageTest"</span>)
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> sendMessageTest() {
        description(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Basic send message example"</span>);
    
        variable(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"text"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Hello Citrus!"</span>);
        variable(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"messageId"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Mx1x123456789"</span>);
    
        send(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"helloServiceClient"</span>)
            .payload(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"&lt;TestMessage&gt;"</span> +
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"&lt;Body&gt;${text}&lt;/Body&gt;"</span> +
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"&lt;/TestMessage&gt;"</span>)
            .header(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Operation"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"sayHello"</span>)
            .header(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"RequestTag"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"${messageId}"</span>);
    }
}</pre><p>Instead of using the XML tags for send we use methods from <span class="emphasis"><em>TestNGCitrusTestBuilder</em></span> class. The same message endpoint
    is referenced within the send message action. The payload is constructed as plain Java character sequence which is a bit verbose. We will see
    later on how we can improve this. For now it is important to understand the combination of send test action and a message endpoints.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>It is good practice to follow naming conventions when defining names for message endpoints. The intended purpose of the message
        endpoint as well as the sending/receiving actor should be clear when choosing the name. For instance messageEndpoint1,
        messageEndpoint2 will not give you much hints to the purpose of the message endpoint.</p></td></tr></table></div><p>Now that the message sender pattern is clear we can concentrate on how to specify the message content to be sent. 
    There are several possibilities for you to define message content in Citrus:</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p><span class="emphasis"><em>message</em></span>: This element constructs the message to be sent. There are several child elements available:</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p><span class="emphasis"><em>payload</em></span>: Nested XML payload as direct child node.</p></li><li style="list-style-type: circle"><p><span class="emphasis"><em>data</em></span>: Inline CDATA definition of the message payload</p></li><li style="list-style-type: circle"><p><span class="emphasis"><em>resource</em></span>: External file resource holding the message payload</p><p>The syntax would be: &lt;resource file="classpath:com/consol/citrus/messages/TestRequest.xml" /&gt;</p><p>The file path prefix indicates the resource type, so the file location is resolved either as file system resource (file:) 
                    or classpath resource (classpath:).</p></li><li style="list-style-type: circle"><p><span class="emphasis"><em>element</em></span>: Explicitly overwrite values in the XML message payload using XPath. You can replace message content 
                    with dynamic values before sending. Each &lt;element&gt; entry provides a "path" and "value" attribute. The "path" 
                    gives a XPath expression evaluating to a XML node element or attribute in the message. The "value" can be a variable expression or any other 
                    static value. Citrus will replace the value before sending the message.</p></li></ul></div></li><li style="list-style-type: circle"><p><span class="emphasis"><em>header</em></span>: Defines a header for the message (e.g. JMS header information or SOAP header):</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p><span class="emphasis"><em>element</em></span>: Each header receives a "name" and "value". The "name" will be the 
                    name of the header entry and "value" its respective value. Again the usage of variable expressions as value is supported here, too.</p></li></ul></div></li></ul></div><p>The most important thing when dealing with sending actions is to prepare the message payload and header. You are able to construct the message payload either by 
    nested XML chil nodes (payload), as inline CDATA (&lt;data&gt;) or external file (&lt;resource&gt;). Before sending takes place you can explicitly overwrite some message
    values explicitly. You can think of overwriting specific message elements with variable values for instance. The example above uses the variable ${text} directly in the
    XML payload definition. In addition to that you can use XPath expressions for overwriting message contents before sending. The two approaches of overwriting message
    elements before sending can coexist simultaneously.</p><p>The message header is part of our duty of defining proper messages, too. So Citrus uses name-value pairs like "Operation" and "MessageId" in the
    example above to set message header entries. Depending on what message endpoint is used and which message transport underneath the header values will be shipped in different ways.
    In JMS the headers go to the header section of the message, in Http we set mime headers accordingly, in SOAP we can access the SOAP header elements and so on. Citrus aims to do
    the hard work for you. So Citrus knows how to set headers on different message transports.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Sometimes the nested XML message payload elements may cause XSD schema validation rule violations. This is because of variable values not fitting the XSD schema rules
      for example. In this scenario you could also use simple CDATA sections as payload data. In this case you need to use the <code class="literal">&lt;data&gt;</code> element in contrast
      to the <code class="literal">&lt;payload&gt;</code> element that we have used in our examples so far.</p><p>With this alternative you can skip the XML schema validation from your IDE at design time. Unfortunately you will loose the XSD auto completion features many XML editors
      offer when constructing your payload. See following example for usage explanation:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sendMessageTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloServiceClient"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;hlo:HelloRequest</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:hlo</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/samples/sayHello.xsd"</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">hlo:Body</span>&gt;Hello Citrus!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/hlo:Body</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/hlo:HelloRequest</span>&gt;
                    ]]&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
            ...
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>This alternative works for receiving message actions, too. We will see this in the next sections.</p></td></tr></table></div><p>This is basically how to send messages in Citrus. The test case is responsible for constructing the message content while the predefined message endpoint holds transport specific
    settings. Test cases reference endpoint components to publish messages to the outside world. The variable support in message payload and message header
    enables you to add dynamic values before sending out the message.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="message-receiving"></a>7.2.&nbsp;Receiving messages</h2></div></div></div><p>Now we have a look at the message receiving part inside the test. A simple example shows how it works.</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloServiceServer"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">TestMessage</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Body</span>&gt;${text}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Body</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/TestMessage</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Operation"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sayHello"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"MessageId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${messageId}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>If we recap the send action of the previous chapter we can identify some common mechanisms that apply for both
    sending and receiving actions. This time the test uses a predefined message server endpoint in order to receive the message.
    Again the test is not aware of the transport details such as JMS connections, endpoint uri, and so on. The message endpoint
    component encapsulates this information.</p><p>Before we go into detail on validating the received message we have a quick look at the Java DSL variation for the
    receive action. The same receive action as above looks like this in Java DSL.</p><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> messagingTest() {
    receive(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"helloServiceServer"</span>)
        .payload(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"&lt;TestMessage&gt;"</span> +
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"&lt;Body&gt;${text}&lt;/Body&gt;"</span> +
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"&lt;/TestMessage&gt;"</span>)
        .header(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Operation"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"sayHello"</span>)
        .header(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"MessageId"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"${messageId}"</span>);
}</pre><p>The receive action waits for a message to arrive. The whole test execution is stopped while waiting for the message. This is
    important to ensure the step by step test workflow processing. Of course you can specify message timeouts so the receiver will only
    wait a given amount of time before raising a timeout error. Following from that timeout exception the test case fails as the message
    did not arrive in time. Citrus defines default timeout settings for all message receiving tasks.</p><p>In a good case scenario the message arrives in time and the content can be validated as a next step. This validation can be done
    in various ways. On the one hand you can specify a whole XML message that you expect as control template. In this case the received message
    structure is compared to the expected message content element by element. On the other hand you can use explicit element validation where only a
    small subset of message elements is included into validation.</p><p>Besides the message payload Citrus will also perform validation on the received message header values. Test variable usage is 
    supported as usual during the whole validation process for payload and header checks.</p><p>In general the validation component (validator) in Citrus works hand in hand with a message receiving component as the following
    figure shows:</p><div class="mediaobject" align="center"><img src="images/figure_005.jpg" align="middle"></div><p>The message receiving component passes the message to the validator where the individual validation steps are performed. Let us have a closer 
    look at the validation options and features step by step.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="message-payload-validation"></a>7.2.1.&nbsp;Validate message content</h3></div></div></div><p>Once Citrus has received a message the tester can validate the message contents in various ways. First of all the tester can compare 
        the whole message payload to a predefined control message template.</p><p>The receiving action offers following elements for control message templates:</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p><span class="emphasis"><em>&lt;payload&gt;</em></span>: Defines the message payload as nested XML message template. The whole message payload is defined
              inside the test case.</p></li><li style="list-style-type: circle"><p><span class="emphasis"><em>&lt;data&gt;</em></span>: Defines an inline XML message template as nested CDATA. Slightly different to the payload variation as
                we define the whole message payload inside the test case as CDATA section.</p></li><li style="list-style-type: circle"><p><span class="emphasis"><em>&lt;resource&gt;</em></span>: Defines an expected XML message template via external file resources. This time the payload is loaded
                at runtime from the external file.</p></li></ul></div><p>Both ways inline payload definition or external file resource give us a control message template that the test case expects to arrive. Citrus uses this
        control template for extended message comparison. All elements, namespaces, attributes and node values are validated in this comparison. When using XML message payloads
        Citrus will navigate through the whole XML structure validating each element and its content. Same with JSON payloads.</p><p>Only in case received message and control message are equal to each other as expected the message validation will pass. In case differences occur Citrus gives
        detailed error messages and the test case fails.</p><p>The control message template is not necessarily very static. Citrus supports various ways to add dynamic message content on the one side and on the other side Citrus can
        ignore some elements that are not part of message comparison (e.g. when generated content or timestamps are part of the message content). The tester can enrich the expected
        message template with test variables or ignore expressions so we get a more robust validation mechanism. We will talk about this in the next sections to come.</p><p>When using the Citrus Java DSL you will face a verbose message payload definition. This is because Java does not support multiline character sequence values as Strings.
        We have to use verbose String concatenation when constructing XML message payload contents for instance. In addition to that reserved characters like quotes must be escaped
        and line breaks must be explicitly added. All these impediments let me suggest to use external file resources in Java DSL when dealing with large complex message payload data.
        Here is an example:</p><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> receiveMessageTest() {
    receive(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"helloServiceServer"</span>)
        .payload(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">new</span> ClassPathResource(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"com/consol/citrus/message/data/TestRequest.xml"</span>))
        .header(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Operation"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"sayHello"</span>)
        .header(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"MessageId"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"${messageId}"</span>);
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="message-dynamic-validation"></a>7.2.2.&nbsp;Dynamic message values</h3></div></div></div><p>Some elements in our message payload might be of dynamic nature. Just think of generated identifiers or timestamps. Also we do not want to repeat the same static identifier several
        times in our test cases. This is the time where test variables and dynamic message element overwrite come in handy. The idea is simple. We want to overwrite a specific message element in our
        payload with a dynamic value. This can be done with XPath or inline variable declarations. Lets have a look at an example listing showing both ways:</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">TestMessage</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">MessageId</span>&gt;${messageId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/MessageId</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">CreatedBy</span>&gt;_&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/CreatedBy</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">VersionId</span>&gt;${version}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/VersionId</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/TestMessage</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"/TestMessage/CreatedBy"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${user}"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;</pre><p>The program listing above shows ways of setting variable values inside a message template. First of all you can
        simply place variable expressions inside the message (see how ${messageId} is used). In addition to that you can also use
        XPath expressions to explicitly overwrite message elements before validation.</p><p><code class="literal">&lt;element path="/TestMessage/CreatedBy" value="${user}"/&gt;</code></p><p>The XPath expression evaluates and searches for the right element in the message payload. The previously defined variable
        <span class="emphasis"><em>${user}</em></span> replaces the element value. Of course this works with XML attributes too.</p><p>Both ways via XPath or inline variable expressions are equal to each other. With respect to the complexity of XML namespaces and XPath you may
        find the inline variable expression more comfortable to use. Anyway feel free to choose the way that fits best for you. This is how we can add dynamic variable
        values to the control template in order to increase maintainability and robustness of message validation.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">Validation matchers put validation mechanisms to a new level offering dynamic assertion statements for validation. Have a look at the possibilities with 
        assertion statements in <a href="#validation-matchers" title="Chapter&nbsp;29.&nbsp;Validation matcher">Chapter&nbsp;29, <i xmlns:xlink="http://www.w3.org/1999/xlink">Validation matcher</i></a></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="message-validation-ignore"></a>7.2.3.&nbsp;Ignore message elements</h3></div></div></div><p>Some elements in the message payload might not apply for validation at all. Just think of communication timestamps an dynamic values inside a 
        message:</p><p>The timestamp value in our next example will dynamically change from test run to test run and is hardly predictable for the tester, so lets ignore it in validation.</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting"> &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">TestMessage</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">MessageId</span>&gt;${messageId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/MessageId</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Timestamp</span>&gt;2001-12-17T09:30:47.0Z&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Timestamp</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">VersionId</span>&gt;@ignore@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/VersionId</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/TestMessage</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ignore</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"/TestMessage/Timestamp"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;</pre><p>Although we have given a static timestamp value in the payload data the element is ignored during validation as the ignore XPath expression matches the element. In addition to that
        we also ignored the version id element in this example. This time with an inline <span class="emphasis"><em>@ignore@</em></span> expression. This is for those of you that do not like XPath. As a result the
        ignored message elements are automatically skipped when Citrus compares and validates message contents and do not break the test case.</p><p>When using the Java DSL the <span class="emphasis"><em>@ignore@</em></span> placeholder as well as XPath expressions can be used seamlessly. Here is an example of that:</p><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> receiveMessageTest() {
    receive(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"helloServiceServer"</span>)
        .payload(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">new</span> ClassPathResource(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"com/consol/citrus/message/data/TestRequest.xml"</span>))
        .header(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Operation"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"sayHello"</span>)
        .header(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"MessageId"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"${messageId}"</span>)
        .ignore(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"/TestMessage/Timestamp"</span>);
}</pre><p>Of course you can use the inline <span class="emphasis"><em>@ignore@</em></span> placeholder in an external file resource, too.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="message-validation-elements"></a>7.2.4.&nbsp;Explicit message element validation</h3></div></div></div><p>In the previous sections we have seen how to validate whole message element structure with control message templates. All elements are validated
        and compared. In some cases this approach might be too extensive. Imagine the tester only needs to validate a small subset of message elements. The definition
        of control templates in combination with several ignore statements is not appropriate in this case. You would rather want
        to use explicit element validation.</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"/TestRequest/MessageId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${messageId}"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"/TestRequest/VersionId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"2"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> receiveMessageTest() {
    receive(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"helloServiceServer"</span>)
        .validate(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"/TestRequest/MessageId"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"${messageId}"</span>)
        .validate(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"//VersionId"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"2"</span>)
        .header(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Operation"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"sayHello"</span>);
}</pre><p>Instead of comparing the whole message some message elements are validated explicitly over XPath. Citrus evaluates the XPath expression on the received message and
        compares the result value to the control value. The basic message structure as well as all other message elements are not included into this explicit validation.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>If this type of element validation is chosen neither &lt;payload&gt; nor &lt;data&gt; nor &lt;resource&gt; template definitions are allowed in Citrus XML test cases.</p></td></tr></table></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Citrus offers an alternative dot-notated syntax in order to walk through XML trees. In case you are not 
            familiar with XPath or simply need a very easy way to find your element inside the XML tree you might use this way. Every 
            element hierarchy in the XML tree is represented with a simple dot - for example:</p><p><code class="literal">TestRequest.VersionId</code></p><p>The expression will search the XML tree for the respective &lt;TestRequest&gt;&lt;VersionId&gt; element. Attributes
            are supported too. In case the last element in the dot-notated expression is a XML attribute the framework will automatically 
            find it.</p><p>Of course this dot-notated syntax is very simple and might not be applicable for more complex tree navigation.
            XPath is much more powerful - no doubt. However the dot-notated syntax might help those of you that are not familiar with XPath.
            So the dot-notation is supported wherever XPath expressions might apply.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="message-header-validation"></a>7.2.5.&nbsp;Validate the message header</h3></div></div></div><p>Now that we have validated the message payload in various ways we are now interested in validating the message header. This is simple as you have to
        define the header name and the control value that you expect. Just add the following header validation to your receiving action.</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Operation"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"GetCustomer"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"RequestTag"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${requestTag}"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> receiveMessageTest() {
    receive(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"helloServiceServer"</span>)
        .header(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Operation"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"sayHello"</span>)
        .header(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"MessageId"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"${messageId}"</span>);
}</pre><p>Message headers are represented as name-value pairs. Each expected header element identified by its name has to be present in the received message. In addition
        to that the header value is compared to the given control value. If a header entry is not found by its name or the value does not fit accordingly Citrus will raise
        validation errors and the test case will fail.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">Sometimes message headers may not apply to the name-value pair pattern. For example SOAP headers can also contain XML fragments. Citrus supports these kind of
        headers too. Please see the SOAP chapter for more details.</td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="message-content-extract"></a>7.2.6.&nbsp;Saving message content to variables</h3></div></div></div><p>Imagine you receive a message in your test with some generated message identifier values. You have no chance to predict the identifier value
        because it was generated at runtime by a foreign application. You can ignore the value in order to protect your validation. But in many cases you might need to return
        this identifier in the respective response message or somewhat later on in the test. So we have to save the dynamic message content for reuse in later test steps.
        The solution is simple and very powerful. We can extract dynamic values from received messages and save those to test variables. Add this code to your message receiving action.</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">extract</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Operation"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">variable</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"operation"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"/TestRequest/VersionId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">variable</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"versionId"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/extract</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> receiveMessageTest() {
    receive(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"helloServiceServer"</span>)
        .extractFromHeader(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Operation"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"operation"</span>)
        .extractFromPayload(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"//TestRequest/VersionId"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"versionId"</span>);
        
    echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Extracted operation from header is: ${operation}"</span>);
    echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Extracted version from payload is: ${versionId}"</span>);
}</pre><p>As you can see Citrus is able to extract both header and message payload content into test variables. It does not matter if you use new test variables
        or existing variables as target. The extraction will automatically create a new variable in case it does not exist. The time the variable was created
        all following test actions can access the test variables as usual. So you can reference the variable values in response messages or other test steps ahead.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="message-selector"></a>7.2.7.&nbsp;Message selectors</h3></div></div></div><p>The <span class="emphasis"><em>&lt;selector&gt;</em></span> element inside the receiving action defines key-value pairs in order to 
        filter the messages being received. The filter applies to the message headers. This means that a receiver will
        only accept messages matching a header element value. In messaging applications the header information often holds message ids,
        correlation ids, operation names and so on. With this information given you can explicitly listen for messages that belong to your test case.
        This is very helpful to avoid receiving messages that are still available on the message destination.</p><p>Lets say the tested software application keeps sending messages that belong to previous test cases. This could happen in retry 
        situations where the application error handling automatically tries to solve a communication problem that occurred
        during previous test cases. As a result a message destination (e.g. a JMS message queue) contains messages that are not valid any more for the currently 
        running test case. The test case might fail because the received message does not apply to the actual use case. So we will definitely run into validation errors
        as the expected message control values do not match.</p><p>Now we have to find a way to avoid these problems. The test could filter the messages on a destination to only receive messages 
        that apply for the use case that is being tested. The Java Messaging System (JMS) came up with a message header selector that will 
        only accept messages that fit the expected header values.</p><p>Let us have a closer look at a message selector inside a receiving action:</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">selector</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span>&gt; name="correlationId" value="Cx1x123456789"&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/element</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span>&gt; name="operation" value="getOrders"&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/element</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/selector</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> receiveMessageTest() {
    receive(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"testServiceEndpoint"</span>)
        .selector(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"correlationId='Cx1x123456789' AND operation='getOrders'"</span>);
}</pre><p>This example shows how message selectors work. The selector will only accept messages that meet the correlation id and the operation
        in the header values. All other messages on the message destination are ignored. The selector elements are automatically associated to 
        each other using the logical AND operator. This means that the message selector string would look like this: <span class="emphasis"><em>correlationId = 'Cx1x123456789' AND operation = 'getOrders'</em></span>.</p><p>Instead of using several elements in the selector you can also define a selector string directly which gives you more power in constructing the selection logic yourself. This way
        you can use <span class="emphasis"><em>AND</em></span> logical operators yourself.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">selector</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;
        correlationId = 'Cx1x123456789' AND operation = 'getOrders'
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/selector</span>&gt;</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>In case you want to run tests in parallel message selectors become essential in your test cases. The different tests running 
            at the same time will steal messages from each other when you lack of message selection mechanisms.</p></td></tr></table></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>Previously only JMS message destinations offered support for message selectors! With Citrus version 1.2 we introduced message selector support for 
            Spring Integration message channels, too (see <a href="#message-channel-selector-support" title="19.3.&nbsp;Message selectors on channels">Section&nbsp;19.3, &#8220;Message selectors on channels&#8221;</a>).</p></td></tr></table></div></div><p>At this point you know the two most important test actions in Citrus. Sending and receiving actions will become the main components of your integration tests when dealing 
    with loosely coupled message based components in a enterprise application environment. It is very easy to create complex message flows, meaning a sequence of sending and receiving actions in your test case.
    You can replicate use cases and test your message exchange with extended message validation capabilities.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-callback"></a>7.3.&nbsp;Validation callback</h2></div></div></div><p>The Java DSL offers some additional validation tricks and possibilities when dealing with messages that are sent and received over Citrus. One of them is the validation
    callback functionality. With this piece you can marshal received message payloads and code validation steps on Java objects.</p><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> receiveMessageTest() {
    receive(bookResponseEndpoint)
      .validationCallback(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">new</span> MarshallingValidationCallback&lt;AddBookResponseMessage&gt;() {
          @Override
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> validate(AddBookResponseMessage response, MessageHeaders headers) {
              Assert.isTrue(response.isSuccess());
          }
      });
}</pre><p>By default the validation callback needs some XML unmarshaller implementation for transforming the XML payload to a Java object. Citrus will automatically search for the unmarshaller bean
    in your Spring application context if nothing specific is set. Of course you can also set the unmarshaller instance explicitly.</p><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@Autowired
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">private</span> Unmarshaller unmarshaller;

@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> receiveMessageTest() {
    receive(bookResponseEndpoint)
        .validationCallback(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">new</span> MarshallingValidationCallback&lt;AddBookResponseMessage&gt;(unmarshaller) {
            @Override
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> validate(AddBookResponseMessage response, MessageHeaders headers) {
                Assert.isTrue(response.isSuccess());
            }
        });
}</pre><p>Obviously working on Java objects is much more comfortable than using the XML String concatenation. This is why you can also use this feature
    when sending messages.</p><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@Autowired
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">private</span> Marshaller marshaller;

@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> sendMessageTest() {
    send(bookRequestEndpoint)
            .payload(createAddBookRequestMessage(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"978-citrus:randomNumber(10)"</span>), marshaller)
            .header(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"citrus_soap_action"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"addBook"</span>);
}

<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">private</span> AddBookRequestMessage createAddBookRequestMessage(String isbn) {
    AddBookRequestMessage requestMessage = <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">new</span> AddBookRequestMessage();
    Book book = <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">new</span> Book();
    book.setAuthor(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Foo"</span>);
    book.setTitle(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"FooTitle"</span>);
    book.setIsbn(isbn);
    book.setYear(2008);
    book.setRegistrationDate(Calendar.getInstance());
    requestMessage.setBook(book);
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">return</span> requestMessage;
}</pre><p>The example above creates a <span class="emphasis"><em>AddBookRequestMessage</em></span> object and puts this as payload to a send action. In combination with a marshaller instance Citrus is
    able to create a proper XML message payload then.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="groovy-utils"></a>7.4.&nbsp;Groovy utils for send and receive</h2></div></div></div><p>Groovy is a great JVM language and offers some nice and easy to use features for working with XML structures. You can use those in Citrus within the send and receive test actions in order
    to construct message payloads via Groovy scripts.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="groovy-markupbuilder"></a>7.4.1.&nbsp;Groovy MarkupBuilder</h3></div></div></div><p>With the Groovy MarkupBuilder you can build XML message payloads in a simple way, without having to write the typical XML overhead.
        For example we use a Groovy script to construct the XML message to be sent out. Instead of a plain CDATA XML section or the nested payload XML data we write a Groovy script snippet. The Groovy MarkupBuilder
        generates the XML message payload with exactly the same result:</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloServiceClient"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">builder</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"groovy"</span>&gt;
            markupBuilder.TestMessage {
                    MessageId('${messageId}')
                    Timestamp('?')
                    VersionId('2')
                    Text('Hello Citrus!')
                }
            }
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/builder</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"/TestMessage/Timestamp"</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${createDate}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Operation"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sayHello"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"MessageId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${messageId}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;</pre><p>We use the <span class="emphasis"><em>builder</em></span> element with type <span class="emphasis"><em>groovy</em></span> and the MarkupBuilder code is directly written to this element. As you can see from the example above, you can mix XPath
        and Groovy markup builder code. The MarkupBuilder syntax is very easy and follows the simple rule: <span class="emphasis"><em>markupBuilder.ROOT-ELEMENT{ CHILD-ELEMENTS }</em></span>. However the tester has to follow some simple rules and
        naming conventions when using the Citrus MarkupBuilder extension:</p><div class="itemizedlist"><ul type="disc"><li>The MarkupBuilder is accessed within the script over an object named <code class="literal">markupBuilder</code>. The name of the custom root element follows with all its child elements.</li><li>Child elements may be defined within curly brackets after the root-element (the same applies for further nested child elements)</li><li>Attributes and element values are defined within round brackets, after the element name</li><li>Attribute and element values have to stand within apostrophes (e.g. attribute-name: 'attribute-value')</li></ul></div><p>The Groovy MarkupBuilder script may also be used within receive actions as shown in the following listing:</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloServiceClient"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">builder</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"groovy"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:com/consol/citrus/groovy/helloRequest.groovy"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloServiceClient"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">timeout</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"5000"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">builder</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"groovy"</span>&gt;
            markupBuilder.TestResponse(xmlns: 'http://www.consol.de/schemas/samples/sayHello.xsd'){
                MessageId('${messageId}')
                CorrelationId('${correlationId}')
                User('HelloService')
                Text('Hello ${user}')
            }
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/builder</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>As you can see it is also possible to define the script as external file resource. In addition to that namespace support is given as normal attribute definition 
        within the round brackets after the element name.</p><p>The MarkupBuilder implementation in Groovy offers great possibilities in defining message payloads. We do not need to write XML tag
        overhead and we can construct complex message payloads with Groovy logic like iterations and conditional elements. For detailed MarkupBuilder descriptions please see the
        official Groovy documentation.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="groovy-xmlslurper"></a>7.4.2.&nbsp;Groovy XmlSlurper</h3></div></div></div><p>With the Groovy XmlSlurper you can easily validate XML message payloads without having to deal directly with XML. People who do not want to deal with XPath may 
        also like this validation alternative. The tester directly navigates through the message elements and uses simple code assertions in order to control the message content. 
        Here is an example how to validate messages with Groovy script:</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloServiceClient"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">timeout</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"5000"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">script</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"groovy"</span>&gt;
              assert root.children().size() == 4
              assert root.MessageId.text() == '${messageId}'
              assert root.CorrelationId.text() == '${correlationId}'
              assert root.User.text() == 'HelloService'
              assert root.Text.text() == 'Hello ' + context.getVariable("user")
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/script</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/validate</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Operation"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sayHello"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"CorrelationId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> receiveMessageTest() {
    receive(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"helloServiceClient"</span>)
        .validateScript(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"assert root.MessageId.text() == '${messageId}';"</span> +
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"assert root.CorrelationId.text() == '${correlationId}';"</span>)
        .header(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Operation, "</span>sayHello")
        .header(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"CorrelationId"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"${correlationId}"</span>)
        .timeout(5000L);
}</pre><p>The Groovy XmlSlurper validation script goes right into the message-tag instead of a XML control template or XPath validation. The Groovy script 
        supports Java <code class="literal">assert</code> statements for message element validation. The element navigation starts with the root element 
        reffered to as <code class="literal">root</code>. Based on this root element you can also access child elements and attributes. Just use the element names seperated 
        by a simple dot. Very easy! If you need the list of child elements use the <code class="literal">children()</code> function on any element. With the 
        <code class="literal">text()</code> function you get access to the element's text-value. The <code class="literal">size()</code> is very useful for validating the number of child 
        elements which completes the basic validation statements.</p><p>As you can see from the example, we may use test variables within the validation script, too. Also not very surprising you may use external file resources
        as validaton scripts. The syntax looks like follows:</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloServiceClient"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">timeout</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"5000"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">script</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"groovy"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:validationScript.groovy"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/validate</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Operation"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sayHello"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"CorrelationId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> receiveMessageTest() {
    receive(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"helloServiceClient"</span>)
        .validateScript(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">new</span> FileSystemResource(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"validationScript.groovy"</span>))
        .header(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Operation, "</span>sayHello")
        .header(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"CorrelationId"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"${correlationId}"</span>)
        .timeout(5000L);
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">You can use the Groovy validation script in combination with other validation types like XML tree comparison and XPath validation.</td></tr></table></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">For further information on the Groovy XmlSlurper please see the official Groovy website and documentation</td></tr></table></div></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="validation"></a>Chapter&nbsp;8.&nbsp;Message validation</h2></div></div></div><p>In the previous sections we have seen the powerful Citrus XML message validation capabilities. The tester is able to define
  expected message behaviour on header and payload level. Later in this documentation we will also deal with XPath and XML schema validation capabilities.
  Now we deal with other message formats than XML.</p><p>Message formats such as JSON have become very poular in the Java enterprise world. More and more interfaces are built with JSON message format. 
  Just think of RESTful WebServices and JavaScript using JSON as the message format to go for. Citrus is able to expect and validate JSON messages and 
  other formats such as Html, CSV or plaintext.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-json"></a>8.1.&nbsp;JSON message validation</h2></div></div></div><p>By default Citrus will use XML message formats when sending and receiving messages. This also reflects to the message validation
    logic Citrus uses for incoming messages.</p><p>However other message formats are supported, too. And it is quite easy to tell Citrus not to use XML but JSON for instance. First of
    all we have introduce a JSON message validator implementation to the citrus-context.xml</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jsonTextMessageValidator"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.validation.json.JsonTextMessageValidator"</span>/&gt;</pre><p>We just add the bean in the citrus-context.xml and Citrus is now aware of JSON message format validation.</p><p>Citrus provides several default message validator implementations for JOSN message format:</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p>com.consol.citrus.validation.json.JsonTextMessageValidator: Basic JSON message validator implementation compares JSON objects (expected and received). 
            The order of JSON entries can differ as specified in JSON protocol. Tester defines an expected control JSON object with test variables and ignored entries. 
            JSONArray as well as nested JSONObjects are supported, too.

            The JSON validator offers two different modes to operate. By default <span class="emphasis"><em>strict</em></span> mode is set and the validator will also check the exact
            amount of control object fields to match. No additional fields in received JSON data structure will be accepted. In <span class="emphasis"><em>soft</em></span> mode validator
            allows additional fields in received JSON data structure so the control JSON object can be a partial subset in which case only the control fields are validated.
            Additional fields in the received JSON data structure are ignored then.</p></li><li style="list-style-type: circle"><p>com.consol.citrus.validation.script.GroovyJsonMessageValidator: Extended groovy message validator provides specific JSON slurper support. With JSON slurper 
            the tester can validate the JSON message payload with closures for instance.</p></li></ul></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>It is very important to set a proper message validator in the citrus-context. If no proper validator is present for a message format
      Citrus might fall back to some other validator implementation (e.g. plaintext) or skip the message validation completely.</p></td></tr></table></div><p>What is now to do? We have to tell the test case receiving action that we expect a message format other than XML.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpMessageEndpoint"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"json"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
          {
            "type" : "read",
            "mbean" : "java.lang:type=Memory",
            "attribute" : "HeapMemoryUsage",
            "path" : "@equalsIgnoreCase('USED')@",
            "value" : "${heapUsage}",
            "timestamp" : "@ignore@"
          }
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>The message receiving action in our test case specifies a message format type <span class="emphasis"><em>type="json"</em></span>. This tells Citrus to look for some message
    validator implementation capable of validating JSON messages. As we have added the proper message validator to the citrus-context.xml Citrus will pick the right validator 
    and JSON message validation is performed on this message. As you can see you we can use the usual test variables and the ignore element syntax here, too. Citrus is able
    to handle different JSON element orders when comparing received and expected JSON object.</p><p>We can also use JSON arrays and nested objects. Citrus is very powerful in comparing JSON objects.</p><p>Lets have a look at the Groovy JSON message validator example. Therefore we have to add a new message validator to the citrus-context.xml</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"groovyJsonMessageValidator"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.validation.script.GroovyJsonMessageValidator"</span>/&gt;</pre><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpMessageEndpoint"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"json"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">validator</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"groovyJsonMessageValidator"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">script</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"groovy"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">assert</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">json.type</span> =<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">=</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">'read'</span>
                  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">assert</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">json.mbean</span> =<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">=</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">'java.lang:type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">Memory'</span>
                  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">assert</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">json.attribute</span> =<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">=</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">'HeapMemoryUsage'</span>
                  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">assert</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">json.value</span> =<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">=</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">'${heapUsage}'</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">]]&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/script&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/validate&gt;</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/message&gt;</span>
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/receive&gt;</span></pre><p>In this example we use the <span class="emphasis"><em>groovyJsonMessageValidator</em></span> explicitly in the receive test action. The message validator implementation was added
    to the citrus-context.xml as a Spring bean before. The Groovy JSON slurper is then automatically passed to the validation script. This way you can access the JSON object
    elements in your code doing some assertions.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>Using several message validator implementations at the same time in the citrus-context.xml is no problem. Citrus automatically searches for all available
      message validators applicable for the given message format and executes these validators in sequence. So several message validators can coexist in a Citrus project.</p></td></tr></table></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>By default Citrus will consolidate all available message validators for a message format in sequence. You can explicitly pick a special message validator in the receive
        message action as shown in the example above. In this case all other validators will not take part in this special message validation. But be careful: When picking a message
        validator explicitly you are of course limited to this message validator's capabilities. Validation features of other validators are not valid in this case (e.g. message
        header validation, XPath validation, etc.)</p></td></tr></table></div><p>So much for receiving JSON message data in Citrus. Of course sending JSON messages in Citrus is also very easy. Just use JSON message payloads in your sending message action.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpMessageEndpoint"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
          {
            "type" : "read",
            "mbean" : "java.lang:type=Memory",
            "attribute" : "HeapMemoryUsage",
            "path" : "used"
          }
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-xhtml"></a>8.2.&nbsp;XHTML message validation</h2></div></div></div><p>When Citrus receives plain Html messages we likely want to use the powerful XML validation capabilities such as XML tree comparison or XPath support.
    Unfortunately Html messages do not ollow the XML well formed rules very strictly. This implies that XML message validation will fail because
    of non well formed Html code.</p><p>XHTML closes this gap by automatically fixing the most common Html XML incompatible rule violations such as missing end tags (e.g. &lt;br&gt;).</p><p>Let's try this with a simple example. Very first thing for us to do is to add a new library dependency to the project. Citrus is using the <span class="emphasis"><em>jtidy</em></span>
    library in order to prepare the HTML and XHTML messages for validation. As this 3rd party dependency is optional in Citrus we have to add it now. Just add
    the <span class="emphasis"><em>jtidy</em></span> dependency to your Maven project POM.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">dependency</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">groupId</span>&gt;net.sf.jtidy&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/groupId</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">artifactId</span>&gt;jtidy&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/artifactId</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">version</span>&gt;r938&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/version</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/dependency</span>&gt;</pre><p>Please refer to the <span class="emphasis"><em>jtidy</em></span> project documentation for the latest versions. Now that we have set up all dependencies we have to add a proper XHTML message
    validator implementation to the Citrus application context.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"xhtmlMessageValidator"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.validation.xhtml.XhtmlMessageValidator"</span>/&gt;</pre><p>Now we can tell the test case receiving action that we want to use the XHTML message validation in our test case.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpMessageEndpoint"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"xhtml"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;!DOCTYPE</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">html</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">PUBLIC</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">"-//W3C//DTD</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">XHTML</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">1.1//EN"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">"org/w3c/xhtml/xhtml1-strict.dtd"&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;html</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/1999/xhtml"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">head</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">title</span>&gt;Citrus Hello World&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/title</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/head</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">body</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">h1</span>&gt;Hello World!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/h1</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">br</span>/&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">p</span>&gt;This is a test!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/p</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/body</span>&gt;
          ]]&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>The message receiving action in our test case has to specify a message format type <span class="emphasis"><em>type="xhtml"</em></span>. 
    As you can see the Html message payload get XHTML specific DOCTYPE processing instruction. The <span class="emphasis"><em>xhtml1-strict.dtd</em></span> 
    is mandatory in the XHTML message validation. For better convenience all XHTML dtd files are packaged within Citrus so you can use
    this as a relative path.</p><p>The incoming Html message is automatically converted into proper XHTML code with well formed XML. So now the XHTML message validator
    can use the XML message validation mechanism of Citrus for comparing received and expected data. As usual you can use test variables, 
    ignore element expressions and XPath expressions.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-plaintext"></a>8.3.&nbsp;Plain text message validation</h2></div></div></div><p>Plain text message validation is the easiest validation in Citrus that you can think of. This validation just performs an exact Java String match
    of received and expected message payloads.</p><p>First thing to do is to add a plain text message validator implementation to the citrus-context.xml</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"plainTextMessageValidator"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.validation.text.PlainTextMessageValidator"</span>/&gt;</pre><p>In the test case receiving action we tell Citrus to use plain text message validation.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpMessageEndpoint"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"plaintext"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;Hello World!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>With the message format type <span class="emphasis"><em>type="plaintext"</em></span> set Citrus performs String equals on the message payloads (received and expected).
    Only exact match will pass the test.</p><p>By the way sending plain text messages in Citrus is also very easy. Just use the plain text message payload data in your sending message action.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpMessageEndpoint"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;Hello World!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;</pre><p>Of course test variables are supported in the plain text payloads. The variables are replace by the referenced values before sending or receiving the message.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="schema-validation"></a>Chapter&nbsp;9.&nbsp;XML schema validation</h2></div></div></div><p>There are several possibilities to describe the structure of XML documents. The two most popular ways are DTD 
    (Document type definition) and XSD (XML Schema definition). Once a XML document has decided to be classified using a schema 
    definition the structure of the document has to fit the predefined rules inside the schema definition. XML document instances 
    are valid only in case they meet all these structure rules defined in the schema definition. Currently Citrus can validate XML
    documents using the schema languages DTD and XSD.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xsd-validation"></a>9.1.&nbsp;XSD schema repositories</h2></div></div></div><p>Citrus tries to validate all incoming XML messages against a schema definition in order to ensure that all rules are fulfilled.
        As a consequence the message receiving actions in Citrus do have to know the XML schema definition (*.xsd) file resources that belong
        to our project. Therefore Citrus introduces a central schema repository component which holds all available XML schema files for a project.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:schema-repository</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"schemaRepository"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:schemas</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:schema</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"travelAgencySchema"</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">location</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:citrus/flightbooking/TravelAgencySchema.xsd"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:schema</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"royalArilineSchema"</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">location</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:citrus/flightbooking/RoyalAirlineSchema.xsd"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:ref</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">schema</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"smartArilineSchema"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:schemas</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:schema-repository</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:schema</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"smartArilineSchema"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">location</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:citrus/flightbooking/SmartAirlineSchema.xsd"</span>/&gt;</pre><p>As you can see the schema repository is a simple XML component defined inside the Spring application context. The repository can hold nested schema definitions
        defined by some identifier and a file location for the xsd schema file. Schema definitions can also be referenced by its identifier for usage in several schema repository
        instances.</p><p>By convention the default schema repository component is defined in the Citrus Spring configuration (citrus-context.xml) with the
        id "schemaRepository". Spring application context is then able to inject the schema repository into all message receiving test actions at runtime.
        The receiving test action consolidates the repository for a matching schema definition file in order to validate the incoming XML document structure.</p><p>The connection between incoming XML messages and xsd schema files in the repository is done by a mapping strategy which we will discuss later in this chapter.
        By default Citrus picks the right schema based on the target namespace that is defined inside the schema definition. The target namespace of the schema definition has to
        match the namespace of the root element in the received XML message. With this mapping strategy you will not have to wire XML messages and schema
        files manually all is done automatically by the Citrus schema repository at runtime. All you need to do is to register all available schema definition files regardless of which
        target namespace or nature inside the Citrus schema repository.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>XMl schema validation is mandatory in Citrus. This means that Citrus always tries to find a matching schema definition inside the schema repository in order to
            perform syntax validation on incoming schema qualified XML messages. A classified XML message is defined by its namespace definitions. Consequently you will get validation errors
            in case no matching schema definition file is found inside the schema repository. So if you explicitly do not want to validate the XML schema for some reason you have to disable
            the validation explicitly in your test with <span class="emphasis"><em>schema-validation="false"</em></span>.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpMessageEndpoint"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">schema-validation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"false"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//ns1:TestMessage/ns1:MessageHeader/ns1:MessageId"</span>
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${messageId}"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//ns1:TestMessage/ns1:MessageHeader/ns1:CorrelationId"</span>
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">namespace</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">prefix</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"ns1"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrus.com/namespace"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Operation"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sayHello"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"MessageId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${messageId}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>This mandatory schema validation might sound annoying to you but in our opinion it is very important to validate the structure of the received
            XML messages, so disabling the schema validation should not be the standard for all tests. Disabling automatic schema validation
            should only apply to very special situations. So please try to put all available schema definitions to the schema repository and you will be fine.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="wsdl-validation"></a>9.2.&nbsp;WSDL schemas</h2></div></div></div><p>In SOAP WebServices world the WSDL (WebService Schema Definition Language) defines the structure an nature of the XML messages exchanged across the interface.
      Often the WSDL files do hold the XML schema definitions as nested elements. In Citrus you can directly set the WSDL file as location of a schema definition like this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:schema</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"arilineWsdl"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">location</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:citrus/flightbooking/AirlineSchema.wsdl"</span>/&gt;</pre><p>Citrus is able to find the nested schema definitions inside the WSDL file in order to build a valid schema file for the schema repository. So incoming XML messages
      that refer to the WSDL file can be validated for syntax rules.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="schema-location-pattern"></a>9.3.&nbsp;Schema location patterns</h2></div></div></div><p>Setting all schemas one by one in a schema repository can be verbose and uncomfortable, especially when dealing with lots of xsd and wsdl files. The schema repository
      also supports location pattern expressions. See this example to see how it works:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:schema-repository</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"schemaRepository"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:locations</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:location</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:citrus/flightbooking/*.xsd"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:locations</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:schema-repository</span>&gt;</pre><p>The schema repository searches for all files matching the resource path location pattern and adds them as schema instances to the repository. Of course this also works with
      WSDL files.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="schema-collections"></a>9.4.&nbsp;Schema collections</h2></div></div></div><p>Sometimes multiple a schema definition is separated into multiple files. This is a problem for the Citrus schema repository as the schema mapping strategy
      then is not able to pick the right file for validation, in particular when working with target namespace values as key for the schema mapping strategy. As a solution for this
      problem you have to put all schemas with the same target namespace value into a schema collection.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:schema-collection</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"flightbookingSchemaCollection"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:schemas</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:schema</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">location</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:citrus/flightbooking/BaseTypes.xsd"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:schema</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">location</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:citrus/flightbooking/AirlineSchema.xsd"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:schemas</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:schema-collection</span>&gt;</pre><p>Both schema definitions <span class="emphasis"><em>BaseTypes.xsd</em></span> and <span class="emphasis"><em>AirlineSchema.xsd</em></span> share the same target namespace and therefore
      need to be combined in schema collection component. The schema collection can be referenced in any schema repository as normal schema definition.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:schema-repository</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"schemaRepository"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:schemas</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:ref</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">schema</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"flightbookingSchemaCollection"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:schemas</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:schema-repository</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="schema-mapping-strategy"></a>9.5.&nbsp;Schema mapping strategy</h2></div></div></div><p>The schema repository in Citrus holds one to many schema definition files and dynamically picks up the right one according to the validated message payload.
        The repository needs to have some strategy for deciding which schema definition to choose. See the following schema mapping strategies and decide which of them is suitable
        for you.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="target-namespace-strategy"></a>9.5.1.&nbsp;Target Namespace Mapping Strategy</h3></div></div></div><p>This is the default schema mapping strategy. Schema definitions usually define some target namespace which is valid for all elements and types inside the schema file.
            The target namespace is also used as root namespace in XML message payloads. According to this information Citrus can pick up the right schema definition file in the schema
            repository. You can set the schema mapping strategy as property in the configuration files:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:schema-repository</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"schemaRepository"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">schema-mapping-strategy</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"schemaMappingStrategy"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:schemas</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:schema</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloSchema"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">location</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:citrus/samples/sayHello.xsd"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:schemas</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:schema-repository</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"schemaMappingStrategy"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.xml.schema.TargetNamespaceSchemaMappingStrategy"</span>/&gt;</pre><p>The <span class="emphasis"><em>sayHello.xsd</em></span> schema file defines a target namespace (http://consol.de/schemas/sayHello.xsd):</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">xs:schema</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xs</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2001/XMLSchema"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://consol.de/schemas/sayHello.xsd"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">targetNamespace</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://consol.de/schemas/sayHello.xsd"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">elementFormDefault</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"qualified"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">attributeFormDefault</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"unqualified"</span>&gt;
     
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/xs:schema</span>&gt;</pre><p>Incoming request messages should also have the target namespace set in the root element and this is how Citrus matches
            the right schema file in the repository.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">HelloRequest</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://consol.de/schemas/sayHello.xsd"</span>&gt;
   &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">MessageId</span>&gt;123456789&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/MessageId</span>&gt;
   &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">CorrelationId</span>&gt;1000&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/CorrelationId</span>&gt;
   &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">User</span>&gt;Christoph&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/User</span>&gt;
   &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Text</span>&gt;Hello Citrus&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Text</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/HelloRequest</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="root-qname-strategy"></a>9.5.2.&nbsp;Root QName Mapping Strategy</h3></div></div></div><p>The next possibility for mapping incoming request messages to a schema definition is via the XML root element QName. Each XML message
            payload starts with a root element that usually declares the type of a XML message. According to this root element you can set up mappings in the schema repository.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:schema-repository</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"schemaRepository"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">schema-mapping-strategy</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"schemaMappingStrategy"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:schemas</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:ref</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">schema</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloSchema"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:ref</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">schema</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"goodbyeSchema"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:schemas</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:schema-repository</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"schemaMappingStrategy"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.xml.schema.RootQNameSchemaMappingStrategy"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"mappings"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">map</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">entry</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">key</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"HelloRequest"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloSchema"</span>/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">entry</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">key</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"GoodbyeRequest"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"goodbyeSchema"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/map</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:schema</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloSchema"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">location</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:citrus/samples/sayHello.xsd"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:schema</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"goodbyeSchema"</span>
     <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">location</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:citrus/samples/sayGoodbye.xsd"</span>/&gt;</pre><p>The listing above defines two root qname mappings - one for <span class="emphasis"><em>HelloRequest</em></span> and one for <span class="emphasis"><em>GoodbyeRequest</em></span> message types.
            An incoming message of type &lt;HelloRequest&gt; is then mapped to the respective schema and so on. With this dedicated mappings you are able to control which schema is used on
            a XML request, regardless of target namespace definitions.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="schema-mapping-chain"></a>9.5.3.&nbsp;Schema mapping strategy chain</h3></div></div></div><p>Let's discuss the possibility to combine several schema mapping strategies in a logical chain. You can define more than one mapping strategy that are
            evaluated in sequence. The first strategy to find a proper schema definition file in the repository wins.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:schema-repository</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"schemaRepository"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">schema-mapping-strategy</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"schemaMappingStrategy"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:schemas</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:ref</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">schema</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloSchema"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:ref</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">schema</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"goodbyeSchema"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:schemas</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:schema-repository</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"schemaMappingStrategy"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.xml.schema.SchemaMappingStrategyChain"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"strategies"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">list</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.xml.schema.RootQNameSchemaMappingStrategy"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"mappings"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">map</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">entry</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">key</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"HelloRequest"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloSchema"</span>/&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/map</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.xml.schema.TargetNamespaceSchemaMappingStrategy"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/list</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>So the schema mapping chain uses both <span class="emphasis"><em>RootQNameSchemaMappingStrategy</em></span> and <span class="emphasis"><em>TargetNamespaceSchemaMappingStrategy</em></span> in combination.
            In case the first root qname strategy fails to find a proper mapping the next target namespace strategy comes in and tries to find a proper schema.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="schema-definition-overrule"></a>9.6.&nbsp;Schema definition overruling</h2></div></div></div><p>Now it is time to talk about schema definition settings on test action level. We have learned before that Citrus tries to automatically find a matching schema definition
        in some schema repository. There comes a time where you as a tester just have to pick the right schema definition by yourself. You can overrule all schema mapping strategies in Citrus
        by directly setting the desired schema in your receiving message action.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpMessageEndpoint"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">schema</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloSchema"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//ns1:TestMessage/ns1:MessageHeader/ns1:MessageId"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${messageId}"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//ns1:TestMessage/ns1:MessageHeader/ns1:CorrelationId"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">namespace</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">prefix</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"ns1"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrus.com/namespace"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:schema</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloSchema"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">location</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:citrus/samples/sayHello.xsd"</span>/&gt;</pre><p>In the example above the tester explicitly sets a schema definition in the receive action (schema="helloSchema"). The attribute value refers to named schema bean 
        somewhere in the applciation context. This overrules all schema mapping strategies used in the central schema repository as the given schema is directly used for validation. This feature 
        is helpful when dealing with different schema versions at the same time where the schema repository can not help you anymore.</p><p>Another possibility would be to set a custom schema repository at this point. This means you can have more than one schema repository in your Citrus project 
        and you pick the right one by yourself in the receive action.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpMessageEndpoint"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">schema-repository</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"mySpecialSchemaRepository"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//ns1:TestMessage/ns1:MessageHeader/ns1:MessageId"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${messageId}"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//ns1:TestMessage/ns1:MessageHeader/ns1:CorrelationId"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">namespace</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">prefix</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"ns1"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrus.com/namespace"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>The <span class="emphasis"><em>schema-repository</em></span> attribute refers to a Citrus schema repository component which is defined somewhere in the Spring application context (e.g. citrus-context.xml).</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>In case you have several schema repositories in your project do always define a default repository (name="schemaRepository"). This helps Citrus to always find at least
            one repository to interact with.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dtd-validation"></a>9.7.&nbsp;DTD validation</h2></div></div></div><p>XML DTD (Document type definition) is another way to validate the structure of a XML document. Many people say that DTD is
        deprecated and XML schema is the much more efficient way to describe the rules of a XML structure. We do not disagree with that, but
        we also know that legacy systems might still use DTD. So in order to avoid validation errors we have to deal with DTD validation
        as well.</p><p>First thing you can do about DTD validation is to specify an inline DTD in your expected message template.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpMessageEndpoint"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">schema-validation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"false"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;!DOCTYPE</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">root</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">[</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;!ELEMENT</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">root</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">(message)&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;!ELEMENT</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">(text)&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;!ELEMENT</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">text</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">(#PCDATA)&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">]&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;root&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;message&gt;</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;text&gt;Hello</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">TestFramework!&lt;/text&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/message&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/root&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">]]&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;data/&gt;</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/message&gt;</span>
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/receive&gt;</span></pre><p>The system under test may also send the message with a inline DTD definition. So validation will succeed.</p><p>In most cases the DTD is referenced as external .dtd file resource. You can do this in your expected message 
        template as well.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpMessageEndpoint"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">schema-validation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"false"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;!DOCTYPE</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">root</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">SYSTEM</span> 
                         <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">"com/consol/citrus/validation/example.dtd"&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;root&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;message&gt;</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;text&gt;Hello</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">TestFramework!&lt;/text&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/message&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/root&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">]]&gt;</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;data/&gt;</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/message&gt;</span>
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/receive&gt;</span></pre></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="xpath"></a>Chapter&nbsp;10.&nbsp;Using XPath</h2></div></div></div><p>Some time ago in this document we have seen how XML elements are manipulated using XPath expressions 
    when sending and receiving messages. Now using XPath might raise some problems regarding namespaces that we
    want to deal with now.</p><p>XPath is a very powerful technology for walking XML trees. This W3C standard stands for advanced
    XML tree handling using a special syntax as query language. The test framework supports this XPath
    syntax in the following fields:</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p>&lt;message&gt;&lt;element path="[XPath-Expression]"&gt;&lt;/message&gt;</p></li><li style="list-style-type: circle"><p>&lt;extract&gt;&lt;message path="[XPath-Expression]"&gt;&lt;/extract&gt;</p></li><li style="list-style-type: circle"><p>&lt;ignore path="[XPath-Expression]"/&gt;</p></li><li style="list-style-type: circle"><p>&lt;validate path="[XPath-Expression]"/&gt;</p></li></ul></div><p>The next program listing indicates the power in using XPath with Citrus:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//User/Name"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"John"</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/validate</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//User/Address[@type='office']/Street"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Companystreet 21"</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/validate</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span> =<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//User/Name"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${userName}"</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/validate</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span> =<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//User/@isAdmin"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${isAdmin}"</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/validate</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span> =<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//*[.='search-for']"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"searched-for"</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/validate</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;</pre><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xpath-namespace"></a>10.1.&nbsp;Handling XML namespaces</h2></div></div></div><p>When it comes to XML namespaces you have to be careful with your XPath expressions. Lets have a look at an example
        message that uses XML namespaces:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns1:TestMessage</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:ns1</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrus.com/namespace"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns1:TestHeader</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns1:CorrelationId</span>&gt;_&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns1:CorrelationId</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns1:Timestamp</span>&gt;2001-12-17T09:30:47.0Z&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns1:Timestamp</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns1:VersionId</span>&gt;2&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns1:VersionId</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns1:TestHeader</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns1:TestBody</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns1:Customer</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns1:Id</span>&gt;1&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns1:Id</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns1:Customer</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns1:TestBody</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns1:TestMessage</span>&gt;</pre><p>Now we would like to validate some elements in this message using XPath</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//TestMessage/TestHeader/VersionId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"2"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//TestMessage/TestHeader/CorrelationId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;</pre><p>The validation will fail although the XPath expression looks correct regarding the XML tree. Because the message 
        uses the namespace <code class="literal">xmlns:ns1="http://citrus.com/namespace"</code> with its prefix <code class="literal">ns1</code>
        our XPath expression is not able to find the elements. The correct XPath expression uses the namespace prefix as defined 
        in the message.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//ns1:TestMessage/ns1:TestHeader/ns1:VersionId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"2"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//ns1:TestMessage/ns1:TestHeader/ns1:CorrelationId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;</pre><p>Now the expressions work fine and the validation is successful. But this is quite error prone. This is because the test is now 
        depending on the namespace prefix that is used by some application. As soon as the message is sent with a different namespace prefix (e.g.
        ns2) the validation will fail again.</p><p>You can avoid this effect when specifying your own namespace context and your own namespace prefix during validation.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//pfx:TestMessage/pfx:TestHeader/pfx:VersionId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"2"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//pfx:TestMessage/pfx:TestHeader/pfx:CorrelationId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">namespace</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">prefix</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"pfx"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrus.com/namespace"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;</pre><p>Now the test in independent from any namespace prefix in the received message. The namespace context will resolve the namespaces and
        find the elements although the message might use different prefixes. The only thing that matters is that the namespace value 
        (http://citrus.com/namespace) matches.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Instead of this namespace context on validation level you can also have a global namespace context which is valid in all test cases.
            We just add a bean in the basic citrus-context configuration which defines global namespace mappings.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">namespace-context</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">namespace</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">prefix</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"def"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">uri</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/samples/sayHello"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/namespace-context</span>&gt;</pre><p>Once defined the <span class="emphasis"><em>def</em></span> namespace prefix is valid in all test cases and all XPath expressions. This enables you to free
            your test cases from namespace prefix bindings that might be broken with time. You can use these global namespace mappings wherever XPath 
            expressions are valid inside a test case (validation, ignore, extract).</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xpath-default-namespaces"></a>10.2.&nbsp;Handling default namespaces</h2></div></div></div><p>In the previous section we have seen that XML namespaces can get tricky with XPath validation. Default namespaces can do 
        even more! So lets look at the example with default namespaces:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">TestMessage</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrus.com/namespace"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">TestHeader</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">CorrelationId</span>&gt;_&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/CorrelationId</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Timestamp</span>&gt;2001-12-17T09:30:47.0Z&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Timestamp</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">VersionId</span>&gt;2&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/VersionId</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/TestHeader</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">TestBody</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Customer</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Id</span>&gt;1&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Id</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Customer</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/TestBody</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/TestMessage</span>&gt;</pre><p>The message uses default namespaces. The following approach in XPath will fail due to namespace problems.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//TestMessage/TestHeader/VersionId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"2"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//TestMessage/TestHeader/CorrelationId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;</pre><p>Even default namespaces need to be specified in the XPath expressions. Look at the following code listing that
        works fine with default namespaces:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//:TestMessage/:TestHeader/:VersionId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"2"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//:TestMessage/:TestHeader/:CorrelationId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>It is recommended to use the namespace context as described in the previous chapter when validating. Only this approach
            ensures flexibility and stable test cases regarding namespace changes.</p></td></tr></table></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="actions"></a>Chapter&nbsp;11.&nbsp;Test actions</h2></div></div></div><p>This chapter gives a brief description to all test actions that a tester can incorporate into the test case. 
  Besides sending and receiving messages the tester may access these actions in order to build a more complex test scenario
  that fits the desired use case.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-database"></a>11.1.&nbsp;Connecting to the database</h2></div></div></div><p>In many cases it is necessary to access the database during a test. This enables a tester to also validate 
    the persistent data in a database. It might also be helpful to prepare the database with some test data before running a test. 
    You can do this using the two database actions that are described in the following sections.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="actions-database-update"></a>11.1.1.&nbsp;Updating the database</h3></div></div></div><p>The &lt;sql&gt; action simply executes a group of SQL statements in order to change data in a database.
      Typically the action is used to prepare the database at the beginning of a test or to clean up the
      database at the end of a test. You can specify SQL statements like INSERT, UPDATE,
      DELETE, CREATE TABLE, ALTER TABLE and many more.</p><p>On the one hand you can specify the statements as inline SQL or stored in an external
      SQL resource file as shown in the next two examples.</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sql</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">datasource</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"someDataSource"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">statement</span>&gt;DELETE FROM CUSTOMERS&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/statement</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">statement</span>&gt;DELETE FROM ORDERS&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/statement</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/sql</span>&gt;
    
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sql</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">datasource</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myDataSource"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">resource</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"file:tests/unit/resources/script.sql"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/sql</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@Autowired
@Qualifier(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"myDataSource"</span>)
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">private</span> DataSource dataSource;

@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> sqlTest() {
    sql(dataSource)
            .statement(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"DELETE FROM CUSTOMERS"</span>)
            .statement(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"DELETE FROM ORDERS"</span>);
            
    sql(dataSource)
            .sqlResource(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"file:tests/unit/resources/script.sql"</span>);
}</pre><p>The first action uses inline SQL statements defined directly inside the test case. The next action uses an external 
      SQL resource file instead. The file resource can hold several SQL statements separated by new lines. All statements inside 
      the file are executed sequentially by the framework.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>You have to pay attention to some rules when dealing with external SQL resources.</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p>Each statement should begin in a new line</p></li><li style="list-style-type: circle"><p>It is not allowed to define statements with word wrapping</p></li><li style="list-style-type: circle"><p>Comments begin with two dashes "--"</p></li></ul></div></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The external file is referenced either as file system resource or class path resource,
        by using the "file:" or "classpath:" prefix.</p></td></tr></table></div><p>Both examples use the "datasource" attribute. This value defines the database data source to be used. The connection to
      a data source is mandatory, because the test case does not know about user credentials or database names. The 'datasource' attribute 
      references predefined data sources that are located in a separate Spring configuration file.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="actions-database-query"></a>11.1.2.&nbsp;Verifying data from the database</h3></div></div></div><p>The &lt;sql&gt; query action is specially designed to execute SQL queries (SELECT * FROM). So the test is able to read data from a database. 
      The query results are validated against expected data as shown in the next example.</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sql</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">datasource</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testDataSource"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">statement</span>&gt;select NAME from CUSTOMERS where ID='${customerId}'&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/statement</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">statement</span>&gt;select count(*) from ERRORS&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/statement</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">statement</span>&gt;select ID from ORDERS where DESC LIKE 'Def%'&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/statement</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">statement</span>&gt;select DESCRIPTION from ORDERS where ID='${id}'&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/statement</span>&gt;
    
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">column</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"ID"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"1"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">column</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"NAME"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Christoph"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">column</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"COUNT(*)"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${rowsCount}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">column</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"DESCRIPTION"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"null"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/sql</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@Autowired
@Qualifier(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"testDataSource"</span>)
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">private</span> DataSource dataSource;

@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> databaseQueryTest() {
    query(dataSource)
            .statement(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"select NAME from CUSTOMERS where CUSTOMER_ID='${customerId}'"</span>)
            .statement(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"select COUNT(1) as overall_cnt from ERRORS"</span>)
            .statement(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"select ORDER_ID from ORDERS where DESCRIPTION LIKE 'Migrate%'"</span>)
            .statement(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"select DESCRIPTION from ORDERS where ORDER_ID = 2"</span>)
            .validate(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"ORDER_ID"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"1"</span>)
            .validate(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"NAME"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Christoph"</span>)
            .validate(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"OVERALL_CNT"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"${rowsCount}"</span>)
            .validate(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"DESCRIPTION"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"NULL"</span>);
}</pre><p>The action offers a wide range of validating functionality for database result sets. First
      of all you have to select the data via SQL statements. Here again you have the choice to use inline SQL
      statements or external file resource pattern.</p><p>The result sets are validated through &lt;validate&gt; elements. It is possible to do a detailed check on
      every selected column of the result set. Simply refer to the selected column name in order to validate its
      value. The usage of test variables is supported as well as database expressions like count(), avg(), min(),
      max().</p><p>You simply define the &lt;validate&gt; entry with the column name as the "column" attribute and any expected
      value expression as expected "value". The framework then will check the column to fit the expected value and raise 
      validation errors in case of mismatch.</p><p>Looking at the first SELECT statement in the example you will see that test variables are supported in the 
      SQL statements. The framework will replace the variable with its respective value before sending it to the database.</p><p>In the validation section variables can be used too. Look at the third validation entry, where the variable
      "${rowsCount}" is used. The last validation in this example shows, that <code class="literal">NULL</code> values are 
      also supported as expected values.</p><p>If a single validation happens to fail, the whole action will fail with respective validation errors.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>The validation with <code class="literal">"&lt;validate column="..." value="..."/&gt;"</code> 
        meets single row result sets as you specify a single column control value. In case you have multiple rows in a result 
        set you rather need to validate the columns with multiple control values like this:</p><pre class="programlisting">
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">column</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"someColumnName"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">values</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;Value in 1st row&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;Value in 2nd row&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;Value in 3rd row&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;Value in x row&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/values</span>&gt;               
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/validate</span>&gt;
        </pre><p>Within Java you can pass a variable argument list to the validate method like this:</p><pre class="programlisting">query(dataSource)
    .statement(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"select NAME from WEEKDAYS where NAME LIKE 'S%'"</span>)
    .validate(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"NAME"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Saturday"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Sunday"</span>)</pre></td></tr></table></div><p>Next example shows how to work with multiple row result sets and multiple values to expect within one column:</p><pre class="programlisting">
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sql</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">datasource</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testDataSource"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">statement</span>&gt;select WEEKDAY as DAY, DESCRIPTION from WEEK&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/statement</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">column</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"DAY"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">values</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;Monday&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;Tuesday&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;Wednesday&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;Thursday&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;Friday&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;@ignore@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;@ignore@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/values</span>&gt;            	
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/validate</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">column</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"DESCRIPTION"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">values</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;I hate Mondays!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;Tuesday is sports day&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;The mid of the week&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;Thursday we play chess&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;Friday, the weekend is near!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;@ignore@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;@ignore@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/values</span>&gt;            	
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/validate</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/sql</span>&gt;
      </pre><p>For the validation of multiple rows the <code class="literal">&lt;validate&gt;</code> element is able to host a list of control values for a column. 
      As you can see from the example above, you have to add a control value for each row in the result set. This also means that we have to take care 
      of the total number of rows. Fortunately we can use the ignore placeholder, in order to skip the validation of a specific row in the result set. 
      Functions and variables are supported as usual.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>It is important, that the control values are defined in the correct order, because they are compared one on one with the actual 
        result set coming from database query. You may need to add "order by" SQL expressions to get the right order of rows returned. If any of the values 
        fails in validation or the total number of rows is not equal, the whole action will fail with respective validation errors.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="actions-database-groovy"></a>11.1.3.&nbsp;Groovy SQL result set validation</h3></div></div></div><p>Groovy provides great support for accessing Java list objects and maps. As a Java SQL result set is nothing but a list of
      map representations, where each entry in the list defines a row in the result set and each map entry represents the columns and values. So
      with Groovy's list and map access we have great possibilities to validate a SQL result set - out of the box.</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sql</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">datasource</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testDataSource"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">statement</span>&gt;select ID from CUSTOMERS where NAME='${customerName}'&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/statement</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">statement</span>&gt;select ORDERTYPE, STATUS from ORDERS where ID='${orderId}'&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/statement</span>&gt;
    
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate-script</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"groovy"</span>&gt;
        assert rows.size() == 2
        assert rows[0].ID == '1'
        assert rows[1].STATUS == 'in progress'
        assert rows[1] == [ORDERTYPE:'SampleOrder', STATUS:'in progress']               
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/validate-script</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/sql</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">query(dataSource)
    .statement(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"select ORDERTYPE, STATUS from ORDERS where ID='${orderId}'"</span>)
    .validateScript(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"assert rows.size == 2;"</span> +
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"assert rows[0].ID == '1';"</span> +
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"assert rows[0].STATUS == 'in progress';"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"groovy"</span>);</pre><p>As you can see Groovy provides fantastic access methods to the SQL result set. We can browse the result set with named column values and check the size 
      of the result set. We are also able to search for an entry, iterate over the result set and have other helpful operations. For a detailed description of the list and map 
      handling in Groovy my advice for you is to have a look at the official Groovy documentation.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>In general other script languages do also support this kind of list and map access. For now we just have implemented the Groovy script support,
      but the framework is ready to work with all other great script languages out there, too (e.g. Scala, Clojure, Fantom, etc.). So if you prefer to work with another language
      join and help us implement those features.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="actions-database-read-values"></a>11.1.4.&nbsp;Read data from database</h3></div></div></div><p>Now the validation of database entries is a very powerful feature but sometimes we simply do not know the
      persisted content values. The test may want to read database entries into test variables without validation. Citrus
      is able to do that with the following &lt;extract&gt; expressions:</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sql</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">datasource</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testDataSource"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">statement</span>&gt;select ID from CUSTOMERS where NAME='${customerName}'&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/statement</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">statement</span>&gt;select STATUS from ORDERS where ID='${orderId}'&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/statement</span>&gt;
    
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">extract</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">column</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"ID"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">variable</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${customerId}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">extract</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">column</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"STATUS"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">variable</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${orderStatus}"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/sql</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">query(dataSource)
    .statement(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"select STATUS from ORDERS where ID='${orderId}'"</span>)
    .extract(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"STATUS"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"orderStatus"</span>);</pre><p>We can save the database column values directly to test variables. Of course you can combine the value extraction 
      with the normal column validation described earlier in this chapter. Please keep in mind that we can not use these operations
      on result sets with multiple rows. Citrus will always use the first row in a result set.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-sleep"></a>11.2.&nbsp;Sleep</h2></div></div></div><p>This action shows how to make the test framework sleep for a given amount of time. The attribute 'time' defines 
    the amount of time to wait in seconds. As shown in the next example decimal values are supported too. When no waiting time is
    specified the default time of 50000 milliseconds applies.</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sleepTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sleep</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">seconds</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"3.5"</span>/&gt;

        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sleep</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">milliseconds</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"500"</span>/&gt;

        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sleep</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> sleepTest() {
    sleep(3.5); <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">// sleep 3.5 seconds</span>

    sleep(500); <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">// sleep 500 milliseconds</span>

    sleep(); <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">// sleep default time</span>
}</pre><p>When should somebody use this action? To us this action was always very useful in case the test needed to wait until 
    an application had done some work. For example in some cases the application took some time to write some data into the database.
    We waited then a small amount of time in order to avoid unnecessary test failures, because the test framework simply validated 
    the database too early. Or as another example the test may wait a given time until retry mechanisms are triggered in the tested
    application and then proceed with the test actions.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-java"></a>11.3.&nbsp;Java</h2></div></div></div><p>The test framework is written in Java and runs inside a Java virtual machine. The functionality of calling other 
    Java objects and methods in this same Java VM through Java Reflection is self-evident. 
    With this action you can call any Java API available at runtime through the specified Java classpath.</p><p>The action syntax looks like follows:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">java</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.test.util.InvocationDummy"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">argument</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">""</span>&gt;Test Invocation&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/argument</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/constructor</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">method</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"invoke"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">argument</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"String[]"</span>&gt;1,2&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/argument</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/method</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/java</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">java</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.test.util.InvocationDummy"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">argument</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">""</span>&gt;Test Invocation&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/argument</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/constructor</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">method</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"invoke"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">argument</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"int"</span>&gt;4&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/argument</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">argument</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"String"</span>&gt;Test Invocation&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/argument</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">argument</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"boolean"</span>&gt;true&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/argument</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/method</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/java</span>&gt;
    
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">java</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.test.util.InvocationDummy"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">method</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"main"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">argument</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"String[]"</span>&gt;4,Test,true &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/argument</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/method</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/java</span>&gt;</pre><p>The Java class is specified by fully qualified class name. Constructor arguments are added using the &lt;constructor&gt; 
    element with a list of &lt;argument&gt; child elements. The type of the argument is defined within the respective 
    attribute "type". By default the type would be String.</p><p>The invoked method on the Java object is simply referenced by its name. Method arguments do not bring anything new 
    after knowing the constructor argument definition, do they?.</p><p>Method arguments support data type conversion too, even string arrays (useful when
    calling CLIs). In the third action in the example code you can see that colon separated strings are automatically 
    converted to string arrays.</p><p>Simple data types are defined by their name (int, boolean, float etc.). Be sure that the invoked method
    and class constructor fit your arguments and vice versa, otherwise you will cause errors at runtime.</p><p>Besides instantiating a fully new object instance for a class how about reusing a bean instance available in Spring bean container. Simply
    use the <span class="emphasis"><em>ref</em></span> attribute and refer to an existing bean in Spring application context.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">java</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">ref</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"invocationDummy"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">method</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"invoke"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">argument</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"int"</span>&gt;4&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/argument</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">argument</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"String"</span>&gt;Test Invocation&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/argument</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">argument</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"boolean"</span>&gt;true&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/argument</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/method</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/java</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"invocationDummy"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.test.util.InvocationDummy"</span>/&gt;
    </pre><p>The method is invoked on the Spring bean instance. This is very useful as you can inject other objects (e.g. via Autowiring) to the Spring bean 
    instance before method invocation in test takes place. This enables you to execute any Java logic inside a test case.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-timeout"></a>11.4.&nbsp;Expect timeouts on a destination</h2></div></div></div><p>In some cases it might be necessary to validate that a message is <span class="emphasis"><em>not</em></span> present on a destination. 
    This means that this action expects a timeout when receiving a message from an endpoint destination. For instance the tester 
    intends to ensure that no message is sent to a certain destination in a time period. In that case the timeout would 
    not be a test aborting error but the expected behavior. And in contrast to the normal behavior when a message is received 
    in the time period the test will fail with error.</p><p>In order to validate such a timeout situation the action &lt;expectTimout&gt; shall help. The usage
    is very simple as the following example shows:</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"receiveJMSTimeoutTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">expect-timeout</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myEndpoint"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">wait</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"500"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@Autowired
@Qualifier(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"myEndpoint"</span>)
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">private</span> Endpoint myEndpoint;

@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> expectTimeoutTest() {
    expectTimeout(myEndpoint)
        .timeout(500);
}</pre><p>The action offers two attributes:</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p><span class="emphasis"><em>endpoint</em></span>: Reference to a message endpoint that will try to receive messages.</p></li><li style="list-style-type: circle"><p><span class="emphasis"><em>wait/timeout</em></span>: Time period to wait for messages to arrive</p></li></ul></div><p>Sometimes you may want to add some selector on the timeout receiving action. This way you can very selective check on a message to not be present on a message destination.
    This is possible with defining a message selector on the test action as follows.</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">expect-timeout</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myEndpoint"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">wait</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"500"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">select</span>&gt;MessageId='123456789'&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">select</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">expect-timeout</span>/&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> expectTimeoutTest() {
    expectTimeout(myEndpoint)
        .selector(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"MessageId = '123456789'"</span>)
        .timeout(500);
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-echo"></a>11.5.&nbsp;Echo</h2></div></div></div><p>The &lt;echo&gt; action prints messages to the console/logger. This functionality is useful when
    debugging test runs. The property "message" defines the text that is printed. Tester might use it to print
    out debug messages and variables as shown the next code example:</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"echoTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"date"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:currentDate()"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;Hello Test Framework&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;Current date is: ${date}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> echoTest() {
    variable(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"date"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"citrus:currentDate()"</span>);
    
    echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Hello Test Framework"</span>);
    echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Current date is: ${date}"</span>);
}</pre><p>Result on the console:</p><pre class="programlisting">Hello Test Framework
Current time is: 05.08.2008</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-measure-time"></a>11.6.&nbsp;Time measurement</h2></div></div></div><p>Time measurement during a test can be very helpful. The &lt;trace-time&gt; action creates and monitors 
    multiple timelines. The action offers the attribute "id" to identify a time line. The tester can of course 
    use more than one time line with different ids simultaneously.</p><p>Read the next example and you will understand the mix of different time lines:</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"StopTimeTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">trace-time</span>/&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">trace-time</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"time_line_id"</span>/&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sleep</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">seconds</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"3.5"</span>/&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">trace-time</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">" time_line_id "</span>/&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sleep</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">milliseconds</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"5000"</span>/&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">trace-time</span>/&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">trace-time</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">" time_line_id "</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> stopTimeTest() {
    stopTime();
    stopTime(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"time_line_id"</span>);
    sleep(3.5); <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">// do something</span>
    stopTime(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"time_line_id"</span>);
    sleep(5000); <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">// do something</span>
    stopTime();
    stopTime(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"time_line_id"</span>);
}</pre><p>The test output looks like follows:</p><pre class="programlisting">Starting TimeWatcher:
Starting TimeWatcher: time_line_id
TimeWatcher time_line_id after 3500 milliseconds
TimeWatcher after 8500 seconds
TimeWatcher time_line_id after 8500 milliseconds</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">In case no time line id is specified the framework will measure the time for a default time line.</td></tr></table></div><p>To print out the current elapsed time for a time line you simply have to place the &lt;trace-time&gt; action into
    the action chain again and again, using the respective time line identifier. The elapsed time will be printed out to the console every time.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-create-variables"></a>11.7.&nbsp;Create variables</h2></div></div></div><p>As you know variables usually are defined at the beginning of the test case (<a href="#testcase-variables" title="4.1.2.&nbsp;Variables">Section&nbsp;4.1.2, &#8220;Variables&#8221;</a>). 
    It might also be helpful to reset existing variables as well as to define new variables during the test. The 
    action &lt;create-variables&gt; is able to declare new variables or overwrite existing ones.</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"createVariablesTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myVariable"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"12345"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"id"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"54321"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;Current variable value: ${myVariable}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">create-variables</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myVariable"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${id}"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"newVariable"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"'this is a test'"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/create-variables</span>&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;Current variable value: ${myVariable} &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
    
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
              New variable 'newVariable' has the value: ${newVariable}
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> createVariableTest() {
    variable(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"myVariable"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"12345"</span>);
    variable(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"id"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"54321"</span>);
    
    echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Current variable value: ${myVariable}"</span>);

    setVariable(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"myVariable"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"${id}"</span>);
    setVariable(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"newVariable"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"this is a test"</span>);
    
    echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Current variable value: ${myVariable}"</span>);
    
    echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"New variable 'newVariable' has the value: ${newVariable}"</span>);
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Please note the difference between the <span class="emphasis"><em>variable()</em></span> method and the <span class="emphasis"><em>setVariable()</em></span> method. The first initializes the test case with the test variables. So all
        variables defined with this method are valid from the very beginning of the test. In contrary to that the <span class="emphasis"><em>setVariable()</em></span> is executed within the test action chain. The newly created
        variables are then valid for the rest of the test. Trailing actions can reference the variables as usual with the variable expression.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-trace"></a>11.8.&nbsp;Trace variables</h2></div></div></div><p>You already know the &lt;echo&gt; action that prints messages to the console or logger. The
    &lt;trace-variables&gt; action is specially designed to trace all currently valid test variables to the console. 
    This was mainly used by us for debug reasons. The usage is quite simple:</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"traceVariablesTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myVariable"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"12345"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"nextVariable"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"54321"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">trace-variables</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myVariable"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"nextVariable"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/trace-variables</span>&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">trace-variables</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> traceTest() {
    variable(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"myVariable"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"12345"</span>);
    variable(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"nextVariable"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"54321"</span>);
    
    traceVariables(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"myVariable"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"nextVariable"</span>);
    traceVariables();
}</pre><p>Simply add the &lt;trace-variables&gt; action to your action chain and all variables will be printed out to
    the console. You are able to define a special set of variables by using the &lt;variable&gt; child
    elements. See the output that was generated by the test example above:</p><pre class="programlisting">Current value of variable myVariable = 12345
Current value of variable nextVariable = 54321</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-transform"></a>11.9.&nbsp;Transform</h2></div></div></div><p>The <code class="literal">&lt;transform&gt;</code> action transforms XML fragments with XSLT in order to construct various XML representations. 
    The transformation result is stored into a test variable for further usage. The property <span class="emphasis"><em>xml-data</em></span> defines the XML source, 
    that is going to be transformed, while <span class="emphasis"><em>xslt-data</em></span> defines the XSLT transformation rules. The attribute 
    <span class="emphasis"><em>variable</em></span> specifies the target test variable which receives the transformation result. The tester might use the action to 
    transform XML messages as shown in the next code example:</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"transformTest"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">transform</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">variable</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"result"</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">xml-data</span>&gt;
                  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;TestRequest&gt;</span>
                          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;Message&gt;Hello</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">World!&lt;/Message&gt;</span>
                      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/TestRequest&gt;</span>
                  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">]]&gt;</span>
              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/xml-data&gt;</span>
              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;xslt-data&gt;</span>
                  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;![CDATA[</span>
                      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;xsl:stylesheet</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">version</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"1.0"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xsl</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/1999/XSL/Transform"</span>&gt;
                      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">xsl:template</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">match</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"/"</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">html</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">body</span>&gt;
                                  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">h2</span>&gt;Test Request&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/h2</span>&gt;
                                  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">p</span>&gt;Message: &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">xsl:value-of</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">select</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"TestRequest/Message"</span>/&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/p</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/body</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/html</span>&gt;
                      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/xsl:template</span>&gt;
                      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/xsl:stylesheet</span>&gt;
                  ]]&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/xslt-data</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/transform</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;${result}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;
    </pre><p>The transformation above results to:</p><pre class="programlisting">
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">html</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">body</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">h2</span>&gt;Test Request&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/h2</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">p</span>&gt;Message: Hello World!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/p</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/body</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/html</span>&gt;
    </pre><p>In the example we used CDATA sections to define the transformation source as well as the XSL transformation rules. As usual you can also use 
    external file resources here. The transform action with external file resources looks like follows:</p><pre class="programlisting">
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">transform</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">variable</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"result"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">xml-resource</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:transform-source.xml"</span>/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">xslt-resource</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:transform.xslt"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/transform</span>&gt;
    </pre><p>The Java DSL alternative for transforming data via XSTL in Citrus looks like follows:</p><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> transformTest() {
    transform()
        .source(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"&lt;TestRequest&gt;"</span> +
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"&lt;Message&gt;Hello World!&lt;/Message&gt;"</span> +
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"&lt;/TestRequest&gt;"</span>)
        .xslt(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"&lt;xsl:stylesheet version=\"1.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"&gt;\n"</span> +
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"&lt;xsl:template match=\"/\"&gt;\n"</span> +
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"&lt;html&gt;\n"</span> +
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"&lt;body&gt;\n"</span> +
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"&lt;h2&gt;Test Request&lt;/h2&gt;\n"</span> +
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"&lt;p&gt;Message: &lt;xsl:value-of select=\"TestRequest/Message\"/&gt;&lt;/p&gt;\n"</span> +
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"&lt;/body&gt;\n"</span> +  
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"&lt;/html&gt;\n"</span> +
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"&lt;/xsl:template&gt;\n"</span> +
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"&lt;/xsl:stylesheet&gt;"</span>)
        .result(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"result"</span>);
    
    echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"${result}"</span>);
    
    transform()
        .source(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">new</span> ClassPathResource(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"com/consol/citrus/actions/transform-source.xml"</span>))
        .xslt(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">new</span> ClassPathResource(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"com/consol/citrus/actions/transform.xslt"</span>))
        .result(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"result"</span>);
    
    echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"${result}"</span>);
}</pre><p>Defining multi-line Strings with nested quotes is no fun in Java. So you may want to use external file resources for your scripts as shown in the second part of the example.
    In fact you could also use script languages like Groovy or Scala that have much better support for multi-line Strings.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-groovy"></a>11.10.&nbsp;Groovy support</h2></div></div></div><p>Groovy is an agile dynamic language for the Java Platform. Groovy ships with a lot of 
    very powerful features and fits perfectly with Java as it is based on Java and runs
    inside the JVM.</p><p>The Citrus Groovy support might be the entrance for you to write customized test actions. 
    You can easily execute Groovy code inside a test case, just like a normal test action. The 
    whole test context with all variables is available to the Groovy action. This means someone
    can change variable values or create new variables very easily.</p><p>Let's have a look at some examples in order to understand the possible Groovy code 
    interactions in Citrus:</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"groovyTest"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"time"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:currentDate()"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">groovy</span>&gt;
        println 'Hello Citrus'
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/groovy</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">groovy</span>&gt;
        println 'The variable is: ${time}'
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/groovy</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">groovy</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">resource</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:com/consol/citrus/script/example.groovy"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> groovyTest() {
    groovy(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"println 'Hello Citrus'"</span>);
    groovy(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"println 'The variable is: ${time}'"</span>);
    
    groovy(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">new</span> ClassPathResource(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"com/consol/citrus/script/example.groovy"</span>));
}</pre><p>As you can see it is possible to write Groovy code directly into the test case. 
    Citrus will interpret and execute the Groovy code at runtime. As usual nested variable expressions 
    are replaced with respective values. In general this is done in advance before the Groovy code is 
    interpreted. For more complex Groovy code sections which grow in lines of code you can also reference 
    external file resources.</p><p>After this basic Groovy code usage inside a test case we might be interested accessing the whole
    TestContext. The TestContext Java object holds all test variables and function definitions for the 
    test case and can be referenced in Groovy code via simple naming convention. Just access the object 
    reference 'context' and you are able to manipulate the TestContext (e.g. setting a new variable which 
    is directly ready for use in following test actions).</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"groovyTest"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">groovy</span>&gt;
      context.setVariable("greetingText","Hello Citrus")
      println context.getVariable("greetingText")
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/groovy</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;New variable: ${greetingText}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The implicit TestContext access that was shown in the previous sample works with a default Groovy script
        template provided by Citrus. The Groovy code you write in the test case is automatically surrounded with a Groovy 
        script which takes care of handling the TestContext. The default template looks like follows:</p><pre class="programlisting"><span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> com.consol.citrus.*
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> com.consol.citrus.variable.*
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> com.consol.citrus.context.TestContext
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> com.consol.citrus.script.GroovyAction.ScriptExecutor

<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">class</span> GScript <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">implements</span> ScriptExecutor {
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> execute(TestContext context) {
        @SCRIPTBODY@
    }
}</pre><p>Your code is placed in substitution to the <code class="literal">@SCRIPTBODY@</code> placeholder. Now you might understand how
        Citrus handles the context automatically. You can also write your own script templates making more advanced usage of other Java
        APIs and Groovy code. Just add a script template path to the test action like this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">groovy</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">script-template</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:my-custom-template.groovy"</span>&gt;
  [...]
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/groovy</span>&gt;</pre><p>On the other hand you can disable the automatic script template wrapping in your action at all:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">groovy</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">use-script-template</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"false"</span>&gt;
  println 'Just use some Groovy code'
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/groovy</span>&gt;</pre></td></tr></table></div><p>The next example deals with advanced Groovy code and writing whole classes. We write a new Groovy class 
    which implements the ScriptExecutor interface offered by Citrus. This interface defines a special execute 
    method and provides access to the whole TestContext for advanced test variables access.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"groovyTest"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"time"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:currentDate()"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">groovy</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">import</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">com.consol.citrus.*</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">import</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">com.consol.citrus.variable.*</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">import</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">com.consol.citrus.context.TestContext</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">import</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">com.consol.citrus.script.GroovyAction.ScriptExecutor</span>
        
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">GScript</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">implements</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">ScriptExecutor</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">{</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">void</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">execute(TestContext</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">context)</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">{</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">println</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">context.getVariable("time")</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">}</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">}</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">]]&gt;</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/groovy&gt;</span>
  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/actions&gt;</span>
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/testcase&gt;</span></pre><p>Implementing the ScriptExecutor interface in a custom Groovy class is applicable for very special 
    test context manipulations as you are able to import and use other Java API classes in this code.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-fail"></a>11.11.&nbsp;Failing the test</h2></div></div></div><p>The fail action will generate an exception in order to terminate the test case with error. The test case will
    therefore not be successful in the reports.</p><p>The user can specify a custom error message for the exception in order to describe the error cause. Here is a 
    very simple example to clarify the syntax:</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"failTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">fail</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Test will fail with custom message"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>Test results:</p><pre class="programlisting">Execution of test: failTest failed! Nested exception is: 
com.consol.citrus.exceptions.CitrusRuntimeException: 
Test will fail with custom message

[...]

CITRUS TEST RESULTS

failTest          : failed - Exception is: Test will fail with custom message

Found 1 test cases to execute
Skipped 0 test cases (0.0%)
Executed 1 test cases, containing 3 actions
Tests failed:        1 (100.0%)
Tests successfully:  0 (0.0%) </pre><p>While using the Java DSL tester might want to raise some Java exceptions in the middle of configuring the test case. But this is not possible
    as we have to separate the design time and the execution time of the test case. The <span class="emphasis"><em>@CitrusTest</em></span> annotated configuration method
    is called for building up the whole test case. After this method was processed the test gets executed in runtime oth the test. If you specify a throws
    exception statement in the configuration method this will not be done at runtime but at design time. This is why you have to use the special fail test action
    which raises a Java exception during the runtime of the test. The next example will not work as expected:</p><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> wrongUsageSample() {
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">// some test actions</span>
    
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">throw</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">new</span> ValidationException(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"This test should fail now"</span>); <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">// does not work as expected </span>
}</pre><p>The validation exception above is directly raised before the test is able to start as the <span class="emphasis"><em>@CitrusTest</em></span> annotated method does
    not represent the test runtime. Instead of this we have to use the fail action as follows:</p><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> failTest() {
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">// some test actions</span>
    
    fail(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"This test should fail now"</span>); <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">// fails at test runtime as expected </span>
}</pre><p>Now the test fails at runtime as the fail action is raised during the test execution as expected.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-input"></a>11.12.&nbsp;Input</h2></div></div></div><p>During the test case execution it is possible to read some user input from the command line. The test execution will 
    stop and wait for keyboard inputs over the standard input stream. The user has to type the input and end it with the return 
    key.</p><p>The user input is stored to the respective variable value.</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"inputTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"userinput"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">""</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variable</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"userinput1"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">""</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variable</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"userinput2"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"y"</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variable</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"userinput3"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"yes"</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variable</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"userinput4"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">""</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variable</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">input</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;user input was: ${userinput}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">input</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Now press enter:"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">variable</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"userinput1"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;user input was: ${userinput1}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">input</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Do you want to continue?"</span> 
                  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">valid-answers</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"y/n"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">variable</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"userinput2"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;user input was: ${userinput2}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">input</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Do you want to continue?"</span> 
                  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">valid-answers</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"yes/no"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">variable</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"userinput3"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;user input was: ${userinput3}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">input</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">variable</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"userinput4"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;user input was: ${userinput4}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>As you can see the input action is customizable with a prompt message that is displayed to the user and some valid answer possibilities.
    The user input is stored to a test variable for further use in the test case. In detail the input action offers following attributes:</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p><span class="emphasis"><em>message</em></span> -&gt; message displayed to the user</p></li><li style="list-style-type: circle"><p><span class="emphasis"><em>valid-answers</em></span> -&gt; optional slash separated string containing the possible valid answers</p></li><li style="list-style-type: circle"><p><span class="emphasis"><em>variable</em></span> -&gt; result variable name holding the user input (default = ${userinput})</p></li></ul></div><p>The same action in Java DSL now looks quite familiar to us although attribute naming is slightly different:</p><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> inputActionTest() {
    variable(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"userinput"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">""</span>);
    variable(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"userinput1"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">""</span>);
    variable(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"userinput2"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"y"</span>);
    variable(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"userinput3"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"yes"</span>);
    variable(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"userinput4"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">""</span>);
    
    input();
    echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"user input was: ${userinput}"</span>);
    input().message(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Now press enter:"</span>).result(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"userinput1"</span>);
    echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"user input was: ${userinput1}"</span>);
    input().message(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Do you want to continue?"</span>).answers(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"y"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"n"</span>).result(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"userinput2"</span>);
    echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"user input was: ${userinput2}"</span>);
    input().message(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Do you want to continue?"</span>).answers(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"yes"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"no"</span>).result(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"userinput3"</span>);
    echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"user input was: ${userinput3}"</span>);
    input().result(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"userinput4"</span>);
    echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"user input was: ${userinput4}"</span>); 
}</pre><p>When the user input is restricted to a set of valid answers the input validation of course can fail due to mismatch. This is the case when the user
    provides some input not matching the valid answers given. In this case the user is again asked to provide valid input. The test action will continue to ask for valid
    input until a valid answer is given.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>User inputs may not fit to automatic testing in terms of continuous integration testing where no user is present to 
        type in the correct answer over the keyboard. In this case you can always skip the user input in advance by specifying
        a variable that matches the user input variable name. As the user input variable is then already present the user 
        input is missed out and the test proceeds automatically.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-load"></a>11.13.&nbsp;Load</h2></div></div></div><p>You are able to load properties from external property files and store them as test variables. The action will
    require a file resource either from class path or file system in order to read the property values.</p><p>Let us look at an example to get an idea about this action:</p><p><span class="emphasis"><em>Content of load.properties:</em></span></p><pre class="programlisting">username=Mickey Mouse
greeting.text=Hello Test Framework</pre><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"loadPropertiesTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">load</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">properties</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"file:tests/resources/load.properties"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/load</span>&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">trace-variables</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> loadPropertiesTest() {
    load(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"file:tests/resources/load.properties"</span>);
    
    traceVariables();
}</pre><p><span class="emphasis"><em>Output:</em></span></p><pre class="programlisting">Current value of variable username = Mickey Mouse
Current value of variable greeting.text = Hello Test Framework</pre><p>The action will load all available properties in the file load.properties and store them to the test case
    as local variables.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>Please be aware of the fact that existing variables are overwritten!</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-purge-jms"></a>11.14.&nbsp;Purging JMS destinations</h2></div></div></div><p>Purging JMS destinations during the test run is quite essential. Different test cases can influence each other when sending
    messages to the same JMS destinations. A test case should only receive those messages that actually belong to it. Therefore it is a 
    good idea to purge all JMS queue destinations between the test cases. Obsolete messages that are stuck in a JMS queue for some 
    reason are then removed so that the following test case is not offended.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Citrus provides special support for JMS related features. We have to activate those JMS features in our test case by adding a special
        "jms" namespace and schema definition location to the test case XML.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">spring:beans</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/testcase"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:spring</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xsi</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:jms</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/jms/testcase"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.citrusframework.org/schema/testcase
        http://www.citrusframework.org/schema/testcase/citrus-testcase.xsd
        http://www.citrusframework.org/schema/jms/testcase
        http://www.citrusframework.org/schema/jms/testcase/citrus-jms-testcase.xsd"</span>&gt;

    [...]

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/beans</span>&gt;</pre></td></tr></table></div><p>Now we are ready to use the JMS features in our test case in order to purge some JMS queues. This can be done with following action definition:</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"purgeTest"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">jms:purge-jms-queues</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">jms:queue</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Some.JMS.QUEUE.Name"</span>/&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">jms:queue</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Another.JMS.QUEUE.Name"</span>/&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">jms:queue</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"My.JMS.QUEUE.Name"</span>/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/jms:purge-jms-queues</span>&gt;
      
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">jms:purge-jms-queues</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">connection-factory</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"connectionFactory"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">jms:queue</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Some.JMS.QUEUE.Name"</span>/&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">jms:queue</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Another.JMS.QUEUE.Name"</span>/&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">jms:queue</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"My.JMS.QUEUE.Name"</span>/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/jms:purge-jms-queues</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>Notice that we have referenced the <span class="emphasis"><em>jms</em></span> namespace when using the <span class="emphasis"><em>purge-jms-queues</em></span> test action.</p><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@Autowired
@Qualifier(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"connectionFactory"</span>)
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">private</span> ConnectionFactory connectionFactory;

@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> purgeTest() {
    purgeQueues()
        .queue(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Some.JMS.QUEUE.Name"</span>)
        .queue(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Another.JMS.QUEUE.Name"</span>);
        
    purgeQueues(connectionFactory)
        .timeout(150L) <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">// custom timeout in ms</span>
        .queue(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Some.JMS.QUEUE.Name"</span>)
        .queue(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Another.JMS.QUEUE.Name"</span>);
}</pre><p>Purging the JMS queues in every test case is quite exhausting because every test case needs to define a purging action at the 
    very beginning of the test. Fortunately the test suite definition offers tasks to run before, between and after the test cases which 
    should ease up this tasks a lot. The test suite offers a very simple way to purge the destinations between the tests. 
    See <a href="#testsuite-before-test" title="31.3.&nbsp;Before test">Section&nbsp;31.3, &#8220;Before test&#8221;</a> for more information about this.</p><p>As you can see in the next example it is quite easy to specify a group of destinations in the Spring configuration that get purged
    before a test is executed.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:before-test</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"purgeBeforeTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">jms:purge-jms-queues</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">jms:queue</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Some.JMS.QUEUE.Name"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">jms:queue</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Another.JMS.QUEUE.Name"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/jms:purge-jms-queues</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:before-test</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Please keep in mind that the JMS related configuration components in Citrus belong to a separate XML namespace <span class="emphasis"><em>jms:</em></span>.
        We have to add this namespace declaration to each test case XML and Spring bean XML configuration file as described at the very beginning
        of this section.</p></td></tr></table></div><p>The syntax for purging the destinations is the same as we used it inside the test case. So now we are able to purge JMS destinations with given destination names.
    But sometimes we do not want to rely on queue or topic names as we retrieve destinations over JNDI for instance. We can deal with destinations coming from JNDI lookup like follows:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">jee:jndi-lookup</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jmsQueueHelloRequestIn"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">jndi-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jms/jmsQueueHelloRequestIn"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">jee:jndi-lookup</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jmsQueueHelloResponseOut"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">jndi-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jms/jmsQueueHelloResponseOut"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:before-test</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"purgeBeforeTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">jms:purge-jms-queues</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">jms:queue</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">ref</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jmsQueueHelloRequestIn"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">jms:queue</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">ref</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jmsQueueHelloResponseOut"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/jms:purge-jms-queues</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:before-test</span>&gt;</pre><p>We just use the attribute <span class="emphasis"><em>'ref'</em></span> instead of <span class="emphasis"><em>'name'</em></span> and Citrus is looking for a
    bean reference for that identifier that resolves to a JMS destination. You can use the JNDI bean references inside a test case, too.</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"purgeTest"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">jms:purge-jms-queues</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">jms:queue</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">ref</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jmsQueueHelloRequestIn"</span>/&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">jms:queue</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">ref</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jmsQueueHelloResponseOut"</span>/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/jms:purge-jms-queues</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>Of course you can use queue object references also in Java DSL test cases. Here we easily can use Spring's dependency injection with autowiring to
    get the object references from the IoC container.</p><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@Autowired
@Qualifier(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"jmsQueueHelloRequestIn"</span>)
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">private</span> Queue jmsQueueHelloRequestIn;

@Autowired
@Qualifier(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"jmsQueueHelloResponseOut"</span>)
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">private</span> Queue jmsQueueHelloResponseOut;

@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> purgeTest() {
    purgeQueues()
        .queue(jmsQueueHelloRequestIn)
        .queue(jmsQueueHelloResponseOut);
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>You can mix queue name and queue object references as you like within one single purge queue test action.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-purge-channels"></a>11.15.&nbsp;Purging message channels</h2></div></div></div><p>Message channels define central messaging destinations in Citrus. These are namely in memory message queues holding 
    messages for test cases. These messages may become obsolete during a test run, especially when test cases fail and stop in 
    their message consumption. Purging these message channel destinations is essential in these scenarios in order to not influence
    upcoming test cases. Each test case should only receive those messages that actually refer to the test model. Therefore it is a 
    good idea to purge all message channel destinations between the test cases. Obsolete messages that get stuck in a message channel 
    destination for some reason are then removed so that upcoming test case are not broken.</p><p>Following action definition purges all messages from a list of message channels:</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"purgeChannelTest"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">purge-channel</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">channel</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"someChannelName"</span>/&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">channel</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"anotherChannelName"</span>/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/purge-channel</span>&gt;
      
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">purge-channel</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">channel</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">ref</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"someChannel"</span>/&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">channel</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">ref</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"anotherChannel"</span>/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/purge-channel</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>As you can see the test action supports channel names as well as channel references to Spring bean instances. When using channel references
    you refer to the Spring bean id or name in your application context.</p><p>The Java DSL works quite similar as you can read from next examples:</p><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@Autowired
@Qualifier(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"channelResolver"</span>)
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">private</span> DestinationResolver&lt;MessageChannel&gt; channelResolver;

@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> purgeTest() {
    purgeChannels()
        .channelResolver(channelResolver)
        .channelNames(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"ch1"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"ch2"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"ch3"</span>)
        .channel(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"ch4"</span>);
}</pre><p>The channel resolver reference is optional. By default Citrus will automatically use a Spring application context channel resolver so you just have to 
    use the respective Spring bean names that are configured in the Spring application context. However setting a custom channel resolver may be adequate for you
    in some special cases.</p><p>While speaking of Spring application context bean references the next example uses such bean references for channels to purge.</p><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@Autowired
@Qualifier(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"channel1"</span>)
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">private</span> MessageChannel channel1;

@Autowired
@Qualifier(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"channel2"</span>)
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">private</span> MessageChannel channel2;

@Autowired
@Qualifier(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"channel3"</span>)
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">private</span> MessageChannel channel3;

@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> purgeTest() {
    purgeChannels()
        .channels(channel1, channel2)
        .channel(channel3);
}</pre><p>Message selectors enable you to selectively remove messages from the destination. All messages that
    pass the message selection logic get deleted the other messages will remain unchanged inside the channel destination. The 
    message selector is a Spring bean that implements a special message selector interface. A possible implementation could be a 
    selector deleting all messages that are older than five seconds:</p><pre class="programlisting"><span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> org.springframework.messaging.Message;
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> org.springframework.integration.core.MessageSelector;

<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">class</span> TimeBasedMessageSelector <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">implements</span> MessageSelector {

    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">boolean</span> accept(Message&lt;?&gt; message) {
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">if</span> (System.currentTimeMillis() - message.getHeaders().getTimestamp() &gt; 5000) {
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">return</span> false;
        } <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">else</span> {
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">return</span> true;
        }
    }

}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The message selector returns <span class="emphasis"><em>false</em></span> for those messages that should be deleted from the channel!</p></td></tr></table></div><p>You simply define the message selector as a new Spring bean in the Citrus application context and reference it in your test action property.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"specialMessageSelector"</span> 
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.special.TimeBasedMessageSelector"</span>/&gt;</pre><p>Now let us have a look at how you reference the selector in your test case:</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">purge-channels</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message-selector</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"specialMessageSelector"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">channel</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"someChannelName"</span>/&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">channel</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"anotherChannelName"</span>/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/purge-channels</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">
@Autowired
@Qualifier(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"specialMessageSelector"</span>)
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">private</span> MessageSelector specialMessageSelector;

@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> purgeTest() {
    purgeChannels()
        .channelNames(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"ch1"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"ch2"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"ch3"</span>)
        .selector(specialMessageSelector);
}</pre><p>Purging channels in each test case every time is quite exhausting because every test case needs to define a purging action at the 
    very beginning of the test. A more straight forward approach would be to introduce some purging action which is automatically executed before each test. 
    Fortunately the Citrus test suite offers a very simple way to do this. It is described in <a href="#testsuite-before-test" title="31.3.&nbsp;Before test">Section&nbsp;31.3, &#8220;Before test&#8221;</a>.</p><p>When using the special action sequence before test cases we are able to purge channel destinations every time a test case executes.
    See the upcoming example to find out how the action is defined in the Spring configuration application context.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:before-test</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"purgeBeforeTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">purge-channel</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">channel</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"fooChannel"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">channel</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"barChannel"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/purge-channel</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:before-test</span>&gt;</pre><p>Just use this before-test bean in the citrus-context.xml Spring bean application context and the purge channel action is active. Obsolete messages that are
    waiting on the message channels for consumption are purged before the next test in line is executed.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Purging message channels becomes also very interesting when working with server instances in Citrus. Each server component automatically has an inbound message channel
        where incoming messages are stored to internally. So if you need to clean up a server that has already stored some incoming messages you can do this easily by purging the internal message
        channel. The message channel follows a naming convention <span class="emphasis"><em>{serverName}.inbound</em></span> where <span class="emphasis"><em>{serverName}</em></span> is the Spring bean name of the Citrus server
        endpoint component. If you purge this internal channel in a before test nature you are sure that obsolete messages on a server instance get purged before each test is executed.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-assert"></a>11.16.&nbsp;Assert failure</h2></div></div></div><p>Citrus test actions fail with Java exceptions and error messages. This gives you the opportunity to expect an action to fail during test
    execution. You can simple assert a Java exception to be thrown during execution. See the example for an assert action definition in a test case:</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"assertFailureTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">assert</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">exception</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.exceptions.CitrusRuntimeException"</span>
                   <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Unknown variable ${date}"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;Current date is: ${date}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/assert</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> assertTest() {
    assertException(echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Current date is: ${date}"</span>))
        .exception(com.consol.citrus.exceptions.CitrusRuntimeException.<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">class</span>)
        .message(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Unknown variable ${date}"</span>);
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Note that the assert action requires an exception. In case no exception is thrown by the embedded test action the assertion
        and the test case will fail!</p></td></tr></table></div><p>The assert action always wraps a single test action, which is then monitored for failure. In case the nested test action fails with error you
    can validate the error in its type and error message (optional). The failure has to fit the expected one exactly otherwise the assertion fails itself.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>Important to notice is the fact that asserted exceptions do not cause failure of the test case. As you except the failure to happen the test continues
        with its work once the assertion is done successfully.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-catch"></a>11.17.&nbsp;Catch exceptions</h2></div></div></div><p>In the previous chapter we have seen how to expect failures in Citrus with assert action. Now the assert action is designed for single
    actions to be monitored and for failures to be expected in any case. The <span class="emphasis"><em>'catch'</em></span> action in contrary can hold several 
    nested test actions and exception failure is optional.</p><p>The nested actions are error proof for the chosen exception type. This means possible exceptions are caught and ignored - the test 
    case will not fail for this exception type. But only for this particular exception type! Other exception types that occur during execution
    do cause the test to fail as usual.</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"catchExceptionTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">catch</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">exception</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.exceptions.CitrusRuntimeException"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;Current date is: ${date}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/catch</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> catchTest() {
    catchException(CitrusRuntimeException.<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">class</span>, echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Current date is: ${date}"</span>));
}</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>Note that there is no validation available in a catch block. So catching exceptions is just to make a test more stable towards
        errors that can occur. The caught exception does not cause any failure in the test. The test case may continue with execution as if there was not failure.
        Also notice that the catch action is also happy when no exception at all is raised. In contrary to that the assert action requires the exception and an 
        assert action is failing in positive processing.</p></td></tr></table></div><p>Catching exceptions like this may only fit to very error prone action blocks where failures do not harm the test case success. Otherwise a failure 
    in a test action should always reflect to the whole test case to fail with errors.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">Java developers might ask why not use try-catch Java block instead? The answer is simple yet very important to understand. The test method
    is called by the Java DSL test case builder for building the Citrus test. This can be referred to as the design time of the test. After the building test method
    was processed the test gets executed, which can be called the runtime of the test. This means that a try-catch block within the design time method will never
    perform during the test run. The only reliable way to add the catch capability to the test as part of the test case runtime is to use the Citrus test action which
    gets executed during test runtime.</td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-antrun"></a>11.18.&nbsp;Running Apache Ant build targets</h2></div></div></div><p>The &lt;ant&gt; action loads a build.xml Ant file and executes one or more targets in the Ant project. The target is executed with
    optional build properties passed to the Ant run. The Ant build output is logged with Citrus logger and the test case success is bound to
    the Ant build success. This means in case the Ant build fails for some reason the test case will also fail with build exception accordingly.</p><p>See this basic Ant run example to see how it works within your test case:</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"AntRunTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"today"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:currentDate()"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ant</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">build-file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:com/consol/citrus/actions/build.xml"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">execute</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">target</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sayHello"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">properties</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"date"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${today}"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"welcomeText"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Hello!"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/properties</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ant</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> antRunTest() {
    variable(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"today"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"citrus:currentDate()"</span>);
    
    antrun(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"classpath:com/consol/citrus/actions/build.xml"</span>)
        .target(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"sayHello"</span>)
        .property(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"date"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"${today}"</span>)
        .property(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"welcomeText"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"$Hello!"</span>);
}</pre><p>The respective build.xml Ant file must provide the target to call. For example:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">project</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus-build"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">default</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sayHello"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"welcomeText"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Welcome to Citrus!"</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
    
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">target</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sayHello"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${welcomeText} - Today is ${date}"</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/target</span>&gt;
    
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">target</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sayGoodbye"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Goodbye everybody!"</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/target</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/project</span>&gt;</pre><p>As you can see you can pass custom build properties to the Ant build execution. Existing Ant build properties are
    replaced and you can use the properties in your build file as usual.</p><p>You can also call multiple targets within one single build run by using a comma separated list of target names:</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"AntRunTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"today"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:currentDate()"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ant</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">build-file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:com/consol/citrus/actions/build.xml"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">execute</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">targets</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sayHello,sayGoodbye"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">properties</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"date"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${today}"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/properties</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ant</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> antRunTest() {
    variable(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"today"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"citrus:currentDate()"</span>);
    
    antrun(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"classpath:com/consol/citrus/actions/build.xml"</span>)
        .targets(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"sayHello"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"sayGoodbye"</span>)
        .property(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"date"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"${today}"</span>);
}</pre><p>The build properties can live in external file resource as an alternative to the inline property definitions. You just have to use the
    respective file resource path and all nested properties get loaded as build properties.</p><p>In addition to that you can also define a custom build listener. The build listener must implement the Ant API interface <span class="emphasis"><em>org.apache.tools.ant.BuildListener</em></span>.
    During the Ant build run the build listener is called with several callback methods (e.g. buildStarted(), buildFinished(), targetStarted(), targetFinished(), ...). This is how
    you can add additional logic to the Ant build run from Citrus. A custom build listener could manage the fail state of your test case, in particular by
    raising some exception forcing the test case to fail accordingly.</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"AntRunTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ant</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">build-file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:com/consol/citrus/actions/build.xml"</span> 
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">build-listener</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"customBuildListener"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">execute</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">target</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sayHello"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">properties</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:com/consol/citrus/actions/build.properties"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ant</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@Autowired
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">private</span> BuildListener customBuildListener;

@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> antRunTest() {
    antrun(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"classpath:com/consol/citrus/actions/build.xml"</span>)
        .target(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"sayHello"</span>)
        .propertyFile(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"classpath:com/consol/citrus/actions/build.properties"</span>)
        .listener(customBuildListener);
}</pre><p>The <span class="emphasis"><em>customBuildListener</em></span> used in the example above should reference a Spring bean in the Citrus application context. The bean implements
    the interface <span class="emphasis"><em>org.apache.tools.ant.BuildListener</em></span> and controls the Ant build run.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-manage-server"></a>11.19.&nbsp;Start/Stop server instances</h2></div></div></div><p>Citrus is working with server components that are started and stopped within a test run. This can be a Http server or some SMTP mail server for instance. Usually the Citrus server components are
    automatically started when Citrus is starting and respectively stopped when Citrus is shutting down. Sometimes it might be helpful to explicitly start and stop a server instance within your test case.
    Here you can use special start and stop test actions inside your test. This is a good way to test downtime scenarios of interface partners with respective error handling when connections to servers are lost</p><p>Let me explain with a simple sample test case:</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sleepTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">start</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">server</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myMailServer"</span>/&gt;

        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sleep</span>/&gt;

        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">stop</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">server</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myMailServer"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>The start and stop server test action receive a server name which references a Spring bean component of type <span class="emphasis"><em>com.consol.citrus.server.Server</em></span> in your basic Spring application context.
        The server instance is started or stopped within the test case. As you can see in the next listing we can also start and stop multiple server instances within a single test action.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sleepTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">start</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">servers</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">server</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myMailServer"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">server</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myFtpServer"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/servers</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/start</span>&gt;

        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sleep</span>/&gt;

        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">stop</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">servers</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">server</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myMailServer"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">server</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myFtpServer"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/servers</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/stop</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>When using the Java DSL the best way to reference a server instance is to autowire the Spring bean via dependency injection. The Spring framework takes case on injecting the proper Spring bean component
        defined in the SPring application context. This way you can easily start and stop server instances within Java DSL test cases.</p><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@Autowired
@Qualifier(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"myFtpServer"</span>)
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">private</span> FtpServer myFtpServer;

@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> startStopServerTest() {
    start(myFtpServer);

    sleep();

    stop(myFtpServer);
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Starting and stopping server instances is a synchronous test action. This means that your test case is waiting for the server to start before other test actions take place. Startup times and shut down of
        server instances may delay your test accordingly.</p></td></tr></table></div><p>As you can see starting and stopping Citrus server instances is very easy. You can also write your own server implementations by implementing the interface <span class="emphasis"><em>com.consol.citrus.server.Server</em></span>.
    All custom server implementations can then be started and stopped during a test case.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-generic-action"></a>11.20.&nbsp;Including custom test actions</h2></div></div></div><p>Now we have a look at the opportunity to add custom test actions to the test case flow. Let us start this section with an example:</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"ActionReferenceTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">action</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">reference</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"cleanUpDatabase"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">action</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">reference</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"mySpecialAction"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>The generic &lt;action&gt; element references Spring beans that implement the Java interface 
    <code class="literal">com.consol.citrus.TestAction</code>. This is a very fast way to add your own action 
    implementations to a Citrus test case. This way you can easily implement your own actions in Java and 
    include them into the test case.</p><p>In the example above the called actions are special database cleanup implementations. The actions are defined as Spring beans 
    in the Citrus configuration and get referenced by their bean name or id.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"cleanUpDatabase"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"my.domain.citrus.actions.SpecialDatabaseCleanupAction"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"dataSource"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">ref</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testDataSource"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>The Spring application context holds your custom bean implementations. You can set properties and use the full Spring power while implementing your
    custom test action in Java. Let us have a look on how such a Java class may look like.</p><pre class="programlisting"><span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> com.consol.citrus.actions.AbstractTestAction;
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">import</span> com.consol.citrus.context.TestContext;

<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">class</span> SpecialDatabaseCleanupAction <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">extends</span> AbstractTestAction {

    @Autowired
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">private</span> DataSource dataSource;
    
    @Override
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> doExecute(TestContext context) {
        JdbcTemplate jdbcTemplate = <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">new</span> JdbcTemplate(dataSource);
        
        jdbcTemplate.execute(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"..."</span>);
    }

}</pre><p>All you need to do in your Java class is to implement the Citrus <code class="literal">com.consol.citrus.TestAction</code> interface. The abstract class 
    <code class="literal">com.consol.citrus.actions.AbstractTestAction</code> may help you to start with your custom test action implementation as it provides basic
    method implementations so you just have to implement the <code class="literal">doExecute()</code> method.</p><p>When using the Java test case DSL you are also quite comfortable with including your custom test actions.</p><pre class="programlisting">@Autowired
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">private</span> SpecialDatabaseCleanupAction cleanUpDatabaseAction;

@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> genericActionTest() {
    echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Now let's include our special test action"</span>);
    
    action(cleanUpDatabaseAction);
    
    echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"That's it!"</span>);
}</pre><p>Using anonymous class implementations is also possible.</p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> genericActionTest() {
    echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Now let's call our special test action anonymously"</span>);
    
    action(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">new</span> AbstractTestAction() {
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> doExecute(TestContext context) {
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">// do something</span>
        }
    });
    
    echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"That's it!"</span>);
}</pre></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="templates"></a>Chapter&nbsp;12.&nbsp;Templates</h2></div></div></div><p>Templates group action sequences to a logical unit. You can think of templates as reusable components
    that are used in several tests. The maintenance is much more effective because the templates are referenced
    several times.</p><p>The template always has a unique name. Inside a test case we call the template by this unique name. 
    Have a look at a first example:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">template</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"doCreateVariables"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">create-variables</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"var"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"123456789"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/create-variables</span>&gt;
    
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">call-template</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"doTraceVariables"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/template</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">template</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"doTraceVariables"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;Current time is: ${time}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
    
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">trace-variables</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/template</span>&gt;</pre><p>The code example above describes two template definitions. Templates hold a sequence of test 
    actions or call other templates themselves as seen in the example above.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The &lt;call-template&gt; action calls other templates by their name. The called
      template not necessarily has to be located in the same test case XML file. The template might be defined in
      a separate XML file other than the test case itself:</p></td></tr></table></div><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"templateTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myTime"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:currentDate()"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">call-template</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"doCreateVariables"</span>/&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">call-template</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"doTraceVariables"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">parameter</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"time"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${myTime}"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/call-template</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> templateTest() {
    variable(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"myTime"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"citrus:currentDate()"</span>);
    
    template(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"doCreateVariables"</span>);
    
    template(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"doTraceVariables"</span>)
        .parameter(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"time"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"${myTime}"</span>);
}</pre><p>There is an open question when dealing with templates that are defined somewhere else outside the test case.
    How to handle variables? A templates may use different variable names then the test and vice versa. No doubt the 
    template will fail as soon as special variables with respective values are not present. Unknown variables 
    cause the template and the whole test to fail with errors.</p><p>So a first approach would be to harmonize variable usage across templates and test cases, so that templates
    and test cases do use the same variable naming. But this approach might lead to high calibration effort. Therefore 
    templates support parameters to solve this problem. When a template is called the calling actor is able to set some 
    parameters. Let us discuss an example for this issue.</p><p>The template "doDateCoversion" in the next sample uses the variable ${date}. The calling test case 
    can set this variable as a parameter without actually declaring the variable in the test itself:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">call-template</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"doDateCoversion"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">parameter</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"date"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${sampleDate}"</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/call-template</span>&gt;</pre><p>The variable <span class="emphasis"><em>sampleDate</em></span> is already present in the test case and gets translated into the 
    <span class="emphasis"><em>date</em></span> parameter. Following from that the template works fine although test and template do work on 
    different variable namings.</p><p>With template parameters you are able to solve the calibration effort when working with templates and variables. 
    It is always a good idea to check the used variables/parameters inside a template when calling it. There might be a 
    variable that is not declared yet inside your test. So you need to define this value as a parameter.</p><p>Template parameters may contain more complex values like XML fragments. The call-template action offers following 
    CDATA variation for defining complex parameter values:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">call-template</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"printXMLPayload"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">parameter</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"payload"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;HelloRequest</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/samples/sayHello.xsd"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Text</span>&gt;Hello South ${var}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Text</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/HelloRequest</span>&gt;
        ]]&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/parameter</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/call-template</span>&gt;</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>When a template works on variable values and parameters changes to these variables will automatically affect the variables 
        in the whole test. So if you change a variable's value inside a template and the variable is defined inside the test case the
        changes will affect the variable in a global context. We have to be careful with this when executing a template several
        times in a test, especially in combination with parallel containers (see <a href="#containers-parallel" title="13.3.&nbsp;Parallel">Section&nbsp;13.3, &#8220;Parallel&#8221;</a>).</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">parallel</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">call-template</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"print"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">parameter</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"param1"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"1"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">parameter</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"param2"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Hello Europe"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/call-template</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">call-template</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"print"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">parameter</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"param1"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"2"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">parameter</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"param2"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Hello Asia"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/call-template</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">call-template</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"print"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">parameter</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"param1"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"3"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">parameter</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"param2"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Hello Africa"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/call-template</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/parallel</span>&gt;</pre><p>In the listing above a template <span class="emphasis"><em>print</em></span> is called several times in a parallel container. The parameter values
        will be handled in a global context, so it is quite likely to happen that the template instances influence each other during execution.
        We might get such print messages:</p><pre class="programlisting">2. Hello Europe
2. Hello Africa
3. Hello Africa</pre><p>Index parameters do not fit and the message <span class="emphasis"><em>'Hello Asia'</em></span> is completely gone. This is because templates 
        overwrite parameters to each other as they are executed in parallel at the same time. To avoid this behavior we need to tell the template 
        that it should handle parameters as well as variables in a local context. This will enforce that each template instance is working on a 
        dedicated local context. See the <span class="emphasis"><em>global-context</em></span> attribute that is set to <span class="emphasis"><em>false</em></span> in this example:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">template</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"print"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">global-context</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"false"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;${param1}.${param2}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/template</span>&gt;</pre><p>After that template instances won't influence each other anymore. But notice that variable changes inside the template then do not affect 
        the test case neither.</p></td></tr></table></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="containers"></a>Chapter&nbsp;13.&nbsp;Containers</h2></div></div></div><p>Similar to templates a container element holds one to many test actions. In contrast to the
  template the container appears directly inside the test case action chain, meaning that the container 
  is not referenced by more than one test case.</p><p>Containers execute the embedded test actions in specific logic. This can be an execution in iteration
  for instance. Combine different containers with each other and you will be able to generate very powerful hierarchical
  structures in order to create a complex execution logic. In the following sections some predefined
  containers are described.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="containers-sequential"></a>13.1.&nbsp;Sequential</h2></div></div></div><p>The sequential container executes the embedded test actions in strict sequence. Readers now might search for 
    the difference to the normal action chain that is specified inside the test case. The actual power of sequential containers 
    does show only in combination with other containers like iterations and parallels. We will see this later when handling 
    these containers.</p><p>For now the sequential container seems not very sensational - one might say boring - because it simply groups a pair of test
    actions to sequential execution.</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sequentialTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sequential</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">trace-time</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sleep</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;Hallo TestFramework&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">trace-time</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/sequential</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> sequentialTest() {
    sequential(
        stopTime(),
        sleep(1.0),
        echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Hello Citrus"</span>),
        stopTime()
    );
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="containers-conditional"></a>13.2.&nbsp;Conditional</h2></div></div></div><p>Now we deal with conditional executions of test actions. Nested actions inside a conditional container are
    executed only in case a booleand expression evaluates to true. Otherwise the container execution is not performed at all.</p><p>See some example to find out how it works with the conditional expression string.</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"conditionalTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"index"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"5"</span>/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"shouldSleep"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;

    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">conditional</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">expression</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${index} = 5"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sleep</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">seconds</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"10"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/conditional</span>&gt;

        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">conditional</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">expression</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${shouldSleep}"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sleep</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">seconds</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"10"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/conditional</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> conditionalTest() {
    variable(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"index"</span>, 5);
    variable(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"shouldSleep"</span>, true);

    conditional(
        sleep(10000L)
    ).when(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"${index} = 5"</span>);

    conditional(
      sleep(10000L)
    ).when(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"${shouldSleep}"</span>);
}</pre><p>The nested sleep action is executed in case the variable ${index} is equal to the value '5'. This conditional execution of test actions
    is useful when dealing with different test environments such as different operating systems for instance. The conditional container also supports
    expressions that evaluate to the character sequence "true" or "false" as shown in the ${shouldSleep} example.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="containers-parallel"></a>13.3.&nbsp;Parallel</h2></div></div></div><p>Parallel containers execute the embedded test actions concurrent to each other. Every
    action in this container will be executed in a separate Java Thread. Following example should
    clarify the usage:</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"parallelTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">parallel</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sleep</span>/&gt;
            
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sequential</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sleep</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;1&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/sequential</span>&gt;
            
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;2&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
            
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;3&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
            
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">iterate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">condition</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"i lt= 5"</span> 
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">index</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"i"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;10&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/iterate</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/parallel</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> paralletTest() {
    parallel(
        sleep(), 
        sequential(
            sleep(),
            echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"1"</span>)
        ),
        echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"2"</span>),
        echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"3"</span>),
        iterate(
            echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"10"</span>)
        ).condition(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"i lt= 5"</span>).index(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"i"</span>)
    );
}</pre><p>So the normal test action processing would be to execute one action after another. As the first 
    action is a sleep of five seconds, the whole test processing would stop and wait for 5 seconds. Things 
    are different inside the parallel container. Here the descending test actions will not wait but execute
    at the same time.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Note that containers can easily wrap other containers. The example shows a simple combination of
      sequential and parallel containers that will archive a complex execution logic. Actions inside the sequential
      container will execute one after another. But actions in parallel will be executed at the same time.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="containers-iterate"></a>13.4.&nbsp;Iterate</h2></div></div></div><p>Iterations are very powerful elements when describing complex logic. The container executes the embedded actions 
    several times. The container will continue with looping as long as the defined breaking condition string evaluates to 
    <code class="literal">true</code>. In case the condition evaluates to <code class="literal">false</code> the iteration will break an finish execution.</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"iterateTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">iterate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">index</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"i"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">condition</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"i lt 5"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;index is: ${i}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/iterate</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> iterateTest() {
    iterate(
        echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"index is: ${i}"</span>)
    ).condition(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"i lt 5"</span>).index(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"i"</span>);
}</pre><p>The attribute "index" automatically defines a new variable that holds the actual loop index 
    starting at "1". This index variable is available as a normal variable inside the iterate container. Therefore it is possible
    to print out the actual loop index in the echo action as shown in the above example.</p><p>The condition string is mandatory and describes the actual end of the loop. In iterate containers the loop
    will break in case the condition evaluates to <code class="literal">false</code>.</p><p>The condition string can be any Boolean expression and supports several operators:</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p>lt (lower than)</p></li><li style="list-style-type: circle"><p>lt= (lower than equals)</p></li><li style="list-style-type: circle"><p>gt (greater than)</p></li><li style="list-style-type: circle"><p>gt= (greater than equals)</p></li><li style="list-style-type: circle"><p>= (equals)</p></li><li style="list-style-type: circle"><p>and (logical combining of two Boolean values)</p></li><li style="list-style-type: circle"><p>or (logical combining of two Boolean values)</p></li><li style="list-style-type: circle"><p>() (brackets)</p></li></ul></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>It is very important to notice that the condition is evaluated before the very first iteration takes place. 
      The loop therefore can be executed 0-n times according to the condition value.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="containers-repeat"></a>13.5.&nbsp;Repeat until true</h2></div></div></div><p>Quite similar to the previously described iterate container this repeating container will execute its actions in
    a loop according to an ending condition. The condition describes a Boolean expression using
    the operators as described in the previous chapter.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The loop continues its work until the provided condition evaluates to true. It is very important to notice that the
      repeat loop will execute the actions before evaluating the condition. This means the actions get executed
      1-n times.</p></td></tr></table></div><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"iterateTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">repeat-until-true</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">index</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"i"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">condition</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"(i = 3) or (i = 5)"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;index is: ${i}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/repeat-until-true</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> repeatTest() {
    repeat(echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"index is: ${i}"</span>))
        .until(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"(i gt 5) or (i = 3)"</span>)
        .index(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"i"</span>);
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="containers-repeat-onerror"></a>13.6.&nbsp;Repeat on error until true</h2></div></div></div><p>The next looping container is called repeat-on-error-until-true. This container repeats a group of actions 
    in case one embedded action failed with error. In case of an error inside the container the loop will try 
    to execute <code class="literal">all</code> embedded actions again in order to seek for overall success. The execution continues
    until all embedded actions were processed successfully <code class="literal">or</code> the ending condition evaluates to true and the
    error-loop will lead to final failure.</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"iterateTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">repeat-onerror-until-true</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">index</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"i"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">condition</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"i = 5"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;index is: ${i}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">fail</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/repeat-onerror-until-true</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> repeatOnErrorTest() {
    repeatOnError(
        echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"index is: ${i}"</span>),
        fail(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Force loop to fail!"</span>)
    ).until(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"i = 5"</span>).index(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"i"</span>);
}</pre><p>In the code example the error-loop continues four times as the &lt;fail&gt; action definitely fails the test.
    During the fifth iteration The condition "i=5" evaluates to true and the loop breaks its processing leading to a
    final failure as the test actions were not successful.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The overall success of the test case depends on the error situation inside the repeat-onerror-until-true container. In case 
        the loop breaks because of failing actions and the loop will discontinue its work the whole test case is failing too. The error loop
        processing is successful in case all embedded actions were not raising any errors during an iteration.</p></td></tr></table></div><p>The repeat-on-error container also offers an automatic sleep mechanism. This auto-sleep property will force the container to
    wait a given amount of time before executing the next iteration. We used this mechanism a lot when validating database entries. Let's say
    we want to check the existence of an order entry in the database. Unfortunately the system under test is not very well performing and may
    need some time to store the new order. This amount of time is not predictable, especially when dealing with different hardware on our test 
    environments (local testing vs. server testing). Following from that our test case may fail unpredictable only because of runtime 
    conditions.</p><p>We can avoid unstable test cases that are based on these runtime conditions with the auto-sleep functionality.</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">repeat-onerror-until-true</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">auto-sleep</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"1000"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">condition</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"i = 5"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">index</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"i"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sql</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">datasource</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testDataSource"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">statement</span>&gt;
              SELECT COUNT(1) AS CNT_ORDERS 
              FROM ORDERS 
              WHERE CUSTOMER_ID='${customerId}'
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/statement</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">column</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"CNT_ORDERS"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"1"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/sql</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/repeat-onerror-until-true</span>&gt;</pre><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> repeatOnErrorTest() {
    repeatOnError(
        query(testDataSource)
            .statement(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"SELECT COUNT(1) AS CNT_ORDERS FROM ORDERS WHERE CUSTOMER_ID='${customerId}'"</span>)
            .validate(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"CNT_ORDERS"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"1"</span>)
    ).until(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"i = 5"</span>).index(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"i"</span>).autoSleep(1000);
}</pre><p>We surrounded the database check with a repeat-onerror container having the auto-sleep property set to 1000 milliseconds. The repeat container
    will try to check the database up to five times with an automatic sleep of 1 second before every iteration. This gives the system under test
    up to five seconds time to store the new entry to the database. The test case is very stable and just fits to the hardware environment. On slow
    test environments the test may need several iterations to successfully read the database entry. On very fast environments the test may succeed
    right on the first try.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>We changed auto sleep time from seconds to milliseconds with Citrus 2.0 release. So if you are coming from previous Citrus versions
      be sure to now use proper millisecond values.</p></td></tr></table></div><p>So fast environments are not slowed down by static sleep operations and slower environments are still able to execute this test case
    with high stability.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="finally"></a>Chapter&nbsp;14.&nbsp;Finally section</h2></div></div></div><p>This chapter deals with a special section inside the test case that is executed even in case errors
    did occur during the test. Lets say you have started a Jetty web server instance at the beginning of the 
    test case and you need to shutdown the server when the test has finished its work. Or as a second example
    imagine that you have prepared some data inside the database at the beginning of your test and 
    you want to make sure that the data is cleaned up at the end of the test case.</p><p>In both situations we might run into some problems when the test failed. 
    We face the problem that the whole test case will terminate immediately in case of errors. Cleanup tasks 
    at the end of the test action chain may not be executed correctly.</p><p>Dirty states inside the database or still running server instances then might cause problems for 
    following test cases. To avoid this problems you should use the finally block of the test case. The &lt;finally&gt; 
    section contains actions that are executed even in case the test fails. Using this strategy the database 
    cleaning tasks mentioned before will find execution in every case (success or failure).</p><p>The following example shows how to use the finally section at the end of a test:</p><p><span class="emphasis"><em>XML DSL</em></span></p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"finallyTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"orderId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:randomNumber(5)"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"date"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:currentDate('dd.MM.yyyy')"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sql</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">datasource</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testDataSource"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">statement</span>&gt;
                INSERT INTO ORDERS VALUES (${orderId}, 1, 1, '${date}')
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/statement</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/sql</span>&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                ORDER creation time: ${date}
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">finally</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">sql</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">datasource</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testDataSource"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">statement</span>&gt;
              DELETE FROM ORDERS WHERE ORDER_ID='${orderId}'
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/statement</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/sql</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/finally</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>In the example the first action creates an entry in the database using an <code class="literal">INSERT</code> statement. 
    To be sure that the entry in the database is deleted after the test, the finally section contains the respective 
    <code class="literal">DELETE</code> statement that is always executed regardless the test case state (successful or failed).</p><p>Of course you can also use the finally block in the Java test case DSL. Find following example to see how it works:</p><p><span class="emphasis"><em>Java DSL</em></span></p><pre class="programlisting">@CitrusTest
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> finallySectionTest() {
    variable(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"orderId"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"citrus:randomNumber(5)"</span>);
    variable(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"date"</span>, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"citrus:currentDate('dd.MM.yyyy')"</span>);

    sql(dataSource)
        .statement(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"INSERT INTO ORDERS VALUES (${orderId}, 1, 1, '${date}')"</span>);
    
    echo(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"ORDER creation time: citrus:currentDate('dd.MM.yyyy')"</span>);
    
    doFinally(
        sql(dataSource).statement(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"DELETE FROM ORDERS WHERE ORDER_ID='${orderId}'"</span>)
    );
}</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">Java developers might ask why not use try-finally Java block instead? The answer is simple yet very important to understand. The <span class="emphasis"><em>@CitrusTest</em></span>
    annotated method is called at design time of the test case. The method builds the test case afterwards the test is executed at runtime. This means that a try-finally
    block within the <span class="emphasis"><em>@CitrusTest</em></span> annotated method will never perform during the test run but at design time before the test gets executed.
    This is why we have to add the finally section as part of the test case with <span class="emphasis"><em>doFinally()</em></span>.</td></tr></table></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="jms"></a>Chapter&nbsp;15.&nbsp;JMS support</h2></div></div></div><p>Citrus provides support for sending and receiving JMS messages. We have to separate between synchronous and asynchronous
    communication. So in this chapter we explain how to setup JMS message endpoints for synchronous and asynchronous
    outbound and inbound communication</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The JMS components in Citrus are kept in a separate Maven module. If not already done so you have to include the module
        as Maven dependency to your project</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">dependency</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">groupId</span>&gt;com.consol.citrus&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/groupId</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">artifactId</span>&gt;citrus-jms&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/artifactId</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">version</span>&gt;2.2&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/version</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/dependency</span>&gt;</pre><p>Citrus provides a "citrus-jms" configuration namespace and schema definition for JMS related components and features. Include this namespace into your Spring
        configuration in order to use the Citrus JMS configuration elements. The namespace URI and schema location are added to the
        Spring configuration XML file as follows.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">beans</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans"</span>
       <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xsi</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:citrus-jms</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/jms/config"</span>
       <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"
       http://www.springframework.org/schema/beans 
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.citrusframework.org/schema/jms/config
       http://www.citrusframework.org/schema/jms/config/citrus-jms-config.xsd"</span>&gt;
       
    [...]
    
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/beans</span>&gt;</pre><p>After that you are able to use customized Citrus XML elements in order to define the Spring beans.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jms-endpoints"></a>15.1.&nbsp;JMS endpoints</h2></div></div></div><p>By default Citrus JMS endpoints are asynchronous. So let us first of all deal with asynchronous messaging which
        means that we will not wait for any response message after sending or receiving a message.</p><p>The test case itself should not know about JMS transport details like queue names or connection credentials. This information is stored in the
        endpoint component configuration that lives in the basic Spring configuration file in Citrus. So let us have a look at a simple JMS message endpoint
        configuration in Citrus.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-jms:endpoint</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloServiceQueueEndpoint"</span>
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Citrus.HelloService.Request.Queue"</span>
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">timeout</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"10000"</span>/&gt;</pre><p>The endpoint component receives an unique id and a JMS destination name. This can be a queue or topic destination. We will deal with JMS topics later on.
        For now the timeout setting completes our first JMS endpoint component definition.</p><p>The endpoint needs a JMS connection factory for connecting to a JMS message broker. The connection factory is also added as Spring bean to the Citrus
        application context (citrus-context.xml).</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"connectionFactory"</span> 
         <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.apache.activemq.ActiveMQConnectionFactory"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"brokerURL"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"tcp://localhost:61616"</span> /&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>The JMS connection factory receives the JMS message broker URL and is able to hold many other connection specific options.
        In this example we use the Apache ActiveMQ connection factory implementation as we want to use the ActiveMQ message broker. Citrus works by default with a
        bean id <span class="emphasis"><em>connectionFactory</em></span>. All Citrus JMS component will automatically recognize this connection factory.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Spring makes it very easy to connect to other JMS broker implementations too (e.g. Apache ActiveMQ, TIBCO Enterprise Messaging Service, 
            IBM Websphere MQ). Just add the required connection factory implementation as <span class="emphasis"><em>connectionFactory</em></span> bean.</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>All of the Citrus JMS endpoint components will automatically look for a bean named <span class="emphasis"><em>connectionFactory</em></span> by default.
            You can use the <span class="emphasis"><em>connection-factory</em></span> endpoint attribute in order to use another connection factory instance with different bean
            names.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-jms:endpoint</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloServiceQueueEndpoint"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Citrus.HelloService.Request.Queue"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">connection-factory</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myConnectionFacotry"</span>/&gt;</pre><p>As an alternative to that you may want to use a special Spring jms template implementation as custom bean in your endpoint.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-jms:endpoint</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloServiceQueueEndpoint"</span>
              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Citrus.HelloService.Request.Queue"</span>
              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">jms-template</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myJmsTemplate"</span>/&gt;</pre></td></tr></table></div><p>The endpoint is now ready to be used inside a test case. Inside a test case you can send or receive messages using this endpoint. The test actions
        can reference the JMS endpoint using its identifier. When sending a message the message endpoint creates a JMS message producer and will simply publish
        the message to the defined JMS destination. As the communication is asynchronous by default producer does not wait for a synchronous response.</p><p>When receiving a messages with this endpoint the endpoint creates a JMS consumer on the JMS destination. The endpoint then acts as a message driven
        listener. This means that the message consumer connects to the given destination and waits for messages to arrive.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Besides the destination-name attribute you can also provide a reference to a destination implementation.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-jms:endpoint</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloServiceQueueEndpoint"</span>
                                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloServiceQueue"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">amq:queue</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloServiceQueue"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">physicalName</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Citrus.HelloService.Request.Queue"</span>/&gt;</pre><p>The destination attribute references to a JMS destination object in the Spring application context. In the example above we used the ActiveMQ queue destination
            component. The destination reference can also refer to a JNDI lookup for instance.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jms-sync-endpoints"></a>15.2.&nbsp;JMS synchronous endpoints</h2></div></div></div><p>When using synchronous message endpoints Citrus will manage a reply destination for receiving a synchronous response message on the reply destination. The following
        figure illustrates that we now have two destinations in our communication scenario.</p><div class="mediaobject" align="center"><img src="images/figure_006.jpg" align="middle"></div><p>The synchronous message endpoint component is similar to the asynchronous brother that we have discussed before. The only difference is that the endpoint will automatically manage
        a reply destination behind the scenes. By default Citrus uses temporary reply destinations that get automatically deleted after the communication handshake is done. Again we need to use a
        JMS connection factory in the Spring XML configuration as the component need to connect to a JMS message broker.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-jms:sync-endpoint</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloServiceSyncEndpoint"</span>
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Citrus.HelloService.InOut.Queue"</span>
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">timeout</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"10000"</span>/&gt;</pre><p>The synchronous component defines a target destination which again is either a queue or topic destination. If nothing else is defined the endpoint will create temporary reply destinations
        on its own. When the endpoint has sent a message it waits synchronously for the response message to arrive on the reply destination. You can receive this reply message in your test case by referencing
        this same endooint in a receive test action. In case no reply message arrives in time a message timeout error is raised respectively.</p><p>See the following example test case which references the synchronous message endpoint in its send and receive test action in order to send out a message and wait for the synchronous
        response.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"synchronousMessagingTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloServiceSyncEndpoint"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
                  [...]
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;
        
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloServiceSyncEndpoint"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
                  [...]
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>We initiated the synchronous communication by sending a message on the synchronous endpoint. The second step then receives the synchronous message on the temporary reply destination that was automatically created
        for us.</p><p>If you rather want to define a static reply destination you can do so, too. The static reply destination is not deleted after communication handshake. You may need to work with message selectors then in order to pick
        the right response message that belongs to a specific communication handshake. You can define a static reply destination on the synchronous endpoint component as follows.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-jms:sync-endpoint</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloServiceSyncEndpoint"</span>
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Citrus.HelloService.InOut.Queue"</span>
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">reply-destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Citrus.HelloService.Reply.Queue"</span>
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">timeout</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"10000"</span>/&gt;</pre><p>Instead of using the <span class="emphasis"><em>reply-destination-name</em></span> feel free to use the destination reference with <span class="emphasis"><em>reply-destination</em></span> attribute. Again you can use a JNDI lookup then to reference a destination object.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>Be aware of permissions that are mandatory for creating temporary destinations. Citrus tries to create temporary queues
          on the JMS message broker. Following from that the Citrus JMS user has to have the permission to do so. 
          Be sure that the user has the sufficient rights when using temporary reply destinations.</p></td></tr></table></div><p>Up to now we have sent a message and waited for a synchronous response in the next step. Now it is also possible to switch the directions of send and receive actions. Then we have the situation where Citrus receives a JMS message first and
        then Citrus is in charge of providing a proper synchronous response message to the initial sender.</p><div class="mediaobject" align="center"><img src="images/figure_007.jpg" align="middle"></div><p>In this scenario the foreign message producer has stored a dynamic JMS reply queue destination to the JMS header. So Citrus has to send the reply message to this specific reply destination, which is dynamic of course. Fortunately the heavy lift is done
        with the JMS message endpoint and we do not have to change anything in our configuration. Again we just define a synchronous message endpoint in the application context.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-jms:sync-endpoint</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloServiceSyncEndpoint"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Citrus.HelloService.InOut.Queue"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">timeout</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"10000"</span>/&gt;</pre><p>Now the only thing that changes here is that we first receive a message in our test case on this endpoint. The second step is a send message action that references this same endpoint and we are done. Citrus automatically manages the reply destinations
        for us.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"synchronousMessagingTest"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloServiceSyncEndpoint"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
                  [...]
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;

        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloServiceSyncEndpoint"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
                  [...]
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jms-topics"></a>15.3.&nbsp;JMS topics</h2></div></div></div><p>Up to now we have used JMS queue destinations on our endpoints. Citrus is also able to connect to JMS topic destinations.
        In contrary to JMS queues which represents the <span class="emphasis"><em>point-to-point</em></span> communication JMS topics use <span class="emphasis"><em>publish-subscribe</em></span> mechanism in order to
        spread messages over JMS. A JMS topic producer publishes messages to the topic, while the topic accepts multiple message subscriptions and delivers the message to all subscribers.</p><p>The Citrus JMS endpoints offer the attribute <span class="emphasis"><em>'pub-sub-domain'</em></span>. Once this attribute is set to <span class="emphasis"><em>true</em></span> Citrus will use JMS topics instead of
        queue destinations. See the following example where the publish-subscribe attribute is set to true in JMS message endpoint components.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-jms:endpoint</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloServiceQueueEndpoint"</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloServiceQueue"</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">pub-sub-domain</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>/&gt;</pre><p>When using JMS topics you will be able to subscribe several test actions to the topic destination and receive a message
        multiple times as all subscribers will receive the message.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>It is very important to keep in mind that Citrus does not deal with durable subscribers. This means that messages that were
            sent in advance to the message subscription are not delivered to the message endpoint. So racing conditions may cause problems when using
            JMS topic endpoints in Citrus. Be sure to let Citrus subscribe to the topic before messages are sent to it. Otherwise you may loose some messages
            that were sent in advance to the subscription.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jms-headers"></a>15.4.&nbsp;JMS message headers</h2></div></div></div><p>The JMS specification defines a set of special message header entries that can go into your JMS message. These JMS headers are stored differently in a JMS message
        header than other custom header entries do. Therefore these special header values should be set in a special syntax that we discuss in the next paragraphs.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_jms_correlationId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_jms_messageId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${messageId}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_jms_redelivered"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${redelivered}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_jms_timestamp"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${timestamp}"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;</pre><p>As you see all JMS specific message headers use the <span class="emphasis"><em>citrus_jms_</em></span> prefix. This prefix comes from Spring Integration message header mappers that
        take care of setting those headers in the JMS message header properly.</p><p>Typing of message header entries may also be of interest in order to meet the JMS standards of typed message headers. For instance the following message header 
        is of type double and is therefore transferred via JMS as a double value.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"amount"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"19.75"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"double"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jms-soap"></a>15.5.&nbsp;SOAP over JMS</h2></div></div></div><p>When sending SOAP messages you have to deal with proper envelope, body and header construction. In Citrus you can add a special message converter that performs the heavy lift for you.
        Just add the message converter to the JMS endpoint as shown in the next program listing:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-jms:endpoint</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloServiceSoapJmsEndpoint"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Citrus.HelloService.Request.Queue"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message-converter</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapJmsMessageConverter"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapJmsMessageConverter"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.jms.message.SoapJmsMessageConverter"</span>/&gt;</pre><p>With this message converter you can skip the SOAP envelope completely in your test case. You just deal with the message body payload and the header entries. The rest is done by the message converter.
        So you get proper SOAP messages on the producer and consumer side.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="http"></a>Chapter&nbsp;16.&nbsp;HTTP REST support</h2></div></div></div><p>REST APIs have gained more and more significance regarding client-server interfaces. The REST client is nothing but a HTTP client sending
    HTTP requests usually in JSON data format to a HTTP server. As HTTP is a synchronous protocol by nature the client receives the server response synchronously.
    Citrus is able to connect with HTTP services and test REST APIs on both client and server side with a powerful JSON message data support. In the next sections you will learn
    how to invoke HTTP services as a client and how to handle REST HTTP requests in a test case. We deal with setting up a HTTP server in order to
    accept client requests and provide proper HTTP responses with GET, PUT, DELETE or POST request method.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The http components in Citrus are kept in a separate Maven module. So you should add the module
          as Maven dependency to your project accordingly.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">dependency</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">groupId</span>&gt;com.consol.citrus&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/groupId</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">artifactId</span>&gt;citrus-http&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/artifactId</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">version</span>&gt;2.2&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/version</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/dependency</span>&gt;</pre><p>As Citrus provides a customized HTTP configuration schema for the Spring application context configuration files we have to add name to the top level
        <span class="emphasis"><em>beans</em></span> element. Simply include the http-config namespace in the configuration XML files as follows.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">beans</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans"</span>
   <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xsi</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
   <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:citrus</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/config"</span>
   <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:citrus-http</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/http/config"</span>
   <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"
   http://www.springframework.org/schema/beans 
   http://www.springframework.org/schema/beans/spring-beans.xsd
   http://www.citrusframework.org/schema/config 
   http://www.citrusframework.org/schema/config/citrus-config.xsd
   http://www.citrusframework.org/schema/http/config 
   http://www.citrusframework.org/schema/http/config/citrus-http-config.xsd"</span>&gt;
       
    [...]
    
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/beans</span>&gt;</pre><p>Now we are ready to use the customized Citrus HTTP configuration elements with the
        citrus-http namespace prefix.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="http-client"></a>16.1.&nbsp;HTTP REST client</h2></div></div></div><p>On the client side we have a simple HTTP message client component connecting to the server. The <font color="red">&lt;b&gt;request-url&lt;/b&gt;</font> attribute defines the HTTP server
        endpoint URL to connect to. As usual you can reference this client in your test case in order to send and receive messages. Citrus as client waits for the
        response message from server. After that the response message goes through the validation process as usual. Let us see how a Citrus HTTP client component looks like:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-http:client</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloHttpClient"</span>
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">request-url</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://localhost:8080/hello"</span>
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">request-method</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"GET"</span>
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">content-type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"application/xml"</span>
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">timeout</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"60000"</span>/&gt;</pre><p>The <span class="emphasis"><em>request-method</em></span> defines the HTTP method to use. In addition to that we can specify the content-type of the request we are about to send.
        The client builds the HTTP request and sends it to the HTTP server. While the client is waiting for the synchronous HTTP response to arrive we are able to poll several
        times for the response message in our test case. As usual aou can use the same client endpoint in your test case to send and receive messages synchronously. In case the reply
        message comes in too late according to the timeout settings a respective timeout error is raised.</p><p>The request method is statically set to <span class="emphasis"><em>GET</em></span> in the example above. You can also overwrite the HTTP request method inside the
        sending test action which gives more flexibility. Use something like this in your test:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloHttpClient"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">TestMessage</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Text</span>&gt;Hello HttpServer&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Text</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/TestMessage</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_http_method"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"POST"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Citrus uses the Spring REST template mechanism for sending out HTTP requests. This means you have great customizing opportunities with a special REST
        template configuration. You can think of basic HTTP authentication, read timeouts and special message factory implementations. Just use the custom REST template
        attribute in client configuration like this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-http:client</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloHttpClient"</span>
                               <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">request-url</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://localhost:8080/hello"</span>
                               <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">request-method</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"GET"</span>
                               <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">content-type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"text/plain"</span>
                               <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">rest-template</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"customizedRestTemplate"</span>/&gt;
                               
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">!-- Customized rest template --</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"customizedRestTemplate"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.web.client.RestTemplate"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"messageConverters"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">util:list</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"converter"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.http.converter.StringHttpMessageConverter"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"supportedMediaTypes"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">util:list</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"types"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;text/plain&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/util:list</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/util:list</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"errorHandler"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">!-- Custom error handler --</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"requestFactory"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.http.client.HttpComponentsClientHttpRequestFactory"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"readTimeout"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"9000"</span> /&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
        </pre></td></tr></table></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>And another tip for you regarding dynamic endpoint URI in HTTP client usage. Similar to the endpoint resolving mechanism in SOAP sending action you can dynamically set
        the called endpoint URI on HTTP the client endpoint. By default Citrus will check a specific header entry for dynamic endpoint URI which is simply defined for each message sending action
        inside the test.</p><p>The <span class="emphasis"><em>dynamicEndpointResolver</em></span> bean must implement the EndpointUriResolver interface in order to resolve
          dynamic endpoint uri values. Citrus offers a default implementation, the <span class="emphasis"><em>DynamicEndpointUriResolver</em></span>, which
          uses a specific message header for setting dynamic endpoint uri. The message header needs to specify the header
          <span class="emphasis"><em>citrus_endpoint_uri</em></span> with a valid request uri.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_endpoint_uri"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://localhost:8080/customers/${customerId}"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;</pre><p>The specific send action above will send its message to the dynamic endpoint (http://localhost:8080/customers/${customerId}) which is set in the header <span class="emphasis"><em>citrus_endpoint_uri</em></span>. 
        As you can see the endpoint contains a variable entry so you can reuse the same HTTP message client with different endpoint URI. This is essential when calling RESTful WebServices where the
        URI contains parameters, identifiers and modifiers.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="http-server"></a>16.2.&nbsp;HTTP REST server</h2></div></div></div><p>The HTTP client was quite easy and straight forward. Receiving HTTP messages is a little bit more complicated because Citrus has to provide server functionality listening on a local port for client
        connections. Therefore Citrus offers an embedded HTTP server which is capable of handling incoming HTTP requests. Once a client connection is accepted the HTTP server must also provide a proper HTTP response
        to the client. In the next few lines you will see how to simulate server side HTTP REST service with Citrus.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-http:server</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloHttpServer"</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">port</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"8080"</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">auto-start</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">resource-base</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"src/citrus/resources"</span>/&gt;</pre><p>Citrus uses an embedded Jetty server that will automatically start when the Spring application context is loaded (auto-start="true"). The basic connector is listening on
        port <span class="emphasis"><em>8080</em></span> for requests. Test cases can interact with this server instance via message channels by default. The server provides an inbound channel that holds incoming request messages. The
        test case can receive those requests from the channel with a normal receive test action. In a second step the test case can provide a synchronous response message as reply which will be automatically sent back
        to the HTTP client as response.</p><div class="mediaobject" align="center"><img src="images/figure_008.jpg" align="middle"></div><p>The figure above shows the basic setup with inbound channel and reply channel. You as a tester should not worry about this to much. By default you as a tester just use the server as synchronous endpoint
        in your test case. This means that you simply receive a message from the server and send a response back.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpServerTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloHttpServer"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
                  [...]
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;

        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloHttpServer"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
                  [...]
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>As you can see we reference the server id in both receive and send actions. The Citrus server instance will automatically send the response back to the calling HTTP client. In most cases this is what you need to
        simulate a HTTP server instance in Citrus. Of course we have some more customization possibilities that we will go over right now. This is optional of course so you can also skip the next topics on endpoint adapters if
        you are happy with just what you have learned about the HTTP server component in Citrus.</p><p>The HTTP server component by default uses the channel endpoint adapter in order to forward all incoming requests to an in memory message channel. This is done completely behind the scenes. Those users of you coming
        from older Citrus versions might know how we had to configure this setup somehow verbose in a separate configuration file. But these times have changed as Citrus configuration has become a lot easier in this manner. So now
        the test case does not worry about that settings on the server and just uses the server id reference as synchronous endpoint.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>The default channel endpoint adapter automatically creates an inbound message channel where incoming messages are stored to internally. So if you need to clean up a server that has already stored some incoming messages
            you can do this easily by purging the internal message channel. The message channel follows a naming convention <span class="emphasis"><em>{serverName}.inbound</em></span> where <span class="emphasis"><em>{serverName}</em></span> is the Spring bean name of the Citrus server
            endpoint component. If you purge this internal channel in a before test nature you are sure that obsolete messages on a server instance get purged before each test is executed.</p></td></tr></table></div><p>However we do not want to loose the great extendability and customizing capabilities of the Citrus server component. This is why you can optionally define the endpoint adapter implementation used by the Citrus HTTP server. We
        provide several message endpoint adapter implementations for different simulation strategies. With these endpoint adapters you should be able to generate proper response messages for the client in various ways. Before we have a closer
        look at the different adapter implementations we want to show how you can set a custom endpoint adapter on the server component.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-http:server</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloHttpServer"</span>
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">port</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"8080"</span>
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">auto-start</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint-adapter</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"emptyResponseEndpointAdapter"</span>
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">resource-base</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"src/citrus/resources"</span>/&gt;

          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:empty-response-adapter</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"emptyResponseEndpointAdapter"</span>/&gt;</pre><p>With this endpoint adapter configuration above we change the Citrus server behavior from scratch. Now the server automatically sends back an empty <span class="emphasis"><em>HTTP 200 OK</em></span> response message every time. Setting a custom endpoint adapter implementation
        with custom logic is easy as defining a custom endpoint adapter Spring bean and reference it in the server attribute. You can read more about endpoint adapters in <a href="#endpoint-adapter" title="Chapter&nbsp;27.&nbsp;Endpoint adapter">Chapter&nbsp;27, <i xmlns:xlink="http://www.w3.org/1999/xlink">Endpoint adapter</i></a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="http-headers"></a>16.3.&nbsp;HTTP headers</h2></div></div></div><p>When dealing with HTTP request/response communication we always deal with HTTP specific headers. The HTTP protocol defines a group of header attributes that both client
        and server need to be able to handle. You can set and validate these HTTP headers in Citrus quite easy. Let us have a look at a client operation in Citrus where some HTTP headers are
        explicitly set before the request is sent out.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpMessageEndpoint"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testRequestMessage</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">text</span>&gt;Hello HttpServer&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/text</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testRequestMessage</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"CustomHeaderId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${custom_header_id}"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Content-Type"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"text/xml"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Accept"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"text/xml,*/*"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;</pre><p>We are able to set custom headers (<span class="emphasis"><em>CustomHeaderId</em></span>) that go directly into the HTTP header section of the request. In addition to that testers can explicitly set HTTP reserved headers
        such as <span class="emphasis"><em>Content-Type</em></span>. Fortunately you do not have to set all headers on your own. Citrus will automatically set the required HTTP headers for the request. So we have the following HTTP request
        which is sent to the server:</p><pre class="programlisting">POST /test HTTP/1.1
Accept: text/xml, */*
Content-Type: text/xml
CustomHeaderId: 123456789
Accept-Charset: macroman
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8091
Content-Length: 175
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testRequestMessage</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">text</span>&gt;Hello HttpServer&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/text</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testRequestMessage</span>&gt;</pre><p>On server side testers are interested in validating the HTTP headers. Within Citrus receive action you simply define the expected header entries. The HTTP specific headers are automatically available for validation
        as you can see in this example:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpServer"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testRequestMessage</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">text</span>&gt;Hello HttpServer&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/text</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testRequestMessage</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"CustomHeaderId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${custom_header_id}"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Content-Type"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"text/xml"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Accept"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"text/xml,*/*"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>The test checks on custom headers and HTTP specific headers to meet the expected values.</p><p>Now that we have accepted the client request and validated the contents we are able to send back a proper HTTP response message. Same thing here with HTTP specific headers. The HTTP protocol defines several headers
        marking the success or failure of the server operation. In the test case you can set those headers for the response message with conventional Citrus header names. See the following example to find out how that works for you.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpServer"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testResponseMessage</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">text</span>&gt;Hello Citrus Client&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/text</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testResponseMessage</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"CustomHeaderId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${custom_header_id}"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Content-Type"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"text/xml"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_http_status_code"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"200"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_http_reason_phrase"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"OK"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;</pre><p>Once more we set the custom header entry (<span class="emphasis"><em>CustomHeaderId</em></span>) and a HTTP reserved header (<span class="emphasis"><em>Content-Type</em></span>) for the response message. On top of this we are able to set the response status for
        the HTTP response. We use the reserved header names <span class="emphasis"><em>citrus_http_status_code</em></span> in order to mark the success of the server operation. With this mechanism we can easily simulate different server behaviour such as HTTP
        error response codes (e.g. 404 - Not found, 500 - Internal error). Let us have a closer look at the generated response message:</p><pre class="programlisting">HTTP/1.1 200 OK
Content-Type: text/xml;charset=UTF-8
Accept-Charset: macroman
Content-Length: 205
Server: Jetty(7.0.0.pre5)
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testResponseMessage</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">text</span>&gt;Hello Citrus Client&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/text</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testResponseMessage</span>&gt;</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>You do not have to set the reason phrase all the time. It is sufficient to only set the HTTP status code. Citrus will automatically add the proper reason phrase for well known HTTP status codes.</p></td></tr></table></div><p>The only thing that is missing right now is the validation of HTTP status codes when receiving the server response in a Citrus test case. It is very easy as you can use the Citrus reserved header names for validation, too.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpClient"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testResponseMessage</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">text</span>&gt;Hello Test Framework&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/text</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testResponseMessage</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"CustomHeaderId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${custom_header_id}"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_http_status_code"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"200"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_http_version"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"HTTP/1.1"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_http_reason_phrase"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"OK"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>Up to now we have used some of the basic Citrus reserved HTTP header names (citrus_http_status_code, citrus_http_version, citrus_http_reason_phrase). In HTTP RESTful WebServices some more header names are essential ofr
        validation. These are request attributes like query parameters, context path and request URI. The Citrus server side REST message controller will automatically add all this information to the message header for you. So
        all you need to do is validate the header entries in your test.</p><p>The next example receives a HTTP GET method request on server side. Here the GET request does not have any message payload, so the validation just works on the information given in the message header. We assume
        the client to call <span class="emphasis"><em>http://localhost:8080/app/users?id=123456789</em></span>. As a tester we need to validate the request method, request URI, context path and the query parameters.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpServer"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Host"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"localhost:8080"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Content-Type"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"text/html"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Accept"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"text/xml,*/*"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_http_method"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"GET"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_http_request_uri"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"/app/users"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_http_context_path"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"/app"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_http_query_params"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"id=123456789"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Be aware of the slight differences in request URI and context path. The context path gives you the web application context path within the servlet container for your web application.
        The request URI always gives you the complete path that was called for this request.</p></td></tr></table></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>Another important thing to notice is the usage of multiple query parameters that are put together using '&amp;' characters (e.g. http://localhost:8080/app/users?id=123456789&amp;name=foo). As the Citrus test case
        is written in XML we have to escape the reserved '&amp;' with &amp;amp; entity (e.g. value="id=123456789&amp;amp;name=test").</p></td></tr></table></div><p>As you can see we are able to validate all parts of the initial request endpoint URI the client was calling. This completes the HTTP header processing within Citrus.
        On both client and server side Citrus is able to set and validate HTTP specific header entries which is essential for simulating HTTP communication.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="http-error-handling"></a>16.4.&nbsp;HTTP error handling</h2></div></div></div><p>So far we have received response messages with HTTP status code <span class="emphasis"><em>200 OK</em></span>. How to deal with server errors like <span class="emphasis"><em>404 Not Found</em></span> or <span class="emphasis"><em>500 Internal server error</em></span>?
        The default HTTP message client error strategy is to propagate server error response messages to the receive action for validation. We simply check on HTTP status code and status text for error validation.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpClient"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testRequestMessage</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">text</span>&gt;Hello HttpServer&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/text</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testRequestMessage</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpClient"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[]]</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_http_status_code"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"403"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_http_reason_phrase"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"FORBIDDEN"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>The message data can be empty depending on the server logic for these error situations. If we receive additional error information as message payload just add validation assertions as usual.</p><p>Instead of receiving such empty messages with checks on HTTP status header information we can change the error strategy in the message sender component in order to automatically raise exceptions
        on response messages other than <span class="emphasis"><em>200 OK</em></span>. Therefore we go back to the HTTP message sender configuration for changing the error strategy.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-http:client</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpClient"</span>
                              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">request-url</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://localhost:8080/test"</span>
                              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">error-strategy</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"throwsException"</span>/&gt;</pre><p>Now we expect an exception to be thrown because of the error response. Following from that we have to change our test case.
        Instead of receiving the error message with receive action we assert the client exception and check on the HTTP status code and status text.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">assert</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">exception</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.web.client.HttpClientErrorException"</span>
           <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"403 Forbidden"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpClient"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testRequestMessage</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">text</span>&gt;Hello HttpServer&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/text</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testRequestMessage</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/assert</span>&gt;</pre><p>Both ways of handling HTTP error messages on client side are valid for expecting the server to raise HTTP error codes. Choose the prefered way according to your test project requirements.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="http-basic-auth-client"></a>16.5.&nbsp;HTTP client basic authentication</h2></div></div></div><p>As client you may have to use basic authentication in order to access a resource on the server. In most cases this will be username/password authentication
        where the credentials are transmitted in the request header section as base64 encoding.</p><p>The easiest approach to set the <span class="emphasis"><em>Authorization</em></span> header for a basic authentication HTTP request would be to set it on your own in the send action definition. Of course you have
        to use the correct basic authentication header syntax with base64 encoding for the username:password phrase. See this simple example.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Authorization"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Basic c29tZVVzZXJuYW1lOnNvbWVQYXNzd29yZA=="</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;</pre><p>Citrus will add this header to the HTTP requests and the server will read the <span class="emphasis"><em>Authorization</em></span> username and password. For more convenient base64 encoding you can also use a Citrus function,
        see <a href="#functions-encode-base64" title="28.23.&nbsp;citrus:encodeBase64()">Section&nbsp;28.23, &#8220;citrus:encodeBase64()&#8221;</a></p><p>Now there is a more comfortable way to set the basic authentication header in all the Citrus requests. As Citrus uses Spring's REST support with the RestTemplate and ClientHttpRequestFactory the
        basic authentication is already covered there in a more generic way. You simply have to configure the basic authentication credentials on the RestTemplate's ClientHttpRequestFactory. Just see the following
        example and learn how to do that.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-http:client</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpClient"</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">request-method</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"POST"</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">request-url</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://localhost:8080/test"</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">request-factory</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"basicAuthFactory"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"basicAuthFactory"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.http.client.BasicAuthClientHttpRequestFactory"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"authScope"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.apache.http.auth.AuthScope"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor-arg</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"localhost"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor-arg</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"8072"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor-arg</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">""</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor-arg</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"basic"</span>/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"credentials"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.apache.http.auth.UsernamePasswordCredentials"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor-arg</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"someUsername"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor-arg</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"somePassword"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>The advantages of this method is obvious. Now all sending test actions that reference the client component will automatically add the basic authentication header.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>Since Citrus has upgraded to Spring 3.1.x the Jakarta commons HTTP client is deprecated with Citrus version 1.2. The formerly used
        UserCredentialsClientHttpRequestFactory is therefore also deprecated and will not continue with next versions. Please update your configuration if you are coming from
        Citrus 1.1 or earlier versions.</p></td></tr></table></div><p>The above configuration results in HTTP client requests with authentication headers properly set for basic authentication. The client request factory takes care on adding the proper
        basic authentication header to each request that is sent with this Citrus message sender. Citrus uses preemtive authentication. The message sender only sends a single request to the server with
        all authentication information set in the message header. The request which determines the authentication scheme on the server is skipped. This is why you have to add some auth scope in the client
        request factory so Citrus can setup an authentication cache within the HTTP context in order to have preemtive authentication.</p><p>As a result of the basic auth client request factory the following example request that is created by the Citrus HTTP client has the <span class="emphasis"><em>Authorization</em></span> header set. This is done
        now automatically for all requests with this HTTP client.</p><pre class="programlisting">POST /test HTTP/1.1
Accept: text/xml, */*
Content-Type: text/xml
Accept-Charset: iso-8859-1, us-ascii, utf-8
Authorization: Basic c29tZVVzZXJuYW1lOnNvbWVQYXNzd29yZA==
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8080
Content-Length: 175
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testRequestMessage</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">text</span>&gt;Hello HttpServer&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/text</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testRequestMessage</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="http-basic-auth-server"></a>16.6.&nbsp;HTTP server basic authentication</h2></div></div></div><p>Citrus as a server can also set basic authentication so clients need to authenticate properly when accessing server resources.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-http:server</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"basicAuthHttpServer"</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">port</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"8090"</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">auto-start</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">resource-base</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"src/citrus/resources"</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">security-handler</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"basicSecurityHandler"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"securityHandler"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.http.security.SecurityHandlerFactory"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"users"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">list</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.http.security.User"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"name"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"password"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"secret"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"roles"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"CitrusRole"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/list</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"constraints"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">map</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">entry</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">key</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"/foo/*"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.http.security.BasicAuthConstraint"</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor-arg</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"CitrusRole"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/entry</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/map</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>We have set a security handler on the server web container with a constraint on all resources with <span class="emphasis"><em>/foo/*</em></span>. Following from that
        the server requires basic authentication for these resources. The granted users and roles are specified within the security handler bean definition. Connecting clients
        have to set the basic auth HTTP header properly using the correct user and role for accessing the Citrus server now.</p><p>You can customize the security handler for your very specific needs (e.g. load users and roles with JDBC from a database). Just have a look at the code base and
        inspect the settings and properties offered by the security handler interface.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>This mechanism is not restricted to basic authentication only. With other settings you can also set up digest or form-based authentication constraints very easy.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="http-servlet-context"></a>16.7.&nbsp;HTTP servlet context customization</h2></div></div></div><p>The Citrus HTTP server uses Spring application context loading on startup. For high customizations you can provide a custom servlet context file which holds all custom
        configurations as Spring beans for the server. Here is a sample servlet context with some basic Spring MVC components and the central HttpMessageController which is responsible for handling
        incoming requests (GET, PUT, DELETE, POST, etc.).</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrusHandlerMapping"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrusMethodHandlerAdapter"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"messageConverters"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">util:list</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"converters"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.http.converter.StringHttpMessageConverter"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"supportedMediaTypes"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">util:list</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;text/xml&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/util:list</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/util:list</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrusHttpMessageController"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.http.controller.HttpMessageController"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"endpointAdapter"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span>
       <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.endpoint.adapter.EmptyResponseEndpointAdapter"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>The beans above are responsible for proper HTTP server configuration. In general you do not need to adjust those beans, but we have the possibility to do so which gives
        us a great customization and extension points. The important part is the endpoint adapter definition inside the HttpMessageController. Once a client request was accepted the
        adapter is responsible for generating a proper response to the client.</p><p>You can add the custom servlet context as file resource to the Citrus HTTP server component. Just use the <span class="emphasis"><em>context-config-location</em></span> attribute as follows:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-http:server</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloHttpServer"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">port</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"8080"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">auto-start</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">context-config-location</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:com/consol/citrus/http/custom-servlet-context.xml"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">resource-base</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"src/citrus/resources"</span>/&gt;</pre></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="soap-webservices"></a>Chapter&nbsp;17.&nbsp;SOAP WebServices</h2></div></div></div><p>SOAP Web Services over HTTP is a widely used communication scenario in modern enterprise applications. A SOAP Web Service client is posting a SOAP request via HTTP to a server.
    SOAP via HTTP is a synchronous message protocol by default so the client is waiting synchronously for the response message. Citrus provides both SOAP client and server components in
    order to meet both directions of this scenario. The components used are very similar to the HTTP components that were have discussed in the sections before.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The SOAP WebService components in Citrus are kept in a separate Maven module. So you should add the module
          as Maven dependency to your project accordingly.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">dependency</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">groupId</span>&gt;com.consol.citrus&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/groupId</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">artifactId</span>&gt;citrus-ws&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/artifactId</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">version</span>&gt;2.2&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/version</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/dependency</span>&gt;</pre><p>In order to use the SOAP WebService support you need to include the specific XML configuration schema provided by Citrus.
        See following XML definition to find out how to include the citrus-ws namespace.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">beans</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans"</span>
       <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xsi</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:citrus</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/config"</span>
       <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:citrus-ws</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/ws/config"</span>
       <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"
       http://www.springframework.org/schema/beans 
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.citrusframework.org/schema/config 
       http://www.citrusframework.org/schema/config/citrus-config.xsd
       http://www.citrusframework.org/schema/ws/config 
       http://www.citrusframework.org/schema/ws/config/citrus-ws-config.xsd"</span>&gt;
       
    [...]
    
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/beans</span>&gt;</pre><p>Now you are ready to use the customized soap configuration elements - all using the citrus-ws prefix -
        in your Spring configuration.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="soap-client"></a>17.1.&nbsp;SOAP client</h2></div></div></div><p>Citrus is able to form a proper SOAP request in order to pass it to the server via HTTP and validate the respective SOAP response message. Let us see how a message client for SOAP
        looks like in the Spring configuration:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-ws:client</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapClient"</span>
                       <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">request-url</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://localhost:8090/test"</span>
                       <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">timeout</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"60000"</span>/&gt;</pre><p>The client component uses the <span class="emphasis"><em>request-url</em></span> in order to access the server resource. The client will automatically build a proper SOAP request message including
        the SOAP envelope, SOAP header and the message payload as SOAP body. This means that you as a tester do not care about SOAP envelope specific logic in the test case. The client endpoint
        component saves the synchronous SOAP response so the test case can receive this message with a normal receive test action.</p><p>In detail you as a tester just send and receive using the same client endpoint reference just as you would do with a synchronous JMS or channel communication. In case no response
        message is available in time according to the timeout settings Citrus raises a timeout error and the test will fail.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>The SOAP client component uses a SoapMessageFactory implementation in order to create the SOAP messages. This is a Spring bean added to the Citrus Spring application context.
            Spring offers several reference implementations as message factories so you can choose one of them (e.g. for SOAP 1.1 or 1.2 implementations).</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">!-- Default SOAP Message Factory (SOAP 1.1) --</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"messageFactory"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.ws.soap.saaj.SaajSoapMessageFactory"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">!-- SOAP 1.2 Message Factory --</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soap12MessageFactory"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.ws.soap.saaj.SaajSoapMessageFactory"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapVersion"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">util:constant</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">static-field</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.ws.soap.SoapVersion.SOAP_12"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>By default Citrus will search for a bean with id <span class="emphasis"><em>'messageFactory'</em></span>. In case you intend to use different identifiers you need to tell the SOAP client component
            which message factory to use:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-ws:client</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapClient"</span>
         <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">request-url</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://localhost:8090/test"</span>
         <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message-factory</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soap12MessageFactory"</span>/&gt;</pre></td></tr></table></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Up to now we have used a static endpoint request url for the SOAP message sender. Besides that we can use dynamic endpoint uri in configuration. We just use an endpoint uri resolver
            instead of the static request url like this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-ws:client</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapClient"</span>
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint-resolver</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"dynamicEndpointResolver"</span> 
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message-factory</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soap12MessageFactory"</span>/&gt;
             
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"dynamicEndpointResolver"</span> 
       <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.endpoint.resolver.DynamicEndpointUriResolver"</span>/&gt;</pre><p>The <span class="emphasis"><em>dynamicEndpointResolver</em></span> bean must implement the EndpointUriResolver interface in order to resolve
             dynamic endpoint uri values. Citrus offers a default implementation, the <span class="emphasis"><em>DynamicEndpointUriResolver</em></span>, which
             uses a specific message header for setting the dynamic endpoint uri for each message. The message header needs to specify the header
             <span class="emphasis"><em>citrus_endpoint_uri</em></span> with a valid request uri. Just like this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_endpoint_uri"</span> 
           <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://localhost:${port}/${context}"</span> /&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;</pre><p>As you can see you can use dynamic test variables then in order to build the request uri to use. The SOAP client evaluates the endpoint uri header and sends the message to this
             server resource. You can use a different uri value then in different test cases and send actions.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="soap-server"></a>17.2.&nbsp;SOAP server</h2></div></div></div><p>Every client need a server to talk to. When receiving SOAP messages we require a web server instance listening on a port. Citrus is using an embedded Jetty server instance in combination
        with the Spring Web Service API in order to accept SOAP request calls asa server. See how the Citrus SOAP server is configured in the Spring configuration.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-ws:server</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloSoapServer"</span>
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">port</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"8080"</span>
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">auto-start</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">resource-base</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"src/citrus/resources"</span>/&gt;</pre><p>The server component is able to start automatically when application starts up. In the example above the server is listening for requests on port <code class="literal">8080</code>. This setup uses the standard
        connector configuration for the Jetty server. For detailed customization the Citrus Jetty server configuration also supports explicit connector configurations (@connector and @connectors attributes).
        For more information please see the Jetty connector documentation.</p><p>Test cases interact with this server instance via message channels by default. The server component provides an inbound channel that holds incoming request messages. The test case can receive those
        requests from the channel with a normal receive test action. In a second step the test case can provide a synchronous response message as reply which will be automatically sent back to the calling SOAP client as response.</p><div class="mediaobject" align="center"><img src="images/figure_010.jpg" align="middle"></div><p>The figure above shows the basic setup with inbound channel and reply channel. You as a tester should not worry about this to much. By default you as a tester just use the server as synchronous endpoint
      in your test case. This means that you simply receive a message from the server and send a response back.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapServerTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloSoapServer"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
                  [...]
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;

        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloSoapServer"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
                  [...]
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>As you can see we reference the server id in both receive and send actions. The Citrus server instance will automatically send the response back to the calling client. In most cases this is what you need to
      simulate a SOAP server instance in Citrus. Of course we have some more customization possibilities that we will go over later on. This customizations are optional so you can also skip the next description on endpoint adapters if
      you are happy with just what you have learned about the SOAP server component in Citrus.</p><p>Just like the HTTP server component the SOAP server component by default uses the channel endpoint adapter in order to forward all incoming requests to an in memory message channel. This is done completely behind the scenes.
      The Citrus configuration has become a lot easier here so you do not have to configure this by default. When nothing else is set the test case does not worry about that settings on the server and just uses the server id reference
      as synchronous endpoint.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>The default channel endpoint adapter automatically creates an inbound message channel where incoming messages are stored to internally. So if you need to clean up a server that has already stored some incoming messages
          you can do this easily by purging the internal message channel. The message channel follows a naming convention <span class="emphasis"><em>{serverName}.inbound</em></span> where <span class="emphasis"><em>{serverName}</em></span> is the Spring bean name of the Citrus server
          endpoint component. If you purge this internal channel in a before test nature you are sure that obsolete messages on a server instance get purged before each test is executed.</p></td></tr></table></div><p>However we do not want to loose the great extendability and customizing capabilities of the Citrus server component. This is why you can optionally define the endpoint adapter implementation used by the Citrus SOAP server. We
      provide several message endpoint adapter implementations for different simulation strategies. With these endpoint adapters you should be able to generate proper SOAP response messages for the client in various ways. Before we have a closer
      look at the different adapter implementations we want to show how you can set a custom endpoint adapter on the server component.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-ws:server</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloSoapServer"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">port</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"8080"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">auto-start</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint-adapter</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"emptyResponseEndpointAdapter"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">resource-base</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"src/citrus/resources"</span>/&gt;

        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:empty-response-adapter</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"emptyResponseEndpointAdapter"</span>/&gt;</pre><p>With this endpoint adapter configuration above we change the Citrus server behavior from scratch. Now the server automatically sends back an empty SOAP response message every time. Setting a custom endpoint adapter implementation
      with custom logic is easy as defining a custom endpoint adapter Spring bean and reference it in the server attribute. You can read more about endpoint adapters in <a href="#endpoint-adapter" title="Chapter&nbsp;27.&nbsp;Endpoint adapter">Chapter&nbsp;27, <i xmlns:xlink="http://www.w3.org/1999/xlink">Endpoint adapter</i></a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="soap-header"></a>17.3.&nbsp;SOAP headers</h2></div></div></div><p>SOAP defines several header variations that we discuss in the following sections. First of all we deal with the special <span class="emphasis"><em>SOAP action</em></span> header. In case we need to set this SOAP action header we simply need to use
        the special header key called <code class="literal">citrus_soap_action</code> in our test. The special header key in combination with a underlying SOAP client endpoint component constructs the SOAP action in the SOAP message as intended.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_soap_action"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sayHello"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;</pre><p>Secondly a SOAP message is able to contain customized SOAP headers. These are key-value pairs where the key is a qualified name (QName) and the value a normal String value.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"{http://www.consol.de/sayHello}h1:Operation"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sayHello"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"{http://www.consol.de/sayHello}h1:Request"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"HelloRequest"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;</pre><p>The key is defined as qualified QName character sequence which has a mandatory XML namespace and a prefix along with a header name. Last not least a SOAP header can contain whole XML fragment values. The next example shows how to
        set these XML fragments as SOAP header in Citrus:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;User</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/sayHello"</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">UserId</span>&gt;123456789&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/UserId</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Handshake</span>&gt;S123456789&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Handshake</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/User</span>&gt;
      ]]&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;</pre><p>You can also use external file resources to set this SOAP header XML fragment as shown in this last example code:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">resource</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:request-soap-header.xml"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;</pre><p>This completes the SOAP header possibilities for sending SOAP messages with Citrus. Of course you can also use these variants in SOAP message header validation. You define expected SOAP headers, SOAP action and XML fragments
        and Citrus will match incoming request to that. Just use <span class="emphasis"><em>citrus_soap_action</em></span> header key in your receiving message action and you validate this SOAP header accordingly.</p><p>When validating SOAP header XML fragments you need to define the whole XML header fragment as expected header data like this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapMessageEndpoint"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;ResponseMessage</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrusframework.org/schema"</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">resultCode</span>&gt;OK&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/resultCode</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ResponseMessage</span>&gt;
          ]]&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;SOAP-ENV:Header</span>
                    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:SOAP-ENV</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://schemas.xmlsoap.org/soap/envelope/"</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">customHeader</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrusframework.org/headerschema"</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">correlationId</span>&gt;${correlationId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/correlationId</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">applicationId</span>&gt;${applicationId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/applicationId</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">trackingId</span>&gt;${trackingId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/trackingId</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">serviceId</span>&gt;${serviceId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/serviceId</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">interfaceVersion</span>&gt;1.0&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/interfaceVersion</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">timestamp</span>&gt;@ignore@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/timestamp</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/customHeader</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SOAP-ENV:Header</span>&gt;
            ]]&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_soap_action"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"doResponse"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>As you can see the SOAP XML header validation can combine header element and XML fragment validation. This is also likely to be used when dealing with WS-Security message headers.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="soap-mime-headers"></a>17.4.&nbsp;SOAP HTTP mime headers</h2></div></div></div><p>Besides the SOAP specific header elements the HTTP mime headers (e.g. Content-Type, Content-Length, Authorization) might be candidates for validation, too.
      When using HTTP as transport layer the SOAP message may define those mime headers. The tester is able to send and validate these headers inside the test case, although these
      HTTP headers are located outside of the SOAP envelope. Let us first of all speak about validating the HTTP mime headers. This feature is not enabled by default. We
      have enable this in our SOAP server configuration.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-ws:server</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloSoapServer"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">port</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"8080"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">auto-start</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">handle-mime-headers</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">resource-base</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"src/citrus/resources"</span>/&gt;</pre><p>With this configuration Citrus will handle all available mime headers and pass those to the test case for normal header validation.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloSoapServer"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SoapMessageRequest</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/sample.xsd"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Operation</span>&gt;Validate mime headers&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Operation</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SoapMessageRequest</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Content-Type"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"text/xml; charset=utf-8"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:receive</span>&gt;</pre><p>The validation of these HTTP mime headers is as usual now that we have enabled the mime header handling in the SOAP server. The transport HTTP headers are available in the header
      just like the normal SOAP header elements do. So you can validate the headers as usual.</p><p>So much for receiving and validating HTTP mime message headers with SOAP communication. Now we want to send special mime headers on client side. We overwrite or add mime
      headers to our sending action. We mark some headers with following prefix <code class="literal">"citrus_http_"</code>. This tells the SOAP client to add these headers to the
      HTTP header section outside the SOAP envelope. Keep in mind that header elements without this prefix go right into the SOAP header section by default.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapClient"</span>&gt;
  [...]
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_http_operation"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"foo"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
  [...]
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:send</span>&gt;</pre><p>The listing above defines a HTTP mime header <span class="emphasis"><em>operation</em></span>. The header prefix <code class="literal">citrus_http_</code> is cut off before the header goes into the HTTP
      header section. With this feature we can decide where exactly our header information is located in our resulting client message.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="soap-keep-envelope"></a>17.5.&nbsp;SOAP Envelope handling</h2></div></div></div><p>By default Citrus will remove the SOAP envelope in message converter. Following from that the Citrus test case is independent from SOAP message formats and is not bothered with handling of SOAP
      envelope at all. This is great in most cases but sometimes it might be mandatory to also see the whole SOAP envelope inside the test case receive action. Therefore you can keep the SOAP envelope for incoming
      messages by configuration on the SOAP server side.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-ws:server</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloSoapServer"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">port</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"8080"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">auto-start</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">keep-soap-envelope</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>/&gt;</pre><p>With this configuration Citrus will handle all available mime headers and pass those to the test case for normal header validation.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloSoapServer"</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Envelope</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:SOAP-ENV</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://schemas.xmlsoap.org/soap/envelope/"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Header</span>/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Body</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SoapMessageRequest</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/sample.xsd"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Operation</span>&gt;Validate mime headers&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Operation</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SoapMessageRequest</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SOAP-ENV:Body</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SOAP-ENV:Envelope</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:receive</span>&gt;</pre><p>So now you are able to validate the whole SOAP envelope as is. This might be of interest in very special cases. As mentioned by default the Citrus server will automatically remove the SOAP envelope and
      translate the SOAP body to the message payload for straight forward validation inside the test cases.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="soap-12"></a>17.6.&nbsp;SOAP 1.2</h2></div></div></div><p>By default Citrus components use SOAP 1.1 version. Fortunately SOAP 1.2 is supported same way. As we already mentioned before the Citrus SOAP components do use a SOAP message factory
      for creating messages in SOAP format.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">!-- SOAP 1.1 Message Factory --</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapMessageFactory"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.ws.soap.saaj.SaajSoapMessageFactory"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapVersion"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">util:constant</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">static-field</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.ws.soap.SoapVersion.SOAP_11"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">!-- SOAP 1.2 Message Factory --</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soap12MessageFactory"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.ws.soap.saaj.SaajSoapMessageFactory"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapVersion"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">util:constant</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">static-field</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.ws.soap.SoapVersion.SOAP_12"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>As you can see the SOAP message factory can either create SOAP 1.1 or SOAP 1.2 messages. This is how Citrus can create both SOAP 1.1 and SOAP 1.2 messages. Of course you can have multiple message
      factories configured in your project. Just set the message factory on a WebService client or server component in order to define which version should be used.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-ws:client</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soap12Client"</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">request-url</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://localhost:8080/echo"</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message-factory</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soap12MessageFactory"</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">timeout</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"1000"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-ws:server</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soap12Server"</span>
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">port</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"8080"</span>
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">auto-start</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message-factory</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soap12MessageFactory"</span>/&gt;</pre><p>By default Citrus components do connect with a message factory called <span class="emphasis"><em>messageFactory</em></span> no matter what SOAP version this factory is using.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="soap-faults"></a>17.7.&nbsp;SOAP faults</h2></div></div></div><p>SOAP faults describe a failed communication in SOAP WebServices world. Citrus is able to send and receive SOAP fault messages. On server side
        Citrus can simulate SOAP faults with fault-code, fault-reason, fault-actor and fault-detail. On client side Citrus is able to handle and validate SOAP faults
        in response messages. The next section describes how to deal with SOAP faults in Citrus.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="soap-fault-send"></a>17.7.1.&nbsp;Send SOAP faults</h3></div></div></div><p>As Citrus simulates SOAP server endpoints you also need to think about sending a SOAP fault to the calling client. In case Citrus receives a SOAP
            request as a server you can respond with a proper SOAP fault if necessary.</p><p>Please keep in mind that we use the citrus-ws extension for sending SOAP faults in our test case, as shown in this very
            simple example:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:send-fault</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloSoapServer"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:fault</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:fault-code</span>&gt;{http://www.citrusframework.org/faults}citrus:TEC-1000&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:fault-code</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:fault-string</span>&gt;Invalid request&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:fault-string</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:fault-actor</span>&gt;SERVER&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:fault-actor</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:fault-detail</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;FaultDetail</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/sayHello.xsd"</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">MessageId</span>&gt;${messageId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/MessageId</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">CorrelationId</span>&gt;${correlationId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/CorrelationId</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ErrorCode</span>&gt;TEC-1000&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ErrorCode</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Text</span>&gt;Invalid request&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Text</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/FaultDetail</span>&gt;
            ]]&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:fault-detail</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:fault</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:header</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_soap_action"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sayHello"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:send-fault</span>&gt;</pre><p>The example generates a simple SOAP fault that is sent back to the calling client. The fault-actor and the fault-detail elements are optional.
            Same with the soap action declared in the special Citrus header <code class="literal">citrus_soap_action</code>. In the sample above the fault-detail data is
            placed inline as XML data. As an alternative to that you can also set the fault-detail via external file resource. Just use the
            <code class="literal">file</code> attribute as fault detail instead of the inline CDATA definition.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:send-fault</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloSoapServer"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:fault</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:fault-code</span>&gt;{http://www.citrusframework.org/faults}citrus:TEC-1000&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:fault-code</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:fault-string</span>&gt;Invalid request&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:fault-string</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:fault-actor</span>&gt;SERVER&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:fault-actor</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:fault-detail</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:myFaultDetail.xml"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:fault</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:header</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_soap_action"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sayHello"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:send-fault</span>&gt;</pre><p>The generated SOAP fault looks like follows:</p><pre class="programlisting">HTTP/1.1 500 Internal Server Error
Accept: text/xml, text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2
SOAPAction: "sayHello"
Content-Type: text/xml; charset=utf-8
Content-Length: 680
Server: Jetty(7.0.0.pre5)

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Envelope</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:SOAP-ENV</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://schemas.xmlsoap.org/soap/envelope/"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Header</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Body</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Fault</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">faultcode</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:citrus</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/faults"</span>&gt;citrus:TEC-1000&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/faultcode</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">faultstring</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xml:lang</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"en"</span>&gt;Invalid request&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/faultstring</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">detail</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">FaultDetail</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/sayHello.xsd"</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">MessageId</span>&gt;9277832563&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/MessageId</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">CorrelationId</span>&gt;4346806225&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/CorrelationId</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ErrorCode</span>&gt;TEC-1000&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ErrorCode</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Text</span>&gt;Invalid request&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Text</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/FaultDetail</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/detail</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SOAP-ENV:Fault</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SOAP-ENV:Body</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SOAP-ENV:Envelope</span>&gt;</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top">Notice that the send action uses a special XML namespace (ws:send). This ws namespace belongs to the Citrus WebService extension and
            adds SOAP specific features to the normal send action. When you use such ws extensions you need to define the additional namespace in your test case.
            This is usually done in the root <span class="emphasis"><em>&lt;spring:beans&gt;</em></span> element where we simply declare the citrus-ws specific namespace like follows.

                <pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">spring:beans</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/testcase"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:spring</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:ws</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/ws/testcase"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.citrusframework.org/schema/testcase
    http://www.citrusframework.org/schema/testcase/citrus-testcase.xsd
    http://www.citrusframework.org/schema/ws/testcase
    http://www.citrusframework.org/schema/ws/testcase/citrus-ws-testcase.xsd"</span>&gt;</pre></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="soap-fault-receive"></a>17.7.2.&nbsp;Receive SOAP faults</h3></div></div></div><p>In case you receive SOAP response messages as a client endpoint you may need to handle and validate SOAP faults
            in error situations. Citrus can validate SOAP faults with fault-code, fault-actor, fault-string and fault-detail values.</p><p>As a client we send out a request and receive a SOAP fault as response. By default the client sending action in Citrus
            throws a specific exception when the SOAP response is a SOAP fault element. This exception is called <code class="literal">SoapFaultClientException</code>
            coming from the Spring API. You as a tester can assert this kind of exception in a test case in order to expect the SOAP error.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">assert</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.ws.soap.client.SoapFaultClientException"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapClient"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SoapFaultForcingRequest</span>
                  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/soap"</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Message</span>&gt;This is invalid&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SoapFaultForcingRequest</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/assert</span>&gt;</pre><p>The SOAP message sending action is surrounded by a simple assert action. The asserted exception class is the
            <code class="literal">SoapFaultClientException</code> that we have mentioned before. This means that the test expects the exception to be thrown during the communication.
            In case the exception is missing the test is fails.</p><p>So far we have used the Citrus core capabilities of asserting an exception. This basic assertion test action is not able to offer direct access to the SOAP
            fault-code and fault-string values for validation. The basic assert action simply has no access to the actual SOAP fault elements. Fortunately we can use the
            <span class="emphasis"><em>citrus-ws</em></span> namespace again which offers a special assert action implementation especially designed for SOAP faults in this case.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:assert</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">fault-code</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"{http://www.citrusframework.org/faults}TEC-1001"</span>
           <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">fault-string</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Invalid request"</span>&gt;
           fault-actor="SERVER"&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapClient"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SoapFaultForcingRequest</span>
                  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/soap"</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Message</span>&gt;This is invalid&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SoapFaultForcingRequest</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:assert</span>&gt;</pre><p>The special assert action offers several attributes to validate the expected SOAP fault. Namely these are <span class="emphasis"><em>"fault-code"</em></span>,
            <span class="emphasis"><em>"fault-string"</em></span> and <span class="emphasis"><em>"fault-actor"</em></span>. The <span class="emphasis"><em>fault-code</em></span> is defined as a QName string and
            is mandatory for the validation. The fault assertion also supports test variable replacement as usual (e.g. fault-code="{http://www.citrusframework.org/faults}${myFaultCode}").</p><p>The time you use SOAP fault validation you need to tell Citrus how to validate the SOAP faults. Citrus needs an
            instance of a <code class="literal">SoapFaultValitator</code> that we need to add to the <span class="emphasis"><em>'citrus-context.xml'</em></span> Spring application context. By default
            Citrus is searching for a bean with the id <span class="emphasis"><em>'soapFaultValidator'</em></span>.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapFaultValidator"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.ws.validation.SimpleSoapAttachmentValidator"</span>/&gt;</pre><p>Citrus offers several reference implementations for these SOAP fault validators. These are:</p><div class="itemizedlist"><ul type="disc"><li><span class="emphasis"><em>com.consol.citrus.ws.validation.SimpleSoapAttachmentValidator</em></span></li><li><span class="emphasis"><em>com.consol.citrus.ws.validation.SimpleSoapFaultValidator</em></span></li><li><span class="emphasis"><em>com.consol.citrus.ws.validation.XmlSoapFaultValidator</em></span></li></ul></div><p>Please see the API documentation for details on the available reference implementations. Of course you can also define your own SOAP validator logic
            (would be great if you could share your ideas!). In the test case you can explicitly choose the validator to use:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:assert</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">fault-code</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"{http://www.citrusframework.org/faults}TEC-1001"</span>
              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">fault-string</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Invalid request"</span>
              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">fault-validator</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"mySpecialSoapFaultValidator"</span>&gt;
   [...]
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:assert</span>&gt;</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>Another important thing to notice when asserting SOAP faults is the fact, that Citrus needs to have a <code class="literal">SoapMessageFactory</code> available in
                the Spring application context. If you deal with SOAP messaging in general you will already have such a bean in the context.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"messageFactory"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.ws.soap.saaj.SaajSoapMessageFactory"</span>/&gt;</pre><p>Choose one of Spring's reference implementations or some other implementation as SOAP message factory. Citrus will search for a bean
                with id <span class="emphasis"><em>'messageFactory'</em></span> by default. In case you have other beans with different identifiers please choose the
                messageFactory in the test case assert action:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:assert</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">fault-code</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"{http://www.citrusframework.org/faults}TEC-1001"</span>
              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">fault-string</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Invalid request"</span>
              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message-factory</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"mySpecialMessageFactory"</span>&gt;
   [...]
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:assert</span>&gt;</pre></td></tr></table></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top">Notice the ws specific namespace that belongs to the Citrus WebService extensions. As the <span class="emphasis"><em>ws:assert</em></span> action uses SOAP specific features
            we need to refer to the citrus-ws namespace. You can find the namespace declaration in the root element in your test case.

                <pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">spring:beans</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/testcase"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:spring</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:ws</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/ws/testcase"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.citrusframework.org/schema/testcase
    http://www.citrusframework.org/schema/testcase/citrus-testcase.xsd
    http://www.citrusframework.org/schema/ws/testcase
    http://www.citrusframework.org/schema/ws/testcase/citrus-ws-testcase.xsd"</span>&gt;</pre></td></tr></table></div><p>Citrus is also able to validate SOAP fault details. See the following example for understanding how to do it:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:assert</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">fault-code</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"{http://www.citrusframework.org/faults}TEC-1001"</span>
           <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">fault-string</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Invalid request"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:fault-detail</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;FaultDetail</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/soap"</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ErrorCode</span>&gt;TEC-1000&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ErrorCode</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Text</span>&gt;Invalid request&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Text</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/FaultDetail</span>&gt;
      ]]&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:fault-detail</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapClient"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SoapFaultForcingRequest</span>
                  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/soap"</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Message</span>&gt;This is invalid&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SoapFaultForcingRequest</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:assert</span>&gt;</pre><p>The expected SOAP fault detail content is simply added to the <span class="emphasis"><em>ws:assert</em></span> action. The <code class="literal">SoapFaultValidator</code> implementation defined in the <span class="emphasis"><em>citrus-context.xml</em></span>
            is responsible for checking the SOAP fault detail with validation algorithm. The validator implementation checks the detail content to meet the expected template.
            Citrus provides some default <code class="literal">SoapFaultValidator</code> implementations. Supported algorithms are pure String comparison (<span class="emphasis"><em>com.consol.citrus.ws.validation.SimpleSoapFaultValidator</em></span>)
            as well as XML tree walk-through (<span class="emphasis"><em>com.consol.citrus.ws.validation.XmlSoapFaultValidator</em></span>).</p><p>When using the XML validation algorithm you have the complete power as known from normal message validation in receive actions. This includes schema validation or ignoring elements
            for instance. On the fault-detail element you are able to add some validation settings such as <span class="emphasis"><em>schema-validation=enabled/disabled</em></span>, custom <span class="emphasis"><em>schema-repository</em></span>
            and so on.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:assert</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">fault-code</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"{http://www.citrusframework.org/faults}TEC-1001"</span>
           <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">fault-string</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Invalid request"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:fault-detail</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">schema-validation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"false"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;FaultDetail</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/soap"</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ErrorCode</span>&gt;TEC-1000&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ErrorCode</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Text</span>&gt;Invalid request&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Text</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/FaultDetail</span>&gt;
      ]]&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:fault-detail</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapClient"</span>&gt;
        [...]
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:assert</span>&gt;</pre><p>Please see also the Citrus API documentation for available validator implementations and validation algorithms.</p><p>So far we have used assert action wrapper in order to catch SOAP fault exceptions and validate the SOAP fault content. Now we have an alternative way
            of handling SOAP faults in Citrus. With exceptions the send action aborts and we do not have a receive action for the SOAP fault. This might be inadequate if
            we need to validate the SOAP message content (SOAPHeader and SOAPBody) coming with the SOAP fault. Therefore the web service message sender component offers
            several fault strategy options. In the following we discuss the propagation of SOAP fault as messages to the receive action as we would do with
            normal SOAP messages.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-ws:client</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapClient"</span>
                               <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">request-url</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://localhost:8090/test"</span>
                               <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">fault-strategy</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"propagateError"</span>/&gt;</pre><p>We have configured a fault strategy <span class="emphasis"><em>propagateError</em></span> so the message sender will not raise client exceptions but inform the receive action
            with SOAP fault message contents. By default the fault strategy raises client exceptions (fault-strategy=<span class="emphasis"><em>throwsException</em></span>).</p><p>So now that we do not raise exceptions we can leave out the assert action wrapper in our test. Instead we simply use a receive action and validate the SOAP fault
            like this.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapClient"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SoapFaultForcingRequest</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/sample.xsd"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Message</span>&gt;This is invalid&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SoapFaultForcingRequest</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapClient"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">timeout</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"5000"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Fault</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:SOAP-ENV</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://schemas.xmlsoap.org/soap/envelope/"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">faultcode</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:CITRUS</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrus.org/soap"</span>&gt;CITRUS:${soapFaultCode}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/faultcode</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">faultstring</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xml:lang</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"en"</span>&gt;${soapFaultString}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/faultstring</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SOAP-ENV:Fault</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>So choose the preferred way of handling SOAP faults either by asserting client exceptions or propagating fault messages to the receive action on a SOAP client.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="soap-fault-details"></a>17.7.3.&nbsp;Multiple SOAP fault details</h3></div></div></div><p>SOAP fault messages can hold multiple SOAP fault detail elements. In the previous sections we have used SOAP fault details in sending and receiving actions as single element. In order
            to meet the SOAP specification Citrus is also able to handle multiple SOAP fault detail elements in a message. You just use multiple fault-detail elements in your test action like this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:send-fault</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloSoapServer"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:fault</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:fault-code</span>&gt;{http://www.citrusframework.org/faults}citrus:TEC-1000&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:fault-code</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:fault-string</span>&gt;Invalid request&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:fault-string</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:fault-actor</span>&gt;SERVER&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:fault-actor</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:fault-detail</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;FaultDetail</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/sayHello.xsd"</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">MessageId</span>&gt;${messageId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/MessageId</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">CorrelationId</span>&gt;${correlationId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/CorrelationId</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ErrorCode</span>&gt;TEC-1000&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ErrorCode</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Text</span>&gt;Invalid request&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Text</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/FaultDetail</span>&gt;
            ]]&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:fault-detail</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:fault-detail</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;ErrorDetail</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/sayHello.xsd"</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ErrorCode</span>&gt;TEC-1000&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ErrorCode</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ErrorDetail</span>&gt;
            ]]&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:fault-detail</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:fault</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:header</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_soap_action"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sayHello"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:send-fault</span>&gt;</pre><p>This will result in following SOAP envelope message:</p><pre class="programlisting">HTTP/1.1 500 Internal Server Error
Accept: text/xml, text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2
SOAPAction: "sayHello"
Content-Type: text/xml; charset=utf-8
Content-Length: 680
Server: Jetty(7.0.0.pre5)

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Envelope</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:SOAP-ENV</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://schemas.xmlsoap.org/soap/envelope/"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Header</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Body</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Fault</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">faultcode</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:citrus</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/faults"</span>&gt;citrus:TEC-1000&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/faultcode</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">faultstring</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xml:lang</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"en"</span>&gt;Invalid request&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/faultstring</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">detail</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">FaultDetail</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/sayHello.xsd"</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">MessageId</span>&gt;9277832563&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/MessageId</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">CorrelationId</span>&gt;4346806225&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/CorrelationId</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ErrorCode</span>&gt;TEC-1000&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ErrorCode</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Text</span>&gt;Invalid request&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Text</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/FaultDetail</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ErrorDetail</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/sayHello.xsd"</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ErrorCode</span>&gt;TEC-1000&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ErrorCode</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ErrorDetail</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/detail</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SOAP-ENV:Fault</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SOAP-ENV:Body</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SOAP-ENV:Envelope</span>&gt;</pre><p>Of course we can also expect several fault detail elements when receiving a SOAP fault.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:assert</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">fault-code</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"{http://www.citrusframework.org/faults}TEC-1001"</span>
           <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">fault-string</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Invalid request"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:fault-detail</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">schema-validation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"false"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;FaultDetail</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/soap"</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ErrorCode</span>&gt;TEC-1000&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ErrorCode</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Text</span>&gt;Invalid request&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Text</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/FaultDetail</span>&gt;
      ]]&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:fault-detail</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:fault-detail</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;ErrorDetail</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/soap"</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ErrorCode</span>&gt;TEC-1000&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ErrorCode</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ErrorDetail</span>&gt;
      ]]&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:fault-detail</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapClient"</span>&gt;
        [...]
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:assert</span>&gt;</pre><p>As you can see we can individually use validation settings for each fault detail. In the example above we disabled schema validation for the first fault detail element.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="soap-http-errors"></a>17.8.&nbsp;Send HTTP error codes with SOAP</h2></div></div></div><p>The SOAP server logic in Citrus is able to simulate pure HTTP error codes such as 404 "Not found" or 500 "Internal server error". The good thing is that the Citrus server is
        able to receive a request for proper validation in a receive action and then simulate HTTP errors on demand.</p><p>The mechanism on HTTP error code simulation is not different to the usual SOAP request/response handling in Citrus. We receive the request as usual and we provide a response. The HTTP error
        situation is simulated according to the special HTTP header <span class="emphasis"><em>citrus_http_status</em></span> in the Citrus SOAP response definition. In case this header
        is set to a value other than 200 OK the Citrus SOAP server sends an empty SOAP response with HTTP error status code set accordingly.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloSoapServer"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://consol.de/schemas/sample.xsd"</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Text</span>&gt;Hello SOAP server&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Text</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Message</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloSoapServer"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_http_status_code"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"500"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;</pre><p>The SOAP response must be empty and the HTTP status code is set to a value other than 200, like 500. This results in a HTTP error sent to the calling client with error 500 "Internal server error".</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="soap-attachments"></a>17.9.&nbsp;SOAP attachment support</h2></div></div></div><p>Citrus is able to add attachments to a SOAP request on client and server side. As usual you can validate the SOAP attachment content on a received SOAP message.
        The next chapters describe how to handle SOAP attachments in Citrus.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="soap-attachment-send"></a>17.9.1.&nbsp;Send SOAP attachments</h3></div></div></div><p>As client Citrus is able to add attachments to the SOAP message. I think it is best to go straight into an example in order to understand how it works.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapClient"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SoapMessageWithAttachment</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://consol.de/schemas/sample.xsd"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Operation</span>&gt;Read the attachment&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Operation</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SoapMessageWithAttachment</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:attachment</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">content-id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"MySoapAttachment"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">content-type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"text/plain"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:resource</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:com/consol/citrus/ws/soapAttachment.txt"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:attachment</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:send</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>In the previous chapters you may have already noticed the <span class="emphasis"><em>citrus-ws</em></span> namespace that stands for the SOAP extensions in Citrus. Please
                include the <span class="emphasis"><em>citrus-ws</em></span> namespace in your test case as described earlier in this chapter so you can use the attachment support.</p></td></tr></table></div><p>The special send action of the SOAP extension namespace is aware of SOAP attachments. The attachment content usually consists of a <span class="emphasis"><em>content-id</em></span>
            a <span class="emphasis"><em>content-type</em></span> and the actual content as plain text or binary content. Inside the test case you can use external file resources or inline CDATA sections
            for the attachment content. As you are familiar with Citrus you may know this already from other actions.</p><p>Citrus will construct a SOAP message with the SOAP attachment. Currently only one attachment per message is supported.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="soap-attachment-receiver"></a>17.9.2.&nbsp;Receive SOAP attachments</h3></div></div></div><p>When Citrus calls SOAP WebServices as a client we may receive SOAP responses with attachments. The tester can validate those
            received SOAP messages with attachment content quite easy. As usual let us have a look at an example first.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapClient"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SoapMessageWithAttachmentRequest</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://consol.de/schemas/sample.xsd"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Operation</span>&gt;Read the attachment&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Operation</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SoapMessageWithAttachmentRequest</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:attachment</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">content-id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"MySoapAttachment"</span>
                      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">content-type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"text/plain"</span>
                      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">validator</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"mySoapAttachmentValidator"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:resource</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:com/consol/citrus/ws/soapAttachment.txt"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:attachment</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:receive</span>&gt;</pre><p>Again we use the Citrus SOAP extension namespace with the specific receive action that is aware of SOAP attachment validation. The tester can validate
            the <span class="emphasis"><em>content-id</em></span>, the <span class="emphasis"><em>content-type</em></span> and the attachment content. Instead of using the external file resource you could also define an expected attachment template directly
            in the test case as inline CDATA section.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The <span class="emphasis"><em>ws:attachment</em></span> element specifies a validator instance. This validator determines how to validate the attachment content. SOAP attachments are not
                limited to XML content. Plain text content and binary content is possible, too. So each SOAP attachment validating action can use a different <code class="literal">SoapAttachmentValidator</code>
                instance which is responsible for validating and comparing received attachments to expected template attachments. In the Citrus configuration the validator
                is set as normal Spring bean with the respective identifier.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapAttachmentValidator"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.ws.validation.SimpleSoapAttachmentValidator"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"mySoapAttachmentValidator"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.company.ws.validation.MySoapAttachmentValidator"</span>/&gt;</pre><p>You can define several validator instances in the Citrus configuration. The validator with the general id <span class="emphasis"><em>"soapAttachmentValidator"</em></span> is the default validator
                for all actions that do not explicitly set a validator instance. Citrus offers a set of reference validator implementations. The <code class="literal">SimpleSoapAttachmentValidator</code> will use a simple
                plain text comparison. Of course you are able to add individual validator implementations, too.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="soap-attachment-mtom"></a>17.9.3.&nbsp;SOAP MTOM support</h3></div></div></div><p>MTOM (Message Transmission Optimization Mechanism) enables you to send and receive large SOAP message content using streamed data handlers. This optimizes the resource allocation on server and client side where
            not all data is loaded into memory when marshalling/unmarshalling the message payload data. In detail MTOM enabled messages do have a XOP package inside the message payload replacing the actual large content data. The
            content is then streamed aas separate attachment. Server and client can operate with a data handler providing access to the streamed content. This is very helpful when using large binary content inside a SOAP message for instance.</p><p>Citrus is able to both send and receive MTOM enabled SOAP messages on client and server. Just use the <span class="emphasis"><em>mtom-enabled</em></span> flag when sending a SOAP message:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapMtomClient"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">mtom-enabled</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;image:addImage</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:image</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/imageService/"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">image</span>&gt;cid:IMAGE&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/image</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/image:addImage</span>&gt;
      ]]&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:attachment</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">content-id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"IMAGE"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">content-type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"application/octet-stream"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:resource</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:com/consol/citrus/hugeImageData.png"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:attachment</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:send</span>&gt;</pre><p>As you can see the example above sends a SOAP message that contains a large binary image content. The actual binary image data is referenced with a content id marker <span class="emphasis"><em>cid:IMAGE</em></span> inside the message payload. The actual image
          content is added as attachment with a separate file resource. Important is here the <span class="emphasis"><em>content-id</em></span> which matches the id marker in the SOAP message payload (<span class="emphasis"><em>IMAGE</em></span>).</p><p>Citrus builds a proper SOAP MTOM enabled message automatically adding the XOP package inside the message. The binary data is sent as separate SOAP attachment accordingly. The resulting SOAP message looks like this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Envelope</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:SOAP-ENV</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://schemas.xmlsoap.org/soap/envelope/"</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Header</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SOAP-ENV:Header</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Body</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">image:addImage</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:image</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/imageService/"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">image</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">xop:Include</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xop</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2004/08/xop/include"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">href</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"cid:IMAGE"</span>/&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/image</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/image:addImage</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SOAP-ENV:Body</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SOAP-ENV:Envelope</span>&gt;</pre><p>On the server side Citrus is also able to handle MTOM enabled SOAP messages. In a server receive action you can specify the MTOM SOAP attachment content as follows.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapMtomServer"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">mtom-enabled</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">schema-validation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"false"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;image:addImage</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:image</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/imageService/"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">image</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">xop:Include</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xop</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2004/08/xop/include"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">href</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"cid:IMAGE"</span>/&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/image</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/image:addImage</span>&gt;
      ]]&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:attachment</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">content-id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"IMAGE"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">content-type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"application/octet-stream"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:resource</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:com/consol/citrus/hugeImageData.png"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:attachment</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:receive</span>&gt;</pre><p>We define the MTOM attachment content as separate SOAP attachment. The <span class="emphasis"><em>content-id</em></span> is referenced somewhere in the SOAP message payload data. At runtime
          Citrus will add the XOP package definition automatically and perform validation on the message and its streamed MTOM attachment data.</p><p>Next thing that we have to talk about is inline MTOM data. This means that the content should be added as either <span class="emphasis"><em>base64Binary</em></span> or <span class="emphasis"><em>hexBinary</em></span> encoded
          String data directly to the message content. See the following example that uses the <span class="emphasis"><em>mtom-inline</em></span> setting:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapMtomClient"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">mtom-enabled</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;image:addImage</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:image</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/imageService/"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">image</span>&gt;cid:IMAGE&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/image</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">icon</span>&gt;cid:ICON&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/icon</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/image:addImage</span>&gt;
      ]]&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:attachment</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">content-id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"IMAGE"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">content-type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"application/octet-stream"</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">mtom-inline</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">encoding-type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"base64Binary"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:resource</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:com/consol/citrus/image.png"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:attachment</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:attachment</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">content-id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"ICON"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">content-type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"application/octet-stream"</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">mtom-inline</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">encoding-type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"hexBinary"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:resource</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:com/consol/citrus/icon.ico"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:attachment</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:send</span>&gt;</pre><p>The listing above defines two inline MTOM attachments. The first attachment <span class="emphasis"><em>cid:IMAGE</em></span> uses the encoding type <span class="emphasis"><em>base64Binary</em></span> which is the default.
            The second attachment <span class="emphasis"><em>cid:ICON</em></span> uses <span class="emphasis"><em>hexBinary</em></span> encoding. Both attachments are added as inline data before the message is sent. The final SOAP message looks like follows:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Envelope</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:SOAP-ENV</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://schemas.xmlsoap.org/soap/envelope/"</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Header</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SOAP-ENV:Header</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Body</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">image:addImage</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:image</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/imageService/"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">image</span>&gt;VGhpcyBpcyBhIGJpbmFyeSBpbWFnZSBhdHRhY2htZW50IQpWYXJpYWJsZXMgJXt0ZXN0fSBzaG91bGQgbm90IGJlIHJlcGxhY2VkIQ==&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/image</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">icon</span>&gt;5468697320697320612062696E6172792069636F6E206174746163686D656E74210A5661726961626C657320257B746573747D2073686F756C64206E6F74206265207265706C6163656421&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/icon</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/image:addImage</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SOAP-ENV:Body</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SOAP-ENV:Envelope</span>&gt;</pre><p>The image content is a base64Binary String and the icon a heyBinary String. Of course this mechanism also is supported in receive actions on the server side where the expected message content is added als inline MTOM data
          before validation takes place.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="soap-basic-auth-client"></a>17.10.&nbsp;SOAP client basic authentication</h2></div></div></div><p>As a SOAP client you may have to use basic authentication in order to access a server resource. Basic authentication via HTTP stands for username/password authentication
        where the credentials are transmitted in the HTTP request header section as base64 encoded entry. As Citrus uses the Spring WebService stack we can use the basic authentication
        support there. We set the user credentials on the HttpClient message sender which is used inside the Spring <code class="literal">WebServiceTemplate</code>.</p><p>Citrus provides a comfortable way to set the HTTP message sender with basic authentication credentials on the <code class="literal">WebServiceTemplate</code>. Just see the following
        example and learn how to do that.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-ws:client</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapClient"</span>
                              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">request-url</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://localhost:8090/test"</span>
                              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message-sender</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"basicAuthClient"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"basicAuthClient"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.ws.transport.http.HttpComponentsMessageSender"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"authScope"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.apache.http.auth.AuthScope"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor-arg</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"localhost"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor-arg</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"8090"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor-arg</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">""</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor-arg</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"basic"</span>/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"credentials"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.apache.http.auth.UsernamePasswordCredentials"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor-arg</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"someUsername"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor-arg</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"somePassword"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>The above configuration results in SOAP requests with authentication headers properly set for basic authentication. The special message sender takes care on adding the proper
        basic authentication header to each request that is sent with this Citrus message sender. By default preemtive authentication is used. The message sender only sends a single request to the server with
        all authentication information set in the message header. The request which determines the authentication scheme on the server is skipped. This is why you have to add some auth scope so Citrus
        can setup an authentication cache within the HTTP context in order to have preemtive authentication.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>You can also skip the message sender configuration and set the <span class="emphasis"><em>Authorization</em></span> header on each request in your send action definition on your own.
        Be aware of setting the header as HTTP mime header using the correct prefix and take care on using the correct basic authentication with base64 encoding for the <span class="emphasis"><em>username:password</em></span> phrase.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_http_Authorization"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Basic c29tZVVzZXJuYW1lOnNvbWVQYXNzd29yZA=="</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;</pre><p>For base64 encoding you can also use a Citrus function, see <a href="#functions-encode-base64" title="28.23.&nbsp;citrus:encodeBase64()">Section&nbsp;28.23, &#8220;citrus:encodeBase64()&#8221;</a></p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="soap-basic-auth-server"></a>17.11.&nbsp;SOAP server basic authentication</h2></div></div></div><p>When providing SOAP WebService server functionality Citrus can also set basic authentication so all clients need to
        authenticate properly when accessing the server resource.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-ws:server</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"simpleSoapServer"</span>
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">port</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"8080"</span>
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">auto-start</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">resource-base</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"src/citrus/resources"</span>
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">security-handler</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"basicSecurityHandler"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"securityHandler"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.ws.security.SecurityHandlerFactory"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"users"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">list</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.ws.security.User"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"name"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"password"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"secret"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"roles"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"CitrusRole"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/list</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"constraints"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">map</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">entry</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">key</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"/foo/*"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.ws.security.BasicAuthConstraint"</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor-arg</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"CitrusRole"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/entry</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/map</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>We have set a security handler on the server web container with a constraint on all resources with <span class="emphasis"><em>/foo/*</em></span>. Following from that
        the server requires basic authentication for these resources. The granted users and roles are specified within the security handler bean definition. Connecting clients
        have to set the basic auth HTTP header properly using the correct user and role for accessing the Citrus server now.</p><p>You can customize the security handler for your very specific needs (e.g. load users and roles with JDBC from a database). Just have a look at the code base and
        inspect the settings and properties offered by the security handler interface.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>This mechanism is not restricted to basic authentication only. With other settings you can also set up digest or form-based authentication constraints very easy.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="soap-ws-adressing"></a>17.12.&nbsp;WS-Addressing support</h2></div></div></div><p>The web service stack offers a lot of different technologies and standards within the context of SOAP WebServices. We speak of WS-* specifications in particular. One of these specifications deals
        with addressing. On client side you may add wsa header information to the request in order to give the server instructions how to deal with SOAP faults for instance.</p><p>In Citrus WebService client you can add those header information using the common configuration like this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-ws:client</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapClient"</span>
                         <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">request-url</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://localhost:8090/test"</span>
                         <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message-converter</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"wsAddressingMessageConverter"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"wsAddressingMessageConverter"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.ws.message.converter.WsAddressingMessageConverter"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor-arg</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"wsAddressing200408"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.ws.addressing.WsAddressingHeaders"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"version"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"VERSION200408"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"action"</span>
                     <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrus.sample/sayHello"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"to"</span>
                     <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrus.sample/server"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"from"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.ws.soap.addressing.core.EndpointReference"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor-arg</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrus.sample/client"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"replyTo"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.ws.soap.addressing.core.EndpointReference"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor-arg</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrus.sample/client"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"faultTo"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.ws.soap.addressing.core.EndpointReference"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor-arg</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrus.sample/fault/resolver"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/constructor-arg</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The WS-Addressing specification knows several versions. Supported version are <span class="emphasis"><em>VERSION10 (WS-Addressing 1.0 May 2006)</em></span> and <span class="emphasis"><em>VERSION200408
            (August 2004 edition of the WS-Addressing specification)</em></span>.</p></td></tr></table></div><p>The addressing headers find a place in the SOAP message header with respective namespaces and values. A possible SOAP request with WS addressing headers looks like follows:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Envelope</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:SOAP-ENV</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://schemas.xmlsoap.org/soap/envelope/"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Header</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:wsa</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://schemas.xmlsoap.org/ws/2004/08/addressing"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">wsa:To</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">SOAP-ENV:mustUnderstand</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"1"</span>&gt;http://citrus.sample/server&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/wsa:To</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">wsa:From</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">wsa:Address</span>&gt;http://citrus.sample/client&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/wsa:Address</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/wsa:From</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">wsa:ReplyTo</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">wsa:Address</span>&gt;http://citrus.sample/client&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/wsa:Address</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/wsa:ReplyTo</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">wsa:FaultTo</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">wsa:Address</span>&gt;http://citrus.sample/fault/resolver&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/wsa:Address</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/wsa:FaultTo</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">wsa:Action</span>&gt;http://citrus.sample/sayHello&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/wsa:Action</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">wsa:MessageID</span>&gt;urn:uuid:4c4d8af2-b402-4bc0-a2e3-ad33b910e394&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/wsa:MessageID</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SOAP-ENV:Header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Body</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">cit:HelloRequest</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:cit</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrus/sample/sayHello"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">cit:Text</span>&gt;Hello Citrus!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/cit:Text</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/cit:HelloRequest</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SOAP-ENV:Body</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SOAP-ENV:Envelope</span>&gt;</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>The message id property is automatically generated for each request. If you need to set a static message
            id you can do so in citrus-context message sender configuration.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="soap-fork-mode"></a>17.13.&nbsp;SOAP client fork mode</h2></div></div></div><p>SOAP over HTTP uses synchronous communication by nature. This means that sending a SOAP message in Citrus over HTTP will automatically
        block further test actions until the synchronous HTTP response has been received. In test cases this synchronous blocking might cause problems
        for several reasons. A simple reason would be that you need to do further test actions in parallel to the synchronous HTTP SOAP communication (e.g. simulate another
        backend system in the test case).</p><p>You can separate the SOAP send action from the rest of the test case by using the <span class="emphasis"><em>"fork"</em></span> mode. The SOAP
        client will automatically open a new Java Thread for the synchronous communication and the test is able to continue with execution although the
        synchronous HTTP SOAP response has not arrived yet.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapClient"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">fork</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SoapRequest</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/sample.xsd"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Operation</span>&gt;Read the attachment&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Operation</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SoapRequest</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:send</span>&gt;</pre><p>With the <span class="emphasis"><em>"fork"</em></span> mode enabled the test continues with execution while the sending action waits for the synchronous response in
        a separate Java Thread. You could reach the same behaviour with a complex &lt;parallel&gt;/&lt;sequential&gt; container construct, but forking the send action is much more
        straight forward.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top">It is highly recommended to use a proper <span class="emphasis"><em>"timeout"</em></span> setting on the SOAP receive action when using fork mode. The forked send operation might take
        some time and the corresponding receive action might run into failure as the response was has not been received yet. The result would be a broken test because of the missing response message.
        A proper <span class="emphasis"><em>"timeout"</em></span> setting for the receive action solves this problem as the action waits for this time period and occasionally repeatedly asks for the SOAP response message.
        The following listing sets the receive timeout to 10 seconds, so the action waits for the forked send action to deliver the SOAP response in time.
            <pre class="programlisting">
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ws:receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapClient"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">timeout</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"10000"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SoapResponse</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/sample.xsd"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Operation</span>&gt;Did something&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Operation</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Success</span>&gt;true&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Success</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SoapResponse</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ws:receive</span>&gt;
            </pre></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="soap-servlet-context"></a>17.14.&nbsp;SOAP servlet context customization</h2></div></div></div><p>For highly customized SOAP server components in Citrus you can define a full servlet context configuration file. Here you have the full power to add Spring endpoint mappings and custom endpoint implementations.
        You can set the custom servlet context as external file resource on the server component:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-ws:client</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soapClient"</span>
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">context-config-location</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:citrus-ws-servlet.xml"</span>
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message-factory</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"soap11MessageFactory"</span>/&gt;</pre><p>Now let us have a closer look at the context-config-location attribute. This configuration defines the Spring application context file for endpoints, request mappings and other SpringWS specific information. Please see the
        official SpringWS documentation for details on this Spring based configuration. You can also just copy the following example application context which should work for you in general.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">beans</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans"</span>
       <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xsi</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"
       http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd"</span>&gt;

  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"loggingInterceptor"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.ws.server.endpoint.interceptor.PayloadLoggingInterceptor"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">description</span>&gt;
          This interceptor logs the message payload.
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/description</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;

  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloServicePayloadMapping"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.ws.server.endpoint.mapping.PayloadRootQNameEndpointMapping"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"mappings"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">props</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">prop</span>
                  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">key</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"{http://www.consol.de/schemas/sayHello}HelloRequest"</span>&gt;
                  helloServiceEndpoint
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/prop</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/props</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"interceptors"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">list</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ref</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">bean</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"loggingInterceptor"</span>/&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/list</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;

  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloServiceEndpoint"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.ws.server.WebServiceEndpoint"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"endpointAdapter"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">ref</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"staticResponseEndpointAdapter"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;

  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:static-response-adapter</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"staticResponseEndpointAdapter"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:payload</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;HelloResponse</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/sayHello"</span>&gt;
                  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">MessageId</span>&gt;123456789&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/MessageId</span>&gt;
                  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">CorrelationId</span>&gt;CORR123456789&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/CorrelationId</span>&gt;
                  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">User</span>&gt;WebServer&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/User</span>&gt;
                  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Text</span>&gt;Hello User&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Text</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/HelloResponse</span>&gt;
          ]]&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:payload</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:header</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"{http://www.consol.de/schemas/samples/sayHello.xsd}ns0:Operation"</span>
                  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sayHelloResponse"</span>/&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"{http://www.consol.de/schemas/samples/sayHello.xsd}ns0:Request"</span>
                  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"HelloRequest"</span>/&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_soap_action"</span>
                  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sayHello"</span>/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:header</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:static-response-adapter</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/beans</span>&gt;</pre><p>The program listing above describes a normal SpringWS request mapping with endpoint configurations. The mapping is responsible to forward
        incoming requests to the endpoint which will handle the request and provide a proper response message. First of all we add a logging interceptor
        to the context so all incoming requests get logged to the console first. Then we use a payload mapping (PayloadRootQNameEndpointMapping) in order
        to map all incoming <code class="literal">'HelloRequest'</code> SOAP messages to the <code class="literal">'helloServiceEndpoint'</code>. Endpoints are of
        essential nature in Citrus SOAP WebServices implementation. They are responsible for processing a request in order to provide a proper response
        message that is sent back to the calling client. Citrus uses the endpoint in combination with a message endpoint adapter implementation.</p><div class="mediaobject" align="center"><img src="images/figure_009.jpg" align="middle"></div><p>The endpoint works together with the message endpoint adapter that is responsible for providing a response message for the client. The various
        message endpoint adapter implementations in Citrus were already discussed in <a href="#endpoint-adapter" title="Chapter&nbsp;27.&nbsp;Endpoint adapter">Chapter&nbsp;27, <i xmlns:xlink="http://www.w3.org/1999/xlink">Endpoint adapter</i></a>.</p><p>In this example the <code class="literal">'helloServiceEndpoint'</code> uses the <code class="literal">'static-response-adapter'</code>
        which is always returning a static response message. In most cases static responses will not fit the test scenario and you will have to
        respond more dynamically.</p><p>Regardless of which message endpoint adapter setup you are using in your test case the endpoint transforms the response into a proper SOAP
        message. You can add as many request mappings and endpoints as you want to the server context configuration. So you are able to handle
        different request types with one single Jetty server instance.</p><p>That's it for connecting with SOAP WebServices! We saw how to send and receive SOAP messages with Jetty and
        Spring WebServices. Have a look at the samples coming with your Citrus archive in order to learn more about the SOAP message handling.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="ftp"></a>Chapter&nbsp;18.&nbsp;FTP support</h2></div></div></div><p>Citrus is able to start a little ftp server accepting incoming client requests. Also Citrus is able to call FTP commands as a client. The next sections deal with
  FTP connectivity.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The FTP components in Citrus are kept in a separate Maven module. So you should add the module
      as Maven dependency to your project accordingly.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">dependency</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">groupId</span>&gt;com.consol.citrus&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/groupId</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">artifactId</span>&gt;citrus-ftp&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/artifactId</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">version</span>&gt;2.2&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/version</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/dependency</span>&gt;</pre><p>As Citrus provides a customized FTP configuration schema for the Spring application context configuration files we have to add name to the top level
      <span class="emphasis"><em>beans</em></span> element. Simply include the ftp-config namespace in the configuration XML files as follows.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">beans</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xsi</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:citrus</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/config"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:citrus-ftp</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/ftp/config"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"
    http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.citrusframework.org/schema/config
    http://www.citrusframework.org/schema/config/citrus-config.xsd
    http://www.citrusframework.org/schema/http/config
    http://www.citrusframework.org/schema/ftp/config/citrus-ftp-config.xsd"</span>&gt;

      [...]

      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/beans</span>&gt;</pre><p>Now we are ready to use the customized Citrus FTP configuration elements with the
      citrus-ftp namespace prefix.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ftp-client"></a>18.1.&nbsp;FTP client</h2></div></div></div><p>We want to use Citrus fo connect to dome FTP server as a client sending commands such as creating a directory or listing all files. Citrus
      offers a client component doing exactly this FTP client connection.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-ftp:client</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"ftpClient"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">host</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"localhost"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">port</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"22222"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">username</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"admin"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">password</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"admin"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">timeout</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"10000"</span>/&gt;</pre><p>The configuration above describes a Citrus ftp client connected to a ftp server with <span class="emphasis"><em>ftp://localhost:22222</em></span>. For authentication username and
    password are defined as well as the global connection timeout. The client will automatically send username and password for proper authentication to the server when opening a new connection.</p><p>In a test case you are now able to use the client to push commands to the server.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"ftpClient"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">fork</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_ftp_command"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"PWD"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_ftp_arguments"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"test"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"ftpClient"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"plaintext"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;PWD&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_ftp_command"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"PWD"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_ftp_arguments"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"test"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_ftp_reply_code"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"257"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_ftp_reply_string"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"@contains('is current directory')@"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>As you can see most of the ftp communication parameters are specified as special header elements in the message. Citrus automatically converts those information to proper FTP commands and response messages.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ftp-server"></a>18.2.&nbsp;FTP server</h2></div></div></div><p>Now that we are able to access FTP as a client we might also want to simulate the server side. Therefore Citrus offers a server component that is listening on a port for incoming FTP connections. The server has a default
    home directory on the local file system specified. But you can also define home directories per user. For now let us have a look at the server configuration component:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-ftp:server</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"ftpServer"</span>&gt;
      port="22222"
      auto-start="true"
      user-manager-properties="classpath:ftp.server.properties"/&gt;</pre><p>The ftp server configuration is quite simple. The server starts automatically and binds to a port. The user configuration is read from a <span class="emphasis"><em>user-manager-property</em></span> file. Let us have a look at the content of
    this user management file:</p><pre class="programlisting"># Password is "admin"
ftpserver.user.admin.userpassword=21232F297A57A5A743894A0E4A801FC3
ftpserver.user.admin.homedirectory=target/ftp/user/admin
ftpserver.user.admin.enableflag=true
ftpserver.user.admin.writepermission=true
ftpserver.user.admin.maxloginnumber=0
ftpserver.user.admin.maxloginperip=0
ftpserver.user.admin.idletime=0
ftpserver.user.admin.uploadrate=0
ftpserver.user.admin.downloadrate=0

ftpserver.user.anonymous.userpassword=
ftpserver.user.anonymous.homedirectory=target/ftp/user/anonymous
ftpserver.user.anonymous.enableflag=true
ftpserver.user.anonymous.writepermission=false
ftpserver.user.anonymous.maxloginnumber=20
ftpserver.user.anonymous.maxloginperip=2
ftpserver.user.anonymous.idletime=300
ftpserver.user.anonymous.uploadrate=4800
ftpserver.user.anonymous.downloadrate=4800</pre><p>As you can see you are able to define as many user for the ftp server as you like. Username and password define the authentication on the server. In addition to that you have plenty of configuration possibilities per user. Citrus uses the
    Apache ftp server implementation. So for more details on configuration capabilities please consult the official Apache ftp server documentation.</p><p>Now we would like to use the server in a test case. Very easy you just have to define a receive message action within your test case that uses the server id as endpoint reference:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;Receive user login on FTP server&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"ftpServer"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"plaintext"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;USER&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_ftp_command"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"USER"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_ftp_arguments"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"admin"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"ftpServer"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"plaintext"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;OK&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;Receive user password on FTP server&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"ftpServer"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"plaintext"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;PASS&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_ftp_command"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"PASS"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_ftp_arguments"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"admin"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"ftpServer"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"plaintext"</span><span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">"&gt;</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;data&gt;OK&lt;/data&gt;</span>
  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/message&gt;</span>
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/send&gt;</span></pre><p>The listing above shows two incoming commands representing a user login. We indicate with re send actions that we would link the server to respond with positive feedback and to accept the login. As we have a fully qualified ftp server
    running the client can also push files read directories and more. All incoming commands can be validated inside a test case.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="message-channel"></a>Chapter&nbsp;19.&nbsp;Message channel support</h2></div></div></div><p>Message channels represent the in memory messaging solution in Citrus. Producer and consumer components are linked via channels exchanging messages
    in memory. As this transport mechanism comes from Spring Integration API (http://www.springsource.org/spring-integration) and Citrus itself uses a lot
    of Spring APIs, especially those from Spring Integration you are able to connect to all Spring messaging adapters via these in memory channels.</p><p>Citrus offers a channel components that can be used both by Citrus and Spring Integration. The conclusion is that Citrus supports the sending and
    receiving of messages both to and from Spring Integration message channel components. This opens up a lot of great possibilities to interact with the
    Spring Integration transport adapters for FTP, TCP/IP and so on. In addition to that the message channel support provides us a good way to exchange messages
    in memory.</p><p>Citrus provides support for sending and receiving JMS messages. We have to separate between synchronous and asynchronous
      communication. So in this chapter we explain how to setup JMS message endpoints for synchronous and asynchronous
      outbound and inbound communication</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The message channel configuration components use the default "citrus" configuration namespace and schema definition. Include this namespace into your Spring
        configuration in order to use the Citrus configuration elements. The namespace URI and schema location are added to the
        Spring configuration XML file as follows.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">beans</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xsi</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:citrus-jms</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/config"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.citrusframework.org/schema/config
        http://www.citrusframework.org/schema/config/citrus-config.xsd"</span>&gt;

    [...]

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/beans</span>&gt;</pre><p>After that you are able to use customized Citrus XML elements in order to define the Spring beans.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="message-channel-endpoint"></a>19.1.&nbsp;Channel endpoint</h2></div></div></div><p>Citrus offers a channel endpoint component that is able to create producer and consumer components. Producer and consumer send and receive messages both to
        and from a channel endpoint. By default the endpoint is asynchronous when configured in the Citrus application context. With this component you are able to access
        message channels directly:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:channel-endpoint</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloEndpoint"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">channel</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloChannel"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">si:channel</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloChannel"</span>/&gt;</pre><p>The Citrus channel endpoint references a Spring Integration channel directly. Inside your test case you can reference the Citrus endpoint as usual to send and
        receive messages. We will see this later in some example code listings.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The Spring Integration configuration components use a specific namespace that has to be included into your
            Spring application context. You can use the following template which holds all necessary namespaces and schema 
            locations:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">beans</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xsi</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:citrus</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/config"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:si</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/integration"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans
            http://www.springframework.org/schema/beans/spring-beans.xsd
            http://www.citrusframework.org/schema/config 
            http://www.citrusframework.org/schema/config/citrus-config.xsd
            http://www.springframework.org/schema/integration
            http://www.springframework.org/schema/integration/spring-integration.xsd"</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/beans</span>&gt;</pre></td></tr></table></div><p>The Citrus channel endpoint also supports a customized message channel template that will actually send
        the messages. The customized template might give you access to special configuration possibilities. However it is optional, 
        so if no message channel template is defined in the configuration Citrus will create a default template.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:channel-endpoint</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloEndpoint"</span>
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">channel</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloChannel"</span>
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message-channel-template</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myMessageChannelTemplate"</span>/&gt;</pre><p>The message sender is now ready to publish messages to the defined channel. The communication is supposed to be asynchronous,
        so the producer is not able to process a reply message. We will deal with synchronous communication and reply messages later in this chapter.
        The message producer just publishes messages to the channel and is done. Interacting with the endpoints in a test case is quite easy.
        Just reference the id of the endpoint in your send and receive test actions</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloEndpoint"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">v1:HelloRequest</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:v1</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrusframework.org/schemas/HelloService.xsd"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">v1:Text</span>&gt;Hello World!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/v1:Text</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/v1:HelloRequest</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloEndpoint"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">v1:HelloResponse</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:v1</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrusframework.org/schemas/HelloService.xsd"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">v1:Text</span>&gt;Hello Citrus!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/v1:Text</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/v1:HelloResponse</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>As you can see Citrus is also able to receive messages from the same Spring Integration message channel destination. We just references the same channel-endpoint
        in the receive action.</p><p>As usual the receiver connects to the message destination and waits for messages to arrive. The user can set a receive timeout which is 
        set to 5000 milliseconds by default. In case no message was received in this time frame the receiver raises timeout errors and the test 
        fails.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sync-message-channel-endpoint"></a>19.2.&nbsp;Synchronous channel endpoints</h2></div></div></div><p>The synchronous channel producer publishes messages and waits synchronously for the response to arrive on some reply
        channel destination. The reply channel name is set in the message's header attributes so the counterpart in this communication can send its reply 
        to that channel. The basic configuration for a synchronous channel endpoint component looks like follows:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:channel-sync-endpoint</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloSyncEndpoint"</span>
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">channel</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloChannel"</span>
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">reply-timeout</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"1000"</span>
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">polling-interval</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"1000"</span>/&gt;</pre><p>Synchronous message channel endpoints usually do poll for synchronous reply messages for processing the reply messages. The poll interval is an optional setting in order to manage the amount of
        reply message handshake attempts. Once the endpoint was able to receive the reply message synchronously the test case can receive the reply. In case
        all message handshake attempts do fail because the reply message is not available in time we raise some timeout error and the test will fail.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>By default the channel endpoint uses temporary reply channel destinations. The temporary reply channels are only used once for a single communication handshake.
            After that the reply channel is deleted again. Static reply channels are not supported as it has not been in scope yet.</p></td></tr></table></div><p>When sending a message to this endpoint in the first place the producer will wait synchronously for the response message
        to arrive on the reply destination. You can receive the reply message in your test case using the same endpoint component.
        So we have two actions on the same endpoint, first send then receive.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloSyncEndpoint"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">v1:HelloRequest</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:v1</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrusframework.org/schemas/HelloService.xsd"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">v1:Text</span>&gt;Hello World!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/v1:Text</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/v1:HelloRequest</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloSyncEndpoint"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">v1:HelloResponse</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:v1</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrusframework.org/schemas/HelloService.xsd"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">v1:Text</span>&gt;Hello Citrus!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/v1:Text</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/v1:HelloResponse</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>In the last section we saw that synchronous communication is based on reply messages on temporary reply channels. We saw that
        Citrus is able to publish messages to channels and wait for reply messages to arrive on temporary reply channels. This section deals with the same
        synchronous communication over reply messages, but now Citrus has to send dynamic reply messages to temporary channels.</p><p>The scenario we are talking about is that Citrus receives a message and we need to reply to a temporary reply channel that is stored
        in the message header attributes. We handle this synchronous communication with the same synchronous channel endpoint component. When initiating
        the communication by receiving a message from a synchronous channel endpoint you are able to send a synchronous response back. Again just use the
        same endpoint reference in your test case. The handling of temporary reply destinations is done automatically behind the scenes. So we have again
        two actions in our test case, but this time first receive then send.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloSyncEndpoint"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">v1:HelloRequest</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:v1</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrusframework.org/schemas/HelloService.xsd"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">v1:Text</span>&gt;Hello World!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/v1:Text</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/v1:HelloRequest</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloSyncEndpoint"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">v1:HelloResponse</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:v1</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrusframework.org/schemas/HelloService.xsd"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">v1:Text</span>&gt;Hello Citrus!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/v1:Text</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/v1:HelloResponse</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;</pre><p>The synchronous message channel endpoint will handle all reply channel destinations and provide those behind the scenes.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="message-channel-selector-support"></a>19.3.&nbsp;Message selectors on channels</h2></div></div></div><p>Unfortunately Spring Integration message channels do not support message selectors on header values as described in <a href="#message-selector" title="7.2.7.&nbsp;Message selectors">Section&nbsp;7.2.7, &#8220;Message selectors&#8221;</a>. With Citrus version 1.2
        we found a way to also add message selector support on message channels. We had to introduce a special queue message channel implementation. So first of all we use this new message channel
        implementation in our configuration.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:channel</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"orderChannel"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">capacity</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"5"</span>/&gt;</pre><p>The Citrus message channel implementation extends the queue channel implementation from Spring Integration. So we can add a capacity attribute for this channel. That's it! 
        Now we use the message channel that supports message selection. In our test we define message selectors on header values as described in <a href="#message-selector" title="7.2.7.&nbsp;Message selectors">Section&nbsp;7.2.7, &#8220;Message selectors&#8221;</a> and
        you will see that it works.</p><p>In addition to that we have implemented other message filter possibilities on message channels that we discuss in the next sections.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="root-qname-message-selector"></a>19.3.1.&nbsp;Root QName Message Selector</h3></div></div></div><p>You can use the XML root QName of your message as selection criteria. Let's see how this works in a small example:</p><p>We have two different XML messages on a message channel waiting to be picked up by a consumer.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">HelloMessage</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrusframework.org/schema"</span>&gt;Hello Citrus&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/HelloMessage</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">GoodbyeMessage</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrusframework.org/schema"</span>&gt;Goodbye Citrus&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/GoodbyeMessage</span>&gt;</pre><p>We would like to pick up the <span class="emphasis"><em>GoodbyeMessage</em></span> in our test case. The <span class="emphasis"><em>HelloMessage</em></span> should be left on the message channel as we are not interested
            in it right now. We can define a root qname message selector in the receive action like this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"orderChannelEndpoint"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">selector</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"root-qname"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"GoodbyeMessage"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/selector</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">GoodbyeMessage</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrusframework.org/schema"</span>&gt;Goodbye Citrus&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/GoodbyeMessage</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>The Citrus receiver picks up the <span class="emphasis"><em>GoodbyeMessage</em></span> from the channel selected via the root qname of the XML message payload. Of course you can also combine message header
            selectors and root qname selectors as shown in this example below where a message header <span class="emphasis"><em>sequenceId</em></span> is added to the selection logic.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">selector</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"root-qname"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"GoodbyeMessage"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sequenceId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"1234"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/selector</span>&gt;</pre><p>As we deal with XML qname values, we can also use namespaces in our selector root qname selection.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">selector</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"root-qname"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"{http://citrusframework.org/schema}GoodbyeMessage"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/selector</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="xpath-evaluating-message-selector"></a>19.3.2.&nbsp;XPath Evaluating Message Selector</h3></div></div></div><p>It is also possible to evaluate some XPath expression on the message payload in order to select a message from a message channel. The XPath expression outcome must
            match an expected value and only then the message is consumed form the channel.</p><p>The syntax for the XPath expression is to be defined as the element name like this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">selector</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"xpath://Order/status"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"pending"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/selector</span>&gt;</pre><p>The message selector looks for order messages with <span class="emphasis"><em>status="pending"</em></span> in the message payload. This means that following messages would get 
            accepted/declined by the message selector.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Order</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">status</span>&gt;pending&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/status</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Order</span>&gt; = ACCEPTED
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Order</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">status</span>&gt;finished&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/status</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Order</span>&gt; = NOT ACCEPTED</pre><p>Of course you can also use XML namespaces in your XPath expressions when selecting messages from channels.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">selector</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"xpath://ns1:Order/ns1:status"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"pending"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/selector</span>&gt;</pre><p>Namespace prefixes must match the incoming message - otherwise the XPath expression will not work as expected. In our example the message should look like this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns1:Order</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:ns1</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrus.org/schema"</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns1:status</span>&gt;pending&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns1:status</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns1:Order</span>&gt;</pre><p>Knowing the correct XML namespace prefix is not always easy. If you are not sure which namespace prefix to choose Citrus ships with a dynamic namespace replacement 
            for XPath expressions. The XPath expression looks like this and is most flexible:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">selector</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"xpath://{http://citrus.org/schema}:Order/{http://citrus.org/schema}:status"</span> 
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"pending"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/selector</span>&gt;</pre><p>This will match all incoming messages regardless the XML namespace prefix that is used.</p></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="file"></a>Chapter&nbsp;20.&nbsp;File support</h2></div></div></div><p>In chapter <a href="#message-channel" title="Chapter&nbsp;19.&nbsp;Message channel support">Chapter&nbsp;19, <i xmlns:xlink="http://www.w3.org/1999/xlink">Message channel support</i></a> we discussed the native Spring Integration channel support which enables Citrus to interact
  with all Spring Integration messaging adapter implementations. This is a fantastic way to extend Citrus for additional transports. This interaction
  now comes handy when writing and reading files from the file system in Citrus.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="file-send"></a>20.1.&nbsp;Write files</h2></div></div></div><p>We want to use the Spring Integration file adapter for both reading and writing files with a local directory.
    Citrus can easily connect to this file adapter implementation with its message channel support. Citrus message sender and receiver speak to
    message channels that are connected to the Spring Integration file adapters.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:channel-endpoint</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"fileEndpoint"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">channel</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"fileChannel"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">file:outbound-channel-adapter</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"fileOutboundAdapter"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">channel</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"fileChannel"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">directory</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"file:${some.directory.property}"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">si:channel</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"fileChannel"</span>/&gt;</pre><p>The configuration above describes a Citrus message channel endpoint connected to a Spring Integration outbound file adapter
    that writes messages to a storage directory. With this combination you are able to write files to a directory in your Citrus test case. The
    test case uses the channel endpoint in its send action and the endpoint interacts with the Spring Integration file adapter so sending out the file.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The Spring Integration file adapter configuration components add a new namespace to our
        Spring application context. See this template which holds all necessary namespaces and schema locations:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">beans</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xsi</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:citrus</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/config"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:si</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/integration"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:file</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/integration/file"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.citrusframework.org/schema/config
        http://www.citrusframework.org/schema/config/citrus-config.xsd
        http://www.springframework.org/schema/integration
        http://www.springframework.org/schema/integration/spring-integration.xsd
        http://www.springframework.org/schema/integration/file
        http://www.springframework.org/schema/integration/file/spring-integration-file.xsd"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/beans</span>&gt;</pre></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="file-receive"></a>20.2.&nbsp;Read files</h2></div></div></div><p>The next program listing shows a possible inbound file communication. So the Spring Integration file inbound adapter will read files from a
    storage directory and publish the file contents to a message channel. Citrus can then receive those files as messages in a test case via the channel endpoint
    and validate the file contents for instance.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">file:inbound-channel-adapter</span>  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"fileInboundAdapter"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">channel</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"fileChannel"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">directory</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"file:${some.directory.property}"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">si:poller</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">fixed-rate</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"100"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/file:inbound-channel-adapter</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">si:channel</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"fileChannel"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">si:queue</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">capacity</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"25"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">si:interceptors</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.integration.transformer.MessageTransformingChannelInterceptor"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">constructor-arg</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.integration.file.transformer.FileToStringTransformer"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/constructor-arg</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/si:interceptors</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/si:channel</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:channel-endpoint</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"fileEndpoint"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">channel</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"fileChannel"</span>/&gt;</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>The file inbound adapter constructs Java file objects as the message payload by default. Citrus can only work on String
        message payloads. So we need a file transformer that converts the file objects to String payloads representing the file's content.</p></td></tr></table></div><p>This file adapter example shows how easy Citrus can work hand in hand with Spring Integration adapter implementations. The message
    channel support is a fantastic way to extend the transport and protocol support in Citrus by connecting with the very good Spring Integration
    adapter implementations. Have a closer look at the Spring Integration project for more details and other adapter implementations that you
    can use with Citrus integration testing.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="camel"></a>Chapter&nbsp;21.&nbsp;Apache Camel support</h2></div></div></div><p>Apache Camel project implements the enterprise integration patterns for building mediation and routing rules in your enterprise application. With the Citrus Camel support you are able to directly interact
    with the Apache Camel components and route definitions. You can call Camel routes and receive synchronous response messages. You can also simulate the Camel route endpoint with receiving messages and
    providing simulated response messages.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The camel components in Citrus are kept in a separate Maven module. So you should add the module
      as Maven dependency to your project accordingly.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">dependency</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">groupId</span>&gt;com.consol.citrus&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/groupId</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">artifactId</span>&gt;citrus-camel&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/artifactId</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">version</span>&gt;2.2&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/version</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/dependency</span>&gt;</pre><p>Citrus provides a special Apache Camel configuration schema that
      is used in our Spring configuration files. You have to include the citrus-camel namespace in your Spring configuration XML files as follows.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">beans</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xsi</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:citrus</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/config"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:citrus-camel</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/camel/config"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"
      http://www.springframework.org/schema/beans
      http://www.springframework.org/schema/beans/spring-beans.xsd
      http://www.citrusframework.org/schema/config
      http://www.citrusframework.org/schema/config/citrus-config.xsd
      http://www.citrusframework.org/schema/camel/config
      http://www.citrusframework.org/schema/camel/config/citrus-camel-config.xsd"</span>&gt;

      [...]

      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/beans</span>&gt;</pre><p>Now you are ready to use the Citrus Apache Camel configuration elements using the
      citrus-camel namespace prefix.</p></td></tr></table></div><p>The next sections explain the Citrus capabilities while working with Apache Camel.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="camel-endpoint"></a>21.1.&nbsp;Camel endpoint</h2></div></div></div><p>Camel and Citrus both use the endpoint pattern in order to define message destinations. Users can interact with these endpoints
      when creating the mediation and routing logic. The Citrus endpoint component for Camel interaction
      is defined as follows in your Citrus Spring configuration.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-camel:endpoint</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"directCamelEndpoint"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint-uri</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"direct:news"</span>/&gt;</pre><p>Right next to that Citrus endpoint we need the Apache Camel route that is located inside a camel context component.</p><pre class="programlisting">
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">camelContext</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"camelContext"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://camel.apache.org/schema/spring"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">route</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"newsRoute"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">from</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">uri</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"direct:news"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">to</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">uri</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"log:com.consol.citrus.camel?level=INFO"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">to</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">uri</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"seda:news-feed"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/route</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/camelContext</span>&gt;</pre><p>As you can see the Citrus camel endpoint is able to interact with the Camel route. In the example above the Camel context is placed as
      Spring bean Camel context. This would be the easiest setup to use Camel with Citrus as you can add the Camel context straight to the Spring bean
      application context. Of course you can also import your Camel context and routes from other Spring bean context files
      or you can start the Camel context routes with Java code.</p><p>In the example the Apache Camel route is listening on the route endpoint uri <span class="emphasis"><em>direct:news</em></span>. Incoming messages will be logged to the console
      using a <span class="emphasis"><em>log</em></span> Camel component. After that the message is forwarded to a <span class="emphasis"><em>seda</em></span> Camel component which is a simple queue in memory.
      So we have a small Camel routing logic with two different message transports.</p><p>The Citrus endpoint can interact with this sample route definition. The endpoint configuration holds the endpoint uri information that tells Citrus how to access the Apache Camel route destination.
      This endpoint uri can be any Camel endpoint uri that is used in a Camel route. Here we just use the direct endpoint uri <span class="emphasis"><em>direct:news</em></span> so the sample Camel route gets called directly. In your test case
      you can use this endpoint component referenced by its id or name in order to send and receive messages on the route address <span class="emphasis"><em>direct:news</em></span>. The Camel route listening on this direct address will
      be invoked accordingly.</p><p>The Apache Camel routes support asynchronous and synchronous message communication patterns. By default Citrus uses asynchronous communication with Camel routes. This means that the Citrus producer sends the exchange message
      to the route endpoint uri and is finished immediately. There is no synchronous response to await. In contrary to that the synchronous endpoint will send and receive a synchronous message on the Camel destination route. We will discuss
      this later on in this chapter. For now we have a look on how to use the Citrus camel endpoint in a test case in order to send a message to the Camel route:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"directCamelEndpoint"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"plaintext"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;Hello from Citrus!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;</pre><p>The Citrus camel endpoint component can also be used in a receive message action in your test case. In this situation you would receive a message from the route endpoint. This is especially designed for queueing endpoint routes such
      as the Camel seda component. In our example Camel route above the seda Camel component is called with the endpoint uri <span class="emphasis"><em>seda:news-feed</em></span>. This means that the Camel route is sending a message to the seda component. Citrus is able
      to receive this route message with a endpoint component like this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-camel:endpoint</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sedaCamelEndpoint"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint-uri</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"seda:news-feed"</span>/&gt;</pre><p>You can use the Citrus camel endpoint in your test case receive action in order to consume the message on the seda component.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sedaCamelEndpoint"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"plaintext"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;Hello from Citrus!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Instead of defining a static Citrus camel component you could also use the dynamic endpoint components in Citrus. This would enable you
      to send your message directly using the endpoint uri <span class="emphasis"><em>direct:news</em></span> in your test case. Read more about this in <a href="#endpoint-components" title="Chapter&nbsp;26.&nbsp;Dynamic endpoint components">Chapter&nbsp;26, <i xmlns:xlink="http://www.w3.org/1999/xlink">Dynamic endpoint components</i></a>.</p></td></tr></table></div><p>Citrus is able to send and receive messages with Camel route endpoint uri. This enables you to invoke a Camel route. The Camel components used is defined by the endpoint uri as usual. When interacting with Camel routes you might need
    to send back some response messages in order to simulate boundary applications. We will discuss the synchronous communication in the next section.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="camel-sync-endpoint"></a>21.2.&nbsp;Synchronous Camel endpoint</h2></div></div></div><p>The synchronous Apache Camel producer sends a message to some route and waits synchronously for the response to arrive. In Camel this communication is represented with the exchange pattern <span class="emphasis"><em>InOut</em></span>. The basic configuration
      for a synchronous Apache Camel endpoint component looks like follows:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-camel:sync-endpoint</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"camelSyncEndpoint"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint-uri</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"direct:hello"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">timeout</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"1000"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">polling-interval</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"300"</span>/&gt;</pre><p>Synchronous endpoints poll for synchronous reply messages to arrive. The poll interval is an optional setting in order to manage the amount of
      reply message handshake attempts. Once the endpoint was able to receive the reply message synchronously the test case can receive the reply. In case
      the reply message is not available in time we raise some timeout error and the test will fail.</p><p>In a first test scenario we write a test case the sends a message to the synchronous endpoint and waits for the synchronous reply message to arrive.
      So we have two actions on the same Citrus endpoint, first send then receive.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"camelSyncEndpoint"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"plaintext"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;Hello from Citrus!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"camelSyncEndpoint"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"plaintext"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;This is the reply from Apache Camel!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>The next variation deals with the same synchronous communication, but send and receive roles are switched. Now Citrus receives a message from a Camel route and has to provide a reply message. We handle this synchronous communication with the
      same synchronous Apache Camel endpoint component. Only difference is that we initially start the communication by receiving a message from the endpoint. Knowing this Citrus is able to send a synchronous response back. Again just use the
      same endpoint reference in your test case. So we have again two actions in our test case, but this time first receive then send.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"camelSyncEndpoint"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"plaintext"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;Hello from Apache Camel!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"camelSyncEndpoint"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"plaintext"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;This is the reply from Citrus!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;</pre><p>This is pretty simple. Citrus takes care on setting the Apache Camel exchange pattern <span class="emphasis"><em>InOut</em></span> while using synchronous communications. The Camel routes do respond and Citrus is able to receive the synchronous messages accordingly.
      With this pattern you can interact with Apache Camel routes where Citrus simulates synchronous clients and consumers.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="camel-exchange-headers"></a>21.3.&nbsp;Camel exchange headers</h2></div></div></div><p>Apache Camel uses exchanges when sending and receiving messages to and from routes. These exchanges hold specific information on the communication outcome. Citrus automatically converts these exchange information to special message header entries.
    You can validate those exchange headers then easily in your test case:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sedaCamelEndpoint"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"plaintext"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;Hello from Camel!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_camel_route_id"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"newsRoute"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_camel_exchange_id"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"ID-local-50532-1402653725341-0-3"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_camel_exchange_failed"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"false"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_camel_exchange_pattern"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"InOnly"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"CamelCorrelationId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"ID-local-50532-1402653725341-0-1"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"CamelToEndpoint"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"seda://news-feed"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>Besides the Camel specific exchange information the Camel exchange does also hold some custom properties. These properties such as <span class="emphasis"><em>CamelToEndpoint</em></span> or <span class="emphasis"><em>CamelCorrelationId</em></span> are also added automatically to the
    Citrus message header so can expect them in a receive message action.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="camel-exception-handling"></a>21.4.&nbsp;Camel exception handling</h2></div></div></div><p>Let us suppose following route definition:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">camelContext</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"camelContext"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://camel.apache.org/schema/spring"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">route</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"newsRoute"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">from</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">uri</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"direct:news"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">to</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">uri</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"log:com.consol.citrus.camel?level=INFO"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">to</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">uri</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"seda:news-feed"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">onException</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">exception</span>&gt;com.consol.citrus.exceptions.CitrusRuntimeException&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/exception</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">to</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">uri</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"seda:exceptions"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/onException</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/route</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/camelContext</span>&gt;</pre><p>The route has an exception handling block defined that is called as soon as the exchange processing ends up in some error or exception. With Citrus you can also simulate a exchange exception when sending back a synchronous response to a calling route.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sedaCamelEndpoint"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"plaintext"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;Something went wrong!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_camel_exchange_exception"</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.exceptions.CitrusRuntimeException"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_camel_exchange_exception_message"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Something went wrong!"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_camel_exchange_failed"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;</pre><p>This message as response to the <span class="emphasis"><em>seda:news-feed</em></span> route would cause Camel to enter the exception handling in the route definition. The exception handling is activated and calls the error handling route endpoint <span class="emphasis"><em>seda:exceptions</em></span>.
      Of course Citrus would be able to receive such an exception exchange validating the exception handling outcome.</p><p>In such failure scenarios the Apache Camel exchange holds the exception information (<span class="emphasis"><em>CamelExceptionCaught</em></span>) such as causing exception class and error message. These headers are present in an error scenario and can be
      validated in Citrus when receiving error messages as follows:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"errorCamelEndpoint"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"plaintext"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;Something went wrong!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_camel_route_id"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"newsRoute"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_camel_exchange_failed"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"CamelExceptionCaught"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.exceptions.CitrusRuntimeException: Something went wrong!"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>This completes the basic exception handling in Citrus when using the Apache Camel endpoints.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="camel-context"></a>21.5.&nbsp;Camel context handling</h2></div></div></div><p>In the previous samples we have used the Apache Camel context as Spring bean context that is automatically loaded when Citrus starts up. Now when using a single Camel context instance Citrus is able to automatically pick this Camel context for route
      interaction. If you use more that one Camel context you have to tell the Citrus endpoint component which context to use. The endpoint offers an optional attribute called <span class="emphasis"><em>camel-context</em></span>.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-camel:endpoint</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"directCamelEndpoint"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">camel-context</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"newsContext"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint-uri</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"direct:news"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">camelContext</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"newsContext"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://camel.apache.org/schema/spring"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">route</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"newsRoute"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">from</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">uri</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"direct:news"</span>/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">to</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">uri</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"log:com.consol.citrus.camel?level=INFO"</span>/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">to</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">uri</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"seda:news-feed"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/route</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/camelContext</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">camelContext</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloContext"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://camel.apache.org/schema/spring"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">route</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloRoute"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">from</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">uri</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"direct:hello"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">to</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">uri</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"log:com.consol.citrus.camel?level=INFO"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">to</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">uri</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"seda:hello"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/route</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/camelContext</span>&gt;</pre><p>In the example abpove we have two Camel context instances loaded. The endpoint has to pick the context to use with the attribute <span class="emphasis"><em>camel-context</em></span> which resides to the Spring bean id of the Camel context.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="vertx"></a>Chapter&nbsp;22.&nbsp;Vert.x event bus support</h2></div></div></div><p>Vert.x is an application platform for the JVM that provides a network event bus for lightweight scalable messaging solutions. The Citrus Vert.x components
  do participate on that event bus messaging as producer or consumer. With these components you can access Vert.x instances available in your network in order to
  test those Vert.x applications in some integration test scenario.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The Vert.x components in Citrus are kept in a separate Maven module. So you should add the module
      as Maven dependency to your project accordingly.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">dependency</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">groupId</span>&gt;com.consol.citrus&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/groupId</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">artifactId</span>&gt;citrus-vertx&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/artifactId</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">version</span>&gt;2.2&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/version</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/dependency</span>&gt;</pre><p>Citrus provides a special Vert.x configuration schema that
      is used in our Spring configuration files. You have to include the citrus-vertx namespace in your Spring configuration XML files as follows.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">beans</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xsi</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:citrus</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/config"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:citrus-vertx</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/vertx/config"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"
      http://www.springframework.org/schema/beans
      http://www.springframework.org/schema/beans/spring-beans.xsd
      http://www.citrusframework.org/schema/config
      http://www.citrusframework.org/schema/config/citrus-config.xsd
      http://www.citrusframework.org/schema/vertx/config
      http://www.citrusframework.org/schema/vertx/config/citrus-vertx-config.xsd"</span>&gt;

      [...]

      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/beans</span>&gt;</pre><p>Now you are ready to use the Citrus Vert.x configuration elements using the
      citrus-vertx namespace prefix.</p></td></tr></table></div><p>The next sections discuss sending and receiving operations on the Vert.x event bus with Citrus.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="vertx-endpoint"></a>22.1.&nbsp;Vert.x endpoint</h2></div></div></div><p>As usual Citrus uses an endpoint component in order to specify some message destination to send and receive messages to and from. The Vert.x endpoint component
    is defined as follows in your Citrus Spring configuration.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-vertx:endpoint</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"simpleVertxEndpoint"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">host</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"localhost"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">port</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"5001"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">pubSubDomain</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"false"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">address</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"news-feed"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"vertxInstanceFactory"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.vertx.factory.CachingVertxInstanceFactory"</span>/&gt;</pre><p>The endpoint holds some general information how to access the Vert.x event bus. Host and port values define the Vert.x Hazelcast cluster hostname and port.
      Citrus starts a new Vert.x instance using this cluster. So all other Vert.x instances connected to this cluster host will receive the event bus messages from Citrus
      during the test. In your test case you can use this endpoint component referenced by its id or name in order to send and receive messages on the event bus address <span class="emphasis"><em>news-feed</em></span>.
      In Vert.x the event bus address defines the destination for event consumers to listen on. As already mentioned cluster hostname and port are optional, so Citrus will use <span class="emphasis"><em>localhost</em></span>
      and a new random port on the cluster host if nothing is specified.</p><p>The Vert.x event bus supports publish-subscribe and point-to-point message communication patterns. By default the <span class="emphasis"><em>pubSubDomain</em></span> in Citrus is false so the event bus sender
      will initiate a point-to-point communication on the event bus address. This means that only one single consumer on the event bus address will receive the message. If there are more consumers on the address
      the first to come wins and receives the message. In contrary to that the publish-subscribe scenario would deliver the message to all available consumers on the event bus address simultaneously. You can enable the
    <span class="emphasis"><em>pubSubDomain</em></span> on the Vert.x endpoint component for this communication pattern.</p><p>The Vert.x endpoint needs a instance factory implementation in order to create the embedded Vert.x instance. By default the bean name <span class="emphasis"><em>vertxInstanceFactory</em></span> is recognized by all
      Vert.x endpoint components. We will talk about Vert.x instance factories in more detail later on in this chapter.</p><p>As message content you can send and receive JSON objects or simple character sequences to the event bus. Let us have a look at a simple sample sending action that uses the new Vert.x endpoint component:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"simpleVertxEndpoint"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"plaintext"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;Hello from Citrus!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;</pre><p>As the Vert.x Citrus endpoint is bidirectional you can also receive messages from the event bus.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"simpleVertxEndpoint"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"plaintext"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;Hello from Vert.x!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_vertx_address"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"news-feed"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>Citrus automatically adds some special message headers to the message, so you can validate the Vert.x event bus address. This completes the simple send and receive operations on a Vert.x event bus.
      Now lets move on to synchronous endpoints where Citrus waits for a reply on the event bus.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="vertx-sync-endpoint"></a>22.2.&nbsp;Synchronous Vert.x endpoint</h2></div></div></div><p>The synchronous Vert.x event bus producer sends a message and waits synchronously for the response to arrive on some reply
      address destination. The reply address name is generated automatically and set in the request message header attributes so the receiving
      counterpart in this communication can send its reply to that event bus address. The basic configuration for a synchronous Vert.x endpoint component looks like follows:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-vertx:sync-endpoint</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"vertxSyncEndpoint"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">address</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"hello"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">timeout</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"1000"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">polling-interval</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"300"</span>/&gt;</pre><p>Synchronous endpoints poll for synchronous reply messages to arrive on the event bus reply address. The poll interval is an optional setting in order to manage the amount of
      reply message handshake attempts. Once the endpoint was able to receive the reply message synchronously the test case can receive the reply. In case
      all message handshake attempts do fail because the reply message is not available in time we raise some timeout error and the test will fail.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The Vert.x endpoint uses temporary reply address destinations. The temporary reply address in generated and is only used once for a single communication handshake.
        After that the reply address is dismissed again.</p></td></tr></table></div><p>When sending a message to the synchronous Vert.x endpoint the producer will wait synchronously for the response message
      to arrive on the reply address. You can receive the reply message in your test case using the same endpoint component.
      So we have two actions on the same endpoint, first send then receive.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"vertxSyncEndpoint"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"plaintext"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;Hello from Citrus!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"vertxSyncEndpoint"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"plaintext"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;This is the reply from Vert.x!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>In the last section we saw that synchronous communication is based on reply messages on temporary reply event bus address. We saw that
      Citrus is able to send messages to event bus address and wait for reply messages to arrive. This next section deals with the same
      synchronous communication, but send and receive roles are switched. Now Citrus receives a message and has to send a reply message to a temporary reply address.</p><p>We handle this synchronous communication with the same synchronous Vert.x endpoint component. Only difference is that we initially start
      the communication by receiving a message from the endpoint. Knowing this Citrus is able to send a synchronous response back. Again just use the
      same endpoint reference in your test case. The handling of the temporary reply address is done automatically behind the scenes. So we have again
      two actions in our test case, but this time first receive then send.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"vertxSyncEndpoint"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"plaintext"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;Hello from Vert.x!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"vertxSyncEndpoint"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"plaintext"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;This is the reply from Citrus!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;</pre><p>The synchronous message endpoint for Vert.x event bus communication will handle all reply address destinations and provide those behind the scenes.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="vertx-instance-factory"></a>22.3.&nbsp;Vert.x instance factory</h2></div></div></div><p>Citrus starts an embedded Vert.x instance at runtime in order to participate in the Vert.x cluster. Within this cluster multiple Vert.x instances are connected via the event bus. For
    starting the Vert.x event bus Citrus uses a cluster hostname and port definition. You can customize this cluster host in order to connect to a very special cluster in your network.</p><p>Now Citrus needs to manage the Vert.x instances created during the test run. By default Citrus will look for a instance factory bean named <span class="emphasis"><em>vertxInstanceFactory</em></span>.
    You can choose the factory implementation to use in your project. By default you can use the caching factory implementation that caches the Vert.x instances so we do not connect more than
    one Vert.x instance to the same cluster host. Citrus offers following instance factory implementations:</p><div class="itemizedlist"><ul type="disc"><li><code class="literal">com.consol.citrus.vertx.factory.CachingVertxInstanceFactory</code> - default implementation that reuses the Vert.x instance based on given cluster host and port. With this implementation we ensure to
      connect a single Citrus Vert.x instance to a cluster host.</li><li><code class="literal">com.consol.citrus.vertx.factory.SingleVertxInstanceFactory</code> - creates a single Vert.x instance and reuses this instance for all endpoints. You can also set your very custom Vert.x instance via configuration
      for custom Vert.x instantiation.</li></ul></div><p>The instance factory implementations do implement the <code class="literal">VertxInstanceFactory</code> interface. So you can also provide your very special implementation. By default Citrus looks
      for a bean named <span class="emphasis"><em>vertxInstanceFactory</em></span> but you can also define your very special factory implementation onm an endpoint component. The Vert.x instance factory is set on the Vert.x endpoint as follows:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-vertx:endpoint</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"vertxHelloEndpoint"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">address</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"hello"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">vertx-factory</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"singleVertxInstanceFactory"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"singleVertxInstanceFactory"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.vertx.factory.SingleVertxInstanceFactory"</span>/&gt;</pre></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="mail"></a>Chapter&nbsp;23.&nbsp;Mail support</h2></div></div></div><p>Sending and receiving mails is the next interest we are going to talk about. When dealing with mail communication
  you most certainly need to interact with some sort of IMAP or POP mail server. But in Citrus we do not want to manage
  mails in a personal inbox. We just need to be able to exchange mail messages the persisting in a user inbox is not part
  of our business.</p><p>This is why Citrus provides <span class="emphasis"><em>just</em></span> a SMTP mail server which accepts mail messages from clients.
  Once the SMTP server has accepted an incoming mail it forwards those data to the running test case. In the test case
  you can receive the incoming mail message and perform message validation as usual. The mail sending part is easy as
  Citrus offers a mail client that connects to some SMTP server for sending mails to the outside world.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>The mail components in Citrus are kept in a separate Maven module. So you should check that the module
      is available as Maven dependency in your project</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">dependency</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">groupId</span>&gt;com.consol.citrus&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/groupId</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">artifactId</span>&gt;citrus-mail&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/artifactId</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">version</span>&gt;2.2&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/version</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/dependency</span>&gt;</pre><p>As usual Citrus provides a customized mail configuration schema that
      is used in Spring configuration files. Simply include the citrus-mail namespace in the configuration XML files as follows.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">beans</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xsi</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:citrus</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/config"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:citrus-mail</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/mail/config"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"
      http://www.springframework.org/schema/beans
      http://www.springframework.org/schema/beans/spring-beans.xsd
      http://www.citrusframework.org/schema/config
      http://www.citrusframework.org/schema/config/citrus-config.xsd
      http://www.citrusframework.org/schema/mail/config
      http://www.citrusframework.org/schema/mail/config/citrus-mail-config.xsd"</span>&gt;

      [...]

      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/beans</span>&gt;</pre><p>Now you are ready to use the customized Http configuration elements with the
      citrus-mail namespace prefix.</p></td></tr></table></div><p>Read the next section in order to find out more about the mail message support in Citrus.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mail-client"></a>23.1.&nbsp;Mail client</h2></div></div></div><p>The mail sending part is quite easy and straight forward. We just need to send a mail message to some SMTP server. So
    Citrus provides a mail client that sends out mail messages.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-mail:client</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"simpleMailClient"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">host</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"localhost"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">port</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"25025"</span>/&gt;</pre><p>This is how a Citrus mail client component is defined in the Spring application context. You can use this client
    referenced by its id or name in your test case in a message sending action. The client defines a host and port attribute which should
    connect the client to some SMTP server instance.</p><p>We all know mail message contents. The mail message has some general properties set by the user:</p><div class="itemizedlist"><ul type="disc"><li>from: The message sender mail address</li><li>to: The message recipient mail address. You can add multiple recipients by using a comma separated list.</li><li>cc: Copy recipient mail address. You can add multiple recipients by using a comma separated list.</li><li>bcc: Blind copy recipient mail address. You can add multiple recipients by using a comma separated list.</li><li>subject: Some subject used as mail head line.</li></ul></div><p>As a tester you are able to set these properties in your test case. Citrus defines a XML mail message representation that you can
    use inside your send action. Let us have a look at this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"simpleMailClient"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">mail-message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/mail/message"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">from</span>&gt;christoph@citrusframework.com&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/from</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">to</span>&gt;dev@citrusframework.com&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/to</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">cc</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/cc</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bcc</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bcc</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">subject</span>&gt;This is a test mail message&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/subject</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">body</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">contentType</span>&gt;text/plain; charset=utf-8&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/contentType</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">content</span>&gt;Hello Citrus mail server!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/content</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/body</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/mail-message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;</pre><p>The basic XML mail message representation defines a list of basic mail properties such as <span class="emphasis"><em>from</em></span>, <span class="emphasis"><em>to</em></span> or
    <span class="emphasis"><em>subject</em></span>. In addition to that we define a text body which is either plain text or HTML. You can specify the content type of the mail
    body very easy (e.g. text/plain or text/html). By default Citrus uses <span class="emphasis"><em>text/plain</em></span> content type.</p><p>Now when dealing with mail messages you often come to use multipart structures for attachments. In Citrus you can define
    attachment content as base64 character sequence. The Citrus mail client will automatically create a proper multipart mail mime message
    using the content types and body parts specified.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"simpleMailClient"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">mail-message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/mail/message"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">from</span>&gt;christoph@citrusframework.com&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/from</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">to</span>&gt;dev@citrusframework.com&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/to</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">cc</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/cc</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bcc</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bcc</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">subject</span>&gt;This is a test mail message&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/subject</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">body</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">contentType</span>&gt;text/plain; charset=utf-8&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/contentType</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">content</span>&gt;Hello Citrus mail server!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/content</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">attachments</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">attachment</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">contentType</span>&gt;text/plain; charset=utf-8&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/contentType</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">content</span>&gt;This is attachment data&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/content</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">fileName</span>&gt;attachment.txt&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/fileName</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/attachment</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/attachments</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/body</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/mail-message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;</pre><p>That completes the basic mail client capabilities. But wait we have not talked about error scenarios where mail communication
    results in error. When running into mail error scenarios we have to handle the error respectively with exception handling. When
    the mail server responded with errors Citrus will raise mail exceptions automatically and your test case fails accordingly.</p><p>As a tester you can catch and assert these mail exceptions verifying your error scenario.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">assert</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">exception</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.mail.MailSendException"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"simpleMailClient"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">mail-message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/mail/message"</span>&gt;
                    [...]
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/mail-message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">assert</span>/&gt;</pre><p>We assert the <code class="literal">MailSendException</code> from Spring to be thrown while sending the mail message to the SMTP server.
    With exception message validation you are able to expect very specific mail send errors on the client side. This is how you can handle
    some sort of error situation returned by the mail server. Speaking of mail servers we need to also talk about providing a mail server
    endpoint in Citrus for clients. This is part of our next section.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mail-server"></a>23.2.&nbsp;Mail server</h2></div></div></div><p>Consuming mail messages is a more complicated task as we need to have some sort of server that clients can connect to. In
    your mail client software you typically point to some IMAP or POP inbox and receive mails from that endpoint. In Citrus we do not
    want to manage a whole personal mail inbox such as IMAP or POP would provide. We just need a SMTP server endpoint for clients to
    send mails to. The SMTP server accepts mail messages and forwards those to a running test case for further validation.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>We have no user inbox where incoming mails are stored. The mail server just forwards incoming mails to the running test
      for validation. After the test the incoming mail message is gone.</p></td></tr></table></div><p>And this is exactly what the Citrus mail server is capable of. The server is a very lightweight SMTP server. All incoming
    mail client connections are accepted by default and the mail data is converted into a Citrus XML mail interface representation.
    The XML mail message is then passed to the running test for validation.</p><p>Let us have a look at the Citrus mail server component and how you can add it to the Spring application context.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-mail:server</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"simpleMailServer"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">port</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"25025"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">auto-start</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>/&gt;</pre><p>The mail server component receives several properties such as <span class="emphasis"><em>port</em></span> or <span class="emphasis"><em>auto-start</em></span>. Citrus
    starts a in memory SMTP server that clients can connect to.</p><p>In your test case you can then receive the incoming mail messages on the server in order to perform the well known XML validation mechanisms
    within Citrus. The message header and the payload contain all mail information so you can verify the content with
    expected templates as usual:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"simpleMailServer"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">mail-message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/mail/message"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">from</span>&gt;christoph@citrusframework.com&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/from</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">to</span>&gt;dev@citrusframework.com&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/to</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">cc</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/cc</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bcc</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bcc</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">subject</span>&gt;This is a test mail message&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/subject</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">body</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">contentType</span>&gt;text/plain; charset=utf-8&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/contentType</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">content</span>&gt;Hello Citrus mail server!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/content</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/body</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/mail-message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_mail_from"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"christoph@citrusframework.com"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_mail_to"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"dev@citrusframework.com"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_mail_subject"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"This is a test mail message"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_mail_content_type"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"text/plain; charset=utf-8"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>The general mail properties such as <span class="emphasis"><em>from</em></span>, <span class="emphasis"><em>to</em></span>, <span class="emphasis"><em>subject</em></span>
    are available as elements in the mail payload and in the message header information. The message header names do start with a common Citrus mail prefix
    <span class="emphasis"><em>citrus_mail</em></span>. Following from that you can verify these special mail message headers in your test
    as shown above. Citrus offers following mail headers:</p><div class="itemizedlist"><ul type="disc"><li>citrus_mail_from</li><li>citrus_mail_to</li><li>citrus_mail_cc</li><li>citrus_mail_bcc</li><li>citrus_mail_subject</li><li>citrus_mail_replyTo</li><li>citrus_mail_date</li></ul></div><p>In addition to that Citrus converts the incoming mail data to a special XML mail representation which is passed as
    message payload to the test. The mail body parts are represented as body and optional attachment elements. As this is
    plain XML you can verify the mail message content as usual using Citrus variables, functions and validation matchers.</p><p>Regardless of how the mail message has passed the validation the Citrus SMTP mail server will automatically respond
    with success codes (SMTP 250 OK) to the calling client. This is the basic Citrus mail server behavior where all client
    connections are accepted an all mail messages are responded with SMTP 250 OK response codes.</p><p>Now in more advanced usage scenarios the tester may want to control the mail communication outcome. User can force
    some error scenarios where mail clients are not accepted or mail communication should fail with some SMTP error state for instance.</p><p>By using a more advanced mail server setup the tester gets more power to sending back mail server response
    codes to the mail client. Just use the advanced mail adapter implementation in your mail server component configuration:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-mail:server</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"advancedMailServer"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">auto-accept</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"false"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">split-multipart</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">port</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"25025"</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">auto-start</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>/&gt;</pre><p>We have disabled the <span class="emphasis"><em>auto-accept</em></span> mode on the mail server. This means that we have to do some additional steps
    in your test case to accept the incoming mail message first. So we can decide in our test case whether to accept or decline the incoming
    mail message for a more powerful test. You accept/decline a mail message with a special XML accept request/response exchange in your test case:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"advancedMailServer"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">accept-request</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/mail/message"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">from</span>&gt;christoph@citrusframework.com&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/from</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">to</span>&gt;dev@citrusframework.com&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/to</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/accept-request</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>So before receiving the actual mail message we receive this simple accept-request in our test. The accept request gives us the message <span class="emphasis"><em>from</em></span>
    and <span class="emphasis"><em>to</em></span> resources of the mail message. Now the test decides to also decline a mail client connection. You can simulate that the server does not accept the mail
    client connection by sending back a negative accept response.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"advancedMailServer"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">accept-response</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/mail/message"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">accept</span>&gt;true&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/accept</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/accept-response</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;</pre><p>Depending on the accept outcome the mail client will receive an error response with proper error codes. If you accept the mail message with a positive accept response the next
    step in your test receives the actual mail message as we have seen it before in this chapter.</p><p>Now besides not accepting a mail message in the first place you can als simulate another error scenario with the mail server. In this scenario the mail server should
    respond with some sort of SMTP error code after accepting the message. This is done with a special mail response message like this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"advancedMailServer"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">mail-message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/mail/message"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">from</span>&gt;christoph@citrusframework.com&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/from</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">to</span>&gt;dev@citrusframework.com&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/to</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">cc</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/cc</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bcc</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bcc</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">subject</span>&gt;This is a test mail message&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/subject</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">body</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">contentType</span>&gt;text/plain; charset=utf-8&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/contentType</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">content</span>&gt;Hello Citrus mail server!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/content</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/body</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/mail-message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"advancedMailServer"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">mail-response</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/mail/message"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">code</span>&gt;443&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/code</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;Failed!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/mail-response</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;</pre><p>As you can see from the example above we first accept the connection and receive the mail content as usual. Now the test returns a negative mail response
    with some error code reason set. The Citrus SMTP communication will then fail and the calling mail client receives the respective error.</p><p>If you skip the negative mail response the server will automatically response with positive SMTP response codes to the calling client.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="arquillian"></a>Chapter&nbsp;24.&nbsp;Arquillian support</h2></div></div></div><p>Arquillian is a well known integration test framework that comes with a great feature set when it comes to Java EE testing inside of a full qualified application server. With Arquiliian you can deploy your
    Java EE services in a real application server of your choice and execute the tests inside the application server boundaries. This makes it very easy to test your Java EE services in scope with proper JNDI resource
    allocation and other resources provided by the application server. Citrus is able to connect with the Arquillian test case. Speaking in more detail your Arquillian test is able to use a Citrus extension in order
    to use the Citrus feature set inside the Arquillian boundaries.</p><p>Read the next section in order to find out more about the Citrus Arquillian extension.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="arquillian-extension"></a>24.1.&nbsp;Citrus Arquillian extension</h2></div></div></div><p>Arquillian offers a fine mechanism for extensions adding features to the Arquillian test setup and test execution. The Citrus extension respectively adds Citrus framework instance creation and Citrus test execution to the
      Arquillian world. First of all lets have a look at the extension descriptor properties settable via <span class="emphasis"><em>arquillian.xml</em></span>:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">extension</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">qualifier</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrusVersion"</span>&gt;2.2&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"autoPackage"</span>&gt;true&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"suiteName"</span>&gt;citrus-arquillian-suite&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/extension</span>&gt;</pre><p>The Citrus extension uses a specific qualifier <span class="emphasis"><em>citrus</em></span> for defining properties inside the Arquillian descriptor. Following properties are settable in current version:</p><div class="itemizedlist"><ul type="disc"><li>citrusVersion: The explicit version of Citrus that should be used. Be sure to have the same library version available in your project (e.g. as Maven dependency). This property is optional.
        By default the extension just uses the latest stable version.</li><li>autoPackage: When true (default setting) the extension will automatically add Citrus libraries and all transitive dependencies to the test deployment. This automatically enables you to use the Citrus API inside the Arquillian test
        even when the test is executed inside the application container.</li><li>suiteName: This optional setting defines the name of the test suite that is used for the Citrus test run. When using before/after suite functionality in Citrus this setting might be of interest.</li><li>configurationClass: Full qualified Java class name of customized Citrus Spring bean configuration to use when loading the Citrus Spring application context. As a user you can define a custom configuration class that must
      be a subclass of <span class="emphasis"><em>com.consol.citrus.config.CitrusBaseConfig</em></span>. When specified the custom class is loaded otherwise the default <span class="emphasis"><em>com.consol.citrus.config.CitrusBaseConfig</em></span> is loaded to set up the
      Spring application context.</li></ul></div><p>Now that we have added the extension descriptor with all properties we need to add the respective Citrus Arquillian extension as library to our project. This is done via Maven in your project's POM file as normal dependency:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">dependency</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">groupId</span>&gt;com.consol.citrus&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/groupId</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">artifactId</span>&gt;citrus-arquillian&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/artifactId</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">version</span>&gt;2.2&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/version</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scope</span>&gt;test&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scope</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/dependency</span>&gt;</pre><p>Now everything is set up to use Citrus within Arquillian. Lets use Citrus functionality in a Arquillian test case.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="arquillian-client"></a>24.2.&nbsp;Client side testing</h2></div></div></div><p>Arquillian separates client and container side testing. When using client side testing the test case is executed outside of the application container deployment. This means that your test case has no direct access to container managed resources such as JNDI resources.
      On the plus side it is not necessary to include your test in the container deployment. The test case interacts with the container deployment as a normal client would do. Lets have a look at a first example:</p><pre class="programlisting">@RunWith(Arquillian.<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">class</span>)
@RunAsClient
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">class</span> EmployeeResourceTest {

    @CitrusFramework
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">private</span> Citrus citrusFramework;

    @ArquillianResource
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">private</span> URL baseUri;

    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">private</span> String serviceUri;

    @Deployment
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">static</span> WebArchive createDeployment() {
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">return</span> ShrinkWrap.create(WebArchive.<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">class</span>)
            .addClasses(RegistryApplication.<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">class</span>, EmployeeResource.<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">class</span>,
                Employees.<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">class</span>, Employee.<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">class</span>, EmployeeRepository.<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">class</span>);
    }

    @Before
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> setUp() <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">throws</span> MalformedURLException {
        serviceUri = <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">new</span> URL(baseUri, <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"registry/employee"</span>).toExternalForm();
    }

    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">/**
    * Test adding new employees and getting list of all employees.
    */</span>
    @Test
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> testCreateEmployeeAndGet(@CitrusTest CitrusTestBuilder citrus) {
        citrus.send(serviceUri)
            .message(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">new</span> HttpMessage(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"name=Penny&amp;age=20"</span>)
            .method(HttpMethod.POST)
            .contentType(MediaType.APPLICATION_FORM_URLENCODED));

        citrus.receive(serviceUri)
            .message(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">new</span> HttpMessage()
            .statusCode(HttpStatus.NO_CONTENT));

        citrus.send(serviceUri)
            .message(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">new</span> HttpMessage()
            .method(HttpMethod.GET)
            .accept(MediaType.APPLICATION_XML));

        citrus.receive(serviceUri)
        .message(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">new</span> HttpMessage(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"&lt;employees&gt;"</span> +
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"&lt;employee&gt;"</span> +
              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"&lt;age&gt;20&lt;/age&gt;"</span> +
              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"&lt;name&gt;Penny&lt;/name&gt;"</span> +
              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"&lt;/employee&gt;"</span> +
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"&lt;/employees&gt;"</span>)
        .statusCode(HttpStatus.OK));

        citrusFramework.run(citrus.build());
    }
}</pre><p>First of all we use the basic Arquillian JUnit test runner <span class="emphasis"><em>@RunWith(Arquillian.class)</em></span> in combination with the <span class="emphasis"><em>@RunAsClient</em></span> annotation telling Arquillian that this is a client side test case.
      As this is a usual Arquillian test case we have access to Arquillian resources that automatically get injected such as the base uri of the test deployment. The test deployment is a web deployment created via ShrinkWrap. We add the application
      specific classes that build our remote RESTful service that we would like to test.</p><p>The Citrus Arquillian extension is able to setup a proper Citrus test environment in the background. As a result the test case can reference a Citrus framework instance with the <span class="emphasis"><em>@CitrusFramework</em></span> annotation. We will use
    this instance of Citrus later on when it comes to execute the Citrus testing logic.</p><p>No we can focus on writing a test method which is again nothing but a normal JUnit test method. The Citrus extension takes care on injecting the <span class="emphasis"><em>@CitrusTest</em></span> annotated method parameter. With this Citrus test builder instance
    we can build a Citrus test logic for sending and receiving messages via Http in order to call the remote RESTful employee service of our test deployment. The Http endpoint uri is injected via Arquillian and we are able to call the remote service as
    a client.</p><p>The respective result is received with well known Citrus receive message logic. We can validate the response messages accordingly and make sure the client call was done right. The very last statement in out test method executes the Citrus test
    logic within the Citrus framework boundaries. As a result the JUnit test method is successful or failed with errors coming from Citrus test execution.</p><p>This is how Citrus and Arquillian can interact in a test scenario where the test deployment is managed by Arquillian and the client side actions take place within Citrus. This is a great way to combine both frameworks with Citrus being able
    to call different service API endpoints in addition with validating the outcome. This was a client side test case where the test logic was executed outside of the application container. Arquillian also supports container remote test cases where we
    have direct access to container managed resources. The following section describes how this works with Citrus.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="arquillian-container"></a>24.3.&nbsp;Container side testing</h2></div></div></div><p>In previous sections we have seen how to combine Citrus with Arquillian in a client side test case. This is the way to go for all test cases that do not need to have access on container managed resources. Lets have a look at a sample where
    we want to gain access to a JMS queue and connection managed by the application container.</p><pre class="programlisting">@RunWith(Arquillian.<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">class</span>)
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">class</span> EchoServiceTest {

      @CitrusFramework
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">private</span> Citrus citrusFramework;

      @Resource(mappedName = <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"jms/queue/test"</span>)
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">private</span> Queue echoQueue;

      @Resource(mappedName = <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"/ConnectionFactory"</span>)
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">private</span> ConnectionFactory connectionFactory;

      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">private</span> JmsSyncEndpoint jmsSyncEndpoint;

      @Deployment
      @OverProtocol(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"Servlet 3.0"</span>)
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">static</span> WebArchive createDeployment() <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">throws</span> MalformedURLException {
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">return</span> ShrinkWrap.create(WebArchive.<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">class</span>)
                  .addClasses(EchoService.<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">class</span>);
      }

      @Before
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> setUp() {
          JmsSyncEndpointConfiguration endpointConfiguration = <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">new</span> JmsSyncEndpointConfiguration();
          endpointConfiguration.setConnectionFactory(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">new</span> SingleConnectionFactory(connectionFactory));
          endpointConfiguration.setDestination(echoQueue);
          jmsSyncEndpoint = <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">new</span> JmsSyncEndpoint(endpointConfiguration);
      }

      @After
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> cleanUp() {
          closeConnections();
      }

      @Test
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">public</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> shouldBeAbleToSendMessage(@CitrusTest CitrusTestBuilder citrus) <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">throws</span> Exception {
          String messageBody = <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-string">"ping"</span>;

          citrus.send(jmsSyncEndpoint)
                .messageType(MessageType.PLAINTEXT)
                .message(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">new</span> JmsMessage(messageBody));

          citrus.receive(jmsSyncEndpoint)
                .messageType(MessageType.PLAINTEXT)
                .message(<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">new</span> JmsMessage(messageBody));

          citrusFramework.run(citrus.build());
      }

      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">private</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-keyword">void</span> closeConnections() {
          ((SingleConnectionFactory)jmsSyncEndpoint.getEndpointConfiguration().getConnectionFactory()).destroy();
      }
}</pre><p>As you can see the test case accesses two container managed resources via JNDI. This is a JMS queue and a JMS connection that get automatically injected as resources. In a before test annotated method we can use
      these resources to build up a proper Citrus JMS endpoint. Inside the test method we can use the JMS endpoint for sending and receiving JMS messages via Citrus. As usual response messages received are validated and
      compared to an expected message. After the test we should close the JMS connection in order to avoid exceptions when the application container is shutting down after the test.</p><p>The test is now part of the test deployment and is executed within the application container boundaries. As usual we can use the Citrus extension to automatically inject the Citrus framework instance as well as the
    Citrus test builder instance for building the Citrus test logic.</p><p>This is how to combine Citrus and Arquillian in order to build integration tests on Java EE services in a real application container environment. With Citrus you are able to set up more complex test scenarios with
      simulated services such as mail or ftp servers. We can build Citrus endpoints with container managed resources.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="ssh"></a>Chapter&nbsp;25.&nbsp;SSH support</h2></div></div></div><p>In the spirit of other Citrus mock services, there is support for simulating an external SSH server as well as
    for connecting to SSH servers as a client during the test execution. Citrus translates SSH requests and responses to
    simple XML documents for better validation with the common Citrus mechanisms.</p><p>This means that the Citrus test case does not deal with pure SSH protocol commands. Instead of this we use the powerful
    XML validation capabilities in Citrus when dealing with the simple XML documents that represent the SSH request/response data.</p><p>Let us clarify this with a little example. Once the real SSH server daemon is fired up within Citrus we accept a SSH EXEC request
    for instance. The request is translated into a XML message of the following format:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ssh-request</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/ssh/message"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">command</span>&gt;cat - | sed -e 's/Hello/Hello SSH/'&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/command</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">stdin</span>&gt;Hello World&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/stdin</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ssh-request</span>&gt;</pre><p>This message can be validated with the usual Citrus mechanism in a receive test action. If you do not know how to do this, please read
    one of the sections about XML message validation in this reference guide first. Now after having received this request message the respective 
    SSH response should be provided as appropriate answer. This is done with a message sending action on a reply handler as it is known from synchronous
    http message communication in Citrus for instance. The SSH XML representation of a response message looks like this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ssh-response</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/ssh/message"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">stdout</span>&gt;Hello SSH World&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/stdout</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">stderr</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/stderr</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">exit</span>&gt;0&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/exit</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ssh-response</span>&gt;</pre><p>Besides simulating a full featured SSH server, Citrus also provides SSH client functionality. This client 
    uses the same request message pattern, which is translated into a real SSH call to an SSH server. The SSH response received is also translated 
    into a XML message as shown above so we can validate it with known validation mechanisms in Citrus.</p><p>Similar to the other Citrus modules (http, soap), a Citrus SSH server and client is configured in Citrus 
    Spring application context. There is a dedicated <span class="emphasis"><em>ssh</em></span> namespace available for all ssh Citrus components. 
    The namespace declaration goes into the context top-level element as usual:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">beans</span> 
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">[...]</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:citrus-ssh</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/ssh/config"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">[...]</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"
        [...]
        http://www.citrusframework.org/schema/ssh/config
        http://www.citrusframework.org/schema/ssh/config/citrus-ssh-config.xsd
        [...] "</span>&gt;
   [...]
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/beans</span>&gt;</pre><p>Both, SSH server and client along with their configuration options are described in the following two sections.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ssh-client"></a>25.1.&nbsp;SSH Client</h2></div></div></div><p>A Citrus SSH client is useful for testing against a real SSH server. So Citrus is able to invoke SSH commands on the external server
      and validate the SSH response accordingly. The test case does not deal with the pure SSH protocol within this communication. The Citrus SSH 
      client component expects a customized XML representation and automatically translates these request messages into a real SSH call to a 
      specific host. Once the synchronous SSH response was received the result gets translated back to the XML response message representation. 
      On this translated response we can easily apply the validation steps by the usual Citrus means.</p><p>The SSH client components receive its configuration in the Spring application context as usual. We can use the special SSH module namespace
      for easy configuration:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-ssh:client</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sshClient"</span>
           <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">port</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"9072"</span>
           <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">user</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"roland"</span>
           <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">private-key-path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:com/consol/citrus/ssh/test_user.priv"</span>
           <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">strict-host-checking</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"false"</span>
           <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">host</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"localhost"</span>/&gt;</pre><p><span class="emphasis"><em>The SSH client receives several attributes, these are:</em></span></p><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>id:</em></span>
        Id identifying the bean and used as reference from with test descriptions.
        (e.g. id="sshClient")</p></li><li><p><span class="emphasis"><em>host:</em></span>
        Host to connect to for sending an SSH Exec request. Default is 'localhost'
        (e.g. host="localhost")</p></li><li><p><span class="emphasis"><em>port</em></span>
        Port to use. Default is 2222 (e.g. port="9072")</p></li><li><p><span class="emphasis"><em>private-key-path:</em></span>
        Path to a private key, which can be either a plain file path or an class resource if prefixed with 'classpath'
        (e.g. private-key-path="classpath:test_user.priv")</p></li><li><p><span class="emphasis"><em>private-key-password:</em></span>
        Optional password for the private key (e.g. password="s!cr!t")</p></li><li><p><span class="emphasis"><em>user:</em></span>
        User used for connecting to the SSH server (e.g. user="roland")</p></li><li><p><span class="emphasis"><em>password:</em></span>
        Password used for password based authentication. Might be combined with "private-key-path" in which 
        case both authentication mechanism are tried (e.g. password="ps!st)</p></li><li><p><span class="emphasis"><em>strict-host-checking:</em></span>
        Whether the host key should be verified by looking it up in a 'known_hosts' file. Default is false
        (e.g. strict-host-checking="true")</p></li><li><p><span class="emphasis"><em>known-hosts-path:</em></span>
        Path to a known hosts file. If prefixed with 'classpath:' this file is looked up as a resource in the classpath
        (e.g. known-hosts-path="/etc/ssh/known_hosts")</p></li><li><p><span class="emphasis"><em>command-timeout:</em></span>
        Timeout in milliseconds for how long to wait for the SSH command to complete. Default is 5 minutes
        (e.g. command-timeout="300000")</p></li><li><p><span class="emphasis"><em>connection-timeout:</em></span>
        Timeout in milliseconds for how long to for a connectiuon to connect. Default is 1 minute
        (e.g. connection-timeout="60000")</p></li><li><p><span class="emphasis"><em>actor</em></span>:
        Actor used for switching groups of actions (e.g. actor="ssh-mock")</p></li></ul></div><p>Once defines as client component in the Spring application context test cases can reference the client in every send test action.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sshClient"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ssh-request</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/ssh/message"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">command</span>&gt;shutdown&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/command</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">stdin</span>&gt;input&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/stdin</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ssh-request</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;
  
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sshClient"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ssh-response</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/ssh/message"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">stdout</span>&gt;Hello Citrus&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/stdout</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">stderr</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">exit</span>&gt;0&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/exit</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ssh-response</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;</pre><p>As you can see we use usual send and receive test actions. The XML SSH representation helps us to 
      specify the request and response data for validation. This way you can call SSH commands against an external 
      SSH server and validate the response data.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ssh-server"></a>25.2.&nbsp;SSH Server</h2></div></div></div><p>Now that we have used Citrus on the client side we can also use Citrus SSH server module in order to provide a full stacked
      SSH server deamon. We can accept SSH client connections and provide proper response messages as an answer.</p><p>Given the above SSH module namespace declaration, adding a new SSH server is quite simple:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-ssh:server</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sshServer"</span>
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">allowed-key-path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:com/consol/citrus/ssh/test_user_pub.pem"</span>
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">user</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"roland"</span>
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">port</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"9072"</span>
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">auto-start</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint-adapter</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sshEndpointAdapter"</span>/&gt;</pre><p><span class="emphasis"><em>endpoint-adapter</em></span> is the handler which receives the SSH request as messages
      (in the request format described above). Endpoint adapter implementations are fully described in <a href="#http-server" title="16.2.&nbsp;HTTP REST server">Section&nbsp;16.2, &#8220;HTTP REST server&#8221;</a>
      All adapters described there are supported in SSH server module, too.</p><p>The <span class="emphasis"><em>&lt;citrus-ssh:server&gt;</em></span> supports the following attributes:</p><p><span class="emphasis"><em>SSH Server Attributes:</em></span></p><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>id:</em></span> 
        Name of the SSH server which identifies it unique within the Citrus Spring context
        (e.g. id="sshServer")</p></li><li><p><span class="emphasis"><em>host-key-path:</em></span>
        Path to PEM encoded key pair (public and private key) which is used as host key.  By default, a standard, 
        pre-generate, fixed keypair is used. The path can be specified either as an file path, or, if prefixed with
        <span class="emphasis"><em>classpath:</em></span> is looked up from within the classpath. The path the is relative from to 
        the top-level package, so no leading slash should be used
        (e.g. hist-key-path="/etc/citrus_ssh_server.pem)</p></li><li><p><span class="emphasis"><em>user:</em></span>
        User which is allowed to connect (e.g. user="roland")</p></li><li><p><span class="emphasis"><em>allowed-key-path:</em></span>
        Path to a SSH public key stored in PEM format. These are the keys, which are allowed to connect to 
        the SSH server when publickey authentication is used. It seves the same purpose as <code class="filename">authorized_keys</code> 
        for standard SSH installations. The path can be specified either as an file path, or, if prefixed with 
        <span class="emphasis"><em>classpath:</em></span> is looked up from within the classpath. The path the is relative from to the 
        top-level package, so no leading slash should be used
        (e.g. allowed-key-path="classpath:test_user_pub.pem)</p></li><li><p><span class="emphasis"><em>password:</em></span>
        Password which should be used when password authentication is used. Both publickey authentication 
        and password based authentication can be used together in which case both methods are tried in turn
        (e.g. password="s!cr!t")</p></li><li><p><span class="emphasis"><em>host:</em></span>
        Host address (e.g. localhost)</p></li><li><p><span class="emphasis"><em>port:</em></span>
        Port on which to listen. The SSH server will bind on localhost to this port
        (e.g. port="9072")</p></li><li><p><span class="emphasis"><em>auto-start:</em></span>
        Whether to start this SSH server automatically. Default is <span class="emphasis"><em>true</em></span>. If set to
        <span class="emphasis"><em>false</em></span>, a test action is responsible for starting/stopping the server
        (e.g. auto-start="true")</p></li><li><p><span class="emphasis"><em>endpoint-adapter:</em></span>
        Bean reference to a endpoint adapter which processes the incoming SSH request. The message format for the request
        and response are described above (e.g. endpoint-adapter="sshEndpointAdapter")</p></li></ul></div><p>Once the SSH server component is added to the Spring application context with a proper endpoint adapter like the MessageChannel
      forwarding adapter we can receive incoming requests in a test case and provide a respone message for the client.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sshServer"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ssh-request</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/ssh/message"</span>&gt;
           &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">command</span>&gt;shutdown&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/command</span>&gt;
           &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">stdin</span>&gt;input&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/stdin</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ssh-request</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sshServer"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ssh-response</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/ssh/message"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">stdout</span>&gt;Hello Citrus&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/stdout</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">exit</span>&gt;0&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/exit</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ssh-response</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;</pre></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="endpoint-components"></a>Chapter&nbsp;26.&nbsp;Dynamic endpoint components</h2></div></div></div><p>Endpoints represent the central components in Citrus to send or receive a message on some destination. Usually endpoints get defined in the basic
    Citrus Spring application context configuration as Spring bean components. In some cases this might be over engineering as the tester just wants to send or receive a
    message. In particular this is done when doing sanity checks in server endpoints while debugging a certain scenario.</p><p>With endpoint components you are able to create the Citrus endpoint for sending and receiving a message at test runtime. There is no additional configuration or Spring bean component
    needed. You just use the endpoint uri in a special naming convention and Citrus will create the endpoint for you. Let us see a first example of this scenario:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"DynamicEndpointTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jms:Hello.Queue?timeout=10000"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
                [...]
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;

        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jms:Hello.Response.Queue?timeout=5000"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
                [...]
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>As you can see the endpoint uri just goes into the test case action in substitution to the usual endpoint reference name. Instead of referencing a bean id that points to the previously configured
    Citrus endpoint we use the endpoint uri directly. The endpoint uri should give all information to create the endpoint at runtime. In the example above we use a keyword <span class="emphasis"><em>jms:</em></span> which tells Citrus
    that we need to create a JMS message endpoint. Secondly we give the JMS destination name <span class="emphasis"><em>Hello.Queue</em></span> which is a mandatory part of the endpoint uri when using the JMS component. The optional timeout
    parameter completed the uri. Citrus is able to create the JMS endpoint at runtime sending the message to the defined destination via JMS.</p><p>Of course this mechanism is not limited to JMS endpoints. We can use all default Citrus message transports in the endpoint uri. Just pick the right keyword that defines the message transport to use. Here is a list of
  supported keywords:</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><span class="emphasis"><em>jms:</em></span> Creates a JMS endpoint for sending and receiving message to a queue or topic</li><li style="list-style-type: circle"><span class="emphasis"><em>channel:</em></span> Creates a channel endpoint for sending and receiving messages using an in memory Spring Integration message channel</li><li style="list-style-type: circle"><span class="emphasis"><em>http:</em></span> Creates a HTTP client for sending a request to some server URL synchronously waiting for the response message</li><li style="list-style-type: circle"><span class="emphasis"><em>soap:</em></span> Creates a SOAP WebService client that send a proper SOAP message to the server URL and waits for the synchronous response to arrive</li><li style="list-style-type: circle"><span class="emphasis"><em>ssh:</em></span> Creates a new ssh client for publishing a command to the server</li><li style="list-style-type: circle"><span class="emphasis"><em>mail: or smtp:</em></span> Creates a new mail client for sending a mail mime message to a SMTP server</li><li style="list-style-type: circle"><span class="emphasis"><em>camel:</em></span> Creates a new Apache Camel endpoint for sending and receiving Camel exchanges both to and from Camel routes.</li><li style="list-style-type: circle"><span class="emphasis"><em>vertx: or eventbus:</em></span> Creates a new Vert.x instance sending and receiving messages with the network event bus</li></ul></div><p>Depending on the message transport we have to add mandatory parameters to the endpoint uri. In the JMS example we had to specify the destination name. The mandatory parameters are always part of the endpoint uri. Optional
    parameters can be added as key value pairs to the endpoint uri. The available parameters depend on the endpoint keyword that you have chosen. See these example endpoint uri expressions:</p><pre class="programlisting">
    jms:queuename?connectionFactory=specialConnectionFactory&amp;timeout=10000
    jms:topic:topicname?connectionFactory=topicConnectionFactory
    jms:sync:queuename?connectionFactory=specialConnectionFactory&amp;pollingInterval=100&amp;replyDestination=myReplyDestination

    channel:channelName
    channel:sync:channelName
    channel:channelName?timeout=10000&amp;channelResolver=myChannelResolver

    http:localhost:8088/test
    http://localhost:8088/test
    http:localhost:8088?requestMethod=GET&amp;timeout=10000&amp;errorHandlingStrategy=throwsException&amp;requestFactory=myRequestFactory
    http://localhost:8088/test?requestMethod=DELETE&amp;customParam=foo

    soap:localhost:8088/test
    soap:localhost:8088?timeout=10000&amp;errorHandlingStrategy=propagateError&amp;messageFactory=myMessageFactory

    mail:localhost:25000
    smtp://localhost:25000
    smtp://localhost?timeout=10000&amp;username=foo&amp;password=1234&amp;mailMessageMapper=myMapper

    ssh:localhost:2200
    ssh://localhost:2200?timeout=10000&amp;strictHostChecking=true&amp;user=foo&amp;password=12345678

    camel:direct:address
    camel:seda:address
    camel:jms:queue:someQueue?connectionFactory=myConnectionFactory
    camel:activemq:queue:someQueue?concurrentConsumers=5&amp;destination.consumer.prefetchSize=50
    camel:controlbus:route?routeId=myRoute&amp;action=status

    vertx:addressName
    vertx:addressName?port=10105&amp;timeout=10000&amp;pubSubDomain=true
    vertx:addressName?vertxInstanceFactory=vertxFactory</pre><p>The optional parameters get directly set as endpoint configuration. You can use primitive values as well as Spring bean id references. Citrus will automatically detect the target parameter type and resolve the value to a Spring bean
    in the application context if necessary. If you use some unknown parameter Citrus will raise an exception at runtime as the endpoint could not be created properly.</p><p>In synchronous communication we have to reuse endpoint components in order to receive synchronous messages on reply destinations. This is a problem when using dynamic endpoints as the endpoints get created at runtime. Citrus uses a
    caching of endpoints that get created at runtime. Following from that we have to use the exact same endpoint uri in your test case in order to get the cached endpoint instance. With this little trick synchronous communication will work
    just as it is done with static endpoint components. Have a look at this sample test:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"DynamicEndpointTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jms:sync:Hello.Sync.Queue"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
                [...]
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;

        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jms:sync:Hello.Sync.Queue"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
                [...]
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>As you can see we used the exact dynamic endpoint uri in both send and receive actions. Citrus is then able to reuse the same dynamic endpoint and the synchronous reply will be received as expected. However the reuse of exactly the same
    endpoint uri might get annoying as we also have to copy endpoint uri parameters and so on.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"DynamicEndpointTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://localhost:8080/HelloService?user=1234567"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
                [...]
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;

        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://localhost:8080/HelloService?user=1234567"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
                [...]
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>We have to use the exact same endpoint uri when receiving the synchronous service response. This is not very straight forward. This is why Citrus also supports dynamic endpoint names. With a special endpoint uri parameter called
    <span class="emphasis"><em>endpointName</em></span> you can name the dynamic endpoint. In a corresponding receive action you just use the endpoint name as reference which makes life more easy:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"DynamicEndpointTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://localhost:8080/HelloService?endpointName=myHttpClient"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
                [...]
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;

        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://localhost?endpointName=myHttpClient"</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
                [...]
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>So we can reference the dynamic endpoint with the given name. The internal <span class="emphasis"><em>endpointName</em></span> uri parameter is automatically removed before sending out messages. Once again the dynamic endpoint uri mechanism provides a fast
    way to write test cases in Citrus with less configuration. But you should consider to use the static endpoint components defined in the basic Spring bean application context for endpoints that are heavily reused in multiple test cases.</p></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="endpoint-adapter"></a>Chapter&nbsp;27.&nbsp;Endpoint adapter</h2></div></div></div><p>Endpoint adapter help to customize the behavior of a Citrus server such as HTTP or SOAP web servers. As the servers get started with the Citrus context
  they are ready to receive incoming client requests. Now there are different ways to process these incoming requests and to provide a proper response message. By default
  the server will forward the incoming request to a in memory message channel where a test can receive the message and provide a synchronous response. This message channel
  handling is done automatically behind the scenes so the tester does not care about these things. The tester just uses the server directly as endpoint reference in the test case.
  This is the default behaviour. In addition to that you can define custom endpoint adapters on the Citrus server in order to change this default behavior.</p><p>You set the custom endpoint adapter directly on the server configuration as follows:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-http:server</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloHttpServer"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">port</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"8080"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">auto-start</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint-adapter</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"emptyResponseEndpointAdapter"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">resource-base</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"src/citrus/resources"</span>/&gt;

    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:empty-response-adapter</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"emptyResponseEndpointAdapter"</span>/&gt;</pre><p>Now let us have a closer look at the provided endpoint adapter implementations.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="endpoint-adapter-empty"></a>27.1.&nbsp;Empty response endpoint adapter</h2></div></div></div><p>This is the simplest endpoint adapter you can think of. It simply provides an empty success response using the HTTP
      response code <span class="emphasis"><em>200</em></span>. The adapter does not need any configurations or properties as it simply responds with an empty HTTP response.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:empty-response-adapter</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"emptyResponseEndpointAdapter"</span>/&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="endpoint-adapter-static"></a>27.2.&nbsp;Static response endpoint adapter</h2></div></div></div><p>The next more complex endpoint adapter will always return a static response message.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:static-response-adapter</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"endpointAdapter"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:payload</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;HelloResponse</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/samples/sayHello.xsd"</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">MessageId</span>&gt;123456789&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/MessageId</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">CorrelationId</span>&gt;Cx1x123456789&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/CorrelationId</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Text</span>&gt;Hello User&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Text</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/HelloResponse</span>&gt;
        ]]&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:payload</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:header</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"{http://www.consol.de/schemas/samples}h1:Operation"</span>
                  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sayHello"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"{http://www.consol.de/schemas/samples}h1:MessageId"</span>
                  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"123456789"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:header</span>&gt;
 &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:static-response-adapter</span>&gt;</pre><p>The endpoint adapter is configured with a static message payload and static response header values. The response to the client
      is therefore always the same.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="endpoint-adapter-dispatcher"></a>27.3.&nbsp;Request dispatching endpoint adapter</h2></div></div></div><p>The idea behind the request dispatching endpoint adapter is that the incoming requests are dispatched to several other
      endpoint adapters. The decision which endpoint adapter should handle the actual request is done depending on some adapter mapping.
      The mapping is done based on the payload or header data of the incoming request. A mapping strategy evaluates a mapping key using the
      incoming request. You can think of an XPath expression that evaluates to the mapping key for instance. The endpoint adapter that maps
      to the mapping key is then called to handle the request.</p><p>So the request dispatching endpoint adapter is able to dynamically call several other endpoint adapters based on the incoming request
      message at runtime. This is very powerful. The next example uses the request dispatching endpoint adapter with a XPath mapping key extractor.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:dispatching-endpoint-adapter</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"dispatchingEndpointAdapter"</span>
         <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">mapping-key-extractor</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"mappingKeyExtractor"</span>
         <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">mapping-strategy</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"mappingStrategy"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"mappingStrategy"</span>
  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.endpoint.adapter.mapping.SimpleMappingStrategy"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"adapterMappings"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">map</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">entry</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">key</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sayHello"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">ref</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloEndpointAdapter"</span>/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/map</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"mappingKeyExtractor"</span>
  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.endpoint.adapter.mapping.XPathPayloadMappingKeyExtractor"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"xpathExpression"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//TestMessage/Operation/*"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:static-response-adapter</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"helloEndpointAdapter"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:payload</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;HelloResponse</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/samples/sayHello.xsd"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">MessageId</span>&gt;123456789&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/MessageId</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Text</span>&gt;Hello User&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Text</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/HelloResponse</span>&gt;
        ]]&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:payload</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:static-response-adapter</span>&gt;</pre><p>The XPath mapping key extractor expression decides for each request which mapping key to use in order to find a proper endpoint adapter through the mapping strategy. The endpoint adapters available in the
      application context are mapped via their bean id. For instance an incoming request with a matching element <code class="literal">//TestMessage/Operation/sayHello</code> would be handled by the endpoint
      adapter bean that is registered in the mapping strategy as "sayHello" key. The available endpoint adapters are configured in the same Spring application context.</p><p>Citrus provides several default mapping key extractor implementations.</p><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>HeaderMappingKeyExtractor</em></span>: Reads a special header entry and uses its value as mapping key</p></li><li><p><span class="emphasis"><em>SoapActionMappingKeyExtractor</em></span>: Uses the soap action header entry as mapping key</p></li><li><p><span class="emphasis"><em>XPathPayloadMappingKeyExtractor</em></span>: Evaluates a XPath expression on the request payload and uses the result as mapping key</p></li></ul></div><p>In addition to that we need a mapping strategy. Citrus provides following default implementations.</p><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>SimpleMappingStrategy</em></span>: Simple key value map with endpoint adapter references</p></li><li><p><span class="emphasis"><em>BeanNameMappingStrategy</em></span>: Loads the endpoint adapter Spring bean with the given id matching the mapping key</p></li><li><p><span class="emphasis"><em>ContextLoadingMappingStrategy</em></span>: Same as BeanNameMappingStrategy but loads a separate application context defined by external file resource</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="endpoint-adapter-channel"></a>27.4.&nbsp;Channel endpoint adapter</h2></div></div></div><p>The channel connecting endpoint adapter is the default adapter used in all Citrus server components. Indeed this adapter also provides the most
      flexibility. This adapter forwards incoming requests to a channel destination. The adapter is waiting for a proper response on a reply destination synchronously.
      With the channel endpoint components you can read the requests on the channel and provide a proper response on the reply destination.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:channel-endpoint-adapter</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"channelEndpointAdapter"</span>
              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">channel-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"inbound.channel"</span>
              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">timeout</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"2500"</span>/&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="endpoint-adapter-jms"></a>27.5.&nbsp;JMS endpoint adapter</h2></div></div></div><p>Another powerful endpoint adapter is the JMS connecting adapter implementation. This adapter forwards incoming requests to a JMS destination and waits for a proper response on a reply destination.
      A JMS endpoint can access the requests internally and provide a proper response on the reply destination. So this adapter is very flexible to provide proper response messages.</p><p>This special adapter comes with the <span class="emphasis"><em>citrus-jms</em></span> module. So you have to add the module and the special XML namespace for this module to your configuration files. The Maven module
    for <span class="emphasis"><em>citrus-jms</em></span> goes to the Maven POM file as normal project dependency. The <span class="emphasis"><em>citrus-jms</em></span> namespace goes to the Spring bean XML configuration file as follows:</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>Citrus provides a "citrus-jms" configuration namespace and schema definition for JMS related components and features. Include this namespace into your Spring
        configuration in order to use the Citrus JMS configuration elements. The namespace URI and schema location are added to the
        Spring configuration XML file as follows.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">beans</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xsi</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:citrus-jms</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/jms/config"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.citrusframework.org/schema/jms/config
        http://www.citrusframework.org/schema/jms/config/citrus-jms-config.xsd"</span>&gt;

    [...]

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/beans</span>&gt;</pre><p>After that you are able to use the adapter implementation in the Spring bean configuration.</p></td></tr></table></div><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-jms:endpoint-adapter</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jmsEndpointAdapter"</span>
              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"JMS.Queue.Requests.In"</span>
              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">reply-destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"JMS.Queue.Response.Out"</span>
              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">connection-factory</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jmsConnectionFactory"</span>
              <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">timeout</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"2500"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jmsConnectionFactory"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.apache.activemq.ActiveMQConnectionFactory"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"brokerURL"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"tcp://localhost:61616"</span> /&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="functions"></a>Chapter&nbsp;28.&nbsp;Functions</h2></div></div></div><p>The test framework will offer several functions that are useful throughout the test execution. The
    functions will always return a string value that is ready for use as variable value or directly inside a text
    message.</p><p>A set of functions is usually combined to a function library. The library has a prefix that will identify
    the functions inside the test case. The default test framework function library uses a default prefix (citrus).
    You can write your own function library using your own prefix in order to extend the test framework
    functionality whenever you want.</p><p>The library is built in the Spring configuration and contains a set of functions that are of
    public use.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:function-library</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testLibrary"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">prefix</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"foo:"</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:function</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"randomNumber"</span>&gt; class="com.consol.citrus.functions.RandomNumberFunction"/&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:function</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"randomString"</span>&gt; class="com.consol.citrus.functions.RandomStringFunction"/&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:function</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"customFunction"</span>&gt; ref="customFunctionBean"/&gt;
          ...
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:function-library</span>&gt;</pre><p>As you can see the library defines one to many functions either referenced as normal Spring bean or by its implementing Java class name. Citrus
      constructs the library and you are able to use the functions in your test case with the leading library prefix just like this:</p><pre class="programlisting">foo:randomNumber()
      foo:randomString()
      foo:customFunction()</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">You can add custom function implementations and custom function libraries. Just use a custom prefix for your library. The default Citrus function library
      uses the <span class="emphasis"><em>citrus:</em></span> prefix.</td></tr></table></div><p>In the next chapters the default functions offered by the framework will be described in detail.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-concat"></a>28.1.&nbsp;citrus:concat()</h2></div></div></div><p>The function will combine several string tokens to a single string value. This means that you can combine
        a static text value with a variable value for instance. A first example should clarify the usage:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"concatFunctionTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"date"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:currentDate(yyyy-MM-dd)"</span> /&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"text"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Hello Test Framework!"</span> /&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                citrus:concat('Today is: ', ${date}, ' right!?')
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                citrus:concat('Text is: ', ${text})
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>Please do not forget to mark static text with single quote signs. There is no limitation for string tokens to
        be combined.</p><p><code class="literal">citrus:concat('Text1', 'Text2', 'Text3', ${text}, 'Text5', &#8230; , 'TextN')</code></p><p>The function can be used wherever variables can be used. For instance when validating XML elements in
        the receive action.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">validate</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//element/element"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:concat('Cx1x', ${generatedId})"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-substring"></a>28.2.&nbsp;citrus:substring()</h2></div></div></div><p>The function will have three parameters.</p><p>1. String to work on</p><p>2. Starting index</p><p>3. End index (optional)</p><p>Let us have a look at a simple example for this function:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        citrus:substring('Hello Test Framework', 6)
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        citrus:substring('Hello Test Framework', 0, 5)
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;</pre><p>Function output:</p><p><span class="emphasis"><em>Test Framework</em></span></p><p><span class="emphasis"><em>Hello</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-string-length"></a>28.3.&nbsp;citrus:stringLength()</h2></div></div></div><p>The function will calculate the number of characters in a string representation and return the number.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:stringLength('Hello Test Framework')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;</pre><p>Function output:</p><p><span class="emphasis"><em>20</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-translate"></a>28.4.&nbsp;citrus:translate()</h2></div></div></div><p>This function will replace regular expression matching values inside a string representation with a
        specified replacement string.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        citrus:translate('H.llo Test Fr.mework', '\.', 'a')
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;</pre><p>Note that the second parameter will be a regular expression. The third parameter will be a simple
        replacement string value.</p><p>Function output:</p><p><span class="emphasis"><em>Hello Test Framework</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-substring-before"></a>28.5.&nbsp;citrus:substringBefore()</h2></div></div></div><p>The function will search for the first occurrence of a specified string and will return the substring before
        that occurrence. Let us have a closer look in a simple example:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        citrus:substringBefore('Test/Framework', '/')
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;</pre><p>In the specific example the function will search for the &#8216;/&#8217; character and return the string before that index.</p><p>Function output:</p><p><span class="emphasis"><em>Test</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-substring-after"></a>28.6.&nbsp;citrus:substringAfter()</h2></div></div></div><p>The function will search for the first occurrence of a specified string and will return the substring after that
        occurrence. Let us clarify this with a simple example:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        citrus:substringAfter('Test/Framework', '/')
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;</pre><p>Similar to the substringBefore function the &#8216;/&#8217; character is found in the string. But now the remaining
        string is returned by the function meaning the substring after this character index.</p><p>Function output:</p><p><span class="emphasis"><em>Framework</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-round"></a>28.7.&nbsp;citrus:round()</h2></div></div></div><p>This is a simple mathematic function that will round decimal numbers representations to their nearest non decimal
        number.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:round('3.14')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;</pre><p>Function output:</p><p><span class="emphasis"><em>3</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-floor"></a>28.8.&nbsp;citrus:floor()</h2></div></div></div><p>This function will round down decimal number values.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:floor('3.14')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;</pre><p>Function output:</p><p><span class="emphasis"><em>3.0</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-ceiling"></a>28.9.&nbsp;citrus:ceiling()</h2></div></div></div><p>Similar to floor function, but now the function will round up the decimal number values.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:ceiling('3.14')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;</pre><p>Function output:</p><p><span class="emphasis"><em>4.0</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-random-number"></a>28.10.&nbsp;citrus:randomNumber()</h2></div></div></div><p>The random number function will provide you the opportunity to generate random number strings
        containing positive number letters. There is a singular Boolean parameter for that function describing
        whether the generated number should have exactly the amount of digits. Default value for this padding flag
        will be true.</p><p>Next example will show the function usage:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"rndNumber1"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:randomNumber(10)"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"rndNumber2"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:randomNumber(10, true)"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"rndNumber2"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:randomNumber(10, false)"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"rndNumber3"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:randomNumber(3, false)"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;</pre><p>Function output:</p><p><span class="emphasis"><em>8954638765</em></span></p><p><span class="emphasis"><em>5003485980</em></span></p><p><span class="emphasis"><em>6387650</em></span></p><p><span class="emphasis"><em>65</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-random-string"></a>28.11.&nbsp;citrus:randomString()</h2></div></div></div><p>This function will generate a random string representation with a defined length. A second parameter for
        this function will define the case of the generated letters (UPPERCASE, LOWERCASE, MIXED). The last parameter allows
        also digit characters in the generated string. By default digit charaters are not allowed.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"rndString0"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${citrus:randomString(10)}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"rndString1"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:randomString(10)"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"rndString2"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:randomString(10, UPPERCASE)"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"rndString3"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:randomString(10, LOWERCASE)"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"rndString4"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:randomString(10, MIXED)"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"rndString4"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:randomString(10, MIXED, true)"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;</pre><p>Function output:</p><p><span class="emphasis"><em>HrGHOdfAer</em></span></p><p><span class="emphasis"><em>AgSSwedetG</em></span></p><p><span class="emphasis"><em>JSDFUTTRKU</em></span></p><p><span class="emphasis"><em>dtkhirtsuz</em></span></p><p><span class="emphasis"><em>Vt567JkA32</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-random-enum-value"></a>28.12.&nbsp;citrus:randomEnumValue()</h2></div></div></div><p>
            This function returns one of its supplied arguments. Furthermore you can specify a custom function
            with a configured list of values (the enumeration). The function will randomly return an entry when called without arguments.
            This promotes code reuse and facilitates refactoring.
        </p><p>
            In the next sample the function is used to set a httpStatusCode variable to one of the given HTTP status codes (200, 401, 500)
        </p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpStatusCode"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:randomEnumValue('200', '401', '500')"</span> /&gt;</pre><p>
            As mentioned before you can define a custom function for your very specific needs in order to easily manage a list of predefined values like this:
        </p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:function-library</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myCustomFunctionLibrary"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">prefix</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"custom:"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-function</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"randomHttpStatusCode"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">ref</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"randomHttpStatusCodeFunction"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:function-library</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"randomHttpStatusCodeFunction"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.functions.core.RandomEnumValueFunction"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"values"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">list</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;200&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;500&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;401&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/list</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>
            We have added a custom function library with a custom function definition. The custom function "randomHttpStatusCode" randomly 
            chooses an HTTP status code each time it is called. Inside the test you can use the function like this:
        </p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpStatusCode"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"custom:randomHttpStatusCode()"</span> /&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-current-date"></a>28.13.&nbsp;citrus:currentDate()</h2></div></div></div><p>This function will definitely help you when accessing the current date. Some examples will show the
        usage in detail:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:currentDate()&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:currentDate('yyyy-MM-dd')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:currentDate('yyyy-MM-dd HH:mm:ss')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:currentDate('yyyy-MM-dd'T'hh:mm:ss')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:currentDate('yyyy-MM-dd HH:mm:ss', '+1y')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:currentDate('yyyy-MM-dd HH:mm:ss', '+1M')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:currentDate('yyyy-MM-dd HH:mm:ss', '+1d')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:currentDate('yyyy-MM-dd HH:mm:ss', '+1h')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:currentDate('yyyy-MM-dd HH:mm:ss', '+1m')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:currentDate('yyyy-MM-dd HH:mm:ss', '+1s')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:currentDate('yyyy-MM-dd HH:mm:ss', '-1y')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;</pre><p>Note that the currentDate function provides two parameters. First parameter describes the date format
        string. The second will define a date offset string containing year, month, days, hours, minutes or seconds
        that will be added or subtracted to or from the actual date value.</p><p>Function output:</p><p><span class="emphasis"><em>01.09.2009</em></span></p><p><span class="emphasis"><em>2009-09-01</em></span></p><p><span class="emphasis"><em>2009-09-01 12:00:00</em></span></p><p><span class="emphasis"><em>2009-09-01T12:00:00</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-upper-case"></a>28.14.&nbsp;citrus:upperCase()</h2></div></div></div><p>This function converts any string to upper case letters.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:upperCase('Hello Test Framework')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;</pre><p>Function output:</p><p><span class="emphasis"><em>HELLO TEST FRAMEWORK</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-lower-case"></a>28.15.&nbsp;citrus:lowerCase()</h2></div></div></div><p>This function converts any string to lower case letters.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:lowerCase('Hello Test Framework')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;</pre><p>Function output:</p><p><span class="emphasis"><em>hello test framework</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-average"></a>28.16.&nbsp;citrus:average()</h2></div></div></div><p>The function will sum up all specified number values and divide the result through the number of values.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"avg"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:average('3', '4', '5')"</span>/&gt;</pre><p>avg = <span class="emphasis"><em>4.0</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-minimum"></a>28.17.&nbsp;citrus:minimum()</h2></div></div></div><p>This function returns the minimum value in a set of number values.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"min"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:minimum('3', '4', '5')"</span>/&gt;</pre><p>min = <span class="emphasis"><em>3.0</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-maximum"></a>28.18.&nbsp;citrus:maximum()</h2></div></div></div><p>This function returns the maximum value in a set of number values.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"max"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:maximum('3', '4', '5')"</span>/&gt;</pre><p>max = <span class="emphasis"><em>5.0</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-sum"></a>28.19.&nbsp;citrus:sum()</h2></div></div></div><p>The function will sum up all number values. The number values can also be negative.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"sum"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:sum('3', '4', '5')"</span>/&gt;</pre><p>sum = <span class="emphasis"><em>12.0</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-absolute"></a>28.20.&nbsp;citrus:absolute()</h2></div></div></div><p>The function will return the absolute number value.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"abs"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:absolute('-3')"</span>/&gt;</pre><p>abs = <span class="emphasis"><em>3.0</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-map-value"></a>28.21.&nbsp;citrus:mapValue()</h2></div></div></div><p>
              This function implementation maps string keys to string values. This is very helpful when the used key is randomly chosen
              at runtime and the corresponding value is not defined during the design time.
        </p><p>
              The following function library defines a custom function for mapping HTTP status codes to the corresponding messages:
        </p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:function-library</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myCustomFunctionLibrary"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">prefix</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"custom:"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-function</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"getHttpStatusMessage"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">ref</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"getHttpStatusMessageFunction"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:function-library</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"getHttpStatusMessageFunction"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.functions.core.MapValueFunction"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"values"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">map</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">entry</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">key</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"200"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"OK"</span> /&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">entry</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">key</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"401"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Unauthorized"</span> /&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">entry</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">key</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"500"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Internal Server Error"</span> /&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/map</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>
            In this example the function sets the variable httpStatusMessage to the 'Internal Server Error' string dynamically at runtime.
            The test only knows the HTTP status code and does not care about spelling and message locales.
        </p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"httpStatusCodeMessage"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"custom:getHttpStatusMessage('500')"</span> /&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-random-uuid"></a>28.22.&nbsp;citrus:randomUUID()</h2></div></div></div><p>The function will generate a random Java UUID.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"uuid"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:randomUUID()"</span>/&gt;</pre><p>uuid = <span class="emphasis"><em>98fbd7b0-832e-4b85-b9d2-e0113ee88356</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-encode-base64"></a>28.23.&nbsp;citrus:encodeBase64()</h2></div></div></div><p>The function will encode a string to binary data using base64 hexadecimal encoding.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"encoded"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:encodeBase64('Hallo Testframework')"</span>/&gt;</pre><p>encoded = <span class="emphasis"><em>VGVzdCBGcmFtZXdvcms=</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-decode-base64"></a>28.24.&nbsp;citrus:decodeBase64()</h2></div></div></div><p>The function will decode binary data to a character sequence using base64 hexadecimal decoding.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"decoded"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:encodeBase64('VGVzdCBGcmFtZXdvcms=')"</span>/&gt;</pre><p>decoded = <span class="emphasis"><em>Hallo Testframework</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-escape-xml"></a>28.25.&nbsp;citrus:escapeXml()</h2></div></div></div><p>If you want to deal with escaped XML in your test case you may want to use this function. It automatically escapes all
        XML special characters.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">citrus:escapeXml('&lt;Message&gt;Hallo</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">Test</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">Framework&lt;/Message&gt;')</span>                        
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">]]&gt;</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/message&gt;</span>
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/echo&gt;</span></pre><p><span class="emphasis"><em>&amp;lt;Message&amp;gt;Hallo Test Framework&amp;lt;/Message&amp;gt;</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-cdata-section"></a>28.26.&nbsp;citrus:cdataSection()</h2></div></div></div><p>Usually we use CDATA sections to define message payload data inside a testcase. We might run into problems
        when the payload itself contains CDATA sections as nested CDATA sections are prohibited by XML nature. In this
        case the next function ships very usefull.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"cdata"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:cdataSection('payload')"</span>/&gt;</pre><p>cdata = <span class="emphasis"><em>&lt;![CDATA[payload]]&gt;</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-digest-auth"></a>28.27.&nbsp;citrus:digestAuthHeader()</h2></div></div></div><p>Digest authentication is a commonly used security algorithm, especially in Http communication and SOAP WebServices.
        Citrus offers a function to generate a digest authentication principle used in the Http header section of a message.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"digest"</span> 
  <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:digestAuthHeader('username', 'password', 'authRealm', 'acegi', 
                            'POST', 'http://127.0.0.1:8080', 'citrus', 'md5')"</span>/&gt;</pre><p>A possible digest authentication header value looks like this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Digest</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">username</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">foo,realm=arealm,nonce=MTMzNT,</span>
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">uri</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">http:</span>//127.0.0.1:8080,response=51f98c,opaque=b29a30,algorithm=md5&gt;</pre><p>You can use these digest headers in messages sent by Citrus like this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus_http_Authorization"</span> 
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"vflig:digestAuthHeader('${username}','${password}','${authRealm}',
                            '${nonceKey}','POST','${uri}','${opaque}','${algorithm}')"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;  
        </pre><p>This will set a Http Authorization header with the respective digest in the request message. So your test is ready for client digest authentication.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-localhost-address"></a>28.28.&nbsp;citrus:localHostAddress()</h2></div></div></div><p>Test cases may use the local host address for some reason (e.g. used as authentication principle). As the tests
        may run on different machines at the same time we can not use static host addresses. The provided function localHostAddress() reads
        the local host name dynamically at runtime.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"address"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:localHostAddress()"</span>/&gt;</pre><p>A possible value is either the host name as used in DNS entry or an IP address value:</p><p>address = <span class="emphasis"><em>&lt;192.168.2.100&gt;</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-changedate"></a>28.29.&nbsp;citrus:changeDate()</h2></div></div></div><p>This function works with date values and manipulates those at runtime by adding or removing a date
        value offset. You can manipulate several date fields such as: year, month, day, hour, minute or second.</p><p>Let us clarify this with a simple example for this function:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:changeDate('01.01.2000', '+1y+1M+1d')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:changeDate(citrus:currentDate(), '-1M')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;</pre><p>Function output:</p><p><span class="emphasis"><em>02.02.2001</em></span></p><p><span class="emphasis"><em>13.04.2013</em></span></p><p>As you can see the change date function works on static date values or dynamic variable values or functions like <span class="emphasis"><em>citrus:currentDate()</em></span>. By default
        the change date function requires a date format such as the current date function ('dd.MM.yyyy'). You can also define a custom date format:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;citrus:changeDate('2000-01-10', '-1M-1d', 'yyyy-MM-dd')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/echo</span>&gt;</pre><p>Function output:</p><p><span class="emphasis"><em>1999-12-09</em></span></p><p>With this you are able to manipulate all date values of static or dynamic nature at test runtime.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="validation-matchers"></a>Chapter&nbsp;29.&nbsp;Validation matcher</h2></div></div></div><p>Message validation in Citrus is essential. The framework offers several validation mechanisms for different message types and formats. 
    With test variables we are able to check for simple value equality. We ensure that message entries are equal to predefined expected values. Validation 
    matcher add powerful assertion functionality on top of that. You just can use the predefined validation matcher functionalities in order to perform
    more complex assertions like <span class="emphasis"><em>contains</em></span> or <span class="emphasis"><em>isNumber</em></span> in your validation statements.</p><p>The following sections describe the Citrus default validation matcher implementations that are ready for usage. The matcher implementations should cover the
    basic assertions on character sequences and numbers. Of course you can add custom validation matcher implementations in order to meet your very specific validation 
    assertions, too.</p><p>First of all let us have a look at a validation matcher statement in action so we understand how to use them in a test case.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">RequestMessage</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">MessageBody</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Customer</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Id</span>&gt;@greaterThan(0)@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Id</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Name</span>&gt;@equalsIgnoreCase('foo')@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Name</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Customer</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/MessageBody</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/RequestMessage</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;</pre><p>The listing above describes a normal message validation block inside a receive test action. We use some inline message payload template as CDATA. As you know Citrus will compare the
    actual message payload to this expected template in DOM tree comparison. In addition to that you can simply include validation matcher statements. The message element <span class="emphasis"><em>Id</em></span> 
    is automatically validated to be a number greater than zero and the <span class="emphasis"><em>Name</em></span> character sequence is supposed to match 'foo' ignoring case spelling considerations.</p><p>Please note the special validation matcher syntax. The statements are surrounded with '@' markers and are identified by some unique name. The optional parameters passed to the matcher 
    implementation state the expected values to match.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>You can use validation matcher with all validation mechanisms - not only with XML validation. Plaintext, JSON, SQL result set validation are also supported.</p></td></tr></table></div><p>A set of validation matcher implementations is usually combined to a validation matcher library. The library has a prefix that will identify
      the validation matcher inside the test case. The default test framework validation matcher library uses a default prefix (citrus).
      You can write your own validation matcher library using your own prefix in order to extend the test framework
      functionality whenever you want.</p><p>The library is built in the Spring configuration and contains a set of validation matcher that are of
      public use.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:validation</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">matcher-library</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testMatcherLibrary"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">prefix</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"foo:"</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:matcher</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"isNumber"</span>&gt; class="com.consol.citrus.validation.matcher.core.IsNumberValidationMatcher"/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:matcher</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"contains"</span>&gt; class="com.consol.citrus.validation.matcher.core.ContainsValidationMatcher"/&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:matcher</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"customMatcher"</span>&gt; ref="customMatcherBean"/&gt;
      ...
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:validation matcher-library</span>&gt;</pre><p>As you can see the library defines one to many validation matcher members either referenced as normal Spring bean or by its implementing Java class name. Citrus
      constructs the library and you are able to use the validation matcher in your test case with the leading library prefix just like this:</p><pre class="programlisting">@foo:isNumber()@
      @foo:contains()@
      @foo:customMatcher()@</pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top">You can add custom validation matcher implementations and custom validation matcher libraries. Just use a custom prefix for your library. The default Citrus validation matcher library
    uses no prefix.</td></tr></table></div><p>See now the following sections describing the default validation validation matcher in Citrus.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-matcher-xml"></a>29.1.&nbsp;matchesXml()</h2></div></div></div><p>The XML validation matcher implementation is the possibly most exciting one, as we can validate nested XML with full validation power (e.g. ignoring elements, variable support). The
        matcher checks a nested XML fragment to compare against expected XML. For instance we receive following XML message payload for validation:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">GetCustomerMessage</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">CustomerDetails</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Id</span>&gt;5&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Id</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Name</span>&gt;Christoph&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Name</span>&gt;
          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Configuration</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;config&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;premium&gt;true&lt;/premium&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;last-login&gt;2012-02-24T23:34:23&lt;/last-login&gt;</span>
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;link&gt;http://www.citrusframework.org/customer/5&lt;/link&gt;</span>
            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/config&gt;</span>
          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">]]&gt;&lt;/Configuration&gt;</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/CustomerDetails&gt;</span>
<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;/GetCustomerMessage&gt;</span></pre><p>As you can see the message payload contains some configuration as nested XML data in a CDATA section. We could validate this CDATA section as static character sequence comparison, true. But 
        the &lt;last-login&gt; timestamp changes its value continuously. This breaks the static validation for CDATA elements in XML. Fortunately the new XML validation matcher provides a solution for us:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">GetCustomerMessage</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">CustomerDetails</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Id</span>&gt;5&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Id</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Name</span>&gt;Christoph&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Name</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Configuration</span>&gt;citrus:cdataSection('@matchesXml('&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">config</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">premium</span>&gt;${isPremium}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/premium</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">last-login</span>&gt;@ignore@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/last-login</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">link</span>&gt;http://www.citrusframework.org/customer/5&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/link</span>&gt;
                  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/config</span>&gt;')@')&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Configuration</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/CustomerDetails</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/GetCustomerMessage</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;</pre><p>With the validation matcher you are able to validate the nested XML with full validation power. Ignoring elements is possible and we can also use variables in our control XML.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">Nested CDATA elements within other CDATA sections are not allowed by XML standard. This is why we create the nested CDATA section on the fly with the function cdataSection().</td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-matcher-equals"></a>29.2.&nbsp;equalsIgnoreCase()</h2></div></div></div><p>This matcher implementation checks for equality without any case spelling considerations. The matcher expects a single parameter as the expected character sequence 
        to check for.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;@equalsIgnoreCase('foo')@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-matcher-contains"></a>29.3.&nbsp;contains()</h2></div></div></div><p>This matcher searches for a character sequence inside the actual value. If the character sequence is not found somewhere the matcher starts complaining.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;@contains('foo')@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;</pre><p>The validation matcher also exist in a case insensitive variant.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;@containsIgnoreCase('foo')@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-matcher-startswith"></a>29.4.&nbsp;startsWith()</h2></div></div></div><p>The matcher implementation asserts that the given value starts with a character sequence otherwise the matcher will arise some error.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;@startsWith('foo')@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-matcher-endswith"></a>29.5.&nbsp;endsWith()</h2></div></div></div><p>Ends with matcher validates a value to end with a given character sequence.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;@endsWith('foo')@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-matcher-matches"></a>29.6.&nbsp;matches()</h2></div></div></div><p>You can check a value to meet a regular expression with this validation matcher. This is for instance very useful for email address 
        validation.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;@matches('[a-z0-9]')@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-matcher-datepattern"></a>29.7.&nbsp;matchesDatePattern()</h2></div></div></div><p>Date values are always difficult to check for equality. Especially when you have millisecond timestamps to deal with. Therefore the date pattern validation 
        matcher should have some improvement for you. You simply validate the date format pattern instead of checking for total equality.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;@matchesDatePattern('yyyy-MM-dd')@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;</pre><p>The example listing uses a date format pattern that is expected. The actual date value is parsed according to this pattern and may cause errors in case the 
        value is no valid date matching the desired format.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-matcher-isnumber"></a>29.8.&nbsp;isNumber()</h2></div></div></div><p>Checking on values to be of numeric nature is essential. The actual value must be a numeric number otherwise the matcher raises errors. The matcher implementation
        does not evaluate any parameters.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;@isNumber()@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-matcher-lowerthan"></a>29.9.&nbsp;lowerThan()</h2></div></div></div><p>This matcher checks a number to be lower than a given threshold value.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;@lowerThan(5)@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-matcher-greaterthan"></a>29.10.&nbsp;greaterThan()</h2></div></div></div><p>The matcher implementation will check on numeric values to be greater than a minimum value.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;@greaterThan(5)@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-matcher-weekday"></a>29.11.&nbsp;isWeekday()</h2></div></div></div><p>The matcher works on date values and checks that a given date evaluates to the expected day of the week.
      The user defines the expected day by its name in uppercase characters. The matcher fails in case the given date
      is another week day than expected.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">someDate</span>&gt;@isWeekday('MONDAY')@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/someDate</span>&gt;</pre><p>Possible values for the expected day of the week are: MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY or SUNDAY.</p><p>The field value has to be a date value otherwise the matcher will fail to parse the date. The matcher requires
      a date format which is <span class="emphasis"><em>dd.MM.yyyy</em></span> by default. You can change this date format as follows:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">someDate</span>&gt;@isWeekday('MONDAY('yyyy-MM-dd'))@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/someDate</span>&gt;</pre><p>Now the matcher uses the custom date format in order to parse the date value for evaluation. The validation matcher
      also works with date time values. In this case you have to give a valid date time format respectively
      (e.g. FRIDAY('yyyy-MM-dd'T'hh:mm:ss')).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="validation-matcher-variable"></a>29.12.&nbsp;variable()</h2></div></div></div><p>This is a very special validation matcher. Instead of performing a validation logic you can save the actual
      value passed to the validation matcher as new test variable. This comes very handy as you can use the matcher wherever
      you want: JSON message payloads, XML message payloads, headers and so on.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;@variable('foo')@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;</pre><p>The validation matcher creates a new variable <span class="emphasis"><em>foo</em></span> with the actual element value as variable value. When
      leaving out the control value the field name itself is used as variable name.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">date</span>&gt;@variable()@&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/date</span>&gt;</pre><p>This creates a new variable <span class="emphasis"><em>date</em></span> with the actual element value as variable value.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="data-dictionary"></a>Chapter&nbsp;30.&nbsp;Data dictionaries</h2></div></div></div><p>Data dictionaries in Citrus provide a new way to manipulate message payload data before a message is sent or
  received. The dictionary defines a set of keys and respective values. Just like every other dictionary
  it is used to translate things. In our case we translate message data elements.</p><p>You can translate common message elements that are used widely throughout your domain model. As Citrus deals
  with different types of message data (e.g. XML, JSON) we have different dictionary implementations that are described
  in the next sections.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xml-data-dictionary"></a>30.1.&nbsp;XML data dictionaries</h2></div></div></div><p>XML data dictionaries do apply to XML message format payloads, of course. In general we add a dictionary to the basic
    Citrus Spring application context in order to make the dictionary visible to all test cases:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:xml-data-dictionary</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"nodeMappingDataDictionary"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:mappings</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:mapping</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"TestMessage.MessageId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${messageId}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:mapping</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"TestMessage.CorrelationId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:mapping</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"TestMessage.User"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Christoph"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:mapping</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"TestMessage.TimeStamp"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:currentDate()"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:mappings</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:xml-data-dictionary</span>&gt;</pre><p>As you can see the dictionary is nothing but a normal Spring bean definition. The <span class="emphasis"><em>NodeMappingDataDictionary</em></span>
    implementation receives a map of key value pairs where the key is a message element path expression. For XML payloads
    the message element tree is traversed so the path expression is built for an exact message element inside the payload.
    If matched the respective value is set accordingly through the dictionary.</p><p>Besides defining the dictionary key value mappings as property map inside the bean definition we can extract the mapping data
    to an external file.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:xml-data-dictionary</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"nodeMappingDataDictionary"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:mapping-file</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:com/consol/citrus/sample.dictionary"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:xml-data-dictionary</span>&gt;</pre><p>The mapping file content just looks like a normal property file in Java:</p><pre class="programlisting">TestMessage.MessageId=${messageId}
TestMessage.CorrelationId=${correlationId}
TestMessage.User=Christoph
TestMessage.TimeStamp=citrus:currentDate()</pre><p>You can set any message element value inside the XML message payload. The path expression also supports XML attributes.
    Just use the attribute name as last part of the path expression. Let us have a closer look at a sample XML message payload
    with attributes:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">TestMessage</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">User</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Christoph"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">age</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"18"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/TestMessage</span>&gt;</pre><p>With this sample XML payload given we can access the attributes in the data dictionary as follows:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:mapping</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"TestMessage.User.name"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${userName}"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:mapping</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"TestMessage.User.age"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${userAge}"</span>/&gt;</pre><p>The <span class="emphasis"><em>NodeMappingDataDictionary</em></span> implementation is easy to use and fits the basic needs for
    XML data dictionaries. The message element path expressions are very simple and do fit basic needs. However when more
    complex XML payloads apply for translation we might reach the boundaries here.</p><p>For more complex XML message payloads XPath data dictionaries are very effective:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:xpath-data-dictionary</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"xpathMappingDataDictionary"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:mappings</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:mapping</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//TestMessage/MessageId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${messageId}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:mapping</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//TestMessage/CorrelationId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:mapping</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//TestMessage/User"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Christoph"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:mapping</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//TestMessage/User/@id"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"123"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:mapping</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//TestMessage/TimeStamp"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:currentDate()"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:mappings</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:xpath-data-dictionary</span>&gt;</pre><p>As expected XPath mapping expressions are way more powerful and can also handle very complex scenarios with XML
    namespaces, attributes and node lists. Just like the node mapping dictionary the XPath mapping dictionary does also
    support variables, functions and an external mapping file.</p><p>XPath works fine with namespaces. In general it is good practice to define a namespace context where you map namespace
    URI values with prefix values. So your XPath expression is always exact and evaluation is strict. In Citrus the
    <span class="emphasis"><em>NamespaceContextBuilder</em></span> which is also added as normal Spring bean to the application context manages
    namespaces used in your XPath expressions. See our XML and XPAth chapters in this documentation for detailed description how
    to accomplish fail safe XPath expressions with namespaces.</p><p>This completes the XML data dictionary usage in Citrus. Later on we will see some more advanced data dictionary scenarios
    where we will discuss the usage of dictionary scopes and mapping strategies. But before that let us have a look at other message
    formats like JSON messages.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="json-data-dictionary"></a>30.2.&nbsp;JSON data dictionaries</h2></div></div></div><p>JSON data dictionaries complement with XML data dictionaries. As usual we have to add the JSON data dictionary to the basic
    Spring application context first. Once this is done the data dictionary automatically applies for all JSON message payloads in Citrus.
    This means that all JSON messages sent and received get translated with the JSON data dictionary implementation.</p><p>Citrus uses message types in order to evaluate which data dictionary may fit to the message that is currently processed.
    As usual you can define the message type directly in your test case as attribute inside the sending and receiving message action.</p><p>Let us see a simple dictionary for JSON data:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:json-data-dictionary</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jsonMappingDataDictionary"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:mappings</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:mapping</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"TestMessage.MessageId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${messageId}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:mapping</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"TestMessage.CorrelationId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:mapping</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"TestMessage.User"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Christoph"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:mapping</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"TestMessage.TimeStamp"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:currentDate()"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:mappings</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:json-data-dictionary</span>&gt;</pre><p>The message path expressions do look very similar to those used in XML data dictionaries. Here the path expression keys do
    apply to the JSON object graph. See the following sample JSON data which perfectly applies to the dictionary expressions above.</p><pre class="programlisting">{"TestMessage": {
  "MessageId": "1122334455",
  "CorrelationId": "100000001",
  "User": "Christoph",
  "TimeStamp": 1234567890 }
}</pre><p>The path expressions will match a very specific message element inside the JSON object graph. The dictionary will automatically set
    the message element values then. The path expressions are easy to use as you can traverse the JSON object graph very easy.</p><p>Of course the data dictionary does also support test variables, functions. Also very interesting is the usage of JSON arrays.
    A JSON array element is referenced in a data dictionary like this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:mapping</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"TestMessage.Users[0]"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Christoph"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:mapping</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"TestMessage.Users[1]"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Julia"</span>/&gt;</pre><p>The <span class="emphasis"><em>Users</em></span> element is a JSON array, so we can access the elements with index. Nesting JSON objects and arrays
    is also supported so you can also handle more complex JSON data.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="data-dictionary-scope"></a>30.3.&nbsp;Dictionary scopes</h2></div></div></div><p>Now that we have learned how to add data dictionaries to Citrus we need to discuss some advanced topics. Data
    dictionary scopes do define the boundaries where the dictionary may apply. By default data dictionaries are global scope dictionaries.
    This means that the data dictionary applies to all messages sent and received with Citrus. Of course message types are considered
    so XML data dictionaries do only apply to XML message types. However global scope dictionaries will be activated throughout all test
    cases and actions.</p><p>You can overwrite the dictionary scope. For instance in order to use an explicit scope. When this is done the dictionary wil not apply
    automatically but the user has to explicitly set the data dictionary in sending or receiving test action. This way you can activate
    the dictionary to a very special set of test actions.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:xml-data-dictionary</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"specialDataDictionary"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">global-scope</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"false"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:mapping-file</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classpath:com/consol/citrus/sample.dictionary"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:xml-data-dictionary</span>&gt;</pre><p>We set the global scope property to <span class="emphasis"><em>false</em></span> so the dictionary is handled in explicit scope. This means that
    you have to set the data dictionary explicitly in your test actions:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"myEndpoint"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">data-dictionary</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"specialDataDictionary"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">payload</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">TestMessage</span>&gt;Hello Citrus"/TestMessage&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/payload</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;</pre><p>The sample above is a sending test action with an explicit data dictionary reference set. Before sending the message the dictionary is asked
    for translation. So all matching message element values will be set by the dictionary accordingly. Other global data dictionaries do also apply for this message
    but the explicit dictionary will always overwrite the message element values.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="data-dictonary-mapping-strategy"></a>30.4.&nbsp;Path mapping strategies</h2></div></div></div><p>Another advanced topic about data dictionaries is the path mapping strategy. When using simple path expressions the default strategy
    is always <span class="emphasis"><em>EXACT_MATCH</em></span>. This means that the path expression has to evaluate exactly to a message element within the
    payload data. And only this exact message element is translated.</p><p>You can set your own path mapping strategy in order to change this behavior. For instance another mapping strategy would be <span class="emphasis"><em>STARS_WITH</em></span>.
    All elements are translated that start with a certain path expression. Let us clarify this with an example:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:xml-data-dictionary</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"nodeMappingDataDictionary"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">mapping-strategy</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"STARTS_WITH"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:mappings</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:mapping</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"TestMessage.Property"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:randomString()"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:mappings</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:xml-data-dictionary</span>&gt;</pre><p>Now with the path mapping strategy set to <span class="emphasis"><em>STARS_WITH</em></span> all message element path expressions starting with <span class="emphasis"><em>TestMessage.Property</em></span> will
    find translation in this dictionary. Following sample message payload would be translated accordingly:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">TestMessage</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Property</span>&gt;XXX&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Property</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">PropertyName</span>&gt;XXX&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/PropertyName</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">PropertyValue</span>&gt;XXX&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/PropertyValue</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/TestMessage</span>&gt;</pre><p>All child elements of <span class="emphasis"><em>TestMessage</em></span> starting with <span class="emphasis"><em>Property</em></span> will be translated with this data dictionary. In the resulting message payload
    Citrus will use a random string as value for these elements as we used the <span class="emphasis"><em>citrus:randomString()</em></span> function in the dictionary mapping.</p><p>The next mapping strategy would be <span class="emphasis"><em>ENDS_WITH</em></span>. No surprises here - this mapping strategy looks for message
    elements that end with a certain path expression. Again a simple example will clarify this for you.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:xml-data-dictionary</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"nodeMappingDataDictionary"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">mapping-strategy</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"ENDS_WITH"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:mappings</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:mapping</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"Id"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:randomNumber()"</span>/&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:mappings</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:xml-data-dictionary</span>&gt;</pre><p>Again let us see some sample message payload for this dictionary usage:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">TestMessage</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">RequestId</span>&gt;XXX&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/RequestId</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Properties</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Property</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">PropertyId</span>&gt;XXX&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/PropertyId</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">PropertyValue</span>&gt;XXX&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/PropertyValue</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Property</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Property</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">PropertyId</span>&gt;XXX&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/PropertyId</span>&gt;
      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">PropertyValue</span>&gt;XXX&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/PropertyValue</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Property</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Properties</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/TestMessage</span>&gt;</pre><p>In this sample all message elements ending with <span class="emphasis"><em>Id</em></span> would be translated with a random number. No matter where in the message tree the elements are located. This
    is quite useful but also very powerful. So be careful to use this strategy in global data dictionaries as it may translate message elements that you would not expect in the first place.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="testsuite"></a>Chapter&nbsp;31.&nbsp;Actions before/after the test run</h2></div></div></div><p>A test framework should also provide the functionality to do some work before and after the test run. You could think of 
    preparing/deleting the data in a database or starting/stopping a server in this section before/after a test run. These tasks fit 
    best into the initialization and cleanup phases of Citrus. All you have to do is add some Spring bean definitions to the Citrus 
    application context.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>It is important to notice that the Citrus configuration components that we are going to use in the next section belong to a separate
      XML namespace <span class="emphasis"><em>citrus-test</em></span>. We have to add the namespace declaration to the XML root element of our XML configuration file accordingly.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">spring:beans</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/testcase"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:spring</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xsi</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:citrus-test</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/testcase"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.citrusframework.org/schema/testcase
        http://www.citrusframework.org/schema/testcase/citrus-testcase.xsd"</span>&gt;

        [...]

        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/beans</span>&gt;</pre></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="testsuite-before"></a>31.1.&nbsp;Before suite</h2></div></div></div><p>You can influence the behavior of a test run in the initialization phase actually before the tests are executed. 
        See the next code example to find out how it works with actions that take place before the first test is executed:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:before-suite</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"actionsBeforeSuite"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">!-- list of actions before suite --</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:before-suite</span>&gt;</pre><p>The Citrus configuration component holds a list of Citrus test actions that get executed before the test suite run. You can
        add all Citrus test actions here as you would do in a normal test case definition.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:before-suite</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"actionsBeforeSuite"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-test:sql</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">dataSource</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testDataSource"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-test:statement"</span>&gt;CREATE TABLE PERSON (ID integer, NAME char(250))&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus-test:statement</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus-test:sql</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:before-suite</span>&gt;</pre><p>Note that we must use the Citrus test case namespace for the nested test action definitions. We access the database and
          create a table PERSON which is obviously needed in our test cases. You can think of several actions here to prepare the database for instance.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.jpg"></td><th align="left">Tip</th></tr><tr><td align="left" valign="top"><p>Citrus offers special startup and shutdown actions that may start and stop server implementations automatically. This might
            be helpful when dealing with Http servers or WebService containers like Jetty. You can also think of starting/stopping a
            JMS broker before a test run.</p></td></tr></table></div><p>You can have many after-suite configuration components with different ids in a Citrus project. By default the containers are always executed. But you can restrict the after suite action container execution by defining a suite name or
          test group names that should match accordingly:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:before-suite</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"actionsBeforeSuite"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">suites</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"databaseSuite"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">groups</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"e2e"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-test:sql</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">dataSource</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testDataSource"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-test:statement"</span>&gt;CREATE TABLE PERSON (ID integer, NAME char(250))&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus-test:statement</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus-test:sql</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:before-suite</span>&gt;</pre><p>The above after suite container is only executed with the test suite called <span class="emphasis"><em>databaseSuite</em></span> or when the test group <span class="emphasis"><em>e2e</em></span> is defined. Test groups and suite names are only supported
          when using the TestNG unit test framework. Unfortunately JUnit does not allow to hook into suite execution as easily as TestNG does. This is why after suite action containers are not restricted in execution when using Citrus with
          the JUnit test framework.</p><p>You can define multiple suite names and test groups with comma delimited strings as attribute values.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="testsuite-after"></a>31.2.&nbsp;After suite</h2></div></div></div><p>A test run may require the test environment to be clean. Therefore it is a good idea to purge all JMS destinations
        or clean up the database after the test run in order to avoid errors in follow-up test runs. Just like we prepared some data in actions before suite we can clean up the test run
        in actions after the tests are finished. The Spring bean syntax here is not significantly different to those in before suite section:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:after-suite</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"actionsAfterSuite"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">!-- list of actions after suite --</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:after-suite</span>&gt;</pre><p>Again we give the after suite configuration component a unique id within the configuration and put one to many test actions as nested configuration elements to the list
        of actions executed after the test suite run.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:after-suite</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"actionsAfterSuite"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-test:sql</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">dataSource</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testDataSource"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-test:statement"</span>&gt;DELETE FROM TABLE PERSON&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus-test:statement</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus-test:sql</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:after-suite</span>&gt;</pre><p>We have to use the Citrus test case XML namespace when defining nested test actions in after suite list. We just remove all data from the database so we do not influence follow-up tests. Quite simple isn't it!?</p><p>You can have many after-suite configuration components with different ids in a Citrus project. By default the containers are always executed. But you can restrict the after suite action container execution by defining a suite name or
        test group names that should match accordingly:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:after-suite</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"actionsAfterSuite"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">suites</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"databaseSuite"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">groups</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"e2e"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-test:sql</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">dataSource</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"testDataSource"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-test:statement"</span>&gt;DELETE FROM TABLE PERSON&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus-test:statement</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus-test:sql</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:after-suite</span>&gt;</pre><p>The above after suite container is only executed with the test suite called <span class="emphasis"><em>databaseSuite</em></span> or when the test group <span class="emphasis"><em>e2e</em></span> is defined. Test groups and suite names are only supported
        when using the TestNG unit test framework. Unfortunately JUnit does not allow to hook into suite execution as easily as TestNG does. This is why after suite action containers are not restricted in execution when using Citrus with
        the JUnit test framework.</p><p>You can define multiple suite names and test groups with comma delimited strings as attribute values.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="testsuite-before-test"></a>31.3.&nbsp;Before test</h2></div></div></div><p>Before each test is executed it also might sound reasonable to purge all JMS queues for instance. In case a previous test fails some messages might be left in the JMS queues. 
        Also the database might be in dirty state. The follow-up test then will be confronted with these invalid messages and data. Purging all JMS destinations before a test is therefore a 
        good idea. Just like we prepared some data in actions before suite we can clean up the data before a test starts to execute.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:before-test</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"defaultBeforeTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">!-- list of actions before test --</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:before-test</span>&gt;</pre><p>The before test configuration component receives a unique id and a list of test actions that get executed before a test case is started. The component receives usual test action definitions just like you would write them in
          a normal test case definition. See the example below how to add test actions.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:before-test</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"defaultBeforeTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:actions</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-test:echo</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-test:message</span>&gt;This is executed before each test!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus-test:message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus-test:echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:before-test</span>&gt;</pre><p>Note that we must use the Citrus test case XML namespace for the nested test action definitions. You have to declare the XML namespaces accordingly in your configuration root element. The echo test action is now executed before each test in our
          test suite run. Also notice that we can restrict the before test container execution. We can restrict execution based on the test name, package and test groups. See following example how this works:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:before-test</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"defaultBeforeTest"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">test</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"*_Ok_Test"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">package</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.longrunning.*"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:actions</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-test:echo</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-test:message</span>&gt;This is executed before each test!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus-test:message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus-test:echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:before-test</span>&gt;</pre><p>The above before test component is only executed for test cases that match the name pattern <span class="emphasis"><em>*_Ok_Test</em></span> and that match the package <span class="emphasis"><em>com.consol.citrus.longrunning.*</em></span>. Also we could just use the test name pattern or
        the package name pattern exclusively. And the execution can be restricted based on the included test groups in our test suite run. This enables us to specify before test actions in various ways. Of course you can have multiple before test configuration components
        at the same time. Citrus will pick the right containers and put it to execution when necessary.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="testsuite-after-test"></a>31.4.&nbsp;After test</h2></div></div></div><p>The same logic that applies to the <span class="emphasis"><em>before-test</em></span> configuration component can be done after each test. The <span class="emphasis"><em>after-test</em></span> configuration component defines test actions executed after each test. Just like we prepared some data
          in actions before a test we can clean up the data after a test has finished execution.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:after-test</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"defaultAfterTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:actions</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-comment">!-- list of actions after test --</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:after-test</span>&gt;</pre><p>The after test configuration component receives a unique id and a list of test actions that get executed after a test case is finished. Notice that the after test actions are executed no matter what result success or failure the previous test case came up to.
          The component receives usual test action definitions just like you would write them in a normal test case definition. See the example below how to add test actions.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:after-test</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"defaultAfterTest"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:actions</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-test:echo</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-test:message</span>&gt;This is executed after each test!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus-test:message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus-test:echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:after-test</span>&gt;</pre><p>Please be aware of the fact that we must use the Citrus test case XML namespace for the nested test action definitions. You have to declare the XML namespaces accordingly in your configuration root element. The echo test action is now executed after each test in our
          test suite run. Of course we can restrict the after test container execution. Supported restrictions are based on the test name, package and test groups. See following example how this works:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:after-test</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"defaultAfterTest"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">test</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"*_Error_Test"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">package</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.error.*"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus:actions</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-test:echo</span>&gt;
              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-test:message</span>&gt;This is executed after each test!&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus-test:message</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus-test:echo</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:actions</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/citrus:after-test</span>&gt;</pre><p>The above after test component is obviously only executed for test cases that match the name pattern <span class="emphasis"><em>*_Error_Test</em></span> and that match the package <span class="emphasis"><em>com.consol.citrus.error.*</em></span>. Also we could just use the test name pattern or
        the package name pattern exclusively. And the execution can be restricted based on the included test groups in our test suite run. This enables us to specify after test actions in various ways. Of course you can have multiple after test configuration components
        at the same time. Citrus will pick the right containers and put it to execution when necessary.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="meta-info"></a>Chapter&nbsp;32.&nbsp;Customize meta information</h2></div></div></div><p>Test cases in Citrus are usually provided with some meta information like the author&#8217;s name or the 
    date of creation. In Citrus you are able to extend this test case meta information with your own very specific
    criteria.</p><p>By default a test case comes shipped with meta information that looks like this:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"PwdChange_OK_1_Test"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">meta-info</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">author</span>&gt;Christoph&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/author</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">creationdate</span>&gt;2010-01-18&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/creationdate</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">status</span>&gt;FINAL&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/status</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">last-updated-by</span>&gt;Christoph&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/last-updated-by</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">last-updated-on</span>&gt;2010-01-18T15:00:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/last-updated-on</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/meta-info</span>&gt;
 
    [...]
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;</pre><p>You can quite easily add data to this section in order to meet your individual testing strategy. 
    Let us have a simple example to show how it is done.</p><p>First of all we define a custom XSD schema describing the new elements:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">schema</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2001/XMLSchema"</span>  
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:tns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/samples/my-testcase-info"</span> 
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">targetNamespace</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/samples/my-testcase-info"</span>
        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">elementFormDefault</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"qualified"</span>&gt;
 
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"requirement"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"string"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"pre-condition"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"string"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"result"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"string"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"classification"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">type</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"string"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/schema</span>&gt;</pre><p>We have four simple elements (<span class="emphasis"><em>requirement</em></span>, <span class="emphasis"><em>pre-condition</em></span>, <span class="emphasis"><em>result</em></span> 
    and <span class="emphasis"><em>classification</em></span>) all typed as string. These new elements later go into the test case meta information section.</p><p>After we added the new XML schema file to the classpath of our project we need to announce the schema to Spring. As you might
    know already a Citrus test case is nothing else but a simple Spring configuration file with customized XML schema support. If we add new elements
    to a test case Spring needs to know the XML schema for parsing the test case configuration file. See the <span class="emphasis"><em>spring.schemas</em></span> file 
    usually placed in the META-INF/spring.schemas in your project.</p><p>The file content for our example will look like follows:</p><pre class="programlisting">http://www.citrusframework.org/samples/my-testcase-info/my-testcase-info.xsd=com/consol/citrus/schemas/my-testcase-info.xsd</pre><p>So now we are finally ready to use the new meta-info elements inside the test case:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">spring:beans</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/testcase"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:spring</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans"</span> 
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:custom</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/samples/my-testcase-info"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xsi</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans 
      http://www.springframework.org/schema/beans/spring-beans.xsd
      http://www.citrusframework.org/schema/testcase 
      http://www.citrusframework.org/schema/testcase/citrus-testcase.xsd 
      http://www.citrusframework.org/samples/my-testcase-info 
      http://www.citrusframework.org/samples/my-testcase-info/my-testcase-info.xsd"</span>&gt;
 
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"PwdChange_OK_1_Test"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">meta-info</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">author</span>&gt;Christoph&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/author</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">creationdate</span>&gt;2010-01-18&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/creationdate</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">status</span>&gt;FINAL&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/status</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">last-updated-by</span>&gt;Christoph&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/last-updated-by</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">last-updated-on</span>&gt;2010-01-18T15:00:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/last-updated-on</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">custom:requirement</span>&gt;REQ10001&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/custom:requirement</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">custom:pre-condition</span>&gt;Existing user, sufficient rights&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/custom:pre-condition</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">custom:result</span>&gt;Password reset in database&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/custom:result</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">custom:classification</span>&gt;PasswordChange&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/custom:classification</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/meta-info</span>&gt;
 
        [...]
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/spring:beans</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top">We use a separate namespace declaration with a custom namespace prefix &#8220;custom&#8221; in order to declare the new XML schema to our test case.
    Of course you can pick a namespace url and prefix that fits best for your project.</td></tr></table></div><p>As you see it is quite easy to add custom meta information to your Citrus test case. The customized elements may be precious for automatic reporting. 
    XSL transformations for instance are able to read those meta information elements in order to generate automatic test reports and documentation.</p><p>You can also declare our new XML schema in the Eclipse preferences section as user specific XML catalog entry. Then even the schema code completion 
    in your Eclipse XML editor will be available for our customized meta-info elements.</p></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="message-tracing"></a>Chapter&nbsp;33.&nbsp;Tracing incoming/outgoing messages</h2></div></div></div><p>As we deal with message based interfaces Citrus will send and receive a lot of messages during a test run. Now we may want to see these messages in 
    chronological order as they were processed by Citrus. We can enable message tracing in Citrus in order to save messages to the file system for further 
    investigations.</p><p>Citrus offers an easy way to debug all received messages to the file system. You need to enable some specific loggers and interceptors in the
    Citrus configuration (citrus-context.xml).</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.report.MessageTracingTestListener"</span>/&gt;</pre><p>Just add this bean to the Spring configuration and Citrus will listen for sent and received messages for saving those to the file system. You will find files
    like these in the default test-output folder after the test run:</p><p>For example:</p><p><code class="literal">logs/trace/messages/MyTest.msgs</code></p><p><code class="literal">logs/trace/messages/FooTest.msgs</code></p><p><code class="literal">logs/trace/messages/SomeTest.msgs</code></p><p>Each Citrus test writes a <span class="emphasis"><em>.msgs</em></span> file containing all messages that went over the wire during the test. By default the debug 
    directory is set to <code class="literal">logs/trace/messages/</code> relative to the project test output directory. But you can set your own output directory 
    in the configuration</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.report.MessageTracingTestListener"</span>&gt;
  &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"outputDirectory"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"file:/path/to/folder"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>As the file names do not change with each test run message tracing files may be overwritten. So you eventually need to 
        save the generated message debug files before running another group of test cases.</p></td></tr></table></div><p>Lets see some sample output for a test case with message communication over SOAP Http:</p><pre class="programlisting">Sending SOAP request:
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Envelope</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:SOAP-ENV</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://schemas.xmlsoap.org/soap/envelope/"</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">Operation</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://citrusframework.org/test"</span>&gt;sayHello&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/Operation</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SOAP-ENV:Header</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Body</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:HelloRequest</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:ns0</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/samples/sayHello.xsd"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:MessageId</span>&gt;0857041782&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:MessageId</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:CorrelationId</span>&gt;6915071793&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:CorrelationId</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:User</span>&gt;Christoph&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:User</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:Text</span>&gt;Hello WebServer&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:Text</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:HelloRequest</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SOAP-ENV:Body</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SOAP-ENV:Envelope</span>&gt;

======================================================================

Received SOAP response:
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Envelope</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:SOAP-ENV</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://schemas.xmlsoap.org/soap/envelope/"</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Header</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">SOAP-ENV:Body</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:HelloResponse</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:ns0</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.de/schemas/samples/sayHello.xsd"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:MessageId</span>&gt;0857041782&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:MessageId</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:CorrelationId</span>&gt;6915071793&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:CorrelationId</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:User</span>&gt;WebServer&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:User</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ns0:Text</span>&gt;Hello Christoph&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:Text</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/ns0:HelloResponse</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SOAP-ENV:Body</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/SOAP-ENV:Envelope</span>&gt;</pre><p>For this message tracing to work we need to add logging listeners to our sender and receiver components accordingly.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-ws:client</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"webServiceClient"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">request-url</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://localhost:8071"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">message-factory</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"messageFactory"</span>
    <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">interceptors</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"clientInterceptors"</span>/&gt;
    
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">util:list</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"clientInterceptors"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.ws.interceptor.LoggingClientInterceptor"</span>/&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/util:list</span>&gt;</pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.jpg"></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>Be aware of adding the Spring <span class="emphasis"><em>util</em></span> XML namespace to the citrus-context.xml when using the <span class="emphasis"><em>util:list</em></span> construct.</p></td></tr></table></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="reporting"></a>Chapter&nbsp;34.&nbsp;Reporting and test results</h2></div></div></div><p>The framework generates different reports and results after a test run for you. These report and result pages will
    help you to get an overview of the test cases that were executed and which one were failing.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="reporting-logging"></a>34.1.&nbsp;Console logging</h2></div></div></div><p>During the test run the framework will provide a huge amount of information that is printed out to
        the console. This includes current test progress, validation results and error information. This
        enables the user to quickly supervise the test run progress. Failures in tests will be printed to the
        console just the time the error occurred. The detailed stack trace information and the detailed
        error messages are helpful to get the idea what went wrong.</p><p>As the console output might be limited to a defined buffer limit, the user may not be able to
        follow the output to the very beginning of the test run. Therefore the framework additionally
        prints all information to a log file according to the logging configuration.</p><p>The logging mechanism uses the SLF4J logging framework. SLF4J is independent of logging framework implementations on the 
        market. So in case you use Log4J logging framework the specified log file path as well as logging levels can be freely configured 
        in the respective log4j.xml file in your project. At the end of a test run the combined test results get printed to both console 
        and log file. The overall test results look like following example:</p><pre class="programlisting">
CITRUS TEST RESULTS

  [...]
  HelloService_Ok_1             : SUCCESS
  HelloService_Ok_2             : SUCCESS
  EchoService_Ok_1              : SUCCESS
  EchoService_Ok_2              : SUCCESS
  EchoService_TempError_1       : SUCCESS
  EchoService_AutomacticRetry_1 : SUCCESS
  [...]
  
  Found 175 test cases to execute
  Skipped 0 test cases (0.0%)
  Executed 175 test cases
  Tests failed:         0 (0.0%)
  Tests successfully: 175 (100.0%)</pre><p>Failed tests will be marked as failed in the result list. The framework will give a short description
        of the error cause while the detailed stack trace information can be found in the log messages
        that were made during the test run.</p><pre class="programlisting">HelloService_Ok_3 : failed - Exception is Action timed out</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="reporting-junit"></a>34.2.&nbsp;JUnit reports</h2></div></div></div><p>As tests are executed as TestNG test cases, the framework will also generate JUnit compliant XML and HTML 
        reports. JUnit test reports are very popular and find support in many build management and development tools. 
        In general the Citrus test reports give you an overall picture of all tests and tell you which of them were failing.</p><p>Build management tools like Jenkins can easily import and display the generated JUnit
        XML results. Please have a look at the TestNG and JUnit documentation for more information about this topic as well 
        as the build management tools (e.g. Jenkins) to find out how to integrate the tests results.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="reporting-html"></a>34.3.&nbsp;HTML reports</h2></div></div></div><p>Citrus creates HTML reports after each test run. The report provides detailed information on the test run with a summary of all
        test results. You can find the report after a test run in the <code class="literal">target/test-output/citrus-reports</code> directory.</p><p>The report consists of two parts. The test summary on top shows the total number executed tests. The main part lists all test cases 
        with detailed information. With this report you immediately identify all tests that were failing. Each test case is marked in color 
        according to its result outcome.</p><p>The failed tests give detailed error information with error messages and Java StackTrace information. In addition to that the report 
        tries to find the test action inside the XML test part that failed in execution. With the failing code snippet you can see where the test stopped.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.jpg"></td><th align="left">Note</th></tr><tr><td align="left" valign="top"><p>JavaScript should be active in your web browser. This is to enable the detailed information which comes to you in form of tooltips
            like test author or description. If you want to access the tooltips JavaScript should be enabled in your browser.</p></td></tr></table></div></div></div><div class="appendix" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="samples"></a>Appendix&nbsp;A.&nbsp;Citrus Samples</h2></div></div></div><p>This part will show you some sample applications that are tested using Citrus integration tests. 
        See below a list of all samples.</p><div class="itemizedlist"><ul type="disc"><li><p><a href="#samples-flightbooking" title="A.1.&nbsp;The FlightBooking sample">Section&nbsp;A.1, &#8220;The FlightBooking sample&#8221;</a></p></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="samples-flightbooking"></a>A.1.&nbsp;The FlightBooking sample</h2></div></div></div><p>A simple project example should give you the idea how Citrus works. The system under test is a flight booking service that 
    handles travel requests from a travel agency. A travel request consists of a complete travel route including several flights. The 
    FlightBookingService application will split the complete travel booking into separate flight bookings that are sent to the respective
    airlines in charge. The booking and customer data is persisted in a database.</p><p>The airlines will confirm or deny the flight bookings. The FlightBookingService application consolidates all incoming flight 
    confirmations and combines them to a complete travel confirmation or denial that is sent back to the travel agency. Next picture
    tries to put the architecture into graphics:</p><p>
      </p><div class="mediaobject" align="center"><img src="images/samples/flightbooking/architecture_overview.jpg" align="middle"></div><p>
    </p><p>In our example two different airlines are connected to the FlightBookingService application: the SmartAriline over JMS and
    the RoyalAirline over Http.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="samples-flightbooking-usecase"></a>A.1.1.&nbsp;The use case</h3></div></div></div><p>The use case that we would like to test is quite simple. The test should handle a simple travel booking and expect a positive
        processing to the end. The test case neither simulates business errors nor technical problems. Next picture shows the use case
        as a sequence diagram.</p><p>
          </p><div class="mediaobject" align="center"><img src="images/samples/flightbooking/sequence_diagram.jpg" align="middle"></div><p>
        </p><p>The travel agency puts a travel booking request towards the system. The travel booking contains two separate flights. The
        flight requests are published to the airlines (SmartAirline and RoyalAirline). Both airlines confirm the flight bookings with a positive
        answer. The consolidated travel booking response is then sent back to the travel agency.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="samples-flightbooking-configuration"></a>A.1.2.&nbsp;Configure the simulated systems</h3></div></div></div><p>Citrus simulates all surrounding applications in their behavior during the test. The simulated applications are:
        TravelAgency, SmartAirline and RoyalAirline. The simulated systems have to be configured in the Citrus configuration first.
        The configuration is done in Spring XML configuration files, as Citrus uses Spring to glue all its services together.</p><p>First of all we have a look at the TravelAgency configuration. The TravelAgency is using JMS to connect to our tested system, so
        we need to configure this JMS connection in Citrus.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"connectionFactory"</span> 
         <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.apache.activemq.ActiveMQConnectionFactory"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"brokerURL"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"tcp://localhost:61616"</span> /&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-jms:endpoint</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"travelAgencyBookingRequestEndpoint"</span>
                      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${travel.agency.request.queue}"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-jms:endpoint</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"travelAgencyBookingResponseEndpoint"</span>
                      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${travel.agency.response.queue}"</span>/&gt;</pre><p>This is all Citrus needs to send and receive messages over JMS in order to simulate the TravelAgency. By default all JMS message
        senders and receivers need a connection factory. Therefore Citrus is searching for a bean named "connectionFactory". In the example
        we connect to a ActiveMQ message broker. A connection to other JMS brokers like TIBCO EMS or Apache ActiveMQ is possible too by
        simply changing the connection factory implementation.</p><p>The identifiers of the message senders and receivers are very important. We should think of suitable ids that give the
        reader a first hint what the sender/receiver is used for. As we want to simulate the TravelAgency in combination with sending
        booking requests our id is "travelAgencyBookingRequestEndpoint" for example.</p><p>The sender and receivers do also need a JMS destination. Here the destination names are provided by property expressions.
        The Spring IoC container resolves the properties for us. All we need to do is publish the property file to the Spring container
        like this.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"propertyLoader"</span> 
   <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"locations"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">list</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">value</span>&gt;citrus.properties&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/value</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/list</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/property</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">property</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"ignoreUnresolvablePlaceholders"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"true"</span>/&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bean</span>&gt;</pre><p>The citrus.properties file is located in our project's resources folder and defines the actual queue names besides
        other properties of course:</p><pre class="programlisting">#JMS queues
travel.agency.request.queue=Travel.Agency.Request.Queue
travel.agency.response.queue=Travel.Agency.Response.Queue
smart.airline.request.queue=Smart.Airline.Request.Queue
smart.airline.response.queue=Smart.Airline.Response.Queue
royal.airline.request.queue=Royal.Airline.Request.Queue</pre><p>What else do we need in our Spring configuration? There are some basic beans that are commonly defined in a Citrus
        application but I do not want to bore you with these details. So if you want to have a look at the "citrus-context.xml" 
        file in the resources folder and see how things are defined there.</p><p>We continue with the first airline to be configured the SmartAirline. The SmartAirline is also using JMS to communicate
        with the FlightBookingService. So there is nothing new for us, we simply define additional JMS message senders and receivers.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-jms:endpoint</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"smartAirlineBookingRequestEndpoint"</span>
                      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${smart.airline.request.queue}"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-jms:endpoint</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"smartAirlineBookingResponseEndpoint"</span>
                      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${smart.airline.response.queue}"</span>/&gt;</pre><p>We do not define a new JMS connection factory because TravelAgency and SmartAirline are using the same message broker instance.
        In case you need to handle multiple connection factories simply define the connection factory with the attribute "connection-factory".</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-jms:endpoint</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"smartAirlineBookingRequestEndpoint"</span>
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${smart.airline.request.queue}"</span>
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">connection-factory</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"smartAirlineConnectionFactory"</span>/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-jms:endpoint</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"smartAirlineBookingResponseEndpoint"</span>
                          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${smart.airline.response.queue}"</span>
                          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">connection-factory</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"smartAirlineConnectionFactory"</span>/&gt;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="samples-flightbooking-http"></a>A.1.3.&nbsp;Configure the Http adapter</h3></div></div></div><p>The RoyalAirline is connected to our system using Http request/response communication. This means we have to simulate a Http server
        in the test that accepts client requests and provides proper responses. Citrus offers a Http server implementation that will listen on a
        port for client requests. The adapter forwards incoming request to the test engine over JMS and receives a proper response that is 
        forwarded as a Http response to the client. The next picture shows this mechanism in detail.</p><p>
          </p><div class="mediaobject" align="center"><img src="images/samples/flightbooking/http_adapter.jpg" align="middle"></div><p>
        </p><p>The RoyalAirline adapter receives client requests over Http and sends them over JMS to a message receiver as we already know it. The
        test engine validates the received request and provides a proper response back to the adapter. The adapter will transform the response 
        to Http again and publishes it to the calling client. Citrus offers these kind of adapters for Http and SOAP communication. By writing 
        your own adapters like this you will be able to extend Citrus so it works with protocols that are not supported yet.</p><p>Let us define the Http adapter in the Spring configuration:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-http:server</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"royalAirlineHttpServer"</span> 
                       <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">port</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"8091"</span> 
                       <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">uri</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"/flightbooking"</span> 
                       <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint-adapter</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jmsEndpointAdapter"</span>/&gt;
        
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-jms:endpoint-adapter</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"jmsEndpointAdapter
      destination-name="</span><span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">${royal.airline.request.queue}"/&gt;</span>
      <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">connection-factory</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"connectionFactory"</span> /&gt;
      timeout="2000"/&gt;

&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">citrus-jms:sync-endpoint</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"royalAirlineBookingEndpoint"</span>
                            <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">destination-name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${royal.airline.request.queue}"</span>/&gt;</pre><p>We need to configure a Http server instance with a port, a request URI and the endpoint adapter. We define the
        JMS endpoint adapter to handle request as described. In Addition to the endpoint adapter we also need synchronous JMS
        message sender and receiver instances. That's it! We are able to receive Http request in order to simulate the RoyalAirline
        application. What is missing now? The test case definition itself.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="samples-flightbooking-testcase"></a>A.1.4.&nbsp;The test case</h3></div></div></div><p>The test case definition is also a Spring configuration file. Citrus offers a customized XML syntax to define a test case.
        This XML test defining language is supposed to be easy to understand and more specific to the domain we are dealing with. Next listing
        shows the whole test case definition. Keep in mind that a test case defines every step in the use case. So we define sending and 
        receiving actions of the use case as described in the sequence diagram we saw earlier.</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">?xml version="1.0" encoding="UTF-8"?</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">spring:beans</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.citrusframework.org/schema/testcase"</span> 
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:spring</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans"</span> 
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns:xsi</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.w3.org/2001/XMLSchema-instance"</span> 
             <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xsi:schemaLocation</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.springframework.org/schema/beans 
             http://www.springframework.org/schema/beans/spring-beans.xsd 
             http://www.citrusframework.org/schema/testcase 
             http://www.citrusframework.org/schema/testcase/citrus-testcase.xsd"</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">testcase</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"FlightBookingTest"</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">meta-info</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">author</span>&gt;Christoph Deppisch&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/author</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">creationdate</span>&gt;2009-04-15&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/creationdate</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">status</span>&gt;FINAL&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/status</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">last-updated-by</span>&gt;Christoph Deppisch&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/last-updated-by</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">last-updated-on</span>&gt;2009-04-15T00:00:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/last-updated-on</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/meta-info</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">description</span>&gt;
            Test flight booking service.
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/description</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variables</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"correlationId"</span> 
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:concat('Lx1x', 'citrus:randomNumber(10)')"</span>/&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">variable</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"customerId"</span> 
                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"citrus:concat('Mx1x', citrus:randomNumber(10))"</span>/&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/variables</span>&gt;
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">actions</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"travelAgencyBookingRequestEndpoint"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
                      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;TravelBookingRequestMessage</span> 
                          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.com/schemas/TravelAgency"</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">correlationId</span>&gt;${correlationId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/correlationId</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">customer</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">id</span>&gt;${customerId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/id</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">firstname</span>&gt;John&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/firstname</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">lastname</span>&gt;Doe&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/lastname</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/customer</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flights</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flight</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flightId</span>&gt;SM 1269&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flightId</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">airline</span>&gt;SmartAirline&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/airline</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">fromAirport</span>&gt;MUC&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/fromAirport</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">toAirport</span>&gt;FRA&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/toAirport</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">date</span>&gt;2009-04-15&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/date</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scheduledDeparture</span>&gt;11:55:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scheduledDeparture</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scheduledArrival</span>&gt;13:00:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scheduledArrival</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flight</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flight</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flightId</span>&gt;RA 1780&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flightId</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">airline</span>&gt;RoyalAirline&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/airline</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">fromAirport</span>&gt;FRA&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/fromAirport</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">toAirport</span>&gt;HAM&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/toAirport</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">date</span>&gt;2009-04-15&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/date</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scheduledDeparture</span>&gt;16:00:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scheduledDeparture</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scheduledArrival</span>&gt;17:10:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scheduledArrival</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flight</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flights</span>&gt;                                
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/TravelBookingRequestMessage</span>&gt;
                      ]]&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"correlationId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;
            
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"smartAirlineBookingRequestEndpoint"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
                      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;FlightBookingRequestMessage</span> 
                          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.com/schemas/AirlineSchema"</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">correlationId</span>&gt;${correlationId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/correlationId</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bookingId</span>&gt;???&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bookingId</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">customer</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">id</span>&gt;${customerId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/id</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">firstname</span>&gt;John&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/firstname</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">lastname</span>&gt;Doe&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/lastname</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/customer</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flight</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flightId</span>&gt;SM 1269&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flightId</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">airline</span>&gt;SmartAirline&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/airline</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">fromAirport</span>&gt;MUC&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/fromAirport</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">toAirport</span>&gt;FRA&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/toAirport</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">date</span>&gt;2009-04-15&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/date</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scheduledDeparture</span>&gt;11:55:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scheduledDeparture</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scheduledArrival</span>&gt;13:00:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scheduledArrival</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flight</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/FlightBookingRequestMessage</span>&gt;
                      ]]&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ignore</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//:FlightBookingRequestMessage/:bookingId"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"correlationId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">extract</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//:FlightBookingRequestMessage/:bookingId"</span> 
                                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">variable</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${smartAirlineBookingId}"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/extract</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;
            
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"smartAirlineBookingResponseEndpoint"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
                      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;FlightBookingConfirmationMessage</span> 
                          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.com/schemas/AirlineSchema"</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">correlationId</span>&gt;${correlationId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/correlationId</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bookingId</span>&gt;${smartAirlineBookingId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bookingId</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">success</span>&gt;true&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/success</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flight</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flightId</span>&gt;SM 1269&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flightId</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">airline</span>&gt;SmartAirline&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/airline</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">fromAirport</span>&gt;MUC&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/fromAirport</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">toAirport</span>&gt;FRA&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/toAirport</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">date</span>&gt;2009-04-15&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/date</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scheduledDeparture</span>&gt;11:55:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scheduledDeparture</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scheduledArrival</span>&gt;13:00:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scheduledArrival</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flight</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/FlightBookingConfirmationMessage</span>&gt;
                      ]]&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"correlationId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;
            
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"royalAirlineBookingEndpoint"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
                      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;FlightBookingRequestMessage</span> 
                          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.com/schemas/FlightBooking/AirlineSchema"</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">correlationId</span>&gt;${correlationId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/correlationId</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bookingId</span>&gt;???&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bookingId</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">customer</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">id</span>&gt;${customerId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/id</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">firstname</span>&gt;John&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/firstname</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">lastname</span>&gt;Doe&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/lastname</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/customer</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flight</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flightId</span>&gt;RA 1780&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flightId</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">airline</span>&gt;RoyalAirline&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/airline</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">fromAirport</span>&gt;FRA&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/fromAirport</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">toAirport</span>&gt;HAM&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/toAirport</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">date</span>&gt;2009-04-15&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/date</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scheduledDeparture</span>&gt;16:00:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scheduledDeparture</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scheduledArrival</span>&gt;17:10:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scheduledArrival</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flight</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/FlightBookingRequestMessage</span>&gt;
                      ]]&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">ignore</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//:FlightBookingRequestMessage/:bookingId"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"correlationId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">extract</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">path</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"//:FlightBookingRequestMessage/:bookingId"</span> 
                                <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">variable</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${royalAirlineBookingId}"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/extract</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;
            
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">send</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"royalAirlineBookingEndpoint"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
                      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;FlightBookingConfirmationMessage</span> 
                          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.com/schemas/AirlineSchema"</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">correlationId</span>&gt;${correlationId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/correlationId</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bookingId</span>&gt;${royalAirlineBookingId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/bookingId</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">success</span>&gt;true&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/success</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flight</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flightId</span>&gt;RA 1780&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flightId</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">airline</span>&gt;RoyalAirline&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/airline</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">fromAirport</span>&gt;FRA&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/fromAirport</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">toAirport</span>&gt;HAM&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/toAirport</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">date</span>&gt;2009-04-15&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/date</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scheduledDeparture</span>&gt;16:00:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scheduledDeparture</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scheduledArrival</span>&gt;17:10:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scheduledArrival</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flight</span>&gt;
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/FlightBookingConfirmationMessage</span>&gt;
                      ]]&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"correlationid"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/send</span>&gt;
            
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">receive</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">endpoint</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"travelAgencyBookingResponseEndpoint"</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">message</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">data</span>&gt;
                      &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">![CDATA[</span>
                        <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">&lt;TravelBookingResponseMessage</span> 
                          <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">xmlns</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"http://www.consol.com/schemas/TravelAgency"</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">correlationId</span>&gt;${correlationId}&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/correlationId</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">success</span>&gt;true&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/success</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flights</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flight</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flightId</span>&gt;SM 1269&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flightId</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">airline</span>&gt;SmartAirline&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/airline</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">fromAirport</span>&gt;MUC&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/fromAirport</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">toAirport</span>&gt;FRA&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/toAirport</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">date</span>&gt;2009-04-15&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/date</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scheduledDeparture</span>&gt;11:55:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scheduledDeparture</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scheduledArrival</span>&gt;13:00:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scheduledArrival</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flight</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flight</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">flightId</span>&gt;RA 1780&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flightId</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">airline</span>&gt;RoyalAirline&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/airline</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">fromAirport</span>&gt;FRA&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/fromAirport</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">toAirport</span>&gt;HAM&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/toAirport</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">date</span>&gt;2009-04-15&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/date</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scheduledDeparture</span>&gt;16:00:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scheduledDeparture</span>&gt;
                              &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">scheduledArrival</span>&gt;17:10:00&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/scheduledArrival</span>&gt;
                            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flight</span>&gt;
                          &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/flights</span>&gt;                                
                        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/TravelBookingResponseMessage</span>&gt;
                      ]]&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/data</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/message</span>&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">header</span>&gt;
                    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">element</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">name</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"correlationId"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">value</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"${correlationId}"</span>/&gt;
                &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/header</span>&gt;
            &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/receive</span>&gt;
            
        &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/actions</span>&gt;
    &lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/testcase</span>&gt;
&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">/spring:beans</span>&gt;</pre><p>Similar to a sequence diagram the test case describes every step of the use case. At the very beginning the test case gets
        name and its meta information. Following with the variable values that are used all over the test. Here it is the correlationId 
        and the customerId that are used as test variables. Inside message templates header values the variables are referenced several
        times in the test</p><p><code class="literal">&lt;correlationId&gt;${correlationId}&lt;/correlationId&gt;</code></p><p><code class="literal">&lt;id&gt;${customerId}&lt;/id&gt;</code></p><p>The sending/receiving actions use a previously defined message sender/receiver. This is the link between test case and basic 
        Spring configuration we have done before.</p><p><code class="literal">&lt;send endpoint="travelAgencyBookingRequestEndpoint"&gt;</code></p><p>The sending action chooses a message sender to actually send the message using a message transport (JMS, Http, SOAP, etc.).
        After sending this first "TravelBookingRequestMessage" request the test case expects the first "FlightBookingRequestMessage" 
        message on the SmartAirline JMS destination. In case this message is not arriving in time the test will fail with errors.
        In positive case our FlightBookingService works well and the message arrives in time. The received message is validated against
        a defined expected message template. Only in case all content validation steps are successful the test continues with the action
        chain. And so the test case proceeds and works through the use case until every message is sent respectively received and 
        validated. The use case is done automatically without human interaction. Citrus simulates all surrounding applications and 
        provides detailed validation possibilities of messages.</p></div></div></div><div class="appendix" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="changes-history"></a>Appendix&nbsp;B.&nbsp;Change History</h2></div></div></div><p>In the following sections we you will find out what has happened in the past Citrus releases.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="history-2-1"></a>B.1.&nbsp;Changes in Citrus 2.1</h2></div></div></div><p>Citrus 2.1 adds some enhancements to the Citrus feature set as well as bugfixes and improvements. See the following overview on what has changed.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="new-2-1-soap-mtom"></a>B.1.1.&nbsp;SOAP MTOM support</h3></div></div></div><p>SOAP MTOM stands for Message Transmission Optimization Mechanism which allows you to send and receive large SOAP attachment contents streamed with optimized resource allocation on server and client. Many thanks to community contributions (github/stonator) that made
      this happen with Citrus SOAP client and server. As a user you can shoose to send and receive SOAP attachments with MTOM optimization. See <a href="#soap-attachment-mtom" title="17.9.3.&nbsp;SOAP MTOM support">Section&nbsp;17.9.3, &#8220;SOAP MTOM support&#8221;</a> for details.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="new-2-1-soap-keep-envelope"></a>B.1.2.&nbsp;SOAP envelope handling</h3></div></div></div><p>In its default behavior Citrus will remove the SOAP envelope for incoming SOAP requests just providing the SOAP body as message payload. This is more straight forward in a test case to perform further validation steps. However it might be mandatory to see the whole SOAP envelope
      inside the test case for special validation. As a user you can now choose how to handle incoming SOAP envelope by definig the <span class="emphasis"><em>keep-soap-envelope</em></span> setting on the Citrus SOAP server components. See <a href="#soap-keep-envelope" title="17.5.&nbsp;SOAP Envelope handling">Section&nbsp;17.5, &#8220;SOAP Envelope handling&#8221;</a> for details.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="new-2-1-soap-1-2"></a>B.1.3.&nbsp;SOAP 1.2 message factory</h3></div></div></div><p>The Citrus SOAP server component was missing a setting for the SOAP message factory to use. The SOAP message factory implementation decides which SOAP version to use 1.1 or 1.2. Now you can set the message factory on the server component and define the SOAP version to use.
      See <a href="#soap-12" title="17.6.&nbsp;SOAP 1.2">Section&nbsp;17.6, &#8220;SOAP 1.2&#8221;</a> for details.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="new-2-1-testng-data-provider"></a>B.1.4.&nbsp;TestNG data provider handling</h3></div></div></div><p>We improved the TestNG data provider handling in Citrus. Now you can use the usual TestNG data provider annotations in your test methods. TestNG will call the Citrus test case several times with respective parameters provided as test variables. This replaces the old <span class="emphasis"><em>citrusDataProvider</em></span>
      mechanism that tried to make things working in a kind of workaround. The new provider handling also supports multiple data providers in a test class. <a href="#run-testng-data-providers" title="6.1.1.&nbsp;Using TestNG DataProviders">Section&nbsp;6.1.1, &#8220;Using TestNG DataProviders&#8221;</a> describes how this is working for you.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="new-2-1-mail-namespace"></a>B.1.5.&nbsp;Mail message namespace</h3></div></div></div><p>The Citrus mail components enable message exchange as mail client and server. For validation purpose the components offer a XML mail message representation. We have added a target namespace <span class="emphasis"><em>xmlns="http://www.citrusframework.org/schema/mail/message"</em></span> and a
      XSD schema for this XML mail message representation. From now on you have to use the namespace accordingly in your mail message payloads when sending and receiving mail messages in Citrus. See <a href="#mail" title="Chapter&nbsp;23.&nbsp;Mail support">Chapter&nbsp;23, <i xmlns:xlink="http://www.w3.org/1999/xlink">Mail support</i></a> how to use the new XML mail message namespace.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="new-2-1-ssh-namespace"></a>B.1.6.&nbsp;Ssh message namespace</h3></div></div></div><p>When sending and receiving messages via ssh Citrus provides a XML representation for request and response data. These ssh messages follow a new target namespace <span class="emphasis"><em>xmlns="http://www.citrusframework.org/schema/ssh/message"</em></span> and a
      XSD schema. This means you have to use the namespace accordingly in your ssh message payloads when sending and receiving ssh messages in Citrus. See <a href="#ssh" title="Chapter&nbsp;25.&nbsp;SSH support">Chapter&nbsp;25, <i xmlns:xlink="http://www.w3.org/1999/xlink">SSH support</i></a> for further details.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="history-2-0"></a>B.2.&nbsp;Changes in Citrus 2.0</h2></div></div></div><p>Citrus 2.0 is a major version upgrade and therefore big things should be happening. In the following sections
      we shortly describe the Citrus evolution. We want you to get a quick overview of what has happened and all the new
      things in Citrus. So hopefully you can spot your favorite new feature.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-2-0-refactoring"></a>B.2.1.&nbsp;Refactoring</h3></div></div></div><p>In Citrus 1.4 we began to refactor the configuration components in Citrus. This refactoring was finalized in Citrus 2.0 which means that all deprecated
        classes and api are no longer supported. The classes were removed so you get compilation errors when using those old stuff. If you still use the old configuration see
        this <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://citrusframework.org/migration-sheet.html" target="_top">migration-sheet</a> in order to learn how to upgrade to the new configuration. It is worth to do so!
        In addition to that we did refactoring in following fields:</p><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>Reply message correlation</em></span> In synchronous communication scenarios Citrus optionally correlated messages across send and receive test actions.
            In default setting the message correlation was disabled. With 2.0 release we changed this behavior to the opposite. Now message correlation is done by default with a
            default correlation algorithm. So in case you used the DefaultReplyMessageCorrelator in Citrus before you will not have to do so in future as this is done by default.
            The message correlation gives us more robust tests especially when executing tests in parallel. In the test case you do not have to do anything for proper message correlation.</p></li><li><p><span class="emphasis"><em>Citrus message API</em></span> We have refactored the Citrus message API to use custom message objects in endpoints, consumers and producers. This has no affect on your tests
            or configuration unless you have written endpoint extensions or custom endpoints on your own. You might have to refector your code accordingly. Have a look at the Citrus endpoint implementations
            in order to see how the new message API works for you.</p></li><li><p><span class="emphasis"><em>Sleep time in milliseconds</em></span> This is something that we definitely carry around since the beginning of Citrus. The time values in sleep
            test action were done in seconds, which is inconvenient when using time periods below one second or non natural numbers. Now you can choose to use milliseconds which
            is more likely how you should configure time periods anyway. See <a href="#actions-sleep" title="11.2.&nbsp;Sleep">Section&nbsp;11.2, &#8220;Sleep&#8221;</a> for details</p></li><li><p><span class="emphasis"><em>Auto sleep time in milliseconds</em></span> We used seconds when using auto sleep in repeat on error container. This led to the fact that we were not able to
            sleep time periods below one second. Also it was not possible to specify non natural numbers such as 1.5 seconds auto sleep time. We changed to milliseconds which
            is more likely how you are used to configure time periods anyway. See <a href="#containers-repeat-onerror" title="13.6.&nbsp;Repeat on error until true">Section&nbsp;13.6, &#8220;Repeat on error until true&#8221;</a> for details</p></li><li><p><span class="emphasis"><em>Message handler vs. endpoint adapter</em></span> In previous releases prior to 1.4 we had message handlers on server side that were able to forward in coming requests to message
            channels or jms destinations. The old message handler implementations were removed in 2.0. Instead you should use the <span class="emphasis"><em>endpoint-adapter</em></span> implementations. See <a href="#endpoint-adapter" title="Chapter&nbsp;27.&nbsp;Endpoint adapter">Chapter&nbsp;27, <i xmlns:xlink="http://www.w3.org/1999/xlink">Endpoint adapter</i></a> how that works.</p></li><li><p><span class="emphasis"><em>XML endpoint reference attribute</em></span> In a XML test case you reference the message endpoint in the send and receive actions with a special attribute called <span class="emphasis"><em>with</em></span>.
            This attribute is no longer supported and was removed. Instead you should use the <span class="emphasis"><em>endpoint</em></span> attribute which was introduced in Citrus 1.4 and has the exact same functionality.</p></li><li><p><span class="emphasis"><em>Removed citrus-adapter module</em></span> The Maven module <span class="emphasis"><em>citrus-adapter</em></span> was removed. Classes and API moved to <span class="emphasis"><em>citrus-core</em></span> module. For endpoint adapters
            do use the new configuration components that were introduced in Citrus 1.4. See <a href="#endpoint-adapter" title="Chapter&nbsp;27.&nbsp;Endpoint adapter">Chapter&nbsp;27, <i xmlns:xlink="http://www.w3.org/1999/xlink">Endpoint adapter</i></a> for details.</p></li><li><p><span class="emphasis"><em>WebServiceEndpoint class renamed</em></span> In terms of package refactoring the <span class="emphasis"><em>com.consol.citrus.ws.WebServiceEndpoint</em></span> was renamed to <span class="emphasis"><em>com.consol.citrus.ws.server.WebServiceEndpoint</em></span></p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-2-0-spring-4"></a>B.2.2.&nbsp;Spring framework 4.x</h3></div></div></div><p>In terms of upgrading the Citrus API dependencies we introduced Spring 4.x versions. This includes the core Spring framework libraries as well as the Spring Integration and Spring WebService project artifacts. So with the major version upgrade lots of
        API changes were also done in Citrus code in order to meet the new Spring 4.x API. So we recommend for you to also use Spring 4.x version in your Citrus projects.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-2-0-ftp"></a>B.2.3.&nbsp;FTP support</h3></div></div></div><p>New member of the Citrus family deals with FTP connectivity. The new <span class="emphasis"><em>citrus-ftp</em></span> module provides a neat ftp server and client implementation so you can send and receive messages vie FTP message transport.
        <a href="#ftp" title="Chapter&nbsp;18.&nbsp;FTP support">Chapter&nbsp;18, <i xmlns:xlink="http://www.w3.org/1999/xlink">FTP support</i></a> describes the new functionality in detail.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-2-0-functions-refactoring"></a>B.2.4.&nbsp;Functions with test context access</h3></div></div></div><p>Functions are now able to access the test context. This enables you to access all test variables and other central test related components
        in a function implementation. Therefore the function Java interface has now an additional test context parameter. Refactor your custom written functions accordingly to meet the new interface rules.
        See <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.citrusframework.org/tutorials-functions.html" target="_top">how to write custom functions</a> for details.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-2-0-matcher-refactoring"></a>B.2.5.&nbsp;Validation matcher with test context access</h3></div></div></div><p>Just like functions now validation matchers are able to access the test context. This enables you to access all test variables and other central test related components
        in a validation matcher implementation. The validation matcher Java interface has changed accordingly with an additional test context parameter. Refactor your custom written matcher implementation accordingly to meet the new interface rules.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-2-0-message-listener-refactoring"></a>B.2.6.&nbsp;Message listener with test context access</h3></div></div></div><p>Message listeners do now also have access to the test context. This is more powerful as you can access test variables and other central components within the test context.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-2-0-soap-jms"></a>B.2.7.&nbsp;SOAP over JMS</h3></div></div></div><p>SOAP over JMS was supported in Citrus from the very beginning. Unfortunately you had to always specify the whole SOAP envelope in your test case. SOAP envelope handling is now done automatically by Citrus when using the new <span class="emphasis"><em>SoapJmsMessageConverter</em></span>.
        The converter takes care on constructing a proper SOAP envelope message. See <a href="#jms-soap" title="15.5.&nbsp;SOAP over JMS">Section&nbsp;15.5, &#8220;SOAP over JMS&#8221;</a> for details.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-2-0-soap-attachments"></a>B.2.8.&nbsp;Multiple SOAP attachments</h3></div></div></div><p>When sending and receiving SOAP messages with Citrus as client or server you can add one to many attachments to the message. Before it was only possible to have one single attachment in a message. Now you have no limits in defining SOAP attachments.
        See <a href="#soap-webservices" title="Chapter&nbsp;17.&nbsp;SOAP WebServices">Chapter&nbsp;17, <i xmlns:xlink="http://www.w3.org/1999/xlink">SOAP WebServices</i></a> for details.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-2-0-soap-header"></a>B.2.9.&nbsp;Multiple SOAP XML header fragments</h3></div></div></div><p>The SOAP header can hold multiple XML header fragments with different namespaces and content. With Citrus 2.0 you are able to construct such a SOAP message with multiple header contents.
        See <a href="#soap-webservices" title="Chapter&nbsp;17.&nbsp;SOAP WebServices">Chapter&nbsp;17, <i xmlns:xlink="http://www.w3.org/1999/xlink">SOAP WebServices</i></a> for details.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-2-0-variable-matcher"></a>B.2.10.&nbsp;Create variable validation matcher</h3></div></div></div><p>A new validation matcher implementation is able to create a new variable on the fly. The actual field name is used as variable name and the element value as variable value. The variable name can slo be customized with optional
        validation matcher parameter. This is a great alternative to the XPath expression evaluating variable extraction. Also very handsome to use this validation matcher in Json message payloads. See <a href="#validation-matcher-variable" title="29.12.&nbsp;variable()">Section&nbsp;29.12, &#8220;variable()&#8221;</a> for details.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-2-0-configuration-components"></a>B.2.11.&nbsp;New configuration components</h3></div></div></div><p>A major part of the Citrus configuration is done in a Spring bean application context. Central Citrus components and features are added as Spring beans to the application context. Now with Citrus 2.0 we have added special configuration components
        for almost all features. This means that you can easily add configuration using the new XML schema components. See which components are available:</p><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>Function library</em></span> Custom function libraries with custom function implementations are now configured with the <span class="emphasis"><em>function-library</em></span> XML schema components in
            the Spring application context configuration. See <a href="#functions" title="Chapter&nbsp;28.&nbsp;Functions">Chapter&nbsp;28, <i xmlns:xlink="http://www.w3.org/1999/xlink">Functions</i></a> for details.</p></li><li><p><span class="emphasis"><em>Validation matcher library</em></span> Custom validation matcher implementations are now configured with the <span class="emphasis"><em>validation-matcher-library</em></span> XML schema components in
            the Spring application context configuration. See <a href="#validation-matchers" title="Chapter&nbsp;29.&nbsp;Validation matcher">Chapter&nbsp;29, <i xmlns:xlink="http://www.w3.org/1999/xlink">Validation matcher</i></a> for details.</p></li><li><p><span class="emphasis"><em>Data dictionary</em></span> Data dictionaries apply to all messages send and received in test cases. You can define multiple dictionaries using the <span class="emphasis"><em>data-dictionary</em></span> XML schema components in
            the Spring application context configuration. See <a href="#data-dictionary" title="Chapter&nbsp;30.&nbsp;Data dictionaries">Chapter&nbsp;30, <i xmlns:xlink="http://www.w3.org/1999/xlink">Data dictionaries</i></a> for details.</p></li><li><p><span class="emphasis"><em>Namespace context</em></span> Configuration of a global namespace context is necessary for XML message payloads and XPath expressions used in the test cases. The <span class="emphasis"><em>namespace-context</em></span> XML schema component is used in
            the Spring application context configuration and simplifies the configuration. See <a href="#xpath" title="Chapter&nbsp;10.&nbsp;Using XPath">Chapter&nbsp;10, <i xmlns:xlink="http://www.w3.org/1999/xlink">Using XPath</i></a> for details.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-2-0-before-after-suite"></a>B.2.12.&nbsp;Before/after suite components</h3></div></div></div><p>When executing test actions before the actual test run you can use the sequence before suite components. We have improved these components to use a special XML schema. This enables easy configuration of both before and after suite actions. In addition
        to that you can bind the suite actions to special packages, test names or suite names. So you can now have more than one sequence before suite at the same time. According to the environment settings the before suite actions are executed or left out.
        Last not least we have done the same improvement to the before test actions and we have introduced a after test sequence component for execution after each test. See how this is done in <a href="#testsuite" title="Chapter&nbsp;31.&nbsp;Actions before/after the test run">Chapter&nbsp;31, <i xmlns:xlink="http://www.w3.org/1999/xlink">Actions before/after the test run</i></a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-2-0-jms-module"></a>B.2.13.&nbsp;Citrus JMS module</h3></div></div></div><p>JMS support has been a major part of Citrus from the very beginning. Up to now the JMS features were located in <span class="emphasis"><em>citrus-core</em></span> Maven module. With Citrus 2.0 we introduced a separate <span class="emphasis"><em>citrus-jms</em></span>
        Maven module. This means that you might have to add proper Maven dependency of this new module in your existing project when using JMS. See how this is done in <a href="#jms" title="Chapter&nbsp;15.&nbsp;JMS support">Chapter&nbsp;15, <i xmlns:xlink="http://www.w3.org/1999/xlink">JMS support</i></a>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="history-1-4"></a>B.3.&nbsp;Changes in Citrus 1.4.x</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-4-refactoring"></a>B.3.1.&nbsp;Refactoring</h3></div></div></div><p>It was time for us to do some code refactoring in Citrus. Many users struggled with the configuration
        of the Citrus components and project setup was too verbose in some areas. This is why we tried to improve things
        with working over the basic concepts and components in Citrus.</p><p>The outcome is a new Citrus 1.4 which has new configuration components for sending and receiving messages. Also the
        client and server components for HTTP and SOAP have changed in terms of simplification. Unfortunately
        refactoring comes along with code deprecation. This is why you have to also change your project code and configuration in the future.
        This is especially when you have made code adjustments and extensions to the Citrus API.</p><p>The good news now is that with Citrus 1.4 both old and new configuration works fine, so you do not have to change your
        existing project configuration when coming from Citrus 1.3.x and earlier versions. But there is a lot of code marked as deprecated in Citrus 1.4.
        Have a look at what has been marked as deprecated and update your code to use the new API.</p><p>We have set up a migration sheet for users coming from Citrus 1.3.x and earlier versions in order to find a quick overview
        of what has changed and how to use the new configuration components: <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://citrusframework.org/migration-sheet.html" target="_top">Citrus 1.4 migration-sheet</a></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-4-data-dictionary"></a>B.3.2.&nbsp;Data dictionaries</h3></div></div></div><p>Data dictionaries define dynamic placeholders for message payload element values in general manner. In terms of
        setting the same message element across all test cases and all test actions the dictionary provides an easy key-value
        approach.</p><p>When dealing with any kind of message payload Citrus will ask the data dictionary for possible translation of
        the message elements contained. The dictionary keys do match to a specific message element defined by XPath expression
        or document path expression for instance. The respective value is then set on all messages in Citrus (inbound and outbound).</p><p>Dictionaries do apply to XML or JSON message data and can be defined in global or specific scope. Find out more detailed
        information about this topic in <a href="#data-dictionary" title="Chapter&nbsp;30.&nbsp;Data dictionaries">Chapter&nbsp;30, <i xmlns:xlink="http://www.w3.org/1999/xlink">Data dictionaries</i></a></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-4-mail"></a>B.3.3.&nbsp;Mail adapter</h3></div></div></div><p>With the new mail adapter you are able to both send and receive mail messages within a test case. The new Citrus
        mail client produces a mail mime part message with usual mail headers and a text body part. Optional attachment parts are
        supported, too.</p><p>On the server side Citrus provides a SMTP server to accept client mail messages. The incoming mail messages can have
        multiple text parts and attachment parts. As usual you can validate the incoming mail messages regarding headers and payload
        with the well known validation capabilities in Citrus.</p><p>Read more about the new mail module in <a href="#mail" title="Chapter&nbsp;23.&nbsp;Mail support">Chapter&nbsp;23, <i xmlns:xlink="http://www.w3.org/1999/xlink">Mail support</i></a></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-4-endpoint-adapter"></a>B.3.4.&nbsp;Endpoint adapter</h3></div></div></div><p>Endpoint adapters help to customize the behavior of a Citrus server such as HTTP or SOAP web servers. The endpoint adapter
        is responsible of creating an endpoint that responds to inbound requests. You can customize the behavior so the Citrus server
        handles incoming requests as you like.</p><p>By default the Citrus server uses a channel endpoint adapter so incoming messages get forwarded to an in memory message channel.
        There are several other implementations available as endpoint adapter. Read more about that in <a href="#endpoint-adapter" title="Chapter&nbsp;27.&nbsp;Endpoint adapter">Chapter&nbsp;27, <i xmlns:xlink="http://www.w3.org/1999/xlink">Endpoint adapter</i></a></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-4-global-variables"></a>B.3.5.&nbsp;Global variables component</h3></div></div></div><p>We added a global variables XML configuration component for more comfortable usage in basic Spring application context
        configuration. The component is able to create new global variables that are valid across all Citrus test cases. This can also
        be done by loading a property file from an external file resource. Find out how to us it in <a href="#testcase-global-variables" title="4.1.3.&nbsp;Global variables">Section&nbsp;4.1.3, &#8220;Global variables&#8221;</a></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-4-json-validator-mode"></a>B.3.6.&nbsp;Json text validator mode</h3></div></div></div><p>The Json text validator is now able to operate in two different modes. The <span class="emphasis"><em>strict</em></span> mode is the default mode and validation includes
        also a strict check on all sub-objects and JSON array elements. So if there is an object missing the validation will fail immediately. Sometimes it may be
        accurate to only validate a subset of all JSON objects in the data structure. Therefore the non-strict mode does not check on object attribute counts.
        See more description in <a href="#validation-json" title="8.1.&nbsp;JSON message validation">Section&nbsp;8.1, &#8220;JSON message validation&#8221;</a></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-4-http-options"></a>B.3.7.&nbsp;HTTP REST specific Java DSL options</h3></div></div></div><p>When sending and receiving HTTP messages on REST APIs you can now use interface specific options in the Java DSL. This refers to
        request uri, context path, query parameters and HTTP status codes for instance. With this enhancement you are now more comfortable in handling REST API calls in Citrus.
        Find out how to us it in <a href="#http" title="Chapter&nbsp;16.&nbsp;HTTP REST support">Chapter&nbsp;16, <i xmlns:xlink="http://www.w3.org/1999/xlink">HTTP REST support</i></a></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-4-soap-http-uri"></a>B.3.8.&nbsp;SOAP HTTP validation</h3></div></div></div><p>While receiving SOAP messages over HTTP we are now able to also verify the used HTTP uri, context-path and query parameters. You can expect clients to
        use those values in your receive action as you would do in normal HTTP communication within Citrus. This completes the HTTP server
        validation when using SOAP over HTTP. Read more about it in <a href="#soap-webservices" title="Chapter&nbsp;17.&nbsp;SOAP WebServices">Chapter&nbsp;17, <i xmlns:xlink="http://www.w3.org/1999/xlink">SOAP WebServices</i></a></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-4-camel"></a>B.3.9.&nbsp;Apache Camel integration</h3></div></div></div><p>Apache Camel is a great enterprise integration platform that implements the enterprise integration patterns for building powerful mediation and routing rules for
        message based integration applications. With the new support for camel endpoints in Citrus you can interact with Apache Camel components for sending and receiving messages.
        Apache Camel offers a fine support for different message transports that now can be used in Citrus also. In addition to that you can put your Camel application to the test with
        loading of the Apache Camel context with all your route definitions. Citrus is able to interact with these routes in asynchronous and synchronous communication scenarios.
        Read about it in <a href="#camel" title="Chapter&nbsp;21.&nbsp;Apache Camel support">Chapter&nbsp;21, <i xmlns:xlink="http://www.w3.org/1999/xlink">Apache Camel support</i></a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-4-vertx"></a>B.3.10.&nbsp;Vert.x integration</h3></div></div></div><p>Vert.x is a very powerful application platform that provides scalable messaging for several message transports such as HTTP, WebSockets, TCP and more. Vert.x also has a
        distributed event bus that connects multiple Vert.x instances across the network. With Citrus 1.4 the Vert.x platform is integrated with Citrus event bus endpoints. So you can participate
        in communicating to the Vert.x event bus from Citrus test case. This enables you to add automated integration tests to the Vert.x platform. Read about that in <a href="#vertx" title="Chapter&nbsp;22.&nbsp;Vert.x event bus support">Chapter&nbsp;22, <i xmlns:xlink="http://www.w3.org/1999/xlink">Vert.x event bus support</i></a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-4-dynamic-endpoints"></a>B.3.11.&nbsp;Dynamic endpoint components</h3></div></div></div><p>Endpoints represent the base component in Citrus for sending and receiving messages. The endpoint usually is defined inside the Citrus Spring application context as Spring bean component. Now
        it is also possible to create dynamic endpoint definitions at test runtime. This comes in very handy when you just want to send or receive a message with Citrus as is. You do not need
        to add the complete endpoint configuration but only use a special endpoint uri pattern. Citrus will create the endpoint at runtime automatically. Learn how to use the dynamic endpoint pattern in <a href="#endpoint-components" title="Chapter&nbsp;26.&nbsp;Dynamic endpoint components">Chapter&nbsp;26, <i xmlns:xlink="http://www.w3.org/1999/xlink">Dynamic endpoint components</i></a>.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="history-1-3"></a>B.4.&nbsp;Changes in Citrus 1.3.x</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-3-1-annotations"></a>B.4.1.&nbsp;@CitrusTest and @CitrusXmlTest annotations</h3></div></div></div><p>With the new Java DSL capabilities Citrus created new ways of executing test cases within a TestNG or
        JUnit test class. Now we even improved the usage here with two new annotations <span class="emphasis"><em>@CitrusTest</em></span>
        and <span class="emphasis"><em>CitrusXmlTest</em></span>. The integration into the unit test class has never been easier for you.</p><p>The new Citrus annotations go directly to your unit test methods. With this enhancement you can have multiple Citrus
        test cases in one single Java class and the Citrus tests now are able to coexist with other unit test methods. You can even
        mix Java DSL and XML Citrus test cases in a single Java class.</p><p>The XML Citrus tests can be grouped to a single Java class with multiple XML files loaded during execution. There is
        even a package scan for all Citrus XML files within a directory structure so you do not have to create a Java class for each
        test case anymore.</p><p>We have changed the documentation in this guide so you can see how to use the new annotations. For detailed overview see
        <a href="#">???</a>. Also see our Citrus blog where we continuously describe the many possibilities that you
        have with the new annotations.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-3-1-parameters"></a>B.4.2.&nbsp;@CitrusParameters annotation</h3></div></div></div><p>Citrus is able to use the fabulous TestNG data provider capabilities in order to execute a test case several times
        with different data provided form external resources. The new @CitrusParameters annotation helps to set parameter names
        which are used as test variable names in the test case.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-3-1-schema-repository-parser"></a>B.4.3.&nbsp;Schema repository configuration components</h3></div></div></div><p>Defining schema repositories and schemas (xsd, wsdl) is common use in Citrus. We have added XML bean definition parsers
        so defining those components is less verbose. You can use the Citrus <span class="emphasis"><em>citrus:schema-repository</em></span>
        and <span class="emphasis"><em>citrus:schema</em></span> components in your Spring application context configuration. The components do receive several
        attributes for further configuration. XSD, WSDL and schema collections are supported here.</p><p>Checkout <a href="#xsd-validation" title="9.1.&nbsp;XSD schema repositories">Section&nbsp;9.1, &#8220;XSD schema repositories&#8221;</a> for examples how to use the new configuration components.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-3-1-change-date-function"></a>B.4.4.&nbsp;Change date function</h3></div></div></div><p>We have added a new Citrus function <span class="emphasis"><em>citrus:changeDate()</em></span> that is available for you by default.
        The function changes a given date value adding or removing a datetime offset (e.g. year, month, day, hour, minute, second).
        So you can manipulate each date value also those of dynamic nature coming with some message.</p><p>See <a href="#functions-changedate" title="28.29.&nbsp;citrus:changeDate()">Section&nbsp;28.29, &#8220;citrus:changeDate()&#8221;</a> for examples and detailed syntax usage of this function.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-3-1-weekday-matcher"></a>B.4.5.&nbsp;Weekday validation matcher</h3></div></div></div><p>The new weekday validation matcher also works on date values. The matcher checks that a given
        date value evaluates to a expected day of the week. So the user can check that a date field is always a saturday
        for instance. This is very helpful when checking that a given date value is not a working day for example.</p><p>See <a href="#validation-matcher-weekday" title="29.11.&nbsp;isWeekday()">Section&nbsp;29.11, &#8220;isWeekday()&#8221;</a> for some more detailed description of the matcher's capabilities.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-3-javadsl"></a>B.4.6.&nbsp;Java DSL</h3></div></div></div><p>Citrus users, in particular those with development experience, do often tell me about the nasty XML code they have to deal with for writing Citrus test definitions. Developers want to write
        Java code rather than XML. Although I personally do like the Citrus XML test syntax we have introduced a Java DSL language for writing Citrus tests with Java only.</p><p>We have introduced the Java DSL to all major test action features in Citrus so you can switch without having to worry about loosing functionality. Details can be seen in the test action section
        where we added Java DSL examples almost everywhere (<a href="#actions" title="Chapter&nbsp;11.&nbsp;Test actions">Chapter&nbsp;11, <i xmlns:xlink="http://www.w3.org/1999/xlink">Test actions</i></a>). The basic Java DSL setup is described in <a href="#testcase" title="Chapter&nbsp;4.&nbsp;Test cases">Chapter&nbsp;4, <i xmlns:xlink="http://www.w3.org/1999/xlink">Test cases</i></a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-3-xhtml"></a>B.4.7.&nbsp;XHTML message validation</h3></div></div></div><p>Message validation for Html code was not really comfortable as Html does not confirm to be wellformed and valid XML syntax. XHTML tries to close this gap by automatically resolving all Html specific
        XML syntax rule violations. With Citrus 1.3 we introduced a XHTML message validator which does the magic for converting Html code to proper wellformed and valid XML. In a test case you can then use
        the full XML validation power in Citrus in order to validate incoming Html messages. Section <a href="#validation-xhtml" title="8.2.&nbsp;XHTML message validation">Section&nbsp;8.2, &#8220;XHTML message validation&#8221;</a> deals with the new validation capabilities for Html.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-3-soap-fault"></a>B.4.8.&nbsp;Multiple SOAP fault detail support</h3></div></div></div><p>SOAP fault messages can hold many SOAP fault detail elements. Citrus was able to handle a single SOAP fault detail on sending and receiving test actions from the very beginning but multiple SOAP
        fault detail elements were not supported. Fortunately things are getting better and you can send and receive as many fault detail elements as you like in Citrus 1.3. For each SOAP fault detail you can
        specify individual validation rules and expectations. See <a href="#soap-faults" title="17.7.&nbsp;SOAP faults">Section&nbsp;17.7, &#8220;SOAP faults&#8221;</a> for detailed description.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-3-server-security-handler"></a>B.4.9.&nbsp;Jetty server security handler</h3></div></div></div><p>With our Jetty server component you can set up Http mock servers very easy. The server is automatically configured to accept Http client connections and to load a Spring application context on startup. Now you can also
        set some more details on this automatic server configuration (e.g. server context path, servlet names or servlet mappings). In addition to that you can access the security context of the web container. This enables you to set up
        security constraints such as basic authentication on server resources. Clients are then forced to authenticate properly when accessing the server. Unauthorized users will get <span class="emphasis"><em>401 access denied</em></span> errors immediately.
        See <a href="#http-basic-auth-server" title="16.6.&nbsp;HTTP server basic authentication">Section&nbsp;16.6, &#8220;HTTP server basic authentication&#8221;</a> for details. Of course this also applies to our SOAP WebService Jetty server components (<a href="#soap-basic-auth-server" title="17.11.&nbsp;SOAP server basic authentication">Section&nbsp;17.11, &#8220;SOAP server basic authentication&#8221;</a>).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-3-actors"></a>B.4.10.&nbsp;Test actors</h3></div></div></div><p>We introduced a new concept of test actors for sending and receiving test actions. This enables you to link a test actor (e.g. interface partner application, backend application) to a test
        action in your test. Following from that you can enable/disable test actors and all linked test actions very easy. This enables us to reuse Citrus test cases in end-to-end test scenarios where
        not all interface partners get simulated by Citrus. If you like to read more about this concept follow the detailed instruction in <a href="#test-actors" title="Chapter&nbsp;5.&nbsp;Test actors">Chapter&nbsp;5, <i xmlns:xlink="http://www.w3.org/1999/xlink">Test actors</i></a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-3-soap-http-errors"></a>B.4.11.&nbsp;Simulate Http error codes with SOAP</h3></div></div></div><p>Citrus provides SOAP WebServices server simulation with clients connecting to the server sending SOAP requests. As a server Citrus is now able to simulate Http error codes like
        <span class="emphasis"><em>404 Not found</em></span> and <span class="emphasis"><em>500 Internal server error</em></span>. Before that the Citrus SOAP server had to always respond with a proper SOAP response or SOAP fault.
        See <a href="#soap-http-errors" title="17.8.&nbsp;Send HTTP error codes with SOAP">Section&nbsp;17.8, &#8220;Send HTTP error codes with SOAP&#8221;</a> for details.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-3-ssh"></a>B.4.12.&nbsp;SSH server and client</h3></div></div></div><p>The Citrus family has raised a new member in adding SSH connectivity. With the new SSH module you are able to provide a full stack SSH server. The SSH server accepts client connections and you as a tester can simulate
        any SSH server functionality with proper validation as it is known to Citrus SOAP and HTTP modules. In addition to that you can also use the Citrus SSH client in order to connect to an external SSH server. You can execute
        SSH commands on the SSH server and validate the respective response data. The full description is provided in <a href="#ssh" title="Chapter&nbsp;25.&nbsp;SSH support">Chapter&nbsp;25, <i xmlns:xlink="http://www.w3.org/1999/xlink">SSH support</i></a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-3-antrun"></a>B.4.13.&nbsp;ANT run test action</h3></div></div></div><p>With this new test action you can call ANT builds from your test case. The action executes one or more ANT build targets on a build.xml file. You can specify build properties that get passed to the ANT build and
        you can add a custom build listener. In case the ANT build run fails the test fails accordingly with the build exception. See <a href="#actions-antrun" title="11.18.&nbsp;Running Apache Ant build targets">Section&nbsp;11.18, &#8220;Running Apache Ant build targets&#8221;</a> for details.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-3-polling-interval"></a>B.4.14.&nbsp;Polling interval for reply handlers</h3></div></div></div><p>With synchronous communication in Citrus we always have a combination of a synchronous message sender and a reply handler component. These two perform a handshake when passing synchronous reply messages to the test
        for further processing such as message validation. While the sender is waiting for the synchronous response to arrive the reply handler polls for the reply message. This polling for reply messages was done in a static way
        which often led to time delays according to long polling intervals. Now with Citrus 1.3 you can set the polling-interval for the reply handler as you like. This setting is
        valid for all reply handler components in Citrus (citrus-jms, citrus-http, citrus-ws, citrus-channel, citrus-shh, and so on).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-3-upgrading"></a>B.4.15.&nbsp;Upgrading from version 1.2</h3></div></div></div><p>If you are coming from Citrus 1.2 you may have to look at the following points in order to have a smooth upgrade to the new release version.</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p><span class="emphasis"><em>Jetty version upgrade</em></span> We are using Jetty a lot for starting Http server mocks within Citrus. In order to stay up to date we upgraded to
            Jetty 8.1.7 version with this Citrus release. This implies that package names did change for Jetty API. In general there is no conflict for you as a Citrus user, but you may want to
            adjust your logging configuration according to new Jetty packages. Jetty package names did change from <span class="emphasis"><em>ord.mortbay</em></span> to <span class="emphasis"><em>org.eclipse.jetty</em></span>.</p></li><li style="list-style-type: circle"><p><span class="emphasis"><em>Spring version upgrade</em></span> Staying up to date with the versions of 3rd library dependencies is quite important for us. So we upgrade our dependencies to newer versions
            with each release. As we did only upgrade minor versions there is no significant change or problems to be expected. However you may take care on versions and
            release changes in the Spring world for details and migration.</p></li><li style="list-style-type: circle"><p><span class="emphasis"><em>TIBCO module</em></span> We decided to put the TIBCO module separately as it is a very special connectivity adapter for TIBCO software only. So you will not find the TIBCO module
            within the Citrus distribution anymore. We will maintain a TIBCO connectivity adapter separately in the future.</p></li></ul></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="history-1-2"></a>B.5.&nbsp;Changes in Citrus 1.2</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-2-spring"></a>B.5.1.&nbsp;Spring version update</h3></div></div></div><p>We have some major version upgrades in our Spring dependencies. We are now using Spring 3.1.1, Spring Integration 2.1.2 and SpringWS 2.1.0. This upgrade
        was overdue for some time and is definitely worth it. With these upgrades we had to apply some changes in our API, too. This is because we are using the Spring classes a lot
        in our code. See the upgrade guide in this chapter for all significant changes that might affect your project.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-2-groovy"></a>B.5.2.&nbsp;New groovy features</h3></div></div></div><p>Citrus extended the possibilities to work with script languages like Groovy. You can use Groovy's MarkupBuilder to create
        XML message payloads. Your Groovy code goes right into the test case or comes from external file. With MarkupBuilder you
        do not need to care about XML message syntax and overhead. Just focus on the pure message content. You can read the details in
        <a href="#groovy-markupbuilder" title="7.4.1.&nbsp;Groovy MarkupBuilder">Section&nbsp;7.4.1, &#8220;Groovy MarkupBuilder&#8221;</a>.</p><p>Further Groovy feature goes to the validation capabilities. Instead of working with XML DOM tree comparison and XPath expression validation you
        can use Groovy XMLSlurper. This is very useful for those of you who need to do complex message validation and do not like the XML/XPath syntax at all. With
        XMLSlurper you can access the XML DOM tree via named closure operations which feels great. This especially comes in handy for complex generic XML structures
        as you can search for elements, sort element list and use the powerful contains operation. This is all described in <a href="#groovy-xmlslurper" title="7.4.2.&nbsp;Groovy XmlSlurper">Section&nbsp;7.4.2, &#8220;Groovy XmlSlurper&#8221;</a>.</p><p>Some other Groovy support extension comes in SQL result set validation (<a href="#actions-database-groovy" title="11.1.3.&nbsp;Groovy SQL result set validation">Section&nbsp;11.1.3, &#8220;Groovy SQL result set validation&#8221;</a>). When reading data from the database someone is able to validation the
        resulting data row set with Groovy script. The script code easily accesses the rows and columns with Groovy's out-of-the-box list and map handling. This
        adds very powerful validation to multi-row data sets from the database.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-2-sql"></a>B.5.3.&nbsp;SQL multi-line result set validation</h3></div></div></div><p>In this new Citrus version the tester can validate SQL Query results that have multiple rows. In the past Citrus could only handle a single row in the
        result set. Now this new release brings light into the dark. See also the new Groovy SQL result set validation which fits brilliant for complex multi-row
        SQL result set validation. The details can be found in <a href="#actions-database-query" title="11.1.2.&nbsp;Verifying data from the database">Section&nbsp;11.1.2, &#8220;Verifying data from the database&#8221;</a></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-2-message-types"></a>B.5.4.&nbsp;Extended message format support</h3></div></div></div><p>In previous versions Citrus was primary designed to handle XML message payloads. With this new release Citrus is also able to work with other message formats
        such as JSON, CSV, PLAINTEXT. This applies to sending messages as well as receiving and particularly validating message payloads. The tester can specify several message
        validators in Citrus for different message formats. According to the expected message format the proper validator is chosen to perform the message validation.</p><p>We have implemented a JSON message validator capable of ignoring specific JSON entries and handling JSONArrays. We also provide a plain text message validator which
        is very basic to be honest. The framework is ready to receive new validator implementations so you can add custom validators for your specific needs.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-2-xml"></a>B.5.5.&nbsp;New XML features</h3></div></div></div><p>XML namespace handling is tedious expecially if you have to deal with a lot of XPath expressions in your tests. Before you had need to specify a namespace
        context for the XPath expression every time you use them in your test - now you can have a central namespace context which declares namespaces you use in your project.
        These namespaces identified by some prefix are available throughout the test project which is much more maintainable and easy to use. See how it works in
        <a href="#xpath-namespace" title="10.1.&nbsp;Handling XML namespaces">Section&nbsp;10.1, &#8220;Handling XML namespaces&#8221;</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-2-soap"></a>B.5.6.&nbsp;SOAP support improvements</h3></div></div></div><p>WsAddressing standard is now supported in Citrus (<a href="#soap-ws-adressing" title="17.12.&nbsp;WS-Addressing support">Section&nbsp;17.12, &#8220;WS-Addressing support&#8221;</a>). This means you can declare the specific WsAddressing message headers on message
        sender level in order to send messages with WsAddressing feature. The header is constructed automatically for all SOAP messages that are sent over the message sender.</p><p>Dynamic SOAP endpoint uri resolver enables you to dynamically address SOAP endpoints during a test. Sometimes a message sender may dynamically have to change the SOAP
        url for each call (e.g. address different request uri parts). With a endpoint uri resolver set on the message sender you can handle this requirement very easy. The tip for
        dynamic endpoint resolving was added to <a href="#">???</a></p><p>We also simplified the synchronous SOAP HTTP communication within test cases. In previous versions you had to build complex parallel and sequential container constructs
        in order to continue with test execution while the SOAP message sender is waiting for the synchronous response to arrive. Now you can simply fork the message sending action and
        continue with further test actions while synchronous SOAP communication takes place. See the <a href="#soap-fork-mode" title="17.13.&nbsp;SOAP client fork mode">Section&nbsp;17.13, &#8220;SOAP client fork mode&#8221;</a> for details</p><p>Some really small change introduced with this release is the fact that Citrus now logs SOAP messages in their pure nature. This means that you can see the complete SOAP
        envelope of messages in the Citrus log files. This is more than helpful when searching for errors inside your test case.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-2-http"></a>B.5.7.&nbsp;Http and RESTful WebServices</h3></div></div></div><p>We have changed Http communication components for full support of RESTful WebServices on client and server side. The Http client now uses Spring's REST support for
        Http requests (GET, PUT, DELETE, POST, etc.). The server side has changed, too. The Http server now provides RESTful WebServices and is compliant to the existing SOAP Jetty server
        implementation in Citrus. If you want to upgrade existing projects to this version you may have to adjust the Spring application context configuration to some extent.</p><p>For details have a look at the upgrade guide (<a href="#">???</a>) in this chapter or find detailed explanations to the new Http components in <a href="#http" title="Chapter&nbsp;16.&nbsp;HTTP REST support">Chapter&nbsp;16, <i xmlns:xlink="http://www.w3.org/1999/xlink">HTTP REST support</i></a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-2-html-report"></a>B.5.8.&nbsp;HTML reporting</h3></div></div></div><p>Citrus provides HTML reports after each test run with detailed information on the failed tests. You can immediately see which tests failed in execution and where the test
        stopped. <a href="#reporting-html" title="34.3.&nbsp;HTML reports">Section&nbsp;34.3, &#8220;HTML reports&#8221;</a> provides details on this new feature.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-2-validation"></a>B.5.9.&nbsp;Validation matchers</h3></div></div></div><p>The new validation matchers will put the message validation mechanisms to a new level. With validation matchers you are able to execute powerful assertions on each message content element.
        For instance you can use the isNumber validation matcher for checking that a message value is of numeric nature. We added several matcher implementations that are ready for usage in your test but you can
        also write your custom validation matchers. Have a look at <a href="#validation-matchers" title="Chapter&nbsp;29.&nbsp;Validation matcher">Chapter&nbsp;29, <i xmlns:xlink="http://www.w3.org/1999/xlink">Validation matcher</i></a> for details.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-2-conditional"></a>B.5.10.&nbsp;Conditional container</h3></div></div></div><p>The new conditional test action container enables you to execute test actions only in case a boolean expression evaluates to true. So the nested test actions inside the container may be not
        executed at all in case a condition is not met. See <a href="#containers-conditional" title="13.2.&nbsp;Conditional">Section&nbsp;13.2, &#8220;Conditional&#8221;</a> for details.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-2-channel-selector"></a>B.5.11.&nbsp;Support for message selectors on message channels</h3></div></div></div><p>Spring Integration message channels do not support message selectors like JMS queues do for example. With Citrus 1.2 we implemented a solution for this issue with a special message channel
        implementation. So you can use the message selector feature also when using message channels. Go to <a href="#message-channel-selector-support" title="19.3.&nbsp;Message selectors on channels">Section&nbsp;19.3, &#8220;Message selectors on channels&#8221;</a> for details.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-2-actions"></a>B.5.12.&nbsp;New test actions</h3></div></div></div><p>We introduced some completely new test actions in this release for you. The new actions are listed below:</p><div class="itemizedlist"><ul type="disc"><li>Purge message channel action (<a href="#actions-purge-channels" title="11.15.&nbsp;Purging message channels">Section&nbsp;11.15, &#8220;Purging message channels&#8221;</a>)</li></ul></div><p>See <a href="#actions" title="Chapter&nbsp;11.&nbsp;Test actions">Chapter&nbsp;11, <i xmlns:xlink="http://www.w3.org/1999/xlink">Test actions</i></a> for detailed instructions how to use the new actions.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-2-functions"></a>B.5.13.&nbsp;New functions</h3></div></div></div><p>We introduced some new default Citrus functions that will ease the testers life. This includes commonly used functions like encoding/decoding base64 bindary data, escaping XML and generating
        random Java UUID values. These are the new functions in this release:</p><div class="itemizedlist"><ul type="disc"><li>citrus:randomUUID()</li><li>citrus:cdataSection()</li><li>citrus:encodeBase64()</li><li>citrus:decodeBase64()</li><li>citrus:digestAuthHeader()</li><li>citrus:localHostAddress()</li></ul></div><p>See <a href="#functions" title="Chapter&nbsp;28.&nbsp;Functions">Chapter&nbsp;28, <i xmlns:xlink="http://www.w3.org/1999/xlink">Functions</i></a> for detail descriptions of each function.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="history-1-2-upgrading"></a>B.5.14.&nbsp;Upgrading from version 1.1</h3></div></div></div><p>If you are coming from Citrus 1.1 final you may have to look at the following points.</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p><span class="emphasis"><em>Spring version update</em></span> We did some major version upgrades on our Spring dependencies. We are now using Spring 3.1.1, Spring Integration 2.1.2 and SpringWS 2.1.0.
            These new major releases bring some code changes in our Citrus API which might affect your code and configuration, too. So please update your configuration, it is definitely worth it!</p></li><li style="list-style-type: circle"><p><span class="emphasis"><em>Spring Integration headers:</em></span> With 2.0.x version Spring Integration has removed the internal header prefix ("springintegration_").
            So in some cases you might use those internal header names in your test cases in order to synchronize synchronous communication with internal message ids. Your test case
            will fail as long as you use the old Spring internal header prefix in the test. Simply remove the header prefix wherever used and your test is up and running again.</p></li><li style="list-style-type: circle"><p><span class="emphasis"><em>Message validator:</em></span> You need to specify at least one message validator in the citrus-context.xml. Before this was internally a static XML message validator, but now we offer
            different validators for several message formats like XML and JSON. Please see the Java API doc on MessageValidator interface for available implementations. If you just like to
            keep it as it was before add this bean to the citrus-context.xml:</p><pre class="programlisting">&lt;<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-tag">bean</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">id</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"xmlMessageValidator"</span> <span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-attribute">class</span>=<span xmlns="http://www.w3.org/TR/xhtml1/transitional" class="hl-value">"com.consol.citrus.validation.xml.DomXmlMessageValidator"</span>/&gt;</pre></li><li style="list-style-type: circle"><p><span class="emphasis"><em>Test suite:</em></span> We have eliminated/changed the Citrus test suite logic because it duplicates those test suites defined in TestNG or JUnit. In older versions the tester had to define a
            Citrus test suite in Spring application context in order to execute test actions before/after the test run. Now these tasks before and after the test run are decoupled from a test suite.
            You define test suites exclusively in TestNG or JUnit. The test actions before/after the test run are seperately defined in citrus-context.xml so you have to change this configuration
            in your Citrus project.</p><p>See <a href="#testsuite" title="Chapter&nbsp;31.&nbsp;Actions before/after the test run">Chapter&nbsp;31, <i xmlns:xlink="http://www.w3.org/1999/xlink">Actions before/after the test run</i></a> for details on this configuration changes.</p></li><li style="list-style-type: circle"><p><span class="emphasis"><em>JUnit vs. TestNG:</em></span> We support both famous unit testing frameworks JUnit and TestNG. With this release you are free to choose your prefered one. In this manner you need to add
            either a JUnit dependency or a TestNG dependency to your project on your own. We do not have static dependencies in our Maven POM to neither of those two. On our side these dependencies
            are declared optional so you feel free to add the one you like best to your Maven POM. Just add a JUnit or TestNG dependency to your Maven project or add the respective jar file to your
            project if you use ANT instead.</p></li></ul></div></div></div></div></div></body></html>