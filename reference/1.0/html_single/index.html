<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Citrus Framework - Reference Documentation</title><link rel="stylesheet" href="reference-html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.60.1"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="book" lang="en"><div class="titlepage"><div><div><h1 class="title"><a name="d0e1"></a>Citrus Framework - Reference Documentation</h1></div><div><div xmlns="http://www.w3.org/TR/xhtml1/transitional" class="authorgroup"><h2>Authors</h2><p></p><span class="author"><span xmlns="" class="firstname">Christoph</span> <span xmlns="" class="surname">Deppisch</span></span></div></div><div><p class="releaseinfo">1.0</p></div><div><p class="copyright">Copyright &copy; 2009 ConSol* Software GmbH</p></div></div><div></div><hr xmlns="http://www.w3.org/TR/xhtml1/transitional"><img xmlns="http://www.w3.org/TR/xhtml1/transitional" src="images/citrus_logo.png" style="width:25%;float:right;"></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><a href="#preface">Preface</a></dt><dt>1. <a href="#introduction">Introduction</a></dt><dd><dl><dt>1.1. <a href="#introduction-overview">Overview</a></dt><dt>1.2. <a href="#introduction-usage">Usage scenarios</a></dt></dl></dd><dt>2. <a href="#setup">Setup</a></dt><dd><dl><dt>2.1. <a href="#setup-download">Download</a></dt><dt>2.2. <a href="#setup-prerequisits">Prerequisits</a></dt><dt>2.3. <a href="#setup-installation">Installation</a></dt><dt>2.4. <a href="#setup-using-maven">Using Maven</a></dt></dl></dd><dt>3. <a href="#testcase">Test case</a></dt><dd><dl><dt>3.1. <a href="#testcase-defining">Defining a test case</a></dt><dd><dl><dt>3.1.1. <a href="#testcase-description">Description</a></dt><dt>3.1.2. <a href="#testcase-variables">Variables</a></dt><dt>3.1.3. <a href="#testcase-actions">Actions</a></dt><dt>3.1.4. <a href="#testcase-finally">Cleanup</a></dt></dl></dd><dt>3.2. <a href="#testcase-metainfo">Meta information</a></dt></dl></dd><dt>4. <a href="#messaging">Send and receive messages</a></dt><dd><dl><dt>4.1. <a href="#message-sending">Sending messages</a></dt><dt>4.2. <a href="#message-receiving">Receiving messages</a></dt><dd><dl><dt>4.2.1. <a href="#message-receiving-selector">Messages selectors</a></dt><dt>4.2.2. <a href="#message-receiving-template">Expected message templates</a></dt><dt>4.2.3. <a href="#message-receiving-elements">Validating message elements</a></dt><dt>4.2.4. <a href="#message-receiving-header">Validate the message header</a></dt><dt>4.2.5. <a href="#message-receiving-extract">Saving dynamic message content</a></dt></dl></dd></dl></dd><dt>5. <a href="#actions">Test actions</a></dt><dd><dl><dt>5.1. <a href="#actions-database">Connecting to the database</a></dt><dd><dl><dt>5.1.1. <a href="#actions-database-update">Updating the database</a></dt><dt>5.1.2. <a href="#actions-database-query">Verifying data from the database</a></dt></dl></dd><dt>5.2. <a href="#actions-sleep">Sleep</a></dt><dt>5.3. <a href="#actions-java">Java</a></dt><dt>5.4. <a href="#actions-timeout">Expect timeouts on a destination</a></dt><dt>5.5. <a href="#actions-echo">Echo</a></dt><dt>5.6. <a href="#actions-measure-time">Time measurement</a></dt><dt>5.7. <a href="#actions-create-variables">Create variables</a></dt><dt>5.8. <a href="#actions-trace">Trace variables</a></dt><dt>5.9. <a href="#actions-fail">Failing the test</a></dt><dt>5.10. <a href="#actions-input">Input</a></dt><dt>5.11. <a href="#actions-load">Load</a></dt><dt>5.12. <a href="#actions-purge">Purging JMS destinations</a></dt><dt>5.13. <a href="#actions-generic-action">Including own actions</a></dt></dl></dd><dt>6. <a href="#templates">Templates</a></dt><dt>7. <a href="#containers">Containers</a></dt><dd><dl><dt>7.1. <a href="#containers-sequential">Sequential</a></dt><dt>7.2. <a href="#containers-parallel">Parallel</a></dt><dt>7.3. <a href="#containers-iterate">Iterate</a></dt><dt>7.4. <a href="#containers-repeat">Repeat until true</a></dt><dt>7.5. <a href="#containers-repeat-onerror">Repeat on error until true</a></dt></dl></dd><dt>8. <a href="#finally">Finally section</a></dt><dt>9. <a href="#xpath">Using XPath</a></dt><dd><dl><dt>9.1. <a href="#xpath-namespace">Handling XML namespaces</a></dt><dt>9.2. <a href="#xpath-default-namespaces">Handling default namespaces</a></dt></dl></dd><dt>10. <a href="#jms">Connecting with JMS</a></dt><dd><dl><dt>10.1. <a href="#jms-sender">JMS message sender</a></dt><dt>10.2. <a href="#jms-receiver">JMS message receiver</a></dt><dt>10.3. <a href="#jms-sync-sender">JMS synchronous message sender</a></dt><dt>10.4. <a href="#jms-sync-receiver">JMS synchronous message receiver</a></dt></dl></dd><dt>11. <a href="#http">Http Support</a></dt><dd><dl><dt>11.1. <a href="#http-sender">Http message sender</a></dt><dt>11.2. <a href="#http-server">Http server</a></dt><dd><dl><dt>11.2.1. <a href="#http-message-handler-empty">Empty response producing message handler</a></dt><dt>11.2.2. <a href="#http-message-handler-static">Static response producing message handler</a></dt><dt>11.2.3. <a href="#http-message-handler-xpath">Xpath dispatching message handler</a></dt><dt>11.2.4. <a href="#http-message-handler-jms">JMS connecting message handler</a></dt></dl></dd></dl></dd><dt>12. <a href="#soap-webservices">SOAP WebServices</a></dt><dd><dl><dt>12.1. <a href="#soap-sender">SOAP message sender</a></dt><dt>12.2. <a href="#soap-server">Receiving SOAP messages</a></dt></dl></dd><dt>13. <a href="#functions">Functions</a></dt><dd><dl><dt>13.1. <a href="#functions-concat">citrus:concat()</a></dt><dt>13.2. <a href="#functions-substring">citrus:substring()</a></dt><dt>13.3. <a href="#functions-string-length">citrus:stringLength()</a></dt><dt>13.4. <a href="#functions-translate">citrus:translate()</a></dt><dt>13.5. <a href="#functions-substring-before">citrus:substringBefore()</a></dt><dt>13.6. <a href="#functions-substring-after">citrus:substringAfter()</a></dt><dt>13.7. <a href="#functions-round">citrus:round()</a></dt><dt>13.8. <a href="#functions-floor">citrus:floor()</a></dt><dt>13.9. <a href="#functions-ceiling">citrus:ceiling()</a></dt><dt>13.10. <a href="#functions-random-number">citrus:randomNumber()</a></dt><dt>13.11. <a href="#functions-random-string">citrus:randomString()</a></dt><dt>13.12. <a href="#functions-current-date">citrus:currentDate()</a></dt><dt>13.13. <a href="#functions-upper-case">citrus:upperCase()</a></dt><dt>13.14. <a href="#functions-lower-case">citrus:lowerCase()</a></dt><dt>13.15. <a href="#functions-average">citrus:average()</a></dt><dt>13.16. <a href="#functions-minimum">citrus:minimum()</a></dt><dt>13.17. <a href="#functions-maximum">citrus:maximum()</a></dt><dt>13.18. <a href="#functions-sum">citrus:sum()</a></dt><dt>13.19. <a href="#functions-absolute">citrus:absolute()</a></dt></dl></dd><dt>14. <a href="#testsuite">Testsuite</a></dt><dd><dl><dt>14.1. <a href="#testsuite-tasks">Tasks before, between and after the test run</a></dt><dt>14.2. <a href="#testsuite-include-exclude">Include and exclude tests</a></dt><dt>14.3. <a href="#testsuite-multiple">Multiple testsuites</a></dt></dl></dd><dt>15. <a href="#tibco">TIBCO support</a></dt><dd><dl><dt>15.1. <a href="#tibco-hawk">Connecting with TIBCO Hawk</a></dt><dt>15.2. <a href="#tibco-collaborator">Connecting with TIBCO Collaborator Workflow Server</a></dt></dl></dd><dt>16. <a href="#schema-validation">XML schema validation</a></dt><dd><dl><dt>16.1. <a href="#xsd-validation">XSD validation</a></dt><dt>16.2. <a href="#dtd-validation">DTD validation</a></dt></dl></dd><dt>17. <a href="#debug-messages">Debugging received messages</a></dt><dt>18. <a href="#reporting">Reporting and test results</a></dt><dd><dl><dt>18.1. <a href="#reporting-logging">Console logging</a></dt><dt>18.2. <a href="#reporting-junit">JUnit reports</a></dt></dl></dd><dt>A. <a href="#samples">Citrus samples</a></dt><dd><dl><dt>A.1. <a href="#samples-flightbooking">The FlightBooking sample</a></dt><dd><dl><dt>A.1.1. <a href="#samples-flightbooking-usecase">The use case</a></dt><dt>A.1.2. <a href="#samples-flightbooking-configuration">Configure the simulated systems</a></dt><dt>A.1.3. <a href="#samples-flightbooking-http">Configure the Http adapter</a></dt><dt>A.1.4. <a href="#samples-flightbooking-testcase">The test case</a></dt></dl></dd></dl></dd></dl></div><div class="preface" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="preface"></a>Preface</h2></div></div><div></div></div><p>Integration testing can be very hard, especially when there are no sufficient tools that support you. Regarding Java 
  unit testing very good tools and APIs exists (JUnit, TestNG, EasyMock, and many more). The testing tools support you and 
  try to ease up your life as a tester who is in charge of testing a software in various ways.
   
  When speaking of integration testing in a service-oriented architecture (SOA) things are getting evil. Besides unit testing efforts
  especially those Enterprise Application Integration (EAI) projects need to be tested regarding their integration into the existing application 
  environment on the customer side. Without sufficient tool support the integration testing is exhausting and sometimes barely possible.</p><p>Testing can then be a hard task, because the tester may be forced to simulate several external interface applications. 
  The simulation of interface partners cause severe problems regarding maintainability and compability. It is not unusual, 
  that a tester has to simulate several applications manually during a test, because of lacking tool support. This manual test approach is 
  very time consuming and error prone. Every time a tester has to manually validate the success of at test case it is difficult to
  repeat those tests every time a change was made in the source code of the application. Regression testing and continuous testing is very important
  but not possible the time testers are forced to manually test the applications. Fully automated integration testing of whole use cases in an end-to-end
  point of view is very difficult using this manual testing approach.</p><p>The Citrus test framework aims to fill in this gap. The tool helps you to perform complex integration testing in a message based 
  EAI environment. Citrus is designed to completely test whole use case scenarios in an automated way, where interface partners are
  simulated in their behaviour and message contents are automatically validated, so the correct processing is always ensured.</p><p>This document provides a reference guide to all features of the Citrus test framework and it gives a detailed picture 
  of how to set up an automated integration testing environment. Since this document is considered to be under construction, 
  please do not hesitate to give any comments or requests to us using our user or support mailing lists.</p></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="introduction"></a>Chapter&nbsp;1.&nbsp;Introduction</h2></div></div><div></div></div><p>Enterprise Application Integration (EAI) projects usually communicate with different 
  interface partners using a loosely coupled message-based communication. The success of a use case is defined by 
  the cooperation of several applications exchanging information with each other. Therefore it is essential to test 
  this cooperation/communication between the applications in several integration tests.</p><p>In software devlopment integration testing aims to test the interaction of software components that 
  depend on each other. In EAI projects these components are loosely coupled sofware systems communicating with each other
  over various transports exchanging messages and information. The interaction of these components is essential to 
  successfully process a use case scenario.</p><p>How can somebody test use case scenarios that include several interface partners interacting with each other? How can 
  somebody ensure that the software component he/she is in charge of is working correctly with the other software systems.
  How can somebody run positive and negative integration test cases in an automated reproducable way? 
  Citrus tries to answer these questions by offering fully automated integration testing always looking at the whole picture of several
  systems interacting with each other.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="introduction-overview"></a>1.1.&nbsp;Overview</h2></div></div><div></div></div><p>Citrus aims to strongly support you in simulating your interface partners. You can easily subscribe and publish 
    to a wide range of protocols like HTTP, JMS, TCP/IP and SOAP in order to test your message based applications. 
    The framework will send/receive messages in order to create a communication as it would be in real production environment. 
    In each step the framework is able to validate the message contents by comparing them to expected contents. In addition to that 
    the framework offers a wide range of functionalities to take control of the process flow during a test (e.g. iterations, 
    system availability checks, database validation, parallelism, delaying, error simulation, and many more).</p><p>The basic goal is to test a whole use case scenario including all interface partners. With easy
    definition of test cases via XML the framework will simulate the message flow step by step and
    ensure the correct end-to-end processing.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="introduction-usage"></a>1.2.&nbsp;Usage scenarios</h2></div></div><div></div></div><p>When should someone use the Citrus test framework? If you are in charge of an EAI application and need to test 
    its integration into the existing software landscape. In case your project interacts with a lot of other software systems and
    you need to simulate those in order to test your end-to-end processing. In case you need to increase the stability of an existing EAI 
    projects dealing with change requests, bugfixes or regression testing. Or if you simply need to increase your test coverage, in order to feel 
    comfortable regarding the next software release.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="setup"></a>Chapter&nbsp;2.&nbsp;Setup</h2></div></div><div></div></div><p>This chapter will tell you how to get started with Citrus. It deals with the installation and set up of the framework, 
  so you are ready to use the framework and start writing test cases after reading this chapter.</p><p>After downloading the latest release there are several ways to use Citrus in your project. The next sections will 
  describe to you the Citrus project setup possibilities. Choose on of them and include Citrus into your project.</p><p>In case you use Maven in your project you may choose the Maven way described in <a href="#setup-using-maven" title="2.4.&nbsp;Using Maven">Section&nbsp;2.4, &#8220;Using Maven&#8221;</a>. 
  Others may feel right downloading and unzipping the Citrus archive release manually.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="setup-download"></a>2.1.&nbsp;Download</h2></div></div><div></div></div><p>You can download the latest Citrus release from our homepage 
    <a href="http://www.citrusframework.org" target="_top">http://www.citrusframework.org</a></p><p>Citrus comes to you as a zipped archive in one of the following packages:</p><div class="itemizedlist"><ul type="disc"><li><p><span class="emphasis"><em>citrus-x.x-with-dependencies</em></span></p></li><li><p><span class="emphasis"><em>citrus-x.x-src</em></span></p></li></ul></div><p>Usually one would choose the with-dependencies archive in order to use Citrus, because this archive includes the Citrus binaries
    plus all needed depedency libraries. In case you want to get in touch with developing Citrus you should go with the project archive.
    This archive will give you the complete Citrus project sources. Using Maven you will easily be able to build Citrus on your own and
    extend Citrus with your own code.</p><p>The src archive is helpful during extension of the framework as it provides the Java sources for you. You may then be able to 
    debug into Citrus classes and have a look at the sources during development of your own features.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="setup-prerequisits"></a>2.2.&nbsp;Prerequisits</h2></div></div><div></div></div><p>You need following software on your computer, in order to use the Citrus framework:</p><div class="itemizedlist"><ul type="disc"><li><p>Java 5.0 or higher</p><p>Installed JDK 5.0 or higher plus JAVA_HOME environment variable set up and pointing to your Java installation 
            directory</p></li><li><p>Java IDE (optional)</p><p>A Java IDE will help you manage your Citrus project and create and execute test cases. 
            Use the Java IDE you like best (e.g. Eclipse or IntelliJ IDEA).</p></li><li><p>Maven 2.0.9 or higher (optional)</p><p>Maven will ease up your life when it comes to managing project dependencies and project builds. Maven
            can support you while using Citrus. In case you have a Maven built project it is very easy to include Citrus tests into
            your existing build lifecycle.</p></li></ul></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="setup-installation"></a>2.3.&nbsp;Installation</h2></div></div><div></div></div><p>Once you have downloaded the latest Citrus archive you need to unzip the archive into a suitable 
    location on your local storage.</p><p>You are now able to run the built-in testing samples, which also should give you an idea how to use Citrus with
    ANT.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="setup-using-maven"></a>2.4.&nbsp;Using Maven</h2></div></div><div></div></div><p>Citrus uses <a href="http://maven.apache.org/" target="_top">Maven</a> as build tool. Therefore it is also very easy for you to include Citrus into your Maven project.</p><p>In case you already use Maven build tool in your project it is most suitable for you to include Citrus as a test-scoped dependency 
    into your Maven project</p><div class="itemizedlist"><ul type="disc"><li><p>Add Citrus as test-scoped project dependency to your projects POM (pom.xml)</p><pre class="programlisting">
  &lt;dependency&gt;
    &lt;groupId&gt;com.consol.citrus&lt;/groupId&gt;
    &lt;artifactId&gt;citrus-core&lt;/artifactId&gt;
    &lt;version&gt;0.9&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
  &lt;/dependency&gt;
            </pre></li><li><p>Add the citrus Maven plugin to your project</p><pre class="programlisting">
  &lt;plugin&gt;
    &lt;groupId&gt;com.consol.citrus.mvn&lt;/groupId&gt;
    &lt;artifactId&gt;citrus-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;0.9&lt;/version&gt;
    &lt;configuration&gt;
      &lt;author&gt;Mickey Mouse&lt;/author&gt;
      &lt;targetPackage&gt;com.consol.citrus&lt;/targetPackage&gt;
    &lt;/configuration&gt;
  &lt;/plugin&gt;            
            </pre></li><li><p>Create tests using the citrus-maven-plugin (goal: citrus:create-new-test)</p></li><li><p>Tests will be included into your projects integration-test phase using the surefire plugin</p><pre class="programlisting">
  &lt;plugin&gt;
    &lt;artifactId&gt;maven-surefire-plugin&lt;/artifactId&gt;
    &lt;version&gt;2.4.3&lt;/version&gt;
    &lt;configuration&gt;
      &lt;skip&gt;true&lt;/skip&gt;
    &lt;/configuration&gt;
    &lt;executions&gt;
      &lt;execution&gt;
        &lt;id&gt;citrus-tests&lt;/id&gt;
        &lt;phase&gt;integration-test&lt;/phase&gt;
        &lt;goals&gt;
          &lt;goal&gt;test&lt;/goal&gt;
        &lt;/goals&gt;
        &lt;configuration&gt;
          &lt;skip&gt;false&lt;/skip&gt;
        &lt;/configuration&gt;
      &lt;/execution&gt;
    &lt;/executions&gt;
  &lt;/plugin&gt;
            </pre></li><li><p>Citrus source directories have to be defined as test sources</p><pre class="programlisting">
  &lt;testSourceDirectory&gt;src/citrus/java&lt;/testSourceDirectory&gt;
  &lt;testResources&gt;
    &lt;testResource&gt;
      &lt;directory&gt;src/citrus/java&lt;/directory&gt;
      &lt;includes&gt;
        &lt;include&gt;**&lt;/include&gt;
      &lt;/includes&gt;
      &lt;excludes&gt;
        &lt;exclude&gt;*.java&lt;/exclude&gt;
      &lt;/excludes&gt;
    &lt;/testResource&gt;
    &lt;testResource&gt;
      &lt;directory&gt;src/citrus/tests&lt;/directory&gt;
      &lt;includes&gt;
        &lt;include&gt;**/*&lt;/include&gt;
      &lt;/includes&gt;
      &lt;excludes&gt;
      &lt;/excludes&gt;
    &lt;/testResource&gt;
  &lt;/testResources&gt;            
            </pre></li><li><p>Run Maven integration-test phase to execute all tests (goal: integration-test)</p></li></ul></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="testcase"></a>Chapter&nbsp;3.&nbsp;Test case</h2></div></div><div></div></div><p>Now let us start writing test cases! The upcoming guide will introduce all possible actions inside a test case 
  and explain how to connect to other systems by sending and receiving messages over various transports.</p><p>Citrus specifies test cases through simple XML files. The whole test case description will take place in one single
  XML file. This chapter will introduce the custom XML schema language that defines a test cases.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="testcase-defining"></a>3.1.&nbsp;Defining a test case</h2></div></div><div></div></div><p>Clearly spoken a test case is nothing but a simple Spring XML configuration file. 
    So using the Spring XML configuration syntax you are able to write fully compatible test cases for the Citrus framework.</p><pre class="programlisting">
  &lt;beans
      xmlns="http://www.springframework.org/schema/beans"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.springframework.org/schema/beans
      http://www.springframework.org/schema/beans/spring-beans-2.5.xsd"&gt;
      
      &lt;bean name="myFirstTest" 
               class="com.consol.citrus.model.TestCase"&gt;
          &lt;property name="actions"&gt;
              <i class="lineannotation"><span class="lineannotation">&lt;!-- actions of this test go here --&gt;</span></i>
          &lt;/property&gt;
      &lt;/bean&gt;
  &lt;/beans&gt;
    </pre><p>Citrus can execute these test case as normal test cases - no problem, but this XML usual 
    syntax is not the best way to describe a test case in Citrus, especially when test scenarios get more 
    complex and the test cases grow in size. Therefore Citrus provides a custom XML schema definition for 
    writing test cases.</p><p>The custom XML schema aims to reach the convenience of Domain specific languages (DSL). Let us have a look 
    at the Citrus test describing DSL by introducing a first very simple test case definition:</p><pre class="programlisting">
  &lt;spring:beans
      xmlns="http://www.citrusframework.org/schema/testcase"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns:spring="http://www.springframework.org/schema/beans"
      xsi:schemaLocation="
      http://www.springframework.org/schema/beans 
      http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
      http://www.citrusframework.org/schema/testcase 
      http://www.citrusframework.org/schema/testcase/citrus-testcase.xsd"&gt;
      
      &lt;testcase name="myFirstTest"&gt;
          &lt;description&gt;
              First example showing the basic test case definition elements!
          &lt;/description&gt;
          &lt;variables&gt;
              &lt;variable name="text" 
                           value="Hello Test Framework"/&gt;
          &lt;/variables&gt;
          &lt;actions&gt;
              &lt;echo&gt;
                  &lt;message&gt;${test}&lt;/message&gt;
              &lt;/echo&gt;
          &lt;/actions&gt;
      &lt;/testcase&gt;
  &lt;/spring:beans&gt;
    </pre><p>We do need the <tt class="literal">&lt;spring:beans&gt;</tt> root element as the XML file is read by the Spring IoC Container. 
    Inside this root element the Citrus specific namespace definitions take place. In the following we use the customized XML schema 
    language in Citrus to describe the test case.</p><p>The test case itself gets a mandatory name that must be unique throughout all test cases in a project. You will receive errors
    when using duplicate test names. The name must not contain any whitespaces but does support special characters like '-', '.', '_'. 
    The &lt;testcase&gt; element holds several child elements. These basic test elements are described in the following sections.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="testcase-description"></a>3.1.1.&nbsp;Description</h3></div></div><div></div></div><p>The test case description points out the purpose and gives a short introduction to the intended use case scenario that 
        will be tested. The user should get a first impression what the test case is all about. You can use free text in order to describe the test. 
        But be aware of the XML validation rules of well formed XML (e.g. special character escaping, use of CDATA sections)</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="testcase-variables"></a>3.1.2.&nbsp;Variables</h3></div></div><div></div></div><pre class="programlisting">
  &lt;variables&gt;
      &lt;variable name="text" value="Hello Test Framework"/&gt;
      &lt;variable name="customerId" value="123456789"/&gt;
  &lt;/variables&gt;
        </pre><p>The test variables are valid for the whole test case. You can reference them several times using a variables expression 
        <tt class="literal">"${variable-name}"</tt>. It is good practice to provide all important entities as test variables. This
        makes the test easier to maintain and more flexible. All essential entities are present right at the beginning of the test, which
        may also give the opportunity to easily create test variants by simply changing the variable values.</p><p>The name of the variable is arbitrary. Feel free to specify any name you can think of. Of course you need to be careful with
        special characters and reserved XML entities like '&amp;', '&lt;', '&gt;'. If you are familiar with Java or any other programming 
        language simply think of the naming rules there and you will be fine with working on Citrus variables too. The value of a variable 
        can be any character sequence. But again be aware of special XML characters like "&lt;" that need to be escaped ("&amp;lt;") when 
        used in variable values.</p><p>The advantage of variables is obvious. Once declared the variables can be referenced many times in
        the test. This makes it very easy to vary different test cases by adjusting the variables for different means (e.g. use different 
        error codes in test cases).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="testcase-actions"></a>3.1.3.&nbsp;Actions</h3></div></div><div></div></div><p>A test case defines a sequence of actions that will take place during the test. The
        actions are executed sequentially as they are defined in the test case definition.</p><pre class="programlisting">
  &lt;actions&gt;
      &lt;action&gt;[...]&lt;/action&gt;
      &lt;action&gt;[...]&lt;/action&gt;
      &lt;action&gt;[...]&lt;/action&gt;
      &lt;action&gt;[...]&lt;/action&gt;
  &lt;/actions&gt;
        </pre><p>All actions have individual names and properties that define 
        the action behaviour. Citrus offers a wide range of test actions from scratch, but you are also able to write your own 
        test actions in Java or Groovy and execute them during a test. <a href="#actions" title="Chapter&nbsp;5.&nbsp;Test actions">Chapter&nbsp;5, <i>Test actions</i></a> gives you a brief description of all available 
        actions that can be part of a test case execution.</p><p>The actions are combined in free sequence to each other so that the tester is able to declare a special action chain inside the test.
        These actions can be sending or receiving messages, delaying the test, validating the database and so on. Step by step the test proceeds 
        the action chain. Usually the tester tries to fit the designed use case scenario with the action chain.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="testcase-finally"></a>3.1.4.&nbsp;Cleanup</h3></div></div><div></div></div><p>The finally element also contains a list of test actions. These actions will be executed at the very
        end of the test case even if errors did occur during the execution before. This is the right place to tidy up things that were previously 
        created by the test like cleaning up the database for instance. The finally section is described in more detail in <a href="#finally" title="Chapter&nbsp;8.&nbsp;Finally section">Chapter&nbsp;8, <i>Finally section</i></a></p><pre class="programlisting">      
  &lt;finally&gt;
      &lt;action&gt;[...]&lt;/action&gt;
      &lt;action&gt;[...]&lt;/action&gt;
      &lt;action&gt;[...]&lt;/action&gt;
      &lt;action&gt;[...]&lt;/action&gt;
  &lt;/finally&gt;
        </pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="testcase-metainfo"></a>3.2.&nbsp;Meta information</h2></div></div><div></div></div><p>The user can provide some basic information about the test case. The meta-info element at the very beginning of the test case 
    holds information like the author of the test or the creation date. In detail the meta information is specified like this:</p><pre class="programlisting">
  &lt;testcase name="metaInfoTest"&gt;
      &lt;meta-info&gt;
          &lt;author&gt;Christoph Deppisch&lt;/author&gt;
          &lt;creationdate&gt;2008-01-11&lt;/creationdate&gt;
          &lt;status&gt;FINAL&lt;/status&gt;
          &lt;last-updated-by&gt;Christoph Deppisch&lt;/last-updated-by&gt;
          &lt;last-updated-on&gt;2008-01-11T10:00:00&lt;/last-updated-on&gt;
      &lt;/meta-info&gt;
      &lt;description&gt;
          ...
      &lt;/description&gt;
      &lt;actions&gt;
          ...
      &lt;/actions&gt;
  &lt;/testcase&gt;
    </pre><p>The status allows following values: DRAFT, READY_FOR_REVIEW, DISABLED, FINAL.
    The meta-data information to a test is quite important to give the reader a first information about
    the test. It is also possible to generate test documentation using this meta-data information. The built-in Citrus 
    documentation generates HTML or Excel documents that list all tests with their metadata information and description.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>Tests in status DISABLED will not be executed during a test suite run. So someone can just start adding
        planned test cases that are not finished yet in status DRAFT. In case a test is not runnable yet because not finished entirely
        someone may disable a test temporarily to avoid causing failures during a test run. Using these different status one can 
        easily set up test plans and review the progress of test coverage by comparing the amount of test in status DRAFT to those in FINAL state.</p></td></tr></table></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="messaging"></a>Chapter&nbsp;4.&nbsp;Send and receive messages</h2></div></div><div></div></div><p>In the previous chapter the basic test case structure was introduced with its &lt;variables&gt; and
  &lt;actions&gt;. The &lt;actions&gt; element contains all actions that will be executed during the test case in
  sequential order. The framework offers several built-in actions that the user can choose from. These actions will take our
  interest in the next sections.</p><p>As sending and receiving messages is an essential part in EAI projects we will handle these actions first.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="message-sending"></a>4.1.&nbsp;Sending messages</h2></div></div><div></div></div><p>The &lt;send&gt; action publishes messages to a destination. The transport to be used does - for now - not
    matter to the test case. The test case simply defines the sending action and uses a predefined message sender to actually 
    publish the defined message. There are several message sender implementations in the framework available representing several 
    ways to publish a message. This means that the transport protocol to be used (JMS, SOAP, HTTP, TCP/IP etc.) 
    is not specified in the test case directly, but in the message sender definitions. We will see later in this document how message 
    senders for various transports are configured in Citrus.</p><p>The advantage of this seperation of configuration is definitely the flexibility of test cases. The test case does not know 
    anything about JMS ConnectionFactories, queue names or Http URLs. The transport underneath a sending action can change easily 
    without affecting the test case definition.</p><p>Usually the message payload will be plain XML format. The framework is not limited to the XML message format, but to be honest 
    XML is the default message format that is supported out of the box. Let us have a look at a first example how a sending action is 
    defined in the test.</p><pre class="programlisting">
  &lt;testcase name="sendMessageTest"&gt;
      &lt;description&gt;
          Send message example
      &lt;/description&gt;
      &lt;variables&gt;
          &lt;variable name="requestTag" value="Rx123456789"/&gt;
          &lt;variable name="correlationId" value="Cx1x123456789"/&gt;
      &lt;/variables&gt;
      &lt;actions&gt;
          &lt;send with="getCustomerRequestMessageSender"&gt;
              &lt;message&gt;
                  &lt;data&gt;
                      &lt;![CDATA[
                      &lt;RequestMessage&gt;
                          &lt;MessageHeader&gt;
                              &lt;CorrelationId&gt;${correlationId}&lt;/CorrelationId&gt;
                              &lt;Timestamp&gt;2001-12-17T09:30:47.0Z&lt;/Timestamp&gt;
                              &lt;RequestTag&gt;_&lt;/RequestTag&gt;
                              &lt;VersionId&gt;2&lt;/VersionId&gt;
                          &lt;/MessageHeader&gt;
                          &lt;MessageBody&gt;
                              &lt;Customer&gt;
                                  &lt;Id&gt;1&lt;/Id&gt;
                              &lt;/Customer&gt;
                          &lt;/MessageBody&gt;
                      &lt;/RequestMessage&gt;
                      ]]&gt;
                  &lt;/data&gt;
                  &lt;element path="/MessageHeader/RequestTag" 
                              value="${requestTag}"/&gt;
              &lt;/message&gt;
              &lt;header&gt;
                  &lt;element name="Operation" value="GetCustomer"/&gt;
                  &lt;element name="RequestTag" value="${requestTag}"/&gt;
              &lt;/header&gt;
          &lt;/send&gt;
      &lt;/actions&gt;
  &lt;/testcase&gt;
    </pre><p>The test uses two variable definitions (requestTag and correlationId), so first of all let us refresh in mind what 
    variables do. Variables defined at the very beginning of the test case are valid throughout all actions that take place 
    in the test. This means that actions can simply reference a variable by the variable expression (e.g. ${correlationId}).</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.png"></td><th align="left">Tip</th></tr><tr><td colspan="2" align="left" valign="top"><p>Use variables wherever you can! At least the important entities of a test should be defined as variables at the 
        beginning. The test case reaches better maintainability and flexibility using variables.</p></td></tr></table></div><p>Now lets have a closer look at the sending action. The 'with' attribute might catch someones attention at first. So what does the 
    'with' attribute do? This attribute references a message sender definition by name. As previously mentioned the message sender 
    definition lies in a seperate configuration file and contains the actual message transport configurations. In this example the 
    <span class="emphasis"><em>"getCustomerRequestMessageSender"</em></span> is used to send the message over JMS to a destination queue. 
    The test case is not aware of these details, because it does not have to. The advantage is obvious: Many test cases may use 
    the same message sender in order to send messages of type 'getCustomerRequest'.</p><p>In other words the attribute "with" in the &lt;send&gt; element specifies which message sender definition 
    to use for sendinging the message. Once again all available message senders are configured in a seperate Spring configuration file. 
    We will come to this later. Be sure to always pick the right message sender type in order to publish your message to the right 
    destination endpoint.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.png"></td><th align="left">Tip</th></tr><tr><td colspan="2" align="left" valign="top"><p>It is good practice to follow a naming convention when choosing names for message senders and receivers. The intended
        purpose of the message sender as well as the sending/receiving actor should be clear when choosing the name. For instance messageSender1,
        messageSender2 will not give any hint to the reader what is actually sent and to which destination.</p></td></tr></table></div><p>Now that the actual message sender is clear, the test must specify the message content itself. 
    This is done with these elements:</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p><span class="emphasis"><em>message</em></span>: This element defines the message to be sent. There are several child elements available:</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p><span class="emphasis"><em>data</em></span>: Inline definition of the XML message (instead of &lt;resource&gt; element)</p></li><li style="list-style-type: circle"><p><span class="emphasis"><em>resource</em></span>: External file holding the XML message to be sent (instead of &lt;data&gt; element)</p><p>The syntax would be: &lt;resource file="file:xmlData/NumberDeallocationRequest.xml" /&gt;</p><p>The location of the file can be declared as file system resource (file:) or as classpath
                    resource (classpath:).</p></li><li style="list-style-type: circle"><p><span class="emphasis"><em>element</em></span>: Explicitly overwrite values in the XML message using XPath. XML elements
                    can be replaced explicitly by previously defined test variable values. Each &lt;element&gt;
                    entry provides a "path" and "value" attribute. The "path" should be a valid XPath expression evaluating
                    to a node element or attribute in the message to be sent. The "value" can be a variable or any other 
                    static value. The framework will replace the value before sending the message.</p></li></ul></div></li><li style="list-style-type: circle"><p><span class="emphasis"><em>header</em></span>: Defines a header for the message (e.g. JMS header information or SOAP header). This
            &lt;header&gt; element has child elements to define the header values:</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p><span class="emphasis"><em>element</em></span>: Similar to the &lt;element&gt; tag in the message definition. Here the attributes
                    "name" and "value" define the header entry. The "name" will be the name of the header
                    entry and "value" its respective value. Again the usage of variables is very useful here, too.</p></li></ul></div></li></ul></div><p>The most important thing when dealing with sending actions is to prepare the XML message to be sent.
    The message content itself is specified by the &lt;data&gt; or the &lt;resource&gt; property. These elements hold the message
    payload as internal CDATA definition or as external file resource. Usually there are some message values that have to be 
    dynamically set before sending the message (especially when using test variables). 
    This is why you can overwrite specific message elements. The example above uses the variable ${correlationId} directly in the 
    XML payload definition. The framework will replace this variable with the respective value before sending the message. There is 
    also a second approach to overwrite message elements using XPath. The "/MessageHeader/RequestTag" XPath expression for instance
    overwrites the respective request tag value in the message. The two approaches of setting message elements can coexist simultaneously; 
    however the inline XML content replacement seems less complex than XPath, although XPath may be the right way for powerful 
    replacements inside the message payload.</p><p>The &lt;header&gt; property is used to set the values like "Operation" and "RequestTag". The example 
    shows that the use of variables is supported here using the common variables syntax.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="message-receiving"></a>4.2.&nbsp;Receiving messages</h2></div></div><div></div></div><p>Now after sending a message with Citrus we would like to receive a message inside the test. 
    Let us again have a look at s simple example showing how it works.</p><pre class="programlisting">
  &lt;receive with="getCustomerResponseReceiver"&gt;
      &lt;selector&gt;
          &lt;value&gt;operation = 'GetCustomer'&lt;/value&gt;
      &lt;/selector&gt;
      &lt;message&gt;
          &lt;data&gt;
              &lt;![CDATA[
              &lt;RequestMessage&gt;
                  &lt;MessageHeader&gt;
                      &lt;CorrelationId&gt;${correlationId}&lt;/CorrelationId&gt;
                      &lt;Timestamp&gt;2001-12-17T09:30:47.0Z&lt;/Timestamp&gt;
                      &lt;RequestTag&gt;_&lt;/RequestTag&gt;
                      &lt;VersionId&gt;2&lt;/VersionId&gt;
                  &lt;/MessageHeader&gt;
                  &lt;MessageBody&gt;
                      &lt;Customer&gt;
                          &lt;Id&gt;1&lt;/Id&gt;
                      &lt;/Customer&gt;
                  &lt;/MessageBody&gt;
              &lt;/RequestMessage&gt;
              ]]&gt;
          &lt;/data&gt;
          &lt;element path="//MessageHeader/RequestTag" 
                      value="${requestTag}"/&gt;
      &lt;/message&gt;
      &lt;header&gt;
          &lt;element name="Operation" value="GetCustomer"/&gt;
          &lt;element name="RequestTag" value="${requestTag}"/&gt;
      &lt;/header&gt;
      &lt;extract&gt;
          &lt;header name="Operation" variable="%operation"/&gt;
          &lt;message name="//MessageBody/Customer/Id" 
                      variable="%customerId"/&gt;
      &lt;/extract&gt;
  &lt;/receive&gt;
    </pre><p>Knowing the send action of the previous chapter we can identify some common mechanisms that apply for both 
    sending and receiving actions. This time the test uses a predefined message receiver in order to receive the message 
    over a certain transport. Again the test is not aware of the transport details (e.g. JMS connection factory, 
    queue names, etc.), but the message receiver does know this information.</p><p>While the action tries to receive a message the whole test execution will be delayed. This is
    important to ensure the step by step test workflow processing. The receiver will only wait a given amount of time for
    the message to arrive. A timeout exception fails the test in case the message does not arrive in time.</p><p>Once the message has arrived, the content can be validated in various ways. On the one hand you
    can specify a whole XML message template that you expect. In this case the received XML structure will
    be compared to the expected XML message template element by element. On the other hand you can
    specify some elements that are of interest for the test. These elements will then be explicitly validated. 
    The framework will search for the right element in the received XML structure and compare the value with the expected one.</p><p>Besides this message payload validation the framework can also validate the message header values. Simply
    specify the header name and the expected value inside the receive action. Variable usage is supported as usual. 
    But let us have a closer look at the validation options and the features regarding message receiving step by step.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="message-receiving-selector"></a>4.2.1.&nbsp;Messages selectors</h3></div></div><div></div></div><p>The <span class="emphasis"><em>&lt;selector&gt;</em></span> element inside the receiving action defines key-value paris in order to 
        filter the messages beeing received. The key value paris apply to the message headers. This means that a receiver will 
        only accept messages that meet the key-value pairs in its header. Using this mechanism you can explicitly listen for 
        messages that belong to your test. This is very helpful to avoid receiving messages from other tests that are still available 
        on the message destination.</p><p>Lets say the tested software application keeps sending messages that belong to previous test cases. This could happen in retry 
        situations where the application's error handling automatically tries to solve a communication problem that occured 
        during previous test cases. As a result the EAI application keeps sending messages that are not valid any more for the currently 
        running test case. The test case might fail because the received message does not apply to the currently tested use case. The messages
        received are simply failing because the message content does not fit the expected one (e.g. correlation-ids, customer informations 
        etc.).</p><p>Now we have to find a way to avoid these problems. The test could filter the messages on a destination to only receive messages 
        that apply for the use case that is being tested. The Java Messaging System (JMS) came up with a message header selector that will 
        only accept messages that fit the expected header values.</p><p>Let us have a closer look at a message selector inside a receiving action:</p><pre class="programlisting">
  &lt;selector&gt;
      &lt;element&gt; name="correlationId" value="Lx1x123456789"&lt;/element&gt;
      &lt;element&gt; name="operation" value="getOrders"&lt;/element&gt;
  &lt;/selector&gt;
        </pre><p>This example shows how selectors work. The selector will only accept messages that meet the correlation id and the operation 
        in the header values. All other messages are ignored. The selector elements are associated to each other using logical AND
        (e.g. where correlationId = 'Lx1x123456789' AND operation = 'getOrders').</p><p>You can also define a selector string yourself that gives you more power in constructing the selection logic.</p><pre class="programlisting">
  &lt;selector&gt;
      &lt;value&gt;
          correlationId = 'Cx1x123456789' OR correlationId = 'Cx1x987654321'
      &lt;/value&gt;
  &lt;/selector&gt;
        </pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.png"></td><th align="left">Important</th></tr><tr><td colspan="2" align="left" valign="top"><p>In case you want to run tests in parallel you will need to specify message selectors, otherwise the different tests running 
            at the same time will steal messages from each other. In parallel test execution several test cases will listen for messages at 
            the same time.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="message-receiving-template"></a>4.2.2.&nbsp;Expected message templates</h3></div></div><div></div></div><p>Once a message is received a tester may always want to validate the message content. The tester has a expected message in 
        mind that is compared to the actual message that arrived.</p><p>A tester can sepcify expected message templates using the following elements inside a receiving action:</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p><span class="emphasis"><em>&lt;data&gt;</em></span>: Defines an inline XML message template that is expected</p></li><li style="list-style-type: circle"><p><span class="emphasis"><em>&lt;resource&gt;</em></span>: Defines an expected XML message via external file resources</p></li></ul></div><p>Both ways inline CDATA XML or external file resource do specify a expected message template. The framework will use this
        template to compare the received message to it. Now the message template is very static. Dynamic message contents may cause 
        the validation to fail. Therefore a tester can enrich the expected message template using test variables before the validation or
        a tester can ignore some elements in validation.</p><pre class="programlisting">
  &lt;message&gt;
      &lt;data&gt;
          &lt;![CDATA[
          &lt;RequestMessage&gt;
              &lt;MessageHeader&gt;
                  &lt;CorrelationId&gt;${correlationId}&lt;/CorrelationId&gt;
                  &lt;Timestamp&gt;2001-12-17T09:30:47.0Z&lt;/Timestamp&gt;
                  &lt;RequestTag&gt;_&lt;/RequestTag&gt;
                  &lt;VersionId&gt;2&lt;/VersionId&gt;
              &lt;/MessageHeader&gt;
              &lt;MessageBody&gt;
                  &lt;Customer&gt;
                      &lt;Id&gt;1&lt;/Id&gt;
                  &lt;/Customer&gt;
              &lt;/MessageBody&gt;
          &lt;/RequestMessage&gt;
          ]]&gt;
      &lt;/data&gt;
      &lt;element path="//MessageHeader/RequestTag" 
                  value="${requestTag}"/&gt;
  &lt;/message&gt;
        </pre><p>The previous program linsting shows the two ways of setting variable values inside a message template. First of all you can
        simply place variable expressions inside the message data (see how ${correlationId} is used). As a second possibility you can use 
        XPath expressions to explicitly overwrite message elements before validation.</p><p><tt class="literal">&lt;element path="//MessageHeader/RequestTag" value="${requestTag}"/&gt;</tt></p><p>The XPath expression evaluates to the message template, searches for the right element and replaces the element value. Of course 
        this works with attributes too.</p><p>However despite of adding dynamic variable values to the expected message template some elements inside a message will not be
        dedicated for validation at all. Communication timestamps inside a message for example as shown here:</p><pre class="programlisting">
  [...]
      &lt;Timestamp&gt;2001-12-17T09:30:47.0Z&lt;/Timestamp&gt;
  [...]
        </pre><p>This timestamp value will dynamically change from test run to test run, so lets ignore it in validation</p><p><tt class="literal">&lt;ignore path="//ResponseMessage/MessageHeader/Timestamp"/&gt;</tt></p><p>This is how a message template is manipulated before validation. The framework applies a detailed XML tree validation to ensure 
        that the messages (expected and received) are matching. XML attributes, element names, namespaces as well as the number of child elements 
        are validated. In case one single element is not equal to the expected one the validation will raise errors and the test will fail.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="message-receiving-elements"></a>4.2.3.&nbsp;Validating message elements</h3></div></div><div></div></div><p>In the previous chapter we learned how to validate the whole XML tree against a expected message template. In some cases 
        this approach might be overkill. In case you as a tester need to validate only a small subset of message elements you might want
        to use the element validation.</p><pre class="programlisting">
  &lt;message&gt;
      &lt;validate path="//MessageHeader/RequestTag" 
                   value="${requestTag}"/&gt;
      &lt;validate path="//CorrelationId" 
                   value="${correlationId}"/&gt;
      &lt;validate path="//MessageBody/Number" 
                   value="123456789"/&gt;
  &lt;/message&gt;
        </pre><p>Instead of comparing the whole message only the specified message elements are validated. The framework 
        tries to find the elements in the received message via XPath and compares its value to the expected one. Nothing else is validated here.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>If this type of validation is choosen neither &lt;data&gt; nor &lt;resource&gt; template definitions are allowed.</p></td></tr></table></div><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.png"></td><th align="left">Tip</th></tr><tr><td colspan="2" align="left" valign="top"><p>The test framework offers an alternative dot-notated syntax in order to walk through XML trees. In case you are not 
            familiar with XPath or simply need a very easy way to find your element inside the XML tree you might use this way. Every 
            element hierarchy in the XML tree is represented with a simple dot - for example:</p><p><tt class="literal">message.body.text</tt></p><p>The expression will search the XML tree for the respective &lt;message&gt;&lt;body&gt;&lt;text&gt; element. Attributes 
            are supported too. In case the last element in the dot-notated expression is a XML attribute the framework will automatically 
            find it.</p><p>Of course this dot-notated syntax is very simple and might not be applicable for more complex tree walkings. 
            XPath is much more powerful - no doubt. However the dot-notated syntax might help those of you that are not familiar with XPath.
            So the dot-notation is supported wherever XPath expressions might apply.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="message-receiving-header"></a>4.2.4.&nbsp;Validate the message header</h3></div></div><div></div></div><p>After we have validated the message payload in the previous chapters we might be interested in validating the message header
        too.</p><pre class="programlisting">
  &lt;header&gt;
      &lt;element name="Operation" value="GetCustomer"/&gt;
      &lt;element name="RequestTag" value="${requestTag}"/&gt;
  &lt;/header&gt;    
        </pre><p>The given values have to be present in the received message header and their value has to fit the expected value otherwise
        the test case will fail.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="message-receiving-extract"></a>4.2.5.&nbsp;Saving dynamic message content</h3></div></div><div></div></div><p>Imagine you receive a message in your test that contains a generated message id. You have no chance to predict the id
        because it was generated dynamically. But unfortunately you need to return this id in the respective response message to meet
        the requirements. We need to save the dynamic value into a new test variable.</p><pre class="programlisting">
  &lt;extract&gt;
      &lt;header name="Operation" variable="operation"/&gt;
      &lt;message name="//MessageBody/Customer/Id" 
                  variable="customerId"/&gt;
  &lt;/extract&gt;
        </pre><p>As you can see the framework is able to store content into variables. The content may come from message payload 
        or message header values. You can store the information to new test variables or existing ones. You do not need to create 
        the variables before the extracting will automatically create a new variable in case it does not exist. The upcoming test 
        actions can access these variables as usual.</p></div><p>At this point you know the two most important test actions in the test framework. Sending and
    receiving actions will become the main components of your integration tests. In most cases a test will create a message flow, 
    which means a sequence of sending and receiving messages in order to replicate a use case.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="actions"></a>Chapter&nbsp;5.&nbsp;Test actions</h2></div></div><div></div></div><p>This chapter gives a brief description to all test actions that a tester can incorporate into the test case. 
  Besides sending and receiving messages the tester may access these actions in order to build a more complex test scenario
  that fits the desired use case.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-database"></a>5.1.&nbsp;Connecting to the database</h2></div></div><div></div></div><p>In many cases it is necessary to access the database during a test. This enables a tester to also validate 
    the persistent data in a database. It might also be helpful to prepare the database with some test data before running a test. 
    You can do this using the two database actions that are descirbed in the following sections.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="actions-database-update"></a>5.1.1.&nbsp;Updating the database</h3></div></div><div></div></div><p>The &lt;sql&gt; action simply executes a group of SQL statements in order to change data in a database.
      Typically the action is used to prepare the database at the beginning of a test or to clean up the
      database at the end of a test. You can specify SQL statements like INSERT, UPDATE,
      DELETE, CREATE TABLE, ALTER TABLE and many more.</p><p>On the one hand you can specify the statements as inline SQL or stored in an external
      SQL resource file as shown in the next two examples.</p><pre class="programlisting">
  &lt;actions&gt;
      &lt;sql datasource="someDataSource"&gt;
          &lt;statement&gt;DELETE FROM CUSTOMERS&lt;/statement&gt;
          &lt;statement&gt;DELETE FROM ORDERS&lt;/statement&gt;
      &lt;/sql&gt;
      
      &lt;sql datasource="myDataSource"&gt;
          &lt;resource file="file:tests/unit/resources/script.sql"/&gt;
      &lt;/sql&gt;
  &lt;/actions&gt;
      </pre><p>The first action uses inline SQL statements defined directly inside the test case. The next action uses an external 
      SQL resource file instead. The file resource can hold several SQL statements seperated by new lines. All statements inside 
      the file are executed sequentially by the framework.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.png"></td><th align="left">Important</th></tr><tr><td colspan="2" align="left" valign="top"><p>You have to pay attention to some rules when dealing with external SQL resources.</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p>Each statement should begin in a new line</p></li><li style="list-style-type: circle"><p>It is not allowed to define statements with word wrapping</p></li><li style="list-style-type: circle"><p>Comments begin with two dashes "--"</p></li></ul></div></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>The external file is referenced either as file system resource or class path resource,
        by using the "file:" or "classpath:" prefix.</p></td></tr></table></div><p>Both examples use the "datasource" attribute. This value defines the database data source to be used. The connection to
      a data source is mandatory, because the test case does not know about user credentials or database names. The 'datasource' attribute 
      references predefined data sources that are located in a separate Spring configuration file.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="actions-database-query"></a>5.1.2.&nbsp;Verifying data from the database</h3></div></div><div></div></div><p>The &lt;sql&gt; action is specially designed to execute SQL queries (SELECT * FROM). So the test is able to get data from a database. 
      The query results are validated against expected data as shown in the next example.</p><pre class="programlisting">
  &lt;sql datasource="testDataSource"&gt;
      &lt;statement&gt;select NAME from CUSTOMERS where ID='${customerId}'&lt;/statement&gt;
      &lt;statement&gt;select count(*) from ERRORS&lt;/statement&gt;
      &lt;statement&gt;select ID from ORDERS where DESC LIKE 'Def%'&lt;/statement&gt;
      &lt;statement&gt;select DESCRIPTION from ORDERS where ID='${id}'&lt;/statement&gt;
      
      &lt;validate column="ID" value="1"/&gt;
      &lt;validate column="NAME" value="Deppisch"/&gt;
      &lt;validate column="COUNT(*)" value="${rowsCount}"/&gt;
      &lt;validate column="DESCRIPTION" value="null"/&gt;
  &lt;/sql&gt;
      </pre><p>The action &lt;sql&gt; offers a wide range of validating functionality for database result sets. First
      of all you have to select the data via SQL statements. Here again you have the choice to use inline SQL
      statements or external file resource pattern.</p><p>The result sets are validated through &lt;validate&gt; elements. It is possible to do a detailed check on
      every selected column of the result set. Simply refer to the selected column name in order to validate its
      value. The usage of test variables is supported as well as database expressions like count(), avg(), min(),
      max().</p><p>You simply define the &lt;validate&gt; entry with the column name as the "column" attribute and any expected
      value expression as expected "value". The framework then will check the column to fit the expected value and raise 
      validation errors in case of mismatch.</p><p>Looking at the first SELECT statement in the example you will see that test variables are supported in the 
      SQL statements. The framework will replace the variable with its respective value before sending it to the database.</p><p>In the validation section variables can be used too. Look at the third validation entry, where the variable
      "${rowsCount}" is used. The last validation in this example shows, that <tt class="literal">NULL</tt> values are 
      also supported as expected values.</p><p>If a single validation happens to fail, the whole action will fail with respective validation errors.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>When validating database query result sets Citrus can only handle single </p></td></tr></table></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-sleep"></a>5.2.&nbsp;Sleep</h2></div></div><div></div></div><p>This action shows how to make the test framework sleep for a given amount of time. The attribute 'time' defines 
    the amount of time to wait in seconds. As shown in the next example decimal values are supported too. When no waiting time is
    specified the default time of 5.0 seconds applies.</p><pre class="programlisting">
  &lt;testcase name="sleepTest"&gt;
      &lt;actions&gt;
          &lt;sleep time="3.5"/&gt;
          
          &lt;sleep/&gt;
      &lt;/actions&gt;
  &lt;/testcase&gt;
    </pre><p>When should somebody use this action? To us this action was always very useful in case the test needed to wait until 
    an application had done some work. For example in some cases the application took some time to write some data into the database.
    We waited then a small amount of time in order to avoid unnessesary test failures, because the test framework simply validated 
    the database too early. Or as another example the test may wait a given time until retry mechanisms are triggered in the tested
    application and then proceed with the test actions.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-java"></a>5.3.&nbsp;Java</h2></div></div><div></div></div><p>The test framework is written in Java and runs inside a Java virtual machine. The functionality of calling other 
    Java objects and methods in this same Java VM through Java Reflection is self-evident. 
    With this action you can call any Java API available at runtime through the specified Java classpath.</p><p>The action syntax looks like follows:</p><pre class="programlisting">
  &lt;java class="com.consol.citrus.test.util.InvocationDummy"&gt;
      &lt;constructor&gt;
          &lt;argument type=""&gt;Test Invocation&lt;/argument&gt;
      &lt;/constructor&gt;
      &lt;method name="invoke"&gt;
          &lt;argument type="String[]"&gt;1,2&lt;/argument&gt;
      &lt;/method&gt;
  &lt;/java&gt;
  
  &lt;java class="com.consol.citrus.test.util.InvocationDummy"&gt;
      &lt;constructor&gt;
          &lt;argument type=""&gt;Test Invocation&lt;/argument&gt;
      &lt;/constructor&gt;
      &lt;method name="invoke"&gt;
          &lt;argument type="int"&gt;4&lt;/argument&gt;
          &lt;argument type="String"&gt;Test Invocation&lt;/argument&gt;
          &lt;argument type="boolean"&gt;true&lt;/argument&gt;
      &lt;/method&gt;
  &lt;/java&gt;
      
  &lt;java class="com.consol.citrus.test.util.InvocationDummy"&gt;
      &lt;method name="main"&gt;
          &lt;argument type="String[]"&gt;4,Test,true &lt;/argument&gt;
      &lt;/method&gt;
  &lt;/java&gt;
    </pre><p>The Java class is specified by fully qualified class name. Constructor arguments are added using the &lt;constructor&gt; 
    element with a list of &lt;argument&gt; child elements. The type of the argument is defined within the respective 
    attribute "type". By default the type would be String.</p><p>The invoked method on the Java object is simply referenced by its name. Method arguments do not bring anything new 
    after knowing the constructor argument definition, do they?.</p><p>Method arguments support data type conversion too, even string arrays (useful when
    calling CLIs). In the third action in the example code you can see that colon separated strings are automatically 
    converted to string arrays.</p><p>Simple data types are defined by their name (int, boolean, float etc.). Be sure that the invoked method
    and class constructor fit your arguments and vice versa, otherwise you will cause errors at runtime.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-timeout"></a>5.4.&nbsp;Expect timeouts on a destination</h2></div></div><div></div></div><p>In some cases it might be necessary to validate that a message is <span class="emphasis"><em>not</em></span> present on a destination. 
    This means that this action expects a timeout when receiving a message from an endpoint destination. For instance the tester 
    intends to ensure that no message is sent to a certain destination in a time period. In that case the timeout would 
    not be a test aborting error but the expected behaviour. And in contrast to the normal behaviour when a message is received 
    in the time period the test will fail with error.</p><p>In order to validate such a timeout situation the action &lt;expectTimout&gt; shall help. The usage
    is very simple as the following example shows:</p><pre class="programlisting">
  &lt;testcase name="receiveJMSimeoutTest"&gt;
      &lt;actions&gt;
          &lt;expect-timeout message-receiver="myMessageReceiver" 
                             wait="500"/&gt;
      &lt;/actions&gt;
  &lt;/testcase&gt;
    </pre><p>The action offers two attributes:</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p><span class="emphasis"><em>message-receiver</em></span>: Reference to a message receiver that will try to receive messages.</p></li><li style="list-style-type: circle"><p><span class="emphasis"><em>wait</em></span>: Time period to wait for messages to arrive</p></li></ul></div><p>TODO: describe receive selected!</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-echo"></a>5.5.&nbsp;Echo</h2></div></div><div></div></div><p>The &lt;echo&gt; action prints messages to the console/logger. This functionality is useful when
    debugging test runs. The property "message" defines the text that is printed. Tester might use it to print
    out debug messages and variables as shown the next code example:</p><pre class="programlisting">
  &lt;testcase name="echoTest"&gt;
      &lt;variables&gt;
          &lt;variable name="date" 
                       value="citrus:currentDate()"/&gt;
      &lt;/variables&gt;
      &lt;actions&gt;
          &lt;echo&gt;
              &lt;message&gt;Hello Test Framework&lt;/message&gt;
          &lt;/echo&gt;
          
          &lt;echo&gt;
              &lt;message&gt;Current date is: ${date}&lt;/message&gt;
          &lt;/echo&gt;
      &lt;/actions&gt;
  &lt;/testcase&gt;
    </pre><p>Result on the console:</p><pre class="programlisting">
  Hello Test Framework
  Current time is: 05.08.2008
    </pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-measure-time"></a>5.6.&nbsp;Time measurement</h2></div></div><div></div></div><p>Time measurement during a test can be very helpful. The &lt;trace-time&gt; action creates and monitors 
    multiple timelines. The action offers the attribute "id" to identify a time line. The tester can of course 
    use more than one time line with different ids simultaneously.</p><p>Read the next example and you will understand the mix of different time lines:</p><pre class="programlisting">
  &lt;testcase name="timeWatcherTest_new"&gt;
      &lt;actions&gt;
          &lt;trace-time/&gt;
          
          &lt;trace-time id="time_line_id"/&gt;
          
          &lt;sleep time="3.5"/&gt;
          
          &lt;trace-time id=" time_line_id "/&gt;
          
          &lt;sleep time="5.0"/&gt;
          
          &lt;trace-time/&gt;
          
          &lt;trace-time id=" time_line_id "/&gt;
      &lt;/actions&gt;
  &lt;/testcase&gt;
    </pre><p>The test output looks like follows:</p><pre class="programlisting">
  Starting TimeWatcher:
  Starting TimeWatcher: time_line_id
  TimeWatcher time_line_id after 3.5 seconds
  TimeWatcher after 8.5 seconds
  TimeWatcher time_line_id after 8.5 seconds
    </pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top">In case no time line id is specified the framework will measure the time for a default time line.</td></tr></table></div><p>To print out the current elapsed time for a time line you simply have to place the &lt;trace-time&gt; action into
    the action chain again and again, using the respective time line identifier. The elapsed time will be printed out to the console every time.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-create-variables"></a>5.7.&nbsp;Create variables</h2></div></div><div></div></div><p>As you know variables usually are defined at the beginning of the test case (<a href="#testcase-variables" title="3.1.2.&nbsp;Variables">Section&nbsp;3.1.2, &#8220;Variables&#8221;</a>). 
    It might also be helpful to reset existing variables as well as to define new variables during the test. The 
    action &lt;create-variables&gt; is able to declare new variables or overwrite existing ones.</p><pre class="programlisting">
  &lt;testcase name="createVariablesTest"&gt;
      &lt;variables&gt;
          &lt;variable name="myVariable" value="12345"/&gt;
          &lt;variable name="id" value="54321"/&gt;
      &lt;/variables&gt;
      &lt;actions&gt;
          &lt;echo&gt;
              &lt;message&gt;Current variable value: ${myVariable} &lt;/message&gt;
          &lt;/echo&gt;
          
          &lt;create-variables&gt;
              &lt;variable name="myVariable" value="${id}"/&gt;
              &lt;variable name="newVariable" value="'this is a test'"/&gt;
          &lt;/create-variables&gt;
          
          &lt;echo&gt;
              &lt;message&gt;Current variable value: ${myVariable} &lt;/message&gt;
          &lt;/echo&gt;
      
          &lt;echo&gt;
              &lt;message&gt;New variable 'newVariable' has the value: ${newVariable} &lt;/message&gt;
          &lt;/echo&gt;
      &lt;/actions&gt;
  &lt;/testcase&gt;
    </pre><p>The new variables are valid for the rest of the test. Actions reference them as usual through a variable expression.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-trace"></a>5.8.&nbsp;Trace variables</h2></div></div><div></div></div><p>You already know the &lt;echo&gt; action that prints messages to the console or logger. The
    &lt;trace-variables&gt; action is specially designed to trace all currently valid test variables to the console. 
    This was mainly used by us for debug reasons. The usage is quite simple:</p><pre class="programlisting">
  &lt;testcase name="traceVariablesTest"&gt;
      &lt;variables&gt;
          &lt;variable name="myVariable" value="12345"/&gt;
          &lt;variable name="nextVariable" value="54321"/&gt;
      &lt;/variables&gt;
      &lt;actions&gt;
          &lt;trace-variables&gt;
              &lt;variable name="myVariable"/&gt;
              &lt;variable name="nextVariable"/&gt;
          &lt;/trace-variables&gt;
          
          &lt;trace-variables/&gt;
      &lt;/actions&gt;
  &lt;/testcase&gt;
    </pre><p>Simply add the &lt;trace-variables&gt; action to your action chain and all variables will be printed out to
    the console. You are able to define a special set of variables by using the &lt;variable&gt; child
    elements. See the output that was generated by the test example above:</p><pre class="programlisting">
  Current value of variable myVariable = 12345
  Current value of variable nextVariable = 54321
    </pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-fail"></a>5.9.&nbsp;Failing the test</h2></div></div><div></div></div><p>The fail action will generate an exception in order to terminate the test case with error. The test case will
    therefore not be successful in the reports.</p><p>The user can specify a custom error message for the exception in order to describe the error cause. Here is a 
    very simple example to clarify the syntax:</p><pre class="programlisting">
  &lt;testcase name="failTest"&gt;
      &lt;actions&gt;
          &lt;fail message="Test will fail with custom message"/&gt;
      &lt;/actions&gt;
  &lt;/testcase&gt;
    </pre><p>Test results:</p><pre class="programlisting">
  Execution of test: failTest failed! Nested exception is: 
  com.consol.citrus.exceptions.TestSuiteException: Test will fail with custom message
  
  [...]
  
  TEST RESULTS coreTestSuite
  
  failTest          : failed - Exception is: Test will fail with custom message
  
  Found 1 test cases to execute
  Skipped 0 test cases (0.0%)
  Executed 1 test cases, containing 3 actions
  Tests failed:        1 (100.0%)
  Tests successfully:  0 (0.0%) 
    </pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-input"></a>5.10.&nbsp;Input</h2></div></div><div></div></div><p>During the test case execution it is possible to read some user input from the command line. The test execution will 
    stop and wait for keyboard inputs over the standard input stream. The user has to type the input and end it with the return 
    key.</p><p>The user input is stored to the respective variable value.</p><pre class="programlisting">
  &lt;testcase name="inputTest"&gt;
      &lt;variables&gt;
          &lt;variable name="userinput" value=""&gt;&lt;/variable&gt;
          &lt;variable name="userinput1" value=""&gt;&lt;/variable&gt;
          &lt;variable name="userinput2" value="y"&gt;&lt;/variable&gt;
          &lt;variable name="userinput3" value="yes"&gt;&lt;/variable&gt;
          &lt;variable name="userinput4" value=""&gt;&lt;/variable&gt;
      &lt;/variables&gt;
      &lt;actions&gt;
          &lt;input/&gt;
          &lt;echo&gt;&lt;message&gt;user input was: ${userinput}&lt;/message&gt;&lt;/echo&gt;
          
          &lt;input message="Now press enter:" variable="userinput1"/&gt;
          &lt;echo&gt;&lt;message&gt;user input was: ${userinput1}&lt;/message&gt;&lt;/echo&gt;
          
          &lt;input message="Do you want to continue?" 
                    valid-answers="y/n" variable="userinput2"/&gt;
          &lt;echo&gt;&lt;message&gt;user input was: ${userinput2}&lt;/message&gt;&lt;/echo&gt;
          
          &lt;input message="Do you want to continue?" 
                    valid-answers="yes/no" variable="userinput3"/&gt;
          &lt;echo&gt;&lt;message&gt;user input was: ${userinput3}&lt;/message&gt;&lt;/echo&gt;
          
          &lt;input variable="userinput4"/&gt;
          &lt;echo&gt;&lt;message&gt;user input was: ${userinput4}&lt;/message&gt;&lt;/echo&gt;
      &lt;/actions&gt;
  &lt;/testcase&gt;
    </pre><p>The input action has following attributes:</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p><span class="emphasis"><em>message</em></span> -&gt; message displayed to the user</p></li><li style="list-style-type: circle"><p><span class="emphasis"><em>valid-answers</em></span> -&gt; optional slash separated string containing the possible answers</p></li><li style="list-style-type: circle"><p><span class="emphasis"><em>variable</em></span> -&gt; destination variable to store the user input (default = ${userinput})</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>When user input is restrited to a set of valid answers the input validation of course can fail due to mismatch. 
        In this case the user is again asked to provide the input until a valid answer is given.</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>User inputs may not fit to automatic testing in terms of continuous integration testing where no user is present to 
        type in the correct answer over the keyboard. In this case you can always skip the user input in advance by specifying
        a variable that matches the user input variable name. As the user input variable is then already present the user 
        input is missed out and the test proceeds automatically.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-load"></a>5.11.&nbsp;Load</h2></div></div><div></div></div><p>You are able to load properties from external property files and store them as test variables. The action will
    require a file resource either from class path or file system in order to read the property values.</p><p>Let us look at an example to get an idea about this action:</p><p>Content of load.properties:</p><pre class="programlisting">
  username=Mickey Mouse
  greeting.text=Hello Test Framework
    </pre><pre class="programlisting">
  &lt;testcase name="loadPropertiesTest"&gt;
      &lt;actions&gt;
          &lt;load&gt;
              &lt;properties file="file:tests/resources/load.properties"/&gt;
          &lt;/load&gt;
          
          &lt;trace-variables/&gt;
      &lt;/actions&gt;
  &lt;/testcase&gt;
    </pre><p>Output:</p><pre class="programlisting">
  Current value of variable username = Mickey Mouse
  Current value of variable greeting.text = Hello Test Framework
    </pre><p>The action will load all available properties in the file load.properties and store them to the test case
    as local variables.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.png"></td><th align="left">Important</th></tr><tr><td colspan="2" align="left" valign="top"><p>Existing variables are overwritten!</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-purge"></a>5.12.&nbsp;Purging JMS destinations</h2></div></div><div></div></div><p>Purging JMS destinations during the test run is quite essential. Different test cases can influence each other when sending
    messages to the same JMS destinations. A test case should only receive those messages that actually belong to it. Therefore it is a 
    good idea to purge all JMS queue destinations between the test cases. Obsolete messages that are stuck in a JMS queue for some 
    reason are then removed so that the following test case is not offended.</p><p>So we need to purge some JMS queues in out test case. This can be done with following action definition:</p><pre class="programlisting">
  &lt;testcase name="purgeTest"&gt;
    &lt;actions&gt;
        &lt;purge-jms-queues&gt;
            &lt;queue name="Some.JMS.QUEUE.Name"/&gt;
            &lt;queue name="Another.JMS.QUEUE.Name"/&gt;
            &lt;queue name="My.JMS.QUEUE.Name"/&gt;
        &lt;/purge-jms-queues&gt;
        
        &lt;purge-jms-queues connection-factory="connectionFactory"&gt;
            &lt;queue name="Some.JMS.QUEUE.Name"/&gt;
            &lt;queue name="Another.JMS.QUEUE.Name"/&gt;
            &lt;queue name="My.JMS.QUEUE.Name"/&gt;
        &lt;/purge-jms-queues&gt;
    &lt;/actions&gt;
  &lt;/testcase&gt;
    </pre><p>Purging the JMS queues in every test case is quite exhausting because every test case needs to define a purging action at the 
    very beginning of the test. Fortunately the test suite definition offers tasks to run before, between and after the test cases which 
    should ease up this tasks a lot. The test suite offers a very simple way to purge the destinations between the tests. 
    See <a href="#testsuite-tasks" title="14.1.&nbsp;Tasks before, between and after the test run">Section&nbsp;14.1, &#8220;Tasks before, between and after the test run&#8221;</a> for more information about this.</p><p>When using the special tasks between a test case you might define a normal Spring bean definition that is referenced then. The 
    'com.consol.citrus.actions.PurgeJmsQueuesAction' action offers the property "queueNames" to hold all destination names 
    that are supposed to be purged. As you can see in the next example it is quite easy to specify a group of destinations in the Spring configuration.
    This purging bean is then added to the test suite in the tasks between section.</p><pre class="programlisting">
  &lt;bean id="purgeJmsQueues"
      class="com.consol.citrus.actions.PurgeJmsQueuesAction"&gt;
      &lt;property name="connectionFactory"&gt;
          &lt;ref bean="tibcoQueueConnectionFactory"/&gt;
      &lt;/property&gt;
      &lt;property name="queueNames"&gt;
          &lt;list&gt;
              &lt;value&gt;${jms.queue.hello.request.in}&lt;/value&gt;
              &lt;value&gt;${jms.queue.hello.response.out}&lt;/value&gt;
              &lt;value&gt;${jms.queue.echo.request}&lt;/value&gt;
              &lt;value&gt;${jms.queue.echo.response}&lt;/value&gt;
              &lt;value&gt;JMS.Queue.Dummy&lt;/value&gt;
          &lt;/list&gt;
      &lt;/property&gt;
  &lt;/bean&gt;
    </pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="actions-generic-action"></a>5.13.&nbsp;Including own actions</h2></div></div><div></div></div><p>The generic &lt;action&gt; element references Spring beans that implement the Java interface 
    <tt class="literal">com.consol.citrus.TestAction</tt>. This is a very fast way to add your own action 
    implementations to a test case. You can implement own actions in Java and include them into a test case.</p><pre class="programlisting">
  &lt;testcase name="actionReferenceTest"&gt;
      &lt;actions&gt;
          &lt;action reference="cleanUpDatabase"/&gt;
          &lt;action reference="mySpecialAction"/&gt;
      &lt;/actions&gt;
  &lt;/testcase&gt;
    </pre><p>In the example above the called actions are special database cleanup implementations. The actions are defined as Spring beans 
    in the Citrus configuration and get referenced by their bean name or id.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="templates"></a>Chapter&nbsp;6.&nbsp;Templates</h2></div></div><div></div></div><p>Templates group action sequences to a logical unit. You can think of templates as reusable components
    that are used in several tests. The maintenance is much more effective because the templates are referenced
    several times.</p><p>The template always has a unique name. Inside a test case we call the template by this unique name. 
    Have a look at a first example:</p><pre class="programlisting">
  &lt;template name="doCreateVariables"&gt;
      &lt;create-variables&gt;
          &lt;variable name="var" value="123456789"/&gt;
      &lt;/create-variables&gt;
      
      &lt;call-template name="doTraceVariables"/&gt;
  &lt;/template&gt;
  
  &lt;template name="doTraceVariables"&gt;
      &lt;echo&gt;
          &lt;message&gt;Current time is: ${time}&lt;/message&gt;
      &lt;/echo&gt;
      
      &lt;trace-variables/&gt;
  &lt;/template&gt;
    </pre><p>The code example above describes two template definitions. Templates hold a sequence of test 
    actions or call other templates themselves as seen in the example above.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>The &lt;call-template&gt; action calls other templates by their name. The called
      template not necessarily has to be located in the same test case XML file. The template might be defined in
      a separate XML file other than the test case itself:</p></td></tr></table></div><pre class="programlisting">
  &lt;testcase name="templateTest"&gt;
      &lt;variables&gt;
          &lt;variable name="myTime" value="citrus:currentDate()"/&gt;
      &lt;/variables&gt;
      &lt;actions&gt;
          &lt;call-template name="doCreateVariables"/&gt;
          
          &lt;call-template name="doTraceVariables"&gt;
              &lt;parameter name="time" value="${myTime}"&gt;
          &lt;/call-template&gt;
      &lt;/actions&gt;
  &lt;/testcase&gt;
    </pre><p>There is an open question when dealing with templates that are defined somewhere else outside the test case.
    How to handle variables? A templates may use different variable names then the test and vice versa. But all
    variables must be present with respective values as soon as the template gets called. Otherwise the variables 
    are unknown to the template and the test will raise errors.</p><p>So a first approach would be to harmonize variable usage accross templates and test cases, so that templates
    and test cases do use the same variable naming. But this approach might lead to high calibration effort. On the 
    other hand a template can handle parameters to solve this problem. When a template is called the calling actor has
    to set some parameters. Lets discuss an example for this issue.</p><p>The "doTraceVariables" template uses the variable ${time}. The test case must therefore have a variable
    called time too or declare the variable ${time} as a parameter when calling the template:</p><pre class="programlisting">
  &lt;call-template name="doTraceVariables"&gt;
      &lt;parameter name="time" value="${myTime}"&gt;
  &lt;/call-template&gt;
    </pre><p>The variable <span class="emphasis"><em>myTime</em></span> is translated - if you would call it like this - into the 
    desired <span class="emphasis"><em>time</em></span> parameter. So the template works fine referencing the time variable. This means
    that you always have to check the used variables inside a template when calling it. There might be a variable that
    is not declared yet inside your test. So you need to define this value as a parameter.</p></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="containers"></a>Chapter&nbsp;7.&nbsp;Containers</h2></div></div><div></div></div><p>Similar to templates a container element holds one to many test actions. In contrast to the
  template the container appears directly inside the test case action chain, meaning that the container 
  is not referenced by more than one test case.</p><p>Containers execute the embedded test actions in specific logic. This can be an execution in iteration
  for instance. Combine different containers with each other and you will be able to generate very powerful hierarchical
  structures in order to create a complex execution logic. In the following sections some predefined
  containers are described.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="containers-sequential"></a>7.1.&nbsp;Sequential</h2></div></div><div></div></div><p>The sequential container executes the embedded test actions in strict sequence. Readers now might search for 
    the difference to the normal action chain that is specified inside the test case. The actual power of sequential containers 
    does show only in combination with other containers like iterations and parallels. We will see this later when handling 
    these containers.</p><p>For now the sequential container seems very unspectacular - one might say boring - because it simply groups a pair of test
    actions to sequential execution.</p><pre class="programlisting">
  &lt;testcase name="sequentialTest"&gt;
      &lt;actions&gt;
          &lt;sequential&gt;
              &lt;trace-time/&gt;
              &lt;sleep/&gt;
              &lt;echo&gt;
                  &lt;message&gt;Hallo TestFramework&lt;/message&gt;
              &lt;/echo&gt;
              &lt;trace-time/&gt;
          &lt;/sequential&gt;
      &lt;/actions&gt;
  &lt;/testcase&gt;
    </pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="containers-parallel"></a>7.2.&nbsp;Parallel</h2></div></div><div></div></div><p>Parallel containers execute the embedded test actions concurrent to each other. Every
    action in this container will be executed in a separate Java Thread. Following example should
    clarify the usage:</p><pre class="programlisting">
  &lt;testcase name="parallelTest"&gt;
      &lt;actions&gt;
          &lt;parallel&gt;
              &lt;sleep/&gt;
              
              &lt;sequential&gt;
                  &lt;sleep/&gt;
                  &lt;echo&gt;
                      &lt;message&gt;1&lt;/message&gt;
                  &lt;/echo&gt;
              &lt;/sequential&gt;
              
              &lt;echo&gt;
                  &lt;message&gt;2&lt;/message&gt;
              &lt;/echo&gt;
              
              &lt;echo&gt;
                  &lt;message&gt;3&lt;/message&gt;
              &lt;/echo&gt;
              
              &lt;iterate condition="i lt= 5" 
                          index="i"&gt;
                  &lt;echo&gt;
                      &lt;message&gt;10&lt;/message&gt;
                  &lt;/echo&gt;
              &lt;/iterate&gt;
          &lt;/parallel&gt;
      &lt;/actions&gt;
  &lt;/testcase&gt;
    </pre><p>So the normal test action processing would be to execute one action after another. As the first 
    action is a sleep of five seconds, the whole test processing would stop and wait for 5 seconds. Things 
    are different inside the parallel container. Here the descending test actions will not wait but execute
    at the same time.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>Note that containers can easily wrap other containers. The example shows a simple combination of
      sequential and parallel containers that will archive a complex execution logic. Actions inside the sequential
      container will execute one after another. But actions in parallel will be executed at the same time.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="containers-iterate"></a>7.3.&nbsp;Iterate</h2></div></div><div></div></div><p>Iterations are very powerful elements when describing complex logic. The container executes the embedded actions 
    several times. The container will continue with looping as long as the defined breaking condition string evaluates to 
    <tt class="literal">true</tt>. In case the condition evaluates to <tt class="literal">false</tt> the iteration will break an finish execution.</p><pre class="programlisting">
  &lt;testcase name="iterateTest"&gt;
      &lt;actions&gt;
          &lt;iterate index="i" 
                      condition="i lt 5"&gt;
              &lt;echo&gt;
                  &lt;message&gt;index is: ${i}&lt;/message&gt;
              &lt;/echo&gt;
          &lt;/iterate&gt;
      &lt;/actions&gt;
  &lt;/testcase&gt;
    </pre><p>The attribute "index" automatically defines a new variable that holds the actual loop index 
    starting at "1". This index variable is available as a normal variable inside the iterate container. Therefore it is possible
    to print out the actual loop index in the echo action as shown in the above example.</p><p>The condition string is mandatory and describes the actual end of the loop. In iterate containers the loop
    will break in case the condition evaluates to <tt class="literal">false</tt>.</p><p>The condition string can be any Boolean expression and supports several operators:</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p>lt (lower than)</p></li><li style="list-style-type: circle"><p>lt= (lower than equals)</p></li><li style="list-style-type: circle"><p>gt (greater than)</p></li><li style="list-style-type: circle"><p>gt= (greater than equals)</p></li><li style="list-style-type: circle"><p>= (equals)</p></li><li style="list-style-type: circle"><p>and (logical combining of two Boolean values)</p></li><li style="list-style-type: circle"><p>or (logical combining of two Boolean values)</p></li><li style="list-style-type: circle"><p>() (brackets)</p></li></ul></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.png"></td><th align="left">Important</th></tr><tr><td colspan="2" align="left" valign="top"><p>It is very important to notice that the condition is evaluated before the very first iteration takes place. 
      The loop therefore can be executed 0-n times according to the condition value.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="containers-repeat"></a>7.4.&nbsp;Repeat until true</h2></div></div><div></div></div><p>Quite similar to the previously described iterate container this repeating container will execute its actions in
    a loop according to an ending condition. The condition describes a Boolean expression using
    the operators as described in the previous chapter.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.png"></td><th align="left">Important</th></tr><tr><td colspan="2" align="left" valign="top"><p>The loop continues its work until the provided condition evaluates to true. It is very important to notice that the
      repeat loop will execute the actions before evaluating the condition. This means the actions get executed
      1-n times.</p></td></tr></table></div><pre class="programlisting">
  &lt;testcase name="iterateTest"&gt;
      &lt;actions&gt;
          &lt;repeat-until-true index="i" 
                                condition="(i = 3) or (i = 5)"&gt;
              &lt;echo&gt;
                  &lt;message&gt;index is: ${i}&lt;/message&gt;
              &lt;/echo&gt;
          &lt;/repeat-until-true&gt;
      &lt;/actions&gt;
  &lt;/testcase&gt;
    </pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="containers-repeat-onerror"></a>7.5.&nbsp;Repeat on error until true</h2></div></div><div></div></div><p>The next looping container is called repeat-on-error-until-true. This container simply repeats group of actions 
    only in case one embedded action has failed with error. In case of such an error inside the container the loop will try 
    again to execute <tt class="literal">all</tt> embedded actions. The on-error execution takes place until one of the following conditions 
    evaluates to true:</p><p>1. All embedded actions were processed successfully</p><p>2. The ending condition evaluates to true</p><pre class="programlisting">
  &lt;testcase name="iterateTest"&gt;
      &lt;actions&gt;
          &lt;repeat-onerror-until-true index="i" 
                                        condition="i = 5"&gt;
              &lt;echo&gt;
                  &lt;message&gt;index is: ${i}&lt;/message&gt;
              &lt;/echo&gt;
              &lt;fail/&gt;
          &lt;/repeat-onerror-until-true&gt;
      &lt;/actions&gt;
  &lt;/testcase&gt;
    </pre><p>In the code example the error loop continues four times as the &lt;fail&gt; action definitely fails the test.
    During the fifth iteration The condition "i=5" evaluates to true and the loop breaks its processing.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>The overall success of the test case depends on the error situation inside the repeat-onerror-until-true container. In case 
        the loop breaks because of failing actions and the loop will discontinue its work the whole test case is failing too. The error loop
        processing is successful only in case all embedded actions were not raising any errors before in one iteration.</p></td></tr></table></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="finally"></a>Chapter&nbsp;8.&nbsp;Finally section</h2></div></div><div></div></div><p>This chapter deals with a special section inside the test case that is executed even in case errors
    did occur during the test. Lets say you have started a Jetty web server instance at the beginning of the 
    test case and you need to shutdown the server when the test has finished its work. Or as a second example
    imagine that you have prepared some data inside the database at the beginning of your test and 
    you want to make sure that the data is cleaned up at the end of the test case.</p><p>In both situations we might run into some problems when the test failed. 
    We face the problem that the whole test case will terminate immediately in case of errors. Cleanup tasks 
    at the end of the test action chain may not be executed correctly.</p><p>Dirty states inside the database or still running server instances then might cause problems for 
    upcoming test cases. To avoid this problems you should use the finally block of the test case. The &lt;finally&gt; 
    section contains actions that are executed even in case the test fails. Using this strategy the database 
    cleaning tasks mentioned before will find execution in every case (success or failure).</p><p>The following example shows how to use the finally section at the end of a test:</p><pre class="programlisting">
  &lt;testcase name="finallyTest"&gt;
      &lt;variables&gt;
          &lt;variable name="orderId" value="1"/&gt;
          &lt;variable name="date" 
                       value="citrus:currentDate('dd.MM.yyyy')"/&gt;
      &lt;/variables&gt;
      &lt;actions&gt;
          &lt;sql datasource="testDataSource"&gt;
              &lt;statement&gt;
                  INSERT INTO ORDERS VALUES (${orderId}, 1, 1, '${date}')
              &lt;/statement&gt;
          &lt;/sql&gt;
          
          &lt;echo&gt;
              &lt;message&gt;
                  ORDER creation time: ${date}
              &lt;/message&gt;
          &lt;/echo&gt;
      &lt;/actions&gt;
      &lt;finally&gt;
          &lt;sql datasource="testDataSource"&gt;
              &lt;statement&gt;DELETE FROM ORDERS WHERE ORDER_ID='${orderId}'&lt;/statement&gt;
          &lt;/sql&gt;
      &lt;/finally&gt;
  &lt;/testcase&gt;
    </pre><p>In the example the first action creates an entry in the database using an <tt class="literal">INSERT</tt> statement. 
    To be sure that the entry in the database is deleted after the test, the finally section contains the respective 
    <tt class="literal">DELETE</tt> statement that is always executed regardless the test case state (successful or failed).</p></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="xpath"></a>Chapter&nbsp;9.&nbsp;Using XPath</h2></div></div><div></div></div><p>Some time ago in this document we have seen how XML elements are manipulated using XPath expressions 
    when sending and receiving messages. Now using XPath might raise some problems regarding namespaces that we
    want to deal with now.</p><p>XPath is a very powerful technology for walking XML trees. This W3C standard stands for advanced
    XML tree handling using a special syntax as query language. The test framework supports this XPath
    syntax in the following fields:</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p>&lt;message&gt;&lt;element path="[XPath-Expression]"&gt;&lt;/message&gt;</p></li><li style="list-style-type: circle"><p>&lt;extract&gt;&lt;message path="[XPath-Expression]"&gt;&lt;/extract&gt;</p></li><li style="list-style-type: circle"><p>&lt;ignore path="[XPath-Expression]"/&gt;</p></li><li style="list-style-type: circle"><p>&lt;validate path="[XPath-Expression]"/&gt;</p></li></ul></div><p>The next program listing indicates the power in using XPath with Citrus:</p><pre class="programlisting">
  &lt;message&gt;
      &lt;validate path="//element/elementA" 
                   value="text"&gt;&lt;/validate&gt;
      &lt;validate path="//element/elementA[@attr='A']" 
                   value="text"&gt;&lt;/validate&gt;
      &lt;validate path ="//element/elementB" 
                   value="%elementValue"&gt;&lt;/validate&gt;
      &lt;validate path ="//element/elementB/@attribute" 
                   value="%attributeValue"&gt;&lt;/validate&gt;
      &lt;validate path ="/root/element" 
                   value="namespace"&gt;&lt;/validate&gt;
      &lt;validate path ="/root/element" 
                   value="namespace"&gt;&lt;/validate&gt;
      &lt;validate path ="//*[.='search-for']" 
                   value="search-for"&gt;&lt;/validate&gt;
  &lt;/message&gt;
    </pre><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xpath-namespace"></a>9.1.&nbsp;Handling XML namespaces</h2></div></div><div></div></div><p>When it comes to XML namespaces you have to be careful with your XPath expressions. Lets have a look at an example
        message that uses XML namespaces:</p><pre class="programlisting">
  &lt;ns1:RequestMessage xmlns:ns1="http://testsuite/default"&gt;
      &lt;ns1:MessageHeader&gt;
          &lt;ns1:CorrelationId&gt;_&lt;/ns1:CorrelationId&gt;
          &lt;ns1:Timestamp&gt;2001-12-17T09:30:47.0Z&lt;/ns1:Timestamp&gt;
          &lt;ns1:RequestTag&gt;_&lt;/ns1:RequestTag&gt;
          &lt;ns1:VersionId&gt;2&lt;/ns1:VersionId&gt;
      &lt;/ns1:MessageHeader&gt;
      &lt;ns1:MessageBody&gt;
          &lt;ns1:Customer&gt;
              &lt;ns1:Id&gt;1&lt;/ns1:Id&gt;
          &lt;/ns1:Customer&gt;
      &lt;/ns1:MessageBody&gt;
  &lt;/ns1:RequestMessage&gt;
        </pre><p>Now we would like to validate some elements in this message using XPath</p><pre class="programlisting">
  &lt;message&gt;
      &lt;validate path="//RequestMessage/MessageHeader/RequestTag" 
                   value="${requestTag}"/&gt;
      &lt;validate path="//RequestMessage/MessageHeader/CorrelationId" 
                   value="${correlationId}"/&gt;
  &lt;/message&gt;
        </pre><p>The validation will fail although the XPath expression looks correct regarding the XML tree. Because the message 
        uses the namespace <tt class="literal">xmlns:ns1="http://testsuite/default"</tt> with its prefix <tt class="literal">ns1</tt>
        our XPath expression is not able to find the elements. The correct XPath expression uses the namespace prefix as defined 
        in the message.</p><pre class="programlisting">
  &lt;message&gt;
      &lt;validate path="//ns1:RequestMessage/ns1:MessageHeader/ns1:RequestTag" 
                   value="${requestTag}"/&gt;
      &lt;validate path="//ns1:RequestMessage/ns1:MessageHeader/ns1:CorrelationId" 
                   value="${correlationId}"/&gt;
  &lt;/message&gt;
        </pre><p>Now the expressions work fine and the validation is successful. But this is quite error prone. This is because the test is now 
        depending on the namespace prefix that is used by some application. As soon as the message is sent with a different namespace prefix (e.g.
        ns2) the validation will fail again.</p><p>You can avoid this effect when specifying your own namespace context and your own namespace prefix during validation.</p><pre class="programlisting">
  &lt;message&gt;
      &lt;validate path="//pfx:RequestMessage/pfx:MessageHeader/pfx:RequestTag" 
                   value="${requestTag}"/&gt;
      &lt;validate path="//pfx:RequestMessage/pfx:MessageHeader/pfx:CorrelationId" 
                   value="${correlationId}"/&gt;
      &lt;namespace prefix="pfx" 
                    value="http://testsuite/default"/&gt;
  &lt;/message&gt;
        </pre><p>Now the test in independent from any namespace prefix in the received message. The namespace context will resolve the namespaces and
        find the elements although the message might use different prefixes. The only thing that matters is that the namespace value 
        (http://testsuite/default) matches.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xpath-default-namespaces"></a>9.2.&nbsp;Handling default namespaces</h2></div></div><div></div></div><p>In the previous section we have seen that XML namespaces can get tricky with XPath validation. Default namespaces can do 
        even more! So lets look at the example with default namespaces:</p><pre class="programlisting">
&lt;RequestMessage xmlns="http://testsuite/default"&gt;
    &lt;MessageHeader&gt;
        &lt;CorrelationId&gt;_&lt;/CorrelationId&gt;
        &lt;Timestamp&gt;2001-12-17T09:30:47.0Z&lt;/Timestamp&gt;
        &lt;RequestTag&gt;_&lt;/RequestTag&gt;
        &lt;VersionId&gt;2&lt;/VersionId&gt;
    &lt;/MessageHeader&gt;
    &lt;MessageBody&gt;
        &lt;Customer&gt;
            &lt;Id&gt;1&lt;/Id&gt;
        &lt;/Customer&gt;
    &lt;/MessageBody&gt;
&lt;/RequestMessage&gt;
        </pre><p>The message uses default namespaces. The following approach in XPath will fail due to namespace problems.</p><pre class="programlisting">
&lt;message&gt;
    &lt;validate path="//RequestMessage/MessageHeader/RequestTag" 
                 value="${requestTag}"/&gt;
    &lt;validate path="//RequestMessage/MessageHeader/CorrelationId" 
                 value="${correlationId}"/&gt;
&lt;/message&gt;
        </pre><p>Even default namespaces need to be specified in the XPath expressions. Look at the following code listing that
        works fine with default namespaces:</p><pre class="programlisting">
&lt;message&gt;
    &lt;validate path="//:RequestMessage/:MessageHeader/:RequestTag" 
                 value="${requestTag}"/&gt;
    &lt;validate path="//:RequestMessage/:MessageHeader/:CorrelationId" 
                 value="${correlationId}"/&gt;
&lt;/message&gt;
        </pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.png"></td><th align="left">Tip</th></tr><tr><td colspan="2" align="left" valign="top"><p>It is recommended to use the namespace context as described in the previous chapter when validating. Only this approach
            ensures flexibility and stable test cases regarding namespace changes.</p></td></tr></table></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="jms"></a>Chapter&nbsp;10.&nbsp;Connecting with JMS</h2></div></div><div></div></div><p>Citrus provides support for sending and receiving JMS messages. We have to seperate between synchronous and asynchronous
    communication. So in this chapter we explain how to setup JMS message senders and receivers for synchronous and asynchronous
    outbound and inbound communication</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>Citrus provides a "citrus" configuration namespace and schema definition. Include this namespace into your Spring 
        configuration in order to use the Citrus configuration elements. The namespace URI and schema location are added to the 
        Spring configuration XML file as follows.</p><pre class="programlisting">
  &lt;beans xmlns="http://www.springframework.org/schema/beans"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xmlns:citrus="http://www.citrusframework.org/schema/config"
         xsi:schemaLocation="
         http://www.springframework.org/schema/beans 
         http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
         http://www.citrusframework.org/schema/config 
         http://www.citrusframework.org/schema/config/citrus-config.xsd"&gt;
         
      [...]
      
  &lt;/beans&gt;
        </pre><p>After that you are able to use customized Citrus XML elements in order to define the Spring beans.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jms-sender"></a>10.1.&nbsp;JMS message sender</h2></div></div><div></div></div><p>First of all we deal with asynchronous message senders, which means that Citrus is publishing messages to a JMS destination
        (queue or topic). The test case itself does not know about JMS tranport details like queue names or connection 
        credentials. This information is stored in the basic Spring configuration. So let us have a look at a simple JMS message sender 
        configuration in Citrus.</p><pre class="programlisting">
  &lt;bean id="connectionFactory" 
           class="org.apache.activemq.ActiveMQConnectionFactory"&gt;
      &lt;property name="brokerURL" 
                   value="tcp://localhost:61616" /&gt;
  &lt;/bean&gt;
  
  &lt;citrus:jms-message-sender id="getOrdersRequestSender" 
                                destination-name="Citrus.JMS.Order.Queue.Out"/&gt;
        </pre><p>The JMS connection factory is responsible for connecting to a JMS message broker. In this example we use the Apache ActiveMQ 
        connection factory implementation as we use a ActiveMQ message broker.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.png"></td><th align="left">Tip</th></tr><tr><td colspan="2" align="left" valign="top"><p>Spring makes it very easy to connect to other JMS broker implementations too (e.g. TIBCO Enterprise Messaging Service, 
            IBM Websphere MQ). Just substitute the implementing class in the connectionFactory bean.</p></td></tr></table></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>All of the JMS senders and receivers that require a reference to a JMS connection factory will automatically look for a bean 
            named "connectionFactory" by default. That is why you don't see a "connection-factory" attribute in many of the examples. 
            However, you can use the "connection-factory" attribute in order to use other connection factory instances with different bean 
            names.</p><pre class="programlisting">
  &lt;citrus:jms-message-sender id="getOrdersRequestSender" 
                                destination-name="Citrus.JMS.Order.Queue.Out"
                                connection-factory="myConnectionFacotry"/&gt;
              </pre><p>Alternatively you may want to directly specify a Spring jmsTemplate.</p><pre class="programlisting">
  &lt;citrus:jms-message-sender id="getOrdersRequestSender" 
                                destination-name="Citrus.JMS.Order.Queue.Out"
                                jms-template="myJmsTemplate"/&gt;
            </pre></td></tr></table></div></div><p>The message sender is now ready for usage inside a test. Many sending actions and test cases reference the message sender. The 
    message sender will simply publish the message to the defined JMS destination. The communication is supposed to be asynchronous, which
    means that the sender will not wait for a synchronous response. The sender fires and forgets the message immediately.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jms-receiver"></a>10.2.&nbsp;JMS message receiver</h2></div></div><div></div></div><p>Now lets deal with receiving an async message over JMS. The message receiver definition is located again in the Spring 
        configuration files. We assume that a connection factory has been configured as shown in the previous section.</p><pre class="programlisting">
  &lt;citrus:jms-message-receiver id="getOrdersResponseReceiver" 
                                  destination-name="Citrus.JMS.Order.Queue.In"/&gt;
        </pre><p> The receiver acts as a message driven listener. This means that the message receiver connects to the given destination 
        and waits for messages to arrive.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>Besides the destination-name attribute you can also provide a reference to a Destination implementation.</p><pre class="programlisting">
  &lt;citrus:jms-message-receiver id="getOrdersResponseReceiver" 
                                  destination="orderInboundQueue"/&gt;
            </pre><p>This destination reference applies to all JMS aware message sender and receiver implementations.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jms-sync-sender"></a>10.3.&nbsp;JMS synchronous message sender</h2></div></div><div></div></div><p>When using synchronous message senders Citrus will define a reply-to-queue destination in the message header and wait 
        synchronously for the response on this destination.</p><pre class="programlisting">
  &lt;citrus:jms-sync-message-sender id="getCustomerRequestSender" 
                              destination-name="Citrus.JMS.Customer.Queue.Out"
                              reply-handler="getCustomerReplyHandler"
                              reply-timeout="1000"/&gt;
                              
  &lt;citrus:jms-reply-message-handler id="getCustomerReplyHandler"/&gt;      
        </pre><p>To build synchronous outbound communication we need both a synchronous message sender and a reply handler. Both are defined
        in the Spring configuration. The sender sends the message and waits for the response synchronously. Once the reply has arrived the 
        reply handler is invoked with the respective reply message. The second possibility would be a timeout while receiving the reply.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>The message sender creates a temporary JMS reply destination by default in order to receive the reply. The temporary 
            destination name is stored to the JMS replyTo message header. You can also define a static reply destination like follows.</p><pre class="programlisting">
  &lt;citrus:jms-sync-message-sender id="getCustomerRequestSender" 
                              destination-name="Citrus.JMS.Customer.Queue.Out"
                              reply-destination-name="Citrus.JMS.Customer.Queue.Reply"
                              reply-handler="getCustomerReplyHandler"
                              reply-timeout="1000"/&gt;
            </pre><p>Instead of using the <span class="emphasis"><em>reply-destination-name</em></span> feel free to use the destination reference
            <span class="emphasis"><em>reply-destination</em></span></p></td></tr></table></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.png"></td><th align="left">Important</th></tr><tr><td colspan="2" align="left" valign="top"><p>Be aware of permissions that are mandatory for creating temporary destinations. Citrus tries to create temporary queues
          on the JMS message broker. Following from that the Citrus JMS user has to have the permission to do so. 
          Be sure that the user has the sufficient rights when using temporary reply destinations.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jms-sync-receiver"></a>10.4.&nbsp;JMS synchronous message receiver</h2></div></div><div></div></div><p>What is missing is the situation that Citrus receives a JMS message where a temporary reply destination is set.
        When dealing with synchronous JMS communication the requestor will store a dynamic JMS queue destination into the JMS 
        header in order to receive the synchronous answer on this dynamic destination. So Citrus has to send the reply to the 
        temporary destination, which is dynamic of course. You can handle this with the synchronous message receiver in combination 
        with a reply sender.</p><pre class="programlisting">
  &lt;citrus:jms-sync-message-receiver id="getOrderRequestReceiver" 
                                       destination-name="Citrus.JMS.Order.Queue.In"/&gt;
                                       
  &lt;citrus:jms-reply-message-sender id="getOrderReplySender"
                                      reply-destination-holder="getOrderRequestReceiver"/&gt;
        </pre><p>In first sight the synchronous message receiver has no difference to a normal receiver, but the difference comes in
        combination with a synchronous reply sender. The reply sender need to know the dynamic reply destination, so it desires a
        reference to a reply-destination-holder, which is our jms-sync-message-receiver.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="http"></a>Chapter&nbsp;11.&nbsp;Http Support</h2></div></div><div></div></div><p>Citrus is able to connect with Http services and simulate Http servers. In the next sections you will learn
    how to invoke services using Http messaging. And you will see how to accept client requests and provide proper Http 
    responses.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>Similar to the JMS specific configuration schema, Citrus provides a customized Http configuration schema that
        is used in Spring configuration files. Simply include the http-config namespace in the confguration XML as follows.</p><pre class="programlisting">
  &lt;beans xmlns="http://www.springframework.org/schema/beans"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xmlns:citrus="http://www.citrusframework.org/schema/config"
         xmlns:citrus-http="http://www.citrusframework.org/schema/http/config"
         xsi:schemaLocation="
         http://www.springframework.org/schema/beans 
         http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
         http://www.citrusframework.org/schema/config 
         http://www.citrusframework.org/schema/config/citrus-config.xsd
         http://www.citrusframework.org/schema/http/config 
         http://www.citrusframework.org/schema/http/config/citrus-http-config.xsd"&gt;
         
      [...]
      
  &lt;/beans&gt;
        </pre><p>Now you are ready to use the customized http configuration elements using the 
        citrus-http namespace prefix.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="http-sender"></a>11.1.&nbsp;Http message sender</h2></div></div><div></div></div><p>Citrus can invoke any Http service and wait for the response. After that the response goes 
        through the validation process as usual. Let us see how a message sender for Http works:</p><pre class="programlisting">
  &lt;citrus-http:message-sender id="httpMessageSender" 
                                 request-url="http://localhost:8090/test" 
                                 request-method="POST"
                                 reply-handler="httpResponseHandler"/&gt;
  
  &lt;citrus-http:reply-message-handler id="httpResponseHandler"/&gt;
        </pre><p>As Http communication is always synchronous we need a reply message handler besides the http message-sender. It is not
        very surprising that the sender also needs the <span class="emphasis"><em>request-url</em></span> and a <span class="emphasis"><em>request-method</em></span>. The sender
        will build a Http request and send it to the Http endpoint. The Http response is then provided to the reply handler.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="http-server"></a>11.2.&nbsp;Http server</h2></div></div><div></div></div><p>Sending Http messages was quite easy and straight forward. Receiving Http messages is more complicated, because Citrus 
        has to provide a Http server that is listening on a port for client connections. Once a client connection 
        is accepted the Http server must also provide a proper Http response to the client. Citrus ships with an embedded Http server 
        implementation that listens on a port for client connections.</p><pre class="programlisting">
  &lt;citrus-http:server id="simpleHttpServer" 
                         port="8090" 
                         uri="/test" 
                         deamon="false" 
                         message-handler="emptyResponseProducingMessageHandler"
                         auto-start="true"/&gt;
                         
  &lt;bean id="emptyResponseProducingMessageHandler" 
           class="com.consol.citrus.http.handler.EmptyResponseProducingMessageHandler"/&gt;
        </pre><p>The Http server implementation in the example will automatically startup on application loading and will listen on
        the URL <tt class="literal">'http://localhost:8090/test'</tt> for requests. What also is very important is the message handler definition.
        Once a client request was accepted the message handler is responsible for generating a proper response to the client.</p><p>Citrus provides several message handler implementations. Let's have a look at them in the following sections.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="http-message-handler-empty"></a>11.2.1.&nbsp;Empty response producing message handler</h3></div></div><div></div></div><p>This is the simplest message handler you can think of. It simply provides an empty success response using the Http
            reponse code 202. In the introducing example this message handler was used to provide reponse messages to the calling client.
            The handler does not need any configurations or properties as it simply responds with an empty Http response.</p><pre class="programlisting">
  &lt;bean id="emptyResponseProducingMessageHandler" 
           class="com.consol.citrus.http.handler.EmptyResponseProducingMessageHandler"/&gt;
            </pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="http-message-handler-static"></a>11.2.2.&nbsp;Static response producing message handler</h3></div></div><div></div></div><p>The next more complex message handler will always return a static response message</p><pre class="programlisting">
  &lt;bean class="com.consol.citrus.adapter.handler.StaticResponseProducingMessageHandler"&gt;
      &lt;property name="messagePayload"&gt;
          &lt;value&gt;
          &lt;![CDATA[
              &lt;ns0:Response xmlns:ns0="http://www.consol.de/schemas/samples/sample.xsd"&gt;
                  &lt;ns0:MessageId&gt;123456789&lt;/ns0:MessageId&gt;
                  &lt;ns0:CorrelationId&gt;CORR123456789&lt;/ns0:CorrelationId&gt;
                  &lt;ns0:Text&gt;Hello User&lt;/ns0:Text&gt;
              &lt;/ns0:Response&gt;
          ]]&gt;
          &lt;/value&gt;
      &lt;/property&gt;
      &lt;property name="messageHeader"&gt;
          &lt;map&gt;
              &lt;entry key="{http://www.consol.de/schemas/samples/sample.xsd}ns0:Operation" 
                        value="sayHelloResponse"/&gt;
              &lt;entry key="{http://www.consol.de/schemas/samples/sample.xsd}ns0:Request" 
                        value="HelloRequest"/&gt;
          &lt;/map&gt;
      &lt;/property&gt;
  &lt;/bean&gt;
            </pre><p>The handler is configured with a static message payload and static response header values. The response to the client
            is therefore always identical.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="http-message-handler-xpath"></a>11.2.3.&nbsp;Xpath dispatching message handler</h3></div></div><div></div></div><p>The idea behind the xpath-dispatching-message-handler is that the incoming requests are dispathed to several
            message handlers according to an element value inside the message payload. The XPath expression will evaluate and
            call the respective message handler. The message handler mapping is done by their names inside a message handler Spring
            configuration context. The seperate context is loaded in advance.</p><pre class="programlisting">
  &lt;bean id="xpathDispatchingHandler" class="com.consol.citrus.http.handler.XpathDispatchingMessageHandler"&gt;
      &lt;property name="xpathMappingExpression" 
                   value="//MessageBody/Operation"/&gt;
      &lt;property name="messageHandlerContext" 
                   value="message-handler-context.xml"/&gt;
  &lt;/bean&gt;
            </pre><p>The handler receives a XPath mapping expression as well as a Spring ApllicationContext file resource. The message handlers
            are mapped to the different values via their names. For instance a incoming request with 
            <tt class="literal">//MessageBody/Operation = "getOrders"</tt> is handled by the message handler named "getOrders". The available message handlers
            are configured in the message-handler-context (e.g. EmptyResponseProducingMessageHandler, StaticResponseProducingMessageHandler, ...).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="http-message-handler-jms"></a>11.2.4.&nbsp;JMS connecting message handler</h3></div></div><div></div></div><p>The most powerful message handler is the JMS connecting message handler. Indeed this handler also provides the most 
            flexibility. This handler will forward incoming request to a JMS destination and waiting for a proper response on a reply destination. 
            A configured JMS message receiver can read this forwarded request internally over JMS and provide a proper response on the 
            reply destination.</p><pre class="programlisting">
  &lt;bean id="jmsForwardingMessageHandler" 
           class="com.consol.citrus.http.handler.JmsConnectingMessageHandler"&gt;
      &lt;property name="destinationName" value="JMS.Queue.Requests.In"/&gt;
      &lt;property name="replyDestinationName" 
                   value="JMS.Queue.Response.Out"/&gt;
      &lt;property name="connectionFactory"&gt;
          &lt;bean class="org.apache.activemq.ActiveMQConnectionFactory"&gt;
              &lt;property name="brokerURL" 
                           value="tcp://localhost:61616" /&gt;
          &lt;/bean&gt;
      &lt;/property&gt;
      &lt;property name="replyTimeout" value="2000"/&gt;
  &lt;/bean&gt;
            </pre><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.png"></td><th align="left">Tip</th></tr><tr><td colspan="2" align="left" valign="top"><p>The samples section may help you get in touch with the http configuration and the JMS forwarding stategy 
                (<a href="#samples" title="Appendix&nbsp;A.&nbsp;Citrus samples">Appendix&nbsp;A, <i>Citrus samples</i></a>)</p></td></tr></table></div></div></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="soap-webservices"></a>Chapter&nbsp;12.&nbsp;SOAP WebServices</h2></div></div><div></div></div><p>In case you need to connect to a SOAP WebService you can use the built-in WebServices support in Citrus. Similar
    to the Http support Citrus is able to send and receive SOAP messages during a test.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>In order to use the SOAP WebService support you need to include the specific XML configuration schema provided by Citrus.
        See following XML definition to find out how to include the citrus-ws namespace.</p><pre class="programlisting">
  &lt;beans xmlns="http://www.springframework.org/schema/beans"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xmlns:citrus="http://www.citrusframework.org/schema/config"
         xmlns:citrus-ws="http://www.citrusframework.org/schema/ws/config"
         xsi:schemaLocation="
         http://www.springframework.org/schema/beans 
         http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
         http://www.citrusframework.org/schema/config 
         http://www.citrusframework.org/schema/config/citrus-config.xsd
         http://www.citrusframework.org/schema/ws/config 
         http://www.citrusframework.org/schema/ws/config/citrus-ws-config.xsd"&gt;
         
      [...]
      
  &lt;/beans&gt;
        </pre><p>Now you are ready to use the customized WebService configuration elements - all using the citrus-ws prefix - 
        in your Spring configuration.</p></td></tr></table></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="soap-sender"></a>12.1.&nbsp;SOAP message sender</h2></div></div><div></div></div><p>Citrus can call any SOAP WebService and validate its response message. Let us see how a message sender for SOAP 
        WebServices looks like in the Spring configuration:</p><pre class="programlisting">
  &lt;citrus-ws:message-sender id="soapMessageSender" 
                                 request-url="http://localhost:8090/test" 
                                 reply-handler="soapResponseHandler"/&gt;
  
  &lt;citrus-ws:reply-message-handler id="soapResponseHandler"/&gt;
        </pre><p>SOAP WebServices always use synchronous communication, so we need a reply message handler. The message sender 
        uses the <span class="emphasis"><em>request-url</em></span> and and calls the WebService. The sender
        will automatically build a SOAP request message including a SOAP header and the message payload as SOAP body. 
        As the WebService response arrives it is passed to the given reply handler.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="soap-server"></a>12.2.&nbsp;Receiving SOAP messages</h2></div></div><div></div></div><p>Receiving SOAP messages requires a web server instance listening on a port. Citrus is using an embedded Jetty 
        server instance in combination with the Spring WebService project in order to accept SOAP request calls. See how the 
        Jetty server is configured in the Spring configuration.</p><pre class="programlisting">
  &lt;citrus-ws:jetty-server id="simpleJettyServer" 
                         port="8091" 
                         auto-start="true"
                         context-config-location="classpath:citrus-ws-servlet.xml"
                         resource-base="src/it/resources"/&gt;
        </pre><p>The Jetty server is able to startup automatically during application startup. In the example above the Server is
        listening on the port <tt class="literal">8091</tt> for SOAP requests. The context-config-location attribute defines a further Spring
        application context. In this application context the request mapping is configured. See the example below.</p><pre class="programlisting">
  &lt;beans xmlns="http://www.springframework.org/schema/beans" 
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="
         http://www.springframework.org/schema/beans 
         http://www.springframework.org/schema/beans/spring-beans-2.5.xsd"&gt;
      
      &lt;bean id="loggingInterceptor" 
               class="org.springframework.ws.server.endpoint.interceptor.PayloadLoggingInterceptor"&gt;
          &lt;description&gt;
              This interceptor logs the message payload.
          &lt;/description&gt;
      &lt;/bean&gt;
      
      &lt;bean id="helloServicePayloadMapping" 
               class="org.springframework.ws.server.endpoint.mapping.PayloadRootQNameEndpointMapping"&gt;
          &lt;property name="mappings"&gt;
              &lt;props&gt;
                  &lt;prop key="{http://www.consol.de/schemas/samples/sayHello.xsd}HelloStandaloneRequest"&gt;
                      helloServiceEndpoint
                  &lt;/prop&gt;
              &lt;/props&gt;
          &lt;/property&gt;
          &lt;property name="interceptors"&gt;
              &lt;list&gt;
                  &lt;ref bean="loggingInterceptor"/&gt;
              &lt;/list&gt;
          &lt;/property&gt;
      &lt;/bean&gt;
      
      &lt;bean id="helloServiceEndpoint" 
               class="com.consol.citrus.ws.WebServiceEndpoint"&gt;
          &lt;property name="messageHandler"&gt;
            &lt;bean class="com.consol.citrus.adapter.handler.StaticResponseProducingMessageHandler"&gt;
                &lt;property name="messagePayload"&gt;
                    &lt;value&gt;
                    &lt;![CDATA[
                        &lt;ns0:HelloStandaloneResponse 
                            xmlns:ns0="http://www.consol.de/schemas/samples/sayHello.xsd"&gt;
                            &lt;ns0:MessageId&gt;123456789&lt;/ns0:MessageId&gt;
                            &lt;ns0:CorrelationId&gt;CORR123456789&lt;/ns0:CorrelationId&gt;
                            &lt;ns0:User&gt;WebServer&lt;/ns0:User&gt;
                            &lt;ns0:Text&gt;Hello User&lt;/ns0:Text&gt;
                        &lt;/ns0:HelloStandaloneResponse&gt;
                    ]]&gt;
                    &lt;/value&gt;
                &lt;/property&gt;
                &lt;property name="messageHeader"&gt;
                    &lt;map&gt;
                        &lt;entry key="{http://www.consol.de/schemas/samples/sayHello.xsd}ns0:Operation" 
                                  value="sayHelloResponse"/&gt;
                        &lt;entry key="{http://www.consol.de/schemas/samples/sayHello.xsd}ns0:Request" 
                                  value="HelloRequest"/&gt;
                        &lt;entry key="{http://www.consol.de/schemas/samples/sayHello.xsd}ns0:SOAPAction" 
                                  value="sayHello"/&gt;
                    &lt;/map&gt;
                &lt;/property&gt;
            &lt;/bean&gt;
          &lt;/property&gt;
      &lt;/bean&gt;
  &lt;/beans&gt;
        </pre><p>The programlisting above describes a normal request mapping. The mapping is responsible to forward incoming requests to
        an endpoint which will handle the request and provide a response. First of all Spring's logging interceptor is added to the 
        context. Then we use a payload mapping (PayloadRootQNameEndpointMapping) in order to map all incoming 
        <tt class="literal">'HelloStandaloneRequest'</tt> SOAP messages to the <tt class="literal">'helloServiceEndpoint'</tt>. The enpoint definition
        follows at the very end of the programlisting. Inside the endpoint configuration we can see the well known message handler that 
        is responsible for providing a proper response message for the client. The various message handlers in Citrus were already 
        described in <a href="#http" title="Chapter&nbsp;11.&nbsp;Http Support">Chapter&nbsp;11, <i>Http Support</i></a>.</p><p>In this example the <tt class="literal">'helloServiceEndpoint'</tt> uses the <tt class="literal">'StaticResponseProducingMessageHandler'</tt>
        which is always returning a static response message. The endpoint transforms the static response into a 
        proper SOAP message that is sent back to the calling client as SOAP response. You can add as many request mappings and endpoints
        as you want to the server context configuration. So you are able to handle different request types with one single Jetty server
        instance.</p><p>Have a look at the <a href="#http" title="Chapter&nbsp;11.&nbsp;Http Support">Chapter&nbsp;11, <i>Http Support</i></a> in order to find out how the other available message handler work.</p><p>That's it for connecting with SOAP WebServices! We saw how to send and receive SOAP messages with Jetty and 
        Spring WebServices. Have a look at the samples coming with your Citrus archive in order to learn more about the SOAP message handlers.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="functions"></a>Chapter&nbsp;13.&nbsp;Functions</h2></div></div><div></div></div><p>The test framework will offer several functions that are useful throughout the test execution. The
    functions will always return a string value that is ready for use as variable value or directly inside a text
    message.</p><p>A set of functions is usually combined to a function library. The library has a prefix that will identify
    the functions inside the test case. The default test framework function library uses a default prefix (citrus).
    You can write your own function library using your own prefix in order to extend the test framework
    functionality whenever you want.</p><p>The library is built in the Spring configuration and contains a set of functions that are of
    public use.</p><pre class="programlisting">
  &lt;bean id="testFrameworkFunctionLibrary" 
           class="com.consol.citrus.functions.FunctionLibrary"&gt;
      &lt;property name="name" value="testFrameworkFunctionLibrary"/&gt;
      &lt;property name="prefix" value="citrus:"/&gt;
      &lt;property name="members"&gt;
          &lt;map&gt;
            &lt;entry key="randomNumber"&gt;
                &lt;bean class="com.consol.citrus.functions.RandomNumberFunction"/&gt;
            &lt;/entry&gt;
            &lt;entry key="randomString"&gt;
                &lt;bean class="com.consol.citrus.functions.RandomStringFunction"/&gt;
            &lt;/entry&gt;
            ...
          &lt;/map&gt;
      &lt;/property&gt;
  &lt;/bean&gt;
    </pre><p>In the next chapters the default functions offered by the framework will be described in detail.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-concat"></a>13.1.&nbsp;citrus:concat()</h2></div></div><div></div></div><p>The function will combine several string tokens to a single string value. This means that you can combine
        a static text value with a variable value for instance. A first example should clarify the usage:</p><pre class="programlisting">
  &lt;testcase name="concatFunctionTest"&gt;
      &lt;variables&gt;
          &lt;variable name="date" 
                       value="citrus:currentDate(yyyy-MM-dd)" /&gt;
          &lt;variable name="text" 
                       value="Hallo Test Framework!" /&gt;
      &lt;/variables&gt;
      &lt;actions&gt;
          &lt;echo&gt;
              &lt;message&gt;
                  citrus:concat('Today is: ', ${date}, ' right!?')
              &lt;/message&gt;
          &lt;/echo&gt;
          &lt;echo&gt;
              &lt;message&gt;
                  citrus:concat('Text is: ', ${text})
              &lt;/message&gt;
          &lt;/echo&gt;
      &lt;/actions&gt;
  &lt;/testcase&gt;
        </pre><p>Please do not forget to mark static text with single quote signs. There is no limitation for string tokens to
        be combined.</p><p><tt class="literal">citrus:concat('Text1', 'Text2', 'Text3', ${text}, 'Text5', &#8230; , 'TextN')</tt></p><p>The function can be used wherever variables can be used. For instance when validating XML elements in
        the receive action.</p><pre class="programlisting">
  &lt;message&gt;
      &lt;validate path="//element/element" 
                   value="citrus:concat('Cx1x', ${generatedId})"/&gt;
  &lt;/message&gt;
        </pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-substring"></a>13.2.&nbsp;citrus:substring()</h2></div></div><div></div></div><p>The function will have three parameters.</p><p>1. String to work on</p><p>2. Starting index</p><p>3. End index (optional)</p><p>Let us have a look at a simple example for this function:</p><pre class="programlisting">
  &lt;echo&gt;
      &lt;message&gt;
          citrus:substring('Hallo Test Framework', 6)
      &lt;/message&gt;
  &lt;/echo&gt;
  &lt;echo&gt;
      &lt;message&gt;
          citrus:substring('Hallo Test Framework', 0, 5)
      &lt;/message&gt;
  &lt;/echo&gt;
        </pre><p>Function output:</p><p><span class="emphasis"><em>Test Framework</em></span></p><p><span class="emphasis"><em>Hallo</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-string-length"></a>13.3.&nbsp;citrus:stringLength()</h2></div></div><div></div></div><p>The function will calculate the number of characters in a string representation and return the number.</p><pre class="programlisting">
  &lt;echo&gt;
      &lt;message&gt;citrus:stringLength('Hallo Test Framework')&lt;/message&gt;
  &lt;/echo&gt;
        </pre><p>Function output:</p><p><span class="emphasis"><em>20</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-translate"></a>13.4.&nbsp;citrus:translate()</h2></div></div><div></div></div><p>This function will replace regular expression matching values inside a string representation with a
        specified replacement string.</p><pre class="programlisting">
  &lt;echo&gt;
      &lt;message&gt;
          citrus:translate('H.llo Test Fr.mework', '\.', 'a')
      &lt;/message&gt;
  &lt;/echo&gt;
        </pre><p>Note that the second parameter will be a regular expression. The third parameter will be a simple
        replacement string value.</p><p>Function output:</p><p><span class="emphasis"><em>Hallo Test Framework</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-substring-before"></a>13.5.&nbsp;citrus:substringBefore()</h2></div></div><div></div></div><p>The function will search for the first occurrence of a specified string and will return the substring before
        that occurrence. Let us have a closer look in a simple example:</p><pre class="programlisting">
  &lt;echo&gt;
      &lt;message&gt;
          citrus:substringBefore('Test/Framework', '/')
      &lt;/message&gt;
  &lt;/echo&gt;
        </pre><p>In the specific example the function will search for the &#8216;/&#8217; character and return the string before that index.</p><p>Function output:</p><p><span class="emphasis"><em>Test</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-substring-after"></a>13.6.&nbsp;citrus:substringAfter()</h2></div></div><div></div></div><p>The function will search for the first occurrence of a specified string and will return the substring after that
        occurrence. Let us clarify this with a simple example:</p><pre class="programlisting">
  &lt;echo&gt;
      &lt;message&gt;
          citrus:substringAfter('Test/Framework', '/')
      &lt;/message&gt;
  &lt;/echo&gt;
        </pre><p>Analogue to the substringBefore function the &#8216;/&#8217; character is found in the string. But now the remaining
        string is returned by the function meaning the substring after this character index.</p><p>Function output:</p><p><span class="emphasis"><em>Framework</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-round"></a>13.7.&nbsp;citrus:round()</h2></div></div><div></div></div><p>This is a simple mathematic function that will round decimal numbers representations to their nearest nondecimal
        number.</p><pre class="programlisting">
  &lt;echo&gt;
      &lt;message&gt;citrus:round('3.14')&lt;/message&gt;
  &lt;/echo&gt;
        </pre><p>Function output:</p><p><span class="emphasis"><em>3</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-floor"></a>13.8.&nbsp;citrus:floor()</h2></div></div><div></div></div><p>This function will round down decimal number values.</p><pre class="programlisting">
  &lt;echo&gt;
      &lt;message&gt;citrus:floor('3.14')&lt;/message&gt;
  &lt;/echo&gt;
        </pre><p>Function output:</p><p><span class="emphasis"><em>3.0</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-ceiling"></a>13.9.&nbsp;citrus:ceiling()</h2></div></div><div></div></div><p>Similar to floor function, but now the function will round up the decimal number values.</p><pre class="programlisting">
  &lt;echo&gt;
      &lt;message&gt;citrus:ceiling('3.14')&lt;/message&gt;
  &lt;/echo&gt;
        </pre><p>Function output:</p><p><span class="emphasis"><em>4.0</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-random-number"></a>13.10.&nbsp;citrus:randomNumber()</h2></div></div><div></div></div><p>The random number function will provide you the opportunity to generate random number strings
        containing positive number letters. There is a singular Boolean parameter for that function describing
        whether the generated String should have leading zero letters or not. Default value for this padding flag
        will be true.</p><p>Next example will show the function usage:</p><pre class="programlisting">
  &lt;variables&gt;
      &lt;variable name="rndNumber1" 
                   value="citrus:randomNumber(10)"/&gt;
      &lt;variable name="rndNumber2" 
                   value="citrus:randomNumber(10, true)"/&gt;
      &lt;variable name="rndNumber3" 
                   value="citrus:randomNumber(10, false)"/&gt;
  &lt;/variables&gt;
        </pre><p>Function output:</p><p><span class="emphasis"><em>8954638765</em></span></p><p><span class="emphasis"><em>0006387650</em></span></p><p><span class="emphasis"><em>45638765</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-random-string"></a>13.11.&nbsp;citrus:randomString()</h2></div></div><div></div></div><p>This function will generate a random string representation with a defined length. A second parameter for
        this function will define the case of the generated letters (UPPERCASE, LOWERCASE, MIXED)</p><pre class="programlisting">
  &lt;variables&gt;
      &lt;variable name="rndString0" 
                   value="${citrus:randomString(10)}"/&gt;
      &lt;variable name="rndString1" 
                   value="citrus:randomString(10)"/&gt;
      &lt;variable name="rndString2" 
                   value="citrus:randomString(10, UPPERCASE)"/&gt;
      &lt;variable name="rndString3" 
                   value="citrus:randomString(10, LOWERCASE)"/&gt;
      &lt;variable name="rndString4" 
                   value="citrus:randomString(10, MIXED)"/&gt;
  &lt;/variables&gt;
        </pre><p>Function output:</p><p><span class="emphasis"><em>Hr546dfA65</em></span></p><p><span class="emphasis"><em>Ag3876det5</em></span></p><p><span class="emphasis"><em>4SDF87TR</em></span></p><p><span class="emphasis"><em>4tkhi7uz</em></span></p><p><span class="emphasis"><em>Vt567JkA32</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-current-date"></a>13.12.&nbsp;citrus:currentDate()</h2></div></div><div></div></div><p>This function will definitely help you when accessing the current date. Some examples will show the
        usage in detail:</p><pre class="programlisting">
  &lt;echo&gt;
      &lt;message&gt;citrus:currentDate()&lt;/message&gt;
  &lt;/echo&gt;
  &lt;echo&gt;
      &lt;message&gt;citrus:currentDate('yyyy-MM-dd')&lt;/message&gt;
  &lt;/echo&gt;
  &lt;echo&gt;
      &lt;message&gt;citrus:currentDate('yyyy-MM-dd HH:mm:ss')&lt;/message&gt;
  &lt;/echo&gt;
  &lt;echo&gt;
      &lt;message&gt;citrus:currentDate('yyyy-MM-dd'T'hh:mm:ss')&lt;/message&gt;
  &lt;/echo&gt;
  &lt;echo&gt;
      &lt;message&gt;citrus:currentDate('yyyy-MM-dd HH:mm:ss', '+1y')&lt;/message&gt;
  &lt;/echo&gt;
  &lt;echo&gt;
      &lt;message&gt;citrus:currentDate('yyyy-MM-dd HH:mm:ss', '+1M')&lt;/message&gt;
  &lt;/echo&gt;
  &lt;echo&gt;
      &lt;message&gt;citrus:currentDate('yyyy-MM-dd HH:mm:ss', '+1d')&lt;/message&gt;
  &lt;/echo&gt;
  &lt;echo&gt;
      &lt;message&gt;citrus:currentDate('yyyy-MM-dd HH:mm:ss', '+1h')&lt;/message&gt;
  &lt;/echo&gt;
  &lt;echo&gt;
      &lt;message&gt;citrus:currentDate('yyyy-MM-dd HH:mm:ss', '+1m')&lt;/message&gt;
  &lt;/echo&gt;
  &lt;echo&gt;
      &lt;message&gt;citrus:currentDate('yyyy-MM-dd HH:mm:ss', '+1s')&lt;/message&gt;
  &lt;/echo&gt;
  &lt;echo&gt;
      &lt;message&gt;citrus:currentDate('yyyy-MM-dd HH:mm:ss', '-1y')&lt;/message&gt;
  &lt;/echo&gt;
        </pre><p>Note that the currentDate function provides two parameters. First parameter describes the date format
        string. The second will define a date offset string containing year, month, days, hours, minutes or seconds
        that will be added or subtracted to or from the actual date value.</p><p>Function output:</p><p><span class="emphasis"><em>01.09.2009</em></span></p><p><span class="emphasis"><em>2009-09-01</em></span></p><p><span class="emphasis"><em>2009-09-01 12:00:00</em></span></p><p><span class="emphasis"><em>2009-09-01T12:00:00</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-upper-case"></a>13.13.&nbsp;citrus:upperCase()</h2></div></div><div></div></div><p>This function converts any string to upper case letters.</p><pre class="programlisting">
  &lt;echo&gt;
      &lt;message&gt;citrus:upperCase('Hallo Test Framework')&lt;/message&gt;
  &lt;/echo&gt;
        </pre><p>Function output:</p><p><span class="emphasis"><em>HALLO TEST FRAMEWORK</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-lower-case"></a>13.14.&nbsp;citrus:lowerCase()</h2></div></div><div></div></div><p>This function converts any string to lower case letters.</p><pre class="programlisting">
  &lt;echo&gt;
      &lt;message&gt;citrus:lowerCase('Hallo Test Framework')&lt;/message&gt;
  &lt;/echo&gt;
        </pre><p>Function output:</p><p><span class="emphasis"><em>hallo test framework</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-average"></a>13.15.&nbsp;citrus:average()</h2></div></div><div></div></div><p>The function will sum up all specified number values and divide the result through the number of values.</p><pre class="programlisting">
  &lt;variable name="avg" 
               value="citrus:average('3', '4', '5')"/&gt;
        </pre><p>avg = <span class="emphasis"><em>4.0</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-minimum"></a>13.16.&nbsp;citrus:minimum()</h2></div></div><div></div></div><p>This function returns the minimum value in a set of number values.</p><pre class="programlisting">
  &lt;variable name="min" 
               value="citrus:minimum('3', '4', '5')"/&gt;
        </pre><p>min = <span class="emphasis"><em>3.0</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-maximum"></a>13.17.&nbsp;citrus:maximum()</h2></div></div><div></div></div><p>This function returns the maximum value in a set of number values.</p><pre class="programlisting">
  &lt;variable name="max" 
               value="citrus:maximum('3', '4', '5')"/&gt;
        </pre><p>max = <span class="emphasis"><em>5.0</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-sum"></a>13.18.&nbsp;citrus:sum()</h2></div></div><div></div></div><p>The function will sum up all number values. The number values can also be negative.</p><pre class="programlisting">
  &lt;variable name="sum" 
               value="citrus:sum('3', '4', '5')"/&gt;
        </pre><p>sum = <span class="emphasis"><em>12.0</em></span></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="functions-absolute"></a>13.19.&nbsp;citrus:absolute()</h2></div></div><div></div></div><p>The function will return the absolute number value.</p><pre class="programlisting">
  &lt;variable name="abs" 
               value="citrus:absolute('-3')"/&gt;
        </pre><p>abs = <span class="emphasis"><em>3.0</em></span></p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="testsuite"></a>Chapter&nbsp;14.&nbsp;Testsuite</h2></div></div><div></div></div><p>Tests often need to be grouped to test suites. Test suites also provide the functionality to do some work before and after the
    tests are run. Database preparing and cleaning tasks or server starting and stopping fit well into these initialization and cleanup phases 
    of a test suite. In Citrus a test suite is typically defined as Spring bean inside a XML configuration file.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="testsuite-tasks"></a>14.1.&nbsp;Tasks before, between and after the test run</h2></div></div><div></div></div><p>A tester can influence the behaviour of a test suite before, after and during the test run. See the next code example to find
        out how it works:</p><pre class="programlisting">
  &lt;bean name="integrationTests" 
           class="com.consol.citrus.TestSuite"&gt;
      &lt;property name="tasksBefore"&gt;
          &lt;list&gt;
              
          &lt;/list&gt;
      &lt;/property&gt;
  
      &lt;property name="tasksBetween"&gt;
          &lt;list&gt;
              
          &lt;/list&gt;
      &lt;/property&gt;
  
      &lt;property name="tasksAfter"&gt;
          &lt;list&gt;
              
          &lt;/list&gt;
      &lt;/property&gt;
  
  &lt;/bean&gt;
        </pre><p>The test suite bean is of the type com.consol.citrus.TestSuite and offers the following properties to affect
        the basic behaviour:</p><div class="itemizedlist"><ul type="opencircle"><li style="list-style-type: circle"><p>tasksBefore: List of actions that will be executed before the first test is run</p></li><li style="list-style-type: circle"><p>tasksBetween: List of actions that will be executed in between every test</p></li><li style="list-style-type: circle"><p>tasksAfter: List of actions that will be executed after the last test has ended</p></li></ul></div><p>The three task-sections before, in between and after the execution of tests are supposed to be used for
        initializing and finishing tasks. All these tasks can easily be adjusted by adding or removing beans inside the &lt;list&gt; 
        element.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.png"></td><th align="left">Tip</th></tr><tr><td colspan="2" align="left" valign="top"><p>The framework offers special startup and shutdon actions that may start and stop server implmentations. This might 
            be helpful when dealing with Http servers or WebService containers like Jetty. You can also think of starting/stopping a 
            JMS broker.</p><p>A test suite run may require the test environment to be clean. Therefore it is a good idea to purge all JMS destinations
            or clean up the database to avoid errors caused by obsolete data from previous test runs.</p><p>Between the tests it also might sound reasonable to purge all JMS queues. In case a test fails the use case processing stops
            and some messages might be left in some JMS queues. The next test then will be confronted with these invalid messages. Purging all JMS
            destinations between the tests is therefore a good idea.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="testsuite-include-exclude"></a>14.2.&nbsp;Include and exclude tests</h2></div></div><div></div></div><p>While using the test framework you will find out that the duration of tests differ according to the purpose of
        the test. Especially timeout tests take a long time. In some cases the tester might not want to execute
        those tests, because it would take too long. Another situation would be that the tester intends to test a
        certain group of tests explicitly and all other tests should not be executed.</p><p>In these situations the test suite is very helpful because here you can easily declare include or exclude test cases from a test 
        run.</p><p>The following example tries to explain this functionality in detail:</p><pre class="programlisting">
  &lt;bean name="testSuite" 
           class="com.consol.citrus.TestSuite"&gt;
      &lt;property name="excludeTests"&gt;
          &lt;list&gt;
              &lt;value&gt;*timeout*&lt;/value&gt;
              &lt;value&gt;someTestName&lt;/value&gt;
              &lt;value&gt;startsWith*&lt;/value&gt;
              &lt;value&gt;*endsWith&lt;/value&gt;
          &lt;/list&gt;
      &lt;/property&gt;
      
      &lt;property name="includeTests"&gt;
          &lt;list&gt;
              &lt;value&gt;*timeout*&lt;/value&gt;
              &lt;value&gt;someTestName&lt;/value&gt;
              &lt;value&gt;startsWith*&lt;/value&gt;
              &lt;value&gt;*endsWith&lt;/value&gt;
          &lt;/list&gt;
      &lt;/property&gt;
  &lt;/bean&gt;
        </pre><p>Both properties support name patterns. This means that you can use the wildcard "*" to define name
        patterns as shown in the examples. Be careful to use both including and excluding patterns at the same
        time, because they might overrule each other.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="testsuite-multiple"></a>14.3.&nbsp;Multiple testsuites</h2></div></div><div></div></div><p>Sometimes it is useful to configure more than one of these test suite instances. You can think of test suites for 
        unit testing, integration testing, performance testing and so on. Unit testing might require different actions before
        the test run than integration testing and vice versa.</p><p>You can simply define several beans of test suites in the Spring configuration. There could be one test suite
        instance for unit testing and one for integration testing, with their individual configuration like separate
        'tasksBefore' and different including patterns for tests.</p><p>By default Citrus will start all available test suite instances in sequence. If you want to
        start a certain instance explicitly you have to declare the name of the instance when starting Citrus.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="tibco"></a>Chapter&nbsp;15.&nbsp;TIBCO support</h2></div></div><div></div></div><p>The Citrus framework was designed to also connect to several TIBCO software components. The outcome is a group of
    special test actions that enable the tester to connect to the TIBCO components and execute operations towards TIBCO.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tibco-hawk"></a>15.1.&nbsp;Connecting with TIBCO Hawk</h2></div></div><div></div></div><p>TIBCO uses the enterprise monitoring tool Hawk to manage and supervise all TIBCO applications. Citrus can access Hawk
        to affect the TIBCO service instances. You can start or stop BusinessWorks process archives and process starters for instance.</p><div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Tip"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="images/admons/tip.png"></td><th align="left">Tip</th></tr><tr><td colspan="2" align="left" valign="top"><p>Use TIBCO Hawk in order to prepare the TIBCO environment according
            to the test that will be executed (unit or integration tests).</p></td></tr></table></div><p>The next example shows how the Hawk agent can be used in the test suite setup.</p><pre class="programlisting">
  &lt;bean parent="tibcoHawkAgent"&gt;
      &lt;property name="methodName" 
                   value="ResumeProcessStarter"/&gt;
      &lt;property name="methodParameters"&gt;
          &lt;list&gt;
              &lt;bean class="COM.TIBCO.hawk.talon.DataElement"&gt;
                  &lt;constructor-arg value="ProcessDefinition"/&gt;
                  &lt;constructor-arg    
                      value="Test/UnitTest/BusinessServiceTester.process"/&gt;
              &lt;/bean&gt;
          &lt;/list&gt;
      &lt;/property&gt;
  &lt;/bean&gt;
        </pre><p>The example shows a method call to a Hawk agent. The method is declared through the methodName
        property. In the above example the Hawk agent will resume a particular process starter. The
        methodParameters property will cause the process starter to resume.</p><p>In general the HawkAgent has the following properties:</p><div class="itemizedlist"><ul type="disc"><li><p>microAgent -&gt; <tt class="literal">COM.TIBCO.ADAPTER.bwengine.&lt;hawk.domain&gt;.&lt;hawk.service.instance&gt;.&lt;hawk.process.archive&gt;</tt></p></li><li><p>hawkDomain</p></li><li><p>rvService (e.g. 57500)</p></li><li><p>rvNetwork</p></li><li><p>rvDaemon (e.g. tcp:57500)</p></li></ul></div><p>The microAgentID consists of the Hawk domain, the service instance and the process archive. With the
        right setting of the domain the service and the daemon you can now use all methods offered by the
        specific MicroAgent.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tibco-collaborator"></a>15.2.&nbsp;Connecting with TIBCO Collaborator Workflow Server</h2></div></div><div></div></div><p>Similar to the Hawk agent it is useful to start and stop certain workflow jobs in the TIBCO Collaborator
        Workflow Server, especially for clean up reasons. Left over workflows from previous test runs will then get
        terminated correctly.</p><p>The test framework offers a special action implementation, in order to clean up all available workflow jobs on
        the Workflow Collaborator Server.</p><p>The bean looks like follows:</p><pre class="programlisting">
  &lt;bean id="cleanIcJobs"
      class="com.consol.citrus.actions.CleanIcJobsBean"&gt;
      &lt;property name="userName" value="${ic.username}"/&gt;
      &lt;property name="password" value="${ic.password}"/&gt;
      &lt;property name="serverName" value="${ic.servername}"/&gt;
      &lt;property name="service" value="${ic.tibrv.service}"/&gt;
      &lt;property name="network" value="${ic.tibrv.network}"/&gt;
      &lt;property name="daemon" value="${ic.tibrv.daemon}"/&gt;
      &lt;property name="queueCount" value="${ic.tibrv.queue.count}"/&gt;
      &lt;property name="serverDiscoveryTimeout" 
                   value="${ic.tibrv.server.discovery.timeout}"/&gt;
  &lt;/bean&gt;
        </pre><p>The properties of that bean do all refer to the connection credentials of the Workflow InConcert Server instance.</p></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="schema-validation"></a>Chapter&nbsp;16.&nbsp;XML schema validation</h2></div></div><div></div></div><p>There are several possibilities to describe the structure of XML documents. The two most popular ways are DTD 
    (Document type definition) and XSD (XML Schema definition). Once a XML document has decided to be classified using a schema 
    definition the structure of the document has to fit the predefined rules inside the schema definition. XML document instances 
    are valid only in case they meet all these structure rules defined in the schema definition. 
    Currently Citrus can validate XML documents using the schema languages DTD and XSD.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="xsd-validation"></a>16.1.&nbsp;XSD validation</h2></div></div><div></div></div><p>Citrus handles XML schema definitions in order to validate incoming XML documents. Consequential the message receiving 
        actions have to know the respective XML schema (*.xsd) file resources to do so. This is done through a central schema repository
        which holds all available XML schema files for a project.</p><pre class="programlisting">
  &lt;bean id="schemaRepository" 
           class="com.consol.citrus.xml.XsdSchemaRepository"&gt;
      &lt;property name="schemas"&gt;
          &lt;list&gt;
              &lt;bean class="org.springframework.xml.xsd.SimpleXsdSchema"&gt;
                  &lt;property name="xsd" 
                               value="classpath:citrus/flightbooking/TravelAgencySchema.xsd"/&gt;
              &lt;/bean&gt;
              &lt;bean class="org.springframework.xml.xsd.SimpleXsdSchema"&gt;
                  &lt;property name="xsd" 
                               value="classpath:citrus/flightbooking/AirlineSchema.xsd"/&gt;
              &lt;/bean&gt;
          &lt;/list&gt;
      &lt;/property&gt;
  &lt;/bean&gt;
        </pre><p>By convention the schema respository instance is defined in the Citrus Spring configuration with the id "schemaRepository".
        Spring is then able to inject this schema repository instance into every message receiving action. The receiving action receives 
        XML messages and will ask the repository for a matching schema definition file in order to validate the document structure.</p><p>The connection between XML messages and xsd schema files is done with the target namespace that is defined inside the schema
        definition. The target namespace of the schema definition will match the namespace of the root element in the received XML message.
        Using this central schema repository you do not have to wire XML messages and schema files together every time. This is done
        automatically over the target namespace.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/admons/important.png"></td><th align="left">Important</th></tr><tr><td colspan="2" align="left" valign="top"><p>In case Citrus rceives a classified XML message using namespaces Citrus will try to validate the structure of the message 
            by default. Consequently you will also get errors in case no matching schema definition file is found inside the schema 
            repository. So if you explicitly do not want to validate the XML schema for some reason you have to disable the validation
            explicitly in your test.</p><pre class="programlisting">
  &lt;receive with="getCustomerRequestReceiver"&gt;
      &lt;message schema-validation="false"&gt;
          &lt;validate path="//ns2:RequestMessage/ns2:MessageHeader/ns2:RequestTag" 
                       value="${requestTag}"/&gt;
          &lt;validate path="//ns2:RequestMessage/ns2:MessageHeader/ns2:CorrelationId" 
                       value="${correlationId}"/&gt;
          &lt;namespace prefix="ns2" value="http://testsuite/default"/&gt;
      &lt;/message&gt;
      &lt;header&gt;
          &lt;element name="Operation" value="GetCustomer"/&gt;
          &lt;element name="RequestTag" value="${requestTag}"/&gt;
      &lt;/header&gt;
  &lt;/receive&gt;
            </pre><p>This way might sound annoying for you but in our opinion it is very important to validate the structure of the received 
            XML messages, so disabling the schema validation should not be the standard for all tests. Disabling automatic schema validation
            should only apply to special situations.</p></td></tr></table></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dtd-validation"></a>16.2.&nbsp;DTD validation</h2></div></div><div></div></div><p>XML DTD (Document type definition) is another way to validate the structure of a XML document. Many people say that DTD is
        deprecated and XML schema is the much more efficient way to describe the rules of a XML structure. We do not disagree with that, but
        we also know that legacy systems might still use DTD. So in order to avoid validation errors we have to deal with DTD validation
        as well.</p><p>First thing you can do about DTD validation is to specify an inline DTD in your expected message template.</p><pre class="programlisting">
  &lt;receive with="getTestMessageReceiver"&gt;
      &lt;message schema-validation="false"&gt;
          &lt;data&gt;
          &lt;![CDATA[
              &lt;!DOCTYPE root [
                  &lt;!ELEMENT root (message)&gt;
                  &lt;!ELEMENT message (text)&gt;
                  &lt;!ELEMENT text (#PCDATA)&gt;
                  ]&gt;
              &lt;root&gt;
                  &lt;message&gt;
                      &lt;text&gt;Hello TestFramework!&lt;/text&gt;
                  &lt;/message&gt;
              &lt;/root&gt;
          ]&gt;
          &lt;data/&gt;
      &lt;/message&gt;
  &lt;/receive&gt;
        </pre><p>The system under test may also send the message with a inline DTD definition. So validation will succeed.</p><p>In most cases the DTD is referenced as external .dtd file resource. You can do this in your expected message 
        template as well.</p><pre class="programlisting">
  &lt;receive with="getTestMessageReceiver"&gt;
      &lt;message schema-validation="false"&gt;
          &lt;data&gt;
          &lt;![CDATA[
              &lt;!DOCTYPE root SYSTEM 
                           "com/consol/citrus/validation/example.dtd"&gt;
              &lt;root&gt;
                  &lt;message&gt;
                      &lt;text&gt;Hello TestFramework!&lt;/text&gt;
                  &lt;/message&gt;
              &lt;/root&gt;
          ]&gt;
          &lt;data/&gt;
      &lt;/message&gt;
  &lt;/receive&gt;
        </pre></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="debug-messages"></a>Chapter&nbsp;17.&nbsp;Debugging received messages</h2></div></div><div></div></div><p>Citrus will receive a lot of messages during a test run. The user may want to persist these messages to the 
    filesystem for further investigations.</p><p>Citrus offers an easy way to debug all received messages to the filesystem. You need to enable a specific aspect in the
    Citrus Spring configuration.</p><pre class="programlisting">
  &lt;bean class="com.consol.citrus.aop.StoreMessageInterceptorAspect"/&gt;
    </pre><p>Just add this bean to the Spring configuration and Citrus will debug received messages to the file system by generating files
    containing the message header and message body content.</p><p>For example:</p><p><tt class="literal">logs/debug/messages/message1.header</tt></p><p><tt class="literal">logs/debug/messages/message1.body</tt></p><p><tt class="literal">logs/debug/messages/message2.header</tt></p><p><tt class="literal">logs/debug/messages/message2.body</tt></p><p>The framework uses a simple counter that is increased whenever a message is written to the file system. Citrus seperates 
    message header and message body into extra files with respective extension (".header" and ".body"). By default the debug directory is 
    <tt class="literal">logs/debug/messages/</tt> relative to the project root directory. But you can set your own debug directory in the 
    configuration.</p><pre class="programlisting">
  &lt;bean class="com.consol.citrus.aop.StoreMessageInterceptorAspect"&gt;
          &lt;property name="debugDirectory" 
                       value="debugging/messages"/&gt;
  &lt;/bean&gt;
    </pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><table border="0" summary="Note"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="images/admons/note.png"></td><th align="left">Note</th></tr><tr><td colspan="2" align="left" valign="top"><p>As the file counter is always reset to 0 after a test run the message files may be overwritten. So you eventually need to 
        save the generated message debug files before running another group of test cases.</p></td></tr></table></div></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="reporting"></a>Chapter&nbsp;18.&nbsp;Reporting and test results</h2></div></div><div></div></div><p>The framework generates different reports and results after a test run for you. These report and result pages will
    help you to get an overview of the test cases that were executed and which one were failing.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="reporting-logging"></a>18.1.&nbsp;Console logging</h2></div></div><div></div></div><p>During the test run the framework will provide a huge amount of information that is printed out to
        the console. This includes current test progress, validation results and error information. This
        enables the user to quickly supervise the test run progress. Failures in tests will be printed to the
        console just the time the error occurred. The detailed stack trace information and the detailed
        error messages are helpful to get the idea what went wrong.</p><p>As the console output might be limited to a defined buffer limit, the user may not be able to
        follow the output to the very beginning of the test run. Therefore the framework additionally
        prints all information to a log file according to the logging configuration.</p><p>The logging mechanism uses the SLF4J logging framework. SLF4J is independent of logging framework implementations on the 
        market. So in case you use Log4J logging framework the specified log file path as well as logging levels can be freely configured 
        in the respective log4j.xml file in your project. At the end of a test run the combined test results get printed to both console 
        and log file. The overall test results look like following example:</p><pre class="programlisting">
            <tt class="literal">
  TEST RESULTS citrus-default-testsuite
  
    [...]
    HelloService_Ok_1             : successfull
    HelloService_Ok_2             : successfull
    EchoService_Ok_1              : successfull
    EchoService_Ok_2              : successfull
    EchoService_TempError_1       : successfull
    EchoService_AutomacticRetry_1 : successfull
    [...]
    
    Found 175 test cases to execute
    Skipped 0 test cases (0.0%)
    Executed 175 test cases
    Tests failed:         0 (0.0%)
    Tests successfully: 175 (100.0%)
            </tt>
        </pre><p>Failed tests will be marked as failed in the result list. The framework will give a short description
        of the error cause while the detailed stack trace information can be found in the log messages
        that were made during the test run.</p><pre class="programlisting">
  <tt class="literal">HelloService_Ok_3 : failed - Exception is Action timed out</tt>
        </pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="reporting-junit"></a>18.2.&nbsp;JUnit reports</h2></div></div><div></div></div><p>As tests are executed as TestNG test cases, the framework will also generate JUnit compliant XML and HTML 
        reports. JUnit test reports are very popular and find support in many build management and development tools. 
        In general the Citrus test reports give you an overall picture of all tests and tell you which of them were failing.</p><p>Build management tools like Hudson, Bamboo or CruiseControl can easily import and display the generated JUnit 
        XML results. Please have a look at the TestNG and JUnit documentation for more information about this topic as well 
        as the build management tools (Hudson, Bamboo, CruiseControl, etc.) to find out how to integrate the tests results.</p></div></div><div class="appendix" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="samples"></a>Appendix&nbsp;A.&nbsp;Citrus samples</h2></div></div><div></div></div><p>This part will show you some sample applications that are tested using Citrus integration tests. 
        See below a list of all samples.</p><div class="itemizedlist"><ul type="disc"><li><p><a href="#samples-flightbooking" title="A.1.&nbsp;The FlightBooking sample">Section&nbsp;A.1, &#8220;The FlightBooking sample&#8221;</a></p></li></ul></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="samples-flightbooking"></a>A.1.&nbsp;The FlightBooking sample</h2></div></div><div></div></div><p>A simple project example should give you the idea how Citrus works. The system under test is a flight booking service that 
    handles travel requests from a travel agency. A travel request consits of a complete travel route including several flights. The 
    FlightBookingService application will split the complete travel booking into seperate flight bookings that are sent to the respective
    airlines in charge. The booking and customer data is persisted in a database.</p><p>The arilines will confirm or deny the flight bookings. The FlightBookingService application consolidates all incoming flight 
    confirmations and combines them to a complete travel confirmation or denial that is sent back to the travel agency. Next picture
    tries to put the architecture into graphics:</p><p>
      </p><div class="mediaobject" align="center"><img src="images/samples/flightbooking/architecture_overview.jpg" align="middle"></div><p>
    </p><p>In our example two different arilines are connected to the FlightBookingService application: the SmartAriline over JMS and
    the RoyalAirline over Http.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="samples-flightbooking-usecase"></a>A.1.1.&nbsp;The use case</h3></div></div><div></div></div><p>The use case that we would like to test is quite simple. The test should handle a simple travel booking and expect a positive
        processing to the end. The test case neither simulates business errors nor technical problems. Next picture shows the use case
        as a sequence diagram.</p><p>
          </p><div class="mediaobject" align="center"><img src="images/samples/flightbooking/sequence_diagram.jpg" align="middle"></div><p>
        </p><p>The travel agency puts a travel booking request towards the system. The travel booking contains two seperate flights. The
        flight requests are published to the airlines (SmartAirline and RoyalAirline). Both airlines confirm the flight bookings with a positive
        answer. The consolidated travel booking response is then sent back to the travel agency.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="samples-flightbooking-configuration"></a>A.1.2.&nbsp;Configure the simulated systems</h3></div></div><div></div></div><p>Citrus simulates all surrounding applications in their behaviour during the test. The simulated applications are:
        TravelAgency, SmartAirline and RoyalAirline. The simulated systems have to be configured in the Citrus configuration first.
        The configuration is done in Spring XML configuration files, as Citrus uses Spring to glue all its services together.</p><p>First of all we have a look at the TravelAgency configuration. The TravelAgency is using JMS to connect to our tested system, so
        we need to configure this JMS connection in Citrus.</p><pre class="programlisting">
  &lt;bean name="connectionFactory" 
           class="org.apache.activemq.ActiveMQConnectionFactory"&gt;
      &lt;property name="brokerURL" 
                   value="tcp://localhost:61616" /&gt;
  &lt;/bean&gt;
  
  &lt;citrus:jms-message-sender id="travelAgencyBookingRequestSender" 
                                destination-name="${travel.agency.request.queue}"/&gt;
  
  &lt;citrus:jms-message-receiver id="travelAgencyBookingResponseReceiver" 
                                  destination-name="${travel.agency.response.queue}"/&gt;
        </pre><p>This is all Citrus needs to send and receive messages over JMS in order to simulate the TravelAgency. By default all JMS message
        senders and receivers need a connection factory. Therefore Citrus is searching for a bean named "connectionFactory". In the example
        we connect to a ActiveMQ message broker. A connection to other JMS brokers like TIBCO EMS or IBM Websphere MQ is possible too by
        simply changing the connection factory implementation.</p><p>The identifyers of the message senders and receivers are very important. We should think of suitable ids that give the
        reader a first hint what the sender/receiver is used for. As we want to simulate the TravelAgency in combination with sending
        booking requests our id is "travelAgencyBookingRequestSender" for example.</p><p>The sender and receivers do also need a JMS destination. Here the destination names are provided by property expressions.
        The Spring IoC container resolves the properties for us. All we need to do is publish the property file to the Spring container
        like this.</p><pre class="programlisting">
  &lt;bean name="propertyLoader" 
           class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"&gt;
      &lt;property name="locations"&gt;
          &lt;list&gt;
              &lt;value&gt;citrus.properties&lt;/value&gt;
          &lt;/list&gt;
      &lt;/property&gt;
      &lt;property name="ignoreUnresolvablePlaceholders" 
                   value="true"/&gt;
  &lt;/bean&gt;
        </pre><p>The citrus.properties file is located in our project's resources folder and defines the actual queue names besides
        other properties of course:</p><pre class="programlisting">
  #JMS queues
  travel.agency.request.queue=Travel.Agency.Request.Queue
  travel.agency.response.queue=Travel.Agency.Response.Queue
  smart.airline.request.queue=Smart.Airline.Request.Queue
  smart.airline.response.queue=Smart.Airline.Response.Queue
  royal.airline.request.queue=Royal.Airline.Request.Queue    
        </pre><p>What else do we need in our Spring configuration? There are some basic beans that are commonly defined in a Citrus
        application but I do not want to bore you with these details. So if you want to have a look at the "citrus-context.xml" 
        file in the resources folder and see how things are defined there.</p><p>We continue with the first airline to be configured the SmartAirline. The SmartAirline is also using JMS to communicate
        with the FlightBookingService. So there is nothing new for us, we simply define additional JMS message senders and receivers.</p><pre class="programlisting">
  &lt;citrus:jms-message-receiver id="smartAirlineBookingRequestReceiver" 
                                  destination-name="${smart.airline.request.queue}"/&gt;
  
  &lt;citrus:jms-message-sender id="smartAirlineBookingResponseSender" 
                                destination-name="${smart.airline.response.queue}"/&gt;
        </pre><p>We do not define a new JMS connection factory because TravelAgency and SmartAirline are using the same message broker instance.
        In case you need to handle multiple connection factories simply define the connection factory with the attribute "connection-factory".</p><pre class="programlisting">
  &lt;citrus:jms-message-receiver id="smartAirlineBookingRequestReceiver" 
                                  destination-name="${smart.airline.request.queue}"
                                  connection-factory="smartAirlineConnectionFactory"/&gt;
  
  &lt;citrus:jms-message-sender id="smartAirlineBookingResponseSender" 
                                destination-name="${smart.airline.response.queue}"
                                connection-factory="smartAirlineConnectionFactory"/&gt;        
        </pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="samples-flightbooking-http"></a>A.1.3.&nbsp;Configure the Http adapter</h3></div></div><div></div></div><p>The RoyalAirline is connected to our system using Http request/response communication. This means we have to simulate a Http server
        in the test that accepts client requests and provides proper responses. Citrus offers a Http server implementation that will listen on a
        port for client requests. The adapter forwards incoming request to the test engine over JMS and receives a proper response that is 
        forwarded as a Http response to the client. The next picture shows this mechanism in detail.</p><p>
          </p><div class="mediaobject" align="center"><img src="images/samples/flightbooking/http_adapter.jpg" align="middle"></div><p>
        </p><p>The RoyalAirline adapter receives client requsts over Http and sends them over JMS to a message receiver as we alredy know it. The
        test engine validates the received request and provides a proper response back to the adapter. The adapter will transform the response 
        to Http again and publishes it to the calling client. Citrus offers these kind of adapters for Http and SOAP communication. By writing 
        your own adapters like this you will be able to extend Citrus so it works with protocols that are not supported yet.</p><p>Let us define the Http adapter in the Spring configuration:</p><pre class="programlisting">
  &lt;citrus-http:server id="royalAirlineHttpServer" 
                         port="8091" 
                         uri="/flightbooking" 
                         message-handler="jmsForwardingMessageHandler"/&gt;
          
  &lt;bean id="jmsForwardingMessageHandler" 
           class="com.consol.citrus.http.handler.JmsConnectingMessageHandler"&gt;
      &lt;property name="destinationName" 
                   value="${royal.airline.request.queue}"/&gt;
      &lt;property name="connectionFactory" 
                   ref="connectionFactory" /&gt;
      &lt;property name="replyTimeout" 
                   value="2000"/&gt;
  &lt;/bean&gt;        
                      
  &lt;citrus:jms-sync-message-receiver id="royalAirlineBookingRequestReceiver" 
                                       destination-name="${royal.airline.request.queue}"/&gt;
  
  &lt;citrus:jms-reply-message-sender id="royalAirlineBookingResponseSender" 
                                      reply-destination-holder="royalAirlineBookingRequestReceiver"/&gt;
        </pre><p>We need to configure a Http server instance with a port, a request URI and a message handler. We define the
        JMS forwarding message handler to handle request as described. In Addition to the message handler we also need synchrpnous JMS
        message sender and receiver instances. That's it! We are able to receive Http request in order to simulate the RoyalAirline
        application. What is missing now? The test case definition itself.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="samples-flightbooking-testcase"></a>A.1.4.&nbsp;The test case</h3></div></div><div></div></div><p>The test case definition is also a Spring configuration file. Citrus offers a customized XML syntax to define a test case.
        This XML test defining language is supposed to be easy to understand and more specific to the domain we are dealing with. Next listing
        shows the whole test case definition. Keep in mind that a test case defines every step in the use case. So we define sending and 
        receiving actions of the use case as described in the sequence diagram we saw earlier.</p><pre class="programlisting">
  &lt;?xml version="1.0" encoding="UTF-8"?&gt;
  &lt;spring:beans xmlns="http://www.citrusframework.org/schema/testcase" 
                   xmlns:spring="http://www.springframework.org/schema/beans" 
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
                   xsi:schemaLocation="http://www.springframework.org/schema/beans 
                   http://www.springframework.org/schema/beans/spring-beans-2.5.xsd 
                   http://www.citrusframework.org/schema/testcase 
                   http://www.citrusframework.org/schema/testcase/citrus-testcase.xsd"&gt;
      &lt;testcase name="FlightBookingTest"&gt;
          &lt;meta-info&gt;
              &lt;author&gt;Christoph Deppisch&lt;/author&gt;
              &lt;creationdate&gt;2009-04-15&lt;/creationdate&gt;
              &lt;status&gt;FINAL&lt;/status&gt;
              &lt;last-updated-by&gt;Christoph Deppisch&lt;/last-updated-by&gt;
              &lt;last-updated-on&gt;2009-04-15T00:00:00&lt;/last-updated-on&gt;
          &lt;/meta-info&gt;
          &lt;description&gt;
              Test flight booking service.
          &lt;/description&gt;
          &lt;variables&gt;
              &lt;variable name="correlationId" value="citrus:concat('Lx1x', 'citrus:randomNumber(10)')"/&gt;
              &lt;variable name="customerId" value="citrus:concat('Mx1x', citrus:randomNumber(10))"/&gt;
          &lt;/variables&gt;
          &lt;actions&gt;
              &lt;send with="travelAgencyBookingRequestSender"&gt;
                  &lt;message&gt;
                      &lt;data&gt;
                        &lt;![CDATA[
                          &lt;TravelBookingRequestMessage 
                            xmlns="http://www.consol.com/schemas/FlightBooking/TravelAgency/TravelAgencySchema.xsd"&gt;
                            &lt;correlationId&gt;${correlationId}&lt;/correlationId&gt;
                            &lt;customer&gt;
                              &lt;id&gt;${customerId}&lt;/id&gt;
                              &lt;firstname&gt;John&lt;/firstname&gt;
                              &lt;lastname&gt;Doe&lt;/lastname&gt;
                            &lt;/customer&gt;
                            &lt;flights&gt;
                                &lt;flight&gt;
                                  &lt;flightId&gt;SM 1269&lt;/flightId&gt;
                                  &lt;airline&gt;SmartAirline&lt;/airline&gt;
                                  &lt;fromAirport&gt;MUC&lt;/fromAirport&gt;
                                  &lt;toAirport&gt;FRA&lt;/toAirport&gt;
                                  &lt;date&gt;2009-04-15&lt;/date&gt;
                                  &lt;scheduledDeparture&gt;11:55:00&lt;/scheduledDeparture&gt;
                                  &lt;scheduledArrival&gt;13:00:00&lt;/scheduledArrival&gt;
                                &lt;/flight&gt;
                                &lt;flight&gt;
                                  &lt;flightId&gt;RA 1780&lt;/flightId&gt;
                                  &lt;airline&gt;RoyalAirline&lt;/airline&gt;
                                  &lt;fromAirport&gt;FRA&lt;/fromAirport&gt;
                                  &lt;toAirport&gt;HAM&lt;/toAirport&gt;
                                  &lt;date&gt;2009-04-15&lt;/date&gt;
                                  &lt;scheduledDeparture&gt;16:00:00&lt;/scheduledDeparture&gt;
                                  &lt;scheduledArrival&gt;17:10:00&lt;/scheduledArrival&gt;
                                &lt;/flight&gt;
                            &lt;/flights&gt;                                
                          &lt;/TravelBookingRequestMessage&gt;
                        ]]&gt;
                      &lt;/data&gt;
                  &lt;/message&gt;
                  &lt;header&gt;
                      &lt;element name="correlationId" 
                                  value="${correlationId}"/&gt;
                  &lt;/header&gt;
              &lt;/send&gt;
              
              &lt;receive with="smartAirlineBookingRequestReceiver"&gt;
                  &lt;message&gt;
                      &lt;data&gt;
                        &lt;![CDATA[
                          &lt;FlightBookingRequestMessage 
                            xmlns="http://www.consol.com/schemas/FlightBooking/AirlineSchema.xsd"&gt;
                            &lt;correlationId&gt;${correlationId}&lt;/correlationId&gt;
                            &lt;bookingId&gt;???&lt;/bookingId&gt;
                            &lt;customer&gt;
                              &lt;id&gt;${customerId}&lt;/id&gt;
                              &lt;firstname&gt;John&lt;/firstname&gt;
                              &lt;lastname&gt;Doe&lt;/lastname&gt;
                            &lt;/customer&gt;
                            &lt;flight&gt;
                              &lt;flightId&gt;SM 1269&lt;/flightId&gt;
                              &lt;airline&gt;SmartAirline&lt;/airline&gt;
                              &lt;fromAirport&gt;MUC&lt;/fromAirport&gt;
                              &lt;toAirport&gt;FRA&lt;/toAirport&gt;
                              &lt;date&gt;2009-04-15&lt;/date&gt;
                              &lt;scheduledDeparture&gt;11:55:00&lt;/scheduledDeparture&gt;
                              &lt;scheduledArrival&gt;13:00:00&lt;/scheduledArrival&gt;
                            &lt;/flight&gt;
                          &lt;/FlightBookingRequestMessage&gt;
                        ]]&gt;
                      &lt;/data&gt;
                      &lt;ignore path="//:FlightBookingRequestMessage/:bookingId"/&gt;
                  &lt;/message&gt;
                  &lt;header&gt;
                      &lt;element name="correlationId" 
                                  value="${correlationId}"/&gt;
                  &lt;/header&gt;
                  &lt;extract&gt;
                      &lt;message path="//:FlightBookingRequestMessage/:bookingId" 
                                  variable="${smartAirlineBookingId}"/&gt;
                  &lt;/extract&gt;
              &lt;/receive&gt;
              
              &lt;send with="smartAirlineBookingResponseSender"&gt;
                  &lt;message&gt;
                      &lt;data&gt;
                        &lt;![CDATA[
                          &lt;FlightBookingConfirmationMessage 
                            xmlns="http://www.consol.com/schemas/FlightBooking/AirlineSchema.xsd"&gt;
                            &lt;correlationId&gt;${correlationId}&lt;/correlationId&gt;
                            &lt;bookingId&gt;${smartAirlineBookingId}&lt;/bookingId&gt;
                            &lt;success&gt;true&lt;/success&gt;
                            &lt;flight&gt;
                              &lt;flightId&gt;SM 1269&lt;/flightId&gt;
                              &lt;airline&gt;SmartAirline&lt;/airline&gt;
                              &lt;fromAirport&gt;MUC&lt;/fromAirport&gt;
                              &lt;toAirport&gt;FRA&lt;/toAirport&gt;
                              &lt;date&gt;2009-04-15&lt;/date&gt;
                              &lt;scheduledDeparture&gt;11:55:00&lt;/scheduledDeparture&gt;
                              &lt;scheduledArrival&gt;13:00:00&lt;/scheduledArrival&gt;
                            &lt;/flight&gt;
                          &lt;/FlightBookingConfirmationMessage&gt;
                        ]]&gt;
                      &lt;/data&gt;
                  &lt;/message&gt;
                  &lt;header&gt;
                      &lt;element name="correlationId" 
                                  value="${correlationId}"/&gt;
                  &lt;/header&gt;
              &lt;/send&gt;
              
              &lt;receive with="royalAirlineBookingRequestReceiver"&gt;
                  &lt;message&gt;
                      &lt;data&gt;
                        &lt;![CDATA[
                          &lt;FlightBookingRequestMessage 
                            xmlns="http://www.consol.com/schemas/FlightBooking/AirlineSchema.xsd"&gt;
                            &lt;correlationId&gt;${correlationId}&lt;/correlationId&gt;
                            &lt;bookingId&gt;???&lt;/bookingId&gt;
                            &lt;customer&gt;
                                &lt;id&gt;${customerId}&lt;/id&gt;
                                &lt;firstname&gt;John&lt;/firstname&gt;
                                &lt;lastname&gt;Doe&lt;/lastname&gt;
                            &lt;/customer&gt;
                            &lt;flight&gt;
                                &lt;flightId&gt;RA 1780&lt;/flightId&gt;
                                &lt;airline&gt;RoyalAirline&lt;/airline&gt;
                                &lt;fromAirport&gt;FRA&lt;/fromAirport&gt;
                                &lt;toAirport&gt;HAM&lt;/toAirport&gt;
                                &lt;date&gt;2009-04-15&lt;/date&gt;
                                &lt;scheduledDeparture&gt;16:00:00&lt;/scheduledDeparture&gt;
                                &lt;scheduledArrival&gt;17:10:00&lt;/scheduledArrival&gt;
                            &lt;/flight&gt;
                          &lt;/FlightBookingRequestMessage&gt;
                        ]]&gt;
                      &lt;/data&gt;
                      &lt;ignore path="//:FlightBookingRequestMessage/:bookingId"/&gt;
                  &lt;/message&gt;
                  &lt;header&gt;
                      &lt;element name="correlationId" 
                                  value="${correlationId}"/&gt;
                  &lt;/header&gt;
                  &lt;extract&gt;
                      &lt;message path="//:FlightBookingRequestMessage/:bookingId" 
                                  variable="${royalAirlineBookingId}"/&gt;
                  &lt;/extract&gt;
              &lt;/receive&gt;
              
              &lt;send with="royalAirlineBookingResponseSender"&gt;
                  &lt;message&gt;
                      &lt;data&gt;
                        &lt;![CDATA[
                          &lt;FlightBookingConfirmationMessage 
                            xmlns="http://www.consol.com/schemas/FlightBooking/AirlineSchema.xsd"&gt;
                            &lt;correlationId&gt;${correlationId}&lt;/correlationId&gt;
                            &lt;bookingId&gt;${royalAirlineBookingId}&lt;/bookingId&gt;
                            &lt;success&gt;true&lt;/success&gt;
                            &lt;flight&gt;
                              &lt;flightId&gt;RA 1780&lt;/flightId&gt;
                              &lt;airline&gt;RoyalAirline&lt;/airline&gt;
                              &lt;fromAirport&gt;FRA&lt;/fromAirport&gt;
                              &lt;toAirport&gt;HAM&lt;/toAirport&gt;
                              &lt;date&gt;2009-04-15&lt;/date&gt;
                              &lt;scheduledDeparture&gt;16:00:00&lt;/scheduledDeparture&gt;
                              &lt;scheduledArrival&gt;17:10:00&lt;/scheduledArrival&gt;
                            &lt;/flight&gt;
                          &lt;/FlightBookingConfirmationMessage&gt;
                        ]]&gt;
                      &lt;/data&gt;
                  &lt;/message&gt;
                  &lt;header&gt;
                      &lt;element name="correlationid" 
                                  value="${correlationId}"/&gt;
                  &lt;/header&gt;
              &lt;/send&gt;
              
              &lt;receive with="travelAgencyBookingResponseReceiver"&gt;
                  &lt;message&gt;
                      &lt;data&gt;
                        &lt;![CDATA[
                          &lt;TravelBookingResponseMessage 
                            xmlns="http://www.consol.com/schemas/FlightBooking/TravelAgency/TravelAgencySchema.xsd"&gt;
                            &lt;correlationId&gt;${correlationId}&lt;/correlationId&gt;
                            &lt;success&gt;true&lt;/success&gt;
                            &lt;flights&gt;
                                &lt;flight&gt;
                                    &lt;flightId&gt;SM 1269&lt;/flightId&gt;
                                    &lt;airline&gt;SmartAirline&lt;/airline&gt;
                                    &lt;fromAirport&gt;MUC&lt;/fromAirport&gt;
                                    &lt;toAirport&gt;FRA&lt;/toAirport&gt;
                                    &lt;date&gt;2009-04-15&lt;/date&gt;
                                    &lt;scheduledDeparture&gt;11:55:00&lt;/scheduledDeparture&gt;
                                    &lt;scheduledArrival&gt;13:00:00&lt;/scheduledArrival&gt;
                                &lt;/flight&gt;
                                &lt;flight&gt;
                                    &lt;flightId&gt;RA 1780&lt;/flightId&gt;
                                    &lt;airline&gt;RoyalAirline&lt;/airline&gt;
                                    &lt;fromAirport&gt;FRA&lt;/fromAirport&gt;
                                    &lt;toAirport&gt;HAM&lt;/toAirport&gt;
                                    &lt;date&gt;2009-04-15&lt;/date&gt;
                                    &lt;scheduledDeparture&gt;16:00:00&lt;/scheduledDeparture&gt;
                                    &lt;scheduledArrival&gt;17:10:00&lt;/scheduledArrival&gt;
                                &lt;/flight&gt;
                            &lt;/flights&gt;                                
                          &lt;/TravelBookingResponseMessage&gt;
                        ]]&gt;
                      &lt;/data&gt;
                  &lt;/message&gt;
                  &lt;header&gt;
                      &lt;element name="correlationId" 
                                  value="${correlationId}"/&gt;
                  &lt;/header&gt;
              &lt;/receive&gt;
              
          &lt;/actions&gt;
      &lt;/testcase&gt;
  &lt;/spring:beans&gt;
        </pre><p>Similar to a sequence diagram the test case describes every step of the use case. At the very beginning the test case gets
        name and its meta information. Following with the variable values that are used all over the test. Here it is the correlationId 
        and the customerId that are used as test variables. Inside message templates header values the variables are referenced several
        times in the test</p><p><tt class="literal">&lt;correlationId&gt;${correlationId}&lt;/correlationId&gt;</tt></p><p><tt class="literal">&lt;id&gt;${customerId}&lt;/id&gt;</tt></p><p>The sending/receiving actions use a previously defined message sender/receiver. This is the link between test case and basic 
        Spring configuration we have done before.</p><p><tt class="literal">&lt;send with="travelAgencyBookingRequestSender"&gt;</tt></p><p>The sending action chooses a message sender to actually send the message using a message transport (JMS, Http, SOAP, etc.).
        After sending this first "TravelBookingRequestMessage" request the test case expects the first "FlightBookingRequestMessage" 
        message on the SmartAirline JMS destination. In case this message is not arriving in time the test will fail with errors.
        In positive case our FlightBookingService works well and the message arrives in time. The received message is validated against
        a defined expected message template. Only in case all content validation steps are successful the test continues with the action
        chain. And so the test case proceeeds and works through the use case until every message is sent respectively received and 
        validated. The use case is done automatically without human interaction. Citrus simulates all surrounding applications and 
        provides detailed validation possibilities of messages.</p></div></div></div></div></body></html>